function playerToast(message,delay){$(".plyr").append('<div class="toast align-items-center text-bg-primary border-0 top-0 start-0 position-absolute m-3" role="alert" aria-live="assertive" aria-atomic="true" id="liveToast" style="z-index: 100000;"> <div class="d-flex"> <div class="toast-body"> '+message+' </div> <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button></div></div>');const toast=new bootstrap.Toast($("#liveToast"),{delay:delay*1e3});toast.show()}$.fn.shiftSelectable=function(){var lastChecked,$boxes=this;$boxes.click(function(evt){if(!lastChecked){lastChecked=this;return}if(evt.shiftKey){var start=$boxes.index(this),end=$boxes.index(lastChecked);$boxes.slice(Math.min(start,end),Math.max(start,end)+1).prop("checked",lastChecked.checked).trigger("change")}lastChecked=this})};var createCookie=function(name,value,days){var expires;if(days){var date=new Date;date.setTime(date.getTime()+days*24*60*60*1e3);expires="; expires="+date.toGMTString()}else{expires=""}document.cookie=name+"="+value+expires+"; path=/"};function getCookie(c_name){if(document.cookie.length>0){c_start=document.cookie.indexOf(c_name+"=");if(c_start!=-1){c_start=c_start+c_name.length+1;c_end=document.cookie.indexOf(";",c_start);if(c_end==-1){c_end=document.cookie.length}return unescape(document.cookie.substring(c_start,c_end))}}return""}$(".switch:not(.disabled)").click(function(){const $this=$(this);const $checkbox=$("#"+$this.attr("data-association"));$this.toggleClass("checked");$checkbox.prop("checked",$this.hasClass("checked"))});$(".form-check-label").click(function(){$(this).parent().find(".radio, .checkbox").click()});$(".export-table").click(function(){var titles=[];var data=[];$(".table-data th").each(function(){titles.push($(this).text())});$(".table-data td").each(function(){data.push($(this).text())});var today=new Date;var dd=String(today.getDate()).padStart(2,"0");var mm=String(today.getMonth()+1).padStart(2,"0");var yyyy=today.getFullYear();today=mm+"-"+dd+"-"+yyyy;var CSVString=prepCSVRow(titles,titles.length,"");CSVString=prepCSVRow(data,titles.length,CSVString);var downloadLink=document.createElement("a");var blob=new Blob(["\ufeff",CSVString]);var url=URL.createObjectURL(blob);downloadLink.href=url;downloadLink.download=$(this).data("export-title")+"-"+today+".csv";document.body.appendChild(downloadLink);downloadLink.click();document.body.removeChild(downloadLink)});function prepCSVRow(arr,columnCount,initial){var row="";var delimeter=",";var newLine="\r\n";function splitArray(_arr,_count){var splitted=[];var result=[];_arr.forEach(function(item,idx){if((idx+1)%_count===0){splitted.push(item);result.push(splitted);splitted=[]}else{splitted.push(item)}});return result}var plainArr=splitArray(arr,columnCount);plainArr.forEach(function(arrItem){arrItem.forEach(function(item,idx){row+=item+(idx+1===arrItem.length?"":delimeter)});row+=newLine});return initial+row}$(".options:not(.disabled)").click(function(e){e.stopPropagation();var $element=$(this);$element.toggleClass("show");if($element.hasClass("show")){$(".options:not(.disabled)").not($element).removeClass("show")}});$("#select-all").click(function(){$('input[name="file_id"]:checkbox').not(this).prop("checked",this.checked)});!function(e){var t=0,s=function(t){return e(t).first().children("."+e.fn.multiSelector.defaults.selectedElementClass)},l={bind:function(l){l=e.extend(e.fn.multiSelector.defaults,l),this.each(function(){var n=this,i="l"+ ++t;e(this).data("ms-id",i),l.disableSelection&&e(this).on("selectstart",function(){return!1}),e(this).on("click",l.selector,function(t){l.onSelectionStart(s(n),n,this,t);var i=e(n).children("."+l.lastElementClass);if(0===i.length&&(i=e(n).children(l.selector)),i.length>0&&t.shiftKey&&!l.disableShift){var a=e(n).children(l.selector),c=a.index(i.first()),r=a.index(this);return e(n).children(".ms-shifted").removeClass("ms-shifted").removeClass("ms-selected"),a.slice(Math.min(c,r),Math.max(c,r)+1).addClass(l.selectedElementClass).addClass("ms-shifted"),void l.onSelectionEnd(s(n),n,this,t)}if(e(n).children(l.selector).removeClass("ms-shifted"),i.removeClass(l.lastElementClass),(!t.ctrlKey&&!t.metaKey||l.disableCtrl)&&e(n).children(l.selector).not(this).removeClass(l.selectedElementClass),e(this).toggleClass(l.selectedElementClass),e(this).toggleClass(l.lastElementClass,e(this).hasClass(l.selectedElementClass)),0===e(n).children("."+l.lastElementClass).length){for(var d=e(this).next();d.length>0;){if(e(d[0]).hasClass(l.selectedElementClass)){!0,e(d[0]).addClass(l.lastElementClass);break}d=e(d[0]).next()}if(0===e(n).children("."+l.lastElementClass).length)for(var o=e(this).prev();o.length>0;){if(e(o[0]).hasClass(l.selectedElementClass)){!0,e(o[0]).addClass(l.lastElementClass);break}o=e(o[0]).next()}}l.onSelectionEnd(e(n).children("."+l.selectedElementClass),n,this,t)})})},get:function(){if(this.length>1){var t={};return this.each(function(){t[e(this).data("ms-id")]=s(this)}),t}return s(this)},select:function(){this.each(function(){e(this).children(e.fn.multiSelector.defaults.selector).addClass(e.fn.multiSelector.defaults.selectedElementClass)})},deselect:function(){this.each(function(){e(this).children(e.fn.multiSelector.defaults.selector).removeClass(e.fn.multiSelector.defaults.selectedElementClass).removeClass(e.fn.multiSelector.defaults.lastElementClass)})},unbind:function(){this.each(function(){e(this).unbind("click selectstart")})}};e.fn.multiSelector=function(t){return l[t]?l[t].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof t&&t?void e.error("Method "+t+" does not exist on jQuery.multiSelector"):l.bind.apply(this,arguments)},e.fn.multiSelector.defaults={selectedElementClass:"ms-selected",lastElementClass:"ms-last",selector:"*",disableSelection:!0,disableShift:!1,disableCtrl:!1,onSelectionStart:function(){},onSelectionEnd:function(){}}}(jQuery);(function(factory){if(typeof define==="function"&&define.amd){define(["jquery"],factory)}else{factory(jQuery)}})(function($){$.ui=$.ui||{};var version=$.ui.version="1.12.1";(function(){var cachedScrollbarWidth,max=Math.max,abs=Math.abs,rhorizontal=/left|center|right/,rvertical=/top|center|bottom/,roffset=/[\+\-]\d+(\.[\d]+)?%?/,rposition=/^\w+/,rpercent=/%$/,_position=$.fn.position;function getOffsets(offsets,width,height){return[parseFloat(offsets[0])*(rpercent.test(offsets[0])?width/100:1),parseFloat(offsets[1])*(rpercent.test(offsets[1])?height/100:1)]}function parseCss(element,property){return parseInt($.css(element,property),10)||0}function getDimensions(elem){var raw=elem[0];if(raw.nodeType===9){return{width:elem.width(),height:elem.height(),offset:{top:0,left:0}}}if($.isWindow(raw)){return{width:elem.width(),height:elem.height(),offset:{top:elem.scrollTop(),left:elem.scrollLeft()}}}if(raw.preventDefault){return{width:0,height:0,offset:{top:raw.pageY,left:raw.pageX}}}return{width:elem.outerWidth(),height:elem.outerHeight(),offset:elem.offset()}}$.position={scrollbarWidth:function(){if(cachedScrollbarWidth!==undefined){return cachedScrollbarWidth}var w1,w2,div=$("<div "+"style='display:block;position:absolute;width:50px;height:50px;overflow:hidden;'>"+"<div style='height:100px;width:auto;'></div></div>"),innerDiv=div.children()[0];$("body").append(div);w1=innerDiv.offsetWidth;div.css("overflow","scroll");w2=innerDiv.offsetWidth;if(w1===w2){w2=div[0].clientWidth}div.remove();return cachedScrollbarWidth=w1-w2},getScrollInfo:function(within){var overflowX=within.isWindow||within.isDocument?"":within.element.css("overflow-x"),overflowY=within.isWindow||within.isDocument?"":within.element.css("overflow-y"),hasOverflowX=overflowX==="scroll"||overflowX==="auto"&&within.width<within.element[0].scrollWidth,hasOverflowY=overflowY==="scroll"||overflowY==="auto"&&within.height<within.element[0].scrollHeight;return{width:hasOverflowY?$.position.scrollbarWidth():0,height:hasOverflowX?$.position.scrollbarWidth():0}},getWithinInfo:function(element){var withinElement=$(element||window),isWindow=$.isWindow(withinElement[0]),isDocument=!!withinElement[0]&&withinElement[0].nodeType===9,hasOffset=!isWindow&&!isDocument;return{element:withinElement,isWindow:isWindow,isDocument:isDocument,offset:hasOffset?$(element).offset():{left:0,top:0},scrollLeft:withinElement.scrollLeft(),scrollTop:withinElement.scrollTop(),width:withinElement.outerWidth(),height:withinElement.outerHeight()}}};$.fn.position=function(options){if(!options||!options.of){return _position.apply(this,arguments)}options=$.extend({},options);var atOffset,targetWidth,targetHeight,targetOffset,basePosition,dimensions,target=$(options.of),within=$.position.getWithinInfo(options.within),scrollInfo=$.position.getScrollInfo(within),collision=(options.collision||"flip").split(" "),offsets={};dimensions=getDimensions(target);if(target[0].preventDefault){options.at="left top"}targetWidth=dimensions.width;targetHeight=dimensions.height;targetOffset=dimensions.offset;basePosition=$.extend({},targetOffset);$.each(["my","at"],function(){var pos=(options[this]||"").split(" "),horizontalOffset,verticalOffset;if(pos.length===1){pos=rhorizontal.test(pos[0])?pos.concat(["center"]):rvertical.test(pos[0])?["center"].concat(pos):["center","center"]}pos[0]=rhorizontal.test(pos[0])?pos[0]:"center";pos[1]=rvertical.test(pos[1])?pos[1]:"center";horizontalOffset=roffset.exec(pos[0]);verticalOffset=roffset.exec(pos[1]);offsets[this]=[horizontalOffset?horizontalOffset[0]:0,verticalOffset?verticalOffset[0]:0];options[this]=[rposition.exec(pos[0])[0],rposition.exec(pos[1])[0]]});if(collision.length===1){collision[1]=collision[0]}if(options.at[0]==="right"){basePosition.left+=targetWidth}else if(options.at[0]==="center"){basePosition.left+=targetWidth/2}if(options.at[1]==="bottom"){basePosition.top+=targetHeight}else if(options.at[1]==="center"){basePosition.top+=targetHeight/2}atOffset=getOffsets(offsets.at,targetWidth,targetHeight);basePosition.left+=atOffset[0];basePosition.top+=atOffset[1];return this.each(function(){var collisionPosition,using,elem=$(this),elemWidth=elem.outerWidth(),elemHeight=elem.outerHeight(),marginLeft=parseCss(this,"marginLeft"),marginTop=parseCss(this,"marginTop"),collisionWidth=elemWidth+marginLeft+parseCss(this,"marginRight")+scrollInfo.width,collisionHeight=elemHeight+marginTop+parseCss(this,"marginBottom")+scrollInfo.height,position=$.extend({},basePosition),myOffset=getOffsets(offsets.my,elem.outerWidth(),elem.outerHeight());if(options.my[0]==="right"){position.left-=elemWidth}else if(options.my[0]==="center"){position.left-=elemWidth/2}if(options.my[1]==="bottom"){position.top-=elemHeight}else if(options.my[1]==="center"){position.top-=elemHeight/2}position.left+=myOffset[0];position.top+=myOffset[1];collisionPosition={marginLeft:marginLeft,marginTop:marginTop};$.each(["left","top"],function(i,dir){if($.ui.position[collision[i]]){$.ui.position[collision[i]][dir](position,{targetWidth:targetWidth,targetHeight:targetHeight,elemWidth:elemWidth,elemHeight:elemHeight,collisionPosition:collisionPosition,collisionWidth:collisionWidth,collisionHeight:collisionHeight,offset:[atOffset[0]+myOffset[0],atOffset[1]+myOffset[1]],my:options.my,at:options.at,within:within,elem:elem})}});if(options.using){using=function(props){var left=targetOffset.left-position.left,right=left+targetWidth-elemWidth,top=targetOffset.top-position.top,bottom=top+targetHeight-elemHeight,feedback={target:{element:target,left:targetOffset.left,top:targetOffset.top,width:targetWidth,height:targetHeight},element:{element:elem,left:position.left,top:position.top,width:elemWidth,height:elemHeight},horizontal:right<0?"left":left>0?"right":"center",vertical:bottom<0?"top":top>0?"bottom":"middle"};if(targetWidth<elemWidth&&abs(left+right)<targetWidth){feedback.horizontal="center"}if(targetHeight<elemHeight&&abs(top+bottom)<targetHeight){feedback.vertical="middle"}if(max(abs(left),abs(right))>max(abs(top),abs(bottom))){feedback.important="horizontal"}else{feedback.important="vertical"}options.using.call(this,props,feedback)}}elem.offset($.extend(position,{using:using}))})};$.ui.position={fit:{left:function(position,data){var within=data.within,withinOffset=within.isWindow?within.scrollLeft:within.offset.left,outerWidth=within.width,collisionPosLeft=position.left-data.collisionPosition.marginLeft,overLeft=withinOffset-collisionPosLeft,overRight=collisionPosLeft+data.collisionWidth-outerWidth-withinOffset,newOverRight;if(data.collisionWidth>outerWidth){if(overLeft>0&&overRight<=0){newOverRight=position.left+overLeft+data.collisionWidth-outerWidth-withinOffset;position.left+=overLeft-newOverRight}else if(overRight>0&&overLeft<=0){position.left=withinOffset}else{if(overLeft>overRight){position.left=withinOffset+outerWidth-data.collisionWidth}else{position.left=withinOffset}}}else if(overLeft>0){position.left+=overLeft}else if(overRight>0){position.left-=overRight}else{position.left=max(position.left-collisionPosLeft,position.left)}},top:function(position,data){var within=data.within,withinOffset=within.isWindow?within.scrollTop:within.offset.top,outerHeight=data.within.height,collisionPosTop=position.top-data.collisionPosition.marginTop,overTop=withinOffset-collisionPosTop,overBottom=collisionPosTop+data.collisionHeight-outerHeight-withinOffset,newOverBottom;if(data.collisionHeight>outerHeight){if(overTop>0&&overBottom<=0){newOverBottom=position.top+overTop+data.collisionHeight-outerHeight-withinOffset;position.top+=overTop-newOverBottom}else if(overBottom>0&&overTop<=0){position.top=withinOffset}else{if(overTop>overBottom){position.top=withinOffset+outerHeight-data.collisionHeight}else{position.top=withinOffset}}}else if(overTop>0){position.top+=overTop}else if(overBottom>0){position.top-=overBottom}else{position.top=max(position.top-collisionPosTop,position.top)}}},flip:{left:function(position,data){var within=data.within,withinOffset=within.offset.left+within.scrollLeft,outerWidth=within.width,offsetLeft=within.isWindow?within.scrollLeft:within.offset.left,collisionPosLeft=position.left-data.collisionPosition.marginLeft,overLeft=collisionPosLeft-offsetLeft,overRight=collisionPosLeft+data.collisionWidth-outerWidth-offsetLeft,myOffset=data.my[0]==="left"?-data.elemWidth:data.my[0]==="right"?data.elemWidth:0,atOffset=data.at[0]==="left"?data.targetWidth:data.at[0]==="right"?-data.targetWidth:0,offset=-2*data.offset[0],newOverRight,newOverLeft;if(overLeft<0){newOverRight=position.left+myOffset+atOffset+offset+data.collisionWidth-outerWidth-withinOffset;if(newOverRight<0||newOverRight<abs(overLeft)){position.left+=myOffset+atOffset+offset}}else if(overRight>0){newOverLeft=position.left-data.collisionPosition.marginLeft+myOffset+atOffset+offset-offsetLeft;if(newOverLeft>0||abs(newOverLeft)<overRight){position.left+=myOffset+atOffset+offset}}},top:function(position,data){var within=data.within,withinOffset=within.offset.top+within.scrollTop,outerHeight=within.height,offsetTop=within.isWindow?within.scrollTop:within.offset.top,collisionPosTop=position.top-data.collisionPosition.marginTop,overTop=collisionPosTop-offsetTop,overBottom=collisionPosTop+data.collisionHeight-outerHeight-offsetTop,top=data.my[1]==="top",myOffset=top?-data.elemHeight:data.my[1]==="bottom"?data.elemHeight:0,atOffset=data.at[1]==="top"?data.targetHeight:data.at[1]==="bottom"?-data.targetHeight:0,offset=-2*data.offset[1],newOverTop,newOverBottom;if(overTop<0){newOverBottom=position.top+myOffset+atOffset+offset+data.collisionHeight-outerHeight-withinOffset;if(newOverBottom<0||newOverBottom<abs(overTop)){position.top+=myOffset+atOffset+offset}}else if(overBottom>0){newOverTop=position.top-data.collisionPosition.marginTop+myOffset+atOffset+offset-offsetTop;if(newOverTop>0||abs(newOverTop)<overBottom){position.top+=myOffset+atOffset+offset}}}},flipfit:{left:function(){$.ui.position.flip.left.apply(this,arguments);$.ui.position.fit.left.apply(this,arguments)},top:function(){$.ui.position.flip.top.apply(this,arguments);$.ui.position.fit.top.apply(this,arguments)}}}})();var position=$.ui.position});function clearFormErrors(){const $modals=$("#createFolderModal, #renameFolderModal, #deleteFolderModal");$modals.find(".invalid-feedback").text("");$modals.find(".is-invalid").removeClass("is-invalid")}const entityMap={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};function escapeHtml(data){if(!data){return data}return data.toString().replace(/[&<>"'`=\/]/g,s=>entityMap[s])}function addFolderHTML(folder,childFolder,childList){if(childFolder){$(childList).append('<li class="pb-1" data-folder-id="'+folder["fld_id"]+'" data-folder-title="'+escapeHtml(folder["fld_name"])+'" data-folder-url="'+folder["url"]+'">'+'<div data-href="" class="d-inline-block w-100 text-decoration-none px-2 py-1" >'+'<svg style="width: 26px;fill: #0069FF" focusable="false" viewBox="0 0 24 24" aria-hidden="true" role="presentation"><path d="M9.17 6l2 2H20v10H4V6h5.17M10 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2h-8l-2-2z"></path></svg>'+'<span class="ps-1 folder-title h6" style="position: relative;top: 2px;">'+escapeHtml(folder["fld_name"])+"</span>"+'<svg class="arrow-up" style="float: right; width: 22px; fill: #7B7F88; margin-top: 3px;" focusable="false" viewBox="0 0 24 24" aria-hidden="true" role="presentation"><g id="_16" data-name="16"><path d="m12 16a1 1 0 0 1 -.71-.29l-6-6a1 1 0 0 1 1.42-1.42l5.29 5.3 5.29-5.29a1 1 0 0 1 1.41 1.41l-6 6a1 1 0 0 1 -.7.29z"/></g></svg>'+"</div>"+"</li>")}else{$(childList).append(' <li class="pb-1" data-folder-id="'+folder["fld_id"]+'" data-folder-title="'+escapeHtml(folder["fld_name"])+'" data-folder-url="'+folder["url"]+'">'+'<div data-href="" class="d-inline-block w-100 text-decoration-none px-2 py-1">'+'<svg style="width: 26px;fill: #0069FF" focusable="false" viewBox="0 0 24 24" aria-hidden="true" role="presentation"><path d="M9.17 6l2 2H20v10H4V6h5.17M10 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2h-8l-2-2z"></path></svg>'+'<span class="ps-1 folder-title h6" style="position: relative; top: 2px;">'+escapeHtml(folder["fld_name"])+"</span>"+"</div>"+"</li>")}}function formatBytes(bytes,decimals=2,HTMLenabled=false){if(!+bytes)return"0 B";const k=1024;const dm=decimals<0?0:decimals;const sizes={B:"B",KB:"KB",MB:"MB",GB:"GB",TB:"TB",PB:"PB",EB:"EB",ZB:"ZB",YB:"YB"};const i=Math.floor(Math.log(bytes)/Math.log(k));const size=sizes[Object.keys(sizes)[i]];if(HTMLenabled){return`${parseFloat((bytes/Math.pow(k,i)).toFixed(dm))}<span class="ms-1" style="font-size: 10px">${size}</span>`}return`${parseFloat((bytes/Math.pow(k,i)).toFixed(dm))} ${size}`}function formatDate(date,method){const dateObject=new Date(date);const year=dateObject.getFullYear();const month=`0${dateObject.getMonth()+1}`.slice(-2);const day=`0${dateObject.getDate()}`.slice(-2);const hours=`0${dateObject.getHours()}`.slice(-2);const minutes=`0${dateObject.getMinutes()}`.slice(-2);const seconds=`0${dateObject.getSeconds()}`.slice(-2);if(method===2){return`${year}-${month}-${day} ${hours}:${minutes}`}else{return`${year}-${month}-${day}`}}function copy(obj){obj.focus();obj.select()}function copyToClipboard(text){var span=document.createElement("span");span.textContent=text;span.style.whiteSpace="pre";span.style.height="0";document.body.appendChild(span);var selection=window.getSelection();var range=document.createRange();selection.removeAllRanges();range.selectNode(span);selection.addRange(range);var success=false;try{success=document.execCommand("copy");navigator.clipboard.writeText(text).then(()=>{})}catch(err){}selection.removeAllRanges();span.remove();if(!success){}return success}function addFileHTML(file,element){$(element).append('<div class="col-12 file-list-row" data-file-id="'+file["file_id"]+'" data-file-code="'+file["file_code"]+'" data-title="'+escapeHtml(file["file_title"])+'"> <div class="position-relative row"> <div class="select-row col-12"></div> <div class="position-absolute col-12" style="top: 0;width: 100%;height: 50px"> <div class="draggableItem dragLayer"></div> <div class="row"> <div class="col-6 col-xl-6 col-xxl-5"> <div class="position-relative d-inline-block draggableItem" style="top: 5px;"><input type="hidden" value="'+file["file_id"]+'" name="file_id"></div> <span style="font-size: 14px; margin-top: 16px; display: inline-block; max-width: 80%" class="draggableItem position-relative"> <a href="https://voe.sx/'+file["file_code"]+'" class="text-decoration-none d-inline-block text-truncate" style="max-width: 100%;" target="_blank">'+escapeHtml(file["file_title"])+'</a> </span> </div> <div class="col-6 col-xl-3 col-xxl-3" data-file-id="'+file["file_id"]+'"> <span style="margin-top: 9px; display: inline-block;" class="draggableItem position-relative float-end"> <a href="" class="share-file-action btn btn-icon btn-sm" title="Copy URL"> <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clipboard"><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path><rect x="8" y="2" width="8" height="4" rx="1" ry="1"></rect></svg> </a> <a href="" class="info-file-action btn btn-icon btn-sm" title="Show Information"> <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-info"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg> </a><a href="" class="clone-file-action btn btn-icon btn-sm" title="Clone File"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-copy"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg> </a> <a href="" class="delete-file-action btn btn-icon btn-sm" title="Delete"> <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-trash-2"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg> </a> </span> </div> <div class="col-1 col-xl-3 col-xxl-2 d-none d-xl-block"><span style="font-size: 13px; margin-top: 17px; display: inline-block; float: right" class="draggableItem position-relative" title="'+formatDate(file["file_created"],2)+'">'+formatDate(file["file_created"],2)+'</span></div> <div class="col-1 d-none d-xxl-block"><span style="font-size: 13px; margin-top: 17px; display: inline-block; float: right" class="draggableItem position-relative">'+file["file_views_full"]+'</span></div> <div class="col-1 d-none d-xxl-block"><span style="font-size: 13px; margin-top: 17px; display: inline-block; float: right" class="draggableItem position-relative">'+formatBytes(file["file_size_n"]?file["file_size_n"]:file["file_size_o"],2,true)+"</span></div> </div> </div> </div> </div>")}function addChildFolderHTML(folder,childFolder,childList){if(childFolder){$(childList).append('<li class="pb-1 ms-4" data-folder-id="'+folder["fld_id"]+'" data-folder-title="'+escapeHtml(folder["fld_name"])+'" data-folder-url="'+escapeHtml(folder["url"])+'"><div class="d-inline-block w-100 text-decoration-none small px-2 folder-title" data-href="">'+folder["fld_name"]+' <svg class="arrow-up" style="float: right; width: 22px; fill: #7B7F88;" focusable="false" viewBox="0 0 24 24" aria-hidden="true" role="presentation"><g id="_16" data-name="16"><path d="m12 16a1 1 0 0 1 -.71-.29l-6-6a1 1 0 0 1 1.42-1.42l5.29 5.3 5.29-5.29a1 1 0 0 1 1.41 1.41l-6 6a1 1 0 0 1 -.7.29z"></path></g></svg></div></li>')}else{$(childList).append('<li class="pb-1 ms-4" data-folder-id="'+folder["fld_id"]+'" data-folder-title="'+escapeHtml(folder["fld_name"])+'" data-folder-url="'+escapeHtml(folder["url"])+'"><div class="d-inline-block w-100 text-decoration-none small px-2 folder-title" data-href="">'+folder["fld_name"]+"</div></li>")}}function exposeFolder(){$(".processing-disabled").removeClass("processing-disabled").addClass("processing-blocker");var folderID=$(".manager-folders li.context-menu-active").attr("data-folder-id");$("#informationFolderModal .folder-name, #informationFolderModal .folder-created-at, #informationFolderModal .folder-updated-at, #informationFolderModal .folder-id, #informationFolderModal .folder-parent-id, "+"#informationFolderModal .folder-code, #informationFolderModal .folder-description, #informationFolderModal .folder-url").text("");new bootstrap.Modal($("#informationFolderModal")).show();$.ajax({type:"GET",url:"/api2/folders",data:$.param({folderID:folderID}),success:function(response){$("#informationFolderModal .folder-name").text(response["folder"]["fld_name"]);$("#informationFolderModal .folder-created-at").text(formatDate(response["folder"]["created_at"],2));$("#informationFolderModal .folder-updated-at").text(formatDate(response["folder"]["updated_at"],2));$("#informationFolderModal .folder-id").text(response["folder"]["fld_id"]);$("#informationFolderModal .folder-parent-id").text(response["folder"]["fld_parent_id"]);$("#informationFolderModal .folder-code").text(response["folder"]["fld_code"]);$("#informationFolderModal .folder-description").text(response["folder"]["fld_descr"]);$("#informationFolderModal .folder-url").text(response["folder"]["url"]).attr("href",response["folder"]["url"]);setTimeout(function(){$(".processing-blocker").removeClass("processing-blocker").addClass("processing-disabled")},500)}})}function createFolder(folderID){clearFormErrors();folderID=folderID||$(".manager-folders li.context-menu-active").attr("data-folder-id")||0;$('#createFolderModal input[name="fld_parent_id"]').val(folderID);$('#createFolderModal input[name="fld_name"]').val("").focus();new bootstrap.Modal($("#createFolderModal")).show()}function renameFolder(){clearFormErrors();const folderID=$(".manager-folders li.context-menu-active").data("folder-id");const folderTitle=$(".manager-folders li.context-menu-active").data("folder-title");$('#renameFolderModal input[name="fld_id"]').val(folderID);$('#renameFolderModal input[name="fld_name"]').val(folderTitle).focus();new bootstrap.Modal($("#renameFolderModal")).show()}function deleteFolder(){clearFormErrors();const folderID=$(".manager-folders li.context-menu-active").data("folder-id");$('#deleteFolderModal input[name="fld_id"]').val(folderID);$("#deleteFolderModal .folderTitle").text($('.manager-folders [data-folder-id="'+folderID+'"]').data("folder-title"));new bootstrap.Modal($("#deleteFolderModal")).show()}function shareFolder(){copyToClipboard($(".manager-folders li.context-menu-active").data("folder-url"))}function loadSubtitles(subtitles){$(subtitles).each(function(index,item){$("#informationFileModal .file-subtitles").append('<div class="col-6" data-language="'+item["countryCode"]+'"><div class="paper p-3 mb-3"><p>'+item["language"]+", "+item["countryCode"]+'<span class="float-end">'+formatBytes(item["size"])+'</span></p><a href="'+item["path"]+'" class="btn btn-secondary btn-sm" target="_blank">Open</a><div class="delete-subtitle-action btn btn-danger btn-sm text-white float-end">Delete</div></div></div>')})}function getSubtitles(){fileInfo();new bootstrap.Tab($("#tab-subtitles")).show()}function getThumbnails(){fileInfo();new bootstrap.Tab($("#tab-thumbnails")).show()}function fileInfo(fileID){var fileID=typeof $(".manager-files .file-list-row.context-menu-active").data("file-id")!=="undefined"?""+$(".manager-files .file-list-row.context-menu-active").data("file-id"):fileID;$(".processing-disabled").removeClass("processing-disabled").addClass("processing-blocker");$("#informationFileModal .file-title, #informationFileModal .file-state, #informationFileModal .file-size, #informationFileModal .file-length, #informationFileModal .file-created-at, #informationFileModal .file-network-cache, #informationFileModal .file-id, #informationFileModal .file-name, #informationFileModal .file-code, #informationFileModal .file-folder-id, #informationFileModal .file-revenue, #informationFileModal .file-views, #informationFileModal .file-downloads, #informationFileModal .file-server, #informationFileModal .file-description, #informationFileModal .file-updated-at, #informationFileModal .file-integrity-check").text("");$("#informationFileModal .file-previews, #informationFileModal .file-thumbnails, #informationFileModal .file-subtitles").html("");$("#informationFileModal .file-title, .share-url textarea").val("");new bootstrap.Modal($("#informationFileModal")).show();new bootstrap.Tab($("#tab-general")).show();$.ajax({type:"GET",url:"/api2/file/"+fileID,data:$.param({file_id:fileID}),success:function(response){$("#informationFileModal .file-title").val(escapeHtml(response["file"]["file_title"])).text(escapeHtml(response["file"]["file_title"]));$("#informationFileModal .file-state").text(response["file"]["file_status"]);$("#informationFileModal .file-size").text(formatBytes(response["file"]["file_size_n"]?response["file"]["file_size_n"]:response["file"]["file_size_o"]));$("#informationFileModal .file-length").text(response["file"]["length_human_readable"]);$("#informationFileModal .file-created-at").text(formatDate(response["file"]["created_at"],2));$("#informationFileModal .file-network-cache").text(response["file"]["network_cache"]?"Enabled":"Disabled");$("#informationFileModal .file-id").val(response["file"]["file_id"]).text(response["file"]["file_id"]);$("#informationFileModal .file-name").text(escapeHtml(response["file"]["file_name"]));$("#informationFileModal .file-code").text(escapeHtml(response["file"]["file_code"]));$("#informationFileModal .file-folder-id").text(escapeHtml(response["file"]["file_fld_id"]));$("#informationFileModal .file-revenue").text(response["file"]["file_money"]);$("#informationFileModal .file-views").text(response["file"]["file_views_full"]);$("#informationFileModal .file-downloads").text(response["file"]["file_downloads"]);$("#informationFileModal .file-server").text(response["file"]["server"]);$("#informationFileModal .file-description").text(escapeHtml(response["file"]["file_desc"]));response["file"]["subtitle_warning"]?$("#informationFileModal .subtitle-warning").removeClass("d-none"):$("#informationFileModal .subtitle-warning").addClass("d-none");$("#informationFileModal .file-updated-at").text(formatDate(response["file"]["updated_at"],2));$("#informationFileModal .file-integrity-check").text(response["file"]["integrity_check"]?"Enabled":"Disabled");FilePond.destroy(document.querySelector("#filepond"));var uploadPond=FilePond.create(document.querySelector("#filepond"),{server:{revert:null,process:(fieldName,file,metadata,load,error,progress,abort,transfer,options)=>{var request=null;const regex=/\/file\/([0-9]{1,})\//gm;const subst="/file/"+$('form.save-subtitle-file-action input[name="file_id"]').val()+"/";result=$(".file-subtitles").data("subtitle-action").replace(regex,subst);var formData=new FormData;formData.append(fieldName,file,file.name);formData.append("_token",$('form.save-subtitle-file-action input[name="_token"]').val());formData.append("file_id",$('form.save-subtitle-file-action input[name="file_id"]').val());formData.append("language",$('form.save-subtitle-file-action select[name="language"]').val());formData.append("_method","POST");request=new XMLHttpRequest;request.open("POST",result);request.setRequestHeader("Accept","application/json");request.onload=function(){if(request.status>=200&&request.status<300){try{var json=JSON.parse(request.responseText);$(".file-subtitles").html("");loadSubtitles(json["subtitles"]);load("Success.")}catch(e){error("oh no, something failed. Please try again!")}}else{error("oh no, something failed. Please try again!")}};request.send(formData);return{abort:()=>{if(request!=null)request.abort();abort()}}}}});loadSubtitles(response["file"]["subtitles"]);if(!response["file"]["thumbnails"].length){$("#informationFileModal .file-thumbnails").append('<div class="col-12"><small><span class="chip-card chip-blue">Unavailable</span> Not activated for your account.</small></div>')}else{$(response["file"]["thumbnails"]).each(function(index,item){$("#informationFileModal .file-thumbnails").append('<div class="col-12 col-md-6 col-lg-4"><a href="'+item["url"]+'" target="_blank"><figure class="figure"><img src="'+item["url"]+'" class="figure-img img-fluid rounded" alt="Thumbnail"><figcaption class="figure-caption text-end">'+item["description"]+"</figcaption></figure></a></div>")})}if(!response["file"]["previews"].length){$("#informationFileModal .file-previews").append('<div class="col-12"><small><span class="chip-card chip-blue">Unavailable</span> Not activated for your account.</small></div>')}else{$(response["file"]["previews"]).each(function(index,item){$("#informationFileModal .file-previews").append('<div class="col-12"><video width="320" height="240" controls><source src="'+item["url"]+'" type="video/mp4">Your browser does not support the video tag.</video></div><div class="col-12"><small>'+item["description"]+' <a href="'+item["download"]+'" target="_blank">Download preview</a></small></div>')})}shareFile([fileID]);setTimeout(function(){$(".processing-blocker").removeClass("processing-blocker").addClass("processing-disabled")},500)}})}function deleteSubtitle(fileID,language){$.ajax({type:"DELETE",headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},url:"/api2/file/"+fileID+"/subtitle",data:{file_id:fileID,language:language,_METHOD:"DELETE"},success:function(response){$('.file-subtitles div[data-language="'+language+'"]').remove(0)},error:function(data){}})}function deleteFile(fileIDs){console.log(fileIDs);clearFormErrors();var fileIDs=typeof $(".manager-files .file-list-row.context-menu-active").data("file-id")!=="undefined"?$(".select-row.ui-selected").length>1?$(".select-row.ui-selected").map(function(){return $(this).parent().parent().attr("data-file-id")}).get().join(","):""+$(".manager-files .file-list-row.context-menu-active").data("file-id"):fileIDs;$("#deleteFileModal .fileTitle").text($(".select-row.ui-selected").length>1?"("+$(".select-row.ui-selected").length+" selected)":$('.manager-files [data-file-id="'+fileIDs+'"]').data("title"));if(fileIDs.indexOf(",")!=-1){$('#deleteFileModal input[name="file_ids[]"]').remove();fileIDs.split(/\s*,\s*/).forEach(function(myString){$('<input type="hidden" name="file_ids[]">').val(myString).appendTo($("#deleteFileModal form"))})}else{$('#deleteFileModal input[name="file_ids[]"]').remove();$('<input type="hidden" name="file_ids[]">').val(fileIDs).appendTo($("#deleteFileModal form"))}new bootstrap.Modal($("#deleteFileModal")).show()}function cloneFile(fileIDs){console.log(fileIDs);clearFormErrors();var fileIDs=typeof $(".manager-files .file-list-row.context-menu-active").data("file-id")!=="undefined"?$(".select-row.ui-selected").length>1?$(".select-row.ui-selected").map(function(){return $(this).parent().parent().attr("data-file-id")}).get().join(","):""+$(".manager-files .file-list-row.context-menu-active").data("file-id"):fileIDs;$("#cloneFileModal .fileTitle").text($(".select-row.ui-selected").length>1?$(".select-row.ui-selected").length:1);if(fileIDs.indexOf(",")!=-1){$('#cloneFileModal input[name="file_ids[]"]').remove();fileIDs.split(/\s*,\s*/).forEach(function(myString){$('<input type="hidden" name="file_ids[]">').val(myString).appendTo($("#cloneFileModal form"))})}else{$('#cloneFileModal input[name="file_ids[]"]').remove();$('<input type="hidden" name="file_ids[]">').val(fileIDs).appendTo($("#cloneFileModal form"))}new bootstrap.Modal($("#cloneFileModal")).show()}$(".file-subtitles").on("click",".delete-subtitle-action",function(e){e.preventDefault();deleteSubtitle($('#informationFileModal form input[name="file_id"]').val(),$(this).parent().parent().data("language"))});$(".files-wrapper").on("click",".delete-file-action",function(e){e.preventDefault();deleteFile($(this).parent().parent().attr("data-file-id")||$(".select-row.ui-selected").map(function(){return $(this).parent().parent().attr("data-file-id")}).get().join(","))});$(".files-wrapper").on("click",".clone-file-action",function(e){e.preventDefault();cloneFile($(this).parent().parent().attr("data-file-id")||$(".select-row.ui-selected").map(function(){return $(this).parent().parent().attr("data-file-id")}).get().join(","))});$(".files-wrapper").on("click",".info-file-action",function(e){e.preventDefault();fileInfo($(this).parent().parent().attr("data-file-id")||$(".select-row.ui-selected").map(function(){return $(this).parent().parent().attr("data-file-id")}).get().join(","))});$("form.save-subtitle-file-action").submit(function(e){e.preventDefault();let form=$(this);var actionUrl=form.attr("action");let method=form.find('input[name="_method"]').attr("value")||"POST"});function shareFile(fileIDs){var fileIDs=typeof $(".manager-files .file-list-row.context-menu-active").data("file-id")!=="undefined"?$(".select-row.ui-selected").length>1?$(".select-row.ui-selected").map(function(){return $(this).parent().parent().attr("data-file-id")}).get():[$(".manager-files .file-list-row.context-menu-active").data("file-id")]:fileIDs;$('.share-url input[type="radio"]').off("change").on("change",function(e){createCookie("filter-share_order",parseInt(e.target.value),30);var shareExport="";$(fileIDs).each(function(index,item){var file=$('.manager-files .file-list-row[data-file-id="'+item+'"]').length?$('.manager-files .file-list-row[data-file-id="'+item+'"]'):$('.file[data-file-id="'+item+'"]');switch(parseInt(e.target.value)){default:case 0:shareExport=shareExport+base+"/"+file.data("file-code")+"\n";break;case 1:shareExport=shareExport+base+"/e/"+file.data("file-code")+"\n";break;case 2:shareExport=shareExport+'<iframe src="'+base+"/e/"+file.data("file-code")+'" width="560" height="315" allowfullscreen allowtransparency allow="autoplay" scrolling="no" frameborder="0"></iframe>'+"\n";break;case 3:shareExport=shareExport+escapeHtml(file.data("title"))+"\n";break;case 4:shareExport=shareExport+staticBase+"/cache/"+file.data("file-code")+"_storyboard_L"+config.storyboard+".jpg\n";break;case 5:shareExport=shareExport+'[URL="'+base+"/"+file.data("file-code")+'"]'+escapeHtml(file.data("title"))+"[/URL]\n";break;case 6:shareExport=shareExport+'<a href="'+base+"/"+file.data("file-code")+'"><img src="'+staticBase+"/cache/"+file.data("file-code")+"_storyboard_L"+config.storyboard+'.jpg" alt="Preview '+escapeHtml(file.data("title"))+'" /></a>\n';break;case 7:shareExport=shareExport+escapeHtml(file.data("title"))+"\n"+base+"/"+file.data("file-code")+"\n\n";break}});$(".share-url textarea").html("").val(shareExport).focus().select();copyToClipboard(shareExport)});var share_order=getCookie("filter-share_order")?getCookie("filter-share_order"):0;$('.share-url input[type="radio"]').eq(share_order).prop("checked",true).trigger("change")}function shareFileModal(){shareFile();new bootstrap.Modal($("#shareFileModal")).show()}$(".files-wrapper").on("click",".share-file-action",function(e){e.preventDefault();shareFile($(this).parent().parent().attr("data-file-id")?[$(this).parent().parent().attr("data-file-id")]:$(".select-row.ui-selected").map(function(){return $(this).parent().parent().attr("data-file-id")}).get());new bootstrap.Modal($("#shareFileModal")).show()});function delay(callback,ms){var timer=0;return function(){var context=this,args=arguments;clearTimeout(timer);timer=setTimeout(function(){callback.apply(context,args)},ms||0)}}var manager={filesInitialized:false,foldersInitialized:false,per_page:50,page:1,order_by:"file_id",order_by_type:"desc",search_like:"",folder_id:0,init:function(){let per_page=getCookie("filter-per_page");if(per_page){manager.per_page=per_page;$('select.pagination-filter option[value="'+per_page+'"]').prop("selected",true)}manager.loadFolders();manager.loadFiles();$("ul.pagination").on("click","li",function(e){e.preventDefault();var element=this;const params=new Proxy(new URLSearchParams($(element).attr("data-target").substr($(element).attr("data-target").indexOf("?"))),{get:(searchParams,prop)=>searchParams.get(prop)});manager.page=params.page;manager.loadFiles()});$(".manager .column-header").on("click",".sort",function(e){manager.order_by=$(this).attr("data-sort-by");manager.order_by_type=manager.order_by_type==="desc"?"asc":"desc";$(".manager .column-header .sort").not(this).attr("src","/s/images/icons/sort-by-default.svg");$(this).hasClass("sort-desc")?$(this).removeClass("sort-desc").addClass("sort-asc").attr("src","/s/images/icons/sort-by-asc.svg"):$(this).removeClass("sort-desc").addClass("sort-desc").attr("src","/s/images/icons/sort-by-desc.svg");manager.loadFiles()});$("select.pagination-filter").on("change",function(e){manager.per_page=this.value;createCookie("filter-per_page",this.value,30);manager.loadFiles()});$(".manager .search input").on("input",delay(function(e){if($(this).val().length<=2&&$(this).val().length!==0){return false}$(".manager .search input").addClass("input-highlight");manager.search_like=this.value;manager.loadFiles()},500));$(".manager .select-all").change(function(){if($(".manager .select-all").is(":checked")){$(".manager .file-list-row .select-row").addClass("ui-selected").parent().find(".draggableItem").addClass("active")}else{$(".manager .file-list-row .select-row").removeClass("ui-selected").parent().find(".draggableItem").removeClass("active")}});$.contextMenu({selector:".manager-folders li",callback:function(key,options){switch(key){case"edit":renameFolder();break;case"create":createFolder();break;case"info":exposeFolder();break;case"share":shareFolder();break;case"delete":deleteFolder();break}},animation:{duration:0,show:"show",hide:"hide"},items:{edit:{name:"Rename",icon:"rename"},create:{name:"New Subfolder",icon:"new"},share:{name:"Copy Share URL",icon:"export"},info:{name:"Properties",icon:"info"},sep1:"---------",delete:{name:"Delete",icon:"delete"}}});$.contextMenu({selector:".manager-files .file-list-row",callback:function(key,options){switch(key){case"info":fileInfo();break;case"export_links":shareFileModal();break;case"change_subtitle":getSubtitles();break;case"get_thumbnails":getThumbnails();break;case"delete":deleteFile();break;case"clone":cloneFile();break}},animation:{duration:0,show:"show",hide:"hide"},items:{export_links:{name:"Export links",icon:"external"},change_subtitle:{name:"Subtitle",icon:"subtitle"},get_thumbnails:{name:"Thumbnails",icon:"preview"},clone:{name:"Clone",icon:"copy"},info:{name:"Details",icon:"info"},sep1:"---------",delete:{name:"Delete",icon:"delete"}}})},initializeFolders:function(){droppableSection();manager.foldersInitialized=true},initializeFiles:function(){$(".file-list-row .draggableItem, .ui-selected").draggable({cursor:"pointer",revert:"invalid",cursorAt:{top:15,left:15},helper:function(){var selected=$(".manager-files div.ui-selected:visible").length||1;var container=$("<div/>").attr("class","draggingContainer");container.text(selected+" Files");var fileIDs="";$.each($(".manager-files div.ui-selected:visible"),function(){console.log($(this).parent().parent().attr("data-file-id"));fileIDs=fileIDs+$(this).parent().parent().attr("data-file-id")+","});if(fileIDs.length===0){fileIDs=$(this).parent().parent().parent().parent().parent().parent().attr("data-file-id")}$(container).attr("data-file-ids",fileIDs);return container},stop:function(){$(this).draggable("option","revert","invalid")},drag:function(event,ui){}});$(".manager-files").selectable({filter:"div.file-list-row .select-row",selecting:function(event,ui){},unselecting:function(event,ui){if($($(ui)[0].unselecting).hasClass("ui-selected")){return false}},unselected:function(a,b){},selected:function(a,b){},stop:function(event,ui){$(".manager-files .ui-selected").each(function(index,item){$(this).parent().find(".dragLayer").addClass("active")});$(".select-row.ui-selected").length>1?$(".multi-action").show(0):$(".multi-action").hide(0)},start:function(event,ui){$(".manager-files .ui-selected").each(function(index,item){$(this).parent().find(".dragLayer").removeClass("active")})}});this.filesInitialized=true},loadFolders:function(){var openedFolders=$(".opened-folder").map(function(){return $(this).parent().attr("data-folder-id")}).get();if(openedFolders.length>10){openedFolders=[]}$(".processing-disabled").removeClass("processing-disabled").addClass("processing-blocker");$.ajax({type:"GET",url:"/api2/folders",data:{},success:function(response){$(".manager-folders").html("");$.each(response["folders"],function(index,folder){if(response["childFolders"].includes(folder["fld_id"])){addFolderHTML(folder,1,$("ul.manager-folders"))}else{addFolderHTML(folder,0,$("ul.manager-folders"))}});manager.initialized?manager.reloadTrigger():manager.initializeFolders();setTimeout(function(){$(".processing-blocker").removeClass("processing-blocker").addClass("processing-disabled")},500)}});$(".manager-folders").off("click","li > div").on("click","li > div",function(e,s){console.log([e.target,e.target.nodeName]);if($(e.target.nodeName).is("svg.arrow-down")){return}console.log([$(this),$(e.target)]);$(".select-all").prop("checked",false);if($(this).hasClass("opened-folder")){manager.folder_id=0;$(".manager-folders li").children().removeClass("opened-folder");$(".manager-folders li .folder-title").removeClass("fw-bold")}else{manager.folder_id=$(this).parent().attr("data-folder-id");$(".manager-folders li").children().not($(".manager-folders li .arrow-down").parent().parent()).removeClass("opened-folder");$(".manager-folders li .folder-title").removeClass("fw-bold");$(this).addClass("opened-folder");$(this).children(".folder-title").addClass("fw-bold")}manager.loadFiles()})},loadFiles:function(){$(".processing-disabled").removeClass("processing-disabled").addClass("processing-blocker");$.ajax({type:"GET",url:"/api2/files",data:{per_page:manager.per_page,page:manager.page,order_by:manager.order_by,order_by_type:manager.order_by_type,file_title:manager.search_like,folderID:manager.folder_id},success:function(response){$(".manager-files").html("");$.each(response["files"]["data"],function(index,file){addFileHTML(file,$(".manager-files"))});$(".manager ul.pagination").html("");$.each(response["files"]["links"],function(index,item){$(".manager ul.pagination").append('<li data-target="'+item["url"]+'" class="'+(item["active"]?"active":"")+'"><a href="'+item["url"]+'">'+item["label"]+"</a></li>")});$(".manager ul.pagination").append('<li data-target="">('+response["files"]["total"]+" total)</li>");$('select.pagination-filter option[value="'+response["files"]["per_page"]+'"]').prop("selected",true);manager.filesInitialized?manager.reloadTrigger():manager.initializeFiles();setTimeout(function(){$(".processing-blocker").removeClass("processing-blocker").addClass("processing-disabled")},500);if($(".manager .search input").empty()){$(".manager .search input").removeClass("input-highlight")}}})},reloadTrigger:function(){manager.initializeFiles()}};function ticketListItem(ticket,element){$(element).append('<div class="col-12 mb-3 ticket" data-ticket-id="'+ticket["id"]+'"><div class="paper mx-3 p-3"><h6>'+escapeHtml(ticket["title"])+'</h6><div><div class="view-ticket-action btn btn-icon btn-sm float-end mt-0" data-ticket-id="'+ticket["id"]+'" style="color: rgb(107, 114, 128)"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="currentColor"><path d="M10 12a2 2 0 100-4 2 2 0 000 4z"></path><path fill-rule="evenodd" d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z" clip-rule="evenodd"></path></svg></div><span class="chip">'+ticket["category"]+"</span></div></div></div>")}function ticketListEmpty(element){$(element).append('<div class="col-12"><small class="d-block text-center mx-3 mt-3 mb-4">No tickets found.</small></div>')}function ticketReply(reply,element){$(element).append('<small class="float-end">'+formatDate(reply["created_at"],2)+'</small><span class="chip-card '+(reply["external"]?"chip-blue":"")+'">'+(reply["external"]?"Customer":"Staff")+'</span><div class="paper small mb-3 mt-2 p-3" style="background: #f4f6f8;">'+escapeHtml(reply["message"])+"</div>")}var tickets={init:function(){tickets.loadTickets();$(".tickets").on("click",".view-ticket-action",function(e,s){$('#updateOrCreateTicketModal form input[name="_method"]').val("PUT");let form=$(this);var actionUrl=$("#updateOrCreateTicketModal form").data("update-action");actionUrl=actionUrl.substr(0,actionUrl.lastIndexOf("/")+1);actionUrl+=$(this).data("ticket-id");$("#updateOrCreateTicketModal form").attr("action",actionUrl);tickets.loadTicket($(this).data("ticket-id"))}).on("click",".create-ticket-action",function(e,s){$("#updateOrCreateTicketModal form").attr("action",$("#updateOrCreateTicketModal form").data("create-action"));$('#updateOrCreateTicketModal form input[name="_method"]').val("POST");tickets.createTicket()});$("#updateOrCreateTicketModal form").submit(function(e){e.preventDefault();let modelID=$(".modal.show");$("#updateOrCreateTicketModal").modal("hide");$(".processing-disabled").removeClass("processing-disabled").addClass("processing-blocker");let form=$(this);var actionUrl=form.attr("action");let method=form.find('input[name="_method"]').attr("value")||"POST";$(".abuseType").addClass("d-none");if(/(abuse|dmca)/.test($("textarea").val().toLowerCase())){new bootstrap.Modal(modelID).show();$(".abuseType").removeClass("d-none");setTimeout(function(){$(".processing-blocker").removeClass("processing-blocker").addClass("processing-disabled")},500);return true}$.ajax({type:method,url:actionUrl,dataType:"json",data:form.serialize(),success:function(data){if(data["success"]===true){tickets.loadTickets();tickets.loadTicket(data["ticket"]);setTimeout(function(){$(".processing-blocker").removeClass("processing-blocker").addClass("processing-disabled")},500)}else{new bootstrap.Modal(modelID).show();form.find("input").addClass("is-invalid");form.find(".invalid-feedback").text(data["message"]);setTimeout(function(){$(".processing-blocker").removeClass("processing-blocker").addClass("processing-disabled")},500)}},error:function(data){new bootstrap.Modal(modelID).show();form.find("input").addClass("is-invalid");form.find(".invalid-feedback").text(data.responseJSON&&"message"in data.responseJSON?data.responseJSON["message"]:"A network error has occurred.");setTimeout(function(){$(".processing-blocker").removeClass("processing-blocker").addClass("processing-disabled")},500)}})})},loadTickets:function(){$(".processing-disabled").removeClass("processing-disabled").addClass("processing-blocker");$.ajax({type:"GET",url:"/api2/tickets",data:{},success:function(response){$(".created-tickets, .answered-tickets, .closed-tickets").html("");!response["tickets"]["created"].length?ticketListEmpty($(".created-tickets")):"";!response["tickets"]["answered"].length?ticketListEmpty($(".answered-tickets")):"";!response["tickets"]["closed"].length?ticketListEmpty($(".closed-tickets")):"";$.each(response["tickets"]["created"],function(index,ticket){ticketListItem(ticket,$(".created-tickets"))});$.each(response["tickets"]["answered"],function(index,ticket){ticketListItem(ticket,$(".answered-tickets"))});$.each(response["tickets"]["closed"],function(index,ticket){ticketListItem(ticket,$(".closed-tickets"))});$(".created-tickets").append('<div class="col-12"> <hr class="mb-3 mb-3" style="height: 1px; background: rgb(209, 213, 219); opacity: 1;"> <div class="mx-3 mb-3 create-ticket-action" style="color: rgb(101, 116, 139)" role="button">Create new ticket</div> </div>');setTimeout(function(){$(".processing-blocker").removeClass("processing-blocker").addClass("processing-disabled")},500)}})},loadTicket:function(id){$(".processing-disabled").removeClass("processing-disabled").addClass("processing-blocker");$('#updateOrCreateTicketModal input[name="id"]').val("");$('#updateOrCreateTicketModal input[name="title"]').val("").focus();$('#updateOrCreateTicketModal textarea[name="message"]').val("").focus();$("#updateOrCreateTicketModal .ticket-replies").html("");$(".ticket-category, .ticket-created_at, .ticket-updated_at, .ticket-id, .ticket-status").text("%");new bootstrap.Modal($("#updateOrCreateTicketModal")).show();$.ajax({type:"GET",url:"/api2/ticket/"+id,data:{id:id},success:function(response){$('#updateOrCreateTicketModal input[name="id"]').val(response["ticket"]["id"]);$.each(response["replies"],function(index,reply){ticketReply(reply,$(".ticket-replies"))});$(".ticket-category").text(response["ticket"]["category"]);$(".ticket-created_at").text(formatDate(response["ticket"]["created_at"],2));$(".ticket-updated_at").text(formatDate(response["ticket"]["updated_at"],2));$(".ticket-id").text(response["ticket"]["id"]).val(response["ticket"]["id"]);$(".ticket-status").text(response["ticket"]["status"]);$(".ticket-extra").html(response["ticket"]["extra"]);$(".modal-ticket-title").text(""+escapeHtml(response["ticket"]["title"])+"");$(".ticket-category-id, .ticket-title").hide(0);if(response["ticket"]["status"]==="Closed"){$(".ticket-message").hide(0)}else{$(".ticket-message").show(0)}setTimeout(function(){$(".processing-blocker").removeClass("processing-blocker").addClass("processing-disabled")},500)}})},createTicket:function(){$('#updateOrCreateTicketModal input[name="ticket_id"]').val("");$('#updateOrCreateTicketModal input[name="title"]').val("").focus();$('#updateOrCreateTicketModal textarea[name="message"]').val("").focus();$("#updateOrCreateTicketModal .ticket-replies").html("");$(".ticket-category, .ticket-created_at, .ticket-updated_at, .ticket-id, .ticket-status, .modal-ticket-title").text("%");$(".ticket-category-id, .ticket-title").show(0);new bootstrap.Modal($("#updateOrCreateTicketModal")).show()}};$(".manager-folders").on("click",".arrow-up, .arrow-down",function(e,s){var folder=this;if($(folder).hasClass("arrow-down")){$(folder).removeClass("arrow-down").addClass("arrow-up");$(folder).parent().removeClass("opened-folder").removeClass("gradient-animation");$(folder).parent().parent().find("ul").remove();$(folder).parent().find(".folder-title").removeClass("fw-bold");return}else if($(folder).hasClass("arrow-up")){$(folder).parent().addClass("opened-folder").addClass("gradient-animation");$(".manager-folders > li > div.opened-folder").addClass("gradient-animation");$(folder).removeClass("arrow-up").addClass("arrow-down")}$(folder).parent().find(".folder-title").addClass("fw-bold");$.ajax({type:"GET",url:"/api2/folders",data:$.param({folderID:$(folder).parent().parent().attr("data-folder-id")}),success:function(response){$(folder).parent().parent().find("ul").remove();var childList=$('<ul class="mt-1"></ul>').appendTo($(folder).parent().parent());$.each(response["folders"],function(index,folder){if(response["childFolders"].includes(folder["fld_id"])){addChildFolderHTML(folder,1,childList)}else{addChildFolderHTML(folder,0,childList)}});droppableSection();setTimeout(function(){$(".manager-folders div.gradient-animation").removeClass("gradient-animation")},1e3)}})});function droppableSection(){$(".manager-folders div[data-href]").droppable({accept:".draggingContainer, .file-list-row, .draggableItem",classes:{"ui-droppable-active":"ui-state-highlight"},drop:function(event,ui){var processingFileIDs=$(ui.helper).attr("data-file-ids");var folderID=$(this).parent().attr("data-folder-id");if(processingFileIDs==null||folderID==null||typeof processingFileIDs=="undefined"){processingFileIDs=$(ui.draggable).parent().parent().parent().parent().parent().attr("data-file-id")}$(this).addClass("ui-state-highlight");var fileIDs=[];$.each(processingFileIDs.split(","),function(key,val){if(!val){return}console.log('.manager-files .file-list-row[data-file-id="'+val+'"]');$('.manager-files .file-list-row[data-file-id="'+val+'"]').fadeOut(150);fileIDs.push(val)});$.ajax({type:"PUT",headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},url:"/api2/folder/"+folderID+"/files",data:{fld_id:folderID,file_ids:fileIDs},success:function(response){$(".manager .file-list-row .select-row").removeClass("ui-selected").parent().find(".draggableItem").removeClass("active");$(".select-all").prop("checked",false);manager.loadFiles()},error:function(data){}})}})}$("#createFolderModal form, #renameFolderModal form, #deleteFolderModal form, #deleteFileModal form, #informationFileModal form.update-file-details-action, #cloneFileModal form").submit(function(e){e.preventDefault();let modelID=$(".modal.show");$("#createFolderModal, #renameFolderModal, #deleteFolderModal, #deleteFileModal, #informationFileModal, #cloneFileModal").modal("hide");$(".processing-disabled").removeClass("processing-disabled").addClass("processing-blocker");let form=$(this);var actionUrl=form.attr("action");let method=form.find('input[name="_method"]').attr("value")||"POST";var type=form.find('input[name="fld_id"]').val()||form.find('input[name="fld_parent_id"]').val()?"folder":"file";if(method==="PUT"||method==="DELETE"){actionUrl=actionUrl.substr(0,actionUrl.lastIndexOf("/")+1);actionUrl+=form.find('input[name="fld_id"]').val()||form.find('input[name="file_id"]').val()||0}$.ajax({type:method,url:actionUrl,dataType:"json",data:form.serialize(),success:function(data){if(data["success"]===true){type==="folder"?manager.loadFolders():manager.loadFiles();setTimeout(function(){$(".processing-blocker").removeClass("processing-blocker").addClass("processing-disabled")},500)}else{new bootstrap.Modal(modelID).show();form.find("input").addClass("is-invalid");form.find(".invalid-feedback").text(data["message"]);setTimeout(function(){$(".processing-blocker").removeClass("processing-blocker").addClass("processing-disabled")},500)}},error:function(data){new bootstrap.Modal(modelID).show();form.find("input").addClass("is-invalid");form.find(".invalid-feedback").text(data.responseJSON&&"message"in data.responseJSON?data.responseJSON["message"]:"A network error has occurred.");setTimeout(function(){$(".processing-blocker").removeClass("processing-blocker").addClass("processing-disabled")},500)}})});(function(){$("form.abuse").submit(function(e){e.preventDefault();var valid=true;if($('form.abuse textarea[name="links"]').val().length<=1){$('form.abuse textarea[name="links"]').addClass("border border-danger");valid=false}$.each($('form.abuse textarea[name="links"]').val().split(/\r?\n/),function(index,line){if(!line.trim().match(/https?:\/\/(www\.)?[-a-zA-Z0-9@:%._\+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b([-a-zA-Z0-9()@:%_\+.~#?&//=]*)/)){$('form.abuse textarea[name="links"]').addClass("border border-danger");valid=false}});if($('form.abuse input[name="name"]').val().trim().length<=2){$('form.abuse input[name="name"]').addClass("border border-danger");valid=false}if(!$('form.abuse input[name="legalConfirmation1"]').prop("checked")||!$('form.abuse input[name="legalConfirmation2"]').prop("checked")||!$('form.abuse input[name="legalConfirmation3"]').prop("checked")){$('form.abuse input[name="legalConfirmation1"]').parent().addClass("border border-danger");$('form.abuse input[name="legalConfirmation2"]').parent().addClass("border border-danger");$('form.abuse input[name="legalConfirmation3"]').parent().addClass("border border-danger");valid=false}if($('form.abuse input[name="email"]').val().trim().length<6||!$('form.abuse input[name="email"]').val().trim().match(/^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/)){$('form.abuse input[name="email"]').addClass("border border-danger");valid=false}if($('form.abuse input[name="city"]').val().trim().length<=2){$('form.abuse input[name="city"]').addClass("border border-danger");valid=false}if(!valid){return false}$("form.abuse section").hide(0,function(){});$("#send").fadeIn("fast",function(){$("html, body").animate({scrollTop:0},"fast");setTimeout(function(){$.ajax({type:"POST",url:"/engine/abuse",data:$("form.abuse").serialize(),success:function(response){if(response["success"]){$("#send").hide(0,function(){$("#sent").fadeIn("slow",function(){$(".contactRecord").text("#"+response["abuse"]);$(".urls").text(response["urls"])})})}else{$("#send").hide(0,function(){$("form.abuse section:not(#send, #sent, #error)").fadeIn("slow",function(){});$("form.abuse").prepend('<div class="alert alert-primary d-flex align-items-center" role="alert"><div>'+response["message"]+"</div> </div>")})}},error:function(){$("#send").hide(0,function(){$("#error").fadeIn("slow",function(){})})}})},2e3)})});$(".resetAbuseForm").click(function(){$("form.abuse section:not(#send, #sent, #error)").fadeIn("slow",function(){});$("form.abuse section#send, form.abuse section#sent, form.abuse section#error").hide();$(".contactRecord, .urls").text("");$('form.abuse textarea[name="links"]').val("");$('form.abuse input[name="legalConfirmation1"]').prop("checked",false);$('form.abuse input[name="legalConfirmation2"]').prop("checked",false);$('form.abuse input[name="legalConfirmation3"]').prop("checked",false)})})();(function(factory){if(typeof define==="function"&&define.amd){define(["jquery"],factory)}else if(typeof exports==="object"){factory(require("jquery"))}else{factory(jQuery)}})(function($){"use strict";$.support.htmlMenuitem="HTMLMenuItemElement"in window;$.support.htmlCommand="HTMLCommandElement"in window;$.support.eventSelectstart="onselectstart"in document.documentElement;if(!$.ui||!$.widget){$.cleanData=function(orig){return function(elems){var events,elem,i;for(i=0;elems[i]!=null;i++){elem=elems[i];try{events=$._data(elem,"events");if(events&&events.remove){$(elem).triggerHandler("remove")}}catch(e){}}orig(elems)}}($.cleanData)}var $currentTrigger=null,initialized=false,$win=$(window),counter=0,namespaces={},menus={},types={},defaults={selector:null,appendTo:null,trigger:"right",autoHide:false,delay:200,reposition:true,hideOnSecondTrigger:false,selectableSubMenu:false,classNames:{hover:"context-menu-hover",disabled:"context-menu-disabled",visible:"context-menu-visible",notSelectable:"context-menu-not-selectable",icon:"context-menu-icon",iconEdit:"context-menu-icon-edit",iconCut:"context-menu-icon-cut",iconCopy:"context-menu-icon-copy",iconPaste:"context-menu-icon-paste",iconDelete:"context-menu-icon-delete",iconAdd:"context-menu-icon-add",iconQuit:"context-menu-icon-quit",iconLoadingClass:"context-menu-icon-loading"},determinePosition:function($menu){if($.ui&&$.ui.position){$menu.css("display","block").position({my:"center top",at:"center bottom",of:this,offset:"0 5",collision:"fit"}).css("display","none")}else{var offset=this.offset();offset.top+=this.outerHeight();offset.left+=this.outerWidth()/2-$menu.outerWidth()/2;$menu.css(offset)}},position:function(opt,x,y){var offset;if(!x&&!y){opt.determinePosition.call(this,opt.$menu);return}else if(x==="maintain"&&y==="maintain"){offset=opt.$menu.position()}else{var offsetParentOffset=opt.$menu.offsetParent().offset();offset={top:y-offsetParentOffset.top,left:x-offsetParentOffset.left}}var bottom=$win.scrollTop()+$win.height(),right=$win.scrollLeft()+$win.width(),height=opt.$menu.outerHeight(),width=opt.$menu.outerWidth();if(offset.top+height>bottom){offset.top-=height}if(offset.top<0){offset.top=0}if(offset.left+width>right){offset.left-=width}if(offset.left<0){offset.left=0}opt.$menu.css(offset)},positionSubmenu:function($menu){if(typeof $menu==="undefined"){return}if($.ui&&$.ui.position){$menu.css("display","block").position({my:"left top-5",at:"right top",of:this,collision:"flipfit fit"}).css("display","")}else{var offset={top:-9,left:this.outerWidth()-5};$menu.css(offset)}},zIndex:1,animation:{duration:50,show:"slideDown",hide:"slideUp"},events:{preShow:$.noop,show:$.noop,hide:$.noop,activated:$.noop},callback:null,items:{}},hoveract={timer:null,pageX:null,pageY:null},zindex=function($t){var zin=0,$tt=$t;while(true){console.log($tt);console.log(zin);console.log($tt.css("z-index"));zin=Math.max(zin,parseInt($tt.css("z-index"),10)||0);$tt=$tt.parent();if(!$tt||!$tt.length||"html body".indexOf($tt.prop("nodeName").toLowerCase())>-1){break}}zin=50;console.log(zin);return zin},handle={abortevent:function(e){e.preventDefault();e.stopImmediatePropagation()},contextmenu:function(e){var $this=$(this);if(e.data.events.preShow($this,e)===false){return}if(e.data.trigger==="right"){e.preventDefault();e.stopImmediatePropagation()}if(e.data.trigger!=="right"&&e.data.trigger!=="demand"&&e.originalEvent){return}if(typeof e.mouseButton!=="undefined"&&e.data){if(!(e.data.trigger==="left"&&e.mouseButton===0)&&!(e.data.trigger==="right"&&e.mouseButton===2)){return}}if($this.hasClass("context-menu-active")){return}if(!$this.hasClass("context-menu-disabled")){$currentTrigger=$this;if(e.data.build){var built=e.data.build($currentTrigger,e);if(built===false){return}e.data=$.extend(true,{},defaults,e.data,built||{});if(!e.data.items||$.isEmptyObject(e.data.items)){if(window.console){(console.error||console.log).call(console,"No items specified to show in contextMenu")}throw new Error("No Items specified")}e.data.$trigger=$currentTrigger;op.create(e.data)}op.show.call($this,e.data,e.pageX,e.pageY)}},click:function(e){e.preventDefault();e.stopImmediatePropagation();$(this).trigger($.Event("contextmenu",{data:e.data,pageX:e.pageX,pageY:e.pageY}))},mousedown:function(e){var $this=$(this);if($currentTrigger&&$currentTrigger.length&&!$currentTrigger.is($this)){$currentTrigger.data("contextMenu").$menu.trigger("contextmenu:hide")}if(e.button===2){$currentTrigger=$this.data("contextMenuActive",true)}},mouseup:function(e){var $this=$(this);if($this.data("contextMenuActive")&&$currentTrigger&&$currentTrigger.length&&$currentTrigger.is($this)&&!$this.hasClass("context-menu-disabled")){e.preventDefault();e.stopImmediatePropagation();$currentTrigger=$this;$this.trigger($.Event("contextmenu",{data:e.data,pageX:e.pageX,pageY:e.pageY}))}$this.removeData("contextMenuActive")},mouseenter:function(e){var $this=$(this),$related=$(e.relatedTarget),$document=$(document);if($related.is(".context-menu-list")||$related.closest(".context-menu-list").length){return}if($currentTrigger&&$currentTrigger.length){return}hoveract.pageX=e.pageX;hoveract.pageY=e.pageY;hoveract.data=e.data;$document.on("mousemove.contextMenuShow",handle.mousemove);hoveract.timer=setTimeout(function(){hoveract.timer=null;$document.off("mousemove.contextMenuShow");$currentTrigger=$this;$this.trigger($.Event("contextmenu",{data:hoveract.data,pageX:hoveract.pageX,pageY:hoveract.pageY}))},e.data.delay)},mousemove:function(e){hoveract.pageX=e.pageX;hoveract.pageY=e.pageY},mouseleave:function(e){var $related=$(e.relatedTarget);if($related.is(".context-menu-list")||$related.closest(".context-menu-list").length){return}try{clearTimeout(hoveract.timer)}catch(e){}hoveract.timer=null},layerClick:function(e){var $this=$(this),root=$this.data("contextMenuRoot"),button=e.button,x=e.pageX,y=e.pageY,fakeClick=x===undefined,target,offset;e.preventDefault();setTimeout(function(){if(fakeClick){if(root!==null&&typeof root!=="undefined"&&root.$menu!==null&&typeof root.$menu!=="undefined"){root.$menu.trigger("contextmenu:hide")}return}var $window;var triggerAction=root.trigger==="left"&&button===0||root.trigger==="right"&&button===2;if(document.elementFromPoint&&root.$layer){root.$layer.hide();target=document.elementFromPoint(x-$win.scrollLeft(),y-$win.scrollTop());if(target!==null&&target.isContentEditable){var range=document.createRange(),sel=window.getSelection();range.selectNode(target);range.collapse(true);sel.removeAllRanges();sel.addRange(range)}$(target).trigger(e);root.$layer.show()}if(root.hideOnSecondTrigger&&triggerAction&&root.$menu!==null&&typeof root.$menu!=="undefined"){root.$menu.trigger("contextmenu:hide");return}if(root.reposition&&triggerAction){if(document.elementFromPoint){if(root.$trigger.is(target)){root.position.call(root.$trigger,root,x,y);return}}else{offset=root.$trigger.offset();$window=$(window);offset.top+=$window.scrollTop();if(offset.top<=e.pageY){offset.left+=$window.scrollLeft();if(offset.left<=e.pageX){offset.bottom=offset.top+root.$trigger.outerHeight();if(offset.bottom>=e.pageY){offset.right=offset.left+root.$trigger.outerWidth();if(offset.right>=e.pageX){root.position.call(root.$trigger,root,x,y);return}}}}}}if(target&&triggerAction){root.$trigger.one("contextmenu:hidden",function(){$(target).contextMenu({x:x,y:y,button:button})})}if(root!==null&&typeof root!=="undefined"&&root.$menu!==null&&typeof root.$menu!=="undefined"){root.$menu.trigger("contextmenu:hide")}},50)},keyStop:function(e,opt){if(!opt.isInput){e.preventDefault()}e.stopPropagation()},key:function(e){var opt={};if($currentTrigger){opt=$currentTrigger.data("contextMenu")||{}}if(typeof opt.zIndex==="undefined"){opt.zIndex=0}var targetZIndex=0;var getZIndexOfTriggerTarget=function(target){if(target.style.zIndex!==""){targetZIndex=target.style.zIndex}else{if(target.offsetParent!==null&&typeof target.offsetParent!=="undefined"){getZIndexOfTriggerTarget(target.offsetParent)}else if(target.parentElement!==null&&typeof target.parentElement!=="undefined"){getZIndexOfTriggerTarget(target.parentElement)}}};getZIndexOfTriggerTarget(e.target);if(opt.$menu&&parseInt(targetZIndex,10)>parseInt(opt.$menu.css("zIndex"),10)){return}switch(e.keyCode){case 9:case 38:handle.keyStop(e,opt);if(opt.isInput){if(e.keyCode===9&&e.shiftKey){e.preventDefault();if(opt.$selected){opt.$selected.find("input, textarea, select").blur()}if(opt.$menu!==null&&typeof opt.$menu!=="undefined"){opt.$menu.trigger("prevcommand")}return}else if(e.keyCode===38&&opt.$selected.find("input, textarea, select").prop("type")==="checkbox"){e.preventDefault();return}}else if(e.keyCode!==9||e.shiftKey){if(opt.$menu!==null&&typeof opt.$menu!=="undefined"){opt.$menu.trigger("prevcommand")}return}break;case 40:handle.keyStop(e,opt);if(opt.isInput){if(e.keyCode===9){e.preventDefault();if(opt.$selected){opt.$selected.find("input, textarea, select").blur()}if(opt.$menu!==null&&typeof opt.$menu!=="undefined"){opt.$menu.trigger("nextcommand")}return}else if(e.keyCode===40&&opt.$selected.find("input, textarea, select").prop("type")==="checkbox"){e.preventDefault();return}}else{if(opt.$menu!==null&&typeof opt.$menu!=="undefined"){opt.$menu.trigger("nextcommand")}return}break;case 37:handle.keyStop(e,opt);if(opt.isInput||!opt.$selected||!opt.$selected.length){break}if(!opt.$selected.parent().hasClass("context-menu-root")){var $parent=opt.$selected.parent().parent();opt.$selected.trigger("contextmenu:blur");opt.$selected=$parent;return}break;case 39:handle.keyStop(e,opt);if(opt.isInput||!opt.$selected||!opt.$selected.length){break}var itemdata=opt.$selected.data("contextMenu")||{};if(itemdata.$menu&&opt.$selected.hasClass("context-menu-submenu")){opt.$selected=null;itemdata.$selected=null;itemdata.$menu.trigger("nextcommand");return}break;case 35:case 36:if(opt.$selected&&opt.$selected.find("input, textarea, select").length){return}else{(opt.$selected&&opt.$selected.parent()||opt.$menu).children(":not(."+opt.classNames.disabled+", ."+opt.classNames.notSelectable+")")[e.keyCode===36?"first":"last"]().trigger("contextmenu:focus");e.preventDefault();return}break;case 13:handle.keyStop(e,opt);if(opt.isInput){if(opt.$selected&&!opt.$selected.is("textarea, select")){e.preventDefault();return}break}if(typeof opt.$selected!=="undefined"&&opt.$selected!==null){opt.$selected.trigger("mouseup")}return;case 32:case 33:case 34:handle.keyStop(e,opt);return;case 27:handle.keyStop(e,opt);if(opt.$menu!==null&&typeof opt.$menu!=="undefined"){opt.$menu.trigger("contextmenu:hide")}return;default:var k=String.fromCharCode(e.keyCode).toUpperCase();if(opt.accesskeys&&opt.accesskeys[k]){opt.accesskeys[k].$node.trigger(opt.accesskeys[k].$menu?"contextmenu:focus":"mouseup");return}break}e.stopPropagation();if(typeof opt.$selected!=="undefined"&&opt.$selected!==null){opt.$selected.trigger(e)}},prevItem:function(e){e.stopPropagation();var opt=$(this).data("contextMenu")||{};var root=$(this).data("contextMenuRoot")||{};if(opt.$selected){var $s=opt.$selected;opt=opt.$selected.parent().data("contextMenu")||{};opt.$selected=$s}var $children=opt.$menu.children(),$prev=!opt.$selected||!opt.$selected.prev().length?$children.last():opt.$selected.prev(),$round=$prev;while($prev.hasClass(root.classNames.disabled)||$prev.hasClass(root.classNames.notSelectable)||$prev.is(":hidden")){if($prev.prev().length){$prev=$prev.prev()}else{$prev=$children.last()}if($prev.is($round)){return}}if(opt.$selected){handle.itemMouseleave.call(opt.$selected.get(0),e)}handle.itemMouseenter.call($prev.get(0),e);var $input=$prev.find("input, textarea, select");if($input.length){$input.focus()}},nextItem:function(e){e.stopPropagation();var opt=$(this).data("contextMenu")||{};var root=$(this).data("contextMenuRoot")||{};if(opt.$selected){var $s=opt.$selected;opt=opt.$selected.parent().data("contextMenu")||{};opt.$selected=$s}var $children=opt.$menu.children(),$next=!opt.$selected||!opt.$selected.next().length?$children.first():opt.$selected.next(),$round=$next;while($next.hasClass(root.classNames.disabled)||$next.hasClass(root.classNames.notSelectable)||$next.is(":hidden")){if($next.next().length){$next=$next.next()}else{$next=$children.first()}if($next.is($round)){return}}if(opt.$selected){handle.itemMouseleave.call(opt.$selected.get(0),e)}handle.itemMouseenter.call($next.get(0),e);var $input=$next.find("input, textarea, select");if($input.length){$input.focus()}},focusInput:function(){var $this=$(this).closest(".context-menu-item"),data=$this.data(),opt=data.contextMenu,root=data.contextMenuRoot;root.$selected=opt.$selected=$this;root.isInput=opt.isInput=true},blurInput:function(){var $this=$(this).closest(".context-menu-item"),data=$this.data(),opt=data.contextMenu,root=data.contextMenuRoot;root.isInput=opt.isInput=false},menuMouseenter:function(){var root=$(this).data().contextMenuRoot;root.hovering=true},menuMouseleave:function(e){var root=$(this).data().contextMenuRoot;if(root.$layer&&root.$layer.is(e.relatedTarget)){root.hovering=false}},itemMouseenter:function(e){var $this=$(this),data=$this.data(),opt=data.contextMenu,root=data.contextMenuRoot;root.hovering=true;if(e&&root.$layer&&root.$layer.is(e.relatedTarget)){e.preventDefault();e.stopImmediatePropagation()}(opt.$menu?opt:root).$menu.children("."+root.classNames.hover).trigger("contextmenu:blur").children(".hover").trigger("contextmenu:blur");if($this.hasClass(root.classNames.disabled)||$this.hasClass(root.classNames.notSelectable)){opt.$selected=null;return}$this.trigger("contextmenu:focus")},itemMouseleave:function(e){var $this=$(this),data=$this.data(),opt=data.contextMenu,root=data.contextMenuRoot;if(root!==opt&&root.$layer&&root.$layer.is(e.relatedTarget)){if(typeof root.$selected!=="undefined"&&root.$selected!==null){root.$selected.trigger("contextmenu:blur")}e.preventDefault();e.stopImmediatePropagation();root.$selected=opt.$selected=opt.$node;return}if(opt&&opt.$menu&&opt.$menu.hasClass("context-menu-visible")){return}$this.trigger("contextmenu:blur")},itemClick:function(e){var $this=$(this),data=$this.data(),opt=data.contextMenu,root=data.contextMenuRoot,key=data.contextMenuKey,callback;if(!opt.items[key]||$this.is("."+root.classNames.disabled+", .context-menu-separator, ."+root.classNames.notSelectable)||$this.is(".context-menu-submenu")&&root.selectableSubMenu===false){return}e.preventDefault();e.stopImmediatePropagation();if($.isFunction(opt.callbacks[key])&&Object.prototype.hasOwnProperty.call(opt.callbacks,key)){callback=opt.callbacks[key]}else if($.isFunction(root.callback)){callback=root.callback}else{return}if(callback.call(root.$trigger,key,root,e)!==false){root.$menu.trigger("contextmenu:hide")}else if(root.$menu.parent().length){op.update.call(root.$trigger,root)}},inputClick:function(e){e.stopImmediatePropagation()},hideMenu:function(e,data){var root=$(this).data("contextMenuRoot");op.hide.call(root.$trigger,root,data&&data.force)},focusItem:function(e){e.stopPropagation();var $this=$(this),data=$this.data(),opt=data.contextMenu,root=data.contextMenuRoot;if($this.hasClass(root.classNames.disabled)||$this.hasClass(root.classNames.notSelectable)){return}$this.addClass([root.classNames.hover,root.classNames.visible].join(" ")).parent().find(".context-menu-item").not($this).removeClass(root.classNames.visible).filter("."+root.classNames.hover).trigger("contextmenu:blur");opt.$selected=root.$selected=$this;if(opt&&opt.$node&&opt.$node.hasClass("context-menu-submenu")){opt.$node.addClass(root.classNames.hover)}if(opt.$node){root.positionSubmenu.call(opt.$node,opt.$menu)}},blurItem:function(e){e.stopPropagation();var $this=$(this),data=$this.data(),opt=data.contextMenu,root=data.contextMenuRoot;if(opt.autoHide){$this.removeClass(root.classNames.visible)}$this.removeClass(root.classNames.hover);opt.$selected=null}},op={show:function(opt,x,y){var $trigger=$(this),css={};$("#context-menu-layer").trigger("mousedown");opt.$trigger=$trigger;if(opt.events.show.call($trigger,opt)===false){$currentTrigger=null;return}var hasVisibleItems=op.update.call($trigger,opt);if(hasVisibleItems===false){$currentTrigger=null;return}opt.position.call($trigger,opt,x,y);if(opt.zIndex){var additionalZValue=opt.zIndex;if(typeof opt.zIndex==="function"){additionalZValue=opt.zIndex.call($trigger,opt)}css.zIndex=zindex($trigger)+additionalZValue}op.layer.call(opt.$menu,opt,css.zIndex);opt.$menu.find("ul").css("zIndex",css.zIndex+1);opt.$menu.css(css)[opt.animation.show](opt.animation.duration,function(){$trigger.trigger("contextmenu:visible");op.activated(opt);opt.events.activated(opt)});$trigger.data("contextMenu",opt).addClass("context-menu-active");$(document).off("keydown.contextMenu").on("keydown.contextMenu",handle.key);if(opt.autoHide){$(document).on("mousemove.contextMenuAutoHide",function(e){var pos=$trigger.offset();pos.right=pos.left+$trigger.outerWidth();pos.bottom=pos.top+$trigger.outerHeight();if(opt.$layer&&!opt.hovering&&(!(e.pageX>=pos.left&&e.pageX<=pos.right)||!(e.pageY>=pos.top&&e.pageY<=pos.bottom))){setTimeout(function(){if(!opt.hovering&&opt.$menu!==null&&typeof opt.$menu!=="undefined"){opt.$menu.trigger("contextmenu:hide")}},50)}})}},hide:function(opt,force){var $trigger=$(this);if(!opt){opt=$trigger.data("contextMenu")||{}}if(!force&&opt.events&&opt.events.hide.call($trigger,opt)===false){return}$trigger.removeData("contextMenu").removeClass("context-menu-active");if(opt.$layer){setTimeout(function($layer){return function(){$layer.remove()}}(opt.$layer),10);try{delete opt.$layer}catch(e){opt.$layer=null}}$currentTrigger=null;opt.$menu.find("."+opt.classNames.hover).trigger("contextmenu:blur");opt.$selected=null;opt.$menu.find("."+opt.classNames.visible).removeClass(opt.classNames.visible);$(document).off(".contextMenuAutoHide").off("keydown.contextMenu");if(opt.$menu){opt.$menu[opt.animation.hide](opt.animation.duration,function(){if(opt.build){opt.$menu.remove();$.each(opt,function(key){switch(key){case"ns":case"selector":case"build":case"trigger":return true;default:opt[key]=undefined;try{delete opt[key]}catch(e){}return true}})}setTimeout(function(){$trigger.trigger("contextmenu:hidden")},10)})}},create:function(opt,root){if(typeof root==="undefined"){root=opt}opt.$menu=$('<ul class="context-menu-list"></ul>').addClass(opt.className||"").data({contextMenu:opt,contextMenuRoot:root});if(opt.dataAttr){$.each(opt.dataAttr,function(key,item){opt.$menu.attr("data-"+opt.key,item)})}$.each(["callbacks","commands","inputs"],function(i,k){opt[k]={};if(!root[k]){root[k]={}}});if(!root.accesskeys){root.accesskeys={}}function createNameNode(item){var $name=$("<span></span>");if(item._accesskey){if(item._beforeAccesskey){$name.append(document.createTextNode(item._beforeAccesskey))}$("<span></span>").addClass("context-menu-accesskey").text(item._accesskey).appendTo($name);if(item._afterAccesskey){$name.append(document.createTextNode(item._afterAccesskey))}}else{if(item.isHtmlName){if(typeof item.accesskey!=="undefined"){throw new Error("accesskeys are not compatible with HTML names and cannot be used together in the same item")}$name.html(item.name)}else{$name.text(item.name)}}return $name}$.each(opt.items,function(key,item){var $t=$('<li class="context-menu-item"></li>').addClass(item.className||""),$label=null,$input=null;$t.on("click",$.noop);if(typeof item==="string"||item.type==="cm_separator"){item={type:"cm_seperator"}}item.$node=$t.data({contextMenu:opt,contextMenuRoot:root,contextMenuKey:key});if(typeof item.accesskey!=="undefined"){var aks=splitAccesskey(item.accesskey);for(var i=0,ak;ak=aks[i];i++){if(!root.accesskeys[ak]){root.accesskeys[ak]=item;var matched=item.name.match(new RegExp("^(.*?)("+ak+")(.*)$","i"));if(matched){item._beforeAccesskey=matched[1];item._accesskey=matched[2];item._afterAccesskey=matched[3]}break}}}if(item.type&&types[item.type]){types[item.type].call($t,item,opt,root);$.each([opt,root],function(i,k){k.commands[key]=item;if($.isFunction(item.callback)&&(typeof k.callbacks[key]==="undefined"||typeof opt.type==="undefined")){k.callbacks[key]=item.callback}})}else{if(item.type==="cm_seperator"){$t.addClass("context-menu-separator "+root.classNames.notSelectable)}else if(item.type==="html"){$t.addClass("context-menu-html "+root.classNames.notSelectable)}else if(item.type!=="sub"&&item.type){$label=$("<label></label>").appendTo($t);createNameNode(item).appendTo($label);$t.addClass("context-menu-input");opt.hasTypes=true;$.each([opt,root],function(i,k){k.commands[key]=item;k.inputs[key]=item})}else if(item.items){item.type="sub"}switch(item.type){case"cm_seperator":break;case"text":$input=$('<input type="text" value="1" name="" />').attr("name","context-menu-input-"+key).val(item.value||"").appendTo($label);break;case"textarea":$input=$('<textarea name=""></textarea>').attr("name","context-menu-input-"+key).val(item.value||"").appendTo($label);if(item.height){$input.height(item.height)}break;case"checkbox":$input=$('<input type="checkbox" value="1" name="" />').attr("name","context-menu-input-"+key).val(item.value||"").prop("checked",!!item.selected).prependTo($label);break;case"radio":$input=$('<input type="radio" value="1" name="" />').attr("name","context-menu-input-"+item.radio).val(item.value||"").prop("checked",!!item.selected).prependTo($label);break;case"select":$input=$('<select name=""></select>').attr("name","context-menu-input-"+key).appendTo($label);if(item.options){$.each(item.options,function(value,text){$("<option></option>").val(value).text(text).appendTo($input)});$input.val(item.selected)}break;case"sub":createNameNode(item).appendTo($t);item.appendTo=item.$node;$t.data("contextMenu",item).addClass("context-menu-submenu");item.callback=null;if("function"===typeof item.items.then){op.processPromises(item,root,item.items)}else{op.create(item,root)}break;case"html":$(item.html).appendTo($t);break;default:$.each([opt,root],function(i,k){k.commands[key]=item;if($.isFunction(item.callback)&&(typeof k.callbacks[key]==="undefined"||typeof opt.type==="undefined")){k.callbacks[key]=item.callback}});createNameNode(item).appendTo($t);break}if(item.type&&item.type!=="sub"&&item.type!=="html"&&item.type!=="cm_seperator"){$input.on("focus",handle.focusInput).on("blur",handle.blurInput);if(item.events){$input.on(item.events,opt)}}if(item.icon){if($.isFunction(item.icon)){item._icon=item.icon.call(this,this,$t,key,item)}else{if(typeof item.icon==="string"&&(item.icon.substring(0,4)==="fab "||item.icon.substring(0,4)==="fas "||item.icon.substring(0,4)==="fad "||item.icon.substring(0,4)==="far "||item.icon.substring(0,4)==="fal ")){$t.addClass(root.classNames.icon+" "+root.classNames.icon+"--fa5");item._icon=$('<i class="'+item.icon+'"></i>')}else if(typeof item.icon==="string"&&item.icon.substring(0,3)==="fa-"){item._icon=root.classNames.icon+" "+root.classNames.icon+"--fa fa "+item.icon}else{item._icon=root.classNames.icon+" "+root.classNames.icon+"-"+item.icon}}if(typeof item._icon==="string"){$t.addClass(item._icon)}else{$t.prepend(item._icon)}}}item.$input=$input;item.$label=$label;$t.appendTo(opt.$menu);if(!opt.hasTypes&&$.support.eventSelectstart){$t.on("selectstart.disableTextSelect",handle.abortevent)}});if(!opt.$node){opt.$menu.css("display","none").addClass("context-menu-root")}opt.$menu.appendTo(opt.appendTo||document.body)},resize:function($menu,nested){var domMenu;$menu.css({position:"absolute",display:"block"});$menu.data("width",(domMenu=$menu.get(0)).getBoundingClientRect?Math.ceil(domMenu.getBoundingClientRect().width):$menu.outerWidth()+1);$menu.css({position:"static",minWidth:"0px",maxWidth:"100000px"});$menu.find("> li > ul").each(function(){op.resize($(this),true)});if(!nested){$menu.find("ul").addBack().css({position:"",display:"",minWidth:"",maxWidth:""}).outerWidth(function(){return $(this).data("width")})}},update:function(opt,root){var $trigger=this;if(typeof root==="undefined"){root=opt;op.resize(opt.$menu)}var hasVisibleItems=false;opt.$menu.children().each(function(){var $item=$(this),key=$item.data("contextMenuKey"),item=opt.items[key],disabled=$.isFunction(item.disabled)&&item.disabled.call($trigger,key,root)||item.disabled===true,visible;if($.isFunction(item.visible)){visible=item.visible.call($trigger,key,root)}else if(typeof item.visible!=="undefined"){visible=item.visible===true}else{visible=true}if(visible){hasVisibleItems=true}$item[visible?"show":"hide"]();$item[disabled?"addClass":"removeClass"](root.classNames.disabled);if($.isFunction(item.icon)){$item.removeClass(item._icon);var iconResult=item.icon.call(this,$trigger,$item,key,item);if(typeof iconResult==="string"){$item.addClass(iconResult)}else{$item.prepend(iconResult)}}if(item.type){$item.find("input, select, textarea").prop("disabled",disabled);switch(item.type){case"text":case"textarea":item.$input.val(item.value||"");break;case"checkbox":case"radio":item.$input.val(item.value||"").prop("checked",!!item.selected);break;case"select":item.$input.val((item.selected===0?"0":item.selected)||"");break}}if(item.$menu){var subMenuHasVisibleItems=op.update.call($trigger,item,root);if(subMenuHasVisibleItems){hasVisibleItems=true}}});return hasVisibleItems},layer:function(opt,zIndex){var $layer=opt.$layer=$('<div id="context-menu-layer"></div>').css({height:$win.height(),width:$win.width(),display:"block",position:"fixed","z-index":zIndex-1,top:0,left:0,opacity:0,filter:"alpha(opacity=0)","background-color":"#000"}).data("contextMenuRoot",opt).appendTo(document.body).on("contextmenu",handle.abortevent).on("mousedown",handle.layerClick);if(typeof document.body.style.maxWidth==="undefined"){$layer.css({position:"absolute",height:$(document).height()})}return $layer},processPromises:function(opt,root,promise){opt.$node.addClass(root.classNames.iconLoadingClass);function completedPromise(opt,root,items){if(typeof items==="undefined"){errorPromise(undefined)}finishPromiseProcess(opt,root,items)}function errorPromise(opt,root,errorItem){if(typeof errorItem==="undefined"){errorItem={error:{name:"No items and no error item",icon:"context-menu-icon context-menu-icon-quit"}};if(window.console){(console.error||console.log).call(console,'When you reject a promise, provide an "items" object, equal to normal sub-menu items')}}else if(typeof errorItem==="string"){errorItem={error:{name:errorItem}}}finishPromiseProcess(opt,root,errorItem)}function finishPromiseProcess(opt,root,items){if(typeof root.$menu==="undefined"||!root.$menu.is(":visible")){return}opt.$node.removeClass(root.classNames.iconLoadingClass);opt.items=items;op.create(opt,root,true);op.update(opt,root);root.positionSubmenu.call(opt.$node,opt.$menu)}promise.then(completedPromise.bind(this,opt,root),errorPromise.bind(this,opt,root))},activated:function(opt){var $menu=opt.$menu;var $menuOffset=$menu.offset();var winHeight=$(window).height();var winScrollTop=$(window).scrollTop();var menuHeight=$menu.height();if(menuHeight>winHeight){$menu.css({height:winHeight+"px","overflow-x":"hidden","overflow-y":"auto",top:winScrollTop+"px"})}else if($menuOffset.top<winScrollTop||$menuOffset.top+menuHeight>winScrollTop+winHeight){$menu.css({top:winScrollTop+"px"})}}};function splitAccesskey(val){var t=val.split(/\s+/);var keys=[];for(var i=0,k;k=t[i];i++){k=k.charAt(0).toUpperCase();keys.push(k)}return keys}$.fn.contextMenu=function(operation){var $t=this,$o=operation;if(this.length>0){if(typeof operation==="undefined"){this.first().trigger("contextmenu")}else if(typeof operation.x!=="undefined"&&typeof operation.y!=="undefined"){this.first().trigger($.Event("contextmenu",{pageX:operation.x,pageY:operation.y,mouseButton:operation.button}))}else if(operation==="hide"){var $menu=this.first().data("contextMenu")?this.first().data("contextMenu").$menu:null;if($menu){$menu.trigger("contextmenu:hide")}}else if(operation==="destroy"){$.contextMenu("destroy",{context:this})}else if($.isPlainObject(operation)){operation.context=this;$.contextMenu("create",operation)}else if(operation){this.removeClass("context-menu-disabled")}else if(!operation){this.addClass("context-menu-disabled")}}else{$.each(menus,function(){if(this.selector===$t.selector){$o.data=this;$.extend($o.data,{trigger:"demand"})}});handle.contextmenu.call($o.target,$o)}return this};$.contextMenu=function(operation,options){if(typeof operation!=="string"){options=operation;operation="create"}if(typeof options==="string"){options={selector:options}}else if(typeof options==="undefined"){options={}}var o=$.extend(true,{},defaults,options||{});var $document=$(document);var $context=$document;var _hasContext=false;if(!o.context||!o.context.length){o.context=document}else{$context=$(o.context).first();o.context=$context.get(0);_hasContext=!$(o.context).is(document)}switch(operation){case"update":if(_hasContext){op.update($context)}else{for(var menu in menus){if(menus.hasOwnProperty(menu)){op.update(menus[menu])}}}break;case"create":if(!o.selector){throw new Error("No selector specified")}if(o.selector.match(/.context-menu-(list|item|input)($|\s)/)){throw new Error('Cannot bind to selector "'+o.selector+'" as it contains a reserved className')}if(!o.build&&(!o.items||$.isEmptyObject(o.items))){throw new Error("No Items specified")}counter++;o.ns=".contextMenu"+counter;if(!_hasContext){namespaces[o.selector]=o.ns}menus[o.ns]=o;if(!o.trigger){o.trigger="right"}if(!initialized){var itemClick=o.itemClickEvent==="click"?"click.contextMenu":"mouseup.contextMenu";var contextMenuItemObj={"contextmenu:focus.contextMenu":handle.focusItem,"contextmenu:blur.contextMenu":handle.blurItem,"contextmenu.contextMenu":handle.abortevent,"mouseenter.contextMenu":handle.itemMouseenter,"mouseleave.contextMenu":handle.itemMouseleave};contextMenuItemObj[itemClick]=handle.itemClick;$document.on({"contextmenu:hide.contextMenu":handle.hideMenu,"prevcommand.contextMenu":handle.prevItem,"nextcommand.contextMenu":handle.nextItem,"contextmenu.contextMenu":handle.abortevent,"mouseenter.contextMenu":handle.menuMouseenter,"mouseleave.contextMenu":handle.menuMouseleave},".context-menu-list").on("mouseup.contextMenu",".context-menu-input",handle.inputClick).on(contextMenuItemObj,".context-menu-item");initialized=true}$context.on("contextmenu"+o.ns,o.selector,o,handle.contextmenu);if(_hasContext){$context.on("remove"+o.ns,function(){$(this).contextMenu("destroy")})}switch(o.trigger){case"hover":$context.on("mouseenter"+o.ns,o.selector,o,handle.mouseenter).on("mouseleave"+o.ns,o.selector,o,handle.mouseleave);break;case"left":$context.on("click"+o.ns,o.selector,o,handle.click);break;case"touchstart":$context.on("touchstart"+o.ns,o.selector,o,handle.click);break}if(!o.build){op.create(o)}break;case"destroy":var $visibleMenu;if(_hasContext){var context=o.context;$.each(menus,function(ns,o){if(!o){return true}if(!$(context).is(o.selector)){return true}$visibleMenu=$(".context-menu-list").filter(":visible");if($visibleMenu.length&&$visibleMenu.data().contextMenuRoot.$trigger.is($(o.context).find(o.selector))){$visibleMenu.trigger("contextmenu:hide",{force:true})}try{if(menus[o.ns].$menu){menus[o.ns].$menu.remove()}delete menus[o.ns]}catch(e){menus[o.ns]=null}$(o.context).off(o.ns);return true})}else if(!o.selector){$document.off(".contextMenu .contextMenuAutoHide");$.each(menus,function(ns,o){$(o.context).off(o.ns)});namespaces={};menus={};counter=0;initialized=false;$("#context-menu-layer, .context-menu-list").remove()}else if(namespaces[o.selector]){$visibleMenu=$(".context-menu-list").filter(":visible");if($visibleMenu.length&&$visibleMenu.data().contextMenuRoot.$trigger.is(o.selector)){$visibleMenu.trigger("contextmenu:hide",{force:true})}try{if(menus[namespaces[o.selector]].$menu){menus[namespaces[o.selector]].$menu.remove()}delete menus[namespaces[o.selector]]}catch(e){menus[namespaces[o.selector]]=null}$document.off(namespaces[o.selector])}break;case"html5":if(!$.support.htmlCommand&&!$.support.htmlMenuitem||typeof options==="boolean"&&options){$('menu[type="context"]').each(function(){if(this.id){$.contextMenu({selector:"[contextmenu="+this.id+"]",items:$.contextMenu.fromMenu(this)})}}).css("display","none")}break;default:throw new Error('Unknown operation "'+operation+'"')}return this};$.contextMenu.setInputValues=function(opt,data){if(typeof data==="undefined"){data={}}$.each(opt.inputs,function(key,item){switch(item.type){case"text":case"textarea":item.value=data[key]||"";break;case"checkbox":item.selected=data[key]?true:false;break;case"radio":item.selected=(data[item.radio]||"")===item.value;break;case"select":item.selected=data[key]||"";break}})};$.contextMenu.getInputValues=function(opt,data){if(typeof data==="undefined"){data={}}$.each(opt.inputs,function(key,item){switch(item.type){case"text":case"textarea":case"select":data[key]=item.$input.val();break;case"checkbox":data[key]=item.$input.prop("checked");break;case"radio":if(item.$input.prop("checked")){data[item.radio]=item.value}break}});return data};function inputLabel(node){return node.id&&$('label[for="'+node.id+'"]').val()||node.name}function menuChildren(items,$children,counter){if(!counter){counter=0}$children.each(function(){var $node=$(this),node=this,nodeName=this.nodeName.toLowerCase(),label,item;if(nodeName==="label"&&$node.find("input, textarea, select").length){label=$node.text();$node=$node.children().first();node=$node.get(0);nodeName=node.nodeName.toLowerCase()}switch(nodeName){case"menu":item={name:$node.attr("label"),items:{}};counter=menuChildren(item.items,$node.children(),counter);break;case"a":case"button":item={name:$node.text(),disabled:!!$node.attr("disabled"),callback:function(){return function(){$node.get(0).click()}}()};break;case"menuitem":case"command":switch($node.attr("type")){case undefined:case"command":case"menuitem":item={name:$node.attr("label"),disabled:!!$node.attr("disabled"),icon:$node.attr("icon"),callback:function(){return function(){$node.get(0).click()}}()};break;case"checkbox":item={type:"checkbox",disabled:!!$node.attr("disabled"),name:$node.attr("label"),selected:!!$node.attr("checked")};break;case"radio":item={type:"radio",disabled:!!$node.attr("disabled"),name:$node.attr("label"),radio:$node.attr("radiogroup"),value:$node.attr("id"),selected:!!$node.attr("checked")};break;default:item=undefined}break;case"hr":item="-------";break;case"input":switch($node.attr("type")){case"text":item={type:"text",name:label||inputLabel(node),disabled:!!$node.attr("disabled"),value:$node.val()};break;case"checkbox":item={type:"checkbox",name:label||inputLabel(node),disabled:!!$node.attr("disabled"),selected:!!$node.attr("checked")};break;case"radio":item={type:"radio",name:label||inputLabel(node),disabled:!!$node.attr("disabled"),radio:!!$node.attr("name"),value:$node.val(),selected:!!$node.attr("checked")};break;default:item=undefined;break}break;case"select":item={type:"select",name:label||inputLabel(node),disabled:!!$node.attr("disabled"),selected:$node.val(),options:{}};$node.children().each(function(){item.options[this.value]=$(this).text()});break;case"textarea":item={type:"textarea",name:label||inputLabel(node),disabled:!!$node.attr("disabled"),value:$node.val()};break;case"label":break;default:item={type:"html",html:$node.clone(true)};break}if(item){counter++;items["key"+counter]=item}});return counter}$.contextMenu.fromMenu=function(element){var $this=$(element),items={};menuChildren(items,$this.children());return items};$.contextMenu.defaults=defaults;$.contextMenu.types=types;$.contextMenu.handle=handle;$.contextMenu.op=op;$.contextMenu.menus=menus});var monetizationCheckbox=$('input[type="checkbox"][name="monetization_nsfw"]');var nsfwAds=$(".nsfw-ads");monetizationCheckbox.change(function(){nsfwAds.toggle(monetizationCheckbox.prop("checked")?true:false)});var navTabsLinks=$(".nav.nav-tabs a");var rInterstitialsle=$(".rInterstitialsle");navTabsLinks.click(function(e){rInterstitialsle.remove();var posX=$(this).offset().left;var posY=$(this).offset().top;var buttonWidth=$(this).width();var buttonHeight=$(this).height();$(this).prepend("<span class='rInterstitialsle'></span>");if(buttonWidth>=buttonHeight){buttonHeight=buttonWidth}else{buttonWidth=buttonHeight}var x=e.pageX-posX-buttonWidth/2;var y=e.pageY-posY-buttonHeight/2;rInterstitialsle.css({width:buttonWidth,height:buttonHeight,top:y+"px",left:x+"px"}).addClass("rInterstitialsleEffect")});