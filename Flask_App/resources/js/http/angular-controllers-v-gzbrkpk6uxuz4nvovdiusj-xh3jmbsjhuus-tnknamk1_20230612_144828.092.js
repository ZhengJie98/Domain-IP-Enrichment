app.controller("AccountBalanceDialogCtrl",["$http","$scope","$modalInstance","$window","CustomModalService","labelService","isEnable",function(n,t,i,r,u,f,e){function h(){t.isEnable&&n.post("/TimeLimitedEvent/Detail",null).then(function(n){var t=n.data;if(t.IsSuccess===!1){u.alertError(t.ErrorMessage).then(function(){s()});return}c(t.ReturnObject)})}function c(n){o=n.Id;t.depositAmount=n.DepositAmount;t.bonusAmount=n.BonusAmount;t.totalEventAmount=n.TotalEventAmount;t.imageUrl=n.ImageUrl;t.gameCategoryName=n.GameCategoryNames.join("、");t.eventName=n.EventName;t.endTime=n.EndTime?resetDateTimeByTimezone(n.EndTime):null;t.commissable=n.Commissable;t.auditAmount=n.AuditAmount;t.difference=n.Difference;t.isWithdrawable=t.difference<=0;t.progressRate=t.commissable>=t.auditAmount?100:(t.commissable/t.auditAmount*100).toFixed(1)}function l(){!t.isWithdrawing&&(o||o===0)&&t.isWithdrawable&&(t.isWithdrawing=!0,n.post("/TimeLimitedEvent/Withdraw",{recordId:o}).then(function(n){var i=n.data;if(i.IsSuccess===!1){u.alertError(i.ErrorMessage).then(function(){s()});return}u.alert(t.langs.CompleteSuccess||"成功").then(function(){s()})}))}function a(){i.dismiss()}function s(){r.location.reload()}var o=null;t.langs=f.get("TimeLimitedEvent");t.langs.ContactService=f.get("Common.ContactService");t.isEnable=e;t.withdraw=l;t.dismiss=a;h()}]);app.controller("AccountCaptchaDialogCtrl",["$http","$scope","$interval","$modalInstance","$rootScope","captchaId","identityId",function(n,t,i,r,u,f,e){function o(){initNECaptcha({captchaId:f,element:"#captcha-instance",mode:"embed",onVerify:function(n,i){n||(t.processing=!0,u.$broadcast("validateNECaptcha"+e,{neCaptcha:i.validate,neCaptchaId:f}))}},function(){t.loading=!1},function(i){t.loading=!1;t.initFail=!0;n.post("/Home/InitNeCaptchaError",{error:i})})}t.loading=!0;t.processing=!1;var s=i(function(){typeof initNECaptcha=="function"&&(o(),i.cancel(s))},100);t.dismiss=function(){r.dismiss("cancel")};t.reInit=function(){t.loading=!0;t.processing=!1;t.initFail=!1;o()};t.$on("reInitNECaptcha"+e,function(){t.reInit()});t.$on("closeCaptchaModal"+e,function(){r.close("close")})}]);app.controller("AccountChangeMoneyPasswordCtrl",["$scope","$http","$window","CustomModalService",function(n,t,i,r){function u(){t.post("/Account/CheckMoneyPassword").then(function(t){var i=t.data;if(n.loading=!1,n.isSuccess=i.IsSuccess,i.IsSuccess===!1){n.errorMsg=i.ErrorMessage;return}n.showInitSetting=i.NoSetMoneyPassword})}n.params={};n.loading=!0;u();n.setPassword=function(u,f){if(u.newPassword!==f){n.notConfirm=!0;return}u.isCreate=!0;n.notConfirm=!1;n.isProcessing=!0;t.post("/Account/ChangeMoneyPasswordSubmit",u).then(function(t){var u=t.data;n.isProcessing=!1;u.IsSuccess?r.alert("您的取款密码已设置成功").then(function(){i.location.href="/"}):r.alertError(u.ErrorMessage)})};n.change=function(u,f){if(n.same=!1,n.notConfirm=!1,u.oldPassword==u.newPassword){n.same=!0;return}if(u.newPassword!=f){n.notConfirm=!0;return}n.isProcessing=!0;t.post("/Account/ChangeMoneyPasswordSubmit",u).then(function(t){var u=t.data;n.isProcessing=null;u.IsSuccess?r.alert("您的取款密码已变更成功").then(function(){i.location.href="/"}):r.alertError(u.ErrorMessage)})};n.cancel=function(){i.location.href="/"}}]);app.controller("AccountChangePasswordCtrl",["$scope","$window","$http","$q","$modal","CustomModalService","labelService",function(n,t,i,r,u,f,e){function h(){r.all([i.post("/Account/GetChangePasswordPageStatus",null),i.post("/Account/MemberChangePasswordNeedSmsValidation",null)]).then(function(t){var r=t[0].data,i;if(n.isNeedSmsAuthentication=t[1].data,r.IsSuccess===!1){f.alertError(r.ErrorMessage);return}if(r.Status!==0)for(i=0;i<o.length;i++)o[i].status===r.Status&&(n.langs.ChangePwdTip=o[i].tip)})}function c(){return i.post("/Account/SendSmsToMemberForChangePassword",null).then(function(n){var t=n.data,i;return t.IsSuccess===!1?(f.alertError(t.ErrorMessage),null):(i={type:t.ReturnObject.SmsLoginType,mobile:t.ReturnObject.MobilePartialMask,token:t.ReturnObject.ConfirmToken},l(i))})}function l(n){return u.open({templateUrl:"/Account/SmsAuthenticationDialog",controller:"SmsAuthenticationDialogCtrl",windowClass:"modal-sad",resolve:{info:function(){return n},typeDescription:function(){return"changePassword"}}}).result.then(function(n){return n},function(){return null})}function s(){var r=n.params;n.isProcessing=!0;i.post("/Account/ChangePasswordSubmit",r).then(function(i){var r=i.data,u,o;if(n.isProcessing=null,u=typeof r=="string",u){o=e.get("ChangePassword.ChangeFailAndReLogin")||"变更密码失败，请重新登入";f.alert(o).then(function(){t.location.href="/"});return}if(r.IsSuccess===!1){f.alertError(r.ErrorMessage);return}f.alert("您的密码已变更成功，请立即以新密码重新登入").then(function(){if(r.IsSuccess===!0){t.location.href="/Account/SignOut";return}t.location.href="/"})})}var o=[{status:1,tip:e.get("Account.ForceChangePwdTip")},{status:2,tip:e.get("Account.PasswordWeakTip")}];n.langs={ChangePwdTip:"",SmsAuthentication:e.get("SmsAuthentication.SmsAuthentication")};n.isNeedSmsAuthentication=!1;n.params={};h();n.change=function(){n.same=!1;n.formatError=!1;n.notConfirm=!1;var t=new RegExp("^(?=.*[a-zA-Z])(?=.*[0-9]).{6,}$").test(n.params.newPassword);if(n.params.oldPassword==n.params.newPassword){n.same=!0;return}if(!t){n.formatError=!0;return}if(n.params.newPassword!=n.confirm){n.notConfirm=!0;return}if(n.isNeedSmsAuthentication){c().then(function(t){if(!t){f.alert(e.get("RegionVerify.Error")||"验证失败");return}n.params.confirm=t;s()});return}s()};n.cancel=function(){t.location.href="/"}}]);app.controller("AccountCtrl",["$scope","$http","$rootScope","DataService","signalrService",function(n,t,i,r,u){n.signOut=function(){n.isProcessing=!0};n.updateBalance=function(){n.updatingBalance||(n.updatingBalance=!0,t.post("/Account/GetMyBalance").then(function(t){var r=t.data;n.updatingBalance=null;i.wallets.my=r}))};u.on("updateMyBalance",function(n){i.wallets.my=n});n.callBackAllWallet=function(){n.updatingBalance||(n.updatingBalance=!0,t.post("/Account/CallBackAllWallet").then(function(t){var r=t.data;n.updatingBalance=null;i.wallets.my=r}))}}]);app.controller("AccountSetRealNameCtrl",["$scope","$http","$window","$location","CustomModalService","labelService",function(n,t,i,r,u,f){var e=window.location.search.indexOf("isNeedSetMoneyPassword")>-1;n.params={realName:""};n.tip=f.get("Account.Error_NoRealName");n.setRealName=function(){n.isProcessing=!0;t.post("/Account/SetName",{name:n.params.realName}).then(function(t){var r=t.data;n.isProcessing=null;r.IsSuccess?u.alert("您的真实姓名已设定成功").then(function(){i.location.href=e?"/Account/ChangeMoneyPassword":"/"}):u.alertError(r.ErrorMessage)})};n.cancel=function(){i.location.href="/"}}]);app.controller("ActivityCtrl",["$scope","$q","$timeout","$http","$filter","$location","$window","GenericGameService","ActivityService","LobbyNavService","labelService","ReviewGameService",function(n,t,i,r,u,f,e,o,s,h,c,l){function b(){t.all([s.getActivity(),d(),]).then(function(t){n.activities=t[0].AdCategoryItems;y(n.activities[0].Id);n.themeSetting=t[1];n.isInteractive=n.themeSetting.InteractiveSwitch;nt();n.isInteractive&&tt()})}function k(){return o.getCategoryKey("推荐游戏").then(function(n){var t={NameKeyword:"",CategoryKey:n,IsMobile:!1};return o.getGames(0,18,t)})}function d(){return w?(g(),a.promise):r.post("/Lobby/GetAdManagerThemeSettings",null).then(function(n){return n.data.ReturnObject.AdManagerThemeSettingForWeb})}function g(){function n(t){var i=t.data;a.resolve(i);e.removeEventListener("message",n,!1)}e.addEventListener("message",n,!1);e.opener.postMessage("message",f.search().adActivity)}function nt(){var i=u("filterCdn")(n.themeSetting.BackGroundPic[0],"https://cdn.fidlite.com/"),r=n.themeSetting.ExtendColor,f=u("filterCdn")(n.themeSetting.TitlePic[0],"https://cdn.fidlite.com/"),e=u("filterCdn")(n.themeSetting.ContextBorderTop[0],"https://cdn.fidlite.com/"),o=u("filterCdn")(n.themeSetting.ContextBorderMiddle[0],"https://cdn.fidlite.com/"),s=u("filterCdn")(n.themeSetting.ContextBorderBottom[0],"https://cdn.fidlite.com/"),h=u("filterCdn")(n.themeSetting.BookMarkBtnFront[0],"https://cdn.fidlite.com/"),c=u("filterCdn")(n.themeSetting.BookMarkBtnMiddle[0],"https://cdn.fidlite.com/"),l=u("filterCdn")(n.themeSetting.BookMarkBtnBehind[0],"https://cdn.fidlite.com/"),t=document.createElement("style");t.innerHTML="#activity { background-color: "+r+"; background-image: url('"+i+"'); }#activity .wrapper { background-image: url('"+o+"'); }#activity .wrapper:before { background-image: url('"+e+"'); }#activity .wrapper:after { background-image: url('"+s+"'); }#activity .title { background-image: url('"+f+"'); }ul.navtab li { background-image: url('"+c+"'); }ul.navtab li:before { background-image: url('"+h+"'); }ul.navtab li:after { background-image: url('"+l+"'); }";$("body").prepend(t)}function tt(){t.all([k(),o.getCategoryKey("节庆入口")]).then(function(t){n.games=t[0].Games;v=t[1];it()})}function it(){lottie.loadAnimation({container:document.querySelector("#mascot .normal"),renderer:"svg",loop:!0,autoplay:!0,path:n.themeSetting.HideStatePic[0]});lottie.loadAnimation({container:document.querySelector("#mascot .expand"),renderer:"svg",loop:!0,autoplay:!0,path:n.themeSetting.ExtendStatePic[0]})}function y(t){n.activities.forEach(function(n){n.isSelected=n.Id===t})}function rt(){var u=p(0,n.games.length);n.game=n.games[u];i(function(){n.isShowLottery=!0});var t=n.themeSetting.DialogPic,f=t[p(0,t.length)],r=lottie.loadAnimation({container:document.getElementById("lottery"),renderer:"svg",loop:!1,autoplay:!0,path:f});r.onComplete=function(){r.goToAndPlay(1130)}}function p(n,t){return n=Math.ceil(n),t=Math.floor(t),Math.floor(Math.random()*(t-n))+n}function ut(n){var t=o.getGameInfo(n,v);l.review(n);h.openLobbyNav(t.action,t.supplier)}function ft(){n.isShowLottery=!1;document.getElementById("lottery").innerHTML=""}var w=f.search().adActivity,a=t.defer(),v;n.langs=c.get("Activity");n.activities=[];n.games=[];n.themeSetting={};n.isInteractive=!1;n.isShowLottery=!1;n.clickTab=y;n.recommend=rt;n.close=ft;n.toGame=ut;b()}]);app.controller("ActivityManagementCtrl",["$scope","$q","$window","$filter","$rootScope","$http","labelService","languageService","UserService",function(n,t,i,r,u,f,e,o,s){function c(){if(n.$on("enterMicroServiceError",function(){n.isLoading&&h()}),!window.__IsESModuleSupported||!window.__IsDynamicImportSupported){h();return}if("serviceWorker"in navigator){const n=navigator.serviceWorker;n.getRegistrations?n.getRegistrations().then(function(n){n.forEach(function(n){n.unregister()})}):n.getRegistration&&n.getRegistration().then(function(n){n&&n.unregister()})}setTimeout(function(){t.all([s.getJwtTokens(),f.post("/Home/GetSiteConfig",null)]).then(function(t){var r=t[0],u=t[1].data,f;if(r){localStorage.setItem("jwtToken",r.JwtToken);localStorage.setItem("refreshToken",r.RefreshToken);n.progress=10;try{window.__Qiankun_addGlobalUncaughtErrorHandler(()=>{n.isLoading&&l()});f=localStorage.getItem("mobileType")?localStorage.getItem("mobileType"):"Origin";n.microAppState=window.__Qiankun_InitGlobalState({action:null,data:null});n.microAppState.onGlobalStateChange(function(t){switch(t.action){case"Mounted":n.isLoading=!1;n.$apply();break;case"SignOut":i.location.href="/Account/SignOut";break;case"ProgressRate":n.progress=t.data;n.$apply()}});n.microApp=window.__Qiankun_LoadMicroApp({name:"activity",entry:window.__IsDebuggingEnabled?"http://localhost:8083/":"/fe/activity/",container:"#activity-container",props:{Account:_Account,ApiDomain:window.__IsDebuggingEnabled?null:i.location.origin,JwtToken:r.JwtToken,RefreshToken:r.RefreshToken,Language:o.currentLanguage,IsHashMode:!0,DefaultCurrency:u.DefaultCurrency,DefaultCountryCode:u.CountryCode,DefaultTimezone:u.TimeZone,RouterBaseUrl:"/ActivityManagement/"}})}catch(e){alert(e)}}})})}function l(){n.isLoading=!1;n.isUnSupported=!0;n.errorTitle=e.get("MemberCenter.MicroAppTitleError");let t=window.navigator.userAgent;n.nowUserAgent=t;t.indexOf("agwv")>-1||t.indexOf("igwv")>-1||t.indexOf("agna")>-1||t.indexOf("igna")>-1?(n.errorTitle=e.get("MemberCenter.MicroAppTitleError2"),t.indexOf("agwv")>-1&&(n.nowUserAgent=n.nowUserAgent.replace("agwv","")),t.indexOf("igwv")>-1&&(n.nowUserAgent=n.nowUserAgent.replace("igwv","")),t.indexOf("agna")>-1&&(n.nowUserAgent=n.nowUserAgent.replace("agna","")),t.indexOf("igna")>-1&&(n.nowUserAgent=n.nowUserAgent.replace("igna","")),n.errorMsg=/Macintosh|Mac OS X/i.test(t)?e.get("MemberCenter.IosBrowserErrorMsg2"):r("format")(e.get("MemberCenter.UcWebviewErrorMsg2"),['<a href="https://browser.qq.com/" target="_blank">QQ浏览器<\/a>'])):n.errorMsg=/Macintosh|Mac OS X/i.test(t)?e.get("MemberCenter.IosBrowserErrorMsg"):r("format")(e.get("MemberCenter.UcWebviewErrorMsg"),['<a href="https://browser.qq.com/" target="_blank">QQ浏览器<\/a>']);n.$apply()}function h(){n.isLoading=!1;n.isUnSupported=!0;n.errorTitle=e.get("MemberCenter.BrowserVersionError");let t=window.navigator.userAgent;n.nowUserAgent=t;t.indexOf("agwv")>-1||t.indexOf("igwv")>-1||t.indexOf("agna")>-1||t.indexOf("igna")>-1?(t.indexOf("agwv")>-1&&(n.nowUserAgent=n.nowUserAgent.replace("agwv","")),t.indexOf("igwv")>-1&&(n.nowUserAgent=n.nowUserAgent.replace("igwv","")),t.indexOf("agna")>-1&&(n.nowUserAgent=n.nowUserAgent.replace("agna","")),t.indexOf("igna")>-1&&(n.nowUserAgent=n.nowUserAgent.replace("igna","")),/Macintosh|Mac OS X/i.test(t)?(n.errorTitle=e.get("MemberCenter.MicroAppTitleError"),n.errorMsg=e.get("MemberCenter.IosBrowserErrorMsg2")):n.errorMsg=r("format")(e.get("MemberCenter.CheckES6Tip2"),['<a href="https://browser.qq.com/" target="_blank">QQ浏览器<\/a>'])):/Macintosh|Mac OS X/i.test(t)?(n.errorTitle=e.get("MemberCenter.MicroAppTitleError"),n.errorMsg=e.get("MemberCenter.IosBrowserErrorMsg")):n.errorMsg=r("format")(e.get("MemberCenter.CheckES6Tip"),['<a href="https://browser.qq.com/" target="_blank">QQ浏览器<\/a>']);n.$apply()}n.isLoading=!0;n.deviceLang=e.get("MemberCenter.Device");n.microApp;n.microAppState;n.progress=0;n.isUnSupported=!1;n.nowUserAgent="";n.errorTitle="";n.errorMsg="";c()}]);app.controller("ActivityReceivedDetailDialogCtrl",["$scope","$http","$window","$modalInstance","data","JackPotActivityService","CustomModalService","ActivityService","labelService",function(n,t,i,r,u,f,e,o,s){n.data=u;n.langs=s.get("MemberCenter");f.getActivityName().then(function(t){n.jackPotName=t.ReturnObject});n.close=function(){r.close()}}]);app.controller("AgentApplyCtrl",["$scope","$http","$window","$modal","$rootScope","labelService","$location","CustomModalService",function(n,t,i,r,u,f,e,o){function c(n){t.post("/AgentApply/CheckAndSendConfirmCode",{Phone:n.Phone,CountryCode:n.CountryCode}).then(function(t){var i=t.data,u;if(i.IsSuccess===!1){s();o.alertError(i.ErrorMessage);return}u=i.ReturnObject.Enable;u?r.open({templateUrl:"/AgentApply/AgentApplySmsAuthenticationDialog",controller:"AgentRegisterSmsAuthenticationDialogCtrl",windowClass:"modal-sad",resolve:{info:function(){return{countryCode:n.CountryCode,phone:n.Phone,token:i.ReturnObject.VerifyToken}}}}).result.then(function(t){n.MobileVerifyToken=t.token;n.MobileVerifyConfirmCode=t.code;h(n)},function(){s();o.alert(f.get("Register.VerificationFailed"))}):h(n)})}function h(i){t.post("/AgentApply/ApplySubmit",i).then(function(t){var i=t.data;if(n.isProcessing=!1,i.IsSuccess===!1){s();o.alertError(i.ErrorMessage);return}n.params={};n.params.CountryCode=u.defaultCountryCode;r.open({templateUrl:"/AgentApply/AgentDialog",controller:"AgentApplyDialogCtrl",scope:n}).result.then(function(){},function(){})})}function s(){n.params.checkCode=null;$("#checkcode-input-group input").focus();n.isProcessing=!1}n.params={};n.isShowMore=!1;n.isProcessing=!1;n.moreOptionClick=function(){n.isShowMore=!0};n.isValid=!0;n.chineseIsValid=!0;n.numberIsValid=!0;n.numberOrEmailIsValid=!0;n.emailIsValid=!0;t.post("/AgentApply/GetAgentRegisterSetting").then(function(t){n.agentRegisterSetting=t.data;n.accountSetting=t.data.AccountRule;n.params.CountryCode=u.defaultCountryCode;n.CountryCodes=[{Id:1,Name:"日本",Code:"+81"},{Id:2,Name:"中國",Code:"+86"}].filter(function(n){return n.Code===u.defaultCountryCode})});t.post("/AgentApply/GetAllBanks").then(function(t){n.banks=t.data;n.params.GroupBank=null});n.$watch("params.QQ",function(t,i){if(t){var r=new RegExp("^[0-9]+$").test(t);r||(n.params.QQ=i)}});n.updateBankName=function(){n.isValid=!0;n.chineseIsValid=!0;n.numberIsValid=!0;n.numberOrEmailIsValid=!0;n.emailIsValid=!0;this.params.BankAccount=undefined};n.updateAccount=function(){if(this.params.GroupBank!=null&&this.params.BankAccount!=undefined)switch(this.params.GroupBank.AccountFormat){case 1:if(n.chineseIsValid=new RegExp(/^[^\u4e00-\u9fa5]+$/).test(this.params.BankAccount),n.chineseIsValid)n.chineseIsValid=!0,n.isValid=!0;else{n.isValid=!1;return}break;case 2:if(n.numberIsValid=new RegExp(/^[0-9]+$/).test(this.params.BankAccount),n.numberIsValid)n.numberIsValid=!0,n.isValid=!0;else{n.isValid=!1;return}break;case 3:if(n.numberOrEmailIsValid=new RegExp(/^[0-9]+$/).test(this.params.BankAccount),n.numberOrEmailIsValid)n.numberOrEmailIsValid=!0,n.isValid=!0;else if(n.numberOrEmailIsValid=new RegExp(/^\w+((-\w+)|(\.\w+))*\@[A-Za-z0-9]+((\.|-)[A-Za-z0-9]+)*\.[A-Za-z]+$/).test(this.params.BankAccount),n.numberOrEmailIsValid)n.numberOrEmailIsValid=!0,n.isValid=!0;else{n.isValid=!1;return}break;case 4:if(n.emailIsValid=new RegExp(/^\w+((-\w+)|(\.\w+))*\@[A-Za-z0-9]+((\.|-)[A-Za-z0-9]+)*\.[A-Za-z]+$/).test(this.params.BankAccount),n.emailIsValid)n.emailIsValid=!0,n.isValid=!0;else{n.isValid=!1;return}}else n.isValid=!0,n.chineseIsValid=!0,n.numberIsValid=!0,n.numberOrEmailIsValid=!0,n.emailIsValid=!0};n.$watchCollection("[params.GroupBank, params.BankAccount]",function(t,i){var r=$.grep(t,function(i){if(t[0]==null&&i==undefined){n.isBankRequired=!0;return}if(i==""){n.isBankRequired=!0;return}return i!==undefined});switch(r.length){case 0:n.isBankRequired=!1;break;case i.length:n.isBankRequired=!0;break;default:n.isBankRequired=!0}},!0);n.apply=function(){var t=angular.copy(n.params),r=new RegExp(n.accountSetting.Pattern).test(t.Account),i;if(!r){o.alert(f.get("Agent.Account_Error")||"代理帐号格式错误");return}if(n.params.Confirm_Password!=t.Password){o.alert(f.get("Agent.Different_Password")||"代理密码与确认密码不同");return}if(i=t.Phone?new RegExp("^[0-9]+$").test(t.Phone):!0,!i){o.alert(f.get("Register.Mobile_Error")||"手机号码格式错误");return}if(!n.checkCode){o.alert(f.get("Agent.Empty_Checkcode")||"验证码为空, 请取得验证码");return}if(!n.isValid){$('input[ng-model="params.BankAccount"]').focus();return}t.CheckCodeEncrypt=n.checkCode.encrypt;n.isProcessing=!0;t.GroupBankId=t.GroupBank==null?null:t.GroupBank.Id;c(t)}}]);app.controller("AgentApplyDialogCtrl",["$scope","$window","$modalInstance",function(n,t,i){n.isProcess=!1;n.close=function(){i.close()}}]);app.controller("AgentRegisterSmsAuthenticationDialogCtrl",["$scope","$http","$modalInstance","$interval","labelService","CustomModalService","info",function(n,t,i,r,u,f,e){function c(){o&&r.cancel(o);i.close({token:n.params.token,code:n.params.code})}function l(){if(n.isResendable){var i={CountryCode:e.countryCode,Phone:e.phone};t.post("/AgentApply/CheckAndSendConfirmCode",i).then(function(t){var i=t.data;if(i.IsSuccess===!1){f.alertError(i.ErrorMessage);return}n.params.token=i.ReturnObject.VerifyToken;h()})}}function h(){n.remain=s;n.isResendable=!1;o=r(function(){if(n.remain===0){r.cancel(o);n.isResendable=!0;return}n.remain=n.remain-1},1e3)}var s=60,o;n.isResendable=!1;n.langs=u.get("SmsAuthentication");n.params={code:"",token:e.token};n.tip=n.langs.SendSms+e.countryCode+e.phone+" ，"+n.langs.SendSmsTime;n.remain=s;n.ok=c;n.resend=l;h()}]);app.controller("AnyTimeDiscountConfirmDialogCtrl",["$http","$scope","$filter","$modalInstance","CustomModalService","detail",function(n,t,i,r,u,f){function o(){r.dismiss()}function s(){if(!f.RealReceiveAmount){r.close();return}t.receiving=!0;n.post("/AnyTimeDiscount/ReceiveMemberAnyTimeDiscount",null).then(function(n){var f,e,o;if(t.receiving=!1,f=n.data,f.IsSuccess===!1){u.alertError(f.ErrorMessage);return}e=i("customCurrency");o=e(f.totalAmount);u.alert("已领取 "+o).then(function(){r.close()})})}function h(n,t){var i,r,u,f;try{i=n.toString().split(".")[1].length}catch(e){i=0}try{r=t.toString().split(".")[1].length}catch(e){r=0}return u=Math.pow(10,Math.max(i,r)),f=i>=r?i:r,((n*u-t*u)/u).toFixed(f)}t.detail=f;t.cancel=o;t.ok=s;var e=h(t.detail.MaxWithdraw,t.detail.AlreadyReceivedAmount||0);t.receivingPercentage=f.AlreadyReceivedAmount/f.MaxWithdraw*100;t.remainAmount=e>0?e:0}]);app.controller("AnyTimeDiscountDetailDialogCtrl",["$http","$scope","$filter","$modal","$modalInstance","CustomModalService",function(n,t,i,r,u,f){function h(){u.dismiss()}function e(){t.receiving=!0;n.post("/AnyTimeDiscount/ReceiveMemberAnyTimeDiscount",null).then(function(n){var r,e,o;if(t.receiving=!1,r=n.data,r.IsSuccess===!1){f.alertError(r.ErrorMessage);return}e=i("customCurrency");o=e(r.totalAmount);f.alert("已领取 "+o).then(function(){u.close()})})}function c(){n.post("/AnyTimeDiscount/GetMemberDiscountDetail",null).then(function(n){var i=n.data;if(i.IsSuccess===!1){f.alertError(i.ErrorMessage);return}t.loaded=!0;o(i);s(i)})}function l(){t.loaded=!1;n.post("/AnyTimeDiscount/RefreshMemberDiscountDetail",null).then(function(n){var i=n.data;if(i.IsSuccess===!1){f.alertError(i.ErrorMessage);return}t.loaded=!0;o(i);s(i)})}function o(n){n.StartDateTime=n.StartDateTime?resetDateTimeByTimezone(n.StartDateTime):null;n.EndDateTime=n.EndDateTime?resetDateTimeByTimezone(n.EndDateTime):null;t.startTime=n.StartDateTime?n.StartDateTime:null;t.total=n.TotalAmount;t.qualification=n.Qualification;t.detail=[];angular.forEach(n.Detail,function(n){t.detail.push({id:n.GameTypeId,displayName:n.GameTypeDisplayName,betAmount:n.BetAmount,discountAmount:n.DiscountAmount,categoryDisplayName:n.CategoryDisplayName})})}function s(n){t.realReceiveAmount=n.RealReceiveAmount;t.deductAmount=n.DeductAmount;t.maxWithdraw=n.MaxWithdraw;t.alreadyReceivedAmount=n.AlreadyReceivedAmount}function a(){if(!t.maxWithdraw){e();return}t.receiving=!0;r.open({templateUrl:"/AnyTimeDiscount/ConfirmDialog",controller:"AnyTimeDiscountConfirmDialogCtrl",windowClass:"modal-atdcd",resolve:{detail:function(){return{TotalAmount:t.total,RealReceiveAmount:t.realReceiveAmount,DeductAmount:t.deductAmount,MaxWithdraw:t.maxWithdraw,AlreadyReceivedAmount:t.alreadyReceivedAmount}}}}).result.then(function(){u.close()},function(){t.receiving=!1})}c();t.dismiss=h;t.receive=e;t.refresh=l;t.receiveConfirm=a}]);app.controller("AuthenticaredDeviceCtrl",["$http","$scope","$window","$modal","$q","CustomModalService","labelService","signalrService",function(n,t,i,r,u,f,e,o){function c(){o.connect();n.post("/Account/GetGpkAuthenticatorDevice",null).then(function(n){var i=n.data;if(i.IsSuccess===!1){f.alertError(i.ErrorMessage);return}t.devices=i.DeviceList||t.devices;t.statusDisabled=i.MemberDisableGpkAuth;t.isEnable=!0});v()}function l(i){!t.isDeleting&&i&&(t.isDeleting=!0,f.promptPwd(e.get("Account.UnbindPrompt")||"请输入登入密码来继续解除绑定").then(function(r){if(!r){t.isDeleting=!1;return}n.post("/Account/DeleteGpkAuthenticatorDevice",{deviceId:i.DeviceId,password:r}).then(function(n){var r=n.data;if(t.isDeleting=!1,r.IsSuccess===!1){f.alertError(r.ErrorMessage);return}f.alert(e.get("Account.UnbindSuccess")||"解除绑定成功").then(function(){for(var r=null,n=0;n<t.devices.length;n++)t.devices[n].DeviceId===i.DeviceId&&(r=n);r!==null&&t.devices.splice(r,1)})})}))}function a(){t.devices.length>=h||t.isBinding||(t.isBinding=!0,s().then(function(){t.isBinding=!1},function(){t.isBinding=!1}))}function s(){return n.post("/Account/GetRegisteredGpkAuthenticatorDeviceQr",{signalRId:o.getConnectionId()}).then(function(n){var t=n.data;return t.IsSuccess===!1?(f.alertError(t.ErrorMessage),u.reject()):r.open({templateUrl:"/Account/QrCodeAuthentication",controller:"QrCodeAuthenticationCtrl",windowClass:"modal-qca",resolve:{authInfo:function(){return{AndroidAppUrl:t.GpkAuthenticatorInfo.AndroidAppUrl,AndroidAppQrCode:t.GpkAuthenticatorInfo.AndroidAppQrCode,IosAppUrl:t.GpkAuthenticatorInfo.IosAppUrl,IosAppQrCode:t.GpkAuthenticatorInfo.IosAppQrCode,RegisterUrl:t.GpkAuthenticatorInfo.RegisterUrl,RegisterQrCode:t.GpkAuthenticatorInfo.RegisterQrCode}}}}).result})}function v(){o.on("gpkAuthRegisterDeviceSuccess",function(n){if(!n){f.alertError(e.get("Account.BindFailed")||"绑定失败，请稍后再试。").then(function(){i.location.reload()});return}f.alert(e.get("Account.BindSuccess")||"绑定成功").then(function(){i.location.reload()})})}function y(){if(!t.isSwitching){if(t.isSwitching=!0,t.statusDisabled=!t.statusDisabled,t.devices.length===0&&!t.statusDisabled){s().then(function(){t.isSwitching=!1;t.statusDisabled=!t.statusDisabled},function(){t.isSwitching=!1;t.statusDisabled=!t.statusDisabled});return}n.post("/Account/UpdateMemberGpkAuthDisableState",{disabled:t.statusDisabled}).then(function(n){var i=n.data;if(t.isSwitching=!1,i.IsSuccess===!1){f.alertError(i.ErrorMessage).then(function(){t.statusDisabled=!t.statusDisabled});return}t.statusDisabled&&(t.devices=[])})}}var h=2;t.isEnable=null;t.statusDisabled=null;t.devices=[];t.deleteDevice=l;t.bindDevice=a;t.switchAuth=y;n.post("/Home/GetGpkAuthEnable").then(function(n){var i=n.data;if(!i.Enable){t.isEnable=!1;return}c()})}]);app.controller("AuthListDialogCtrl",["$scope","$modalInstance","loginService","labelService","CustomModalService","authList","params",function(n,t,i,r,u,f,e){function a(n){if(!h){h=!0;var t={account:s.account,loginValidationType:n.type};i.getLoginValidate(t).then(function(t){var i=t.data;if(i.IsSuccess===!1){u.alertError(i.ErrorMessage).then(function(){o()});return}n.authFn(i)})}}function v(n){var t={type:n.SmsLoginType,mobile:n.MobilePartialMask,token:n.ConfirmToken};i.openSmsAuthModal(t).then(function(n){var t=n||"",r={account:s.account,confirmCode:t};i.accountLoginD(r).then(function(n){var t=n.data;if(t.IsSuccess===!1){u.alertError(t.ErrorMessage).then(function(){o()});return}c()})},function(){o()})}function y(n){i.openDeviceAuthModal(n.GpkAuthenticatorInfo).then(function(){o()},function(){o()})}function p(n){i.openGoogleDialogAuthModal().then(function(t){var t=t||"",r={account:s.account,token:n.Token,pin:t};i.accountLoginG(r).then(function(n){var t=n.data;if(t.IsSuccess===!1){u.alertError(t.ErrorMessage).then(function(){o()});return}c()})},function(){o()})}function w(n){var t={email:n.EmailPartialMask,token:n.ConfirmToken};i.openEmailAutheModal(t).then(function(n){var t=n||"",r={account:s.account,confirmCode:t};i.accountLoginH(r).then(function(n){var t=n.data;if(t.IsSuccess===!1){u.alertError(t.ErrorMessage).then(function(){o()});return}c()})},function(){o()})}function c(){n.close()}function o(){h=!1}n.langs=r.get("Login");n.dismiss=function(){t.dismiss()};n.close=function(){t.close()};var s=e,h=!1,l=[{type:3,icon:"fas fa-comment-dots",name:n.langs.SmsAuth,authFn:v},{type:4,icon:"fas fa-mobile-alt",name:n.langs.DeviceAuth,authFn:y},{type:6,icon:"fas fa-user-check",name:n.langs.GoogleAuth,authFn:p},{type:7,icon:"fas fa-envelope",name:n.langs.EmailAuth,authFn:w}];n.authList=[];n.authClick=a;n.authList=f.map(function(n){return l.filter(function(t){return t.type===n})[0]})}]);app.controller("BetRecordPlusCtrl",["$scope","$q","$http","$timeout","bodyScrollService","MeidonTimeService","CustomModalService","labelService",function(n,t,i,r,u,f,e,o){function y(){p();r(function(){n.betRecord.status.isReady=!0;s();a()});$(document).on("scroll",function(){r(s)});n.$on("$destroy",l)}function p(){$(function(){var t=f.getCurrentMeidon();n.betRecord.wagersTimeBegin=n.betRecord.payoffTimeBegin=moment(t,"YYYY/MM/DD 00:00:00").format("YYYY/MM/DD 00:00:00");n.betRecord.wagersTimeEnd=n.betRecord.payoffTimeEnd=moment(t,"YYYY/MM/DD 23:59:59").format("YYYY/MM/DD 23:59:59")})}function s(){var r,u,t;c||n.betRecord.status.isDataAllLoaded||(r=$("#bet_record").scrollTop()+$("#bet_record").height(),u=$(document).scrollTop()+$(window).height(),r-u>1e3)||(t={SearchParams:{WagersTimeBegin:n.betRecord.searchTimeOption==1?n.betRecord.wagersTimeBegin:"",WagersTimeEnd:n.betRecord.searchTimeOption==1?n.betRecord.wagersTimeEnd:"",PayoffTimeBegin:n.betRecord.searchTimeOption==2?n.betRecord.payoffTimeBegin:"",PayoffTimeEnd:n.betRecord.searchTimeOption==2?n.betRecord.payoffTimeEnd:"",SearchTimeOption:n.betRecord.searchTimeOption,UnpayOnly:n.betRecord.unpayOnly},take:30,skip:n.betRecord.lists.length},n.betRecord.selectMemberGameCategories!=="all"&&n.betRecord.selectMemberGameCategories!==""&&(t.SearchParams.GameCategories=n.betRecord.selectMemberGameCategories),n.betRecord.status.isLoading=!0,c=i.post("/BetRecord/SearchBetRecord",t).then(function(i){if(n.betRecord.status.isLoading=!1,c=null,!i.data.IsSuccess){e.alertError(i.data.ErrorMessage).then(function(){n.betRecord.status.isDataAllLoaded=!0});l();return}n.betRecord.lists=n.betRecord.lists.concat(i.data.result);i.data.result.length<t.take&&(n.betRecord.status.isDataAllLoaded=!0,l())}))}function a(){var t={WagersTimeBegin:n.betRecord.wagersTimeBegin,WagersTimeEnd:n.betRecord.wagersTimeEnd,PayoffTimeBegin:n.betRecord.payoffTimeBegin,PayoffTimeEnd:n.betRecord.payoffTimeEnd,SearchTimeOption:n.betRecord.searchTimeOption,UnpayOnly:n.betRecord.unpayOnly};n.betRecord.selectMemberGameCategories!=="all"&&n.betRecord.selectMemberGameCategories!==""&&(t.GameCategories=n.betRecord.selectMemberGameCategories);i.post("/BetRecord/GetBetrecordTotalInfo",t).then(function(t){angular.extend(n.total,t.data);n.isSearchCompleted=!0})}function l(){$(document).off("scroll")}var c,v,h;n.langs=o.get("BetRecord");n.betRecord={status:{isReady:!1,isLoading:!1,isDataAllLoaded:!1,memberGameCategoriesLoading:!1,showMemberGameCategoryDropdown:!1},lists:[],wagersTimeBegin:null,wagersTimeend:null,payoffTimeBegin:null,payoffTimeEnd:null,searchTimeOption:1,unpayOnly:!1,suppliers:[],kinds:[],allMemberGameCategories:[{Name:n.langs.SelectAll,Category:"all"}],selectMemberGameCategories:"all",currentMemberGameCategoriesName:n.langs.SelectAll};n.total={};y();n.betRecord.submit=function(){var t=$(window).scrollTop();n.isSearchCompleted=!1;n.betRecord.lists=[];n.total={};n.betRecord.status.isDataAllLoaded=!1;$(document).on("scroll",function(){r(s)});r(function(){t===$(window).scrollTop()&&r(s)});r(a)};n.openLink=function(n){var t={rawDataType:n.RawDataType,rawDataId:n.RawDataId};i.post("/BetRecord/GetPlayCheckUrl",t).then(function(n){var t=n.data;if(t.IsSuccess===!1){e.alertError(t.ErrorMessage);return}window.open(t.Url)})};h=!1;n.getMemberGameCategories=function(){if(!v||h){if(h){n.betRecord.status.showMemberGameCategoryDropdown=!n.betRecord.status.showMemberGameCategoryDropdown;return}n.betRecord.status.memberGameCategoriesLoading=!0;v=i.post("/BetRecord/GetMemberGameCategories").then(function(t){n.betRecord.status.memberGameCategoriesLoading=!1;h=!0;t.data.length===0?(n.betRecord.allMemberGameCategories=[{Name:n.langs.NoRecords,Category:""}],n.betRecord.selectMemberGameCategories="",n.betRecord.currentMemberGameCategoriesName=n.langs.NoRecords):(n.betRecord.allMemberGameCategories=n.betRecord.allMemberGameCategories.concat(t.data),n.betRecord.selectMemberGameCategories="all");n.betRecord.status.showMemberGameCategoryDropdown=!0})}};n.assignGameCategory=function(t,i){n.betRecord.status.showMemberGameCategoryDropdown=!n.betRecord.status.showMemberGameCategoryDropdown;n.betRecord.currentMemberGameCategoriesName=t;n.betRecord.selectMemberGameCategories=i},function(){$(document).on("click",function(){if(n.betRecord.status.showMemberGameCategoryDropdown){n.betRecord.status.showMemberGameCategoryDropdown=!1;n.$apply();return}})}()}]);app.controller("BindingTipDialogCtrl",["$scope","$window","$interval","$modalInstance","labelService",function(n,t,i,r,u){function e(){i.cancel(f);r.dismiss()}function o(){f=i(function(){n.bindWindowAutoClose--;n.bindWindowAutoClose===0&&e()},1e3)}o();n.langs=u.get("Login");n.bindWindowAutoClose=5;var f;n.goBindingNow=function(){t.location.href="/MemberCenter/#/MemberCenter/SecurityList"};n.close=function(){e()}}]);app.controller("ChangePwdDialogCtrl",["$http","$rootScope","$scope","$window","$timeout","$interval","$modal","$modalInstance","CustomModalService","labelService","info",function(n,t,i,r,u,f,e,o,s,h,c){function l(){if(!i.isProcessing){let t={Account:c.account,Password:i.params.Password,ConfirmPassword:i.params.ConfirmPassword,Token:c.token};i.isProcessing=!0;n.post("/User/ResetPassword",t).then(function(n){var t=n.data;if(i.isProcessing=!1,t.IsSuccess===!1){s.alertError(t.ErrorMessage);return}s.alert(i.langs.SettingSuccess);i.close()})}}function a(){if(!i.isProcessing){let t={MoneyPassword:i.params.Password,ConfirmMoneyPassword:i.params.ConfirmPassword,Token:c.token};i.isProcessing=!0;n.post("/User/ResetMoneyPassword",t).then(function(n){var t=n.data;if(i.isProcessing=!1,t.IsSuccess===!1){s.alertError(t.ErrorMessage);return}s.alert(i.langs.SettingSuccess);i.close()})}}i.langs=h.get("ForgetPassword");i.isChangeMoneyPwd=!1;i.params={};i.isProcessing=!1;i.dismiss=function(){o.dismiss()};i.close=function(){o.close()};i.isChangeMoneyPwd=c.isChangeMoneyPwd?!0:!1;i.submit=function(){var n=new RegExp("^(?=.*[a-zA-Z])(?=.*[0-9]).{6,}$").test(i.params.Password);if(!n&&!c.isChangeMoneyPwd){s.alert(h.get("Register.Password_Error")||"会员密码格式错误，至少 6 个字符以上，须包含字母及数字");return}if(i.params.ConfirmPassword!=i.params.Password){s.alert(h.get("Register.Different_Password")||"会员密码与确认密码不同");return}c.isChangeMoneyPwd?a():l()}}]);app.controller("ChangePwdSmsAuthenticationDialogCtrl",["$scope","$http","$modalInstance","$interval","labelService","CustomModalService","info",function(n,t,i,r,u,f,e){function h(t){n.isLoading=!1;n.tip=n.langs.SendSms+t+" ，"+n.langs.SendSmsTime;l()}function a(){e.isChangeMoneyPwd?y():v()}function v(){if(!n.isProcessing){n.isProcessing=!0;let u={Account:e.account,ConfirmCode:n.params.code};t.post("/User/ForgotPasswordValidate",u).then(function(n){var t=n.data;if(t.IsSuccess===!1){f.alertError(t.ErrorMessage);return}o&&r.cancel(o);i.close({token:t.ReturnObject.Token})})}}function y(){if(!n.isProcessing){n.isProcessing=!0;let u={ConfirmCode:n.params.code};t.post("/User/ForgotMoneyPasswordValidate",u).then(function(n){var t=n.data;if(t.IsSuccess===!1){f.alertError(t.ErrorMessage);return}o&&r.cancel(o);i.close({token:t.ReturnObject.Token})})}}function p(){e.isChangeMoneyPwd?c():w()}function w(){if(n.isResendable){var r={CountryCode:e.countryCode,Phone:e.mobile,Account:e.account};t.post("/User/ForgotPassword",r).then(function(n){var t=n.data;if(t.IsSuccess===!1){f.alertError(t.ErrorMessage);i.dismiss();return}s=t.ReturnObject.ExpireTime;l()})}}function c(){n.isResendable&&t.post("/User/ForgotMoneyPassword",null).then(function(t){var r=t.data;if(r.IsSuccess===!1){n.isLoading=!1;f.alertError(r.ErrorMessage);i.dismiss();return}s=r.ReturnObject.ExpireTime;h(r.ReturnObject.MaskedPhoneNumber)})}function l(){n.remain=s;n.isResendable=!1;o=r(function(){if(n.remain===0){r.cancel(o);n.isResendable=!0;return}n.remain=n.remain-1},1e3)}var s=e.expireTime||60,o;n.isLoading=!0;n.isResendable=!1;n.isProcessing=!1;n.langs=u.get("SmsAuthentication");n.params={};n.dismiss=function(){i.dismiss()};n.ok=a;n.resend=p;e.isChangeMoneyPwd?(n.isResendable=!0,c()):h(e.maskMobile)}]);app.controller("CheckInOfferCtrl",["$http","$scope","$q","$modal","$timeout","$location","$window","$filter","labelService","languageService","CustomModalService","MeidonTimeService","CheckInOfferService","LoginRedirectService","SiteSettingService",function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y){function at(){if(p){vt();return}if(!_IsLogin){v.goLogin();return}a.getSwitchSingleton().then(function(r){var u=r.Enable;if(!u){t.isLoading=!1;t.isEnable=!1;return}t.isEnable=!0;i.all([n.post("/CheckInOffer/GetDetail"),n.post("/CheckInOffer/GetSupplementCount"),n.post("/CheckInOffer/IsCanCheckIn")]).then(function(n){var i=n[0].data.ReturnObject||null;g(i);t.remainSupplementCount=n[1].data.ReturnObject||0;t.isCanSupplement=t.remainSupplementCount>0;t.isCanCheckIn=n[2].data.ReturnObject||!1})})}function vt(){function n(i){var r=i.data.ReturnObject;g(r);t.isEnable=!0;e.removeEventListener("message",n,!1)}e.addEventListener("message",n,!1);e.opener.postMessage("message",f.search().checkinoffer)}function g(n){n&&(t.memberAccount=n.MemberInfo.MemberAccount,t.cumulativeType=parseInt(n.MemberInfo.EventCheckType),t.cumulativeDays=n.MemberInfo.RecordCount||0,n.SupplementRule&&(t.supplementRule={supplementCount:n.SupplementRule.SupplementCount,depositTotalCount:n.SupplementRule.DepositTotalCount,depositTotalAmount:n.SupplementRule.DepositTotalAmount,settlementType:parseInt(n.SupplementRule.SettlementType),commission:n.SupplementRule.Commission,gameCategoryNames:n.SupplementRule.GameCategoryNames}),n.DailySetting&&(t.dailySetting={commission:n.DailySetting.Commission,depositTotalAmount:n.DailySetting.DepositTotalAmount,depositTotalCount:n.DailySetting.DepositTotalCount,gameCategoryNames:n.DailySetting.GameCategoryNames}),t.eventInfo.eventName=n.EventInfo.TitleName||"",t.eventInfo.beginTime=n.EventInfo.BeginTime?resetDateTimeByTimezone(n.EventInfo.BeginTime):w.format("YYYY/MM/DD HH:mm:ss"),t.eventInfo.endTime=n.EventInfo.EndTime?resetDateTimeByTimezone(n.EventInfo.EndTime):w.format("YYYY/MM/DD HH:mm:ss"),t.eventInfo.dailyAuditTimes=n.EventInfo.DailyAuditTimes||0,t.eventInfo.dailyCheckMoney=n.EventInfo.DailyCheckMoney||0,document.title=yt(t.eventInfo.eventName),pt(n.Calendars||[]),bt(n.EventSettings||[]),t.isLoading=!1)}function yt(n){y.getSiteTitleSingleton().then(function(t){document.title=t.PortalSiteName+" - "+n})}function pt(n){var i=moment(t.eventInfo.beginTime),r=d(),u,f;for(t.calendars=[];r>i||i.format("M")===r.format("M");)u=i.daysInMonth(),f=Array.apply(null,new Array(u)).map(function(n,t){var r=i.format("YYYY/MM")+"/"+(t<9?"0":"")+(t+1);return{checkDate:r,checkInType:0,checkValidate:it(r),checkToday:r===w.format("YYYY/MM/DD")}}).map(function(t){var r=t.checkDate,i=n.filter(function(n){return r===moment(n.CheckDate).format("YYYY/MM/DD")})[0];return i?(t.checkDate=resetDateTimeByTimezone(i.CheckDate,"YYYY/MM/DD"),t.checkInType=i.CheckInType,t):t}),t.calendars.push({month:i.format("YYYY/MM"),days:f}),i.add(1,"month");nt(r.format("YYYY/MM"))}function nt(n){if(wt(n)){t.selectedCalendar=t.calendars.filter(function(t){return t.month===n})[0];var i=t.selectedCalendar.days.filter(function(n){return n.checkValidate}).reverse()[0];tt(i,!0)}}function wt(n){var i=t.calendars[0].month,r=d().format("YYYY/MM");return moment(n).isBetween(i,r,null,"[]")}function tt(n,i){if(it(n.checkDate)&&(t.selectedDate=n,p&&i&&(t.selectedDate.checkToday=!0),k(),!i)&&!t.isDateAllReadyCheckIn){if(t.isDateToday){ft();return}ot()}}function k(){t.isDateAllReadyCheckIn=t.selectedDate.checkInType===1||t.selectedDate.checkInType===2;t.isDateToday=t.selectedDate.checkToday;t.isReCheckable=!t.isDateToday&&t.isCanSupplement&&t.selectedDate.checkInType===0}function it(n){var i=moment(t.eventInfo.beginTime).format("YYYY/MM/DD"),r=d().format("YYYY/MM/DD");return moment(n).isBetween(i,r,null,"[]")}function d(){return moment(t.eventInfo.beginTime)>w?moment(t.eventInfo.endTime):w}function bt(n){var i=n.map(function(n){return kt(n)});t.rewardContinueList=i.filter(function(n){return n.checkType===1});t.rewardAccumulateList=i.filter(function(n){return n.checkType===2});rt();u(function(){$(".reward-wrapper").slick(lt)})}function kt(n){return{id:n.Id,checkType:n.CheckType,days:n.Days,bonusAmount:n.BonusAmount||0,bonusAuditTimes:n.BonusAuditTimes||0,imageUrl:o("filterCdn")(n.ImageUrl,"https://cdn.fidlite.com/"),isReceived:n.Status===2,isCanReceive:n.Status===3}}function rt(n){var i=t.rewardContinueList.length?"continue":"accumulate",r=angular.isDefined(n)?n:i;t.rewardTab=r}function ut(){t.rewardContinueList=t.rewardContinueList.map(function(n){return n.isCanReceive=n.isCanReceive||n.days<=t.continueDays&&!n.isReceived,n});t.rewardAccumulateList=t.rewardAccumulateList.map(function(n){return n.isCanReceive=n.isCanReceive||n.days<=t.cumulativeDays&&!n.isReceived,n})}function ft(){if(p){t.cumulativeDays=t.cumulativeDays+1;et();return}t.isProcessing||p||!t.isDateAllReadyCheckIn&&t.isDateToday&&t.isCanCheckIn&&(t.isProcessing=!0,n.post("/CheckInOffer/CheckIn",null).then(function(n){var i=n.data;if(t.isProcessing=!1,i.IsSuccess===!1){c.alertError(i.ErrorMessage);return}t.cumulativeDays=i.ReturnObject.AccumulateDays;t.continueDays=i.ReturnObject.ContinuousCheckDays;et()}))}function et(){t.selectedDate.checkInType=1;k();ut();st()}function ot(){if(!t.isProcessing&&!p&&!t.isDateAllReadyCheckIn&&t.isCanSupplement){t.isProcessing=!0;var i=t.selectedDate.checkDate;n.post("/CheckInOffer/Supplement",{inputTime:i}).then(function(n){var i=n.data;if(t.isProcessing=!1,i.IsSuccess===!1){c.alertError(i.ErrorMessage);return}t.cumulativeDays=i.ReturnObject.AccumulateDays;t.continueDays=i.ReturnObject.ContinuousCheckDays;t.remainSupplementCount=i.ReturnObject.SupplementCount;t.isCanSupplement=t.remainSupplementCount>0;t.selectedDate.checkInType=2;k();ut();st()})}}function st(){r.open({templateUrl:"checkInSuccessModal",windowClass:"modal-checkinoffer",resolve:{cumulativeType:function(){return t.cumulativeType},cumulativeDays:function(){return t.cumulativeDays},langs:function(){return t.langs}},controller:["$scope","$modalInstance","cumulativeType","cumulativeDays","langs",function(n,t,i,r,u){n.langs=u;n.cumulativeType=i;n.cumulativeDays=r;n.close=t.dismiss}]}).result.then(function(){b()},function(){b()})}function ht(i){if(p){ct(i);return}if(!t.isProcessing&&!p&&i.isCanReceive&&!i.isReceived){t.isProcessing=!0;var r=i.id,u=i.days;n.post("/CheckInOffer/Reward",{eventSettingId:r,bonusDay:u}).then(function(n){var r=n.data;if(t.isProcessing=!1,r.IsSuccess===!1){c.alertError(r.ErrorMessage);return}ct(i)})}}function ct(n){n.isReceived=!0;n.isCanReceive=!1;dt(n)}function dt(n){r.open({templateUrl:"receiveSuccessModal",windowClass:"modal-checkinoffer",resolve:{reward:function(){return n},langs:function(){return t.langs}},controller:["$scope","$modalInstance","reward","langs",function(n,t,i,r){n.langs=r;n.reward=i;n.close=t.dismiss}]}).result.then(function(){b()},function(){b()})}function b(){var i=t.rewardContinueList.filter(function(n){return n.isCanReceive})[0],r=t.rewardAccumulateList.filter(function(n){return n.isCanReceive})[0],n=i||r;angular.isUndefined(n)||ht(n)}function gt(){r.open({templateUrl:"ruleModal",windowClass:"modal-checkinoffer",controller:["$scope","$modalInstance","supplementRule","dailySetting","eventInfo","langs",function(n,t,i,r,u,f){n.langs=f;n.supplementRule=i;n.dailySetting=r;n.eventInfo=u;n.close=t.dismiss;n.dailySettingGameCategoryDetail=!1;n.supplementGameCategoryDetail=!1;n.showDailySettingGameCategory=function(){n.dailySettingGameCategoryDetail=!n.dailySettingGameCategoryDetail};n.showSupplementGameCategory=function(){n.supplementGameCategoryDetail=!n.supplementGameCategoryDetail};n.showGameCategory=function(n,t){return n?t?n.join("、"):n.slice(0,2).join("、"):""}}],resolve:{supplementRule:function(){return t.supplementRule},dailySetting:function(){return t.dailySetting},eventInfo:function(){return t.eventInfo},langs:function(){return t.langs}}}).result.then(function(){},function(){})}var p=f.search().checkinoffer,w=l.getCurrentMeidon(),lt={infinite:!1,slidesToShow:4,slidesToScroll:4,arrows:!0};t.langVersion=h.currentLanguage;t.langs=s.get("CheckInOffer")||{};t.langs.Loading=s.get("Common.Loading");t.langs.NoEvent=s.get("Common.NoEvent");t.isLoading=!0;t.isEnable=!1;t.isProcessing=!1;t.memberAccount="";t.eventInfo={};t.isCanCheckIn=!1;t.isCanSupplement=!1;t.remainSupplementCount=0;t.supplementRule=null;t.cumulativeDays=0;t.continueDays=0;t.cumulativeType=0;t.calendars=[{month:"",days:[]}];t.selectedDate={};t.selectedCalendar={month:w.format("YYYY-MM"),days:[]};t.isDateToday=!0;t.isDateInDuration=!1;t.isDateAllReadyCheckIn=!0;t.isReCheckable=!1;t.rewardContinueList=[];t.rewardAccumulateList=[];t.rewardTab;t.selectDate=tt;t.selectMonth=nt;t.checkIn=ft;t.reCheckIn=ot;t.openRuleModal=gt;t.receiveReward=ht;t.changeTab=rt;at()}]);$(document).ready(function(){function t(){$('[ng-click="toMg3Live()"]').remove();$("[ng-click=\"show='mg3'\"]").remove();$('[game-box="mg3"]').remove();$(".mg3").remove();$('[href="/Lobby/MG3"]').remove();$('[ng-click="toMg3Flash()"]').remove();$('[src="/SlotCasino/Mg3Flash"]').remove();$("[ng-click=\"show='new-mg'\"]").remove();$('[game-box="new-mg"]').remove();$(".new-mg").remove();$('[ng-click="toPt3Live()"]').remove();$("[ng-click=\"show='pt3'\"]").remove();$('[game-box="pt3"]').remove();$(".pt3").remove();$('[href="/Lobby/PT3"]').remove();$('[src="/LiveCasino/Pt3Live"]').remove();$('[ng-click="toPt3Html()"]').remove();$('[src="/SlotCasino/Pt3Html"]').remove();$("[ng-click=\"show='new-pt'\"]").remove();$('[game-box="new-pt"]').remove();$(".new-pt").remove();$('[ng-click="toPt3Fish()"]').remove();$("[ng-click=\"show='pt3-fish'\"]").remove();$('[game-box="pt3-fish"]').remove();$(".pt3-fish").remove();$('[ng-click="toLgHtml()"]').remove();$('[game-box="lg"]').remove();$(".lg").remove();$('[src="/SlotCasino/LgHtml"]').remove();$('[href="/Lobby/LG"]').remove()}function i(){n.post("/Home/GetGaSetting",null).then(function(n){var t=n.data;t.IsSuccess!==!1&&(t.ReturnObject&&t.ReturnObject.GaEnable&&t.ReturnObject.GaCode&&r(t.ReturnObject.GaCode),t.ReturnObject&&t.ReturnObject.GtmEnable&&t.ReturnObject.GtmCode&&u(t.ReturnObject.GtmCode))})}function r(n){var i="(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create', '"+n+"', 'auto');ga('send', 'pageview');",t=document.createElement("script");t.type="text/javascript";t.innerHTML=i;document.body.appendChild(t)}function u(n){var t=document.createElement("script"),i;t.type="text/javascript";t.innerHTML="(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id=' + i + dl;f.parentNode.insertBefore(j, f);})(window, document, 'script', 'dataLayer', '"+n+"');";i=document.createElement("noscript");i.innerHTML='<iframe src="https://www.googletagmanager.com/ns.html?id="'+n+'"height="0" width="0" style="display:none;visibility:hidden"><\/iframe>';document.head.appendChild(t);document.body.appendChild(i)}var n=angular.element(document.body).injector().get("$http");t();i()});app.controller("CompanyDepositConfirmDialogCtrl",["$scope","$http","$window","$modalInstance","labelService","params","depositType","CustomModalService",function(n,t,i,r,u,f,e,o){n.langs=u.get("Common");n.params=f;n.depositType=e;n.apply=function(){n.isProcessing=!0;t.post("/CompanyDeposit/Apply",f).then(function(t){var u=t.data;n.isProcessing=null;u.IsSuccess?r.close(u.ReturnObject):o.alertError(u.ErrorMessage||n.langs.TokenExpired).then(function(){if(!u.ErrorMessage){try{window.opener.location.reload()}catch(n){}i.close();return}r.dismiss()})})};n.cancel=function(){r.dismiss("cancel")}}]);app.controller("CountryBlockedCtrl",["$scope","$window",function(n,t){var i=window.__siteSetting?window.__siteSetting.LayoutCtrl:{};n.lineChatClick=function(n){var f=(new Date).getTime(),r=588,u=486,e;i&&i.lineChat&&(r=i.lineChat.width?i.lineChat.width:r,u=i.lineChat.height?i.lineChat.height:u);n=n.indexOf("?")!=-1?n+"&_="+f:n+"?_="+f;e=t.open(n,"_open","width="+r+",height="+u);e.focus()};n.qqClick=function(n){var r="http://wpa.qq.com/msgrd?v=3&uin="+n+"&site=qq&menu=yes",u=588,f=486,e;i&&i.QQ&&(r=i.QQ.link?i.QQ.link.replace("QQVal",n):r,u=i.QQ.width?i.QQ.width:u,f=i.QQ.height?i.QQ.height:f);e=t.open(r,"_open","width="+u+",height="+f);e.focus()}}]);app.controller("EmailAuthenticationCtrl",["$http","$scope","labelService","CustomModalService",function(n,t,i,r){function u(){f().then(function(n){if(!n){t.isEnable=n;return}e().then(function(i){t.status=i;t.isEnable=n})})}function f(){return n.post("/LoginValidationBinding/EmailIsEnable",null).then(function(n){return n.data.Enable||!1})}function e(){return n.post("/LoginValidationBinding/EmailGetStatus",null).then(function(n){return n.data||!1})}function o(){if(!t.isProcessing){if(t.status){var u='<br/><a href="javascript:void(0)" line-chat-click="Live800LinkReview"><i class="fas fa-headphones"><\/i> '+i.get("Register.ContactCustomerService")||"联系客服<\/a>";r.alert((i.get("GoogleAuthenticator.CancelVerificationTip")||"如欲解除，请联系客服人员。")+u);return}t.isProcessing=!0;t.status=!t.status;n.post("/LoginValidationBinding/UpdateEmailLoginValidationEnable",{enable:t.status}).then(function(n){var i=n.data;if(t.isProcessing=!1,i.IsSuccess===!1){t.status=!t.status;r.alertError(i.ErrorMessage);return}})}}t.isEnable=null;t.status=!1;t.isProcessing=!1;t.switchStatus=o;t.langs=i.get("EmailAuthentication");t.langs.Loading=i.get("Common.Loading");u()}]);app.controller("EmailAuthenticationDialogCtrl",["$http","$scope","$window","labelService","$modalInstance","CustomModalService","info",function(n,t,i,r,u,f,e){function o(){u.close(t.params.code)}function s(){var t=e.token;n.post("/Account/ResendEmail",{refreshToken:t}).then(function(n){var t=n.data;if(t.IsSuccess===!1){f.alertError(t.ErrorMessage).then(function(){i.location.reload()});return}})}t.langs=r.get("EmailAuthentication");t.params={code:""};t.tip=t.langs.Sent+e.email+" ，"+t.langs.SentTime;t.ok=o;t.resend=s}]);app.controller("FavoriteGameCtrl",["$scope","GenericGameService","LobbyNavService","FavoriteGameService",function(n,t,i,r){function f(){r.getFavorites().then(function(t){n.games=t});t.getCategoryKey("我的最爱").then(function(n){u=n})}var u;f();n.toGame=function(n){if(!n.IsDisable){var r=t.getGameInfo(n,u);i.openLobbyNav(r.action,r.supplier)}};n.modifyFavorites=function(t,i){var u=[t.GId],f=!t.IsFavorite;r.modifyFavorites(u,f).then(function(t){if(t.data.IsSuccess===!1){CustomModalService.alert(t.data.ErrorMessage);return}n.games.splice(i,1)})}}]);app.controller("FinancialCompanyDepositCtrl",["$scope","$timeout","$http","$q","$modal","$filter","$rootScope","$location","labelService","languageService","CustomModalService","CompanyDepositService","FinancialService","MeidonTimeService","FunctionSwitchService","signalrService",function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p){function b(t,r=false){let u={financeCenterPaymentType:t,IsFinal:r};i.post("/Financial/GetGroupAccountInfo",u).then(function(t){var i=t.data;if(!i.IsSuccess){c.alertError(i.ErrorMessage||n.langs.TokenExpired);return}if(i.ReturnObject)if(i.ReturnObject.AccountInfo)n.nowTime=resetDateTimeByTimezone(i.ReturnObject.ServiceTime),d(i.ReturnObject);else{if(r){n.isTimerStart=!1;n.isProcessing=!1;c.alertError(n.langs.ApplyAgain);return}n.isProcessing=!0;k()}})}function k(){n.isTimerStart=!0;clearInterval(n.submitInterval);n.waitingSubmitSeconds=30;n.submitRightDeg=0;n.submitLeftDeg=0;n.submitInterval=setInterval(function(){n.waitingSubmitSeconds-=1;n.waitingSubmitSeconds>=15?n.submitRightDeg+=12:n.submitLeftDeg+=12;n.waitingSubmitSeconds===0&&(clearInterval(n.submitInterval),b(n.type.paymentTypeId,!0))},1e3)}function d(t){t.ApplyTime=resetDateTimeByTimezone(t.ApplyTime);clearInterval(n.submitInterval);n.isProcessing=!1;n.isTimerStart=!1;n.isArrivalReturning=!0;n.orderId=t.ApplyId;n.applyTime=t.ApplyTime;n.applyTimeAddThree=moment(t.ApplyTime).add(3,"minutes");n.accountInfo=t.AccountInfo;n.applyRequest=t.ApplyRequest;n.respondDiscount=t.RespondDiscount;n.accountInfo.Province&&(n.accountInfo.NetPoint=n.accountInfo.Province+"-"+n.accountInfo.City);nt();clearInterval(n.interval);n.interval=setInterval(function(){nt()},1e3)}function it(){l.CompanyDepositAndWallet().then(function(t){if(n.depositEnabled=t.DepositEnabled&&!t.WalletIsLocked,n.depositEnabled){rt();return}n.depositMessage=t.WalletIsLocked?"您的钱包已被冻结，无法存取款，请联系在线客服。":t.DepositMessage;n.isLoading=!1})}function rt(){var t=l.limitedAndDepositTypes(),u=i.post("/BlockChain/GetAllDigitalCurrencyRelations"),f=[t,u];r.all(f).then(function(t){var i;n.isLoading=!1;n.banks=t[0].Banks;i=t[0];w=t[1].data.ReturnObject;var r=n.min=i.Min,u=n.max=i.Max,f=n.digitalCurrencyMin=i.DigitalCurrencyDepositMin,e=n.digitalCurrencyMax=i.DigitalCurrencyDepositMax;n.min=n.min===null?1:n.min;n.digitalCurrencyMin=n.digitalCurrencyMin===null?1:n.digitalCurrencyMin;et(r,u);ot(f,e);n.depositTypes=i.DepositTypes;n.changeType(parseInt(o.search().type));ft()})}function ut(){var t=r.defer(),u=angular.isDefined(n.AllDigitalCurrencyAccounts);return u?t.resolve(n.AllDigitalCurrencyAccounts):i.post("/CompanyDeposit/GetMemberDigitalCurrencyInfo").then(function(i){n.AllDigitalCurrencyAccounts=i.data.ReturnObject;t.resolve(n.AllDigitalCurrencyAccounts)}),t.promise}function g(t){var i=t.length>0;i&&t.length&&(n.params.address=angular.copy(t[0]))}function ft(){var t=e.$on("$locationChangeSuccess",function(){var t=[1,6].indexOf(parseInt(o.search().method))>-1;(t||tt!==1)&&n.changeType(parseInt(o.search().type))});n.$on("$destroy",function(){t()})}function et(t,i){var r="";t!==null&&i!==null&&(r=f("customCurrency")(n.min)+" ~ "+f("customCurrency")(n.max));(t!==null&&i===null||t===null&&i===null)&&(r=f("customCurrency")(n.min)+" "+n.langs.Above);t===null&&i!==null&&(r=f("customCurrency")(n.max)+" "+n.langs.Below);n.limitedAmountPlaceholder=r.replace(/\$\s/g,"")}function ot(t,i){var r="";t!==null&&i!==null&&(r=f("customCurrency")(n.digitalCurrencyMin)+" ~ "+f("customCurrency")(n.digitalCurrencyMax)+" 人民币(RMB)");(t!==null&&i===null||t===null&&i===null)&&(r=f("customCurrency")(n.digitalCurrencyMin)+" 人民币(RMB)"+n.langs.Above);t===null&&i!==null&&(r=f("customCurrency")(n.digitalCurrencyMax)+" 人民币(RMB)"+n.langs.Below);n.digitalCurrencyLimitedAmountPlaceholder=r.replace(/\$\s/g,"")}function st(){$("#financial-company-deposit .date").datetimepicker({locale:$("html").attr("moment-lang"),format:"YYYY/MM/DD HH:mm",widgetPositioning:{horizontal:"auto",vertical:"bottom"}});$("#bank-input").autocomplete({source:function(t,i){var r=$.map(n.banks,function(n){return{Id:n.Id,label:n.Name,value:n.Name,Url:n.Url}});i($.ui.autocomplete.filter(r,t.term))},select:function(t,i){n.params.bankId=i.item.Id;n.selectedBank={name:i.item.label?""+i.item.label:"",url:i.item.Url?i.item.Url:"",used:i.item.value?i.item.value:""}},minLength:0}).on("focus",function(){$(this).autocomplete("search")}).on("click",function(){$(this).autocomplete("search")}).on("blur",function(){$(this).val()===""&&(n.selectedBank.url="")})}function ht(t){var r={type:t};i.post("/CompanyDeposit/GetDiscountSetting",r).then(function(t){var i=t.data;if(i.IsSuccess===!1){c.alertError(i.ErrorMessage);return}n.discountSettings=i.DiscountSetting?i.DiscountSetting.sort(function(n,t){return n.Amount-t.Amount}):[];n.refreshDiscountSetting()})}function ct(){var r=n.depositType==="DigitalCurrency_USDT"?n.digitalCurrencyMin:n.min,i=n.depositType==="DigitalCurrency_USDT"?n.digitalCurrencyMax:n.max,t=n.params.amount,u=parseInt("9".repeat(15),10);return t?t>u?(c.alert(n.langs.Enter_ValidDepositAmount),!0):t<r?(c.alert(n.langs.Error_DepositNumberAbove+": "+f("customCurrency")(r)),!0):i!==null&&t>i?(c.alert(n.langs.Error_DepositNumberBelow+": "+f("customCurrency")(i)),!0):!1:(c.alert(n.langs.Enter_DepositAmount),!0)}function nt(){let t=moment(n.applyTimeAddThree).diff(n.nowTime,"seconds");n.time.minutes=t>0?Math.floor(t/60):0;n.time.seconds=t>0?t%60:0;n.nowTime=moment(n.nowTime).add(1,"seconds");n.time.minutes===0&&n.time.seconds===0&&(n.isOrderCompleted=!0)}var w,tt=parseInt(o.search().mode);n.depositEnabled=!1;n.Accounts={};n.params={};n.branch={};n.depositNameLabelPlaceholder="";n.limitedAmountPlaceholder="";n.digitalCurrencyLimitedAmountPlaceholder="";n.langs=s.get("CompanyDeposit");n.financialLangs=s.get("Financial");n.isLoading=!0;n.loadingAccounts=!1;n.isOrderCompleted=!1;n.currencyTypes=[];n.selectedBank=undefined;n.setDigitalCurrency=!0;n.amount={input1:null,input2:null};n.digitalCurrencyAccounts=undefined;n.amountValidation={isError:!1,errorMessage:""};n.discountSettings=[];n.discountSetting={isShow:!1,current:null,next:null,bonus:0,remain:0};n.isChangeToOther=!1;n.newObject={address:undefined};n.addressIsValid=!0;n.omniIsValid=!0;n.trcIsValid=!0;n.ercIsValid=!0;n.AllDigitalCurrencyAccounts=undefined;n.isArrivalReturning=!1;n.interval=null;n.time={minutes:0,seconds:0};n.isTimerStart=!1;n.waitingSubmitSeconds=30;n.submitInterval=0;n.submitRightDeg=0;n.submitLeftDeg=0;p.connect();p.on("GroupAccountApplyResponse",function(t){n.isTimerStart&&(n.nowTime=resetDateTimeByTimezone(t.ApplyTime),d(t))});y.getEnableFunctionSwitch().then(function(t){n.isAutoPairEnable=t.DepositWithdrawAutoPair;n.isMmPayEnable=t.CollectionPayment});it();n.changeType=function(i){(parseInt(o.search().type)===9&&parseInt(o.search().method)===6&&(i=8),n.type=l.getDepositTypeByPaymentTypeId(i),n.type)&&(n.depositType=n.type.key,clearInterval(n.interval),n.isProcessing=!1,n.isArrivalReturning=!1,n.isOrderCompleted=!1,n.params={},n.selectedBank=undefined,n.digitalCurrencyAccounts=undefined,b(n.type.paymentTypeId),ht(n.type.paymentTypeId),n.depositType==="DigitalCurrency_USDT"&&(n.params.digitalCurrency=w[0].DigitalCurrency,n.params.blockChainType=w[0].BlockChains[0],n.changeCurrencyType()),t(st,500))};n.changeCurrencyType=function(){n.digitalCurrencyList=w.map(function(n){return n.DigitalCurrency});n.currencyTypes=w.filter(function(t){return t.DigitalCurrency===n.params.digitalCurrency})[0].BlockChains||[];var t=angular.isDefined(n.AllDigitalCurrencyAccounts);if(t){n.digitalCurrencyAccounts=n.AllDigitalCurrencyAccounts?n.AllDigitalCurrencyAccounts.filter(function(t){return t.BlockChain===n.params.blockChainType}).map(function(n){return n.Address}):[];n.isChangeToOther=n.digitalCurrencyAccounts.length===0;g(n.digitalCurrencyAccounts);return}ut().then(function(t){n.digitalCurrencyAccounts=t?t.filter(function(t){return t.BlockChain===n.params.blockChainType}).map(function(n){return n.Address}):[];n.isChangeToOther=n.digitalCurrencyAccounts.length===0;g(n.digitalCurrencyAccounts)})};n.depositNameLabel=function(){var t="";switch(n.depositType){case"WeChat":t=n.langs.DepositNickname;break;case"QQWallet":t=n.langs.DepositName+" / "+n.langs.QQAccount;break;default:t=n.langs.DepositName}return n.depositNameLabelPlaceholder=n.langs.PleaseEnter+t,t};n.showBranch=function(){return n.params.type==="ATM"||n.params.type==="Bank"||n.params.type==="ATMCash"};n.branchLabel=function(){return n.params.type==="ATM"||n.params.type==="ATMCash"?"ATM所属分行":"银行柜台分行"};n.submit=function(){if(n.params.LastFourAccountString=null,n.params.groupAccountType=n.type.paymentTypeId,n.depositType==="DigitalCurrency_USDT"&&(n.isChangeToOther?(n.params.DigitalCurrencyInfoId=0,n.params.address=angular.copy(n.newObject.address)):n.params.DigitalCurrencyInfoId=n.AllDigitalCurrencyAccounts.filter(function(t){return t.Address===n.params.address})[0].Id),!ct()){if(n.depositType!=="DigitalCurrency_USDT"&&n.params.depositName.length>40){c.alert(n.langs.DepositNameError);return}if(delete n.params.memo,n.showBranch()){if(!n.branch.province||!n.branch.city||!n.branch.other){c.alert(n.branchLabel()+"填写不完整");return}n.params.memo=n.branch.province+"省"+n.branch.city+n.branch.cityType+n.branch.other}n.depositType!=="General"&&(n.params.bankId=null);n.depositType==="General"&&(n.params.bankName=n.selectedBank.name);n.isProcessing=!0;k();i.post("/CompanyDeposit/Apply",n.params).then(function(t){var i=t.data;i.IsSuccess===!1&&(n.isTimerStart=!1,n.isProcessing=!1,c.alertError(i.ErrorMessage||n.langs.TokenExpired))})}};n.inputAmountChange=function(){n.refreshDiscountSetting();n.validateApplyAmount();n.depositType==="DigitalCurrency_USDT"&&n.amountOnChange()};n.amountOnChange=function(){if(isNaN(parseFloat(n.amount.input1))){n.refreshDiscountSetting();return}i.post("/BlockChain/TransferCurrency",{currencyFrom:n.params.digitalCurrency,currencyTo:"CNY",amount:n.amount.input1,isBuy:!0}).then(function(t){n.amount.input2=t.data.ReturnObject;n.params.amount=n.amount.input2;n.params.exchangeAmount=t.data.ReturnObject;n.validateApplyAmount();n.refreshDiscountSetting()})};n.validateApplyAmount=function(){var t=parseFloat(n.params.amount),i=n.depositType==="DigitalCurrency_USDT"?n.digitalCurrencyMin:n.min,r=(n.depositType==="DigitalCurrency_USDT"?n.digitalCurrencyMax:n.max)||t;if(t>=i&&t<=r){n.amountValidation.isError=!1;n.amountValidation.errorMessage="";return}if(n.amountValidation.isError=!0,t<i){n.amountValidation.errorMessage=n.langs.DepositAmountMore+": "+f("customCurrency")(i);return}if(t>r){n.amountValidation.errorMessage=n.langs.DepositAmountLess+": "+f("customCurrency")(r);return}n.amountValidation.errorMessage=n.langs.InputDepositAmount};n.changeAddressStatus=function(){n.isChangeToOther=!n.isChangeToOther;n.newObject.address=undefined;n.addressIsValid=!0;n.omniIsValid=!0;n.trcIsValid=!0;n.ercIsValid=!0};n.checkAddress=function(){n.addressIsValid=!0;n.omniIsValid=!0;n.trcIsValid=!0;n.ercIsValid=!0;let t=n.newObject.address;if(t)switch(n.params.blockChainType){case"OMNI":let i=new RegExp(/^(1|3)[0-9A-Za-z]{1,}$/).test(t);n.addressIsValid=i;n.omniIsValid=i;break;case"TRC20":let r=new RegExp(/^(T)[0-9A-Za-z]{1,}$/).test(t);n.addressIsValid=r;n.trcIsValid=r;break;case"ERC20":let u=new RegExp(/^(0x)[0-9A-Za-z]{40}$/).test(t);n.addressIsValid=u;n.ercIsValid=u}};n.addIntoCommon=function(){if(n.addressIsValid){if(n.newObject.address.length<7){c.alertError(n.langs.AddressInputError);return}let t={BlockChainType:n.params.blockChainType,DigitalCurrencyType:n.params.digitalCurrency,Address:n.newObject.address};i.post("WithdrawApplication/CreateDigitalCurrencyInfo",t).then(function(t){var i=t.data;if(i.IsSuccess===!1){c.alertError(i.ErrorMessage);return}n.digitalCurrencyAccounts.push(n.newObject.address);n.AllDigitalCurrencyAccounts.push({Id:i.ReturnObject,Address:n.newObject.address,BlockChain:n.params.blockChainType,DigitalCurrency:n.params.digitalCurrency});n.params.address=angular.copy(n.newObject.address);n.changeAddressStatus()})}};n.refreshDiscountSetting=function(){var e=n.depositType==="DigitalCurrency_USDT"?n.setDigitalCurrency?n.amount.input2:n.amount.input1:n.params.amount,i=parseFloat(e||0);if(n.discountSetting={isShow:!1,current:null,next:null,bonus:0,remain:0},!isNaN(i)&&n.discountSettings.length!==0){var o=n.discountSettings.map(function(n){return n.Amount}),r=o.filter(function(n){return i>=n}).length,t=r===0?null:n.discountSettings[r-1],u=r===n.discountSettings.length?null:n.discountSettings[r],s=t?t.Percent*.01*i:0,f=Math.floor(s*100)/100,h=u?u.Amount-i:0;n.discountSetting={isShow:!0,current:t,next:u,bonus:t&&(t.DiscountMax===null?f:Math.min(f,t.DiscountMax)),remain:h}}};n.remittanceReturn=function(){i.post("/CompanyDeposit/RemittanceReturn",{ApplyId:n.orderId}).then(function(t){var i=t.data;if(i.IsSuccess===!1){c.alertError(i.ErrorMessage);return}n.isOrderCompleted=!0})};String.prototype.repeat||(String.prototype.repeat=function(n){"use strict";var t,i;if(this===null)throw new TypeError("can't convert "+this+" to object");if(t=""+this,n=+n,n!==n&&(n=0),n<0)throw new RangeError("repeat count must be non-negative");if(n===Infinity)throw new RangeError("repeat count must be less than infinity");if(n=Math.floor(n),t.length===0||n===0)return"";for(i=t.length*n,n=Math.floor(Math.log(n)/Math.log(2));n;)t+=t,n--;return t+t.substring(0,i-t.length)})}]);app.controller("FinancialDepositCtrl",["$http","$scope","$location","$window","$state","$rootScope","$timeout","$q","$filter","labelService","ExternalPaymentService","CustomModalService","FinancialService","CompanyDepositService",function(n,t,i,r,u,f,e,o,s,h,c,l,a,v){function d(){c.GetExternalPayment().then(function(n){t.externalLink=n.Url});n.post("/Financial/GetAvailableDigitalWalletCompany",null).then(function(n){var i=n.data;if(i.IsSuccess===!1){l.alertError(i.ErrorMessage);return}if(t.eWalletAll=i.ReturnObject,t.isPreview){nt();return}g()})}function g(){n.post("/Financial/GetFinanceCenterDetail",null).then(function(n){var t=n.data;if(t.IsSuccess===!1){l.alertError(t.ErrorMessage);return}w(t)})}function nt(){function n(t){var i=t.data;w(i);r.removeEventListener("message",n,!1)}r.addEventListener("message",n,!1);r.opener.postMessage("message",i.search().financial)}function tt(n){let i=t.eWalletAll.filter(function(n){return n.ShortcutEnable});return i.length&&n.forEach(function(r,u){if(t.displayMode===1&&r.Id===7){let t=u+1;i.forEach(function(i){let u=r.FinanceCenterSubCategoryList.some(function(n){return n.FinanceCenterPaymentCategoryIds[0]===i.DigitalWalletCompanyId});u&&(n.splice(t,0,{Id:i.DigitalWalletCompanyId,Name:i.Name,PageImageUrl:i.DefaultImgUrl,RecommendContent:null,RecommendTitle:"",Sort:r.Sort,FinanceCenterSubCategoryList:r.FinanceCenterSubCategoryList,isShortCut:!0}),t++)})}if(t.displayMode===2&&r.PaymentTypeId===12){let t=u+1;i.forEach(function(i){let u=r.FinanceCenterPaymentCategoryIds.some(function(n){return n===i.DigitalWalletCompanyId});u&&(n.splice(t,0,{PaymentTypeId:i.DigitalWalletCompanyId,Name:i.Name,ImgPath:i.DefaultImgUrl,RecommendContent:r.RecommendContent,RecommendTitle:"",Sort:r.Sort,FinanceCenterPaymentCategoryIds:[i.DigitalWalletCompanyId],isShortCut:!0,IsShow:!0,SortByPaymentFirst:r.SortByPaymentFirst,parentTypeId:r.PaymentTypeId}),t++)})}}),n}function w(n){t.displayMode=n.DisplayMode;n.ReturnObject=tt(n.ReturnObject);t.displayMode===1?it(n.ReturnObject):rt(n.ReturnObject);ut();var r=i.search();r._=+new Date;r.mode=t.displayMode;i.search(r);t.isLoading=!1}function it(n){t.depositTabs=n.sort(function(n,t){return n.Sort-t.Sort}).filter(function(n){return n.Id!==3}).filter(function(n){return n.FinanceCenterSubCategoryList.length>0}).map(function(n){return{id:n.Id,name:n.Name,imgUrl:n.PageImageUrl,tip:n.RecommendTitle,recommend:[2,5].indexOf(n.Id)===-1?n.RecommendContent:"",paymentType:null,paymentMethod:n.Id,isShortCut:n.isShortCut||!1,list:n.FinanceCenterSubCategoryList.map(function(t){return{id:t.TypeId,type:t.TypeId,method:n.Id,name:t.ReName,imgUrl:t.ImgUrl,isCustomMerchant:n.Id===5,copywriting:t.Copywriting,isShortCut:n.isShortCut||!1,financeCenterPaymentCategoryIds:t.FinanceCenterPaymentCategoryIds}})}});var i=angular.isDefined(t.depositTabs.filter(function(n){return n.id===5})[0]),r=angular.isDefined(t.depositTabs.filter(function(n){return n.id===6})[0]),u=angular.isDefined(t.depositTabs.filter(function(n){return n.id===7||n.isShortCut})[0]);i&&t.depositTabs.filter(function(n){return n.id===5})[0].list.forEach(function(n){n.method=2});r&&t.depositTabs.filter(function(n){return n.id===6})[0].list.forEach(function(n){switch(n.id){case 1:n.method=1;n.id=9;n.type=8;break;case 2:n.method=2;n.id=8;n.type=8;n.financeCenterPaymentCategoryIds=[22]}});u&&t.depositTabs.filter(function(n){return n.id===7||n.isShortCut}).forEach(function(n){n.list.forEach(function(n){n.method=2})})}function rt(n){t.depositTabs=n.sort(function(n,t){return n.Sort-t.Sort}).map(function(n){return{id:n.PaymentTypeId,name:n.Name,imgUrl:n.ImgPath,tip:n.RecommendTitle,recommend:n.RecommendContent,paymentType:n.PaymentTypeId,paymentMethod:null,sortByPaymentFirst:n.SortByPaymentFirst,financeCenterPaymentCategoryIds:n.FinanceCenterPaymentCategoryIds,parentTypeId:n.parentTypeId,isShortCut:n.isShortCut||!1,isHardLoad:n.parentTypeId===12||n.PaymentTypeId===12}})}function ut(){var n=f.$on("$locationChangeSuccess",function(){st(i.search());t.displayMode===1&&at(i.search());t.displayMode===2&&yt(i.search())});t.$on("$destroy",function(){n()})}function ft(n){t.displayMode===1?b(n):(n.isInnerChange=!0,y(n))}function b(n){if(n.paymentMethod===3){u.go("FinancialWithdraw");return}if(n.paymentMethod===4){t.externalLink&&r.open(t.externalLink,"_blank");return}if(t.selectedDepositTab.paymentMethod!==n.paymentMethod){var f=i.search();f.method=n.paymentMethod;f.isShortCut=n.isShortCut;delete f.type;delete f.subType;delete f.eWallet;i.search(f)}}function y(n){if(n.paymentType===11){t.externalLink&&r.open(t.externalLink,"_blank");return}t.selectedMerchant={};let u=i.search().subType&&!n.isInnerChange?i.search().subType:n.isHardLoad?[n.financeCenterPaymentCategoryIds[0]]:n.financeCenterPaymentCategoryIds;et(n.parentTypeId?n.parentTypeId:n.paymentType,n.sortByPaymentFirst,u,n.isHardLoad).then(function(r){var f,e,o;if(p=!1,ot(r,n),f=i.search(),f.type=n.paymentType,f.sortByPaymentFirst=n.sortByPaymentFirst,delete f.subType,f.isShortCut=n.isShortCut,n.isHardLoad&&(f.subType=u),t.merchants.length===0){delete f.merchant;delete f.isOnlinePayment;f._=+new Date;i.search(f);return}e=parseInt(i.search().merchant);o=p&&!isNaN(e)?t.merchants.filter(function(n){return n.SettingId===e})[0]:t.merchants[0];f.merchant=o.SettingId;f.isOnlinePayment=o.IsOnlinePayment;f._=+new Date;i.search(f)})}function et(n,t,i,r){return o.all([a.getPaymentMerchantList(n,t,i,r),v.limitedAndDepositTypes()])}function ot(n,i){var o=n[0].list,u=n[1],r={},f;o.filter(function(n){return!n.RecommendationMemo}).forEach(function(n){var t=n.ThirdPartyPaymentCategoryName;if(!r[t]){r[t]=[].concat(n.SettingId);return}r[t].push(n.SettingId)});f=1;t.merchants=o.map(function(n){var s=r[n.ThirdPartyPaymentCategoryName]&&r[n.ThirdPartyPaymentCategoryName].indexOf(n.SettingId)+1,e,o;return n.RecommendationMemo=n.IsOnlinePayment?n.RecommendationMemo||n.ThirdPartyPaymentCategoryName+" - 0"+s:null,e=n.IsOnlinePayment?n.Min:i.paymentType===8?u.DigitalCurrencyDepositMin:u.Min,o=n.IsOnlinePayment?n.Max:i.paymentType===8?u.DigitalCurrencyDepositMax:u.Max,n.DepositLimitDescription=lt(e,o),n.name=n.IsOnlinePayment?t.langs.Merchant+f:t.langs.CompanyDeposit,n.IsOnlinePayment&&f++,n});e(function(){wt()})}function st(n){t.displayMode===1?ht(n.method):ct(n)}function ht(n){var i=parseInt(n),r;if(isNaN(i)){r=t.depositTabs.filter(function(n){return[3,4].indexOf(n.paymentMethod)===-1})[0];b(r);return}t.selectedDepositTab.paymentMethod!==i&&(t.selectedDepositTab=t.depositTabs.filter(function(n){return n.paymentMethod===i})[0],t.paymentTypes=t.selectedDepositTab.list,e(function(){pt()}))}function ct(n){var r=parseInt(n.type),u,i;if(isNaN(r)){u=t.depositTabs[0];y(u);return}if(i=t.depositTabs.filter(function(n){return n.paymentType===r})[0],p){y(i);return}t.selectedDepositTab=i}function lt(n,t){var r=s("noFractionCurrency")(n,"",0),u=s("noFractionCurrency")(t,"",0),i="";return n&&t?(i=h.get("OnlineDeposit.DepositLimitBetween")||"{0} 元 ~ {1} 元",i=i.replace("{0}",r).replace("{1}",u)):!n&&t?(i=h.get("OnlineDeposit.DepositLimitLess")||"{0} 元以下",i=i.replace("{0}",u)):n&&!t?(i=h.get("OnlineDeposit.DepositLimitMore")||"{0} 元以上",i=i.replace("{0}",r)):i=h.get("OnlineDeposit.DepositLimitUnlimit")||"未限制",i}function k(n){var t=i.search();t.type=n.id;t.subType=n.financeCenterPaymentCategoryIds;delete t.eWallet;t.isCustomMerchant=n.isCustomMerchant;i.search(t)}function at(n){var i=n.method==7||n.isShortCut&&n.isShortCut!=="false"?n.subType?Array.isArray(n.subType)?parseInt(n.subType[0]):parseInt(n.subType):isNaN:parseInt(n.type),u,r;if(t.isShowEWalletInfo=!1,t.paymentTypes.length!==0){if(isNaN(i)){u=n.isShortCut&&n.isShortCut!=="false"?t.paymentTypes.filter(function(t){return t.financeCenterPaymentCategoryIds[0]===n.method})[0]:t.paymentTypes[0];k(u);return}r=t.paymentTypes.filter(function(n){return n.id===i})[0];(n.method==7||n.isShortCut&&n.isShortCut!=="false")&&(r=t.paymentTypes.filter(function(n){return n.financeCenterPaymentCategoryIds[0]===i})[0],t.nowSelectEWalletChild=t.eWalletAll.filter(function(n){return n.DigitalWalletCompanyId===i})[0],t.isShowEWalletInfo=!0);t.selectedPaymentType=r}}function vt(n){var t=i.search();t.merchant=n.SettingId;t.isOnlinePayment=n.IsOnlinePayment;i.search(t)}function yt(n){var i=parseInt(n.merchant),r=n.isOnlinePayment;t.merchants.length!==0&&(isNaN(i)||angular.isUndefined(r)||(t.selectedMerchant=r?t.merchants.filter(function(n){return n.SettingId===i})[0]:t.merchants.filter(function(n){return!n.IsOnlinePayment})[0],t.isShowEWalletChildType=!1,(+n.type==12||n.subType)&&(t.eWalletChilds=t.eWalletAll,t.nowSelectEWalletChildType=t.eWalletChilds.filter(function(t){return n.subType?Array.isArray(n.subType)?t.DigitalWalletCompanyId===+n.subType[0]:t.DigitalWalletCompanyId===+n.subType:!0})[0],t.isShowEWalletChildType=!0,bt())))}function pt(){var n=$("#financial-deposit .payment-type-tabs ul"),u=$("#financial-deposit .payment-type-tabs .type-wrapper"),i,r;n.width()>=u.width()?$("#financial-deposit .payment-type-tabs").addClass("scroll"):$("#financial-deposit .payment-type-tabs").removeClass("scroll");n.css("left",0);t.slideLeft=function(){var t=350,i=0,r=parseInt(n.css("left").replace("px","")),u=r+t>=i?i:r+t;n.stop(!0,!1).animate({left:u},500)};t.slideRight=function(){var t=350,i=-n.width()+u.width(),r=parseInt(n.css("left").replace("px","")),f=r-t<=i?i:r-t;n.stop(!0,!1).animate({left:f},500)};i=$("#financial-deposit .payment-type-tabs .btn-prev");r=$("#financial-deposit .payment-type-tabs .btn-next");i.hover(function(){i.addClass("fmp-color-r")},function(){i.removeClass("fmp-color-r")});r.hover(function(){r.addClass("fmp-color-r")},function(){r.removeClass("fmp-color-r")})}function wt(){var n=$("#financial-deposit .merchant-list ul"),u=$("#financial-deposit .merchant-list .merchant-wrapper"),i,r;n.width()>=u.width()?$("#financial-deposit .merchant-list").addClass("scroll"):$("#financial-deposit .merchant-list").removeClass("scroll");n.css("left",0);t.slideLeft=function(){var t=350,i=0,r=parseInt(n.css("left").replace("px","")),u=r+t>=i?i:r+t;n.stop(!0,!1).animate({left:u},500)};t.slideRight=function(){var t=350,i=-n.width()+u.width(),r=parseInt(n.css("left").replace("px","")),f=r-t<=i?i:r-t;n.stop(!0,!1).animate({left:f},500)};i=$("#financial-deposit .merchant-list .btn-prev");r=$("#financial-deposit .merchant-list .btn-next");i.hover(function(){i.addClass("fmp-color-r")},function(){i.removeClass("fmp-color-r")});r.hover(function(){r.addClass("fmp-color-r")},function(){r.removeClass("fmp-color-r")})}function bt(){var n=$("#financial-deposit .e-wallet-list ul"),u=$("#financial-deposit .e-wallet-list .e-wallet-wrapper"),i,r;n.width()>=u.width()?$("#financial-deposit .e-wallet-list").addClass("scroll"):$("#financial-deposit .e-wallet-list").removeClass("scroll");n.css("left",0);t.slideEWalletLeft=function(){var t=350,i=0,r=parseInt(n.css("left").replace("px","")),u=r+t>=i?i:r+t;n.stop(!0,!1).animate({left:u},500)};t.slideEWalletRight=function(){var t=350,i=-n.width()+u.width(),r=parseInt(n.css("left").replace("px","")),f=r-t<=i?i:r-t;n.stop(!0,!1).animate({left:f},500)};i=$("#financial-deposit .e-wallet-list .btn-prev");r=$("#financial-deposit .e-wallet-list .btn-next");i.hover(function(){i.addClass("fmp-color-r")},function(){i.removeClass("fmp-color-r")});r.hover(function(){r.addClass("fmp-color-r")},function(){r.removeClass("fmp-color-r")})}var p=!0;t.isPreview=i.search().financial;t.isLoading=!0;t.displayMode=0;t.depositTabs=[];t.paymentTypes=[];t.merchants=[];t.selectedDepositTab={};t.selectedPaymentType={};t.selectedMerchant={};t.externalLink="";t.langs=h.get("Financial");t.langs.Loading=h.get("Common.Loading");t.changeDepositTab=ft;t.changePaymentType=k;t.changeMerchant=vt;d();t.changeEWallet=function(n){t.nowSelectEWalletChildType=n;let r={id:n.DigitalWalletCompanyId,name:n.Name,imgUrl:n.DefaultImgUrl,tip:"",recommend:null,paymentType:i.search().type,paymentMethod:null,sortByPaymentFirst:i.search().sortByPaymentFirst,financeCenterPaymentCategoryIds:[n.DigitalWalletCompanyId],isInnerChange:!0,isHardLoad:!0,parentTypeId:12,isShortCut:i.search().isShortCut};y(r)}}]);app.controller("FinancialOnlineDepositCtrl",["$scope","$http","$q","$window","$filter","$location","$rootScope","$timeout","$modal","CustomModalService","PaymentService","labelService","languageService","FinancialService",function(n,t,i,r,u,f,e,o,s,h,c,l,a,v){function nt(){var t=e.$on("$locationChangeSuccess",function(){if(n.displayMode===1){tt();return}if(n.displayMode===2){it();return}});n.$on("$destroy",function(){t()})}function tt(){var n=[2,5,7].indexOf(parseInt(f.search().method))>-1,t=f.search().isShortCut&&f.search().isShortCut!=="false",i=parseInt(f.search().method)===6&&parseInt(f.search().type)===8;(n||i||t)&&w()}function it(){var t,i;if(""+f.search().isOnlinePayment!="false"){if(t=n.payment.PaymentTypeId!==parseInt(f.search().type),t){w();return}i=n.displayMode===2&&n.selectedPayment.SettingId!==parseInt(f.search().merchant);i&&k()}}function w(){n.isLoading=!0;var i=n.displayMode===2&&f.search().isShortCut&&f.search().isShortCut!=="false"?12:parseInt(f.search().type);isCustomMerchant=f.search().isCustomMerchant;n.payment=n.displayMode===2?c.getPaymentByPaymentTypeId(i):c.getPaymentByParentTypeId(i);n.displayMode===2?(k(),n.isLoading=!1):b();n.payment.ParentTypeId===7&&t.post("/OnlineDeposit/GetPointCardFeeSetting").then(function(t){var i=t.data;if(!i.IsSuccess){h.alertError(i.ErrorMessage).then(function(){r.location.reload()});return}n.PointCardFee=i});et()}function b(i=null){n.isShowEWalletChild=i?!0:!1;+f.search().method!=2&&+f.search().method!=5||+f.search().type!=12||i||(n.isShowEWalletChild=!0,rt());let r=i?i:+f.search().type==12?f.search().eWallet?[f.search().eWallet]:[Array.isArray(f.search().subType)?f.search().subType[0]:f.search().subType]:f.search().subType;t.post("/OnlineDeposit/GetPaymentList",{parentType:n.payment.ParentTypeId,isCustomMerchant:isCustomMerchant,financeCenterPaymentCategoryIds:r}).then(function(t){if(n.paymentList=t.data,n.paymentList.length===0){p({ResultType:"NotAvailable",ErrorMessage:""});n.isLoading=!1;return}n.convertExchangeRateEnable=n.paymentList.ConvertExchangeRateEnable;n.amountValidate={errorMsg:null};ut();let r=f.search();i&&(r.eWallet=i[0],f.search(r));n.selectPayment(n.paymentList[0]);n.isLoading=!1;o(function(){vt()})})}function rt(){t.post("/Financial/GetAvailableDigitalWalletCompany",null).then(function(t){var i=t.data;if(i.IsSuccess===!1){h.alertError(i.ErrorMessage);return}n.eWalletChilds=i.ReturnObject.filter(function(n){return f.search().subType.some(function(t){return+t===n.DigitalWalletCompanyId})});n.eWalletChilds.length&&(n.nowSelectEWalletChild=f.search().eWallet?n.eWalletChilds.filter(function(n){return n.DigitalWalletCompanyId===+f.search().eWallet})[0]:n.eWalletChilds[0]);o(function(){yt()})})}function k(){var i=parseInt(f.search().merchant),t=f.search().isShortCut,r=v.getOnlinePaymentMerchantInfo(t&&t!=="false"?12:n.payment.PaymentTypeId,i);n.selectPayment(r)}function ut(){var t={};n.paymentList.filter(function(n){return!n.RecommendationMemo}).forEach(function(n){var i=n.ThirdPartyPaymentCategoryName;if(!t[i]){t[i]=[].concat(n.SettingId);return}t[i].push(n.SettingId)});n.paymentList=n.paymentList.map(function(n){var i=t[n.ThirdPartyPaymentCategoryName]&&t[n.ThirdPartyPaymentCategoryName].indexOf(n.SettingId)+1;return n.RecommendationMemo=n.RecommendationMemo||n.ThirdPartyPaymentCategoryName+" - 0"+i,n.DepositLimitDescription=ft(n.Min,n.Max),n})}function ft(n,t){var r=u("noFractionCurrency")(n,"",0),f=u("noFractionCurrency")(t,"",0),i="";return n&&t?(i=l.get("OnlineDeposit.DepositLimitBetween")||"{0} 元 ~ {1} 元",i=i.replace("{0}",r).replace("{1}",f)):!n&&t?(i=l.get("OnlineDeposit.DepositLimitLess")||"{0} 元以下",i=i.replace("{0}",f)):n&&!t?(i=l.get("OnlineDeposit.DepositLimitMore")||"{0} 元以上",i=i.replace("{0}",r)):i=l.get("OnlineDeposit.DepositLimitUnlimit")||"未限制",i}function et(){var r=n.payment.ParentTypeId!==7,i;if(!r){n.discountSettings=[];n.refreshDiscountSetting();return}i={type:n.payment.ParentTypeId};t.post("/OnlineDeposit/GetDiscountSetting",i).then(function(t){var i=t.data;if(i.IsSuccess===!1){h.alertError(i.ErrorMessage);return}n.discountSettings=i.DiscountSetting?i.DiscountSetting.sort(function(n,t){return n.Amount-t.Amount}):[];n.refreshDiscountSetting()})}function d(){var r=n.selectedPayment.Min,f=n.selectedPayment.Max,t=+n.createParams.Amount,i;if(n.amountValidate.errorMsg=null,!t&&t!=0){n.refreshDiscountSetting();return}/^[0-9]*$/.test(t)||(n.amountValidate.errorMsg=n.langs.OnlineDeposit_Error_DepositInteger);r!==null&&t<r&&(n.amountValidate.errorMsg=n.langs.OnlineDeposit_Error_DepositNumberAbove+": "+u("noFractionCurrency")(r,"",0));f!==null&&t>f&&(n.amountValidate.errorMsg=n.langs.OnlineDeposit_Error_DepositNumberBelow+": "+u("noFractionCurrency")(f,"",0));n.payment.ParentTypeId===7&&(i=t*(n.PointCardFee.Percent/100),n.PointCardFee.FeeMax?i>n.PointCardFee.FeeMax?(n.actualDepositAmount=t-n.PointCardFee.FeeMax,n.depositFee=n.PointCardFee.FeeMax):(n.actualDepositAmount=t-i,n.depositFee=i):(n.actualDepositAmount=t-i,n.depositFee=i))}function ot(t){var i={Amount:t.Amount,SettingId:t.SettingId,PaymentyType:n.selectedPayment.ThirdPartyPaymentCategoryId};g(i)}function g(n){t.post("/OnlineDeposit/Send_V2",n).then(function(n){for(var i=n.data,t=0;t<y.length;t++)if(y[t].type===i.ResultType){y[t].callback(i);return}})}function st(t){n.deposit.select=t.SelectBankObject;n.orderList=t.OrderList||[];n.sendParams={Bank:n.deposit.select.Banks&&n.deposit.select.Banks.length?n.deposit.select.Banks[0].Value:null,Amount:n.deposit.select.Amount,SettingId:n.deposit.select.SettingId,PaymentyType:n.selectedPayment.ThirdPartyPaymentCategoryId};n.deposit.component="SelectBank"}function ht(t){n.depositLimitsErrorMessage=t.DepositLimitsErrorMessage}function p(t){n.deposit.error.type=t.ResultType;n.deposit.error.errorMessage=t.ErrorMessage;n.deposit.component="NotAvailable"}function ct(t){n.deposit.info=t.DTPPViewModel;var i=n.deposit.info.Type===22&&n.deposit.info.Data&&angular.isDefined(n.deposit.info.Data.Amount);if(i){lt();n.deposit.component="Redirect";return}n.deposit.component="DTPPPay"}function lt(){s.open({templateUrl:"/Financial/OnlineDepositDTPPPayModal",controller:"FinancialOnlineDepositDTPPPayModalCtrl",windowClass:"modal-dtpppay",resolve:{info:function(){return n.deposit.info}}}).result.then(function(){},function(){})}function at(t){n.redirectUrl=t.RedirectUrl.replace(/(http|https):\/(?!\/)/g,function(n){return n+"/"});n.deposit.component="Redirect";r.open(n.redirectUrl,"_payment","width=850,height=680,resizable,scrollbars=yes")}function vt(){var t=$(".Form .panel .panel-body .payment-list ul"),u=$(".Form .panel .panel-body .payment-list .payment-wrapper"),i,r;t.width()>=u.width()?$(".Form .panel .panel-body .payment-list").addClass("scroll"):$(".Form .panel .panel-body .payment-list").removeClass("scroll");t.css("left",0);n.slideLeft=function(){var n=350,i=0,r=parseInt(t.css("left").replace("px","")),u=r+n>=i?i:r+n;t.stop(!0,!1).animate({left:u},500)};n.slideRight=function(){var n=350,i=-t.width()+u.width(),r=parseInt(t.css("left").replace("px","")),f=r-n<=i?i:r-n;t.stop(!0,!1).animate({left:f},500)};i=$(".Form .panel .panel-body .payment-list .btn-prev");r=$(".Form .panel .panel-body .payment-list .btn-next");i.hover(function(){i.addClass("fmp-color-r")},function(){i.removeClass("fmp-color-r")});r.hover(function(){r.addClass("fmp-color-r")},function(){r.removeClass("fmp-color-r")})}function yt(){var t=$(".Form .panel .panel-body .e-wallet-list ul"),u=$(".Form .panel .panel-body .e-wallet-list .e-wallet-wrapper"),i,r;t.width()>=u.width()?$(".Form .panel .panel-body .e-wallet-list").addClass("scroll"):$(".Form .panel .panel-body .e-wallet-list").removeClass("scroll");t.css("left",0);n.slideEWalletChildLeft=function(){var n=350,i=0,r=parseInt(t.css("left").replace("px","")),u=r+n>=i?i:r+n;t.stop(!0,!1).animate({left:u},500)};n.slideEWalletRight=function(){var n=350,i=-t.width()+u.width(),r=parseInt(t.css("left").replace("px","")),f=r-n<=i?i:r-n;t.stop(!0,!1).animate({left:f},500)};i=$(".Form .panel .panel-body .e-wallet-list .btn-prev");r=$(".Form .panel .panel-body .e-wallet-list .btn-next");i.hover(function(){i.addClass("fmp-color-r")},function(){i.removeClass("fmp-color-r")});r.hover(function(){r.addClass("fmp-color-r")},function(){r.removeClass("fmp-color-r")})}n.isLoading=!0;n.labelLangs=l.get("Financial");n.exChangeAmount=null;n.showPrompt=!1;n.promptText="";n.showPromptPage=!1;n.companyDepositIsEnable=!0;n.payment={};n.deposit={component:"Form",error:{},info:{},select:{},redirect:{}};n.orderList=[];n.displayMode=parseInt(f.search().mode);n.convertExchangeRateEnable=!1;var y=[{type:"Send",callback:ot},{type:"SelectBank",callback:st},{type:"DepositLimitsError",callback:ht},{type:"IsLock",callback:p},{type:"ErrorNotAvailable",callback:p},{type:"NotAvailable",callback:p},{type:"DTPPPay",callback:ct},{type:"Redirect",callback:at}];n.createParams={};n.sendParams={};n.selectedPayment={};n.discountSettings=[];n.discountSetting={isShow:!1,current:null,next:null,bonus:0,remain:0};i.all([t.post("/Home/GetCurrentUserIsLock"),a.getMultilingual(),]).then(function(t){if(n.isLock=t[0].data.IsLock,n.langs=t[1].data,n.isLock){n.isLoading=!1;return}w();nt()});n.selectEWallet=function(t){n.nowSelectEWalletChild=t;b([t.DigitalWalletCompanyId])};n.refreshDiscountSetting=function(){var i=parseFloat(n.createParams.Amount||0);if(n.discountSetting={isShow:!1,current:null,next:null,bonus:0,remain:0},!isNaN(i)&&(!n.amountValidate||!n.amountValidate.errorMsg)&&n.discountSettings.length!==0){var e=n.discountSettings.map(function(n){return n.Amount}),r=e.filter(function(n){return i>=n}).length,t=r===0?null:n.discountSettings[r-1],u=r===n.discountSettings.length?null:n.discountSettings[r],o=t?t.Percent*.01*i:0,f=Math.floor(o*100)/100,s=u?u.Amount-i:0;n.discountSetting={isShow:!0,current:t,next:u,bonus:t&&(t.DiscountMax===null?f:Math.min(f,t.DiscountMax)),remain:s}}};n.continueDeposit=function(){n.showPromptPage=!1};n.toCompanyDeposit=function(){if(!n.companyDepositIsEnable){h.alertError("公司入款停用中，请洽客服人员");return}var t=f.search();n.displayMode===2?(t.merchant=0,t.isOnlinePayment=!1):(t.method=1,delete t.type,delete t.isCustomMerchant);f.search(t)};n.selectPayment=function(i){n.convertExchangeRateEnable=i.ConvertExchangeRateEnable;n.deposit={component:"Form",error:{},info:{},select:{},redirect:{}};n.createParams={};n.sendParams={};n.selectedPayment={};n.sending=!1;t.post("/OnlineDeposit/GetThirdPartyPaymentPromptContent",null).then(function(t){var r=t.data||{};n.exChangeAmount=0;n.showPrompt=r.PromptEnable;n.promptText=r.PromptText;n.showPromptPage=n.displayMode===2&&(n.payment.ParentTypeId===7||n.payment.ParentTypeId===12)?!1:r.IsShowContinueDepositPage;n.companyDepositIsEnable=r.CompanyDepositEnable;n.selectedPayment=i;n.createParams={Amount:""};n.amountValidate={errorMsg:null};i.AmountLock&&(n.createParams.Amount=i.RecommendationAmountSettings[0].Amount,n.inputAmountChange())})};n.inputAmountChange=function(){d();n.payment.ParentTypeId===8&&n.selectedPayment.ConvertExchangeRateEnable?n.amountOnChange():n.refreshDiscountSetting()};n.amountOnChange=function(){if(isNaN(parseFloat(n.createParams.Amount))){n.refreshDiscountSetting();n.exChangeAmount=null;return}t.post("/BlockChain/TransferCurrency",{currencyFrom:"CNY",currencyTo:"USDT",amount:n.createParams.Amount,isBuy:!0}).then(function(t){n.exChangeAmount=t.data.ReturnObject;d();n.refreshDiscountSetting()})};n.submitCreate=function(){if(!n.amountValidate.errorMsg){var i={amount:n.createParams.Amount,settingId:n.selectedPayment.SettingId,paymentyType:n.selectedPayment.ThirdPartyPaymentCategoryId};n.sending=!0;t.post("/OnlineDeposit/Create_V2",i).then(function(n){for(var i=n.data,t=0;t<y.length;t++)if(y[t].type===i.ResultType){y[t].callback(i);return}})}};n.submitSend=function(){g(n.sendParams)}}]);app.controller("FinancialOnlineDepositDTPPPayModalCtrl",["$scope","$modalInstance","$interval","labelService","info",function(n,t,i,r,u){function o(){s()}function s(){var t=n.info.limitTime,r;f(t);r=i(function(){if(t===0){i.cancel(r);e();return}t--;f(t)},1e3)}function f(t){n.minutes=Math.floor(t%3600/60);n.seconds=Math.floor(t%60);n.minutes=n.minutes<10?"0"+n.minutes:n.minutes;n.seconds=n.seconds<10?"0"+n.seconds:n.seconds}function e(){t.close()}n.langs=r.get("OnlineDeposit");n.langs.Close=r.get("TimeLimitedEvent.Close");n.info={type:u.Type,typeName:u.TypeName,qrurl:u.Data&&u.Data.qrurl,coinAmount:u.Data&&u.Data.CoinAmount,limitTime:u.Data&&u.Data.LimitTime||180,amount:u.Data&&u.Data.Amount,coinName:u.Data&&u.Data.CoinName,coinProtocol:u.Data&&u.Data.CoinProtocol,address:u.Data&&u.Data.Address};n.close=e;o()}]);app.controller("FinancialWithdrawApplicationCtrl",["$q","$scope","$http","$window","$modal","$filter","$state","$rootScope","CustomModalService","FunctionSwitchService","labelService","languageService","MeidonTimeService","signalrService",function(n,t,i,r,u,f,e,o,s,h,c,l,a,v){function w(n,i){n=n==null?t.min=1:t.min=n;i=t.max=i;n!=null&&i!=null?(t.condition="between",t.recommendAmounts=t.recommendAmountsBackup.filter(function(t){return t>=n&&t<=i})):n!=null&&i==null?(t.condition="more",t.recommendAmounts=t.recommendAmountsBackup.filter(function(t){return t>=n})):n==null&&i!=null?(t.condition="less",t.recommendAmounts=t.recommendAmountsBackup.filter(function(n){return n<=i})):(t.condition="unlimited",t.recommendAmounts=t.recommendAmountsBackup);t.normalWithdrawRecommandAmount=[];let r=t.balance-t.fee-t.adFee-t.TotalDiscountCancel;r=i!=null?r>i?i:r:r;let u=n!=null?n>100?n:100:100;if(r=r-r%100,r>=u)for(let n=0;n<5;n++)r>=u&&(t.normalWithdrawRecommandAmount.push(r),r-=100)}function et(){var n=$(".body.container #title"),t=document.createElement("style");t.type="text/css";t.innerHTML=".custom-yuebao-color { color: "+n.css("color")+" }.custom-yuebao-bg { background-color: "+n.css("background-color")+"}.custom-yuebao-border-color { border-color:"+n.css("background-color")+"}.custom-yuebao-color-r { color: "+n.css("background-color")+" }";document.body.appendChild(t)}function ot(n){let i=t.withdrawSetting.findIndex(function(n){return n.Id===12});t.allDigitalWalletSubList.forEach(function(n){n.ShortcutEnable&&(i++,t.withdrawSetting.splice(i,0,{Id:n.DigitalWalletCompanyId,Name:n.Name,isShortcutEnable:!0}))});t.normalDigitalWalletInfos=n.map(function(n){let i=t.allDigitalWalletSubList.filter(function(t){return t.DigitalWalletCompanyId===n.FinanceCenterPaymentCategoryId});return{Id:n.Id,DigitalWalletCompanyId:n.FinanceCenterPaymentCategoryId,Address:n.Address,name:i[0].Name,currencyName:i[0].CurrencyName,defaultImgPath:i[0].DefaultImgUrl,androidDownloadPath:i[0].AndroidDownloadPath,iosDownloadPath:i[0].IosDownloadPath,teachingLink:i[0].TeachingLink}})}function b(n){let i="";switch(n){case 1:i=t.langs.ArrivalReturnBankInputText;break;case 3:i=t.langs.ArrivalReturnAlipayInputText;break;case 8:i=t.langs.ArrivalReturnDigitalCurrencyInputText;break;case 12:i=t.langs.ArrivalReturnDigitalCurrencyInputText}return i}function d(){let n=0,i=t.withdrawalRespondInfo.withdrawRespondIsMatching;n=i?moment(t.withdrawalRespondInfo.expireTimeOfAutoMatch).diff(t.serverNowTime,"seconds"):moment(t.withdrawalRespondInfo.ExpireTimeOfWithdrawalRespond).diff(t.serverNowTime,"seconds");t.time.minutes=n>0?Math.floor(n/60):0;t.time.seconds=n>0?n%60:0;t.serverNowTime=moment(t.serverNowTime).add(1,"seconds");t.time.minutes===0&&t.time.seconds===0&&t.withdrawalRespondViewType==="normal"&&(i?g():t.withdrawalRespondInfo.isExpired=!0)}function g(){i.post("/WithdrawApplication/GetAutoMatchRespondForWithdraw").then(function(n){nt(n.data.ReturnObject)})}function nt(n){t.withdrawalRespondInfo.respondForWithdraw=n.RespondForWithdraw;t.withdrawalRespondInfo.ExpireTimeOfWithdrawalRespond=resetDateTimeByTimezone(n.ExpireTimeOfWithdrawalRespond);t.serverNowTime=resetDateTimeByTimezone(n.ServerNow);t.withdrawalRespondInfo.withdrawRespondIsMatching=!1;t.setArrivalReturnView("normal")}function st(){i.post("/BlockChain/GetWithdrawDigitalCurrencyRelations").then(function(n){y=n.data.ReturnObject||[];t.currencyTypes=y.map(function(n){return n.DigitalCurrency});t.changeCurrencyType();t.hasDigitalCurrencyInfos||t.changeIntoInsertDigitalCurrency()})}function ht(){t.applyParams.mainWithdrawMethod=t.isExistApplying||t.isMmPayShelfFunctionSwitchEnable&&t.isMmPayFunctionSwitchEnable&&t.mmPayIsEnable&&t.collectionPaymentMerchantId?2:1;t.applyParams.withdrawType=t.withdrawSetting[0].Id;t.applyParams.mmpayType=t.mmPayWithdrawSetting.length?t.mmPayWithdrawSetting[0].Id:null}function tt(){t.mmPayRespond={};t.mmPayWithdrawRespondInfo.WaitingRespondList.length&&t.changeRespondData(t.mmPayWithdrawRespondInfo.WaitingRespondList[0])}function it(){let n=moment(t.mmPayExpireTime).diff(t.mmPayServerNowTime,"seconds");t.mmPayTime.minutes=n>0?Math.floor(n/60):0;t.mmPayTime.seconds=n>0?n%60:0;t.mmPayServerNowTime=moment(t.mmPayServerNowTime).add("1","seconds");t.mmPayTime.minutes===0&&t.mmPayTime.seconds===0&&(t.mmPayRespond.isExpired=!0)}function rt(n,i,r=null){n===1?i.BankInfoId=r?r:t.bankAccount.Id:n===8?(i.DigitalCurrencyInfoId=r?r:t.DigitalCurrencyInfo.Id,i.ExchangeAmount=t.exchangeAmount):(n===12||t.isShortcut)&&(i.DigitalWalletInfoId=r?r:t.DigitalWalletInfo.Id,t.isShortcut&&(i.withdrawType=12));t.isSelectMmPay?(delete i.withdrawType,t.mmPayApply(i)):(delete i.mmpayType,delete i.leastAmount,t.apply(i))}function ut(){return moment(t.bindQrCodeApplyTime).isAfter(t.bindQrCodeExpireTime)}function ft(){i.post("/WithdrawApplication/GetCollectionPaymentBindQrCode",{requestUrl:window.location.origin}).then(function(n){const i=n.data;if(i.IsSuccess===!1){s.alertError(i.ErrorMessage);return}t.bindQrCode=i.ReturnObject.QrCode;t.bindQrCodeApplyTime=moment(resetDateTimeByTimezone(i.ReturnObject.ExpireTime)).add(-3,"minutes");t.bindQrCodeExpireTime=i.ReturnObject.ExpireTime;t.isExpired=ut();clearInterval(t.bindQrcodeInterval);t.bindQrcodeInterval=setInterval(function(){t.isExpired=ut();t.isExpired&&clearInterval(t.bindQrcodeInterval);t.bindQrCodeApplyTime=moment(t.bindQrCodeApplyTime).add(1,"seconds")},1e3)})}function k(n){return n.map(function(n){return n.Bonus}).sort(function(n,t){return t-n})[0]}var y,p;t.langs=c.get("Withdraw");t.langs.Bank=c.get("CompanyDeposit.Bank");t.langs.Alipay=c.get("CompanyDeposit.Alipay");t.langs.DigitalCurrency=c.get("CompanyDeposit.DigitalCurrency");t.langs.NotSet=c.get("Common.NotSet");t.isValid=!0;t.chineseIsValid=!0;t.numberIsValid=!0;t.numberOrEmailIsValid=!0;t.emailIsValid=!0;t.currentAccountType="bank";t.currencyTypes=[];t.chains=[];t.DigitalCurrencyInfo={};t.nowSelect={Account:"",Address:""};t.newAlipayAccount={Account:"",NickName:""};t.confirm={MoneyPassword:""};t.auditRecords=null;t.auditDetail={};t.loading=!0;t.isProcessing=!1;t.hasError=!1;t.isAlipayWithdrawEnable=!1;t.isDefaultAlipay=!1;t.alipayAccount={HasAlipayAccount:!1};et();t.isYuebaoEnable=!1;t.isInsertBankNow=!1;t.isInsertDigitalCurrencyNow=!1;t.addressIsValid=!0;t.omniIsValid=!0;t.trcIsValid=!0;t.ercIsValid=!0;t.isExistApplying=!1;t.isNeedWithdrawalRespond=!1;t.inputTitleText="";t.arrivalReturn={withdrawalLastFourAccount:""};t.withdrawalRespondInfo={};t.time={minutes:0,seconds:0};t.isShowJoinToMMPay=!1;t.isApplyMMPay=!1;t.mmpay={isReadJoinMMPayRule:!1};collectionPaymentMerchantId=null;hasApplyingCollectionPaymentMerchant=!1;t.isByPodcast=e.params.directByOther;t.podCastIsMmPay=e.params.isMmPay;t.mmPayTime={minutes:0,seconds:0};t.dropDown={isShow:!1};h.getShelfFunctionSwitch().then(function(n){t.isMmPayShelfFunctionSwitchEnable=n.CollectionPayment});h.getEnableFunctionSwitch().then(function(n){t.isYuebaoEnable=n.YuebaoSwitch;t.isMmPayFunctionSwitchEnable=n.CollectionPayment;t.isMmPayAppSwitch=n.MmPayAppSwitch});v.connect();v.on("AutoMatchSuccess",function(n){nt(n)});v.on("SyncRemittanceState",function(n){if(n.IsMmPay){t.mmPayRespond.TradeHistoryId===n.Id&&(t.mmPayRespond.RemittanceState=!0);let i=t.mmPayWithdrawRespondInfo.WaitingRespondList.filter(function(t){return t.TradeHistoryId===n.Id});i.length&&(i[0].RemittanceState=!0)}else t.withdrawalRespondInfo.RemittanceState=!0,t.withdrawalRespondInfo.withdrawRespondIsMatching&&g()});v.on("UpdateMmPayWithdrawRespondInfo",function(n){if(n.ServerNow=resetDateTimeByTimezone(n.ServerNow),n.WaitingRespondList.length&&n.WaitingRespondList.forEach(function(n){n.ExpireTimeOfWaitingRespond=resetDateTimeByTimezone(n.ExpireTimeOfWaitingRespond)}),t.mmPayWithdrawRespondInfo=n,t.hasMMPayDiscountSettings=t.mmPayWithdrawRespondInfo.DiscountSettings&&t.mmPayWithdrawRespondInfo.DiscountSettings.length>0,t.mmPayWithdrawRespondInfo.BonusAmount=+t.mmPayWithdrawRespondInfo.BonusAmount.toFixed(2),t.mmPayWithdrawRespondInfo.dealPercent=+(t.mmPayWithdrawRespondInfo.DealAmount/t.mmPayWithdrawRespondInfo.TotalAmount*100).toFixed(0),t.mmPayServerNowTime=t.mmPayWithdrawRespondInfo.ServerNow,t.mmPayWithdrawRespondInfo.WaitingRespondList.length){t.mmPayRespond={};t.mmPayWithdrawRespondInfo.WaitingRespondList.forEach(function(n){n.isExpired=moment(n.ExpireTimeOfWaitingRespond).isBefore(t.mmPayServerNowTime)});let n=t.mmPayWithdrawRespondInfo.WaitingRespondList.filter(function(n){return n.TradeHistoryId===t.nowMmPayRespondTradeId});n.length?t.changeRespondData(n[0]):t.changeRespondData(t.mmPayWithdrawRespondInfo.WaitingRespondList[0])}});t.mainWithdrawMethods=[{text:t.langs.NormalWithdraw,value:1}];n.all([i.post("/WithdrawApplication/Init"),l.getMultilingual(["WithdrawApplication"]),i.post("/Register/GetAllBanks"),i.post("/WithdrawApplication/GetDigitalWalletPaymentCategoryInfoList")]).then(function(n){var i=n[0].data;if(i.IsSuccess!==undefined&&!i.IsSuccess){t.loading=!1;t.hasError=!0;t.errorMsg=i.ErrorMessage;t.alertClass="alert-danger";return}if(i.NoSetName){t.isSuccess=!1;t.errorMsg=c.get("Account.Error_NoRealName");t.alertClass="alert-warning";o.$broadcast("hideModalFinancial");setTimeout(function(){r.location.href=i.NoSetMoneyPassword?"/MemberCenter/#/MemberCenter/SetRealName?setMoneyPwd":"/MemberCenter/#/MemberCenter/SetRealName"},100);return}if(i.NoSetMoneyPassword){t.isSuccess=!1;t.errorMsg=c.get("Account.Error_NoWithdrawalPassword");t.alertClass="alert-warning";o.$broadcast("hideModalFinancial");setTimeout(function(){r.location.href="/MemberCenter/#/MemberCenter/ChangeMoneyPassword"},100);return}t.isSuccess=!0;t.isExistApplying=i.WithdrawRespondInfo.IsExistApplying;t.mmPayIsExistApplying=i.MmPayWithdrawRespondInfo.IsExistApplying;t.mmPayIsEnable=i.MmPayWithdrawRule.IsEnable;t.canBindingDevice=i.MmPayWithdrawRule.CanBindingDevice;t.collectionPaymentMerchantApplyEnable=i.MmPayWithdrawRule.CollectionPaymentMerchantApplyEnable;t.isNeedWithdrawalRespond=i.WithdrawRespondInfo.NeedWithdrawalRespond;i.MmPayWithdrawRespondInfo.ServerNow=resetDateTimeByTimezone(i.MmPayWithdrawRespondInfo.ServerNow);i.MmPayWithdrawRespondInfo.WaitingRespondList.length&&i.MmPayWithdrawRespondInfo.WaitingRespondList.forEach(function(n){n.ExpireTimeOfWaitingRespond=resetDateTimeByTimezone(n.ExpireTimeOfWaitingRespond)});t.mmPayWithdrawRespondInfo=i.MmPayWithdrawRespondInfo;t.hasMMPayDiscountSettings=t.mmPayWithdrawRespondInfo.DiscountSettings&&t.mmPayWithdrawRespondInfo.DiscountSettings.length>0;t.mmPayWithdrawRespondInfo.BonusAmount=+t.mmPayWithdrawRespondInfo.BonusAmount.toFixed(2);t.mmPayWithdrawRespondInfo.dealPercent=+(t.mmPayWithdrawRespondInfo.DealAmount/t.mmPayWithdrawRespondInfo.TotalAmount*100).toFixed(0);t.mmPayServerNowTime=t.mmPayWithdrawRespondInfo.ServerNow;t.mmPayWithdrawRespondInfo.WaitingRespondList.length&&t.mmPayWithdrawRespondInfo.WaitingRespondList.forEach(function(n){n.isExpired=moment(n.ExpireTimeOfWaitingRespond).isBefore(t.mmPayServerNowTime)});i.WithdrawRespondInfo.ServerNow=resetDateTimeByTimezone(i.WithdrawRespondInfo.ServerNow);t.serverNowTime=i.WithdrawRespondInfo.ServerNow;t.LastOrderWithdrawType=i.WithdrawRespondInfo.LastOrderWithdrawType;t.LastOrderBlockChainType=i.WithdrawRespondInfo.LastOrderBlockChainType;t.collectionPaymentMerchantId=i.MmPayWithdrawRule.CollectionPaymentMerchantId;t.hasApplyingCollectionPaymentMerchant=i.MmPayWithdrawRule.HasApplyingCollectionPaymentMerchant;o.mmPayHighestPercent=i.MmPayWithdrawRule.MaximumWithdrawBonusPercent;o.isNotJoinMmPay=t.isMmPayShelfFunctionSwitchEnable&&t.isMmPayFunctionSwitchEnable&&!t.collectionPaymentMerchantId&&!t.hasApplyingCollectionPaymentMerchant;t.isNeedWithdrawalRespond&&(t.withdrawalRespondInfo={WithdrawalRespondDiscount:i.WithdrawRespondInfo.WithdrawalRespondDiscount||0,ExpireTimeOfWithdrawalRespond:resetDateTimeByTimezone(i.WithdrawRespondInfo.ExpireTimeOfWithdrawalRespond),RemittanceState:i.WithdrawRespondInfo.RemittanceState,isExpired:moment(resetDateTimeByTimezone(i.WithdrawRespondInfo.ExpireTimeOfWithdrawalRespond)).isBefore(t.serverNowTime),expireTimeOfAutoMatch:resetDateTimeByTimezone(i.WithdrawRespondInfo.ExpireTimeOfAutoMatch),withdrawRespondIsMatching:moment(resetDateTimeByTimezone(i.WithdrawRespondInfo.ExpireTimeOfAutoMatch)).isAfter(t.serverNowTime)&&i.WithdrawRespondInfo.RemittanceState===null,respondForWithdraw:i.WithdrawRespondInfo.RespondForWithdraw},t.inputTitleText=b(t.LastOrderWithdrawType));t.withdrawalRespondViewType=null;t.loading=!1;t.isExistApplying&&(t.errorMsg=" 取款申请审核中，不可重复申请",t.alertClass="alert-danger");t.banks=n[2].data;t.recommendAmounts=i.MmPayWithdrawRule.RecommendedAmounts||[];t.recommendAmountsBackup=i.MmPayWithdrawRule.RecommendedAmounts||[];t.amountLock=i.MmPayWithdrawRule.LockAmount;t.balance=i.MemberInfo.Balance;t.fee=i.MemberInfo.Fee;t.adFee=i.MemberInfo.TotalAdministration;t.TotalDiscountCancel=i.MemberInfo.TotalDiscountCancel;t.IsPassAudit=i.MemberInfo.IsPassAudit;t.isByPodcast?(t.podCastIsMmPay!=="false"&&t.mmPayIsEnable&&t.isMmPayFunctionSwitchEnable&&t.mmPayIsExistApplying&&t.setArrivalReturnView("mmPay"),t.podCastIsMmPay==="false"&&t.setArrivalReturnView("normal")):t.isNeedWithdrawalRespond?t.setArrivalReturnView("normal"):t.isExistApplying?t.setArrivalReturnView("process"):t.mmPayIsExistApplying&&t.setArrivalReturnView("mmPay");t.normalAlipayAccount=i.WithdrawRule.AlipayAccount;t.mmPayAliPay=i.MmPayWithdrawRule.CollectionPaymentMerchantAlipayAccount;t.normalBankAccounts=i.WithdrawRule.BankAccounts;t.mmPayBankAccounts=i.MmPayWithdrawRule.CollectionPaymentMerchantBankAccounts||[];t.normalBankAccounts.length&&t.normalBankAccounts.forEach(function(n){n.BankName=t.banks.filter(function(t){return t.Id===n.GroupBankId})[0].Name;n.text=`${n.BankName} (${n.Account})`});t.mmPayBankAccounts.length&&t.mmPayBankAccounts.forEach(function(n){n.BankName=t.banks.filter(function(t){return t.Id===n.GroupBankId})[0].Name;n.text=`${n.BankName} (${n.Account})`});t.normalDigitalCurrencyInfos=i.WithdrawRule.DigitalCurrencyInfos?i.WithdrawRule.DigitalCurrencyInfos.map(function(n){return{Id:n.Id,DcType:n.DigitalCurrency,BcType:n.BlockChain,Address:n.Address}}):[];t.mmPayDigitalCurrencyInfos=i.MmPayWithdrawRule.CollectionPaymentMerchantDigitalCurrencyInfos?i.MmPayWithdrawRule.CollectionPaymentMerchantDigitalCurrencyInfos.map(function(n){return{Id:n.Id,DcType:n.DigitalCurrency,BcType:n.BlockChain,Address:n.Address}}):[];t.withdrawMin=i.WithdrawRule.WithdrawMin;t.withdrawMax=i.WithdrawRule.WithdrawMax;t.alipayWithdrawMin=i.WithdrawRule.AlipayWithdrawMin;t.alipayWithdrawMax=i.WithdrawRule.AlipayWithdrawMax;t.digitalCurrencyWithdrawMin=i.WithdrawRule.DigitalCurrencyWithdrawMin;t.digitalCurrencyWithdrawMax=i.WithdrawRule.DigitalCurrencyWithdrawMax;t.digitalWalletWithdrawMin=i.WithdrawRule.DigitalWalletWithdrawMin;t.digitalWalletWithdrawMax=i.WithdrawRule.DigitalWalletWithdrawMax;t.withdrawSetting=i.MemberInfo.WithdrawSetting.filter(function(n){return n.Enable}).map(function(n){return{Id:n.Id,Name:n.TypeName,isShortcutEnable:!1}});t.isMmPayShelfFunctionSwitchEnable&&t.isMmPayFunctionSwitchEnable&&(t.collectionPaymentMerchantId?t.mmPayIsEnable&&!t.mmPayIsExistApplying:t.collectionPaymentMerchantApplyEnable)&&t.mainWithdrawMethods.push({text:t.langs.MMPay,value:2});t.mmPayWithdrawSetting=i.MmPayWithdrawRule.CollectionTypeSetting?i.MmPayWithdrawRule.CollectionTypeSetting.filter(function(n){return n.Enable}).map(function(n){return{Id:n.Id,Name:n.TypeName,Min:n.AmountMin,Max:n.AmountMax}}):[];p=i.MmPayWithdrawRule.DigitalCurrencyRelations;t.isAlipayWithdrawEnable=t.withdrawSetting.some(function(n){return n.Id==3});t.isDigitalCurrencyEnable=t.withdrawSetting.some(function(n){return n.Id==8});t.isMmPayDigitalCurrencyEnable=t.mmPayWithdrawSetting.some(function(n){return n.Id==8});t.withdrawSetting.some(function(n){return n.Id==12})&&(t.allDigitalWalletSubList=n[3].data.filter(function(n){return n.WithdrawEnable}),ot(i.WithdrawRule.DigitalWalletInfos||[]));ht();t.payTypeChange();getAuditRecords();setTimeout(function(){$("#inputAmount").focus()})});t.changeRecommentAmount=function(n){t.applyParams.amount=n;t.changeAmount()};t.setArrivalReturnView=function(n,r=false){t.isShowQrcodeBind=!1;t.withdrawalRespondViewType=n;n||(t.isSelectMmPay&&!t.mmPayIsExistApplying?(t.applyParams.mainWithdrawMethod=2,t.applyParams.mmpayType=t.mmPayWithdrawSetting[0].Id):t.applyParams.withdrawType=t.withdrawSetting[0].Id,t.payTypeChange());n==="mmPay"&&(r?i.post("/WithdrawApplication/Init").then(n=>{var i=n.data;i.MmPayWithdrawRespondInfo.ServerNow=resetDateTimeByTimezone(i.MmPayWithdrawRespondInfo.ServerNow);i.MmPayWithdrawRespondInfo.WaitingRespondList.length&&i.MmPayWithdrawRespondInfo.WaitingRespondList.forEach(function(n){n.ExpireTimeOfWaitingRespond=resetDateTimeByTimezone(n.ExpireTimeOfWaitingRespond)});t.mmPayWithdrawRespondInfo=i.MmPayWithdrawRespondInfo;t.hasMMPayDiscountSettings=t.mmPayWithdrawRespondInfo.DiscountSettings&&t.mmPayWithdrawRespondInfo.DiscountSettings.length>0;t.mmPayWithdrawRespondInfo.WaitingRespondList.length&&t.mmPayWithdrawRespondInfo.WaitingRespondList.forEach(function(n){n.isExpired=moment(n.ExpireTimeOfWaitingRespond).isBefore(t.mmPayServerNowTime)});t.mmPayWithdrawRespondInfo.BonusAmount=+t.mmPayWithdrawRespondInfo.BonusAmount.toFixed(2);t.mmPayWithdrawRespondInfo.totalPercent=k(t.mmPayWithdrawRespondInfo.DiscountSettings||[]);t.mmPayWithdrawRespondInfo.dealPercent=+(t.mmPayWithdrawRespondInfo.DealAmount/t.mmPayWithdrawRespondInfo.TotalAmount*100).toFixed(0);tt()}):tt());n==="normal"&&(d(),clearInterval(t.interval),t.interval=setInterval(function(){d()},1e3))};t.changeRespondData=function(n){clearInterval(t.mmPayInterval);t.nowMmPayRespondTradeId=n.TradeHistoryId;t.mmPayRespond=n;t.mmPayInputTitleText=b(t.mmPayWithdrawRespondInfo.FinanceCenterPaymentType);t.mmPayExpireTime=t.mmPayRespond.ExpireTimeOfWaitingRespond;it();t.mmPayInterval=setInterval(function(){it()},1e3)};t.payTypeChange=function(){t.HasWithdrawalOrder=!1;t.isShowDigitalWallet=!1;t.isShortcut=!1;t.applyParams.mainWithdrawMethod!==1&&(t.applyParams.withdrawType=t.withdrawSetting[0].Id);t.applyParams.mainWithdrawMethod!==2&&t.mmPayWithdrawSetting.length&&(t.applyParams.mmpayType=t.mmPayWithdrawSetting[0].Id);t.isSelectMmPay=t.applyParams.mainWithdrawMethod===2;let n=t.isSelectMmPay?t.applyParams.mmpayType:t.applyParams.withdrawType;if(n===1){let n=t.isSelectMmPay?t.mmPayWithdrawSetting.filter(function(n){return n.Id===1})[0].Min:t.withdrawMin,i=t.isSelectMmPay?t.mmPayWithdrawSetting.filter(function(n){return n.Id===1})[0].Max:t.withdrawMax;t.isSelectMmPay?t.mmPayBankAccounts.length?(t.isInsertBankNow&&t.changeIntoInsertBank(),t.bankAccounts=t.mmPayBankAccounts):(t.bankAccounts=[],t.changeIntoInsertBank()):t.normalBankAccounts.length?(t.isInsertBankNow&&t.changeIntoInsertBank(),t.bankAccounts=t.normalBankAccounts):(t.bankAccounts=[],t.changeIntoInsertBank());t.bankAccount=t.bankAccounts.length?t.bankAccounts[0]:{};t.accounts=t.bankAccounts.map(function(n){return n.text});t.nowSelect.Account=angular.copy(t.bankAccount.text);w(n,i)}if(n==3){let n=t.isSelectMmPay?t.mmPayWithdrawSetting.filter(function(n){return n.Id===3})[0].Min:t.alipayWithdrawMin,i=t.isSelectMmPay?t.mmPayWithdrawSetting.filter(function(n){return n.Id===3})[0].Max:t.alipayWithdrawMax;t.alipayAccount=t.isSelectMmPay?t.mmPayAliPay:t.normalAlipayAccount;w(n,i);return}if(n===8){let n=t.isSelectMmPay?t.mmPayWithdrawSetting.filter(function(n){return n.Id===8})[0].Min:t.digitalCurrencyWithdrawMin,i=t.isSelectMmPay?t.mmPayWithdrawSetting.filter(function(n){return n.Id===8})[0].Max:t.digitalCurrencyWithdrawMax;t.isSelectMmPay?t.mmPayDigitalCurrencyInfos&&t.mmPayDigitalCurrencyInfos.length>0?(t.hasDigitalCurrencyInfos=t.mmPayDigitalCurrencyInfos.length>0,t.DigitalCurrencyInfos=t.mmPayDigitalCurrencyInfos,t.addressList=t.DigitalCurrencyInfos.map(function(n){return n.Address}),t.DigitalCurrencyInfo=t.DigitalCurrencyInfos[0],t.nowSelect.Address=angular.copy(t.DigitalCurrencyInfo.Address)):(t.hasDigitalCurrencyInfos=!1,t.DigitalCurrencyInfos=[],t.addressList=[]):t.normalDigitalCurrencyInfos&&t.normalDigitalCurrencyInfos.length>0?(t.hasDigitalCurrencyInfos=t.normalDigitalCurrencyInfos.length>0,t.DigitalCurrencyInfos=t.normalDigitalCurrencyInfos,t.addressList=t.DigitalCurrencyInfos.map(function(n){return n.Address}),t.DigitalCurrencyInfo=t.DigitalCurrencyInfos[0],t.nowSelect.Address=angular.copy(t.DigitalCurrencyInfo.Address)):(t.hasDigitalCurrencyInfos=!1,t.DigitalCurrencyInfos=[],t.addressList=[]);t.isInsertDigitalCurrencyNow&&t.changeIntoInsertDigitalCurrency();t.isSelectMmPay?t.isMmPayDigitalCurrencyEnable&&(t.currencyTypes=p.map(function(n){return n.DigitalCurrency}),t.changeCurrencyType(),t.hasDigitalCurrencyInfos||t.changeIntoInsertDigitalCurrency()):t.isDigitalCurrencyEnable&&st();w(n,i);t.applyParams.amount&&t.changeAmount()}if(!t.isSelectMmPay&&(t.isShortcut=t.withdrawSetting.filter(function(t){return t.Id===n})[0].isShortcutEnable,t.isShortcut||n===12)){if(t.isInsertDigitalWalletNow=!1,t.isShowDigitalWallet=!0,t.isNeedInsert=!1,t.normalDigitalWalletInfos&&t.normalDigitalWalletInfos.length>0){t.hasDigitalWalletInfos=t.normalDigitalWalletInfos.length>0;t.DigitalWalletInfos=t.normalDigitalWalletInfos;t.digitalWalletCurrencyList=t.allDigitalWalletSubList.filter(function(n){return t.DigitalWalletInfos.some(function(t){return t.DigitalWalletCompanyId===n.DigitalWalletCompanyId})});let i=t.isShortcut?t.DigitalWalletInfos.some(function(t){return t.DigitalWalletCompanyId===n}):!0;i?(t.DigitalWalletInfo=t.isShortcut?t.DigitalWalletInfos.filter(function(t){return t.DigitalWalletCompanyId===n})[0]:t.DigitalWalletInfos[0],t.nowSelect.Address=angular.copy(t.DigitalWalletInfo.Address)):(t.DigitalWalletInfo=t.DigitalWalletInfos[0],t.nowSelect.Address=angular.copy(t.DigitalWalletInfo.Address),t.isNeedInsert=!0)}else t.hasDigitalWalletInfos=!1,t.DigitalWalletInfos=[],t.digitalWalletCurrencyList=[],t.isInsertDigitalWalletNow=!0;(t.isInsertDigitalWalletNow||t.isNeedInsert)&&t.changeIntoInsertDigitalWallet();w(t.digitalWalletWithdrawMin,t.digitalWalletWithdrawMax)}};t.changeIntoInsertBank=function(){t.isInsertBankNow=!t.isInsertBankNow;t.newBankAccount={Id:0,GroupBankId:t.banks[0].Id,BankName:t.banks[0],City:undefined,Province:undefined,Account:undefined}};t.changeIntoInsertDigitalCurrency=function(){t.isInsertDigitalCurrencyNow=!t.isInsertDigitalCurrencyNow;t.newDigitalCurrency={Id:0,DcType:t.isSelectMmPay?p[0].DigitalCurrency:y[0].DigitalCurrency,BcType:undefined,Address:undefined};t.changeCurrencyType();t.newDigitalCurrency.BcType=t.chains[0]};t.changeIntoInsertDigitalWallet=function(){t.isInsertDigitalWalletNow=!t.isInsertDigitalWalletNow;t.allInsertDigitalWalletSubList=t.allDigitalWalletSubList.filter(function(n){return!t.DigitalWalletInfos.some(function(t){return t.DigitalWalletCompanyId===n.DigitalWalletCompanyId})});let n=t.allInsertDigitalWalletSubList[0];if(t.isShortcut){let i=t.DigitalWalletInfos.some(function(n){return n.DigitalWalletCompanyId===t.applyParams.withdrawType});i||(n=t.allInsertDigitalWalletSubList.filter(function(n){return n.DigitalWalletCompanyId===t.applyParams.withdrawType})[0])}t.newDigitalWallet={Id:0,DigitalWalletCompanyId:n.DigitalWalletCompanyId,Address:undefined,name:n.Name,currencyName:n.CurrencyName,defaultImgPath:n.DefaultImgUrl,androidDownloadPath:n.AndroidDownloadPath,iosDownloadPath:n.IosDownloadPath,teachingLink:n.TeachingLink};t.nowSelectSub=n};t.changeSelectAccount=function(){let n={};n=t.isSelectMmPay?t.mmPayBankAccounts.filter(function(n){return n.text===t.nowSelect.Account})[0]:t.bankAccounts.filter(function(n){return n.text===t.nowSelect.Account})[0];t.bankAccount=n};t.changeSelectAddress=function(){let n={};n=t.isSelectMmPay?t.mmPayDigitalCurrencyInfos.filter(function(n){return n.Address===t.nowSelect.Address})[0]:t.DigitalCurrencyInfos.filter(function(n){return n.Address===t.nowSelect.Address})[0];t.DigitalCurrencyInfo=n};t.changeDigitalWalletSub=function(n){let i=t.DigitalWalletInfos.filter(function(t){return t.DigitalWalletCompanyId===n.DigitalWalletCompanyId})[0];t.DigitalWalletInfo=i;t.nowSelect.Address=i.Address};t.changeInsertDigitalWalletSub=function(n){t.nowSelectSub=n;t.newDigitalWallet.DigitalWalletCompanyId=t.nowSelectSub.DigitalWalletCompanyId;t.newDigitalWallet.Address=undefined;t.newDigitalWallet.name=t.nowSelectSub.Name;t.newDigitalWallet.currencyName=t.nowSelectSub.CurrencyName;t.newDigitalWallet.defaultImgPath=t.nowSelectSub.DefaultImgUrl;t.newDigitalWallet.androidDownloadPath=t.nowSelectSub.AndroidDownloadPath;t.newDigitalWallet.iosDownloadPath=t.nowSelectSub.IosDownloadPath;t.newDigitalWallet.teachingLink=t.nowSelectSub.TeachingLink;t.dropDown.isShow=!1};t.checkLastFourAccountAddress=function(){t.LastOrderWithdrawType===8&&t.checkAddress(!0)};t.checkAddress=function(n=false){t.addressIsValid=!0;t.omniIsValid=!0;t.trcIsValid=!0;t.ercIsValid=!0;let i=n?t.arrivalReturn.withdrawalLastFourAccount:t.newDigitalCurrency.Address;if(i){let r=n?t.LastOrderBlockChainType:t.newDigitalCurrency.BcType;switch(r){case"OMNI":let n=new RegExp(/^(1|3)[0-9A-Za-z]{1,}$/).test(i);t.addressIsValid=n;t.omniIsValid=n;break;case"TRC20":let r=new RegExp(/^(T)[0-9A-Za-z]{1,}$/).test(i);t.addressIsValid=r;t.trcIsValid=r;break;case"ERC20":let u=new RegExp(/^(0x)[0-9A-Za-z]{40}$/).test(i);t.addressIsValid=u;t.ercIsValid=u}}};t.updateBankName=function(){t.isValid=!0;t.chineseIsValid=!0;t.numberIsValid=!0;t.numberOrEmailIsValid=!0;t.emailIsValid=!0;t.newBankAccount.Account=""};t.updateAccount=function(){var i=t.newBankAccount.BankName.AccountFormat,n=t.newBankAccount.Account;if(n!=undefined)switch(i){case 1:if(t.chineseIsValid=new RegExp(/^[^\u4e00-\u9fa5]+$/).test(n),t.chineseIsValid)t.chineseIsValid=!0,t.isValid=!0;else{t.isValid=!1;return}break;case 2:if(t.numberIsValid=new RegExp(/^[0-9]+$/).test(n),t.numberIsValid)t.numberIsValid=!0,t.isValid=!0;else{t.isValid=!1;return}break;case 3:if(t.numberOrEmailIsValid=new RegExp(/^[0-9]+$/).test(n),t.numberOrEmailIsValid)t.numberOrEmailIsValid=!0,t.isValid=!0;else if(t.numberOrEmailIsValid=new RegExp(/^\w+((-\w+)|(\.\w+))*\@[A-Za-z0-9]+((\.|-)[A-Za-z0-9]+)*\.[A-Za-z]+$/).test(n),t.numberOrEmailIsValid)t.numberOrEmailIsValid=!0,t.isValid=!0;else{t.isValid=!1;return}break;case 4:if(t.emailIsValid=new RegExp(/^\w+((-\w+)|(\.\w+))*\@[A-Za-z0-9]+((\.|-)[A-Za-z0-9]+)*\.[A-Za-z]+$/).test(n),t.emailIsValid)t.emailIsValid=!0,t.isValid=!0;else{t.isValid=!1;return}}else t.isValid=!0,t.chineseIsValid=!0,t.numberIsValid=!0,t.numberOrEmailIsValid=!0,t.emailIsValid=!0};t.applyParams={mainWithdrawMethod:1,withdrawType:1};t.firstInsertBank=function(){if(!t.isValid){$("#newAccount").focus();return}let n="";n=t.isSelectMmPay?"/WithdrawApplication/CreateCollectionPaymentMerchantBankAccount":"/WithdrawApplication/CreateBankAccount";let r={GroupBankId:t.newBankAccount.BankName.Id,Province:t.newBankAccount.Province,City:t.newBankAccount.City,Account:t.newBankAccount.Account};i.post(n,r).then(function(n){var i=n.data;if(!i.IsSuccess){s.alertError(i.ErrorMessage);return}t.accounts=[];t.bankAccount={Id:i.ReturnObject,BankName:t.newBankAccount.BankName.Name,Province:t.newBankAccount.Province,City:t.newBankAccount.City,Account:t.newBankAccount.Account,text:`${t.newBankAccount.BankName.Name} (${t.newBankAccount.Account})`};t.isSelectMmPay?t.mmPayBankAccounts.push(t.bankAccount):t.normalBankAccounts.push(t.bankAccount);t.bankAccounts.push(t.bankAccount);t.nowSelect.Account=t.bankAccount.text;t.accounts.push(t.bankAccount.text);t.isInsertBankNow=!1})};t.firstInsertAlipay=function(){let n="";n=t.isSelectMmPay?"/WithdrawApplication/CreateCollectionPaymentMerchantAlipayAccount":"/WithdrawApplication/CreateAlipayAccount";let r={AlipayAccount:t.newAlipayAccount.Account,AlipayNickName:t.newAlipayAccount.NickName};i.post(n,r).then(function(n){var r=n.data;if(!r.IsSuccess){s.alertError(r.ErrorMessage);return}let i={AlipayAccount:t.newAlipayAccount.Account,AlipayNickName:t.newAlipayAccount.NickName,HasAlipayAccount:!0};t.isSelectMmPay?t.mmPayAliPay=i:t.normalAlipayAccount=i;t.alipayAccount=i})};t.firstInsertDigitalCurrency=function(){if(!t.addressIsValid){t.isShowApply=!1;$("#newAddress").focus();return}let n="";n=t.isSelectMmPay?"/WithdrawApplication/CreateCollectionPaymentMerchantDigitalCurrencyInfo":"/WithdrawApplication/CreateDigitalCurrencyInfo";let r={BlockChainType:t.newDigitalCurrency.BcType,DigitalCurrencyType:t.newDigitalCurrency.DcType,Address:t.newDigitalCurrency.Address};i.post(n,r).then(function(n){var i=n.data;if(!i.IsSuccess){s.alertError(i.ErrorMessage);return}t.addressList=[];t.DigitalCurrencyInfo={Id:i.ReturnObject,DcType:t.newDigitalCurrency.DcType,BcType:t.newDigitalCurrency.BcType,Address:t.newDigitalCurrency.Address};t.isSelectMmPay?t.mmPayDigitalCurrencyInfos.push(t.DigitalCurrencyInfo):t.normalDigitalCurrencyInfos.push(t.DigitalCurrencyInfo);t.DigitalCurrencyInfos.push(t.DigitalCurrencyInfo);t.nowSelect.Address=t.newDigitalCurrency.Address;t.addressList.push(t.newDigitalCurrency.Address);t.isInsertDigitalCurrencyNow=!1;t.hasDigitalCurrencyInfos=!0})};t.firstInsertDigitalWallet=function(){let n={DigitalWalletCompanyId:t.newDigitalWallet.DigitalWalletCompanyId,Address:t.newDigitalWallet.Address};i.post("/WithdrawApplication/CreateDigitalWalletAccount",n).then(function(n){var i=n.data;if(!i.IsSuccess){s.alertError(i.ErrorMessage);return}t.DigitalWalletInfo={Id:i.ReturnObject,DigitalWalletCompanyId:t.newDigitalWallet.DigitalWalletCompanyId,Address:t.newDigitalWallet.Address,name:t.newDigitalWallet.name,currencyName:t.newDigitalWallet.currencyName,defaultImgPath:t.newDigitalWallet.defaultImgPath};t.normalDigitalWalletInfos.push(t.DigitalWalletInfo);t.DigitalWalletInfos.push(t.DigitalWalletInfo);t.nowSelect.Address=t.newDigitalWallet.Address;let r=t.allDigitalWalletSubList.filter(function(n){return n.DigitalWalletCompanyId===t.DigitalWalletInfo.DigitalWalletCompanyId})[0];t.digitalWalletCurrencyList.push(r);t.isInsertDigitalWalletNow=!1;t.hasDigitalWalletInfos=!0})};t.submit=function(n){if(t.isShowApply=!0,!n.amount){s.alert("请填入取款金额");t.isShowApply=!1;return}if(t.max&&n.amount>t.max){s.alert("取款金额不得大於 "+f("customCurrency")(t.max));t.isShowApply=!1;return}if(t.isOverdraft()){s.alert("帐户额余不足");t.isShowApply=!1;return}let r=t.isSelectMmPay?n.mmpayType:n.withdrawType;if((t.isInsertBankNow||!t.bankAccounts.length)&&r===1||!t.alipayAccount.HasAlipayAccount&&r===3||(t.isInsertDigitalCurrencyNow||!t.hasDigitalCurrencyInfos)&&r===8||(t.isInsertDigitalWalletNow||!t.hasDigitalWalletInfos)&&(r===12||t.isShortcut)){let u="",f={};if(r===1){if(!t.isValid){$("#newAccount").focus();t.isShowApply=!1;return}u=t.isSelectMmPay?"/WithdrawApplication/CreateCollectionPaymentMerchantBankAccount":"/WithdrawApplication/CreateBankAccount";f={GroupBankId:t.newBankAccount.BankName.Id,Province:t.newBankAccount.Province,City:t.newBankAccount.City,Account:t.newBankAccount.Account}}else if(r===3)u=t.isSelectMmPay?"/WithdrawApplication/CreateCollectionPaymentMerchantAlipayAccount":"/WithdrawApplication/CreateAlipayAccount",f={AlipayAccount:t.newAlipayAccount.Account,AlipayNickName:t.newAlipayAccount.NickName};else if(r===8){if(!t.addressIsValid){t.isShowApply=!1;$("#newAddress").focus();return}u=t.isSelectMmPay?"/WithdrawApplication/CreateCollectionPaymentMerchantDigitalCurrencyInfo":"/WithdrawApplication/CreateDigitalCurrencyInfo";f={BlockChainType:t.newDigitalCurrency.BcType,DigitalCurrencyType:t.newDigitalCurrency.DcType,Address:t.newDigitalCurrency.Address}}else u="/WithdrawApplication/CreateDigitalWalletAccount",f={DigitalWalletCompanyId:t.newDigitalWallet.DigitalWalletCompanyId,Address:t.newDigitalWallet.Address};i.post(u,f).then(function(i){var u=i.data;if(!u.IsSuccess){s.alertError(u.ErrorMessage);t.isShowApply=!1;return}rt(r,n,u.ReturnObject)});return}rt(r,n)};t.apply=function(n){i.post("/WithdrawApplication/Apply",n).then(function(i){var r=i.data;t.isShowApply=!1;r.IsSuccess?(t.applyParams.amount=null,t.applyParams.leastAmount=null,t.applyParams.moneyPassword=null,t.isExistApplying=!0,t.isNeedWithdrawalRespond=!0,t.LastOrderWithdrawType=n.withdrawType,t.LastOrderBlockChainType=n.withdrawType===8?t.isInsertDigitalCurrencyNow?t.newDigitalCurrency.BcType:t.DigitalCurrencyInfo.BcType:null,t.errorMsg=" 取款申请审核中，不可重复申请",t.alertClass="alert-danger",t.withdrawalRespondInfo={WithdrawalRespondDiscount:r.ReturnObject.WithdrawalRespondDiscount||0,ExpireTimeOfWithdrawalRespond:resetDateTimeByTimezone(r.ReturnObject.ExpireTimeOfWithdrawalRespond),RemittanceState:!1,isExpired:!1,expireTimeOfAutoMatch:resetDateTimeByTimezone(r.ReturnObject.ExpireTimeOfAutoMatch),withdrawRespondIsMatching:!0,respondForWithdraw:""},t.serverNowTime=resetDateTimeByTimezone(r.ReturnObject.ServerNow),t.inputTitleText=b(t.LastOrderWithdrawType),t.setArrivalReturnView("normal")):s.alertError(r.ErrorMessage)})};t.mmPayApply=function(n){i.post("/WithdrawApplication/MmPayApply",n).then(function(n){var i=n.data;t.isShowApply=!1;i.IsSuccess?(t.applyParams.amount=null,t.applyParams.leastAmount=null,t.applyParams.moneyPassword=null,t.mmPayIsExistApplying=!0,t.withdrawalRespondViewType="mmPay",i.ReturnObject.MmPayWithdrawRespondInit.ServerNow=resetDateTimeByTimezone(i.ReturnObject.MmPayWithdrawRespondInit.ServerNow),i.ReturnObject.MmPayWithdrawRespondInit.WaitingRespondList.length&&i.ReturnObject.MmPayWithdrawRespondInit.WaitingRespondList.forEach(function(n){n.ExpireTimeOfWaitingRespond=resetDateTimeByTimezone(n.ExpireTimeOfWaitingRespond)}),t.mmPayWithdrawRespondInfo=i.ReturnObject.MmPayWithdrawRespondInit,t.hasMMPayDiscountSettings=t.mmPayWithdrawRespondInfo.DiscountSettings&&t.mmPayWithdrawRespondInfo.DiscountSettings.length>0,t.mmPayWithdrawRespondInfo.BonusAmount=+t.mmPayWithdrawRespondInfo.BonusAmount.toFixed(2),t.mmPayWithdrawRespondInfo.totalPercent=k(t.mmPayWithdrawRespondInfo.DiscountSettings||[]),t.mmPayWithdrawRespondInfo.dealPercent=0):s.alertError(i.ErrorMessage)})};t.showCalculation=function(n){t.isShowCalculation=n};t.showMinimalAmount=function(){t.isShowMinimalAmount=!0};t.isOverdraft=function(){return t.$eval("balance - applyParams.amount - fee - adFee - TotalDiscountCancel < 0")};t.isWithdrawal=function(){return t.$eval("balance - applyParams.amount - adFee - fee - TotalDiscountCancel < min")};getAuditRecords=function(){i.post("/WithdrawApplication/AdministrationDetail",null).then(function(n){t.auditRecords=n.data||[];var i=t.auditRecords.filter(function(n){return n.IsAudit===!1}),r=t.auditRecords.filter(function(n){return n.IsDiscountAudit===!1});t.auditDetail={count:t.auditRecords.length,depositAuditFailedCount:i.length,totalAdministrationAmount:i.reduce(function(n,t){return n+t.Administration},0),discountAuditFailedCount:r.length,totalDiscountCancelAmount:r.reduce(function(n,t){return n+t.DiscountCancel},0)}})};t.showAdministrationFeeDialog=function(){u.open({templateUrl:"/WithdrawApplication/AdministrationFeeDialog",controller:"WithdrawApplicationAdministrationFeeDialogCtrl",windowClass:"ad-fee-dialog",resolve:{auditRecords:function(){return t.auditRecords}}}).result.then(function(){},function(){})};t.showApplyMethodDialog=function(){u.open({templateUrl:"/WithdrawApplication/ApplyWithdrawMethodDialog",controller:"WithdrawApplicationApplyWithdrawMethodDialogCtrl",windowClass:"apply-dialog"}).result.then(function(n){n&&(angular.extend(t.alipayAccount,n),t.alipayAccount.HasAlipayAccount=!0)})};t.changeCurrencyType=function(){let i=t.isSelectMmPay?p:y;for(var n=0;n<i.length;n++)i[n].DigitalCurrency===(t.isInsertDigitalCurrencyNow?t.newDigitalCurrency.DcType:t.DigitalCurrencyInfo.DcType)&&(t.maxDigitalCurrencyCount=3*i[n].BlockChains.length,t.chains=i[n].BlockChains.filter(function(n){return t.DigitalCurrencyInfos.filter(function(t){return t.BcType===n}).length<3}));!t.applyParams.amount||t.changeAmount()};t.changeAmount=function(){if(t.isSelectMmPay?t.applyParams.mmpayType===8:t.applyParams.withdrawType===8){if(!t.applyParams.amount){t.exchangeAmount=0;return}let n="";n=t.DigitalCurrencyInfo.DcType;(!t.hasDigitalCurrencyInfos||t.isInsertDigitalCurrencyNow)&&(n=t.newDigitalCurrency.DcType);i.post("/BlockChain/TransferCurrency",{currencyFrom:"CNY",currencyTo:n,amount:t.applyParams.amount,isBuy:!1}).then(function(n){t.exchangeAmount=n.data.ReturnObject})}};t.withdrawRespond=function(){let n="";t.withdrawalRespondInfo.respondForWithdraw&&(n+=t.langs.PleaseCheck+'「<span class="text-danger" style="font-weight: bold; font-size: 15px;word-break: break-all;">'+t.inputTitleText+"："+t.withdrawalRespondInfo.respondForWithdraw+"<\/span>」<br />");n+=t.langs.CompleteReturnConfirm;s.confirm(n).then(function(n){if(n){if(!t.addressIsValid){$("#lastFourAccount").focus();return}t.isProcessing||(t.isProcessing=!0,i.post("/WithdrawApplication/WithdrawalRespond",null).then(function(n){const i=n.data;if(t.isProcessing=!1,i.IsSuccess===!1){s.alertError(i.ErrorMessage).then(function(){r.location.href="/"});return}r.location.href="/"}))}})};t.cancelWithdrawRespond=function(){i.post("/WithdrawApplication/CancelWithdrawalRespond",null).then(function(n){const t=n.data;if(t.IsSuccess===!1){s.alertError(t.ErrorMessage);return}r.location.reload()})};t.backToWithdraw=function(){t.isShowJoinToMMPay=!1};t.showJoinToMMPay=function(){t.hasApplyingCollectionPaymentMerchant||(t.mmpay.isReadJoinMMPayRule=!0,t.isShowJoinToMMPay=!t.isShowJoinToMMPay)};t.checkMMPayDisabled=function(){return!t.mmpay.isReadJoinMMPayRule||t.applyMMPaying};t.applyMMPay=function(){t.applyMMPaying=!0;i.post("/VerifyCollectionPaymentMerchant/Apply",null).then(function(n){const i=n.data;if(t.applyMMPaying=!1,i.IsSuccess===!1){s.alertError(i.ErrorMessage);return}t.isApplyMMPay=!0;t.hasApplyingCollectionPaymentMerchant=!0;t.isShowQrcodeBind=!1;o.isNotJoinMmPay=!1})};t.mmPayBackToWithdrawRespond=function(){window.location.reload()};t.mmPayWithdrawRespond=function(){let n="";n+=t.langs.PleaseCheck+'「<span class="text-danger" style="font-weight: bold; font-size: 15px;word-break: break-all;">'+t.mmPayInputTitleText+"："+t.mmPayRespond.LastFourWordMessage+"<\/span>」<br />";n+=t.langs.CompleteReturnConfirm;s.confirm(n).then(function(n){if(n){let r={tradeHistoryId:t.mmPayRespond.TradeHistoryId,userOrderId:t.mmPayRespond.SourceOrderId};i.post("/WithdrawApplication/MmPayWithdrawalRespond",r).then(function(n){const i=n.data;if(i.IsSuccess===!1){s.alertError(i.ErrorMessage).then(function(){window.location.reload()});return}if(i.ReturnObject.WithdrawRespondInfo.ServerNow=resetDateTimeByTimezone(i.ReturnObject.WithdrawRespondInfo.ServerNow),i.ReturnObject.WithdrawRespondInfo.WaitingRespondList.length&&i.ReturnObject.WithdrawRespondInfo.WaitingRespondList.forEach(function(n){n.ExpireTimeOfWaitingRespond=resetDateTimeByTimezone(n.ExpireTimeOfWaitingRespond)}),t.mmPayWithdrawRespondInfo=i.ReturnObject.WithdrawRespondInfo,t.hasMMPayDiscountSettings=t.mmPayWithdrawRespondInfo.DiscountSettings&&t.mmPayWithdrawRespondInfo.DiscountSettings.length>0,t.mmPayWithdrawRespondInfo.BonusAmount=+t.mmPayWithdrawRespondInfo.BonusAmount.toFixed(2),t.mmPayWithdrawRespondInfo.totalPercent=k(t.mmPayWithdrawRespondInfo.DiscountSettings||[]),t.mmPayWithdrawRespondInfo.dealPercent=+(t.mmPayWithdrawRespondInfo.DealAmount/t.mmPayWithdrawRespondInfo.TotalAmount*100).toFixed(0),t.mmPayWithdrawRespondInfo.DealAmount===t.mmPayWithdrawRespondInfo.TotalAmount){t.mmPayIsExistApplying=!1;t.mmPayIsFinish=!0;t.isShowQrcodeBind=!1;return}t.mmPayWithdrawRespondInfo.WaitingRespondList=t.mmPayWithdrawRespondInfo.WaitingRespondList.filter(function(n){return n.TradeHistoryId!==t.mmPayRespond.TradeHistoryId});t.setArrivalReturnView("mmPay")})}})};t.showQrcodeBind=function(n=false){t.isApplyingQrcodeBind=!1;t.isExpired=!1;t.isShowQrcodeBind=!t.isShowQrcodeBind;n&&(t.isApplyingQrcodeBind=!0);t.isShowQrcodeBind&&(ft(),t.appDownloadUrl||i.post("/WithdrawApplication/GetCollectionPaymentDownloadUrl").then(function(n){const i=n.data;t.appDownloadUrl=i.DownloadUrl;t.appDownloadQrCode=i.DownloadQrCode}))};t.reloadQrcode=function(){ft()};t.saveBindQrcodeImg=function(){const n=document.createElement("a");n.href="data:image/png;base64,"+t.bindQrCode;n.setAttribute("download","qrcode.png");n.click();n.remove()};t.openMMPayDiscountSettingModal=function(){u.open({templateUrl:"/WithdrawApplication/MmPayDiscountSettingDialog",controller:"WithdrawApplicationMmPayDiscountSettingDialogCtrl",windowClass:"modal-mmpay-discount-setting",resolve:{withdrawType:function(){return t.mmPayIsExistApplying?t.mmPayWithdrawRespondInfo.FinanceCenterPaymentType:t.applyParams.mmpayType}}}).result.then(function(){},function(){})}}]);app.controller("ForgotPwdDialogCtrl",["$http","$rootScope","$scope","$window","$timeout","$interval","$modal","$modalInstance","labelService","CustomModalService",function(n,t,i,r,u,f,e,o,s,h){i.langs=s.get("ForgetPassword");i.params={};i.isProcessing=!1;i.dismiss=function(){o.dismiss()};i.close=function(){o.close()};n.post("/Register/GetRegisterSetting").then(function(n){var t=n.data;if(t.IsSuccess===!1){h.alertError(t.ErrorMessage);return}i.accountSetting=t.AccountRule});i.params.CountryCode=t.defaultCountryCode;i.CountryCodes=[{Id:1,Name:"日本",Code:"+81"},{Id:2,Name:"中國",Code:"+86"}].filter(function(n){return n.Code===t.defaultCountryCode});i.submit=function(){var r,u;if(!i.isProcessing){if(r=new RegExp(i.accountSetting.Pattern).test(i.params.Account),!r){h.alert(s.get("Register.Account_Error")||"会员帐号格式错误");return}if(u=i.params.Mobile?new RegExp("^[0-9]+$").test(i.params.Mobile):!0,!u){h.alert(s.get("Register.Mobile_Error")||"手机号码格式错误");return}let t={Account:i.params.Account,CountryCode:i.params.CountryCode,Phone:i.params.Mobile};i.isProcessing=!0;n.post("/User/ForgotPassword",t).then(function(n){var r=n.data;if(i.isProcessing=!1,r.IsSuccess===!1){h.alertError(r.ErrorMessage);return}e.open({templateUrl:"/Account/ChangePwdSmsAuthenticationDialog",controller:"ChangePwdSmsAuthenticationDialogCtrl",windowClass:"modal-cpsad",backdrop:"static",resolve:{info:function(){return{account:t.Account,countryCode:t.CountryCode,mobile:t.Mobile,maskMobile:r.ReturnObject.MaskedPhoneNumber,expireTime:r.ReturnObject.ExpireTime,isChangeMoneyPwd:!1}}}}).result.then(function(n){e.open({templateUrl:"/Account/ChangePwdDialog",controller:"ChangePwdDialogCtrl",windowClass:"modal-cpd",backdrop:"static",resolve:{info:function(){return{account:t.Account,token:n.token,isChangeMoneyPwd:!1}}}}).result.then(function(){i.close()})})})}}}]);app.controller("GameMaintenanceCtrl",["$scope","$http","$compile","$timeout","$filter","LobbyNavService","gameNavigationSortService","CookieService",function(n,t,i,r,u,f,e,o){function a(){t.post("/GameNavigationSort/GetMaintenanceGames",{gameSupplierType:parseInt(_sup),gameCategoryType:parseInt(_cate),gameKind:_kind}).then(function(t){n.games=t.data;for(var i=0;i<n.games.length;i+=s)h.push(n.games.slice(i,i+s));v()})}function v(){for(var t,o,a="",f=0;f<h.length;f++){for(t="<ul>",o=0;o<h[f].length;o++){var v=f*s+o,y=e.getEntranceImageUrl(n.games[v],l),p='<li class="entrance" ng-click="openLink('+v+')">    <img ng-src="'+u("filterCdn")(y,"https://cdn.fidlite.com/")+'" />    <span>'+n.games[v].DisplayName+"<\/span><\/li>";t=t+p}t=t+"<\/ul>";a=a+t}r(function(){$(".slider-section").append(a);$(".slider-section").slick(c);i($(".slider-section").contents())(n)})}function y(t){var i=n.games[t].Url,r=n.games[t].Name,u=n.games[t].IsEmbedded;f.openLobbyNav(i,r,u)}var c={dots:!0,autoplay:!0,autoplaySpeed:5e3,slidesToShow:1,slidesToScroll:1,arrows:!0,prevArrow:'<button type="button" class="slick-prev"><\/button>',nextArrow:'<button type="button" class="slick-next"><\/button>'},s=10,h=[],l=0;n.games=[];n.ip=o.getCookie("clientIp");n.openLink=y;n.isTrial=_IsTrial;a()}]);app.controller("GoogleAuthenticatorConfigDialogCtrl",["$http","$scope","$window","$timeout","$interval","$modalInstance","type","authInfo","CustomModalService",function(n,t,i,r,u,f,e,o,s){function h(){var n=u(function(){typeof ClipboardJS=="function"&&(u.cancel(n),new ClipboardJS(".copy-btn"))},100)}function c(n){i.open(n,"_blank")}function l(){var i,r;if(!t.isProcessing){if(t.isProcessing=!0,e==="login"){i={account:t.authInfo.Account,token:t.authInfo.Token,pin:t.params.pin};n.post("/Account/BindingGoogleAuthenticator",i).then(function(n){var i=n.data;if(i.IsSuccess===!1){s.alertError(i.ErrorMessage).then(function(){t.isProcessing=!1});return}t.isProcessing=!1;f.close(!0)});return}r={pin:t.params.pin};n.post("/GoogleAuthenticator/Bind",r).then(function(n){var i=n.data;if(i.IsSuccess===!1){s.alertError(i.ErrorMessage).then(function(){t.isProcessing=!1});return}t.isProcessing=!1;t.page="bindSuccess"})}}function a(){f.close()}function v(){t.showCopyAfter=!0;r(function(){t.showCopyAfter=!1},500)}t.params={};t.page="set";t.isProcessing=!1;t.showCopyAfter=!1;t.type=e;t.submit=l;t.closed=a;t.authInfo=o;t.copyAnimation=v;t.openDownloadLink=c;t.showAndroidLink=t.authInfo.EagleAuthAndroidUrl&&t.authInfo.EagleAuthAndroidUrl!=="None";t.showIosLink=t.authInfo.EagleAuthIosUrl&&t.authInfo.EagleAuthIosUrl!=="None";t.showAppLink=t.showAndroidLink?"android":t.showIosLink?"ios":"None";h()}]);app.controller("GoogleAuthenticatorCtrl",["$q","$http","$scope","$modal","$window","CustomModalService","labelService",function(n,t,i,r,u,f,e){function o(){n.all([t.post("/Account/GetGoogleAuthenticatorQrCodeUrl",null),t.post("/GoogleAuthenticator/GetStatus",null)]).then(function(n){i.qrcodeInfo=n[0].data;i.status=n[1].data;i.isEnable=!0})}function s(){if(!i.isSwitching){if(i.status){var n='<br/><a href="javascript:void(0)" line-chat-click="Live800LinkReview"><i class="fas fa-headphones"><\/i> '+e.get("Register.ContactCustomerService")||"联系客服<\/a>";f.alert((e.get("GoogleAuthenticator.CancelVerificationTip")||"如欲解除，请联系客服人员。")+n);return}if(i.status=!i.status,i.isSwitching=!0,i.status===!1){f.prompt(e.get("Account.Enter_GoogleAuthenticatorCode")||"请输入二次验证器验证码").then(function(n){if(!n){i.status=!i.status;i.isSwitching=!1;return}var r={pin:n};t.post("/GoogleAuthenticator/UnBind",r).then(function(n){var t=n.data;if(i.isSwitching=!1,t.IsSuccess===!1){f.alertError(t.ErrorMessage).then(function(){i.status=!i.status});return}})});return}h()}}function h(){i.isBinding=!0;t.post("/GoogleAuthenticator/EnableGoogleAuthenticator",null).then(function(n){if(n.data.IsSuccess===!1){f.alertError(n.data.ErrorMessage).then(function(){u.location.reload()});return}var t={EagleAuthAndroidUrl:i.qrcodeInfo.EagleAuthAndroidUrl,EagleAuthIosUrl:i.qrcodeInfo.EagleAuthIosUrl,EagleAuthAndroidQrCodeUrl:i.qrcodeInfo.EagleAuthAndroidQrCodeUrl,EagleAuthIosQrCodeUrl:i.qrcodeInfo.EagleAuthIosQrCodeUrl,TutorialUrl:i.qrcodeInfo.TutorialUrl,GoogleAuthenticator:n.data.QrCodeBase64String,ManualEntryKey:n.data.ManualEntryKey};r.open({templateUrl:"/Account/GoogleAuthenticatorConfigDialog",controller:"GoogleAuthenticatorConfigDialogCtrl",windowClass:"modal-gac",resolve:{authInfo:function(){return t},type:function(){return"bind"}}}).result.then(function(){i.isBinding=!1;i.isSwitching=!1},function(){i.isBinding=!1;i.isSwitching=!1;i.status=!i.status})})}i.isEnable=null;i.status=!1;i.isSwitching=!1;i.isBinding=!1;i.qrcodeInfo={};i.switchAuth=s;t.post("/GoogleAuthenticator/IsEnable",null).then(function(n){var t=n.data.Enable;if(!t){i.isEnable=!1;return}o()})}]);app.controller("HomeCtrl",["$scope","$element","$window","$http","$interval",function(n,t,i,r,u){function o(){f&&u.cancel(f);f=u(function(){n.selectedImg=n.selectedImg==e?1:n.selectedImg+1},3e3)}var f,e;n.slideBannerClick=function(){i.open("/Promotion","_self","resizable,scrollbars=yes")};r.post("/Cdn/GetSlider").then(function(t){var i=t.data;e=i.length;n.slideImgs=i;o()});n.changeSelected=function(t){n.selectedImg=t+1;o()}}]);app.controller("JackPotActivityCtrl",["$scope","$modal","$filter","$window","$timeout","$location","$rootScope","labelService","signalrService","LobbyNavService","CustomModalService","GenericGameService","SiteSettingService","LoginRedirectService","JackPotActivityService",function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y){function d(){if(n.isLoading=!0,n.preview){et();return}if(!_IsLogin){v.goLogin();return}y.getStatus().then(function(t){if(n.status=t,g(),n.status===0||t===!1){n.isDisabled=!0;n.isLoading=!1;return}if(n.status===5){w();n.isLoading=!1;return}y.getActivityInfo().then(function(t){if(t.IsSuccess===!1){c.alertError(t.ErrorMessage);n.isDisabled=!0;n.isLoading=!1;return}var i=t.ReturnObject;tt(i);switch(n.status){case 2:ot();break;case 4:ht();it();b(!0);vt()}})})}function g(){a.getSiteTitleSingleton().then(function(t){if(n.status===0){document.title=t.PortalSiteName;return}if(n.preview){document.title=t.PortalSiteName+" - "+n.activity.name;return}y.getActivityName().then(function(n){if(n.IsSuccess===!1){c.alertError(n.ErrorMessage);return}document.title=t.PortalSiteName+" - "+n.ReturnObject})})}function et(){r.addEventListener("message",nt,!1);r.opener.postMessage("message",f.search().jackPotActivity)}function nt(t){var i=t.data;tt(i);rt(i);n.status=4;g();it();b();r.removeEventListener("message",nt,!1)}function tt(t){n.activity.name=t.Name;n.activity.subTitle=t.SubTitle;n.activity.startDate=t.ActivityStartDate;n.activity.endDate=t.ActivityEndDate;n.activity.description=t.Description;n.activity.remind=t.Remind;n.activity.commissionable=t.Commissionable;n.activity.joinGames=t.JoinGames;n.activity.multipleGames=t.MultipleGames;n.startDateBeijing=moment(t.ActivityStartDate).add(12,"hours");n.endDateBeijing=moment(t.ActivityEndDate).add(12,"hours");n.isLoading=!1}function ot(){y.getJoinDifference().then(function(t){if(t.IsSuccess===!1){c.alertError(t.ErrorMessage);return}n.JoinDifference=t.ReturnObject})}function it(){l.getCategoryKey("活动推荐游戏").then(function(n){categoryKey=n;var t={NameKeyword:"",CategoryKey:categoryKey,IsMobile:!1};return l.getGames(0,15,t)}).then(function(t){n.games=n.games.concat(t.Games);u(function(){$(".game-box").slide({mainCell:".main-cell >",effect:"leftLoop",autoPlay:!0,vis:5})},400)})}function st(n){var t=l.getGameInfo(n,categoryKey);h.openLobbyNav(t.action,t.supplier)}function ht(){y.getStageInfo().then(function(n){if(n.IsSuccess===!1){c.alertError(n.ErrorMessage);return}rt(n.ReturnObject)})}function rt(t){n.stageInfo.basicJackPotAmount=t.BasicJackPotAmount;n.stageInfo.nextStageMultiple=t.NextStageMultiple;n.stageInfo.nextStageDiff=t.NextStageDiff;n.stageInfo.canReceiveAmount=t.CanReceiveAmount;n.stageInfo.isFinalStage=t.IsFinalStage;n.stageInfo.stageList=t.StageList;n.progress=t.NextStageDiff===0?100:ct()}function ct(){var t=n.stageInfo.stageList.filter(function(t){return t.Multiple===n.stageInfo.nextStageMultiple});return t.length>0?(t[0].Commissionable-n.stageInfo.nextStageDiff)/t[0].Commissionable*100:0}function lt(){at();b()}function at(){n.activityWallet.canUpdate!==!1&&(n.refreshBtn.isSpin=!0,u(function(){n.refreshBtn.isSpin=!1},2e3))}function b(t){(n.preview&&(n.activityWallet.money=0,n.activityWallet.canUpdate=!1),n.activityWallet.canUpdate!==!1)&&(n.activityWallet.canUpdate=!1,y.getActivityWallet(t).then(function(i){if(i.IsSuccess===!1){c.alertError(i.ErrorMessage);return}t?n.activityWallet.canUpdate=!0:u(function(){n.activityWallet.canUpdate=!n.activityWallet.canUpdate},3e4);n.activityWallet.money=i.ReturnObject}))}function vt(){s.on("updateActivityBalance",function(t){n.activityWallet.money=t})}function yt(i){t.open({templateUrl:"viewGameModal",windowClass:"modal-viewGame customized",resolve:{type:function(){return i},langs:function(){return n.langs},activity:function(){return n.activity}},controller:["type","langs","activity","$scope","$modalInstance",function(n,t,i,r,u){function f(n){switch(n){case 1:return r.langs.Live;case 2:return r.langs.Sports;case 3:return r.langs.Lottery;case 4:return r.langs.Slot;case 5:return r.langs.Board;case 6:return r.langs.Fish}}r.type=n;r.langs=t;r.activity=i;r.translateKind=f;r.close=u.dismiss}]}).result.then(function(){},function(){})}function pt(){p||(p=!0,y.joinCheck().then(function(t){if(t.IsSuccess===!1){c.alertError(t.ErrorMessage);p=!1;return}if(t.ReturnObject===!0){c.confirm(n.langs.JoinConfirm).then(function(n){if(!n){p=!1;return}ut()});return}ut()}))}function ut(){n.triggerStatus=!n.triggerStatus;gt();y.joinActivity().then(function(t){if(t.IsSuccess===!1){c.alertError(t.ErrorMessage).then(function(){n.triggerStatus=!n.triggerStatus;p=!1});return}var i=t.ReturnObject;wt(i.BasicJackPotAmount);u(function(){n.showWinAnimate=!n.showWinAnimate;n.triggerStatus=!n.triggerStatus},800);u(function(){n.showWinAnimate=!n.showWinAnimate;n.digitalDom="";bt(i);p=!1},3e3)})}function wt(t){for(var u=(""+i("customCurrency")(t)).replace(/\s/g,""),r=0;r<u.length;r++)switch(u[r]){case"$":n.digitalDom+='<div class="number number-dollar"><\/div>';break;case",":n.digitalDom+='<div class="number number-thousand"><\/div>';break;case".":n.digitalDom+='<div class="number number-point"><\/div>';break;default:n.digitalDom+='<div class="number number-'+u[r]+'"><\/div>'}}function w(){n.status=5}function bt(i){t.open({templateUrl:"luckyDrawModal",windowClass:"modal-luckyDraw customized",resolve:{join:function(){return i},langs:function(){return n.langs},activity:function(){return n.activity}},controller:["join","langs","activity","$scope","$modalInstance",function(n,t,i,r,u){r.langs=t;r.activity=i;r.nextStageDiff=n.NextStageDiff;r.basicJackPotAmount=n.BasicJackPotAmount;r.nextStageMultiple=n.NextStageMultiple;r.abandon=function(){u.close()};r.continueActivity=function(){u.dismiss()}}]}).result.then(function(){k()},function(){d()})}function kt(){t.open({templateUrl:"jackpotModal",windowClass:"modal-jackpot customized",resolve:{langs:function(){return n.langs},preview:function(){return n.preview},stageInfo:function(){return n.stageInfo},activity:function(){return n.activity},activityWallet:function(){return n.activityWallet},openConfirmModal:function(){return n.openConfirmModal},updateActivityWallet:function(){return n.updateActivityWallet},refreshBtn:function(){return n.refreshBtn}},controller:["langs","preview","activity","stageInfo","activityWallet","openConfirmModal","updateActivityWallet","refreshBtn","$scope","$modalInstance",function(n,t,i,r,f,e,o,s,h,l){var a=!1;h.langs=n;h.preview=t;h.activity=i;h.stageInfo=r;h.activityWallet=f;h.openConfirmModal=e;h.updateActivityWallet=o;h.refreshBtn=s;h.close=l.dismiss;h.canReceive=function(){return r.stageList.filter(function(n){return n.ReceivedStatus===1}).length>0};h.receive=function(){a||(a=!0,y.receive().then(function(n){if(n.IsSuccess===!1){c.alertError(n.ErrorMessage).then(function(){location.reload()});return}angular.forEach(r.stageList,function(n){n.ReceivedStatus===1&&(n.transition=!0,u(function(){n.transition=!1;n.ReceivedStatus=2},400))});u(function(){a=!1},400);h.activityWallet.money=n.ReturnObject}))};h.$on("closeJackpotModal",function(){l.close()})}]}).result.then(function(){},function(){var t=n.stageInfo.stageList.filter(function(n){return n.ReceivedStatus<2}).length===0;t&&w()})}function dt(){p||(p=!0,y.getAbandonInfo().then(function(i){if(i.IsSuccess===!1){c.alertError(i.ErrorMessage).then(function(){p=!1});return}var r=i.ReturnObject;t.open({templateUrl:"confirmModal",windowClass:"modal-confirm customized",resolve:{langs:function(){return n.langs},activity:function(){return n.activity},abandonInfo:function(){return r}},controller:["langs","activity","abandonInfo","$scope","$modalInstance",function(n,t,i,r,u){r.langs=n;r.activity=t;r.abandonInfo=i;r.abandon=function(){e.$broadcast("closeJackpotModal");u.close()};r.close=function(){u.dismiss()}}]}).result.then(function(){k()},function(){p=!1})}))}function k(){y.abandon().then(function(n){if(n.IsSuccess===!1){c.alertError(n.ErrorMessage).then(function(){location.reload()});return}var t=n.ReturnObject;w()})}function gt(){u(function(){var n=$(".coin-col").length;for(let t=0;t<n;t++)u(function(){ft(t)},t*30)},500)}function ft(t){if(n.triggerStatus){var i=$(".coin-col:nth-child("+(t+1)+")");i.animate({top:-236},300,"linear",function(){i.css("top",-866);ft(t)})}}function ni(){r.close()}s.connect();var p=!1;n.games=[];n.activity={};n.stageInfo={};n.digitalDom="";n.status;n.isDisabled=!1;n.JoinDifference;n.isLoading=!0;n.isFinalStage=!1;n.triggerStatus=!1;n.showWinAnimate=!1;n.dateFormat="YYYY/MM/DD HH:mm:ss";n.preview=f.search().jackPotActivity;n.refreshBtn={isSpin:!1};n.activityWallet={canUpdate:!0,money:null};n.langs=o.get("JackPotActivity");n.langs.Loading=o.get("Common.Loading");n.toGame=st;n.trigger=pt;n.complete=w;n.openGameModal=yt;n.abandon=k;n.openJackpotModal=kt;n.openConfirmModal=dt;n.updateActivityWallet=lt;n.closeWindow=ni;d()}]);app.controller("JackPotActivityWalletDialogCtrl",["$q","$scope","$modalInstance","labelService","JackPotActivityService",function(n,t,i,r,u){function f(){n.all([u.getActivityWallet(),u.getStageInfo(),u.getStatus()]).then(function(n){(t.hasActivity=n[2]===4,t.isLoading=!1,t.balance=n[0].ReturnObject,n[1].IsSuccess!==!1)&&(t.basicAmount=n[1].ReturnObject.BasicJackPotAmount)})}function e(){i.dismiss()}t.balance;t.basicAmount=null;t.isLoading=!0;t.hasActivity=!1;t.langs=r.get("JackPotActivity");t.langs.Loading=r.get("Common.Loading");t.langs.ContactService=r.get("Common.ContactService");t.langs.NotJoinEvent=r.get("TimeLimitedEvent.NotJoinEvent");t.dismiss=e;f()}]);app.controller("LayoutCtrl",["_env","$rootScope","$modal","$location","$scope","$timeout","$window","$state","$http","$filter","AnnouncementService","ContactInfoService","MeidonTimeService","CustomModalService","SystemNumberService","WelcomeOfferService","ActivityEntranceService","FunctionSwitchService","signalrService","labelService",function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d){function it(){t.userInfo&&t.userInfo.isLogin&&!t.userInfo.isTrial&&s.post("/Account/GetChangePasswordPageStatus",null).then(function(n){var t=n.data;t.Status!==0&&(e.location.href="/MemberCenter/#/MemberCenter/ChangePassword")})}function tt(n){i.open({templateUrl:"/Login/MmPayOrderResultDialog",controller:"MmPayOrderResultDialogCtrl",windowClass:"mmpay-order-result-modal",resolve:{data:function(){return n}}}).result.then(function(){},function(){})}function rt(){function n(t){var r=t.data.ReturnObject,u=i.open({templateUrl:"/PyramidAgent/index",controller:"PyramidAgentDialogCtrl",windowClass:"pyramid-agent-dialog",resolve:{previewObject:function(){return r}}});e.removeEventListener("message",n,!1)}e.addEventListener("message",n,!1);e.opener.postMessage("message",nt)}function ut(){var n=t.userInfo&&t.userInfo.isLogin;if(n){let i=g.filter(function(n){return n===e.location.pathname}).length;if(i!==0){let r=p.checkNeverPopupCookieExist();p.getSwitch().then(function(n){!r&&n&&et()})}}}function ft(){var n=t.userInfo&&t.userInfo.isLogin;if(n){let r=g.filter(function(n){return n===e.location.pathname}).length;r!==0&&(u.oneClickFunctionSwitch=!1,b.getEnableFunctionSwitch().then(function(n){u.oneClickFunctionSwitch=n.OneClickToReceiveAllActivityReward}).then(function(){w.getSwitchSingleton().then(function(n){let t=u.oneClickFunctionSwitch?n.some(function(n){return n.isReceiveAll}):!1;t&&i.open({templateUrl:"/Login/ReceiveAllDialog",controller:"ReceiveAllDialogCtrl",windowClass:"receive-all-modal"}).result.then(function(){},function(){})})}))}}function et(){i.open({templateUrl:"/Login/WelcomeOfferDialog",controller:"WelcomeOfferDialogCtrl",windowClass:"welcome-offer-modal"}).result.then(function(){},function(){})}function ot(){var n=sessionStorage.getItem("needAskBinding")==="true",i=t.userInfo&&t.userInfo.isLogin;sessionStorage.removeItem("needAskBinding");n&&i&&st()}function st(){i.open({templateUrl:"/Login/BindingTipDialog",controller:"BindingTipDialogCtrl",windowClass:"modal-ald"}).result.then(function(){},function(){})}var nt=r.search().pyramidAgent,g;nt&&rt();u.env=n.LayoutCtrl;g=n.PopupPages||["/"];a.on(function(n){u.meiDonNow=n});l.getContactInfo().then(function(n){u.ContactInfo=n});k.connect();k.on("MmPay_OrderTaking",function(n){i.open({templateUrl:"/Login/MmPayOrderTakeDialog",controller:"MmPayOrderTakeDialogCtrl",windowClass:"mmpay-order-take-modal",backdrop:"static",resolve:{data:function(){return n}}}).result.then(function(){let t={OrderTakingHistoryId:n.OrderHistoryId,MmOrderType:n.MmOrderType,ApplyAmount:n.OrderAmount,IsSuccess:!1};tt(t)},function(){})});k.on("NotifyMmPayOrderTakingResult",function(n){tt(n)});k.on("NotifyInwardRemittance",function(n){var i=angular.isDefined(n.ApplyAmount)&&n.ApplyAmount>0;if(i){const t=document.createElement("audio");t.src="https://cdn.fidlite.com/Web.Portal/_Common/Content/Sounds/AutoMapWithdrawSuccess.mp3";t.play();t.remove();v.confirm(d.get("Withdraw.HasOneArrivalMsg")+h("customCurrency")(n.ApplyAmount)+"，"+d.get("Withdraw.NowArrivalReturn")).then(function(t){t&&o.go("FinancialWithdraw",{directByOther:!0,isMmPay:n.IsMmPay})})}});u.systemNumberSwitch=null;y.getSwitchSingleton().then(function(n){(u.systemNumberSwitch=n,u.systemNumberSwitch!==!1)&&y.getCodeSingleton().then(function(n){u.systemNumber=n})});u.newsClick=function(){c.openMarqueeDialog()};u.noviceClick=function(){var n=e.open("http://pk3755.com/","_open","width=1490,height=650");n.focus()};u.QuickLoginClick=function(n,t,i,r){var u=n===undefined?"Account/LoginToGame":"Account/LoginToGame?ReturnUrl="+n,f=t===undefined?"_login":t,o=i===undefined?"1284":i,s=r===undefined?"893":r,h="width="+o+",height="+s,c=e.open(u,f,h);c.focus()};u.lineChatClick=function(n,t,i,r){var h=(new Date).getTime(),c=t||u.env.lineChat.target,l=i||u.env.lineChat.width,a=r||u.env.lineChat.height,v=u.env.lineChat.top===undefined?0:u.env.lineChat.top,s=u.env.lineChat.left===undefined?0:u.env.lineChat.left,p=u.env.lineChat.center,f,y,o;p&&(v=(window.screen.availHeight-30-a)/2,s=(window.screen.availWidth-10-l)/2);s+=window.screenX;f=n||u.ContactInfo[u.env.lineChat.cdnKey]||u.ContactInfo.Live800Link;f+=f.indexOf("?")!==-1?"&_="+h:"?_="+h;y=c==="_blank"?"":"width="+l+",height="+a+",top="+v+",left="+s;o=e.open(f,c,y);!u.env.lineChat.fullScreen||i||r||(o.moveTo(0,0),o.resizeTo(screen.width,screen.height));o.focus()};u.qqClick=function(n,t,i){var f=t||u.env.QQ.width,e=i||u.env.QQ.height,o=u.env.QQ.link.replace("QQVal",n),r=window.open(o,"_open","width="+f+",height="+e);!u.env.QQ.fullScreen||t||i||(r.moveTo(0,0),r.resizeTo(screen.width,screen.height));r.focus()};u.FreePlayClick=function(){var n=window.open("/Trial/Apply");n.focus()};u.GpkBingoClick=function(){var n=window.open("http://gpk-gameinfo.com/GALAXYonline.mp4","_open","width=588,height=486");n.focus()};u.liveCasinoClick=function(){var n=window.open("http://gpk-gameinfo.com/Live_casino/","_blank","width=1000,height=800");n.focus()};u.AgentLoginClick=function(){var n=e.open(u.ContactInfo.AgentLogin,"_blank");n.focus()};u.RegisterClick=function(){var n=e.open("/Register","_parent");n.focus()};u.AgentApplyClick=function(){var n=e.open("/AgentApply","_parent");n.focus()};u.clientClick=function(n){var t=n===undefined?"":n+".html",i=e.open("http://vfvwe.com/"+t,"_blank");i.focus()};u.addFavoriteClick=function(){var n=r.protocol()+"://"+r.host(),t=$(document).prop("title");try{window.external.addFavorite(n,t)}catch(i){try{window.sidebar.addPanel(t,n,"")}catch(i){v.alert("请按 Ctrl+D 键添加到收藏夹","notice")}}};u.addHomePageClick=function(){var n=r.protocol()+"://"+r.host();document.all?(document.body.style.behavior="url(#default#homepage)",document.body.setHomePage(n)):v.alert("您的浏览器目前不支援此功能！")};u.$on("showRegisterDialog",function(){u.toggleRegisterDialog(!0)});u.toggleRegisterDialog=function(n){u.registerDialog=n!==undefined?n:!u.registerDialog};u.openTrialModal=function(){t.trialModalIsShow||(t.trialModalIsShow=!0,i.open({templateUrl:"/Trial/NewIndex",controller:"TrialNewCtrl",windowClass:"modal-nt",resolve:{}}).result.then(function(){t.trialModalIsShow=!1},function(){t.trialModalIsShow=!1}))};r.search().openTrialModal&&(u.openTrialModal(),r.search({}));f(function(){it();ot();ut();ft()});u.openAgentDialogModal=function(){t.AgentDialogModalIsShow||(t.AgentDialogModalIsShow=!0,i.open({templateUrl:"/AgentApply/AgentDialog",controller:"AgentApplyDialogCtrl",scope:u}).result.then(function(){t.AgentDialogModalIsShow=!1},function(){t.AgentDialogModalIsShow=!1}))};r.search().openAgentDialogModal&&(u.openAgentDialogModal(),r.search({}))}]);app.controller("LobbiesCtrl",["$scope","$rootScope","LobbyNavService","gameNavigationSortService","CustomModalService",function(n,t,i,r,u){function f(){}function o(){}function e(){}function s(t){angular.forEach(t,function(t){n["to"+t.Name]=h(t)})}function h(n){return function(){i.openLobbyNav(n.Url,n.Name,n.IsEmbedded)}}n.isLogin=function(){return t.user&&t.user.isLogin};n.maintain=function(){n.isLogin()&&u.alert("升级中")};n.toBbSport=function(){f(0)};n.toBbLottery=function(){f(1)};n.toBbLive=function(){f(3)};n.toBbGame=function(){};n.toBbSportNew=function(){f(0)};n.toSabaGame=function(){o()};n.toSabaESport=function(){};n.toMgDealer=function(){};n.toMgFlash=function(){};n.toAgLive=function(){e(1)};n.toAgHtml=function(){};n.toPtLive=function(){};n.toPtFlash=function(){};n.toSingSport=function(){};n.toEvoLive=function(){};n.toGnsHtml=function(){};n.toR8Html=function(){};n.toPrgFlash=function(){};n.toPpLive=function(){};n.toSgHtml=function(){};n.toHabaHtml=function(){};n.toJdbHtml=function(){};n.toJdbBoard=function(){};n.toNetentHtml=function(){};n.toAbLive=function(){};n.toUgGame=function(){};n.toMwHtml=function(){};n.toMwBoard=function(){};n.toIgLottery=function(){};n.toIgMarkSix=function(){};n.toBgLive=function(){};n.toLatestGame=function(){};n.toLatestActivity=function(){};n.toCq9Html=function(){};n.toCq9Live=function(){};n.toGdLive=function(){};n.toGdHtml=function(){};n.toRedTigerHtml=function(){};n.toSunbetLive=function(){};n.toCmdSport=function(){};n.toKgHtml=function(){};n.toBspBoard=function(){};n.toBspHtml=function(){};n.toBspFishKing=function(){};n.toBspFishCannon=function(){};n.toBspFishPirate=function(){};n.toBspFishMermaid=function(){};n.toYgBoard=function(){};n.toYgHtml=function(){};n.toYgFishSeaKing=function(){};n.toYgFish=function(){};n.toCity761Html=function(){};n.toPtsHtml=function(){};n.toEbetLive=function(){};n.toImSport=function(){};n.toPngHtml=function(){};n.toOgLive=function(){};n.toFsHtml=function(){};n.toFsBoard=function(){};n.toIboSport=function(){};n.toImsSport=function(){};n.toKaHtml=function(){};n.toA5Lottery=function(){};n.toPsHtml=function(){};n.toJsHtml=function(){};n.toJsBoard=function(){};n.toMtHtml=function(){};n.toMtBoard=function(){};n.toRecommendGame=function(){};n.toAeHtml=function(){};n.toThHtml=function(){};n.toThBoard=function(){};n.toDhBoard=function(){};n.toIbo2Live=function(){};n.toPgHtml=function(){};n.toPg2Html=function(){};n.toDtHtml=function(){};n.toDtBoard=function(){};n.toDtESport=function(){};n.toVgBoard=function(){};n.toTogHtml=function(){};n.toTogBoard=function(){};n.toVtHtml=function(){};n.toSeLive=function(){};n.toGhHtml=function(){};n.toLegHtml=function(){};n.toLegBoard=function(){};n.toGmgBoard=function(){};n.toBullHtml=function(){};n.toLlLottery=function(){};n.toIm2Html=function(){};n.toIm2Board=function(){};n.toSyLottery=function(){};n.toJv8Html=function(){};n.toJlBoard=function(){};n.toMoreSlot=function(){};n.toMoreBoard=function(){};n.toIcgHtml=function(){};n.toLeboLive=function(){};n.toRg168Lottery=function(){};n.toIngBoard=function(){};n.toXbbLive=function(){};n.toVaHtml=function(){};n.toRtHtml=function(){};n.toTpLive=function(){};n.toTpHtml=function(){};n.toTpBoard=function(){};n.toTpLottery=function(){};n.toXgLive=function(){};n.toBbpBoard=function(){};n.toNwBoard=function(){};n.toPxHtml=function(){};n.toPxBoard=function(){};n.toMbHtml=function(){};n.toMbBoard=function(){};n.toHcHtml=function(){};n.toGfBoard=function(){};n.toKgameBoard=function(){};n.toRich88Html=function(){};n.toGpcLottery=function(){};n.toGmBoard=function(){};n.toWlBoard=function(){};n.toWlFishHunting=function(){};n.toDigitainSport=function(){};n.toWmHtml=function(){};n.toWmLive=function(){};n.toSpribeHtml=function(){};n.toJlHtml=function(){};n.toPgvnHtml=function(){};n.toRsgHtml=function(){};n.toRsgLive=function(){};n.toFish=function(){};n.toAgFish=function(){e(6,36)};n.toUgFish=function(){};n.toMwFish=function(){};n.toPtFish=function(){};n.toJdbFish=function(){};n.toJdbFish2=function(){};n.toJdbFishMoney=function(){};n.toGnsFish=function(){};n.toTpFishingTycoon=function(){};n.toTpKingFishing=function(){};n.toTpSplitFishing=function(){};n.toBbFish=function(){};n.toBbFish2=function(){};n.toPtsFish=function(){};n.toCq9Fish=function(){};n.toCq9FishGo=function(){};n.toCity761Fish=function(){};n.toCity761FishJinChan=function(){};n.toFsFishBeauty=function(){};n.toFsFishThunder=function(){};n.toFsFishBird=function(){};n.toFsFishHappy=function(){};n.toFsFishEveryDay=function(){};n.toJsFish=function(){};n.toMtFishLee=function(){};n.toMtFishToad=function(){};n.toThFishLee=function(){};n.toThFishToad=function(){};n.toBgFish=function(){};n.toVgFish=function(){};n.toLegFish=function(){};n.toPsFish=function(){};n.toJlFish=function(){};n.toIcgFish=function(){};n.toKaFish=function(){};n.toMgWDFuWaFishing=function(){};n.toPxFishCatchSeeKing3=function(){};n.toMbFishTalent=function(){};n.toBbinRule=function(){i.openLobbyNav("http://777.gpk-online.com/","Guide",!1)};n.toSabaRule=function(){i.openLobbyNav("http://gpk-gameinfo.com/world_cup/brasil02.html","Guide",!1)};n.toAGRule=function(){i.openLobbyNav("http://gc.ag-game.net/agingame/rules/BAC_TR.htm","Guide",!1)};n.toMGRule=function(){i.openLobbyNav("https://livegames.gameassists.co.uk/HelpCenter/Diamond/LiveGames/zh-tw/Default.htm#cshid=1","Guide",!1)};r.getGameEntranceList().then(function(n){s(n)})}]);app.controller("LobbyNavCtrl",["$scope","$window","$timeout","$http","languageService","LobbyNavService","gameNavigationSortService",function(n,t,i,r,u,f,e){function l(){v();y();e.getGameNavigationSort().then(function(t){n.position=c.filter(function(n){return n.value===t.Position})[0];n.navInfoList=p(t.NavigationInfos);a()}).then(k)}function a(){r.post("/GameNavigationSort/GetNavigationLabelImages",null).then(function(t){let i=t.data.ReturnObject;n.navInfoList.forEach(function(n){n.NavigationSortList.forEach(function(n){if(n.IsNew){let t=i.filter(function(n){return n.LabelId===1});n.newUrl=t.length?t[0].Url:null}if(n.IsHot){let t=i.filter(function(n){return n.LabelId===2});n.hotUrl=t.length?t[0].Url:null}if(n.IsEvent){let t=i.filter(function(n){return n.LabelId===3});n.eventUrl=t.length?t[0].Url:null}})})})}function v(){t.addEventListener("message",function(n){n&&n.data==="closeWindow"&&t.close()},!1)}function y(){t.addEventListener("storage",function(t){t.key==="LobbyNavAction"?n.$apply(o):null});t.addEventListener("setActionEvent",o)}function o(){n.lobbyAction=localStorage.getItem("LobbyNavAction");n.isNavUsable=s()}function s(){var t=(_isUserLogin==="False"||!_isUserLogin)&&n.lobbyAction.indexOf("/Account/LoginTo")===0;return!t}function p(n){return n.map(function(n){return n.NavigationSortList.forEach(function(t){var i=n.NavigationKind===1,r=n.NavigationKind===2;t.imageUrl=e.getEntranceImageUrl(t,h);t.IsHot=(i||r)?i:t.IsHot;t.IsNew=(i||r)?r:t.IsNew}),n})}function w(n,t){var i={};i.NavigationKind=t.NavigationKind;i.LangKey=n.Name;r.post("/GameNavigationSort/SetGameNavigationClickRecord",i);f.openLobbyNav(n.Url,n.Name,n.IsEmbedded)}function b(t){t.NavigationKind===5&&f.openLobbyNav("/SlotCasino/FishHtml","FishList");t.NavigationKindName==="Bull"&&f.openLobbyNav("/BoardCasino/BullHtml","BullList");n.currentKind=t.NavigationKind}function k(){n.currentKind=n.navInfoList.length>0?n.navInfoList[0].NavigationKind:null;i(function(){d()})}function d(){var t=$("aside");t.on("mouseover",function(){t.hasClass("slide-show")||r.post("/GameNavigationSort/SetGameNavigationClickRecord",{NavigationKind:-1,LangKey:null});t.addClass("slide-show")});t.on("mouseleave",function(){t.removeClass("slide-show")});n.position.setEffect()}function g(){var n=$(".position-left .entrance");n.height($(window).innerHeight()-195);n.mCustomScrollbar({alwaysShowScrollbar:1});$(window).on("resize",function(){n.mCustomScrollbar("update")})}function nt(){var n=$(".position-right .entrance");n.height($(window).innerHeight()-195);n.mCustomScrollbar({alwaysShowScrollbar:1});$(window).on("resize",function(){n.mCustomScrollbar("update")})}var h=0,c=[{value:0,name:"left",setEffect:g},{value:1,name:"top",setEffect:function(){}},{value:2,name:"right",setEffect:nt},{value:3,name:"bottom",setEffect:function(){}}];n.lobbyAction=localStorage.getItem("LobbyNavAction")||"/Lobby/Activity";n.isNavUsable=s();n.openLobbyView=w;n.changeNavKind=b;l()}]);app.controller("LoginCtrl",["$scope","$http","labelService","$window","$rootScope","$modal","$timeout","CustomModalService","FavoriteGameService","captchaService","signalrService","SiteSettingService",function(n,t,i,r,u,f,e,o,s,h,c,l){function g(n){try{Fingerprint2.get(function(t){var i=[],r;angular.forEach(t,function(n){i.push(n.value)});r=Fingerprint2.x64hash128(i.join(""),31);n.fingerprint=r;it(n)})}catch(t){n.fingerprint="";it(n)}}function it(i){n.isProcessing=!0;i.signalRId=c.getConnectionId();var r=/LoginToGame/i.test(location.patname)||document.getElementById("logingame-body")?"/Login/RapidLogin":"/login/login";t.post(r,i).then(function(n){var t=n.data;rt(i,t)})}function rt(n,t){if(sessionStorage.setItem("needAskBinding",t.NeedAskBinding),t.IsSuccess===!1){if(t.ErrorMessage==="token-expired"){y();return}if(t.ErrorMessage==="登入验证失败，请点击确定刷新页面"){o.alertError(t.ErrorMessage).then(function(){location.reload();return});return}if(t.SmsLoginType!==undefined||t.EmailLoginType!==undefined){o.alertError(t.ErrorMessage,"Live800LinkReview").then(function(){a();return});return}var i=t.ReturnObject&&t.ReturnObject.NeedMemberRegisterApplying?"Live800LinkReview":null;o.alertError(t.ErrorMessage,i).then(function(){if(t.ReturnObject&&t.ReturnObject.LoginAgain){r.location.href="/";return}a()});return}if(t.LoginValidationType===1){b();return}if(t.LoginValidationType===2){n.checkType=t.CheckType;n.token=t.Token;n.signalRId=c.getConnectionId();ft(n);return}ht(n).then(function(i){if(!i){a();return}if(i.isOnlyNeAuth){var r={account:n.account,token:t.Token};ot(r);return}ct(n,i.authList).then(function(){b()},function(){a()})})}function b(){function u(){r.top!==r.self&&r.top.location.reload();r.top.opener.top.opener!==null&&r.top.opener.top.opener.location.reload();r.top.opener.top.location.reload()}var t=location.search.split("LoginToGame=")[1],f=/addFavorite/i.test(location.search),e=/\/Account\/LoginToGame\?ReturnUrl=/i.test(location.href),i,n;if(s.addFavoritesFromStorage(),t!==undefined){i="/Account/"+decodeURIComponent(t);r.location.href=i;u();return}if(e){if(n=location.search.replace("?ReturnUrl=",""),r.opener===null){r.location.href=n;return}try{if(r.opener.location.href===n){r.opener.location.reload();r.close();return}r.opener.location.href=n;r.close()}catch(o){r.location.href=n}return}if(f){u();r.close();return}if(location.pathname==="/Account/Login"){r.location.href="/";return}r.location.reload()}function a(){n.loginParams.checkCode=null;n.isProcessing=!1;$("#check-code-wrapper input").focus()}function ft(n){var f,r,u,t;if(n.checkType===4){f=i.get("RegionVerify.AccountAbnormalLogin")||"帐号异常登入，请联系客服人员";o.alertError(f,"Live800LinkReview").then(function(){a()});return}for(r=[{type:1,question:i.get("RegionVerify.AccountName")||"请输入姓名",prompt:o.prompt},{type:2,question:i.get("RegionVerify.WithdrawPassword")||"请输入取款密码",prompt:o.promptPwd},{type:3,question:i.get("RegionVerify.BankAccount")||"请输入您在本站绑定的取款银行帐号后五码",prompt:o.promptPwd}],t=0;t<r.length;t++)if(r[t].type===n.checkType){u=r[t];break}u.prompt(u.question).then(function(t){n.verifyMessage=t||"";et(n)})}function et(n){t.post("/Account/Login_C",n).then(function(t){var i=t.data;if(!i.IsSuccess){o.alertError(i.ErrorMessage);a();return}rt(n,i)})}function ot(t){v=h.verifyViaDialogForLogin();v&&n.$on("validateNECaptcha"+v,function(n,i){t.neCaptcha=i.neCaptcha;t.neCaptchaId=i.neCaptchaId;st(t)})}function st(n){t.post("/Account/Login_E",n).then(function(n){var t=n.data;if(t.IsNeCaptchaFailed){u.$broadcast("reInitNECaptcha"+v);return}if(u.$broadcast("closeCaptchaModal"+v),!t.IsSuccess){o.alertError(t.ErrorMessage);a();return}b()})}function ht(n){var i=5;return t.post("/Login/GetLoginValidateType",{account:n.account}).then(function(n){var t=n.data,r,u;if(t.IsSuccess===!1){o.alertError(t.ErrorMessage);return}return r=t.LoginValidationTypes.length===1&&t.LoginValidationTypes[0]===i,u=t.LoginValidationTypes.filter(function(n){return n!==i}),{isOnlyNeAuth:r,authList:u}})}function ct(n,t){return f.open({templateUrl:"/Login/AuthListDialog",controller:"AuthListDialogCtrl",windowClass:"modal-ald",resolve:{params:function(){return n},authList:function(){return t}}}).result}function lt(t){w=t.Scene;var i={vid:t.Vid,type:"invisible",scene:w,offline_server:"/offline"};h.post("Login");vaptcha(i,u).then(function(t){y=t.validate.bind(t);tt=t.reset.bind(t);t.listen("close",function(){n.isProcessing=!1});t.listen("pass",function(){p.vaptchaToken=t.getToken();p.vaptchaScene=w;g(p);t.reset()})})}function at(){angular.element(document.getElementsByClassName("vp-s-fail")).length>0&&angular.element(document.getElementsByClassName("vp-close")).bind("click",function(){n.isProcessing=!1;tt();angular.element(document.getElementsByClassName("vp-close")).unbind("click")})}var y,p,w,d,nt,tt,v,k,ut;c.connect();d=1;nt=10;n.isForgetPwdSmsValidateEnable=!1;l.getLoginVerifyTypeSingleton().then(function(t){n.useVaptcha=t.LoginCaptchaVerifyType===2;n.useVaptcha&&lt(t)});t.post("/User/ForgotPasswordValidateStatus",null).then(function(t){n.isForgetPwdSmsValidateEnable=t.data.IsSuccess});c.on("gpkAuthSuccessToLogin",function(n){if(!n||n.length===0){o.alertError(i.get("Account.LoginFailed")||"登入失败，请重新登入。");a();return}for(var t=0;t<n.length;t++)document.cookie=n[t];b()});n.loginParams={account:$("#login_account").val(),password:$("#login_password").val()};n.isProcessing=!1;n.login=function(r){r.account=r.account||$("#login_account").val();r.password=r.password||$("#login_password").val();n.loginOver=!1;var u=document.getElementById("agree");u.style.display="block";t.post("/Login/GetAllAccountRule",null).then(function(t){var u=t.data,f=u.filter(function(n){return new RegExp(n).test(r.account)}).length>0;if(!f){o.alert(i.get("Account.Error_AccountRule")||"帐号不符合规则，请重新输入");return}if(n.useVaptcha){if(n.isProcessing=!0,!y&&d<nt){d++;e(function(){n.login(r)},990);return}try{p=r;y();e(function(){at()},1e3)}catch(s){r.vaptchaToken="";r.vaptchaScene=w;g(r)}return}if(!n.checkCode){o.alert(i.get("Shared.Empty_Checkcode")||"验证码为空, 请取得验证码");return}r.checkCodeEncrypt=n.checkCode.encrypt;g(r)})};n.agreement=function(){var t=(screen.width-850)/2,i=(screen.height-800)/3,n=r.open("/Home/Agreement","","resizable,scrollbars=yes, width=900, height=850");n.moveBy(t,i);n.focus()};n.openForgotPwdDialog=function(){f.open({templateUrl:"/Login/ForgotPwdDialog",controller:"ForgotPwdDialogCtrl",windowClass:"modal-fpd",resolve:{}}).result.then(function(){})};n.loginOver=!1;k=$("#agree");ut=$("#login-box");ut.hover(function(){k.fadeIn(1e3);n.loginOver=!n.loginOver},function(){n.loginOver=!n.loginOver});k.hover(function(){n.loginOver=!n.loginOver},function(){k.fadeOut(1e3);n.loginOver=!n.loginOver})}]);app.controller("LoginToGameCtrl",["$scope","$window",function(n,t){n.GameRegisterClick=function(){if(t.top.opener!==null){for(var n=t.top.opener.top,i=t.document.domain;n.opener!==null&&n.opener!==n;)try{n.opener.document.domain==i&&(n.close(),n=n.opener.top)}catch(r){break}t.top.close();n.location.href="/Register"}else t.top.location.href="/Register"}}]);app.controller("MemberCenterCtrl",["$scope","$window","$http","$q","$rootScope","$modal","$filter","CustomModalService","JackPotActivityService","ActivityEntranceService","ActivityService","FunctionSwitchService","UserService","languageService","labelService","GenericGameService","LobbyNavService",function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w){function g(){if(!_IsLogin||_IsTrial){t.location.href="/";return}if(n.$on("enterMicroServiceError",function(){n.isLoading&&k()}),!window.__IsESModuleSupported||!window.__IsDynamicImportSupported){k();return}if("serviceWorker"in navigator){const n=navigator.serviceWorker;n.getRegistrations?n.getRegistrations().then(function(n){n.forEach(function(n){n.unregister()})}):n.getRegistration&&n.getRegistration().then(function(n){n&&n.unregister()})}setTimeout(function(){r.all([a.getJwtTokens(),]).then(function(i){var r=i[0],f;if(r){localStorage.setItem("jwtToken",r.JwtToken);localStorage.setItem("refreshToken",r.RefreshToken);n.progress=10;try{window.__Qiankun_addGlobalUncaughtErrorHandler(()=>{n.isLoading&&nt()});f=localStorage.getItem("mobileType")?localStorage.getItem("mobileType"):"Origin";n.microAppState=window.__Qiankun_InitGlobalState({action:null,data:null});n.microAppState.onGlobalStateChange(function(i){switch(i.action){case"Mounted":n.isLoading=!1;break;case"SignOut":t.location.href="/Account/SignOut";break;case"ProgressRate":n.progress=i.data;break;case"ReceiveAllActivityBonus":n.allReceive();break;case"RouteToInnerActivity":d(i.data);break;case"RouteToAnnouncement":u.$broadcast("showModalAnnouncement",0);break;case"OpenGame":var r=p.getGameInfo(i.data);w.openLobbyNav(r.action,r.supplier);break;case"RouteToRecommendLoby":w.openLobbyNav("/Lobby/RecommendGame?CategoryKey=3")}});n.microApp=window.__Qiankun_LoadMicroApp({name:"member-center",entry:window.__IsDebuggingEnabled?"http://localhost:8081/":"/fe/membercenter/",container:"#member-center-container",props:{Account:_Account,ApiDomain:window.__IsDebuggingEnabled?null:t.location.origin,JwtToken:r.JwtToken,RefreshToken:r.RefreshToken,Language:v.currentLanguage,IsHashMode:!0,DefaultCurrency:u.defaultCurrency,DefaultCountryCode:u.defaultCountryCode,DefaultTimezone:+sessionStorage.getItem("web_Timezone"),RouterBaseUrl:"/MemberCenter/"}})}catch(e){alert(e)}}})});l.getEnableFunctionSwitch().then(function(t){n.oneClickFunctionSwitch=t.OneClickToReceiveAllActivityReward;n.promotedFunctionSwitch=t.PyramidAgent})}function nt(){n.isLoading=!1;n.isUnSupported=!0;n.errorTitle=y.get("MemberCenter.MicroAppTitleError");let t=window.navigator.userAgent;n.nowUserAgent=t;t.indexOf("agwv")>-1||t.indexOf("igwv")>-1||t.indexOf("agna")>-1||t.indexOf("igna")>-1?(n.errorTitle=y.get("MemberCenter.MicroAppTitleError2"),t.indexOf("agwv")>-1&&(n.nowUserAgent=n.nowUserAgent.replace("agwv","")),t.indexOf("igwv")>-1&&(n.nowUserAgent=n.nowUserAgent.replace("igwv","")),t.indexOf("agna")>-1&&(n.nowUserAgent=n.nowUserAgent.replace("agna","")),t.indexOf("igna")>-1&&(n.nowUserAgent=n.nowUserAgent.replace("igna","")),n.errorMsg=/Macintosh|Mac OS X/i.test(t)?y.get("MemberCenter.IosBrowserErrorMsg2"):e("format")(y.get("MemberCenter.UcWebviewErrorMsg2"),['<a href="https://browser.qq.com/" target="_blank">QQ浏览器<\/a>'])):n.errorMsg=/Macintosh|Mac OS X/i.test(t)?y.get("MemberCenter.IosBrowserErrorMsg"):e("format")(y.get("MemberCenter.UcWebviewErrorMsg"),['<a href="https://browser.qq.com/" target="_blank">QQ浏览器<\/a>'])}function k(){n.isLoading=!1;n.isUnSupported=!0;n.errorTitle=y.get("MemberCenter.BrowserVersionError");let t=window.navigator.userAgent;n.nowUserAgent=t;t.indexOf("agwv")>-1||t.indexOf("igwv")>-1||t.indexOf("agna")>-1||t.indexOf("igna")>-1?(t.indexOf("agwv")>-1&&(n.nowUserAgent=n.nowUserAgent.replace("agwv","")),t.indexOf("igwv")>-1&&(n.nowUserAgent=n.nowUserAgent.replace("igwv","")),t.indexOf("agna")>-1&&(n.nowUserAgent=n.nowUserAgent.replace("agna","")),t.indexOf("igna")>-1&&(n.nowUserAgent=n.nowUserAgent.replace("igna","")),/Macintosh|Mac OS X/i.test(t)?(n.errorTitle=y.get("MemberCenter.MicroAppTitleError"),n.errorMsg=y.get("MemberCenter.IosBrowserErrorMsg2")):n.errorMsg=e("format")(y.get("MemberCenter.CheckES6Tip2"),['<a href="https://browser.qq.com/" target="_blank">QQ浏览器<\/a>'])):/Macintosh|Mac OS X/i.test(t)?(n.errorTitle=y.get("MemberCenter.MicroAppTitleError"),n.errorMsg=y.get("MemberCenter.IosBrowserErrorMsg")):n.errorMsg=e("format")(y.get("MemberCenter.CheckES6Tip"),['<a href="https://browser.qq.com/" target="_blank">QQ浏览器<\/a>'])}function tt(){n.isMemberCenterFullWidth=!n.isMemberCenterFullWidth}function d(n){h.openModal(n)}function it(){r.all([s.getStatusSingleton(),s.getActivityName()]).then(function(t){n.jackPotName=t[1].ReturnObject;switch(t[0]){case 3:n.jackPotTag="抢";break;case 4:n.jackPotTag="翻倍领大奖"}})}function rt(){f.open({templateUrl:"/PyramidAgent/index",controller:"PyramidAgentDialogCtrl",windowClass:"pyramid-agent-dialog",resolve:{previewObject:function(){return undefined}}}).result.then(function(){},function(){})}var b=[{category:"Security",path:"/MemberCenter/SecurityList"},{category:"Security",path:"/Account/AuthenticatedDevice"},{category:"Security",path:"/Account/ChangePassword"},{category:"Security",path:"/Account/ChangeMoneyPassword"},{category:"Security",path:"/Account/NativeApp"},{category:"SiteMail",path:"/SiteMail"},{category:"Wallet",path:"/MemberCenter/WalletList"},{category:"Activity",path:"/MemberCenter/ActivityList"},{category:"Transaction",path:"/Transaction"},{category:"BetRecord",path:"/BetRecord"},{category:"FavoriteGame",path:"/MemberCenter/FavoriteGame"},{category:"Announcement",path:"/MemberCenter/AnnouncementList"},];n.langs=y.get("TimeLimitedEvent");n.memberCenterLang=y.get("MemberCenter");n.isLoading=!0;n.isAnyActivities=!1;n.page={category:"Security"};n.promotedId="";n.isProcessing=!1;n.isMemberCenterFullWidth=!1;n.toggleMemberCenterWidth=tt;n.openModal=d;n.openPromotedDialog=rt;n.microApp;n.microAppState;n.progress=0;n.isUnSupported=!1;n.nowUserAgent="";n.errorTitle="";n.errorMsg="";g();n.allReceive=function(){n.oneClickFunctionSwitch&&(n.isProcessing=!0,c.receivedAll().then(function(i){if(n.isProcessing=!1,i.Code!==200){o.alertError(i.Error[0].Message);return}let r=i.Result.List.filter(function(n){return n.ReceivedTotalAmount>0}),u=r.map(function(n){return n.ReceivedTotalAmount}).reduce(function(n,t){return n+t},0);f.open({templateUrl:"/MemberCenter/ReceivedDetail",controller:"ActivityReceivedDetailDialogCtrl",windowClass:"activity-received-detail-dialog",resolve:{data:function(){return{totalAmount:u,receivedList:r}}}}).result.then(function(){t.location.reload()},function(){})}))}}]);app.controller("MissionRewardCtrl",["$scope","$modal","$filter","$window","$timeout","$location","labelService","MeidonTimeService","CustomModalService","MissionRewardService","LoginRedirectService","SiteSettingService",function(n,t,i,r,u,f,e,o,s,h,c,l){function b(){if(k(),v){d();return}if(!_IsLogin){c.goLogin();return}h.getSwitch().then(function(t){if(t.IsSuccess===!1){s.alertError(t.ErrorMessage);return}if(n.isEnable=t.ReturnObject,!n.isEnable){n.isLoading=!1;n.isEnable=!1;return}h.getList().then(function(n){if(n.IsSuccess===!1){s.alertError(n.ErrorMessage);return}var t=n.ReturnObject;p(t)})})}function k(){l.getSiteTitleSingleton().then(function(t){document.title=t.PortalSiteName+" - "+n.langs.MissionReward})}function d(){function t(i){var u=i.data;p(u);n.isEnable=!0;r.removeEventListener("message",t,!1)}r.addEventListener("message",t,!1);r.opener.postMessage("message",f.search().missionreward)}function p(t){if(t.forEach(function(n){n.ActivityStartTime=resetDateTimeByTimezone(n.ActivityStartTime);n.ActivityEndTime=resetDateTimeByTimezone(n.ActivityEndTime);n.ReceiveBonusLimitTime=resetDateTimeByTimezone(n.ReceiveBonusLimitTime)}),n.LotteryMissionsList=t,n.isLoading=!1,v)n.missionList=n.LotteryMissionsList[n.showIndex].Item,a(n.LotteryMissionsList[n.showIndex]),n.missionIsLoading=!1;else{if(n.LotteryMissionsList.length===0){n.missionIsLoading=!1;return}h.getMissions(n.LotteryMissionsList[n.showIndex].Id).then(function(t){if(t.IsSuccess===!1){s.alertError(t.ErrorMessage);return}n.missionList=t.ReturnObject;a(n.LotteryMissionsList[n.showIndex]);n.missionIsLoading=!1})}n.moreCount=new Array(n.LotteryMissionsList.length%n.slideCount>0?n.slideCount-n.LotteryMissionsList.length%n.slideCount:0);n.LotteryMissionsList.length>3&&u(function(){$(".lottery-list").slick({slide:"li",infinite:!1,speed:300,slidesToShow:n.slideCount,slidesToScroll:n.slideCount,variableWidth:!0,arrows:!0,prevArrow:"<button type='button' class='slick-prev pull-left'><i class='fas fa-chevron-left'><\/i><\/button>",nextArrow:"<button type='button' class='slick-next pull-right'><i class='fas fa-chevron-right'><\/i><\/button>"})},400)}function g(t,i){n.showIndex=t;v?(n.missionList=i.Item,a(i)):(n.missionIsLoading=!0,h.getMissions(i.Id).then(function(t){if(t.IsSuccess===!1){s.alertError(t.ErrorMessage);return}n.missionList=t.ReturnObject;a(i);n.missionIsLoading=!1}))}function nt(t){var u={},o=t.Type,f=t.GameCategoryPropertyNames,r=t.Setting,s=[{type:1,category:f.length===0?n.langs.Platform:f.length===1?f.join():n.langs.DesignatedPlatform,condition:n.langs.Bet+i("customCurrency")(r)},{type:2,category:n.langs.Deposit,condition:n.langs.Single+i("customCurrency")(r)},{type:3,category:n.langs.Deposit,condition:n.langs.Total+i("customCurrency")(r)},{type:4,category:n.langs.Deposit,condition:n.langs.Number+r},{type:5,category:n.langs.ContinuousBet,condition:r+n.langs.Day},{type:6,category:n.langs.CumulativeBet,condition:r+n.langs.Day}],e=s.filter(function(n){return n.type===o}).pop()||{};return u.category=e.category,u.condition=e.condition,u}function a(t){n.isExpired=moment(t.ActivityEndTime).isBefore(moment(w))?!0:!1;angular.forEach(n.missionList,function(n){n.description=nt(n)});n.missionCount=n.missionList.length}function tt(t){t.Status===1&&(y||(y=!0,h.getReward(t.Id).then(function(r){if(y=!1,r.IsSuccess===!1){s.alertError(r.ErrorMessage);r.ErrorMessage==="任务已领奖"&&(t.Status=2);return}r.ReturnObject&&r.ReturnObject.allComplete&&r.ReturnObject.completeBonus&&s.alert(n.langs.AllCompleteWinningPrize+i("customCurrency")(r.ReturnObject.completeBonus));s.alert(n.langs.WinningPrize+i("customCurrency")(t.Bonus));t.Status=2})))}function it(i){t.open({templateUrl:"missionDetailModal",windowClass:"modal-missionDetail",resolve:{detail:function(){return i},langs:function(){return n.langs}},controller:["langs","$scope","detail","$modalInstance",function(n,t,i,r){t.langs=n;t.detail=i;t.close=r.dismiss}]}).result.then(function(){},function(){})}var v=f.search().missionreward,w=o.getCurrentMeidon(),y=!1;n.isLoading=!0;n.isEnabled=!1;n.missionIsLoading=!0;n.langs=e.get("MissionReward");n.langs.Loading=e.get("Common.Loading");n.langs.NoEvent=e.get("Common.NoEvent");n.titleDateFormat="YYYY/M/D HH:mm:ss";n.itemDateFormat="M/D";n.slideCount=3;n.showIndex=0;n.LotteryMissionsList=[];n.missionList=[];n.isExpired=!1;n.missionCount=0;n.changeIndex=g;n.receiveReward=tt;n.openMissionDetail=it;b()}]);app.controller("MmPayOrderResultDialogCtrl",["$scope","$modalInstance","$http","CustomModalService","labelService","data",function(n,t,i,r,u,f){n.langs=u.get("Withdraw");n.isProcessing=!1;n.data=f;n.close=function(){t.dismiss()}}]);app.controller("MmPayOrderTakeDialogCtrl",["$scope","$modalInstance","$http","CustomModalService","labelService","data",function(n,t,i,r,u,f){n.langs=u.get("Withdraw");n.isProcessing=!1;n.data=f;n.data.dealPercent=+(n.data.DealAmount/n.data.TotalAmount*100).toFixed(0);n.closeTime=10;n.interval=setInterval(function(){n.closeTime-=1;n.closeTime===0&&(clearInterval(n.interval),n.close())},1e3);n.accept=function(){if(!n.isProcessing){n.isProcessing=!0;let r={orderHistoryId:n.data.OrderHistoryId,mainOrderId:n.data.MainOrderId};i.post("/WithdrawApplication/ApproveMmOrder",r).then(function(i){const r=i.data;if(n.isProcessing=!1,r.IsSuccess===!1){clearInterval(n.interval);t.close();return}clearInterval(n.interval);n.close()})}};n.close=function(){t.dismiss()}}]);app.controller("NewLuckyWheelCtrl",["$scope","$http","$q","$window","$location","$modal","$timeout","$filter","NewLuckyWheelService","languageService","labelService","LoginRedirectService","SiteSettingService",function(n,t,i,r,u,f,e,o,s,h,c,l,a){function w(){if(n.isPreview){b();return}if(!_IsLogin){l.goLogin();return}i.all([s.getEntraceVisible(),t.post("/NewLuckyWheel/GetVisibleLuckyWheel",null),]).then(function(t){var i=t[0].Enable;if(n.visibleEventIds=t[1].data&&t[1].data.ReturnObject||[],!i||n.visibleEventIds.length===0){n.isLoading=!1;return}n.eventId=n.visibleEventIds[0];v()})}function v(){i.all([t.post("/NewLuckyWheel/GetOpenRules",{luckyWheelId:n.eventId}),t.post("/NewLuckyWheel/GetLuckyWheelInfo",{luckyWheelId:n.eventId})]).then(function(t){var i=t[0].data.ReturnObject,r=t[1].data.ReturnObject;r.OpeningTime=i.OpeningTime;n.isEnable=i.IsTimeOnRule;y(r);e(function(){if(!n.isEnable){p();return}})})}function b(){function t(i){var u=i.data.ReturnObject;n.isEnable=!0;y(u);r.removeEventListener("message",t,!1)}r.addEventListener("message",t,!1);r.opener.postMessage("message",u.search().newluckywheel)}function y(t){n.openingTimes=[];n.eventInfo={};n.rewardList=[];n.eventDescription="";n.remainCount=0;n.eventId=t.Id;n.eventInfo={name:t.Name,startDate:resetDateTimeByTimezone(t.StartDate),endDate:resetDateTimeByTimezone(t.EndDate)};k(n.eventInfo.name);n.rewardList=t.RewardInfoList.map(function(n){return{imageUrl:n.ImageUrl?o("filterCdn")(n.ImageUrl,"https://cdn.fidlite.com/"):null,id:n.RewardID,title:n.RewardTitle,name:n.RewardName,type:n.RewardType,typeDescription:n.RewardDescription}});n.eventDescription=t.Description||"";n.remainCount=t.MemberLotteryCount||0;n.openingTimes=t.OpeningTime.map(function(n){return{openTimeBegin:resetDateTimeByTimezone(moment(new Date).format("YYYY/MM/DD "+n.OpenTimeBegin),"HH:mm:ss"),openTimeEnd:resetDateTimeByTimezone(moment(new Date).format("YYYY/MM/DD "+n.OpenTimeEnd),"HH:mm:ss")}});n.isShowRewardRecord=t.IsShowRewardRecord;n.isLoading=!1}function k(n){a.getSiteTitleSingleton().then(function(t){document.title=t.PortalSiteName+" - "+n})}function d(t,i){var r=n.rewardList.filter(function(n){return n.id===t})[0];g(r);n.remainCount=i}function p(){f.open({templateUrl:"durationDetailModal",resolve:{isEnable:function(){return n.isEnable},langs:function(){return n.langs},eventInfo:function(){return n.eventInfo},openingTimes:function(){return n.openingTimes}},controller:["$scope","$modalInstance","isEnable","langs","eventInfo","openingTimes",function(n,t,i,r,u,f){n.isEnable=i;n.langs=r;n.eventInfo=u;n.openingTimes=f;n.close=t.close}],windowClass:"nlw-duration-modal"}).result.then(function(){if(!n.isEnable){r.location.href="/";return}},function(){if(!n.isEnable){r.location.href="/";return}})}function g(t){var i=t.type===0,r="nlw-reward-modal"+(i?" unwinned":"");f.open({templateUrl:"rewardHintModal",resolve:{langs:function(){return n.langs},reward:function(){return t}},controller:["$scope","$modalInstance","langs","reward",function(n,t,i,r){n.langs=i;n.reward=r;n.dismiss=t.dismiss;n.close=t.close}],windowClass:r}).result.then(function(){},function(){})}function nt(){f.open({templateUrl:"eventDescriptionModal",resolve:{langs:function(){return n.langs},eventDescription:function(){return n.eventDescription}},controller:["$scope","$modalInstance","langs","eventDescription",function(n,t,i,r){n.langs=i;n.description=r;n.dismiss=t.dismiss;n.close=t.close}],windowClass:"nlw-modal"}).result.then(function(){},function(){})}function tt(){f.open({templateUrl:"rewardListModal",resolve:{langs:function(){return n.langs},rewardList:function(){return n.rewardList}},controller:["$scope","$modalInstance","langs","rewardList",function(n,t,i,r){n.langs=i;n.rewardList=r;n.dismiss=t.dismiss;n.close=t.close}],windowClass:"nlw-modal"}).result.then(function(){},function(){})}function it(){n.isShowRewardRecord&&f.open({templateUrl:"winnerListModal",resolve:{langs:function(){return n.langs},eventId:function(){return n.eventId},rewardList:function(){return n.rewardList}},controller:["$scope","$http","$modalInstance","CustomModalService","langs","eventId","rewardList",function(n,t,i,u,f,e,o){var e=e;if(n.isLoading=!0,n.langs=f,n.winnerList=[],n.dismiss=i.dismiss,n.close=i.close,!e&&e!==0){n.isLoading=!1;return}t.post("/NewLuckyWheel/GetRewardRecord",{luckyWheelId:e}).then(function(t){var i=t.data;if(i.IsSuccess===!1){u.alertError(i.ErrorMessage);return}if(!i.ReturnObject){u.alert(n.langs.WinningListDisabled||"中奖名单尚未开放").then(function(){r.location.reload()});return}n.winnerList=i.ReturnObject.map(function(n){var i=n.Account,t=o.filter(function(t){return n.RewardID===t.id})[0];return{account:i,reward:t.title+" "+t.name}});n.isLoading=!1})}],windowClass:"nlw-modal"}).result.then(function(){},function(){})}function rt(){var t=n.visibleEventIds.indexOf(n.eventId),i=t===n.visibleEventIds.length-1;i||(n.isLoading=!0,n.eventId=n.visibleEventIds[t+1],v())}n.isPreview=u.search().newluckywheel;n.isLoading=!0;n.isEnable=!1;n.langVersion=h.currentLanguage;n.langs=c.get("NewLuckyWheel")||{};n.langs.Loading=c.get("Common.Loading");n.langs.NoEvent=c.get("Common.NoEvent");n.visibleEventIds=[];n.eventId=0;n.openingTimes=[];n.eventInfo={};n.rewardList=[];n.eventDescription="";n.remainCount=0;n.rotateCompleteCallbackFn=d;n.openDurationDetailModal=p;n.openDescriptionModal=nt;n.openRewardListModal=tt;n.openWinnerModal=it;n.switchToNextEvent=rt;w()}]);app.controller("PromotionalAd",["$q","$http","$scope","$window","$timeout","$interval","labelService","SiteSettingService",function(n,t,i,r,u,f,e,o){function a(){n.all([o.getSiteTitleSingleton(),t.post("/PromotionalAd/GetPromotionalAdSetting",l)]).then(function(n){var t,r;document.title=n[0].PortalSiteName;t=n[1].data;$("html").css({"background-color":"#"+t.ColorCode,"background-image":'url("https://cdn.fidlite.com/'+t.BackgroundImg+'")'});i.countdown=t.Duration;i.games=t.AdItem;i.games.length>3&&u(function(){$(".game-list").slick({infinite:!1,slidesToShow:3})});r=f(function(){if(i.countdown===0){f.cancel(r);s();return}i.countdown--},990)})}function s(n){if(n=n||c,h){localStorage.setItem("LobbyNavAction",n);return}location.href=n}function v(n){if(n.IsNewRedirect){var t=1300,i=960,f=(screen.width-t)/2,e=(screen.height-i)/3,u=r.open(n.Link,"_PromotionalAd","resizable,scrollbars=yes,width="+t+",height="+i);u.resizeTo(t,i);u.moveTo(f,e);u.focus();return}s(n.Link)}i.toGame=v;i.redirect=s;i.langs=e.get("PromotionalAd")||{};var h=r.top.location.pathname==="/Lobby/Navigation",c=location.pathname+location.search+"&ignoreCheckAd=true",l={gameKind:gameKind,deviceType:0};a()}]);app.controller("PromotionCtrl",["$scope","$http","$sce","$filter","$location","$window","labelService",function(n,t,i,r,u,f,e){function l(){t.post("/Promotion/GetList",{IsWeb:!0}).then(function(n){c(n.data)})}function c(t){var i={},r,u;if(t===""){$("#loading").html('<span><i class="fa fa-exclamation-circle" aria-hidden="true" style="margin-right:5px"><\/i>伺服器忙碌中，请洽客服人员<\/span>');return}if(i=JSON.parse(JSON.stringify(t)).map(function(n){return n.isSelected=!1,n}),s&&!o)i.filter(function(n){return n.items}).map(function(n){return n.items}).reduce(function(n,t){return n.concat(t)}).forEach(function(n){n.PromotionContent=n.PromotionContent||h}),n.categories=i;else{for(r in i)for(u in i[r].items)i[r].items[u].PromotionContent='<div data-promotion="loading" style="width: 80%;margin: 20% auto;line-height: 50px;text-align: center;background-color:rgba(88,88,88,.5); background-color:#7f7f7f \\9; color: #333;"><i class="fa fa-spinner fa-spin" style="margin-right:5px"><\/i>'+(e.get("Common.Loading")||"载入中")+"<\/div>";n.categories=i;i={}}n.categories&&n.categories!=[]&&a()}function a(){$("#loading").css("display","none");var t=$.grep(n.categories,function(n){return n.isSelected});t.length==0&&angular.isObject(n.categories[0])&&(n.categories[0].isSelected=!0)}function v(n,i){var u=n===i;if(/^\<div data\-promotion\=\"loading\"/.test(n.PromotionContent)&&u){var f="/Promotion/GetDetail?PromotionId="+i.PromotionId+"",e="/Promotion/GetNewPreviewContent?promotionId="+i.PromotionId+"&isDraft="+i.isDraft,s=o?e:f;t.get(s).then(function(t){n.PromotionContent=t.data?t.data.replace(/src=\"([^\"])+(png|jpg|gif)\"/g,function(n){return r("filterCdn")(n,"https://cdn.fidlite.com/")}):h})}n.isSelected=u?!n.isSelected:!1}function y(n){var t;localStorage.setItem("LobbyNavAction",n);t=f.open("/Lobby/Navigation","_lobbyNav","resizable,scrollbars=yes, width=1300, height=960");t.moveTo((screen.width-1300)/2,(screen.height-960)/3);t.focus()}var s=u.search().promotion,o,h='<div class="unload" style="width: 80%; margin: 20% auto;line-height: 50px;text-align: center;background-color:rgba(88,88,88,.5); background-color:#7f7f7f \\9;"><span><i class="fa fa-exclamation-circle" aria-hidden="true" style="margin-right:5px"><\/i>无优惠内容<\/span><\/div>';if($("#un-lobby").append('<div id="loading" style="width: 800px;margin: 20px auto;line-height: 50px;text-align: center;background-color:rgba(255,255,255,.5); background-color:#7f7f7f \\9;"><i class="fa fa-spinner fa-spin" style="margin-right:5px"><\/i>'+(e.get("Common.Loading")||"载入中")+"<\/div>"),s){f.addEventListener("message",n,!1);f.opener.postMessage("message",u.search().promotion);function n(t){var i=t.data,r=i.data;o=i.isNew;c(r);f.removeEventListener("message",n,!1)}}else l();n.toHtml=function(n){return i.trustAsHtml(n)};n.categoryClick=function(t){for(var i in n.categories)n.categories[i].isSelected=n.categories[i]==t;n.itemClick(null)};n.itemClick=function(t){var i,r;if(t&&t.RedirectUrl){/^\//.test(t.RedirectUrl)?/^\/(SlotCasino|LiveCasino|BoardCasino)/i.test(t.RedirectUrl)?y(t.RedirectUrl):f.open(location.origin+t.RedirectUrl,"_self"):f.open(t.RedirectUrl,"_blank");return}for(i in n.categories)for(r in n.categories[i].items)v(n.categories[i].items[r],t)}}]);app.controller("PyramidAgentDialogCtrl",["$scope","$modalInstance","$http","CustomModalService","signalrService","labelService","MeidonTimeService","previewObject",function(n,t,i,r,u,f,e,o){function l(){n.isShowDetail=!1;n.nowSelectPerformSearchTab=0;n.nowSelectPerformSearchDetailTab="all";n.nowSelectRebateSettingIndex=0;n.params.promotedIdSearch=""}function a(){u.on("GetChildren_MemberCount",function(t){t.forEach(function(t){let i=n.childrenList.filter(function(n){return n.MemberId===t.MemberId});i.length&&(i[0].ChildrenMemberCount=t.ChildrenMemberCount,i[0].GroupMemberCount=t.GroupMemberCount)})})}function v(){i.post("/PyramidAgent/GetGameKind",null).then(function(t){n.gameKinds=t.data})}function s(){n.gameKinds.length===0&&v();switch(n.tabList[n.nowSelectTab].className){case"promotedSelf":y();break;case"performSearch":w();break;case"direct":u.donePromise.then(function(){n.getChildren()});break;case"rebate":b()}}function y(){if(n.previewObject){p();return}n.isProcessing=!0;i.post("/PyramidAgent/GetPromotedInfo",null).then(function(t){n.isProcessing=!1;let i=t.data;if(i.IsSuccess===!1){r.alertError(i.ErrorMessage);return}n.promotedInfo=i.ReturnObject})}function p(){n.promotedInfo={UnReceivedRebate:0,ReceivedRebate:0,PromotedId:"1234567890",GroupMemberCount:1,DailyGroupMemberCount:1,ChildrenMemberCount:1,DailyChildrenMemberCount:0,PromotedLink:"http://demo.com?p=123"}}function w(){if(n.previewObject){n.performanceList=[];n.performanceHead=[];return}n.isProcessing=!0;let t={BeginTime:n.performSearchTab[n.nowSelectPerformSearchTab].startDate,EndTime:n.performSearchTab[n.nowSelectPerformSearchTab].endDate};i.post("/PyramidAgent/GetPerformance",t).then(function(t){(n.isProcessing=!1,n.performanceList=t.data.ReturnObject,n.performanceHead=[{Key:0,Value:n.langs.All}],n.performanceList)&&n.performanceList.length&&(n.gameCategoryDefine=n.performanceList[0].RebateDetails[0].GameCategoryDefine,n.rebateDefine=n.performanceList[0].RebateDetails[0].RebateDefine,n.gameCategoryDefine===1&&(n.performanceList.forEach(function(t){t.RebateDetailsShow=[];t.RebateDetails.forEach(function(t){t.isAllKind=t.GameCategoryValues.length===n.gameKinds.length;t.GameCategoryValues.forEach(t=>{let i=n.gameKinds.filter(function(n){return n.Key===t}),r=n.performanceHead.some(function(n){return n.Value===i[0].Value});r||n.performanceHead.push({Key:i[0].Key,Value:i[0].Value})})})}),n.performanceHead.sort(function(n,t){return n.Key>t.Key?1:-1}),n.performanceList.forEach(function(t){n.performanceHead.forEach(function(i){if(i.Key===0){let n=t.RebateDetails.filter(function(n){return n.isAllKind});if(n.length){t.RebateDetailsShow.push(n[0].RebateAmount);return}}else{let u=n.gameKinds.filter(function(n){return n.Value===i.Value})[0].Key,r=t.RebateDetails.filter(function(n){return n.GameCategoryValues[0]===u&&!n.isAllKind});if(r.length){t.RebateDetailsShow.push(r[0].RebateAmount);return}}t.RebateDetailsShow.push(-1)})})))})}function b(){if(n.previewObject){k();return}i.post("/PyramidAgent/GetPyramidAgentRebateSetting",null).then(function(t){let i=t.data;if(i.IsSuccess===!1){r.alertError(i.ErrorMessage);return}n.rebateSetting=i.ReturnObject;n.rebateSetting&&(n.rebateSetting.RebateSettings=h(n.rebateSetting.RebateSettings,n.rebateSetting.GameCategoryDefine),n.changeRebateSettingTab(0))})}function k(){let t=n.previewObject.RebateSetting;n.rebateSetting={GameCategoryDefine:t[0].GameCategoryDefine,RebateDefine:t[0].RebateDefine,ConditionDefine:t[0].ConditionDefine,RebateSettings:t.map(function(n){return{GameCategoryValue:n.GameCategoryValue[0].Id,Conditions:n.Conditions.map(function(n){return{RankName:n.rankName,ConditionValue:n.ConditionValue,RebateValue:n.RebateValue,AuditTimes:n.AuditTimes,RebateLimit:n.RebateLimit}})}})};n.rebateSetting.RebateSettings=h(n.rebateSetting.RebateSettings,n.rebateSetting.GameCategoryDefine);n.changeRebateSettingTab(0)}function c(){n.isProcessing=!0;i.post("/PyramidAgent/GetPerformanceDetail",{RewardId:n.performance.RewardId}).then(function(t){n.isProcessing=!1;let i=t.data;if(i.IsSuccess===!1){r.alertError(i.ErrorMessage);return}(n.performanceDetail=i.ReturnObject,n.performanceDetail)&&(n.performanceDetail.RebateDetails[0].GameCategoryValues.length===n.gameKinds.length?n.performanceDetailAllCategory={GameCategoryName:n.langs.All,Performance:n.performanceDetail.PerformanceDetail.map(function(n){return n.Performance}).reduce(function(n,t){return n+t},0),SelfPerformance:n.performanceDetail.PerformanceDetail.map(function(n){return n.SelfPerformance}).reduce(function(n,t){return n+t},0),ChildrenPerformance:n.performanceDetail.PerformanceDetail.map(function(n){return n.ChildrenPerformance}).reduce(function(n,t){return n+t},0),GroupPerformance:n.performanceDetail.PerformanceDetail.map(function(n){return n.GroupPerformance}).reduce(function(n,t){return n+t},0),RebateValue:n.performanceDetail.RebateDetails[0].RebateValue,RebateAmount:n.performanceDetail.RebateDetails[0].RebateAmount}:n.performanceDetail.PerformanceDetail=h(n.performanceDetail.PerformanceDetail,n.gameCategoryDefine))})}function d(){n.isProcessing=!0;i.post("/PyramidAgent/GetChildrenPerformanceDetail",{RewardId:n.performance.RewardId}).then(function(t){n.isProcessing=!1;let i=t.data;if(i.IsSuccess===!1){r.alertError(i.ErrorMessage);return}(n.childrenPerformanceDetail=i.ReturnObject,n.childrenPerformanceDetail&&(!n.childrenPerformanceDetail||n.childrenPerformanceDetail.length!==0))&&(n.childrenPerformanceDetailShow=[],n.childrenPerformanceDetail.forEach(function(t){t.PerformanceDetails.forEach(function(i){let r="";if(n.gameCategoryDefine===1)if(i.GameCategoryValues.length===n.gameKinds.length)r=n.langs.All;else{let t=n.gameKinds.filter(function(n){return i.GameCategoryValues[0]===n.Key});r=t[0].Value}let u={MemberId:t.MemberId,Account:t.Account,PromotedId:t.PromotedId,GroupMemberCount:t.GroupMemberCount,GameCategoryName:r,GameCategoryId:i.GameCategoryValues[0],SelfPerformance:i.SelfPerformance,GroupPerformance:i.GroupPerformance,RebateValue:i.RebateValue};n.childrenPerformanceDetailShow.push(u)})}))})}function h(t,i){return i===1&&t.forEach(function(t){let i=n.gameKinds.filter(function(n){return t.GameCategoryValue===n.Key});i.length&&(t.GameCategoryName=i[0].Value)}),t}n.previewObject=o;n.isProcessing=!1;n.isUpdatingLink=!1;n.langs=f.get("PyramidAgent");n.nowSelectTab=0;n.promotedInfo={};n.tabList=[{text:n.langs.MyPromotion,className:"promotedSelf"},{text:n.langs.PerformanceQuery,className:"performSearch"},{text:n.langs.DirectMember,className:"direct"},{text:n.langs.RebateRatio,className:"rebate"},{text:n.langs.PromotionTutorial,className:"tutorial"}];n.gameCategoryDefine=0;n.rebateDefine=0;n.nowSelectPerformSearchTab=0;n.nowSelectPerformSearchDetailTab="all";n.performSearchTab=[{text:n.langs.LastDays1,startDate:e.getCurrentMeidon().subtract(7,"days").format("YYYY/MM/DD"),endDate:null},{text:n.langs.LastDays2,startDate:e.getCurrentMeidon().subtract(15,"days").format("YYYY/MM/DD"),endDate:null},{text:n.langs.LastDays3,startDate:e.getCurrentMeidon().subtract(30,"days").format("YYYY/MM/DD"),endDate:null}];n.gameKinds=[];n.performanceList=[];n.performanceHead=[];n.isShowDetail=!1;n.performance={};n.performanceDetail={};n.performanceDetailAllCategory={};n.childrenPerformanceDetail=[];n.childrenPerformanceDetailShow=[];n.params={};n.childrenList=[];n.allDirectPerson=0;n.todayDirectPerson=0;n.nowSelectRebateSettingIndex=0;n.rebateSetting={};n.rebateList=[];u.connect();s();a();n.close=function(){t.dismiss()};n.changeTab=function(t){n.nowSelectTab!==t&&(n.nowSelectTab=t,l(),s())};n.changePerformSearchTab=function(t){n.nowSelectPerformSearchTab=t;s()};n.getChildren=function(){if(n.previewObject){n.childrenList=[];return}n.isProcessing=!0;i.post("/PyramidAgent/GetChildren",null).then(function(t){n.isProcessing=!1;let i=t.data;if(i.IsSuccess===!1){r.alertError(i.ErrorMessage);return}n.childrenList=i.ReturnObject;n.childrenList.forEach(function(n){n.GroupMemberCount=0;n.ChildrenMemberCount=0});n.childrenList&&(n.allDirectPerson=n.childrenList.length,n.todayDirectPerson=n.childrenList.filter(function(n){return n.IsDailyNew}).length)})};n.changeRebateSettingTab=function(t){n.nowSelectRebateSettingIndex=t;n.rebateList=n.rebateSetting.RebateSettings[t].Conditions};n.bindParentPromotedId=function(){n.previewObject||i.post("/PyramidAgent/BindingPromotedParent",{ParentPromotedId:n.params.parentPromotedId}).then(function(t){let i=t.data;if(i.IsSuccess===!1){r.alertError(i.ErrorMessage);return}n.promotedInfo.ParentPromotedId=n.params.parentPromotedId})};n.receive=function(){n.previewObject||i.post("/PyramidAgent/ReceiveRebate",null).then(function(n){let t=n.data;if(t.IsSuccess===!1){r.alertError(t.ErrorMessage);return}s()})};n.downQrcode=function(){if(!n.previewObject){const t=document.createElement("a");t.href="data:image/png;base64,"+n.promotedInfo.PromotedLinkQrCode;t.setAttribute("download","qrcode.png");t.click();t.remove()}};n.updateLink=function(){n.previewObject||n.isUpdatingLink||(n.isUpdatingLink=!0,i.post("/PyramidAgent/RefreshPromotedLink",null).then(function(t){let i=t.data;if(n.isUpdatingLink=!1,i.IsSuccess===!1){r.alertError(i.ErrorMessage);return}n.promotedInfo.PromotedLink=i.ReturnObject.PromotedLink;n.promotedInfo.PromotedLinkQrCode=i.ReturnObject.PromotedLinkQrCode}))};n.showPerformanceDetail=function(t){n.isShowDetail=!0;n.performance=t;c()};n.changePerformanceDetailTab=function(t){n.nowSelectPerformSearchDetailTab=t;t==="all"?c():d()};n.backToList=function(){n.isShowDetail=!1;s()}}]);app.controller("QrCodeAuthenticationCtrl",["$scope","$window","authInfo",function(n,t,i){function r(t){for(var f=[{type:"login",image:i.LoginQrCode,url:i.LoginUrl},{type:"register",image:i.RegisterQrCode,url:i.RegisterUrl}],r=null,u=0;u<f.length;u++)f[u].type===t&&(r=f[u]);r&&(n.mainQrCode.type=r.type,n.mainQrCode.image=r.image,n.mainQrCode.url=r.url)}function u(n){t.open(n,"_blank")}n.authInfo=i;n.mainQrCode={type:i.LoginQrCode?"login":"register",image:i.LoginQrCode||i.RegisterQrCode,url:i.LoginUrl||i.RegisterUrl};n.showAndroidLink=n.authInfo.AndroidAppUrl!=="None";n.showIosLink=n.authInfo.IosAppUrl!=="None";n.switchDisplayQrCode=r;n.openDownloadLink=u}]);app.controller("ReceiveAllDialogCtrl",["$scope","$modalInstance","$modal","ActivityService","CustomModalService","languageService",function(n,t,i,r,u,f){n.isProcessing=!1;n.isShowEnglish=f.currentLanguage!=="zh-CN"&&f.currentLanguage!=="zh-TW";n.receiveAll=function(){n.isProcessing||(n.isProcessing=!0,r.receivedAll().then(function(r){if(n.isProcessing=!1,r.Code!==200){u.alertError(r.Error[0].Message);return}t.dismiss();let f=r.Result.List.filter(function(n){return n.ReceivedTotalAmount>0}),e=f.map(function(n){return n.ReceivedTotalAmount}).reduce(function(n,t){return n+t},0);i.open({templateUrl:"/MemberCenter/ReceivedDetail",controller:"ActivityReceivedDetailDialogCtrl",windowClass:"activity-received-detail-dialog",resolve:{data:function(){return{totalAmount:e,receivedList:f}}}}).result.then(function(){window.location.reload()},function(){window.location.reload()})}))};n.close=function(){t.dismiss()}}]);app.controller("RedEnvelopeListCtrl",["$scope","$rootScope","$timeout","$location","$filter","$q","$window","RedEnvelopeService","CustomModalService","labelService","UserService","languageService",function(n,t,i,r,u,f,e,o,s,h,c,l){function y(){if(n.$on("enterMicroServiceError",function(){n.isLoading&&a()}),!window.__IsESModuleSupported||!window.__IsDynamicImportSupported){a();return}if("serviceWorker"in navigator){const n=navigator.serviceWorker;n.getRegistrations?n.getRegistrations().then(function(n){n.forEach(function(n){n.unregister()})}):n.getRegistration&&n.getRegistration().then(function(n){n&&n.unregister()})}setTimeout(function(){f.all([c.getJwtTokens(),]).then(function(i){var r=i[0],u;if(r){localStorage.setItem("jwtToken",r.JwtToken);localStorage.setItem("refreshToken",r.RefreshToken);n.progress=10;try{window.__Qiankun_addGlobalUncaughtErrorHandler(()=>{n.isLoading&&p()});u=localStorage.getItem("mobileType")?localStorage.getItem("mobileType"):"Origin";n.microAppState=window.__Qiankun_InitGlobalState({action:null,data:null});n.microAppState.onGlobalStateChange(function(t){switch(t.action){case"Mounted":n.isLoading=!1;break;case"SignOut":e.location.href="/Account/SignOut";break;case"ProgressRate":n.progress=t.data}});n.microApp=window.__Qiankun_LoadMicroApp({name:"activity",entry:window.__IsDebuggingEnabled?"http://localhost:8083/":"/fe/activity/",container:"#activity-container",props:{ApiDomain:window.__IsDebuggingEnabled?null:e.location.origin,JwtToken:r.JwtToken,RefreshToken:r.RefreshToken,Language:l.currentLanguage,IsHashMode:!0,DefaultCurrency:t.defaultCurrency,DefaultCountryCode:t.defaultCountryCode,DefaultTimezone:+sessionStorage.getItem("web_Timezone"),RouterBaseUrl:"/RedEnvelope/List/"}})}catch(f){alert(f)}}})})}function p(){n.isLoading=!1;n.isUnSupported=!0;n.errorTitle=h.get("MemberCenter.MicroAppTitleError");let t=window.navigator.userAgent;n.nowUserAgent=t;t.indexOf("agwv")>-1||t.indexOf("igwv")>-1||t.indexOf("agna")>-1||t.indexOf("igna")>-1?(n.errorTitle=h.get("MemberCenter.MicroAppTitleError2"),t.indexOf("agwv")>-1&&(n.nowUserAgent=n.nowUserAgent.replace("agwv","")),t.indexOf("igwv")>-1&&(n.nowUserAgent=n.nowUserAgent.replace("igwv","")),t.indexOf("agna")>-1&&(n.nowUserAgent=n.nowUserAgent.replace("agna","")),t.indexOf("igna")>-1&&(n.nowUserAgent=n.nowUserAgent.replace("igna","")),n.errorMsg=/Macintosh|Mac OS X/i.test(t)?h.get("MemberCenter.IosBrowserErrorMsg2"):u("format")(h.get("MemberCenter.UcWebviewErrorMsg2"),['<a href="https://browser.qq.com/" target="_blank">QQ浏览器<\/a>'])):n.errorMsg=/Macintosh|Mac OS X/i.test(t)?h.get("MemberCenter.IosBrowserErrorMsg"):u("format")(h.get("MemberCenter.UcWebviewErrorMsg"),['<a href="https://browser.qq.com/" target="_blank">QQ浏览器<\/a>'])}function a(){n.isLoading=!1;n.isUnSupported=!0;n.errorTitle=h.get("MemberCenter.BrowserVersionError");let t=window.navigator.userAgent;n.nowUserAgent=t;t.indexOf("agwv")>-1||t.indexOf("igwv")>-1||t.indexOf("agna")>-1||t.indexOf("igna")>-1?(t.indexOf("agwv")>-1&&(n.nowUserAgent=n.nowUserAgent.replace("agwv","")),t.indexOf("igwv")>-1&&(n.nowUserAgent=n.nowUserAgent.replace("igwv","")),t.indexOf("agna")>-1&&(n.nowUserAgent=n.nowUserAgent.replace("agna","")),t.indexOf("igna")>-1&&(n.nowUserAgent=n.nowUserAgent.replace("igna","")),/Macintosh|Mac OS X/i.test(t)?(n.errorTitle=h.get("MemberCenter.MicroAppTitleError"),n.errorMsg=h.get("MemberCenter.IosBrowserErrorMsg2")):n.errorMsg=u("format")(h.get("MemberCenter.CheckES6Tip2"),['<a href="https://browser.qq.com/" target="_blank">QQ浏览器<\/a>'])):/Macintosh|Mac OS X/i.test(t)?(n.errorTitle=h.get("MemberCenter.MicroAppTitleError"),n.errorMsg=h.get("MemberCenter.IosBrowserErrorMsg")):n.errorMsg=u("format")(h.get("MemberCenter.CheckES6Tip"),['<a href="https://browser.qq.com/" target="_blank">QQ浏览器<\/a>'])}function w(n){n.receivePage="withdraw";i(function(){n.animateStart=!0},50)}function b(t){var i=t.Id;!n.isWithdrawing&&(i||i===0)&&(n.isWithdrawing=!0,o.withdraw(i).then(function(r){var u=r.data;if(n.isWithdrawing=!1,u.IsSuccess===!1){s.alertError(u.ErrorMessage).then(function(){v(i)});return}w(t)}))}function v(i){for(var r=0;r<n.redEnvelopes.length;r++)n.redEnvelopes[r].Id!==i||n.redEnvelopes[r].isHide||(n.redEnvelopes[r].isHide=!0,n.receivableAmount--,t.$broadcast("hideRedEnvelope",i));n.receivableAmount===0&&t.$broadcast("noReceivedRedEnvelope")}n.isLoading=!0;n.isWithdrawing=!1;n.redEnvelopes=[];n.receivableAmount=0;n.langs=h.get("RedEnvelope");n.withdraw=b;n.hideRedEnvelope=v;n.deviceLang=h.get("MemberCenter.Device");n.microApp;n.microAppState;n.progress=0;n.isUnSupported=!1;n.nowUserAgent="";n.errorTitle="";n.errorMsg="";var k=r.search().redenvelope?o.getListSingleton:o.getList;y()}]);app.controller("RegisterAgreementCtrl",["$scope","$http","$modalInstance","CustomModalService","SiteSettingService","labelService","languageService",function(n,t,i,r,u,f,e){function h(){if(o){s(o);return}t.post("/Register/GetRegisterAgreementSetting",null).then(function(n){var t=n.data;if(t.IsSuccess===!1){r.alertError(t.ErrorMessage);return}s(t.ReturnObject)})}function s(t){var i=/&lt;前台站名&gt;/g;u.getSiteTitleSingleton().then(function(r){var u=r.PortalSiteName;n.agreement=t.replace(i,u);n.isLoading=!1})}var o=sessionStorage.getItem("registerAgreementPreview");n.isLoading=!0;n.agreement="";n.langs=f.get("Register");n.langs.Loading=f.get("Common.Loading");e.getMultilingual(["Register"]).then(function(t){n.langs.Agreement=t.data.Register_Registration_Agreement;h()});n.close=function(){i.close()}}]);app.controller("RegisterCtrl",["$scope","$window","$http","$modal","$q","$rootScope","$timeout","labelService","detectionRobotService","signalrService","CustomModalService","captchaService","LogErrorsService","FavoriteGameService","SiteSettingService","LobbyNavService","$filter",function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p){function ot(){n.bankAccountValidate={valid:!0,tip:""}}function at(n){setMaxDigits(129);var t=new RSAKeyPair(tt,"",it);return encryptedString(t,n)}function rt(t){if(n.isProcessing=!1,!n.useVaptcha){if(!n.checkCode){c.alert(o.get("Register.Empty_Checkcode")||"验证码为空, 请取得验证码");return}t.checkCodeEncrypt=n.checkCode.encrypt}t.GroupBankId=n.params.GroupBank?n.params.GroupBank.Id:null;t.Name&&t.Name.trim();n.isProcessing=!0;a.start();s.detectionRobot(t,n.registerSetting).then(function(){w=l.verifyViaDialogForRegister();w?n.$on("validateNECaptcha"+w,function(n,i){t.neCaptcha=i.neCaptcha;t.neCaptchaId=i.neCaptchaId;st(t)}):st(t)},function(n){ut();c.alert(n||o.get("Register.VerificationFailed"))})}function st(n){i.post("/Register/CheckAndSendConfirmCode",{Phone:n.Phone,CountryCode:n.CountryCode,ParentAccount:n.ParentAccount}).then(function(t){var i=t.data,u;if(i.IsSuccess===!1){ut();c.alertError(i.ErrorMessage);return}u=i.ReturnObject.Enable;u?r.open({templateUrl:"/Register/SmsAuthenticationDialog",controller:"RegisterSmsAuthenticationDialogCtrl",windowClass:"modal-sad",resolve:{info:function(){return{agent:n.ParentAccount,countryCode:n.CountryCode,phone:n.Phone,token:i.ReturnObject.VerifyToken}}}}).result.then(function(t){n.MobileVerifyToken=t.token;n.MobileVerifyConfirmCode=t.code;ht(n)},function(){ut();c.alert(o.get("Register.VerificationFailed"))}):ht(n)})}function ht(n){try{Fingerprint2.get(function(t){var i=[],r;angular.forEach(t,function(n){i.push(n.value)});r=Fingerprint2.x64hash128(i.join(""),31);n.fingerprint=r;ct(n)})}catch(t){n.fingerprint="";ct(n)}}function ut(){n.params.checkCode=null;$("#checkcode-input-group input").focus();n.isProcessing=!1;a.cancel()}function ct(r){var s,u;if(!tt||!it){c.alert((o.get("Register.Different_Password")||"会员密码与确认密码不同")+".").then(function(){n.isProcessing=!1;a.cancel()});return}s=["extend","stringify"],function(n,t){var i=function(t){while(--t)n.push(n.shift())};i(++t)}(s,307);var l=function(n){n=+n;return s[n]},d=JSON[l("0x0")](angular[l("0x1")](angular.extend({},r),angular[l("0x1")](nt,{_c2:h.getConnectionId2()}))),y=encodeURIComponent(d),p=100,k=[];for(u=0;u<y.length;u+=p)k.push(at(y.substr(u,p)));i.post("/Register/Register",k).then(function(i){var r=i.data,h,l,s,u;if(r.IsNeCaptchaFailed){f.$broadcast("reInitNECaptcha"+w);return}if(f.$broadcast("closeCaptchaModal"+w),n.isProcessing=!1,r.IsSuccess){if(setTimeout(function(){$("#btn-submit").focus()}),r.MemberRegisterVerifySwitch){h=o.get("Register.RegisterVerifyDescription")||"您已完成注册手续，请在{0}分钟内洽客服开通帐号";l=h.replace("{0}",r.AvailableMinutes);c.alertError(l,"Live800LinkReview").then(function(){t.location.href="/"});return}for(s=0;s<r.Cookies.length;s++)document.cookie=r.Cookies[s];v.addFavoritesFromStorage();r.LuckyNumberBonusAmount?pt({amount:r.LuckyNumberBonusAmount,text:r.LuckyNumberActivityText}):wt();e(function(){t.location="/Register/Success"},1e4)}else{if(u=r.ErrorMessage,u==="token-expired"){b();return}if(u==="验证失败，请点击确定刷新页面"){c.alertError(u).then(function(){location.reload();return});return}c.alertError(u).then(function(){u&&u.indexOf("找不到此代理商")>=0&&$("#parentAccount").select().focus();n.params.checkCode=null;$("#checkcode-input-group input").focus();a.cancel()})}})}function vt(t){d=t.Scene;var i={vid:t.Vid,type:"invisible",scene:d,offline_server:"/offline"};l.post("Register");vaptcha(i,f).then(function(t){b=t.validate.bind(t);et=t.reset.bind(t);t.listen("close",function(){n.isProcessing=!1});t.listen("pass",function(){k.vaptchaToken=t.getToken();k.vaptchaScene=d;rt(k);t.reset()})})}function yt(){angular.element(document.getElementsByClassName("vp-s-fail")).length>0&&angular.element(document.getElementsByClassName("vp-close")).bind("click",function(){n.isProcessing=!1;et();angular.element(document.getElementsByClassName("vp-close")).unbind("click")})}function pt({amount:n,text:i}){r.open({templateUrl:"/Register/LuckyNumberDialog",windowClass:"modal-rlnd modal-transparent",resolve:{amount:function(){return n},text:function(){return i}},controller:"RegisterLuckyNumberDialogCtrl"}).result.then(function(){p.openLobbyNav("/Lobby/RecommendGame?CategoryKey=3","RecommendList");e(function(){t.location="/Register/Success"},400)},function(){e(function(){t.location="/Register/Success"},400)})}function wt(){r.open({template:'<link href="/Content/Views/Register/SuccessDialog.css?version=20190419" rel="stylesheet" /><span class="btn-close" ng-click="close()"><\/span><div class="modal-rsd-content">    <p class="title">{{ langs.RegisterSuccess }}<\/p>    <p class="info" ng-if="showWithdraw">{{ langs.YouCan }} <span ng-click="withdraw()">{{ langs.BindBank }}<\/span>，{{ langs.WithdrawAnyTime }}!<\/p>    <div class="button-section">        <button class="btn-enter" ng-click="enter()" type="button">{{ langs.StartGame }}<\/button>        <button class="btn-deposit" ng-click="deposit()" type="button">{{ langs.DepositImmediately }}<\/button>    <\/div><\/div>',controller:"RegisterSuccessDialogCtrl",windowClass:"modal-rsd",resolve:{isBankAccount:function(){return!!n.params.BankAccount}}}).result.then(function(n){e(function(){t.location="/Register/Success?url="+n},400)},function(){e(function(){t.location="/Register/Success"},400)})}var b,k,d,ft=1,lt=10,et,w,nt,tt,it,g;y.getRegisterVerifyTypeSingleton().then(function(t){n.useVaptcha=t.RegisterCaptchaVerifyType===2;n.useVaptcha&&vt(t)});n.isProcessing=!1;i.post("/Register/GetRsa").then(function(t){var i=t.data;tt=i.Item1;it=i.Item2;n.params.CountryCode=f.defaultCountryCode;n.CountryCodes=[{Id:1,Name:"日本",Code:"+81"},{Id:2,Name:"中國",Code:"+86"}].filter(function(n){return n.Code===f.defaultCountryCode})});n.params={};n.agree=!0;n.isShowMore=!1;n.$watch("params.QQAccount",function(t,i){if(t){var r=new RegExp("^[0-9]+$").test(t);r||(n.params.QQAccount=i)}});i.post("/Register/GetAllBanks").then(function(t){n.banks=t.data;n.params.GroupBank=null});g=[{type:1,regx:/^[^\u4e00-\u9fa5]+$/,tip:o.get("Common.FormatTip_Chinese")||"请勿填入中文字"},{type:2,regx:/^[0-9]+$/,tip:o.get("Common.FormatTip_Number")||"格式不正确，请输入0到9之间的数字"},{type:3,regx:/(^[0-9]+$)|(\w+((-\w+)|(^\.\w+))*\@[A-Za-z0-9]+((\.|-)[A-Za-z0-9]+)*\.[A-Za-z]+$)/,tip:o.get("Common.FormatTip_NumberOrEmail")||"帐号格式不正确，请输入數字或Email格式"},{type:4,regx:/^\w+((-\w+)|(\.\w+))*\@[A-Za-z0-9]+((\.|-)[A-Za-z0-9]+)*\.[A-Za-z]+$/,tip:o.get("Common.FormatTip_Email")||"请输入信箱格式，例如:account@email.com"}];n.bankAccountValidate={valid:!0,tip:""};n.checkBankRequired=function(){var i=[n.params.GroupBank,n.params.BankAccount],t;for(n.bankRequired=!1,t=0;t<i.length;t++)if(!!i[t]){n.bankRequired=!0;return}};n.checkBankAccountFormat=function(){var i,t,r;if(!n.params.GroupBank||!n.params.BankAccount){ot();return}for(t=0;t<g.length;t++)g[t].type===n.params.GroupBank.AccountFormat&&(i=g[t]);r=new RegExp(i.regx).test(n.params.BankAccount);n.bankAccountValidate.valid=r;n.bankAccountValidate.tip=r?"":i.tip};n.changeGroupBank=function(){ot();n.params.BankAccount="";n.checkBankRequired()};n.register=function(t){var i=angular.copy(t),f=n.recommenderSetting.some(n=>new RegExp(n).test(i.ParentAccount)),s=new RegExp(n.accountSetting.Pattern).test(i.Account),h=new RegExp("^(?=.*[a-zA-Z])(?=.*[0-9]).{6,}$").test(i.Password),r,u;if(!f){c.alert(o.get("Register.ParentAccount_Error"));return}if(!s){c.alert(o.get("Register.Account_Error")||"会员帐号格式错误");return}if(!h){c.alert(o.get("Register.Password_Error")||"会员密码格式错误，至少 6 个字符以上，须包含字母及数字");return}if(n.Confirm_Password!=i.Password){c.alert(o.get("Register.Different_Password")||"会员密码与确认密码不同");return}if(r=i.Phone?new RegExp("^[0-9]+$").test(i.Phone):!0,!r){c.alert(o.get("Register.Mobile_Error")||"手机号码格式错误");return}if(i.Birthday&&(u=/^\d{4}\/\d{2}\/\d{2}$/g,!u.test(i.Birthday))){c.alert(o.get("Register.Birthday_Error")||"出生日期格式错误");return}if(!n.bankAccountValidate.valid){$('input[ng-model="scope.params.BankAccount"]').focus();return}if(!n.agree){c.alert(o.get("Register.Not_Agree")||"未同意用户注册协议");return}if(n.useVaptcha){if(n.isProcessing=!0,!b&&ft<lt){ft++;e(function(){n.register(i)},990);return}try{k=i;b();e(function(){yt()},1e3)}catch(l){i.vaptchaToken="";i.vaptchaScene=d;rt(i)}return}rt(i)};n.moreOptionClick=function(){n.isShowMore=!0};n.closeMarquee=function(){n.isMarqueeShowClass=!1};n.scope=n;i.post("/Login/GetAllAccountRule",null).then(function(t){n.recommenderSetting=t.data});i.post("/Register/GetRegisterSetting").then(function(t){var r=t.data,u,i;if(r.IsSuccess===!1){c.alertError(r.ErrorMessage);return}n.registerSetting=r;n.accountSetting=r.AccountRule;n.state="ok";u=["input[required]","length","keydown","which","keyCode","indexOf","form[ng-submit='register(params)']","find"],function(n,t){var i=function(t){while(--t)n.push(n.shift())};i(++t)}(u,270);i=function(n){n=+n;return u[n]};setTimeout(function(){var n=$(i("0x0"))[i("0x1")](i("0x2")),t;nt={_r:n[i("0x3")],_k:0};t=[9,13,16,17,18,91];n.on(i("0x4"),function(n){var r=n[i("0x5")]||n[i("0x6")];t[i("0x7")](r)<0&&nt._k++})},0)});n.hasOptional=function(){var t,i,r,u;for(t in n.registerSetting)if((i=t.indexOf("IsShow_"),!(i<0))&&(r=n.registerSetting[t],r!=!1)&&(u=n.registerSetting["IsRequired_"+t.split("_")[1]],u==!1))return!0;return!1}}]);app.controller("RegisterLuckyNumberDialogCtrl",["$scope","$modalInstance","labelService","amount","text",function(n,t,i,r,u){function f(){t.close()}function e(){t.dismiss()}n.langs=i.get("Register");n.amount=r;n.text=u;n.close=f;n.dismiss=e}]);app.controller("RegisterSmsAuthenticationDialogCtrl",["$scope","$http","$modalInstance","$interval","labelService","CustomModalService","info",function(n,t,i,r,u,f,e){function c(){o&&r.cancel(o);i.close({token:n.params.token,code:n.params.code})}function l(){if(n.isResendable){var i={CountryCode:e.countryCode,Phone:e.phone,ParentAccount:e.agent};t.post("/Register/CheckAndSendConfirmCode",i).then(function(t){var i=t.data;if(i.IsSuccess===!1){f.alertError(i.ErrorMessage);return}n.params.token=i.ReturnObject.VerifyToken;h()})}}function h(){n.remain=s;n.isResendable=!1;o=r(function(){if(n.remain===0){r.cancel(o);n.isResendable=!0;return}n.remain=n.remain-1},1e3)}var s=60,o;n.isResendable=!1;n.langs=u.get("SmsAuthentication");n.params={code:"",token:e.token};n.tip=n.langs.SendSms+e.countryCode+e.phone+" ，"+n.langs.SendSmsTime;n.remain=s;n.ok=c;n.resend=l;h()}]);app.controller("RegisterSuccessDialogCtrl",["$scope","$modalInstance","$document","isBankAccount","LobbyNavService","labelService","_env",function(n,t,i,r,u,f,e){function o(){t.dismiss()}function s(n){t.close(n)}var h=e.RegisterSuccessDialogCtrl?e.RegisterSuccessDialogCtrl.CategoryKey||3:3;n.langs=f.get("Register");n.showWithdraw=!r;n.close=function(){o()};n.enter=function(){var n="/Lobby/RecommendGame?CategoryKey="+h;u.openLobbyNav(n,"RecommendList");o()};n.deposit=function(){s("/#/Finance/Deposit")};n.withdraw=function(){s("/#/Finance/Withdraw")};i.on("keydown",function(n){switch(n.keyCode){case 13:o();break;case 27:o()}});n.$on("$destroy",function(){i.off("keydown")})}]);app.controller("RescueMoneyCtrl",["$scope","$modal","$window","$location","labelService","MeidonTimeService","LoginRedirectService","SiteSettingService","RescueMoneyService",function(n,t,i,r,u,f,e,o,s){function l(){if(y(),c){p();return}if(!_IsLogin){e.goLogin();return}s.getSwitch().then(function(t){if(n.isEnable=t,!n.isEnable){n.isLoading=!1;return}s.getList().then(function(n){h(n)})})}function a(){var t=f.getCurrentMeidon(),i=moment(t).endOf("day");n.meidonSeconds=resetDateTimeByTimezone(i)}function v(){i.location.reload()}function y(){o.getSiteTitleSingleton().then(function(t){document.title=t.PortalSiteName+" - "+n.langs.RescueMoney})}function p(){function t(r){var u=r.data.ReturnObject;h(u);n.isEnable=!0;i.removeEventListener("message",t,!1)}i.addEventListener("message",t,!1);i.opener.postMessage("message",r.search().rescuemoney)}function h(t){t.ActivityStartTime=resetDateTimeByTimezone(t.ActivityStartTime);t.ActivityEndTime=resetDateTimeByTimezone(t.ActivityEndTime);t.Status===2&&!t.IsReceived&&t.Amount>0&&a();n.rescueMoneyData=t;n.isLoading=!1}function w(i){t.open({templateUrl:"rescueMoneyDetailModal",windowClass:"modal-rescueMoneyDetail",resolve:{detail:function(){return i},langs:function(){return n.langs}},controller:["langs","$scope","detail","$modalInstance",function(n,t,i,r){t.langs=n;t.detail=i.join(" / ");t.close=function(){r.dismiss()}}]}).result.then(function(){},function(){})}function b(i){n.isProcessing||(n.isProcessing=!0,s.getMoney().then(function(){n.isProcessing=!1;n.rescueMoneyData.IsReceived=!n.rescueMoneyData.IsReceived;t.open({templateUrl:"receivedRescueMoneyDetailModal",windowClass:"modal-receivedRescueMoneyDetail",resolve:{amount:function(){return i}},controller:["$scope","amount","$modalInstance",function(n,t,i){n.amount=t;n.close=function(){i.dismiss()}}]}).result.then(function(){},function(){})}))}var c=r.search().rescuemoney;n.isLoading=!0;n.isEnable=!1;n.isProcessing=!1;n.langs=u.get("RescueMoney");n.langs.Loading=u.get("Common.Loading");n.langs.NoEvent=u.get("Common.NoEvent");n.titleDateFormat="YYYY/MM/DD HH:mm:ss";n.openRescueMoneyDetail=w;n.openReceivedRescueMoneyDetail=b;n.countDownCallback=v;n.rescueMoneyData=[];l()}]);app.controller("SiteMailCountCtrl",["$scope","$http","DataService",function(n,t,i){n.MailIsReadCount=i.getValue();setTimeout(function(){t.post("/SiteMail/GetUnreadMailCount").then(function(n){n.data.Count>0&&i.setValue(n.data.Count)});n.isNeedReceive&&t.post("/SiteMail/ReceiveMail").then(function(n){n.data.HasNewMail&&t.post("/SiteMail/GetUnreadMailCount").then(function(n){n.data.Count>0&&i.setValue(n.data.Count)})})})}]);app.controller("SiteMailCtrl",["$scope","$http","$window","$modal","$timeout","bodyScrollService","DataService","labelService","CustomModalService",function(n,t,i,r,u,f,e,o,s){function b(){n.unRead=e.getValue();t.post("/SiteMail/GetUnreadMailCount").then(function(n){n.data.Count>0&&e.setValue(n.data.Count)})}function k(){h.inbox&&n.mailbox=="inbox"||h.sentbox&&n.mailbox=="sentbox"||h.promotionbox&&n.mailbox=="promotionbox"||f.getDistanceOfBottom()>1e3||(n.mailbox=="inbox"?v():n.mailbox=="sentbox"?y():n.mailbox=="promotionbox"&&p())}function v(){h.inbox=g().then(function(n){return rt(n)})}function y(){h.sentbox=nt().then(function(n){return ut(n)})}function p(){h.promotionbox=it().then(function(n){return et(n)})}function d(){tt().then(function(n){ft(n)})}function g(){return t.post("/SiteMail/GetInboxList",{Size:c,LastId:n.getInboxListMinId}).then(function(n){return n.data})}function nt(){return t.post("/SiteMail/GetSentboxList",{Size:c,LastId:n.getSentboxListMinId}).then(function(n){return n.data})}function tt(){return t.post("/AnnouncementSiteMail/GetStickyList",null).then(function(n){return n.data})}function it(){return t.post("AnnouncementSiteMail/GetList",{Size:c,LastId:n.getPromotionboxListMinId}).then(function(n){return n.data})}function rt(t){(n.getInboxListMinId=t.LastId,t.InboxMailList.length>0&&(n.mailList.inbox=n.mailList.inbox.concat(t.InboxMailList)),t.InboxMailList.length<c&&(n.isFinish.inbox=!0,a()),n.isFinish.inbox)||(h.inbox=null)}function ut(t){(n.getSentboxListMinId=t.LastId,t.SentboxMailList.length>0&&(n.mailList.sentbox=n.mailList.sentbox.concat(t.SentboxMailList)),t.SentboxMailList.length<c&&(n.isFinish.sentbox=!0,a()),n.isFinish.sentbox)||(h.sentbox=null)}function ft(t){var i=t.ReturnObject;if(!i||i.length===0){n.isAnySticky=!1;return}n.isAnySticky=!0;n.mailList.promotionbox=i.concat(n.mailList.promotionbox)}function et(t){(n.getPromotionboxListMinId=t.LastId,t.MailList.length>0&&(n.mailList.promotionbox=n.mailList.promotionbox.concat(t.MailList)),t.MailList.length<c&&(n.isFinish.promotionbox=!0,a()),n.isFinish.promotionbox)||(h.promotionbox=null)}function ot(t){return $.map($.grep(n.mailList[t],function(n){return n.isSelected}),function(n){return n.Id})}function a(){n.isFinish.inbox&&n.isFinish.sentbox&&n.isFinish.promotionbox&&$(window).off("scroll")}function w(){n.editing&&(CKEDITOR.instances.replyEditor.removeAllListeners(),CKEDITOR.remove(CKEDITOR.instances.replyEditor));n.editing=!1;n.detailMail={}}var c,h,l;n.mailbox="promotionbox";c=100;h={inbox:null,sentbox:null,promotionbox:null};n.mailList={inbox:[],sentbox:[],promotionbox:[]};n.isFinish={inbox:!1,sentbox:!1,promotionbox:!1};n.isAllSelected={inbox:!1,sentbox:!1};l={language:"zh-cn",height:"350",allowedContent:!0,removePlugins:"uploadimage",basicEntities:!1,toolbarGroups:[{name:"clipboard",groups:["clipboard","undo"]},{name:"basicstyles",groups:["basicstyles"]},{name:"paragraph",groups:["list","indent","blocks","align"]},{name:"links",groups:["links"]},{name:"insert",groups:["insert"]},{name:"styles",groups:["styles"]},{name:"colors",groups:["colors"]},{name:"tools",groups:["tools"]},{name:"others",groups:["others"]}],removeButtons:"PasteFromWord,Superscript,Subscript,CreateDiv,Image,Flash,Smiley,SpecialChar,PageBreak,Anchor,Iframe,Styles,Format,ShowBlocks,EmbedSemantic"};v();y();p();d();b();$(window).scroll(function(){k()});n.allSelect=function(t){$.each(n.mailList[t],function(i,r){r.isSelected=n.isAllSelected[t]})};n.mailSelect=function(t){var i=!1;angular.forEach(n.mailList[t],function(n){n.isSelected||(i=!0)});n.isAllSelected[t]=!i};n.delMail=function(i){function u(){var n={};return i=="inbox"?(n={inboxMailIds:r},t.post("/SiteMail/DeleteInboxMails",n).then(function(n){return n.data})):i=="sentbox"?(n={sentboxMailIds:r},t.post("/SiteMail/DeleteSentboxMails",n).then(function(n){return n.data})):void 0}function f(n){n.IsSuccess||s.alertError(n.ErrorMessage)}var r=ot(i);s.confirm(o.get("SiteMail.BatchConfirmDel")+n.countSelected(i)+o.get("SiteMail.BatchDelLetter")).then(function(t){var h,o,s;if(t){for(h=0,o=0;o<n.mailList[i].length;o++)for(s=0;s<r.length;s++)n.mailList[i][o].Id==r[s]&&(n.mailList[i][o].IsRead===!1&&h++,n.mailList[i].splice(o,1));e.setValue(n.unRead.Count-h);u().then(function(n){return f(n)})}})};n.countSelected=function(t){return n.mailList[t].length?n.mailList[t].filter(function(n){return n.isSelected}).length:0};n.markReadState=function(i){for(var f,r=$.map($.grep(n.mailList.inbox,function(n){return i?n.isSelected&&!n.IsRead:n.isSelected&&n.IsRead}),function(n){return n.Id}),u=0;u<n.mailList.inbox.length;u++)for(f=0;f<r.length;f++)n.mailList.inbox[u].Id==r[f]&&(n.mailList.inbox[u].IsRead=i);(i?e.setValue(parseInt(n.unRead.Count)-r.length):e.setValue(parseInt(n.unRead.Count)+r.length),r.length)&&t.post("/SiteMail/SetInboxMailsAsReadOrUnread",{inboxMailIds:r,isRead:i}).then(function(n){n.data.IsSuccess||s.alertError(n.data.ErrorMessage)})};n.openNewMail=function(){r.open({templateUrl:"newMailModal",scope:n,windowClass:"modal-sitemail",controller:["$modalInstance","$scope","$timeout","$http",function(n,t,i,r){t.subject="";t.close=n.close;t.focusOnOpen={};i(function(){l.startupFocus=!1;CKEDITOR.replace("newMail",l);t.focusOnOpen.focus("subject")});t.sentMail=function(){var n=CKEDITOR.instances.newMail.getData(),i;if(!n){s.alert(o.get("SiteMail.ContentEmpty")||"信息内容不能为空白");return}if(n.length>2e3){s.alert(o.get("SiteMail.ContentOver")||"内容超过限定字数");return}t.isProcess=!0;i={Subject:t.subject,MailBody:n};r.post("/SiteMail/SendMail",i).then(function(n){if(t.isProcess=!1,!n.data.IsSuccess){s.alertError(n.data.ErrorMessage).then(function(){t.close()});return}t.mailList.sentbox.unshift({Id:n.data.Id,MailId:n.data.MailId,Subject:n.data.Subject,MailBodyPreview:n.data.MailBodyPreview,SendDate:n.data.SendDate});s.alert(o.get("SiteMail.SendSuccess")||"您的信件已送出").then(function(){t.close();t.subject="";CKEDITOR.instances.newMail.setData("")})})}}]}).result.then(function(){},function(){})};n.openMail=function(i){r.open({templateUrl:"detailMailModal",scope:n,windowClass:"modal-sitemail",controller:["$scope","$modalInstance",function(n,i){n.close=function(){w();i.close()};n.editStart=function(){n.editing=!0;n.replySubject="RE:"+n.detailMail.Subject;l.startupFocus=!0;CKEDITOR.replace("replyEditor",l);CKEDITOR.instances.replyEditor.setData('<p><\/p><blockquote><div style="color:#777;font-style: normal;">系统 于 '+moment(n.detailMail.SendDate).format("YYYY/MM/DD (dd) HH:mm")+"寄出<\/div><div>"+n.detailMail.detail+"<\/div><\/blockquote>")};n.replyMail=function(){var i=CKEDITOR.instances.replyEditor.getData(),r;if(!i){s.alert(o.get("SiteMail.ContentEmpty")||"信息内容不能为空白");return}if(n.replySubject.length>50){s.alert(o.get("SiteMail.SubjectOver")||"主旨超过限定字数");return}if(i.length>2e3){s.alert(o.get("SiteMail.ContentOver")||"内容超过限定字数");return}n.replying=!0;r={Subject:n.replySubject,MailBody:i};t.post("/SiteMail/SendMail",r).then(function(t){if(n.replying=!1,!t.data.IsSuccess){s.alertError(t.data.ErrorMessage).then(function(){n.close()});return}n.mailList.sentbox.unshift({Id:t.data.Id,MailId:t.data.MailId,Subject:t.data.Subject,MailBodyPreview:t.data.MailBodyPreview,SendDate:t.data.SendDate});s.alert(o.get("SiteMail.Replyed")||"您的信件已回复").then(function(){n.close()})})};n.delDetail=function(i){function r(){var r={};return i=="inbox"?(r={inboxMailIds:n.detailMail.Id},t.post("/SiteMail/DeleteInboxMails",r).then(function(n){return n.data})):i=="sentbox"?(r={sentboxMailIds:n.detailMail.Id},t.post("/SiteMail/DeleteSentboxMails",r).then(function(n){return n.data})):void 0}function u(n){if(!n.IsSuccess){s.alertError(n.ErrorMessage);return}}s.confirm(o.get("SiteMail.ConfirmDel")||"确定要删除此信件？").then(function(t){t&&(r().then(function(n){return u(n,i)}),angular.forEach(n.mailList[i],function(t,r){t.Id==n.detailMail.Id&&n.mailList[i].splice(r,1)}),n.close())})}}]}).result.then(function(){},function(){w()});n.detailLoading=!0;n.detailMail=i;n.detailMail.IsRead===!1&&(n.unRead.Count--,e.setValue(n.unRead.Count),angular.forEach(n.mailList.inbox,function(t){t.Id==n.detailMail.Id&&(t.IsRead=!0)}),t.post("/SiteMail/SetInboxMailsAsReadOrUnread",{inboxMailIds:n.detailMail.Id,isRead:!0}).then(function(n){n.data.IsSuccess||s.alertError(n.data.ErrorMessage)}));n.mailbox!=="promotionbox"?t.post("/SiteMail/GetMailDetail",{mailId:n.detailMail.MailId}).then(function(t){n.detailLoading=!1;t.data.IsSuccess||s.alertError(t.data.ErrorMessage);n.detailMail.detail=t.data.MailDetail.MailBody}):(n.detailLoading=!1,n.detailMail.detail=n.detailMail.MailBody)}}]);app.controller("SmsAuthenticationCtrl",["$http","$scope","labelService","CustomModalService",function(n,t,i,r){function u(){f().then(function(n){if(!n){t.isEnable=n;return}e().then(function(i){t.status=i;t.isEnable=n})})}function f(){return n.post("/LoginValidationBinding/SmsIsEnable",null).then(function(n){return n.data.Enable||!1})}function e(){return n.post("/LoginValidationBinding/SmsGetStatus",null).then(function(n){return n.data||!1})}function o(){if(!t.isProcessing){if(t.status){var u='<br/><a href="javascript:void(0)" line-chat-click="Live800LinkReview"><i class="fas fa-headphones"><\/i> '+i.get("Register.ContactCustomerService")||"联系客服<\/a>";r.alert((i.get("GoogleAuthenticator.CancelVerificationTip")||"如欲解除，请联系客服人员。")+u);return}t.isProcessing=!0;t.status=!t.status;n.post("/LoginValidationBinding/UpdateSmsLoginValidationEnable",{enable:t.status}).then(function(n){var i=n.data;if(t.isProcessing=!1,i.IsSuccess===!1){t.status=!t.status;r.alertError(i.ErrorMessage);return}})}}t.isEnable=null;t.status=!1;t.isProcessing=!1;t.switchStatus=o;t.langs=i.get("SmsAuthentication");t.langs.Loading=i.get("Common.Loading");u()}]);app.controller("SmsAuthenticationDialogCtrl",["$scope","$http","$modalInstance","$window","$interval","CustomModalService","labelService","info","typeDescription",function(n,t,i,r,u,f,e,o,s){function v(){i.close(n.params.code)}function y(){if(n.isResendable){var i=o.token,u=a.filter(function(n){return n.description===s})[0].number;t.post("/Account/ResendSms",{refreshToken:i,validateType:u}).then(function(n){var t=n.data;if(t.IsSuccess===!1){f.alertError(t.ErrorMessage).then(function(){r.location.reload()});return}l()})}}function l(){n.remain=h;n.isResendable=!1;c=u(function(){if(n.remain===0){u.cancel(c);n.isResendable=!0;return}n.remain=n.remain-1},1e3)}var h=60,a=[{number:1,description:"login"},{number:2,description:"changePassword"}],c;n.isResendable=!1;n.langs=e.get("SmsAuthentication");n.params={code:""};n.tip=n.langs.SendSms+o.mobile+" ，"+n.langs.SendSmsTime;n.remain=h;n.ok=v;n.resend=y;l()}]);app.controller("TimeLimitedEventCtrl",["$scope","$http","$location","$window","$modal","$filter","CustomModalService","labelService","SiteSettingService","LoginRedirectService",function(n,t,i,r,u,f,e,o,s,h){function a(){if(s.getSiteTitleSingleton().then(function(t){var i=t.PortalSiteName;document.title=i+" - "+n.langs.TimeLimitedEvent}),c){v();return}if(!_IsLogin){h.goLogin();return}t.post("/TimeLimitedEvent/List",null).then(function(t){var i=t.data;if(n.isLoading=!1,i.IsSuccess===!1){e.alertError(i.ErrorMessage);return}l(i.ReturnObject)})}function v(){function t(i){var u=i.data.ReturnObject;l(u);n.isLoading=!1;r.removeEventListener("message",t,!1)}r.addEventListener("message",t,!1);r.opener.postMessage("message",i.search().discountwallet)}function l(t){var i,r;for(t=t||[],i=0;i<t.length;i++)r={id:t[i].Id,name:t[i].Name,gameCategoryName:t[i].GameCategoryNames.join("、"),beginTime:t[i].BeginTime?resetDateTimeByTimezone(t[i].BeginTime):null,endTime:t[i].EndTime?resetDateTimeByTimezone(t[i].EndTime):null,applyPeopleCount:t[i].ApplyPeopleCount,maxApplyCount:t[i].MaxApplyCount,isApplyFull:t[i].IsApplyFull,imageUrl:f("filterCdn")(t[i].ImageUrl,"https://cdn.fidlite.com/"),isCanJoin:c?!0:t[i].IsCanJoin,eventBonusDetails:t[i].EventBonusDetails||[]},n.activities.push(r)}function y(t){if(t&&t.eventBonusDetails.length&&!t.isApplyFull){if(!t.isCanJoin){e.alert(n.langs.NotMatchApply||"未达申请条件");return}p(t)}}function p(n){u.open({templateUrl:"activityDetailModal",controller:["$scope","$http","$window","$modalInstance","CustomModalService","labelService",function(t,i,r,u,e,o){function s(n){for(var r=t.langs.ApplyDetail||"申请金额 {0} 送【{1} 优惠金 {2}】*解除优惠需打码满 {3}",i=0;i<n.eventBonusDetails.length;i++)n.eventBonusDetails[i].BonusId=n.eventBonusDetails[i].BonusId||i,n.eventBonusDetails[i].eventInfo=r.replace("{0}",'<span class="text-danger">'+f("customCurrency")(n.eventBonusDetails[i].DepositAmount)+"<\/span>").replace("{1}","<span>"+n.gameCategoryName+"<\/span>").replace("{2}",'<span class="text-danger">'+f("customCurrency")(n.eventBonusDetails[i].BonusAmount)+"<\/span>").replace("{3}",'<span class="text-danger">'+f("customCurrency")(n.eventBonusDetails[i].AuditAmount)+"<\/span>");n.selectedEventId=n.eventBonusDetails[0].BonusId}function h(){var n=parseInt(t.activity.selectedEventId);c||(n||n===0)&&!t.isApplying&&t.activity.isCanJoin&&(t.isApplying=!0,i.post("/TimeLimitedEvent/Apply",{bonusId:n}).then(function(n){var i=n.data;if(t.isApplying=!1,i.IsSuccess===!1){e.alertError(i.ErrorMessage).then(function(){u.dismiss()});return}e.alert(t.langs.ApplySuccess||"申请成功").then(function(){r.location.reload()})}))}function l(){t.isApplying||u.dismiss()}t.langs=o.get("TimeLimitedEvent");s(n);t.activity=n;t.apply=h;t.dismiss=l}],windowClass:"modal-tle",backdrop:"static",keyboard:!1}).result.then(function(){},function(){})}n.isLoading=!0;n.activities=[];n.showActivityDetail=y;n.langs=o.get("TimeLimitedEvent");n.langs.Processing=o.get("Common.Processing");n.langs.NoEvent=o.get("Common.NoEvent");var c=i.search().discountwallet;a()}]);app.controller("TransactionCtrl",["$scope","$http","$modal","MeidonTimeService",function(n,t,i,r){function h(t){u.count=40;e?(n.selectedBtn=3,u.timeBegin=o(parseInt(e)),e=null):u.timeBegin=o(t);n.records=[];n.complete=!1;n.isProcessing=!1;n.state="";f&&(u.SearchType=f);n.loadMore()}function o(n){var t=r.getCurrentMeidon();return t.subtract(n,"days").format("YYYY/MM/DD")}var u={};n.selectedBtn=0;const s=new URLSearchParams(window.location.search),f=s.get("selectType");let e=s.get("selectBtn");n.openDetailDialog=function(n){i.open({templateUrl:"/Transaction/DetailDialog",controller:"TransactionDetailDialogCtrl",windowClass:"transaction-detail-dialog",resolve:{id:function(){return n}}}).result.then(function(){},function(){})};n.loadMore=function(){n.complete||n.isProcessing||(n.isProcessing=!0,u.skip=n.records.length,t.post("/Transaction/Search",u).then(function(t){var i=t.data;n.isProcessing=null;angular.forEach(i.records,function(t){n.records.push(t)});i.records&&i.records.length<u.count&&(n.complete=!0);n.state="ok"}))};n.changeTimeBegin=function(n,t){u.timeEnd=angular.isUndefined(t)?null:o(t);h(n)};t.post("/Transaction/GetSelectItem").then(function(t){var i=t.data;n.selectItems=i.selectItem;n.select=f?n.selectItems.filter(function(n){return n.SelectValue===f})[0]:n.selectItems[0]});n.searchType=function(t){n.complete=!1;n.records=[];u.SearchType=t.SelectValue;n.loadMore()};h(0)}]);app.controller("TransactionDetailDialogCtrl",["$scope","$http","$window","$modalInstance","id","CustomModalService",function(n,t,i,r,u,f){n.loading=!0;t.post("/Transaction/GetDetail",{id:u}).then(function(t){var i=t.data;if(!i.IsSuccess){f.alertError(i.ErrorMessage).then(function(){r.close()});return}n.tran=i.Transaction;n.loading=null});n.close=function(){r.close()}}]);app.controller("TrialCtrl",["$scope","$http","$window","$location","CustomModalService",function(n,t,i,r,u){function f(){t.post("/Trial/GetMemberTrialSetting").then(function(t){var i=t.data;n.isLoading=!1;n.isAutoVerify=i.IsAutoVerify;n.columnType=i.ColumnType})}function e(n){return/^[0-9]*$/.test(n)}n.isLoading=!0;n.isAutoVerify=!1;n.params={};n.columnType;f();n.apply=function(r){if(!e(r.params.mobile)){u.alert((n.columnType===1?"手机号":"QQ")+"请输入数字").then(function(){$("#mobile").focus()});return}n.params.number=r.params.mobile;n.params.columnType=n.columnType;n.params.checkCodeEncrypt=r.checkCode.encrypt;t.post("/Trial/ApplySubmit",n.params).then(function(t){var r=t.data;if(r.IsSuccess===!1){u.alertError(r.ErrorMessage).then(function(){n.params.checkCode=null;n.checkCode=null;$('input[name="checkCode"]').focus()});return}u.alert("试玩帐号申请成功，请联络在线客服索取").then(function(){i.location.href="/Trial/Login"})})};n.login=function(n){t.post("/Trial/LoginSubmit",n.params).then(function(n){var t=n.data;if(t.IsSuccess===!1){u.alertError(t.ErrorMessage);return}i.location.href="/"})};n.autoLogin=function(r){n.params.checkCodeEncrypt=r.checkCode.encrypt;t.post("/Trial/AutoSubmit",n.params).then(function(t){var r=t.data;if(r.IsSuccess===!1){u.alertError(r.ErrorMessage).then(function(){n.params.checkCode=null;$('input[name="checkCode"]').focus()});return}i.location.href="/"})}}]);app.controller("TrialNewCtrl",["$http","$scope","$window","$modalInstance","labelService","CustomModalService",function(n,t,i,r,u,f){function c(){n.post("/Trial/GetMemberTrialSetting").then(function(n){var i=n.data;t.isLoading=!1;t.isAutoVerify=i.IsAutoVerify;t.applicationInfo=h[i.ColumnType-1];e=i.ColumnType;t.showPage=t.isAutoVerify?"apply":s[i.ViewType-1]})}function l(){r.close()}function o(){t.params={};t.showPage="login"}t.isProcessing=!1;t.params={};t.isLoading=!0;t.isAutoVerify=!1;t.showPage;t.applicationInfo;t.closed=l;t.toLoginPage=o;t.langs=u.get("Trial");t.langs.Loading=u.get("Common.Loading");t.langs.Processing=u.get("Common.Processing");var s=["apply","login"],h=["mobile","qq"],e;c();t.apply=function(i){if(!/^\d*$/.test(i.params.number)){f.alert((t.applicationInfo==="mobile"?t.langs.MobileNumber:t.langs.QQ)+t.langs.Error_Mobile).then(function(){$('.modal-nt [ng-model="params.number"]').focus()});return}t.params.columnType=e;t.params.checkCodeEncrypt=i.checkCode.encrypt;t.isProcessing=!0;n.post("/Trial/ApplySubmit",t.params).then(function(n){var i=n.data;if(i.IsSuccess===!1){f.alertError(i.ErrorMessage).then(function(){t.isProcessing=!1;t.params.checkCode=null;t.checkCode=null;$('.modal-nt input[name="checkCode"]').focus()});return}f.alert(t.langs.ApplySuccessfully+'<br/><a href="javascript:void(0)" line-chat-click="Live800LinkReview"><i class="fas fa-headphones"><\/i> '+u.get("Register.ContactCustomerService")||"联系客服<\/a>").then(function(){t.isProcessing=!1;o()})})};t.login=function(){t.isProcessing=!0;n.post("/Trial/TrialLoginSubmit",t.params).then(function(n){var r=n.data;if(r.IsSuccess===!1){f.alertError(r.ErrorMessage).then(function(){t.isProcessing=!1});return}t.isProcessing=!1;i.location.href="/"})};t.autoLogin=function(r){t.params.checkCodeEncrypt=r.checkCode.encrypt;t.isProcessing=!0;n.post("/Trial/AutoSubmit",t.params).then(function(n){var r=n.data;if(r.IsSuccess===!1){f.alertError(r.ErrorMessage).then(function(){t.isProcessing=!1;t.params.checkCode=null;$('input[name="checkCode"]').focus()});return}t.isProcessing=!1;i.location.href="/"})}}]);app.controller("VaptchaCheckCtrl",["$q","$http","$window","$timeout","labelService","CustomModalService","SiteSettingService",function(n,t,i,r,u,f,e){var o;n.all([e.getSiteTitleSingleton(),t.post("/Account/GetGameSupplierLoginCaptchaVerifyType")]).then(function(n){document.title=n[0].PortalSiteName;var t=n[1].data;o=r(function(){$("#vaptcha").length===0&&location.reload()},1e4);vaptcha({vid:t.Vid,type:"invisible",scene:t.Scene,offline_server:"/offline"}).then(function(n){var e=function(){f.confirm(u.get("Common.VaptchaCheck")).then(function(t){if(!t){i.close();i.parent.postMessage("closeWindow","*");return}r(function(){n.validate()},400)})};r.cancel(o);r(function(){n.validate();r(function(){angular.element(document.getElementsByClassName("vp-s-fail")).length>0&&angular.element(document.getElementsByClassName("vp-close")).bind("click",function(){e();angular.element(document.getElementsByClassName("vp-close")).unbind("click")})},1e3)},400);n.listen("pass",function(){var u=n.getToken(),f=i.top.location.pathname==="/Lobby/Navigation",r=(redirectTo?decodeURIComponent(redirectTo):location.pathname+location.search)+"&VaptchaToken="+u+"&VaptchaScene="+t.Scene;if(f){localStorage.setItem("LobbyNavAction",r);return}location.href=r});n.listen("close",function(){e()})})})}]);app.controller("WelcomeOfferCtrl",["$http","$scope","$modal","$location","$window","labelService","languageService","MeidonTimeService","WelcomeOfferService","LoginRedirectService","SiteSettingService","CustomModalService",function(n,t,i,r,u,f,e,o,s,h,c,l){function b(){if(w){d();return}if(!_IsLogin){h.goLogin();return}s.getSwitchSingleton().then(function(n){if(t.isEnable=n,!n){t.isLoading=!1;return}k()})}function k(){n.post("/WelcomeOffer/GetActivity").then(function(n){let t=n.data.ReturnObject||null;v(t)})}function d(){function n(i){var r=i.data.ReturnObject;v(r);t.isEnable=!0;u.removeEventListener("message",n,!1)}u.addEventListener("message",n,!1);u.opener.postMessage("message",r.search().welcomeOffer)}function v(n){if(n){it();t.eventName=n.Name;t.beginTime=resetDateTimeByTimezone(n.BeginTime,"YYYY/MM/DD 00:00:00");t.endTime=resetDateTimeByTimezone(n.EndTime,"YYYY/MM/DD 23:59:59");t.registerBeginTime=resetDateTimeByTimezone(n.RegisterBeginTime,"YYYY/MM/DD");t.registerEndTime=resetDateTimeByTimezone(n.RegisterEndTime,"YYYY/MM/DD");t.allSettings=n.Settings;t.allMemberRecords=n.MemberRecords;t.tabs=n.Settings.map(function(n){return n.SettingId});t.nowSettingId=g(n);let i=n.Settings.filter(function(n){return n.SettingId===t.nowSettingId})[0];t.mission=p(i);let r=t.mission.conditions.map(function(n){return n.bonus});t.maxBonus=r.reduce(function(n,t){return n>t?n:t});t.memberRecords=y(t.nowSettingId);a();t.isLoading=!1}}function g(n){if(!n.MemberRecords)return t.tabs[0];let r=n.MemberRecords.filter(function(n){return n.Status!==1}).map(function(n){return n.SettingId}),i=n.Settings.filter(function(n){return!~r.indexOf(n.SettingId)&&!n.IsCalculating});return i.length?i[0].SettingId:t.tabs[0]}function a(){if(t.memberRecords&&t.memberRecords.status===1){var n=o.getCurrentMeidon();let i=moment(t.memberRecords.receiveDeadline).diff(moment(n),"minutes");t.memberRecords.lastHours=Math.floor(i/60);t.memberRecords.lastMinutes=i%60;t.interval||nt()}}function nt(){t.interval=setInterval(function(){a()},6e4)}function y(n){if(!t.allMemberRecords)return null;let i=t.allMemberRecords.filter(function(t){return t.SettingId===n});return i.length?{settingId:i[0].SettingId,recordDetailId:i[0].RecordDetailId,status:i[0].Status,rewardMoney:i[0].RewardMoney,receiveDeadline:i[0].ReceiveDeadline}:null}function p(n){return{auditTimes:n.AuditTimes,conditions:n.Conditions.map(function(n){return tt(n)}),depositAmountSum:n.DepositAmountSum,depositTime:n.DepositTime,registerDay:n.RegisterDay,settingId:n.SettingId,gameCategories:n.GameCategories,isCalculating:n.IsCalculating}}function tt(n){return{conditionId:n.ConditionId,commissionable:n.Commissionable,bonus:n.Bonus}}function it(){c.getSiteTitleSingleton().then(function(n){document.title=n.PortalSiteName+" - "+t.langs.WelcomeOffer})}function rt(n){i.open({templateUrl:"activityCategoryModal",controller:["$scope","$modalInstance","labelService",function(t,i,r){t.langs=r.get("WelcomeOffer");t.categoryShow=n;t.dismiss=function(){i.dismiss()}}],windowClass:"modal-tle"}).result.then(function(){},function(){})}var w=r.search().welcomeOffer;t.langVersion=e.currentLanguage;t.langs=f.get("WelcomeOffer")||{};t.langs.Loading=f.get("Common.Loading");t.langs.NoEvent=f.get("Common.NoEvent");t.isLoading=!0;t.isEnable=!1;b();t.changeTab=function(n){clearInterval(t.interval);t.interval=null;t.nowSettingId=n;let i=t.allSettings.filter(function(t){return t.SettingId===n})[0];t.mission=p(i);let r=t.mission.conditions.map(function(n){return n.bonus});t.maxBonus=r.reduce(function(n,t){return n>t?n:t});t.memberRecords=y(t.nowSettingId);a()};t.receive=function(){n.post("/WelcomeOffer/Receive",{RecordDetailId:t.memberRecords.recordDetailId}).then(function(n){if(n.data.IsSuccess===!1){l.alertError(n.data.ErrorMessage);return}t.memberRecords.status=2;t.allMemberRecords.filter(function(n){return n.SettingId===t.memberRecords.settingId})[0].Status=2})};t.openCategory=function(){let n=[];for(let i=1;i<=6;i++){let r={},u=f.get("Category");r.groupName=u[i];r.categoryString=t.mission.gameCategories.filter(function(n){return n.GameKind===i}).map(function(n){return n.GameCategoryType}).join(", ");r.categoryString!==""&&n.push(r)}rt(n)}}]);app.controller("WelcomeOfferDialogCtrl",["$scope","$modalInstance","labelService","WelcomeOfferService","ActivityEntranceService",function(n,t,i,r,u){n.langs=i.get("WelcomeOffer");n.noShowAgain=r.checkNeverPopupCookieExist();n.openModal=function(){u.openModal({link:"/ActivityManagement/#/Activity/WelcomeOffer",name:"WelcomeOffer"})};n.close=function(){n.noShowAgain?r.recordNeverPopupTimes():r.uncheckNeverPopup();t.dismiss()};n.changeClick=function(){n.noShowAgain=!n.noShowAgain}}]);app.controller("WithdrawApplicationAdministrationFeeDialogCtrl",["$scope","$modalInstance","auditRecords",function(n,t,i){n.showView="loadData";n.records=i;n.records.length==0?n.showView="noData":(n.showView="getData",n.total=0,angular.forEach(i,function(t){t&&t.IsAudit===!1&&t.Amount&&(n.total+=t.Amount)}));n.close=t.close}]);app.controller("WithdrawApplicationApplyWithdrawMethodDialogCtrl",["$scope","$http","$window","$modalInstance","CustomModalService",function(n,t,i,r,u){n.applyParams={};n.submit=function(n){t.post("/WithdrawApplication/CreateAlipayAccount",n).then(function(n){if(n.data.IsSuccess===!1){u.alertError(n.data.ErrorMessage);return}u.alert("新增成功").then(function(){i.location.reload()})})};n.close=function(){r.close(!1)}}]);app.controller("WithdrawApplicationMmPayDiscountSettingDialogCtrl",["$scope","$http","$modalInstance","labelService","withdrawType",function(n,t,i,r,u){n.langs=r.get("Withdraw");var f=u;f===4&&(f=3);t.post("/WithdrawApplication/GetMmPayAllDiscountSetting",{type:f}).then(function(t){var i=t.data;if(i.IsSuccess===!1){CustomModalService.alertError(i.ErrorMessage);return}n.settings=i.ReturnObject.DiscountSettings||[];n.auditTimes=i.ReturnObject.AuditTimes;n.monthlyLimit=i.ReturnObject.MonthlyLimit});n.dismiss=i.dismiss}]);app.controller("YuebaoCtrl",["$scope","$http","$q","languageService","FunctionSwitchService","SiteSettingService",function(n,t,i,r,u,f){function e(){var n=$(".body.container #title"),t=document.createElement("style");t.type="text/css";t.innerHTML=".custom-yuebao-color { color: "+n.css("color")+" }.custom-yuebao-bg { background-color: "+n.css("background-color")+"}.custom-yuebao-border-color { border-color:"+n.css("background-color")+"}.custom-yuebao-color-r { color: "+n.css("background-color")+" }";document.body.appendChild(t)}function o(){f.getSiteTitleSingleton().then(function(t){var i=t.PortalSiteName;document.title=i+" - "+n.langs.Yuebao_YuebaoArea})}n.isLoading=!0;n.isEnable=!1;n.langs;n.yuebaoPage="detail";e();i.all([u.getEnableFunctionSwitch(),r.getMultilingual(["Common","Yuebao","Shared"])]).then(function(t){n.isEnable=t[0].YuebaoSwitch;n.langs=t[1].data;o();n.isLoading=!1})}]);app.controller("YuebaoDetailCtrl",["$scope","$http","$q","$modal","labelService","CustomModalService",function(n,t,i,r,u,f){function v(){n.detailPage="processing";e()}function o(t){n.processingTransfer={};h(!1,t).then(function(t){(n.isDetailLoading=!1,t)&&(n.processingTransfer=t)})}function s(t){n.doneTransfer={};h(!0,t).then(function(t){t&&(n.doneTransfer=t)})}function h(r,u){return t.post("/Yuebao/Transfer",{IsWithdraw:r,PageIndex:u,PageSize:a}).then(function(t){var r=t.data;return r.IsSuccess===!1?(n.errorMessage=r.ErrorMessage,n.isDetailEnable=!1,i.when(null)):r.ReturnObject})}function e(){n.processingTransferSummery={};o(0);c(!1).then(function(t){t&&(n.processingTransferSummery=t)})}function y(){n.doneTransferSummery={};s(0);c(!0).then(function(t){t&&(n.doneTransferSummery=t)})}function c(n){return t.post("/Yuebao/TransferSummary",{IsWithdraw:n}).then(function(n){var t=n.data;return t.IsSuccess===!1?i.when(null):t.ReturnObject})}function l(i){t.post("/Yuebao/Withdraw",{Id:i.Id,OuterId:i.OuterId}).then(function(t){var r=t.data;if(i.isWithdrawing=!1,r.IsSuccess===!1){f.alertError(r.ErrorMessage);return}f.alert(u.get("Yuebao.WithdrawSuccess")||"赎回成功").then(function(){e();n.switchStatus("done")})})}var a=10;n.isDetailLoading=!0;n.isDetailEnable=!0;n.errorMessage="";v();n.switchStatus=function(t){var r=[{status:"processing",callback:e},{status:"done",callback:y}],i;for(n.detailPage=t,i=0;i<r.length;i++)r[i].status===t&&r[i].callback()};n.showHistoryDialog=function(t){r.open({templateUrl:"interestHistoryModal",resolve:{item:function(){return t},langs:function(){return n.$parent.$parent.langs}},controller:["$scope","$modalInstance","item","langs","labelService",function(n,t,i,r,u){n.item=i;n.langs=r;n.interestAuditMultipleTip=i.InterestAuditMultiple?(u.get("Yuebao.InterestAuditMultipleTip")||"利息稽核倍数为 {0} 倍").replace("{0}",'<span class="text-danger">'+i.InterestAuditMultiple+"<\/span>"):u.get("Yuebao.NoInterestAuditMultiple")||"无利息稽核倍数";n.close=function(){t.close()}}],windowClass:"yuebao-modal"}).result.then(function(){},function(){})};n.withdrawCheck=function(n){if(!n.isWithdrawing&&!(n.Interest>n.LimitInterest)){if(n.isWithdrawing=!0,n.Interest===n.LimitInterest||!n.NextInterestTime){l(n);return}f.confirm(u.get("Yuebao.WithdrawConfirm")||"利息尚未结算，确定要领回吗?").then(function(t){if(!t){n.isWithdrawing=!1;return}l(n)})}};n.getProcessingTransfer=o;n.getDoneTransfer=s}]);app.controller("YuebaoPlanCtrl",["$scope","$http","$filter","labelService","CustomModalService",function(n,t,i,r,u){function e(t){for(var i,r=0;r<t.length;r++)i=t[r],i.IsOrderCountFull=i.LimitUserOrderCount===-1?!1:i.UserOrderCount>=i.LimitUserOrderCount,n.plans.push(i)}function f(n){return'<span class="text-danger">'+i("customCurrency")(n.amount*(n.Rate/100))+"<\/span>"}n.isPlanLoading=!0;n.isPlanEnable=!0;n.errorMessage="";n.plans=[];t.post("/Yuebao/GetUserYuebaoList",null).then(function(t){var i=t.data;if(i.IsSuccess===!1){n.errorMessage=i.ErrorMessage;n.isPlanEnable=!1;n.isPlanLoading=!1;return}e(t.data.result);n.passAudit=t.data.PassAudit;n.isPlanLoading=!1});n.purchase=function(i){i.isPurchasing||i.IsOrderCountFull||!i.amount||i.amount>i.MaxAmount||i.amount<i.MinAmount||i.amount%10!=0||(i.isPurchasing=!0,t.post("/Yuebao/Deposit",{Id:i.Id,Amount:i.amount}).then(function(t){if(i.isPurchasing=!1,t.data.IsSuccess===!1){u.alertError(t.data.ErrorMessage);return}u.alert(r.get("Yuebao.PurchaseSuccess")||"購買成功！").then(function(){n.$parent.$parent.yuebaoPage="detail"})}))};n.getCycleInterestTip=function(n){var t=r.get("Yuebao.ReCycleSettle")||"每 {0} 小時利息為 {1}";return t.replace("{0}",n.SettleTime).replace("{1}",f(n))};n.getSingleInterestTip=function(n){var t=r.get("Yuebao.CycleSettle")||"{0} 小時後，利息為 {1}";return t.replace("{0}",n.SettleTime).replace("{1}",f(n))}}])