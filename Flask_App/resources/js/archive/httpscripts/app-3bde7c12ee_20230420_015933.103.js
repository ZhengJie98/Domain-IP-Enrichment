"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function _iterableToArrayLimit(e,t){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)){var n=[],i=!0,a=!1,o=void 0;try{for(var s,r=e[Symbol.iterator]();!(i=(s=r.next()).done)&&(n.push(s.value),!t||n.length!==t);i=!0);}catch(e){a=!0,o=e}finally{try{i||null==r.return||r.return()}finally{if(a)throw o}}return n}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}angular.module("keenetic",["ui.router","pascalprecht.translate","luegg.directives","ngInputModified","ngSanitize","ngCookies","mgo-angular-wizard","debounce","ngSha","angular-md5","angular-lodash-filter","ngDraggable","virtualRepeat"]),function(){function e(e,t,n,i,a,o,s,r,l,c,d){var p=this,u=c.SIM_CARD_STATE,m=c.PIN_LOCK_SIM_CARD_STATES;p.isReady=!1,p.interfaceId="",p.SIM_CARD_STATE=u,p.simState=u.UNKNOWN,p.pinAttemptsLeft=0,p.isSetPinBtnLocked=!0,// Custom validator function (if it returns nothing -- value is OK)
p.pinValidator=function(e){if(e&&!/^\d{4}$/.test(e))return"errors.invalid-pin"},p.isPinRequired=function(){return e.includes(m,p.simState)&&p.pinAttemptsLeft>0};var f=function(){return p.isSetPinBtnLocked=!0,l.setPinCode(p.interfaceId,p.pin)};p.setPinCode=function(){return p.pinAttemptsLeft>1?f():(i.$broadcast(o.STOP_TABS_SYNC),r.requester.stopPolling(),a.confirm("usbqmi.sim-management.last-pin-attempt-confirm").then(f).finally(function(){r.requester.startPolling(),i.$broadcast(o.START_TABS_SYNC)}))},d.subscribeOnStateChanged(n,function(e){var t=e.simState,n=e.interfaceId,i=e.pinAttemptsLeft;p.pinAttemptsLeft!==i&&(p.isSetPinBtnLocked=!1),p.interfaceId=n,p.simState=t,p.pinAttemptsLeft=i,p.isReady=!0}),r.requester.registerDynamicCallback(function(){return r.getStateQueries(p.interfaceId)},function(e){if(0!==e.length){var t=r.destructureStateResponses(e).showInterfaceData,n=l.processSimState(t),i=n.pinAttemptsLeft,a=n.simState;d.setState({simState:a,pinAttemptsLeft:i}),p.isReady=!0}})}e.$inject=["_","$q","$scope","$rootScope","modal","modems","interfaces","usbQmi","usbQmiSim","usbQmiConstants","usbQmiSharedState"],angular.module("keenetic").controller("UsbQmiSimManagementController",e)}(),function(){function e(e,t,n){var i=n.SIM_CARD_STATE;return{setPinCode:function(n,i){var a=["interface",n,"sim"],o=e.set({},a,{pin:i});return t.postToRciRoot(o)},processSimState:function(t){return"no"===e.get(t,"plugged")?{simState:i.NOT_INSERTED,pinAttemptsLeft:0}:{simState:e.get(t,"sim",i.UNKNOWN),pinAttemptsLeft:e.get(t,"pin-attempts",0)}}}}e.$inject=["_","router","usbQmiConstants"],angular.module("keenetic").factory("usbQmiSim",e)}(),function(){function e(e,t,n){var i={interfaceId:n.INTERNAL_LTE_ID,pinAttemptsLeft:0,simState:n.SIM_CARD_STATE.UNKNOWN,operators:null,scanStatus:n.SCAN_STATUS.DISABLED};return{getByKey:function(t,n){return e.get(i,t,n)},setState:function(n){i=Object.assign({},i,{},e.cloneDeep(n)),t.$broadcast("USBQMI_SHARED_STATE_UPDATED")},getState:function(){return i},subscribeOnStateChanged:function(e,n){var a=t.$on("USBQMI_SHARED_STATE_UPDATED",function(){return n(i)});e.$on("$destroy",a)}}}e.$inject=["_","$rootScope","usbQmiConstants"],angular.module("keenetic").factory("usbQmiSharedState",e)}(),function(){function e(e,t,n,i,a,o,s,r,l,c,d,p,u,m,f,g,v){var h={no:!0},b="interface",_=["mobile","operator"],y=["usb","apn"],S=["mobile","roaming"],w=["mobile","pdp"],C=["usb","acq"],E=["mobile","umts","disable-band"],I=["mobile","lte","disable-band"],T=g.PINGCHECK_INSTALLED,k=g.CELLULAR_STANDARD,P=g.NDM_CONNECTION_STATE,A=g.CONNECTION_STATE_L10N_SUFFIX,D=g.SIM_CARD_STATE,O=g.ERROR_SIM_CARD_STATES,N=g.INTERFACE_ID,L=g.IPV6_INSTALLED,x=g.SHOW_IP_NAME_SERVER,R=g.SHOW_INTERFACE_STAT,M=g.SHOW_IPV6_ADDRESSES,$=g.SHOW_IPV6_ROUTES,F=g.SHOW_IPV6_PREFIXES,V=g.SHOW_INTERFACE_OPERATORS,U=c.constants,B=U.ISP_STATE,W=U.STATE_CATEGORY,H=r.UNIT,q={rssi:H.DBM,rsrq:H.DB,rsrp:H.DBM,ecio:H.DB,phase:H.DEG},j=v.createRequester(),K=v.createRequester(),G=c.getIpGlobalQuery,Y=c.getInterfaceDescriptionQuery,z=c.getInterfaceUpQuery,Q=c.getInterfaceScheduleQuery,X=function(e,t,i){return n.set({},[b,e].concat(_toConsumableArray(t)),i)},Z=function(e){return{options:e,enabledBands:e.filter(function(e){return e.enabled}).map(function(e){return e.band})}},J=function(e){var t=n.get(e,"umts",[]),i=n.get(e,"lte",[]),a=_slicedToArray(n.partition(i,function(e){return g.isLteTddBand(e.band)}),2),o=a[0],s=a[1],r=Z(t),l=Z(o),c=Z(s);return{model:{umtsFddBands:r.enabledBands,lteFddBands:c.enabledBands,lteTddBands:l.enabledBands},bandOptions:{umtsFddBands:r.options,lteFddBands:c.options,lteTddBands:l.options}}},ee=function(e,t,a){var o=e.showInterface,s=e.showRcInterface,r=e.showRcPingcheck,l=e.showInterfaceBands,p=n.find(o,function(e){return e.id===t}),u=t,m=Object.assign({},s[u],{name:u}),g=n.get(r,"profile",{}),v=function(e){var t=n.get(e,"ip.global.order",-1),a=n.has(e,"up"),o=n.get(e,"schedule","");return{order:t,isUp:a,schedule:o,savedSchedule:o,description:i.getInterfaceL10n(e)}}(m),h=function(e){return{identity:n.get(e,"authentication.identity",""),password:n.get(e,"authentication.password",""),type:c.getAuthenticationType(e)}}(m),b=d.getFormDataFromRawData(m,g),_=n.get(m,"usb.apn.apn",""),y=n.get(m,"mobile.operator.plmn",""),E=""!==y,I=n.get(m,S,!1),T=n.get(m,C,k.AUTO),P="ipv4v6"===n.get(m,w),A=J(l),D=f.processSimState(p),O=D.simState,N=D.pinAttemptsLeft;return{model:Object.assign({id:u,pingcheck:b,authentication:h,apn:_,plmn:y,isPlmnSet:E,roamingIsEnabled:I,ipv6IsEnabled:P,cellularStandard:T,general:v},a?A.model:{}),simState:O,pinAttemptsLeft:N,isPlugged:"yes"===n.get(p,"plugged","no"),bandOptions:A.bandOptions}},te=function(e){return n.set({},"show.interface.bands",{name:e})},ne=function(e,t,n,i){return 0===e.length?[]:1===e.length?[{l10n:n,value:e[0][t]}]:[{l10n:i,value:e.map(function(e){return e[t]}),isArray:!0}]},ie=function(e,t){return e?String(i.round(e/1e3,1)).replace(".0",""):t},ae=function(e,t,i){var a=e.general,o=e.id,s=n.get(a,"description",o),l=n.get(a,"schedule",h),p=n.get(a,"order",-1),u=n.get(a,"isUp"),m=T?d.getSavingQueries(e.pingcheck,o,!0,t):[];return[G(o,p),z(o,u),Q(o,l),Y(o,s),function(e){var t=e.authentication,n=t.type===r.PPP_AUTH_ALGORITHM.AUTO,i=t.identity&&!n?t.identity:h,a=t.password&&!n?t.password:h,o=Object.assign({identity:i,password:a},c.getAuthenticationTypeQuery(t.type));return X(e.id,[],{authentication:o})}(e),function(e){var t=e.apn?{apn:e.apn}:h;return X(e.id,y,t)}(e),function(e){return X(e.id,S,e.roamingIsEnabled)}(e),function(e){var t=e.cellularStandard===k.AUTO?h:e.cellularStandard;return X(e.id,C,t)}(e),function(e){if(!L)return{};var t=e.ipv6IsEnabled?"ipv4v6":"ipv4";return X(e.id,w,t)}(e),function(e){var t=e.isPlmnSet?{plmn:e.plmn}:h;return X(e.id,_,t)}(e),function(e,t){var i=n.get(e,"umtsFddBands",[]),a=t.umtsFddBands.map(function(e){return i.includes(e.id)?{band:e.id,no:!0}:{band:e.id}});return X(e.id,E,a)}(e,i),function(e,t){var i=[].concat(_toConsumableArray(n.get(e,"lteFddBands",[])),_toConsumableArray(n.get(e,"lteTddBands",[]))),a=[].concat(_toConsumableArray(n.get(t,"lteFddBands",[])),_toConsumableArray(n.get(t,"lteTddBands",[]))).map(function(e){return i.includes(e.id)?{band:e.id,no:!0}:{band:e.id}});return X(e.id,I,a)}(e,i)].concat(_toConsumableArray(m))},oe=function(e){return n.set({},V,{name:e})},se=function(e,t,a){if(c.isScheduleOff(t))return c.getInterfaceStatusObject(B.DOWN_ON_SCHEDULE,W.INFO,e);if("no"===e.plugged){var o=e.id===N?"usbqmi.connection-state.unplugged":"connection-status.unplugged";return c.getInterfaceStatusObject(B.UNPLUGGED,W.INFO,e,i.getTranslation(o))}if(O.includes(e.sim)){var s,r=(s={},_defineProperty(s,D.PIN_BLOCK,"pin-block"),_defineProperty(s,D.INVALID,"sim-invalid"),_defineProperty(s,D.NOT_INSERTED,"no-sim-card"),_defineProperty(s,D.PIN_CODE_REQUIRED,"pin-code-required"),s)[e.sim],l=i.getTranslation("usbqmi.connection-state.".concat(r));return c.getInterfaceStatusObject(B.NOT_CONFIGURED,W.ERROR,e,l)}var d=function(e){var t=n.get(e,"connection-state",P.UNKNOWN);if(t===P.UNKNOWN)return"—";var a=n.get(A,t);return i.getTranslation("usbqmi.connection-state.".concat(a))}(e),p=n.get(e,"connection-state",P.UNKNOWN),u=p===P.CONNECTED,m=c.isInternetAvailable(a),f=u?W.OK:W.INFO;return u&&!m?c.getInterfaceStatusObject(B.NO_INTERNET_ACCESS,W.INFO,e,c.getConnectionStateL10n(B.NO_INTERNET_ACCESS)):c.getInterfaceStatusObject(p,f,e,d)};return{IPV6_INSTALLED:L,requester:j,scanRequester:K,getConfiguration:function(e,t){return s.cached(function(e,t){return[].concat(_toConsumableArray(u.getGeneralModemQueries()),[t?te(e):{}])}(e,t)).then(function(i){var a=n.get(i,"[0]",{}),o=n.get(i,"[1]",{}),s=n.get(i,"[2]",{}),r=n.get(i,"[3]",{});return ee({showInterface:a,showRcInterface:o,showRcPingcheck:s,showInterfaceBands:r},e,t)})},saveConfiguration:function(e,t){return(a=i.toRciQueryList(["show.rc.interface"]),s.postToRciRoot(a).then(function(e){return n.get(e,"[0].".concat("show.rc.interface"),{})})).then(function(n){return ae(e,n,t)}).then(function(e){return s.postAndSave(e)});var a},removeConnection:function(t){var i=t.id,a=n.set({},["interface",i],h);return(T?s.get("interface"):e.when({})).then(function(e){var n=T?d.getSavingQueries(t.pingcheck,i,!0,e):[],o=[].concat(_toConsumableArray(n),[a]);return s.postAndSave(o)})},getScanQuery:oe,getScanResults:function(e){return s.postToRciRoot(oe(e))},getBandsData:function(i){var a=te(i),o=e.defer(),r=0,l=null;return function e(){s.postToRciRoot([a]).then(function(i){t.cancel(l);var a=n.get(i,"[0].".concat("show.interface.bands"),{}),s=J(a);if(3===r)return console.warn("usbQmi.getBandsData: maximum attempts number reached"),o.resolve(s);g.MODEL_BAND_PROPS.every(function(e){return 0===s.bandOptions[e].length})?(r++,l=t(e,500)):o.resolve(s)})}(),o.promise},getStateQueries:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return e?[n.set({},"show.interface",{name:e}),t?n.set({},"show.schedule",{name:t}):{}]:[]},destructureStateResponses:function(e){return{showInterfaceData:n.get(e,"[0].".concat("show.interface"),{}),showSchedule:n.get(e,"[1].".concat("show.schedule"),{})}},getConnectionInfoQueries:function(e){if(!n.has(e,"id"))return[];var t=n.get(e,"savedSchedule",""),a=L&&e.ipv6IsEnabled,o=[n.set({},"show.interface",{name:e.id}),n.set({},R,{name:e.id}),t?n.set({},"show.schedule",{name:t}):{},x,a?M:{},a?$:{},a?F:{},n.set({},"show.interface.antennas",{name:e.id})];return i.toRciQueryList(o)},processConnectionInfoResponses:function(e){var t=n.get(e,"[0].".concat("show.interface"),{}),i=n.get(e,"[1].".concat(R),{}),a=n.get(e,"[2].".concat("show.schedule"),{}),s=n.get(e,"[7].".concat("show.interface.antennas.antenna"),[]),r=n.get(e,"[3].".concat(x,".server"),[]),l=n.chain(r).groupBy("global").value(),c=(l[t.priority]||[]).concat(l[0]||[]),d=t.id,p=t["interface-name"],u=function(e){return e.filter(function(e){return e.interface}).filter(function(e){return[d,p].includes(e.interface)})},m=u(n.get(e,"[4].".concat(M,".address"),[])).filter(function(e){return!e.address.startsWith(o.LINK_LOCAL_PREFIX)}),f=u(n.get(e,"[5].".concat($,".route_"),[]));return{showInterfaceData:t,showInterfaceStatData:i,showScheduleData:a,nameServers:c,ipv6Addresses:m,ipv6Prefixes:u(n.get(e,"[6].".concat(F,".prefix"),[])).filter(function(e){return"0"!==e["preferred-lifetime"]}),ipv6Routes:f,antennasData:s}},getConnectionInfo:function(e){var t,o,s,r,l,c=e.showInterfaceData,d=e.showInterfaceStatData,p=e.showScheduleData,u=e.nameServers,f=e.ipv6Addresses,g=e.ipv6Prefixes,v=e.ipv6Routes,h=e.antennasData,b=se(c,p),_=n.chain(H).map(function(e){return{id:e,value:i.getTranslation(e)}}).reduce(function(e,t){return Object.assign({},e,_defineProperty({},t.id,t.value))},{}).value(),y={units:_},S=m.getSignalLevelValue(c,{l10nData:y,noValueStr:"&mdash;"}),w=m.getCurrentStandard(c),C=m.is4gStandard(w),E=b.color===W.OK,I={uploadFrequency:ie(c["ul-freq"],"&mdash;"),downloadFrequency:ie(c["dl-freq"],"&mdash;"),band:c.band||"&mdash;"},T=i.format.getSpeedUnitString(c["max-dl-throughput"])===i.format.getSpeedUnitString(c["max-ul-throughput"]),k=c["max-dl-throughput"]?i.format.getFormattedMaxSpeedUnit(c["max-dl-throughput"],C,T):"&mdash;",P=c["max-ul-throughput"]?i.format.getFormattedMaxSpeedUnit(c["max-ul-throughput"],C):"&mdash;",A=C?"tracking-area-code-tac":"tracking-area-code-lac",D=C?c.tac:c.lac,O=n.has(c,"address")&&n.has(c,"mask")?"".concat(c.address,"/").concat(a.maskToCidr(c.mask)):"",N=c.distance?(c.distance/1e3).toPrecision(2):0,L="".concat(c.rsrp," ").concat(_[H.DBM]),x="".concat(c.rsrq," ").concat(_[H.DB]),R=[{l10n:"modem-model",value:c.product},{l10n:"modem-firmware-version",value:c.fw},{l10n:"connection-status",value:b.text},{l10n:"network-type",value:m.getCurrentStandard(c)},{l10n:"operator",value:E?c.operator:""},{l10n:"phone-number",value:E?c["phone-number"]:""},{l10n:"imei",value:c.imei},{l10n:"imsi",value:E?c.imsi:""},{l10n:"max-speed",value:E?"".concat(k," / ").concat(P):""},{l10n:"frequency",value:E?i.getTranslation("usbqmi.connection-info.frequency-value",null,I):""},{l10n:"channel-width",value:C&&E?"".concat(c.bandwidth," ").concat(_[H.MHZ]):""},{l10n:S.l10nKey,value:E?S.value:""},{l10n:"rsrp",value:C&&E?L:""},{l10n:"rsrq",value:C&&E?x:""}],M=E&&!n.isEmpty(h)?function(e,t){return n.map(e,function(e){return n.chain(e).omit(["channel"]).mapValues(function(e,i){var a=n.get(t,q[i],"");return"".concat(e," ").concat(a)}).value()})}(h,_):[],$=[{l10n:A,value:E?D:""},{l10n:"cell-id",value:E?c.bssid:""},{l10n:"physical-cell-id",value:E?c["phy-cell-id"]:""},{l10n:"cell-distance",value:C&&E?"~".concat(N," ").concat(_[H.KM]):""},{l10n:"uptime",value:E&&n.has(c,"uptime")?i.getSplittedTime(c.uptime):""},{l10n:"ip-address",value:E?O:""},{l10n:"gateway",value:c.gateway}];return(t=$).push.apply(t,_toConsumableArray(ne(f,"address","ipv6-address","ipv6-addresses"))),(o=$).push.apply(o,_toConsumableArray(ne(g,"prefix","ipv6-prefix","ipv6-prefixes"))),(s=$).push.apply(s,_toConsumableArray(ne(v,"gateway","ipv6-route","ipv6-routes"))),$.push({l10n:"mac-address",value:c.mac}),(r=$).push.apply(r,_toConsumableArray(function(e,t){return[{l10n:"rx-speed",value:t?i.format.speed(Number(e.rxspeed)):""},{l10n:"tx-speed",value:t?i.format.speed(Number(e.txspeed)):""},{l10n:"received",value:i.format.size(Number(e.rxbytes))},{l10n:"transmitted",value:i.format.size(Number(e.txbytes))}]}(d,E))),(l=$).push.apply(l,_toConsumableArray(ne(u,"address","dns-server","dns-servers"))),{propsTop:R=R.filter(function(e){return e.value}),antennasList:M,propsBottom:$=$.filter(function(e){return e.value})}},toggleScan:function(e,t){var i=t?{}:h,a=n.set({},"interface.".concat(e,".mobile.scan"),i);return s.postToRciRoot(a)},getConnectionStateObject:se}}e.$inject=["$q","$timeout","_","utils","ipV4Service","ipV6Service","router","CONSTANT","schedules","interfaces","pingcheckModel","components","modems","modemsCommon","usbQmiSim","usbQmiConstants","requesterFactory"],angular.module("keenetic").factory("usbQmi",e)}(),function(){function e(e,t,n,i){var a,o=t.PPP_AUTH_ALGORITHM,s=n.INTERNAL_LTE_ID,r=e.has(i,"ip6"),l=e.has(i,"pingcheck"),c={AUTO:"auto",UMTS:"umts",LTE:"lte"},d={READY:"READY",NOT_INSERTED:"NOT_INSERTED",INVALID:"INVALID",PIN_CODE_CHECKING:"PIN_CODE_CHECKING",PIN_CODE_REQUIRED:"PIN_CODE_REQUIRED",PIN_BLOCK:"PIN_BLOCK",PIN_WRONG:"PIN_WRONG",UNKNOWN:""},p=[d.PIN_BLOCK,d.INVALID,d.NOT_INSERTED,d.PIN_CODE_REQUIRED],u={CONNECTED:"Connected",CONNECTING:"Connecting",REQUESTING:"Requesting",WAITING_FOR_NETWORK:"Waiting for network",SCANNING:"Scanning",INITIALIZING:"Initializing",DISCONNECTED:"Disconnected",UNKNOWN:""},m=(_defineProperty(a={},u.CONNECTED,"connected"),_defineProperty(a,u.CONNECTING,"connecting"),_defineProperty(a,u.REQUESTING,"requesting"),_defineProperty(a,u.WAITING_FOR_NETWORK,"waiting-for-network"),_defineProperty(a,u.SCANNING,"scanning"),_defineProperty(a,u.INITIALIZING,"initializing"),_defineProperty(a,u.DISCONNECTED,"disconnected"),_defineProperty(a,u.UNKNOWN,"unknown"),a);return{USB_QMI_INTERFACE_TYPE:"UsbQmi",INTERFACE_ID:s,PINGCHECK_INSTALLED:l,IPV6_INSTALLED:r,CELLULAR_STANDARD:c,SIM_CARD_STATE:d,ERROR_SIM_CARD_STATES:p,PIN_LOCK_SIM_CARD_STATES:[d.PIN_CODE_REQUIRED,d.PIN_CODE_CHECKING,d.PIN_WRONG,d.PIN_BLOCK],NDM_CONNECTION_STATE:u,CONNECTION_STATE_L10N_SUFFIX:m,SHOW_IP_NAME_SERVER:"show.ip.name-server",SHOW_INTERFACE_STAT:"show.interface.stat",SHOW_IPV6_ADDRESSES:"show.ipv6.addresses",SHOW_IPV6_ROUTES:"show.ipv6.routes",SHOW_IPV6_PREFIXES:"show.ipv6.prefixes",SHOW_INTERFACE_OPERATORS:"show.interface.operators",MODEL_BAND_PROPS:["umtsFddBands","lteTddBands","lteFddBands"],SCAN_STATUS:{COMPLETE:"complete",FAILED:"failed",PROGRESS:"progress",INACTIVE:"inactive",DISABLED:"disabled",ABORTED:"aborted"},SHOW_INTERFACE_OPERATORS_SCANNING:"show.interface.operators.scanning",SHOW_INTERFACE_OPERATORS_OPERATOR:"show.interface.operators.operator",SHOW_INTERFACE_OPERATORS_AGE:"show.interface.operators.age",getCellularStandardOptions:function(){return[c.AUTO,c.UMTS,c.LTE].map(function(e){return{id:e,label:"usbqmi.additional-settings.preferred-cellular-standard-option.".concat(e)}})},getAuthenticationTypeOptions:function(){var e="usbqmi.additional-settings.authentication-type-option";return[{id:o.AUTO,label:"".concat(e,".auto")},{id:o.PAP,label:"".concat(e,".pap")},{id:o.CHAP,label:"".concat(e,".chap")}]},isLteTddBand:function(t){return e.inRange(t,34,54)}}}e.$inject=["_","CONSTANT","NDM","components"],angular.module("keenetic").factory("usbQmiConstants",e)}(),function(){function e(e,t,n,i,a,o,s,r,l){var c=this,d=function(e){return"usbqmi.air-scan.table.scan-status.".concat(e)},p=function(){return e.get(i,"params.interfaceId","")},u=r.SHOW_INTERFACE_OPERATORS_AGE,m=r.SCAN_STATUS,f="usbqmi.air-scan.table.operator-status.available",g="usbqmi.air-scan.table.operator-status.preferred",v="usbqmi.air-scan.table.operator-status.forbidden",h="usbqmi.air-scan.table.mobile-operator",b="usbqmi.air-scan.table.plmn",_="usbqmi.air-scan.table.network-type",y="usbqmi.air-scan.table.status";c.isScanAvailable=!1,c.SCAN_STATUS=m,c.l10n={available:a.getTranslation(f),preferred:a.getTranslation(g),forbidden:a.getTranslation(v)},c.scanStatusString=d(m.DISABLED),c.scanStatus=m.DISABLED,c.isScanButtonDisabled=!1,c.resultsRecievedTime=null,c.list={columns:{operator:{title:h},plmn:{title:b},networkType:{title:_},status:{title:y}},items:null},c.startScan=function(){c.isScanButtonDisabled=!0,c.resultsRecievedTime=null,s.setState({operators:null,scanStatus:m.DISABLED}),o.toggleScan(p(),!0).then(function(){o.scanRequester.startPolling()})},c.stopScan=function(){c.isScanButtonDisabled=!0,o.toggleScan(p(),!1)};c.resultsRecievedTime=null,s.subscribeOnStateChanged(n,function(n){var i=n.scanStatus;if(i&&(c.scanStatus=i,c.scanStatusString=d(i)),c.scanStatus===m.FAILED||c.scanStatus===m.ABORTED||c.scanStatus===m.COMPLETE?(c.isScanAvailable=!0,o.scanRequester.stopPolling()):c.isScanAvailable=!1,c.isScanButtonDisabled=c.scanStatus===m.INACTIVE||c.scanStatus===m.DISABLED,n.operators){var s=p();s&&t.all([l.getKeeneticTime(),o.getScanResults(s)]).then(function(t){var n=_slicedToArray(t,2),i=n[0],o=n[1],s=_slicedToArray(l.getCurrentTime(i).currentTime.split(" "),2),r=s[0],d=s[1],p=e.get(o,u,0),m=1,f=e.reduce(d.split(":").reverse(),function(e,t){var n=t*m;return m*=60,e+n},0);c.resultsRecievedTime||(c.resultsRecievedTime=r+" "+a.getSplittedTime(f-p))}).then(function(){var t;c.list.items=(t=n.operators,e.chain(t).orderBy(["plmn","name","mobile"],["asc","asc","desc"]).map(function(t){var n=e.chain(t.status).map(function(e){return c.l10n[e]}).filter(function(e){return e}).value().join("<br>");return{operator:t.name,plmn:t.plmn,networkType:t.mobile,status:n}}).value())})}})}e.$inject=["_","$q","$scope","$state","utils","usbQmi","usbQmiSharedState","usbQmiConstants","keeneticTime"],angular.module("keenetic").controller("UsbQmiAirScanController",e)}(),function(){function e(e,t){return{getDate:function(){var n=e.defer();return t.get({url:"show/clock/date",cache:!0}).then(function(e){return n.resolve(new Date(e.year,e.month-1,e.day,e.hour,e.min,e.sec))}),n.promise}}}e.$inject=["$q","router"],angular.module("keenetic").factory("timeHolder",e)}(),function(){function e(e,t,n,i){var a=1;return{restrict:"A",link:function(o,s,r){var l=s.find("input"),c=l.parent(),d=l.controller("ngModel"),p=r.ndmInputTimeHolder,u="time_"+a++,m=function(){var n=angular.element("<span class='input-time-holder'>{{"+u+" | date:'"+p+"' }}</span>"),i=e(n)(o);c.append(i),c.addClass("form__cell--input-time-holder"),angular.isDefined(r.ndmInputTimeHolderUpdate)&&function e(){o.clockTimeout=t(function(){o[u].setSeconds(o[u].getSeconds()+1),e()},1e3)}()};i.getDate().then(function(e){o[u]=e,m()}),s.on("click focus",function(){if(l.attr("disabled"))return!1;o[u]=n("date")(o[u],p),d.$setViewValue(o[u]),d.$render(),d.$setPristine(),l[0].focus(),c.addClass("form__cell--input-time-holder_hidden"),t.cancel(o.clockTimeout),s.off("click focus")}),o.$on("$destroy",function(){return t.cancel(o.clockTimeout)})}}}e.$inject=["$compile","$timeout","$filter","timeHolder"],angular.module("keenetic").directive("ndmInputTimeHolder",e)}(),function(){function e(e,t,n,i,a,o,s,r,l,c,d){var p={AUTO:"auto",CLOUD:"cloud",DIRECT:"direct"},u={no:!0},m={NON_SSL_DOMAIN:"NON_SSL_DOMAIN",CERTIFICATE_NOT_RECEIVED:"CERTIFICATE_NOT_RECEIVED",CERTIFICATE_RECEIVED:"CERTIFICATE_RECEIVED"},f=d.createRequester(),g=function(t,n){var i=e.defer(),a=null,s=function(e){a=e};return o.post({url:t,noRetry:!0,data:n}).then(s,s).finally(function(){a.continuedRequestData&&!a.continuedRequestData.continued?i.resolve(a.continuedRequestData):i.resolve(a)}),i.promise},v=function(e,t,n){var i="".concat(e.name,".").concat(e.domain);return i&&i===t["ndns-domain"]&&t["ndns-domain-acme"]?n.some(function(e){return e.domain===i})?m.CERTIFICATE_RECEIVED:m.CERTIFICATE_NOT_RECEIVED:m.NON_SSL_DOMAIN},h=function(e){return{ndns:n.get(e,"[0].".concat("show.ndns"),{}),acme:n.get(e,"[1].".concat("show.acme"),{}),certificates:n.get(e,"[2].".concat("ip.http.ssl.acme.list.certificate"),[])}},b=function(e){return n.set({},"ip.http.proxy",_defineProperty({},e,u))},_=function(e,t){var n={domain:e.domain,name:e.name.toLowerCase()};return t?n["transfer-code"]=function(e){if(!e)return"";for(var t=[],n=0,i=(e=e.replace(/[: ]/g,"")).length;n<i;n++)t.push(Number(e.charCodeAt(n)).toString(16));return t.join("")}(t):n.access=p.DIRECT,g("ndns/book-name",n)},y=function(){return Math.random().toString(32).slice(2,6)},S=function(e){return c.getTranslation("remoteAccess.keendns.notifications.".concat(e))},w={};return{MODE:p,CONTROLLER_NAMES:{PROXY_EDITOR:"ProxyEditor",BOOK_NAME_POPUP:"BookNamePopup"},SSL_CERTIFICATE_STATE:m,PROXY_PROTOCOL:{HTTP:"http",HTTPS:"https"},requester:f,getNotificationL10n:S,getSharedData:function(e){return w[e]},setSharedData:function(e,t){w[e]=t},getPollQueries:function(e){var t=a.sysmode===i.SYSMODE.ROUTER?n.set({},"show.ip.hotspot",{details:i.HOTSPOT_DETAILS.NONE}):n.set({},"show.associations",{});return c.toRciQueryList(["show.rc.known.host","show.rc.ip.http.proxy",t,"show.ndns",e?"ip.http.ssl.acme.list":{},e?"show.acme":{},n.set({},"show.interface",{name:a.LAN})])},processPollData:function(e){var t=n.get(e,"[0].".concat("show.rc.known.host"),{}),o=n.get(e,"[1].".concat("show.rc.ip.http.proxy"),{}),s=a.sysmode===i.SYSMODE.ROUTER?"show.ip.hotspot.host":"show.associations.station",r=n.get(e,"[2].".concat(s),[]),l=n.get(e,"[3].".concat("show.ndns"),{}),c=n.get(e,"[4].".concat("ip.http.ssl.acme.list.certificate"),[]),d=n.get(e,"[5].".concat("show.acme"),{});return l.ssl=v(l,d,c),{knownHost:t,proxyRules:o,hosts:r,ndns:l,showLanInterface:n.get(e,"[6].".concat("show.interface"),{})}},getConfiguration:function t(){return s.cloudcontrol?o.postToRciRoot(c.toRciQueryList(["show.ndns","show.acme","ip.http.ssl.acme.list"])).then(h).then(function(t){var n=t.ndns,i=t.acme,a=t.certificates;return n.ttp&&!n.ttp.interface||!n.updated?g("ndns/get-booked",{}):(n.ssl=v(n,i,a),e.resolve({ndns:n,skipGetBooked:!0}))}).then(function(i){if(i.skipGetBooked)return e.when(i.ndns);
/* rci/ndns/get-booked response
                     * 1. if a KeenDNS name is already registered (booked):
                     *
                     * {
                     *   "done": {
                     *   ...
                     *     "name": "ewerewr",
                     *     "domain": "dns.ndm9.net",
                     *     "address": "0.0.0.0",
                     *     "access": "cloud",
                     *     "access6": "none",
                     *     "updated": "2020-04-01T05:21:51.775Z",
                     *     "transfer": "false"
                     *   },
                     *   "status": [{...}]
                     * }
                     *
                     * ('done' block has every property of the 'rci/show/ndns' response except 'booked: true'
                     *
                     *
                     * 2. if no name was booked:
                     * {
                     *   "failed": {
                     *     "code": "410",
                     *     "title": "NDSS::ndns/updateBooking (Update Name Booking Address and Expiration)",
                     *     "reason": "No booking found for given license!"
                     *   },
                     *   "status": [
                     *     {
                     *       "status": "message",
                     *       "code": "16121900",
                     *       "ident": "Ndns::Client",
                     *       "source": "",
                     *       "warning": "no",
                     *       "message": "get-booked completed."
                     *     }
                     *   ]
                     * }
                     *
                     * 3. if ndm can not connect to the NDSS server:
                     * {
                     *   "status": [
                     *     {
                     *       "status": "error",
                     *       "code": "9240579",
                     *       "ident": "Core::Ndss",
                     *       "source": "",
                     *       "critical": "no",
                     *       "message": "[1295] cannot connect to the server."
                     *     }
                     *   ]
                     * }
                     */var a=n.has(i,"done"),s=a?i.done:i,l=i.ndns;return o.containsAnyNdmErrors(i)?{noNdssAccess:!0}:l&&!l.updated?t():r.getActiveInternetConnection().then(function(e){return s.ttp={address:e.address},Object.assign({},s,{booked:a})})}):e.when({noComponent:!0})},setTransfercode:function(e){return o.get("show/ndns").then(function(t){var n={domain:t.domain,name:t.name.toLowerCase()};return _(n,e)})},modeUpdate:function(e,t){return g("ndns/get-update",{access:e,access6:t})},webAccessUpdate:function(e){var t={public:e,ssl:e,private:!e},i=n.set({},"ip.http.security-level",t);return o.postAndSave(i)},getDefaultDomain:function(){var e=n.set({},"show.acme",{});return o.post(e).then(function(e){return n.get(e,"".concat("show.acme",".default-domain"),"")})},verifyName:function(e){return g("ndns/check-name",{name:e.toLowerCase()})},bookName:_,releaseName:function(e,t){return g("ndns/drop-name",{name:e,domain:t})},getHttpProxyPopupData:function(){var e=c.toRciQueryList(["show.rc.known.host","show.rc.ip.http.proxy"]);return o.postToRciRoot(e).then(function(e){return{knownHost:n.get(e,"[0].".concat("show.rc.known.host"),{}),proxyRules:n.get(e,"[1].".concat("show.rc.ip.http.proxy"),{})}})},saveHttpProxy:function(e,t){var i=t.domain.toLowerCase(),a={"security-level":t.allowAccess?{public:"public"}:{private:"private"},domain:{ndns:!0},upstream:{port:t.port,proto:t.protocol,upstream:t.upstream}},s=[n.set({},"ip.http.proxy",_defineProperty({},i,a)),e&&e!==i?b(e):{}];return o.postAndSave(s)},deleteHttpProxy:function(e){var t=b(e);return o.postAndSave(t)},generateTransfercode:function(){return n.times(4,y).join(":")},notifyOnSuccess:function(n){var i="".concat(S(n));return t(function(){return l.success(i)},100),e.when(!0)},notifyOnError:function(i){var a=o.getNdmResponseErrors(i),s=n.chain(a).values().first().get("message","").value(),r="".concat(S("error")," ").concat(s);return t(function(){return l.warning(r)},100),e.when(!0)}}}e.$inject=["$q","$timeout","_","CONSTANT","NDM","router","components","interfaces","notification","utils","requesterFactory"],angular.module("keenetic").factory("keendnsService",e)}(),function(){function e(e,t,n,i,a,o,s,r){var l=this,c=r.CONTROLLER_NAMES,d=r.PROXY_PROTOCOL,p={port:80,upstream:o.LOCALHOST_IP,protocol:d.HTTP};r.setSharedData(c.PROXY_EDITOR,l),l.isOpened=!1,l.isReady=!1,l.deferred=null,l.name="",l.isExistingRule=!1,l.protocolOptions=[{id:d.HTTP,name:"HTTP"},{id:d.HTTPS,name:"HTTPS"}];var u=function(){l.l10n={description:s.getTranslation("remoteAccess.keendns.proxy.popup.description",null,Object.assign({},s.l10n.getSrefChunks("controlPanel.devicesList",{},"ref"),{myNetworkSectionTitle:s.getTranslation("menu.myNetwork"),devicesListPageTitle:s.getTranslation("menu.connected-devices")}))}};u(),t.$on("$destroy",n.$on("$translateChangeSuccess",function(){return i(u)})),l.open=function(t){return l.name=a.get(t,"domain",""),l.isOpened=!0,l.deferred=e.defer(),r.getHttpProxyPopupData().then(function(e){var t=e.knownHost,n=e.proxyRules;l.model={},l.occupiedDomains=a.chain(n).keys().filter(function(e){return e!==l.name}).value();var i=a.map(t,function(e,t){return{id:e.mac,label:t,name:t}});l.upstreamOptions=[{id:o.LOCALHOST_IP,label:"this-device",name:"this-device"}].concat(_toConsumableArray(i));var s=Object.assign({},p);if(n[l.name]){var r=n[l.name];s.domain=l.name,s.allowAccess=a.has(r,"security-level.public"),s.port=a.get(r,"upstream.port",""),s.protocol=a.get(r,"upstream.proto",d.HTTP),s.upstream=a.get(r,"upstream.upstream",o.LOCALHOST_IP),l.isExistingRule=!0}return l.model=s,l.isReady=!0,l.deferred.promise})},l.close=function(){l.isOpened=!1,l.isReady=!1,l.isExistingRule=!1,l.name="",l.deferred.resolve()},l.save=function(){return r.saveHttpProxy(l.name,l.model).then(l.close)},l.removeProxy=function(){return r.deleteHttpProxy(l.name).then(l.close)}}e.$inject=["$q","$scope","$rootScope","$timeout","_","CONSTANT","utils","keendnsService"],angular.module("keenetic").controller("KeendnsProxyEditorController",e)}(),function(){function e(e,t,n,i,a,o,s,r,l,c,d,p,u,m,f,g,v,h,b){var _=this,y=b.MODE,S=b.CONTROLLER_NAMES,w=b.SSL_CERTIFICATE_STATE,C=b.PROXY_PROTOCOL,E=b.requester;_.SSL_CERTIFICATE_STATE=w,_.isSpecialMode=m.sysmode!==f.SYSMODE.ROUTER,_.isReady=!1,_.model={},_.uiLocked=!1,_.initInProgress=!1,_.defaultDomain=null,_.modesHint=r.getTranslation("remoteAccess.keendns.setup-description"),_.modes=[y.CLOUD,y.DIRECT].map(function(e){return{id:e,value:e,name:"remoteAccess.keendns.modes.".concat(e)}}),_.l10n={};var I=function(){_.l10n={yes:r.getTranslation("yes"),no:r.getTranslation("no"),noUpstreamPortSelected:r.getTranslation("remoteAccess.keendns.proxy.no-upstream-port-selected"),thisKeenetic:r.getTranslation("this-device"),httpAccessDescription:r.getTranslation("remoteAccess.keendns.access-description"),proxyTableDescription:r.getTranslation("remoteAccess.keendns.proxy.description",null,{addBtnLabel:r.getTranslation("remoteAccess.keendns.add")}),noPasswordNoAccess:r.getTranslation("remoteAccess.keendns.no-password-no-access",null,r.l10n.getLinkChunks("sref",{"ui-sref":"controlPanel.administrator",class:"ref-link"})),hint:r.getTranslation("remoteAccess.keendns.hint"),allowAccess:r.getTranslation("remoteAccess.keendns.allow-access-description",null,r.l10n.getLinkChunks("sref",{"ui-sref":"controlPanel.administrator",class:"ref-link"}))}};I(),a.$on("$destroy",o.$on("$translateChangeSuccess",function(){return e(I)})),_.ipv6ModeOptions=[{id:_.modes[0].id,label:r.getTranslation(_.modes[0].name)}];var T=["domain","name","ip","protocol","port","allow"].reduce(function(e,t){return Object.assign({},e,_defineProperty({},t,{title:"remoteAccess.keendns.proxy.table.".concat(t)}))},{});T.port.modify=function(e,t){return t.isInvalid?'<span class="help-text--warning">'.concat(_.l10n.noUpstreamPortSelected,"</span>"):e},T.protocol.modify=function(e){return String(e).toUpperCase()},T.name.modify=function(e){return e?r.escapeHtml(e):"&mdash;"},_.proxyRules={data:[],columns:T,open:function(e){var t=b.getSharedData(S.PROXY_EDITOR);return E.stopPolling(),t.open(e).finally(function(){E.startPolling()})}},_.keendnsName={isValid:!1,revalidate:s.debounce(function(e){_.keendnsName.isValid=e},150,{leading:!0,maxWait:400}),openBookNamePopup:function(){if(_.form.$invalid)return _.uiLocked=!1,!1;var e=b.getSharedData(S.BOOK_NAME_POPUP);return _.uiLocked=!0,e.open(_.model.name).then(function(e){e&&D()}).finally(function(){_.uiLocked=!1})},releaseName:function(){if(!_.uiLocked){_.uiLocked=!0;var t=r.getTranslation("remoteAccess.keendns.delete-confirm");return c.confirm(t).then(function(){return b.releaseName(_.model.name,_.model.domain)}).then(function(t){d.containsAnyNdmErrors(t)?b.notifyOnError(t):(_.model.name="",_.model.booked=!1,r.forceScopeDigest(a),E.stopPolling(),b.notifyOnSuccess("name-deleted"),e(P))}).finally(function(){_.uiLocked=!1})}}},_.getHttpAccessDescriptionForDefaultDomain=function(){return m.DEVICE_IS_MWS_MEMBER?_.adminPasswordIsNotSet?_.l10n.noPasswordNoAccess:"":_.adminPasswordIsNotSet?_.l10n.noPasswordNoAccess:_.l10n.allowAccess},_.getHttpAccessDescription=function(){var e=['<div class="help-text--warning">'.concat(_.l10n.httpAccessDescription,"</div>"),_.l10n.noPasswordNoAccess,"<div>".concat(_.l10n.hint,"</div>")],t=[!_.model.httpAccess,_.adminPasswordIsNotSet,m.DEVICE_IS_MWS_MEMBER];return s.filter(e,function(e,n){return t[n]?e:""}).join("")};var k={},P=function n(){return _.isLoading=!0,t.all([p.getAllUsers(),h.loadWebaccessConfig(),b.getConfiguration()]).then(function(t){var i=_slicedToArray(t,3),a=i[0],o=i[1],r=i[2];_.model=r,_.isReady=!0,_.model.access=_.model.access===y.AUTO?y.DIRECT:_.model.access,_.model.access6=_.model.access6===y.CLOUD?[y.CLOUD]:[],_.adminPasswordIsNotSet=s.some(a,function(e){return h.isUserAdmin(e)&&p.isUserPasswordEmpty(e)}),_.model.httpAccess=!_.adminPasswordIsNotSet&&s.get(o,"http.enabled"),_.model.httpAccessSavedValue=_.model.httpAccess,_.noNdssAccess=r.noNdssAccess,_.noNdssAccess?(k.getConfigAndStartPolling=e(n,1e4),e(function(){_.isLoading=!1},2e3),E.stopPolling()):(_.isPrivateIP=v.isPrivateIP(r.ttp.address),e(_.mode.setWarningText),E.startPolling()),_.keendnsName.isValid=_.model.booked,_.parentCtrl.tabContentsChanged.keendns=_.canChangeTab})};E.registerDynamicCallback(function(){var e=_.model.ssl===w.CERTIFICATE_NOT_RECEIVED;return{query:b.getPollQueries(e),dataForCallback:{querySslCertificates:e}}},function(e,t){var n=b.processPollData(e),i=n.knownHost,a=n.proxyRules,o=n.hosts,r=n.ndns,l=n.showLanInterface;if(!r.ttp||!r.ttp.address)return E.stopPolling(),void(_.noNdssAccess||P());t.querySslCertificates&&(_.model.ssl=r.ssl);_.proxyRules.data=s.chain(a).pickBy("domain.ndns").map(function(e,t){var n=s.get(e,"upstream",{}),a=s.get(n,"upstream");return{domain:t,protocol:s.get(n,"proto",C.HTTP),allow:s.has(e,"security-level.public")?_.l10n.yes:_.l10n.no,name:function(e){return e===f.LOCALHOST_IP?_.l10n.thisKeenetic:s.findKey(i,{mac:e})||""}(a),ip:function(e){var t=e===f.LOCALHOST_IP?l.address:(s.find(o,{mac:e})||{}).ip;return t&&t!==f.ZERO_IP_ADDRESS?t:"&mdash;"}(a),port:n.port,isInvalid:!e.upstream}}).value()});var A=function(){s.forEach(k,function(t){return e.cancel(t)}),E.stopPolling(),E.clearCallbacks(),d.reset()};_.canChangeTab=function(){return(s.get(_,"form.modified")&&s.get(_,"model.booked")?c.confirmLeave():t.when(!0)).then(function(e){return e&&(s.invoke(_,"form.reset"),A()),e})},_.transferCode={code:"",visible:!1,isCopied:!1,description:r.getTranslation("remoteAccess.keendns.transfer.copy"),open:function(){_.transferCode.visible=!0,_.transferCode.code||(_.transferCode.code=b.generateTransfercode(),b.setTransfercode(_.transferCode.code))},copy:function(){_.transferCode.isCopied=!0,r.copyToClipboard(_.transferCode.code),e(function(){_.transferCode.isCopied=!1},2e3)},cancel:function(){_.transferCode.visible=!1,_.transferCode.code="",b.setTransfercode(_.transferCode.code)}},u.isIos&&(_.transferCode.description=""),_.mode={warningText:"",setWarningText:function(){_.mode.warningText=_.isPrivateIP&&_.model.access===y.DIRECT?"remoteAccess.keendns.modes.warnings.gray-ip.title":""},onChange:function(e){e===y.DIRECT&&c.confirm("remoteAccess.keendns.direct-mode-gray-ip-warning").then(function(){return _.mode.setWarningText()},function(){_.model.access=y.CLOUD,_.mode.setWarningText()})}};var D=function(){return _.initInProgress?t.when(!1):(_.initInProgress=!0,_.uiLocked=!0,(_.defaultDomain?t.when(_.defaultDomain):b.getDefaultDomain()).then(function(e){return _.defaultDomain=e,P()}).finally(function(){_.initInProgress=!1,e(function(){s.invoke(_,"form.$setPristine"),_.uiLocked=!1})}))};_.save=function(){_.uiLocked=!0;var e=function(e){return b.notifyOnError(e).then(function(){_.uiLocked=!1})},n=_.model.access6.length>0?y.CLOUD:"";return E.stopPolling(),b.modeUpdate(_.model.access,n).then(function(n){return d.containsAnyNdmErrors(n)?(e(n),t.reject()):(b.notifyOnSuccess("save-success"),_.model.httpAccess===_.model.httpAccessSavedValue?t.when(!0):b.webAccessUpdate(_.model.httpAccess))},e).finally(function(){D()})},_.cancel=function(){if(!_.uiLocked)return s.invoke(_,"form.reset"),P()},a.$on("$destroy",A),a.$watch("::vm.parentCtrl",function(){_.parentCtrl.callOnTabChange.keendns=D,e(function(){"keendns"===_.parentCtrl.activeTab&&D()})})}e.$inject=["$timeout","$q","$document","$parse","$scope","$rootScope","_","utils","notification","modal","router","usersService","browserCheck","NDM","CONSTANT","keyboard","ipV4Service","administrator","keendnsService"],angular.module("keenetic").controller("KeenDNSController",e)}(),function(){function e(e,t,n,i,a,o,s,r){var l=this;r.setSharedData(r.CONTROLLER_NAMES.BOOK_NAME_POPUP,l),l.newNameIndex=null,l.transferCode="",l.nameOptions=[],l.availableNames=[],l.occupiedNames=[],l.uiLocked=!1,l.isVisible=!1,l.isReady=!1,l.deferred=null;var c=function(){l.newNameIndex=null,l.transferCode="",l.nameOptions=[],l.availableNames=[],l.occupiedNames=[],l.uiLocked=!1,l.isVisible=!1,l.isReady=!1,l.deferred=null};l.open=function(t){return c(),r.verifyName(t).then(function(t){if(o.containsAnyNdmErrors(t))return r.notifyOnError(t).then(l.close);l.deferred=e.defer(),l.isVisible=!0;var n=i.get(t,"list.item",[]);l.nameOptions=n.map(function(e,t){var n=e.name,i=e.domain,a=e.available,o=e.acme,s="".concat(n,".").concat(i),r={id:t,name:s,value:s,ndnsName:n,available:a,domain:i};return o&&(r.description={color:"green",text:"remoteAccess.keendns.register-popup.domain-with-ssl",iconClass:"icon--https"}),r});var a=_slicedToArray(i.partition(l.nameOptions,"available"),2);return l.availableNames=a[0],l.occupiedNames=a[1],l.newNameIndex=i.get(l.availableNames,"[0].id")||i.get(l.nameOptions,"[0].id"),l.isReady=!0,l.deferred.promise})};var d=function(){return i.get(l,["nameOptions",l.newNameIndex])};l.isOccupiedNameSelected=function(){var e=d();return e&&!e.available},l.save=function(){if(!l.uiLocked){l.uiLocked=!0;var e=d();if(!e)return l.deferred.resolve(!1),void c();var t={name:e.ndnsName,domain:e.domain},n=l.isOccupiedNameSelected()?l.transferCode:"";return r.bookName(t,n).then(function(e){var t=!o.containsAnyNdmErrors(e);t?r.notifyOnSuccess("name-booked"):r.notifyOnError(e),l.deferred.resolve(t)}).finally(function(){c()})}},l.close=function(){l.uiLocked||(l.deferred.resolve(!1),c())}}e.$inject=["$q","$parse","$timeout","_","CONSTANT","router","utils","keendnsService"],angular.module("keenetic").controller("KeendnsBookNameController",e)}(),function(){function e(e,t,n){var i={noip:"No-IP",dyndns:"DynDNS",rucenter:"RU-CENTER"};return{DEFAULT_DDNS_PROFILE:"_WEBADMIN",CUSTOM_DDNS_UPDATER:"custom",get:function(){var a={interface:{}},o={interface:{}};return e.set(a,"dyndns.updaters",{}),e.set(o,"dyndns.profile",{name:"_WEBADMIN"}),a.rc=o,t.post({url:"",data:{show:a}}).then(function(t){var a=t.show,o=a.rc,s=e.get(a,"dyndns.updaters.updater",[]).map(function(e){var t=e.type;return{id:t,label:i[t]||t}});return s.push({id:"custom",label:n.getTranslation("remoteAccess.ddns.custom")}),{dyndnsProfile:e.get(o,["dyndns","profile","_WEBADMIN"],{}),allShowInterfaceData:a.interface||{},allInterfaceData:o.interface||{},ddnsTypes:s}})},remove:function(){return t.postAndSave({dyndns:{profile:[{name:"_WEBADMIN",no:!0},{name:"_WEBADMIN"}]}})},save:function(n){var i=n.interfaceOptions,a=e.set({},"dyndns.profile",{}),o=n.selectedInterfaces;return n.singleSuitableIface&&(o=i.map(function(e){return e.id})),a.dyndns.profile._WEBADMIN={type:n.type,domain:n.domain,username:n.username,password:n.password,"send-address":!n.autodetectIp,url:"custom"===n.type&&n.url||{no:!0}},i.length&&(a.interface={},i.forEach(function(t){var n=t.id;a.interface[n]={dyndns:{profile:e.includes(o,n)?"_WEBADMIN":{profile:"_WEBADMIN",no:!0}}}})),t.postAndSave(a)}}}e.$inject=["_","router","utils"],angular.module("keenetic").factory("ddnsService",e)}(),function(){function e(e,t,n,i,a,o,s,r,l){var c=this,d=l.DEFAULT_DDNS_PROFILE,p="save",u="delete",m=function(){return n.get(c,"form.$setPristine",angular.noop)()};c.model={type:"noip",domain:"",username:"",password:"",url:"",autodetectIp:!1,singleSuitableIface:!1,interfaceOptions:[],selectedInterfaces:[]},c.customDdns=l.CUSTOM_DDNS_UPDATER,c.progress=30,c.isConfugured=!1,c.isLoading=!0;var f=function(e){var t,n;switch(e){case p:t=l.save,n="remoteAccess.ddns.settings-saved";break;case u:t=l.remove,n="remoteAccess.ddns.settings-deleted";break;default:t=angular.noop}c.isLoading=!0,t(c.model).then(c.load).then(function(){a.success(n),m()})};c.load=function(){return l.get().then(function(t){var i=t.allShowInterfaceData,a=t.allInterfaceData,o=t.dyndnsProfile||{},s=n.extend({type:"noip",domain:"",username:"",password:"",url:"",autodetectIp:!1,singleSuitableIface:!1,interfaceOptions:[],selectedInterfaces:[]},o),l=[],p=[];c.ddnsTypes=t.ddnsTypes.slice(),c.isConfugured=Boolean(t.dyndnsProfile),s.autodetectIp=!1===o["send-address"],n.forEach(i,function(e){if(e.global){var t=a[e.id].dyndns;l.push(e),-1!==n.get(t,"profile",[]).indexOf(d)&&p.push(e.id)}}),s.selectedInterfaces=n.uniq(p);var u=n.map(l,"id");s.interfaceOptions=r.getInterfaceOptions(i).filter(function(e){return n.includes(u,e.id)}).map(function(e){return e.checked=n.includes(s.selectedInterfaces,e.id),e}),e(function(){s.singleSuitableIface=1===s.interfaceOptions.length,c.model=s,c.progress=100,c.isLoading=!1,c.parentCtrl.tabContentsChanged.ddns=c.canChangeTab})})},c.canChangeTab=function(){return!c.form||!c.form.modified||s.confirmLeave(function(){return c.form&&c.form.reset()})},c.save=function(){return f(p)},c.remove=function(){return s.confirm("remoteAccess.ddns.delete-confirm").then(function(){return f(u)})},c.init=function(){return c.load().then(m)},t.$watch("::vm.parentCtrl",function(){c.parentCtrl.callOnTabChange.ddns=c.init,e(function(){"ddns"===c.parentCtrl.activeTab&&c.init()})})}e.$inject=["$timeout","$scope","_","utils","notification","components","modal","interfaces","ddnsService"],angular.module("keenetic").controller("DDNSController",e)}(),function(){function e(e,t,n,i,a,o,s){var r="_ANY_",l=function(t){var n=e.toArray(e.get(t,"[0].".concat("show.rc.ip.name-server"),{})),a=e.get(t,"[1].".concat("show.interface"),{}),o=e.get(t,"[2].".concat("show.rc.interface"),{});return s.all([i.getSegments(o),s.when(n),s.when(a)])},c=function(){var i=t.toRciQueryList(["show.rc.ip.name-server","show.interface","show.rc.interface"]);return n.postToRciRoot(i).then(l).then(function(t){var n=_slicedToArray(t,3),i=n[0],o=n[1],s=n[2];return{dnsList:o.map(function(e){return{address:e.address+(e.port?":"+e.port:""),domain:e.domain,interface:e.interface||r,isSaved:!0}}).sort(function(e,t){return a.ip2num(e.address)-a.ip2num(t.address)}),segmentAddresses:e.chain(i).filter(function(t){return e.has(t,"ip.address.address")}).map(function(t){return{label:t.description,address:e.get(t,"ip.address.address")}}).value(),showInterfaceData:s}})};return{ANY_INTERFACE_OPTION:r,STATIC_DNS_INSTALLED:!0,getNewStaticDnsRow:function(){return{address:"",domain:"",interface:r,isSaved:!1}},getInterfaceOptionsList:function(t){var n=i.getInterfaceOptions(t).filter(function(e){return t=e,angular.isDefined(t.global);var t}).filter(function(e){return t=e,!i.isAccessPointInterfaceId(t.id)||function(e){return e.index<=1}(e);var t}).filter(function(n){var a=e.find(t,function(e){return e.id===n.id})||t[n.name];return!!a&&i.isPublic(a)});return[{id:r,label:"staticRoutes.any-interface"}].concat(_toConsumableArray(n.map(function(e){return{id:e.name,label:e.label}})))},getData:c,setData:function(t){return c().then(function(i){var a=function(t,n){var i=function(e,t){return e.address===t.address&&e.domain===t.domain&&e.interface===t.interface},a=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n={domain:e.domain,interface:e.interface===r?"":e.interface},i=e.address.split(":");return n.address=i[0],n.port=i[1]||"",t&&(n.no=!0),n},o=e.filter(n,function(e){return Boolean(e.address)}),s=[],l=e.differenceWith(t,o,i);e.forEach(l,function(t){s.push(e.set({},"ip.name-server",a(t,!0)))});var c=e.differenceWith(o,t,i);return c.length&&s.push(e.set({},"ip.name-server",e.map(c,function(e){return a(e,!1)}))),s}(i.dnsList||[],t);return 0===a.length?s.when(!0):n.postAndSave(a)})}}}e.$inject=["_","utils","router","interfaces","ipV4Service","components","$q"],angular.module("keenetic").factory("staticDns",e)}(),function(){function e(e,t,n,i,a,o,s){var r=this,l=s.STATIC_DNS_INSTALLED,c=function(e){return JSON.parse(JSON.stringify(e))},d=function(){r.interfaceOptions=s.getInterfaceOptionsList(r.showInterfaceData)};i.$on("$destroy",a.$on("$translateChangeSuccess",function(){return n(d)})),r.STATIC_DNS_INSTALLED=l,r.showInterfaceData={};var p,u,m;r.staticDns=(p=s.getNewStaticDnsRow,u="staticDns_address_",m={data:[],dataOnLoad:[],isChanged:!1,init:function(e){m.data=e,m.segmentAddresses=e.segmentAddresses,m.data=e.dnsList,m.dataOnLoad=c(e.dnsList)},onChange:function(){n(function(){m.compareData()})},compareData:function(){var t=m.data.map(function(t){return e.omit(t,["isSaved"])}),n=m.dataOnLoad.map(function(t){return e.omit(t,["isSaved"])});m.isChanged=!e.isEqual(n,t),m.isChanged||e.forEach(m.data,function(e,t){r["staticDnsForm__".concat(t)].$setPristine()})},resetState:function(){m.data=c(m.dataOnLoad),m.isChanged=!1},deleteRow:function(e){m.data.splice(e,1),m.compareData()},addRow:function(){m.data.push(p()),m.compareData(),n(function(){o.setFocusToNode('input[name="'.concat(u).concat(m.data.length-1,'"]'))})},restrictSegmentAddresses:function(t){var n=e.find(m.segmentAddresses,{address:t});if(n)return o.getTranslation("errors.ip-is-assigned-to-interface",null,{interface:n.label})}});r.save=function(){return s.setData(r.staticDns.data).then(function(){r.staticDns.isChanged=!1,r.staticDns.data=r.staticDns.data.filter(function(e){return""!==e.address}),r.staticDns.dataOnLoad=c(r.staticDns.data)})},r.reset=function(){r.staticDns.resetState()},s.getData().then(function(e){r.staticDns.init(e),r.showInterfaceData=e.showInterfaceData,d()})}e.$inject=["_","$document","$timeout","$scope","$rootScope","utils","staticDns"],angular.module("keenetic").controller("StaticDnsController",e)}(),function(){function e(e,t,n,i,a,o){var s,r="1572879",l=["1572875","2949131"],c={YANDEXDNS:"yandexdns",SKYDNS:"skydns",SAFEDNS:"safedns",CLOUDFLARE_DNS:"cloudflare-dns",ADGUARD_DNS:"adguard-dns"},d=(_defineProperty(s={},c.SKYDNS,"https://www.skydns.ru/trial"),_defineProperty(s,c.SAFEDNS,"https://www.safedns.com/trial"),s),p=function(){var e;return _defineProperty(e={},c.YANDEXDNS,Boolean(o.ydns)),_defineProperty(e,c.SKYDNS,Boolean(o.skydns)),_defineProperty(e,c.SAFEDNS,Boolean(o.safedns)),_defineProperty(e,c.ADGUARD_DNS,Boolean(o["adguard-dns"])),_defineProperty(e,c.CLOUDFLARE_DNS,Boolean(o["cloudflare-dns"])),e},u=function(e){return e===c.SKYDNS||e===c.SAFEDNS},m=function(e,t){var i=Object.keys(e||{}),a=n.filter(i,function(e){return-1!==e.indexOf(t)}),o=a.length>0&&a[0];return n.get(e,[o,"message"],!1)},f=function(e){switch(e){case c.YANDEXDNS:case c.ADGUARD_DNS:case c.CLOUDFLARE_DNS:return"type";case c.SAFEDNS:case c.SKYDNS:return"token"}},g=function(e){return n.get(e,"profile",[]).map(function(e){return{id:e,label:"default"===e?"netFilter.no-filtering":"netFilter.ya.profile.".concat(e)}})},v=function(e){return n.get(e,"profile",[]).map(function(e){return{id:e,label:"default"===e?"netFilter.no-filtering":"netFilter.adguard-dns.profile.".concat(e)}})},h=function(e){return n.get(e,"profile",[]).map(function(e){return{id:e,label:"default"===e?"netFilter.no-filtering":"netFilter.cloudflare-dns.profile.".concat(e)}})},b=function(e){if(!e||!e.profiles)return[];var t=[];return n.forEach(n.get(e,"profiles.profile",{}),function(e,n){t.push({id:String(e.token),label:0===e.token?"netFilter.no-filtering":n})}),t},_=[{id:"-1",label:"netFilter.profiles-load-error",icon:"warning"}];return{SERVICE:c,SERVICE_LINK:d,SERVICES_WITH_ACCOUNT:[c.SKYDNS,c.SAFEDNS],DEFAULT_PROFILE_HOSTNAME:"*",DEFAULT_PROFILE_L10N:"netFilter.no-filtering",DEFAULT_PROFILE:"default",isServiceAvailable:function(e){return i.get("show/"+e+"/availability").then(function(e){return Boolean(e.available)})},getInstalledServices:p,getAllDeviceProfiles:function(e,t){var a;return i.post({url:"",data:{show:{rc:(a={},_defineProperty(a,e,{}),_defineProperty(a,"known",{host:{}}),a)}}}).then(function(i){var a=i.show,o=n.get(a,"rc.known.host",{}),s={},r={};return(n.get(a,["rc",e],{}).assign||[]).forEach(function(n){n.host?r[n.host]={id:String(n[f(e)]),mac:n.host}:s["*"]={id:String(n[f(e)])||t,mac:null}}),s["*"]||(s["*"]={id:t,mac:null}),n.forEach(o,function(e,n){s[n]=r[e.mac]||{id:t,mac:e.mac}}),s})},setDeviceProfiles:function(t,n){if(!t)return e.when({});var a={},o=[];return n.forEach(function(e){var n={};n[f(t)]=e.profile.id,e.device&&(n.host=e.profile.mac),o.push(n)}),a[t]={assign:o},i.postAndSave(a)},getFilterProfiles:function(e){var t={},a={show:{}};e?t[e]=!0:t=p();var o=Object.keys(t);return o.forEach(function(e){a.show[e]={profiles:{}}}),i.post({url:"",data:a}).then(function(e){var t=e.show,i=[],a={};return o.forEach(function(e){i.push(n.get(t,[e,"profiles"],[]))}),i.forEach(function(t,i){var s=o[i],d=function(e){switch(e){case c.YANDEXDNS:return g;case c.ADGUARD_DNS:return v;case c.CLOUDFLARE_DNS:return h;case c.SAFEDNS:case c.SKYDNS:return b}}(s),p=m(e.ndmErrors,s),u=n.get(t,"status.0.code",0),f=p?_.slice():d(t);a[s]={error:p,profiles:f,connOk:!u||u!==r,authOk:!u||!n.includes(l,u)}}),a})},getServicesInitData:function(){var t=function(e,t){t=t||angular.identity;var i=[];return n.forEach(e,function(e,n){e&&i.push({name:n,url:t(n)})}),i}(p(),angular.identity),a={show:{rc:{}}},o=a.show.rc;return 0===t.length?e.when({enabled:!1,enabledServiceRequiresUserinfo:!1,enabledServiceData:{},clients:[],services:{},defaultProfile:!1,available:[]}):(t.forEach(function(e){o[e.url]={}}),i.post(a).then(function(e){e=n.get(e,"show.rc",{});var i=!1,a=!1,o=[],s=[],r=[];if(n.forEach(e,function(e,n){var i=t.filter(function(e){return e.url===n});e?e.available=!0:e={available:!1},e.name=i.length>0?i[0].name:"",e.enable=Boolean(e.enable),e.enable&&s.push(e),r.push(e)}),s.length>0){i=s[0].name;var l=(o=s[0].assign||[]).filter(function(e){return!e.host});l.length>0?a=l[0][f(i)]:i===c.YANDEXDNS?a="safe":i===c.ADGUARD_DNS?a="standard":i===c.CLOUDFLARE_DNS&&(a="malware")}return{enabled:i,enabledServiceRequiresUserinfo:!!i&&u(i),enabledServiceData:i?s[0]:{},clients:o,services:r,defaultProfile:a,available:r.filter(function(e){return e.available}).map(function(e){return e.name})}}))},getServiceState:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a={},o={show:{}};return u(e)&&(a.userinfo={}),t||(a.availability={}),o.show[e]=a,o.show.rc=_defineProperty({},e,{}),i.post(o).then(function(i){var a=i.show,o=n.get(a,[e,"availability"],{}).available,s=n.get(a,[e,"userinfo"],{plan:!0}),c=n.get(s,"status.0.code"),d=a.rc[e];if(i.ndmErrors){var p=m(i.ndmErrors,e);d=angular.extend(d,{error:p})}return(d=angular.extend(d,s)).connOk=!c||c!==r,d.available=o,d.availabilityChecked=!t,d.authOk=Boolean(s.plan)&&(!c||!n.includes(l,c)),d})},setServiceState:function(e,t){var a=[];return n.forEach(p(),function(n,i){if(n){var o={};o[i]={enable:i===e&&t},i===e?a.push(o):a.unshift(o)}}),i.postAndSave(a)},setUserInfo:function(e,t,n){var a={};return a[e]={},a[e].login=t,n&&(a[e].password=n),i.postAndSave(a)}}}e.$inject=["$q","$parse","_","router","utils","components"],angular.module("keenetic").factory("netFilter",e)}(),function(){function e(e,t,n,i,a,o,s,r,l,c,d){var p=this,u=function(){var e=s.l10n.getSrefChunks("controlPanel.devicesList",{},"devicelist");p.l10n={accountPopupDescription:{},hint:s.getTranslation("netFilter.hint",null,e),noRegisteredDevices:s.getTranslation("netFilter.no-registered-devices",null,e)},d.SERVICES_WITH_ACCOUNT.forEach(function(e){p.l10n.accountPopupDescription[e]=s.getTranslation("netFilter.".concat(e,".popup-description"),null,s.l10n.getLinkChunks("service",{target:"_blank",href:d.SERVICE_LINK[e],class:s.EXTERNAL_LINK_CLASS}))})};u(),p.noErrors=!0,p.reloadProfiles=!1,p.authError=!0,p.availLoading=!1,p.connError=!1,p.connErrorDescription="",p.profilesModified=!1,p.DEFAULT_PROFILE_HOSTNAME=d.DEFAULT_PROFILE_HOSTNAME,p.table={rows:[],columns:[{title:"device",width:200},{title:"profile",width:200}],sort:{column:"device",reverse:!1},sortBy:function(e){e===p.table.sort.column?p.table.sort.reverse=!p.table.sort.reverse:(p.table.sort.column=e,p.table.sort.reverse=!1)},objToRows:function(e){return c.map(e,function(e,t){return{device:t,profile:e}})},updateRows:function(){p.table.rows=p.table.objToRows(p.deviceProfiles)}};var m=function(e){return-1!==d.SERVICES_WITH_ACCOUNT.indexOf(e)};function f(e){p.connError=!e,p.connError&&p.filter?p.connErrorDescription=s.getTranslation("netFilter.connection-unavailable","",{service:s.getTranslation("netFilter.filters."+p.filter)}):p.connErrorDescription="",p.availLoading=!1}p.canShowProfiles=function(){return p.filter&&(p.filter===d.SERVICE.YANDEXDNS||p.filter===d.SERVICE.ADGUARD_DNS||p.filter===d.SERVICE.CLOUDFLARE_DNS||m(p.filter)&&!p.authError)},p.resetState=function(){return p.ndmSettings.state={},e.when(!0)},p.getFilterLabel=function(e){var t="";return p.filters.forEach(function(n){e===n.id&&(t=s.getTranslation(n.name))}),t},p.notifyOnEnable=function(){p.filter&&p.ndmSettings.filter!==p.filter&&(p.authError&&m(p.filter)?p.ndmSettings.state.login&&p.ndmSettings.state.login.length>0?l.warning("netFilter.".concat(p.filter,".auth-error")):l.info("netFilter.".concat(p.filter,".sign-up-or-sign-in")):l.success([s.getTranslation("netFilter.enabled"),p.getFilterLabel(p.filter)].join("")))},p.resetCtrl=function(){return p.ndmSettings={filter:!1,defaultProfile:!1,deviceProfiles:{},state:{}},p.allFiltersProfiles={},p.filters=[],p.filter=!1,p.defaultProfile=!1,p.filterProfiles=[],p.deviceProfiles={},p.errors={},e.when(!0)},p.getFilterProfiles=function(t){return!p.reloadProfiles&&p.allFiltersProfiles[t]?e.when(p.allFiltersProfiles[t]):p.getCurrentFilterProfiles().then(function(){return p.allFiltersProfiles[t]})},p.getCurrentFilterProfiles=function(){return p.filter?d.getFilterProfiles(p.filter).then(function(e){p.allFiltersProfiles=angular.copy(e),p.filter&&(p.filterProfiles=p.allFiltersProfiles[p.filter].profiles,p.defaultProfile=p.defaultProfile||p.filterProfiles[0].id),e[p.filter]&&(p.authError=!e[p.filter].authOk)}):e.when(!0)},p.getServicesData=function(){return d.getServicesInitData().then(function(e){if(p.filters=e.available.map(function(e){return{id:e,name:"netFilter.filters.".concat(e)}}),p.filters.unshift({id:"",name:"netFilter.no-filtering"}),angular.isString(e.enabled))p.filter=e.enabled;else{var t=c.filter(e.services,function(e){return m(e.name)});if(0===t.length)p.filter="";else{var n=c.filter(t,function(e){return e.enable&&c.get(e,"login","").length>0});p.filter=n.length>0?n[0].name:""}}p.ndmSettings.state=angular.extend(p.ndmSettings.state,e.enabledServiceData),p.filter&&(p.ndmSettings.filter=e.enabled,p.ndmSettings.defaultProfile=e.defaultProfile,p.defaultProfile=e.defaultProfile,p.authIsRequired=m(p.filter))})},p.getAllDeviceProfiles=function(t,n){return t=t||p.filter,n=n||p.defaultProfile,p.filter?d.getAllDeviceProfiles(t,n).then(function(e){e[p.DEFAULT_PROFILE_HOSTNAME]?(p.defaultProfile=e[p.DEFAULT_PROFILE_HOSTNAME].id,delete e[p.DEFAULT_PROFILE_HOSTNAME]):p.defaultProfile=p.allFiltersProfiles[t].profiles[0].id,p.deviceProfiles=angular.copy(e),p.table.updateRows(),p.ndmSettings.deviceProfiles=angular.copy(e)}):e.when(!0)},p.pollAvailability=function(){var e;if(!p.availLoading&&p.connError)return p.availLoading=!0,e=p.filter,p.filter&&d.isServiceAvailable(e).then(function(t){e===p.filter&&(f(t),t&&p.updateServiceState(e))})},p.updateServiceState=function(e){return p.connError=!1,d.getServiceState(e).then(function(t){return p.resetState(),p.ndmSettings.state=angular.extend(p.ndmSettings.state,t),f(t.available),m(e)&&(p.authError=!t.authOk),p.noErrors=!t.error,p.connError=!t.connOk||!t.available,m(p.filter)&&(p.skydns.info=p.skydns.updateInfo(),!t.authOk&&p.skydns.popup.opened&&p.skydns.popup.resetForm()),t})},p.onSkydnsChangeLinkKeydown=function(e){if(r.isSpace(e))return e.preventDefault(),e.stopPropagation(),p.skydns.popup.open(),!0},p.updateDeviceProfiles=function(e,t,n){p.noErrors=!t.error,p.filterProfiles=t.profiles.slice();var i=p.filterProfiles.map(function(e){return e.id});p.defaultProfile&&-1!==i.indexOf(p.defaultProfile)||(e===p.ndmSettings.filter&&p.ndmSettings.defaultProfile?p.defaultProfile=p.ndmSettings.defaultProfile:"-1"!==i[0]&&(p.defaultProfile=p.filterProfiles[0].id)),c.forEach(p.deviceProfiles,function(n,a){if(t.error)p.deviceProfiles[a].id=i[0];else if(-1===i.indexOf(n.id)){var o=e===p.ndmSettings.filter&&p.ndmSettings.deviceProfiles[a]&&p.ndmSettings.deviceProfiles[a].id;p.deviceProfiles[a].id=o?p.ndmSettings.deviceProfiles[a].id:i[0]}}),p.table.updateRows(n)},p.switchFilter=function(t){return p.connErrorDescription="",p.connError=!1,p.availLoading=!0,p.lockUi(),t?p.lockUi().then(p.updateServiceState.bind(null,t)).then(p.enabled?d.setServiceState.bind(null,t,!0):angular.noop).then(function(){p.reloadProfiles=!0}).then(p.getFilterProfiles.bind(null,t)).then(function(){return p.getAllDeviceProfiles(t,p.defaultProfile)}).then(function(){return!!t&&p.updateDeviceProfiles(t,p.allFiltersProfiles[t],!1)}).finally(function(){return p.authIsRequired=m(t),p.authError&&p.authIsRequired&&(t===d.SERVICE.SKYDNS||t===d.SERVICE.SAFEDNS)?p.serviceForm.$setValidity("auth",!1,p):p.serviceForm.$setValidity("auth",!0,p),p.unlockUi(p.ndmSettings.filter!==t)}):(p.unlockUi(!0),p.authIsRequired=!1,p.serviceForm.$setValidity("auth",!0,p),e.when(!0))},p.changeDefaultProfile=function(){a(function(){p.profilesModified=p.profilesModified||!p.ndmSettings.defaultProfile||p.defaultProfile===p.ndmSettings.defaultProfile})},p.changeDeviceProfile=function(e){return function(){a(function(){var t=p.table.rows.filter(function(t){return t.device===e});t.length>0&&(p.profilesModified=p.profilesModified||p.deviceProfiles[e].id===t[0].profile.id)})}},p.init=function(){return p.availLoading=!0,p.unlockUi=function(e){return p.availLoading=!1,p.unlockMainUi(e)},p.resetCtrl().then(p.lockUi).then(p.getServicesData).then(function(){return p.updateProgress()}).then(p.getCurrentFilterProfiles).then(function(){return p.updateProgress()}).then(p.getAllDeviceProfiles).then(function(){return p.updateProgress()}).then(function(){return p.updateServiceState(p.filter)}).then(function(){return p.updateProgress()}).then(p.setMainFormPristine).finally(function(){p.unlockUi(),p.filter!==d.SERVICE.SKYDNS&&p.filter!==d.SERVICE.SAFEDNS||(p.skydns.info=p.skydns.updateInfo()),p.reloadProfiles=!0})},p.save=function(){var t=!(p.authError&&m(p.filter));return p.lockUi().then(function(){if(!t)return e.when(!1);var n=p.table.rows.slice();n.push({profile:{id:p.defaultProfile}});var i=d.setServiceState(p.filter||p.ndmSettings.filter,Boolean(p.filter));return p.filter&&i.then(d.setDeviceProfiles.bind(null,p.filter,n)).then(p.getAllDeviceProfiles.bind(null,p.filter,p.defaultProfile)),i}).then(function(){t&&(p.profilesModified=!1)}).then(p.notifyOnEnable).finally(function(){return p.ndmSettings.filter=p.filter,p.unlockUi(!t)})},p.reset=function(){return p.lockUi().then(function(){a(function(){p.switchFilter(p.filter)})}).finally(p.unlockUi)},t.$on("$destroy",o.$on("$translateChangeSuccess",function(){return a(u)})),p.skydns={info:[],updateInfo:function(){return{login:p.ndmSettings.state.login||s.getTranslation("netFilter.is-not-set"),tariff:p.ndmSettings.state.plan&&p.ndmSettings.state.plan.name||s.getTranslation("netFilter.is-not-set")}},goToWebsite:function(){n.open(d.SERVICE_LINK[p.filter],"_blank")},popup:{_changeWatcher:null,opened:!1,authError:"",notifyAuthError:function(){var e=p.skydns.popup;e.authError="netFilter.sky.auth-error",a(function(){e._changeWatcher&&e._changeWatcher(),e._changeWatcher=t.$watchGroup(["vm.ndmSettings.state.login","vm.ndmSettings.state.password"],function(t,n){c.isEqual(t,n)||(e.authError="",l.hideAll())}),l.warning("netFilter.skydns.auth-error",-1)},200)},open:function(){var e=p.skydns.popup;p.lockUi(),e.resetForm(),e.opened=!0,a(function(){c.get(p,"ndmSettings.state.error")?e.notifyAuthError():c.get(p,"formSkyAuth.skyDnsLogin.revalidate",angular.noop)()})},resetForm:function(){c.get(p,"formSkyAuth.$setPristine",angular.noop)()},close:function(){return p.skydns.popup.opened=!1,l.hideAll(),p.skydns.info=p.skydns.updateInfo(),p.reloadProfiles=!0,p.skydns.popup._changeWatcher&&p.skydns.popup._changeWatcher(),p.skydns.popup._changeWatcher=null,p.authError?p.unlockUi(!0):p.getFilterProfiles(p.filter).then(p.updateDeviceProfiles.bind(null,p.filter)).then(function(){return p.unlockUi(!0)})},ready:function(){return p.progress()>=100},save:function(){return p.skydns.popup.authIsNotOk=!1,d.setUserInfo(p.filter,p.ndmSettings.state.login,p.ndmSettings.state.password).then(p.updateServiceState.bind(null,p.filter)).then(function(t){if(p.switchFilter(p.filter),!t.authOk)return e.reject("auth")}).then(function(){return p.skydns.popup.close()},p.skydns.popup.notifyAuthError)}}},p.init()}e.$inject=["$q","$scope","$window","$document","$timeout","$rootScope","utils","keyboard","notification","_","netFilter"],angular.module("keenetic").controller("InternetSafetyController",e)}(),function(){function e(e,t,n,i,a,o){var s="show.rc.".concat("dns-proxy.tls.upstream"),r="show.rc.".concat("dns-proxy.https.upstream"),l=Boolean(i["dns-tls"]),c=Boolean(i["dns-https"]),d={JSON:"json",DNS_MESSAGE:"dnsm"},p=function(){return{address:"",fqdn:"",hash:"",interface:"_ANY_",isSaved:!1}},u=function(){return{url:"",format:d.DNS_MESSAGE,hash:"",interface:"_ANY_",isSaved:!1}},m=function(e){var t=e.address+(e.port?":".concat(e.port):"");return Object.assign({},{address:"",fqdn:"",hash:"",interface:"_ANY_",isSaved:!1},{},e,{address:t,isSaved:!0})},f=function(e){return Object.assign({},u(),{},e,{isSaved:!0})},g=function(e){return{dnsOverTls:t.toArray(t.get(e,"0.".concat(s),[])),dnsOverHttps:t.toArray(t.get(e,"1.".concat(r),[])),showInterfaceData:t.get(e,"2.".concat("show.interface"),{})}},v=function(e){return"_ANY_"===e.interface?"":e.interface},h=function(e){var n=e.hash,i=e.fqdn,a=v(e),o=e.address.split(":"),s={address:t.get(o,"0",""),port:t.get(o,"1",""),hash:n,fqdn:i,interface:a};return t.pickBy(s,t.identity)},b=function(e){var n=e.filter(function(e){return e.address}).map(h);return[t.set({},"dns-proxy.tls.upstream",{no:!0})].concat(_toConsumableArray(n.map(function(e){return t.set({},"dns-proxy.tls.upstream",e)})))},_=function(e){var n=e.hash,i=e.format,a={url:e.url,hash:n,format:i,interface:v(e)};return t.pickBy(a,t.identity)},y=function(e){var n=e.filter(function(e){return e.url}).map(_);return[t.set({},"dns-proxy.https.upstream",{no:!0})].concat(_toConsumableArray(n.map(function(e){return t.set({},"dns-proxy.https.upstream",e)})))};return{ANY_INTERFACE_OPTION:"_ANY_",DNS_OVER_HTTPS_FORMAT:d,DNS_OVER_TLS_INSTALLED:l,DNS_OVER_HTTPS_INSTALLED:c,getDnsOverHttpsFormatOptions:function(){return[{id:d.DNS_MESSAGE,label:"DNS message"},{id:d.JSON,label:"JSON"}]},getData:function(){return o.postToRciRoot(n.toRciQueryList([l?s:{},c?r:{},"show.interface"])).then(g).then(function(e){var t=e.dnsOverTls,n=e.dnsOverHttps,i=e.showInterfaceData;return{dnsOverTlsData:t.map(m),showInterfaceData:i,dnsOverHttpData:n.map(f)}})},getNewDnsOverTlsRow:p,getNewDnsOverHttpsRow:u,getDnsOverTlsQueryList:b,getDnsOverHttpsQueryList:y,saveData:function(t,n){var i=l?b(t):[],a=c?y(n):[],s=[].concat(_toConsumableArray(i),_toConsumableArray(a));return s.length>0?o.postAndSave(s):e.when(!0)}}}e.$inject=["$q","_","utils","components","interfaces","router"],angular.module("keenetic").factory("dnsOverX",e)}(),function(){function e(e,t,n,i,a,o,s,r){var l=this,c=r.DNS_OVER_TLS_INSTALLED,d=r.DNS_OVER_HTTPS_INSTALLED;l.DNS_OVER_TLS_INSTALLED=c,l.DNS_OVER_HTTPS_INSTALLED=d,l.showInterfaceData={};var p=function(){l.interfaceOptions=s.getInterfaceOptionsList(l.showInterfaceData)};i.$on("$destroy",a.$on("$translateChangeSuccess",function(){return n(p)}));var u=function(t,i,a){var s={data:[],dataOnLoad:[],isChanged:!1,init:function(e){s.data=e,s.dataOnLoad=JSON.parse(JSON.stringify(e))},onChange:function(){n(function(){s.compareData()})},compareData:function(){var t=s.data.map(function(t){return e.omit(t,["isSaved"])}),n=s.dataOnLoad.map(function(t){return e.omit(t,["isSaved"])});s.isChanged=!e.isEqual(n,t),s.isChanged||e.forEach(s.data,function(e,t){l["".concat(a,"Form__").concat(t)].$setPristine()})},resetState:function(){s.data=JSON.parse(JSON.stringify(s.dataOnLoad)),s.isChanged=!1},deleteRow:function(e){s.data.splice(e,1),s.compareData()},addRow:function(){s.data.push(t()),s.compareData(),n(function(){o.setFocusToNode('input[name="'.concat(i).concat(s.data.length-1,'"]'))})}};return s};l.dnsOverTls=u(r.getNewDnsOverTlsRow,"dnsOverTls_address_","dnsOverTls"),l.dnsOverHttps=u(r.getNewDnsOverHttpsRow,"dnsOverHttps_url_","dnsOverHttps"),l.dnsOverHttps.formatOptions=r.getDnsOverHttpsFormatOptions();var m=function(e){e.isChanged=!1,e.data=e.data.filter(function(e){return""!==e.address}),e.dataOnLoad=JSON.parse(JSON.stringify(e.data))};l.save=function(){return r.saveData(l.dnsOverTls.data,l.dnsOverHttps.data).then(function(){m(l.dnsOverHttps),m(l.dnsOverTls)})},l.reset=function(){l.dnsOverTls.resetState(),l.dnsOverHttps.resetState()},r.getData().then(function(e){var t=e.dnsOverTlsData,n=e.dnsOverHttpData,i=e.showInterfaceData;l.showInterfaceData=i,l.dnsOverTls.init(t),l.dnsOverHttps.init(n),p()})}e.$inject=["_","$document","$timeout","$scope","$rootScope","utils","staticDns","dnsOverX"],angular.module("keenetic").controller("DnsOverXController",e)}(),function(){function e(e,t,n,i,a){var o=this;o.isReady=!1,o.backhaul={isEnabled:!1,isUsed:!1,toggle:function(e){return!e&&o.backhaul.isUsed?t.confirm("wifi-system.settings.backhaul.warning").then(function(){return i.toggleBackhaulState(e)},function(){o.backhaul.isEnabled=!0}):i.toggleBackhaulState(e)}};var s,r;s=a.getDeviceDataRciQueries(),r=i.getSettingsRciQueries(),n.requester.registerCallback([].concat(_toConsumableArray(s),_toConsumableArray(r)),function(t){var n=a.destructureDeviceDataRciResponses(t),r=a.processDeviceDataRciResponses(n),l=t.slice(s.length);!function(t,n){var i=e.get(t,"membersData",[]);o.backhaul.isUsed=i.some(function(t){return e.has(t,"backhaul.ap")}),o.backhaul.isEnabled=n.backhaulIsEnabled,o.isReady=!0}(r,i.processSettingsRciResponses(l))}),n.setSectionReady()}e.$inject=["_","modal","MWSRequester","MWSSettings","MWSExtendersService"],angular.module("keenetic").controller("MWSSettingsController",e)}(),function(){var e;angular.module("keenetic").constant("MWSSharedService",(e={},{setSharedData:function(t,n){e[t]=n},getSharedData:function(t,n){return e[t]||n}}))}(),function(){function e(e,t,n){return{toggleBackhaulState:function(t){var i=e.set({},"mws.backhaul.shutdown",{no:t});return n.postAndSave(i)},getSettingsRciQueries:function(){return t.toRciQueryList(["show.rc.mws.backhaul"])},processSettingsRciResponses:function(t){return{backhaulIsEnabled:!e.get(t,"[0].".concat("show.rc.mws.backhaul",".shutdown"))}}}}e.$inject=["_","utils","router"],angular.module("keenetic").factory("MWSSettings",e)}(),function(){function e(e,t,n,i,a,o,s,r,l,c,d,p,u){var m=d.SHOW_MWS_MEMBER,f=d.SHOW_RC_SERVICE,g=d.SHOW_IP_ROUTE,v=d.SHOW_MWS_CONTROLLER,h=c.SERVICE_NAME,b=function(e,t){var n=t.ip,a=t.port,o="";if(n)o=80===a?"".concat(n):"".concat(n,":").concat(a);else{var s=i.find(e,{destination:"0.0.0.0/0"});o=i.get(s,"gateway","")}return o};return{isWizardAvailable:function(){return!1},openWizard:function(){var e=t.location.href,n=encodeURIComponent(e),i=s.getUrlForNDW3(),a=s.getCurrentLanguage(),o=p.getSessionId(),r=u.createHash(e+o);t.location.href="".concat(i,"/wizards/mws-setup?language=").concat(a,"&backUrl=").concat(n,"&token=").concat(r)},getMwsMembers:function(){if(!l.mws||a.sysmode!==o.SYSMODE.ROUTER)return e.when({serviceIsEnabled:!1,members:[]});var t=r.arrayToQueryData([f,m]),n={errorSuppressorFunction:d.memberErrorsSuppressorFn};return r.postToRciRoot(t,n).then(function(e){var t=i.get(e,f,{});return{serviceIsEnabled:Boolean(t[h]),members:i.toArray(i.get(e,m,[]))}})},queryControllerAddress:function(){var e=s.toRciQueryList([g,v]);return r.postToRciRoot(e).then(function(e){var t=i.toArray(i.get(e,"[0].".concat(g))),n=i.get(e,"[1].".concat(v)),o=b(t,n);return a.LAST_KNOWN_CONTROLLER_ADDRESS=o,o})},getControllerAddress:b,canExtenderSelectWifiChannel:function(e){return r.cached(v).then(function(t){return!!i.get(t,"backhaul.bss-shutdown")||i.get(t,"backhaul.uplink").split("/")[0]!==e})}}}e.$inject=["$q","$window","$location","_","NDM","CONSTANT","utils","router","components","MWSConstants","MWSRequester","authenticationService","md5"],angular.module("keenetic").factory("MWSService",e)}(),function(){function e(e,t,n,i,a,o,s,r,l,c){var d=r.DEFAULT_HOME_SEGMENT_ID,p=c.SHOW_INTERFACE,u=c.SHOW_RC_INTERFACE,m=function(e){return{showRcInterface:a.get(e,"0.".concat(u),{}),showInterface:a.get(e,"1.".concat(p),{}),macTable:a.toArray(a.get(e,"2.".concat(p,".mac.mactable"),[]))}},f=function(e,t){return a.includes(t.port,e)&&!a.includes(t["vlan-port"],e)},g=function(e,t){return a.includes(t["vlan-port"],e)},v=function(e,t){return a.chain(t).split(",").push(e).filter().uniq().join().value()},h=function(e,t){return a.chain(t).words().filter().without(e).join().value()},b=function(e,t){return a.set({},["interface",e],{iseg:t})},_=function(e,n){var i,o,s,r,l=n[d],c=a.pickBy(n,function(e,t){return t!==d}),p=a.chain(c).pickBy(function(t){return!g(e,t)}).map(function(t,n){return b(n,function(e,t){var n=h(e,t.port),i=v(e,t["vlan-port"]);return Object.assign({},t,_defineProperty({port:n},"vlan-port",i))}(e,t))}).value();return f(e,l)||p.push(b(d,(s=v(i=e,(o=l).port),r=h(i,o["vlan-port"]),Object.assign({},o,_defineProperty({port:s},"vlan-port",r))))),t.postAndSave(p)};return{fixControllerPortConfiguration:function(r){return t.postToRciRoot(s.toRciQueryList([u,p,a.set({},p,{name:i.LAN_SWITCH,mac:{}})])).then(m).then(function(t){var i=t.showRcInterface,l=t.showInterface,c=t.macTable,p=-1,u=a.find(c,{mac:r});if(!u)return n.when(!0);p=u.port;var m=a.chain(i).pickBy("iseg").mapValues("iseg").mapValues(function(e){return a.omit(e,["free-port","busy-vlan"])}).value(),v=m[d],h=a.pickBy(m,function(e,t){return t!==d});if(f(p,v)&&!a.some(h,function(e){return!g(p,e)}))return n.when(!0);if(f(p,v)&&a.every(h,function(e){return!g(p,e)}))return _(p,m);var b,y,S,w,C,E,I,T=a.chain(h).pickBy(function(e){return!g(p,e)}).keys().value();return f(p,v)||T.push(d),(b=T,y=p,S=l,w=n.defer(),C=e.getInterfaceIdToLabelMap(S),E="<ul>"+b.map(function(e){return"<li>".concat(C[e],"</li>")}).join("\n")+"</ul>",I=s.getTranslation("wifi-system.confirm-to-auto-include-port","",{port:y,list:E}),o.confirm(I,"yes","no").then(function(){return w.resolve(!0)},function(){return w.resolve(!1)}),w.promise).then(function(e){return e?_(p,m):n.when(!1)})})}}}e.$inject=["interfaces","router","$q","NDM","_","modal","utils","CONSTANT","dslService","MWSRequester"],angular.module("keenetic").factory("MWSSegmentsService",e)}(),function(){function e(e,t,n,i,a){var o,s=function(e){return t.pickBy(e,function(e,t){return!t.includes("rci")})},r=a.createRequester();r.setQueryOptions({errorSuppressorFunction:s});return{SHOW_IP_HOTSPOT:"show.ip.hotspot",SHOW_MWS_CANDIDATE:"show.mws.candidate",SHOW_MWS_MEMBER:"show.mws.member",SHOW_RC_SERVICE:"show.rc.service",SHOW_RC_INTERFACE:"show.rc.interface",SHOW_INTERFACE:"show.interface",SHOW_SYSTEM:"show.system",SHOW_VERSION:"show.version",SHOW_IP_ROUTE:"show.ip.route",SHOW_MWS_CONTROLLER:"show.mws.controller",requester:r,getShowIpHotspotQuery:function(){return t.set({},"show.ip.hotspot",{details:n.HOTSPOT_DETAILS.WIRELESS})},resetUninitializedSubcontrollerCount:function(){o=["MWSControllerController","MWSExtendersController","MWSLogController","MWSSettings"].length},memberErrorsSuppressorFn:s,setSectionReady:function(){0==--o&&r.startPolling()},resetServiceState:function(){r.clearCallbacks(),r.stopPolling()}}}e.$inject=["$q","_","CONSTANT","router","requesterFactory"],angular.module("keenetic").factory("MWSRequester",e)}(),function(){var e,t;angular.module("keenetic").constant("MWSConstants",{TAB:{DEVICES:"devices",LOG:"log",SETTINGS:"settings"},SERVICE_NAME:"mws",DEVICE_TYPE:{CONTROLLER:"MWS_CONTROLLER",MEMBER:"MWS_MEMBER",CANDIDATE:"MWS_CANDIDATE"},WIFI_BANDS:{BAND_5:"5",BAND_2:"2"},CANDIDATE_ACTIONS:{ACQUIRE:"acquire",REVISIT:"revisit",NONE:""},MEMBER_ACTIONS:{RELEASE:"release",CHECK_UPDATE:"check-update",ACQUIRE:"acquire"},LOG_EVENT_TYPE:{CONNECTED:"connected",LEFT:"left",TRANSITION:"transition",PMK_CACHE_TRANSITION:"pmk-cache-transition",FAST_TRANSITION:"fast-transition"},CANDIDATE_STATE:e={INITIAL:"INITIAL",LIST_CONTINUE:"LIST_CONTINUE",UPDATE_CONTINUE:"UPDATE_CONTINUE",UPDATE_REBOOT:"UPDATE_REBOOT",DISCONNECTED:"DISCONNECTED",INCOMPATIBLE:"INCOMPATIBLE",COMPATIBLE:"COMPATIBLE",COMPATIBLE_UPDATE:"COMPATIBLE_UPDATE"},CANDIDATE_LOADING_STATES:t=[e.INITIAL,e.LIST_CONTINUE,e.UPDATE_CONTINUE,e.UPDATE_REBOOT],CANDIDATE_REVISITABLE_STATES:[e.DISCONNECTED,e.INCOMPATIBLE],CANDIDATE_LOCKED_STATES:t,DEVICE_ARRAYS_PROPS:{MEMBERS:"membersData",CANDIDATES:"candidatesData"},MWS_PAGE_TAB_SWITCHED_EVENT:"MWS_PAGE_TAB_SWITCHED",MARKETING_NOTICE_NAME:"mws"})}(),function(){function e(e,t,n,i){var a=this;a.isMwsDeviceNameUnique=function(e){var t=a._device,n=t.isMwsController,i=t.mac;if(!n)return a._registeredNames[e]&&a._registeredNames[e]!==i?{message:"errors.name-exists"}:void 0};var o=function(){a._device={},a._saveFn=t.noop,a._closeFn=t.noop,a._registeredNames={},a.isVisible=!1,a.renameInProgress=!1,a.error=""};o(),a.lengthValidator=n.maxLengthValidatorConstructor(64),a.open=function(e,n,i,o){a._device=angular.copy(e),a._registeredNames=n,a._saveFn=i||t.noop,a._closeFn=o||t.noop,a.isVisible=!0},a.close=function(){a.renameInProgress=!1,a.isVisible=!1,a._closeFn(),o()},a.validate=function(e){if(e)if(a.lengthValidator(e))a.error="errors.too-long";else{var t=a._device,n=t.isMwsController,i=t.mac;a.error=!n&&a._registeredNames[e]&&a._registeredNames[e]!==i?"errors.name-exists":""}else a.error="errors.required-field"},a.rename=function(){if(!a.error&&!a.renameInProgress){a.renameInProgress=!0;var t=a._device;return e.when(a._saveFn(t.nameModel)).finally(a.close)}},i.setSharedData("renameDevice",a)}e.$inject=["$q","_","ValidatorManager","MWSSharedService"],angular.module("keenetic").controller("MWSRenameDeviceController",e)}(),function(){function e(e,t,n,i,a,o,s,r,l,c){var d=".".concat("ndm-layout"),p="".concat("ndm-layout","--blur"),u=this;u.shopLinkArgs="";var m=s.SHOW_VERSION;o.postToRciRoot(a.toRciQueryList([s.SHOW_VERSION])).then(function(e){var t=i.get(e,"[0].".concat(m),!1);if(t){var n=i.pick(t,["hw_id","release","region"]);u.shopLinkArgs=i.reduce(n,function(e,t,n){return"".concat(e,"&").concat(n,"=").concat(encodeURIComponent(t))},"")}}),u.close=function(){t(),e(),r.document.querySelector(d).classList.remove(p)},u.goToKeeneticSite=function(){var e=Object.keys(i.get(r,"NDM.profile.languages",{})),t=a.getCurrentLanguage();i.includes(e,t)||(t="en"),r.open("https://keenetic.com/recommended-wifi-system-extenders?locale=".concat(t).concat(u.shopLinkArgs)),u.close()};var f=function(e){var t="".concat("check-scroll","--on-screen");e.querySelectorAll(".".concat("check-scroll")).forEach(function(n){var i=n.getBoundingClientRect();e.getBoundingClientRect().height-i.top>100&&n.classList.add(t)})};l(function(){var e,t,i=n.isMobile?".ndm-mws-modal":".ndm-mws-modal .ss-content",a=r.document.querySelector(i),o=r.document.querySelector("body");r.document.querySelector(d).classList.add(p),a.addEventListener("scroll",function(e){f(e.target)}),f(a),e=o,t="".concat("check-mobile","--is-mobile"),e.querySelectorAll(".".concat("check-mobile")).forEach(function(e){n.isMobile&&e.classList.add(t)})},0),u.features=[{icon:"orange-wifi",text:"ndm-mws-modal.block3.strong-signal"},{icon:"orange-cellphone",text:"ndm-mws-modal.block3.lossless"},{icon:"orange-lightning",text:"ndm-mws-modal.block3.fast-connection"},{icon:"orange-shield",text:"ndm-mws-modal.block3.strong-security"}],u.advantages=[{icon:"traditional-router-icon",title:"ndm-mws-modal.block5.range-advantage",text:"ndm-mws-modal.block5.limited-range"},{icon:"extenders-icon",title:"ndm-mws-modal.block5.speed-advantage",text:"ndm-mws-modal.block5.speed-degradation"},{icon:"mesh-icon",title:"ndm-mws-modal.block5.reliability-advantage",text:"ndm-mws-modal.block5.reliability"}],u.backgroundText=a.getTranslation("ndm-mws-modal.block6.background-text"),c.onStart({},function(){return u.close()})}e.$inject=["close","callOnClose","browserCheck","_","utils","router","MWSRequester","$window","$timeout","$transitions"],angular.module("keenetic").controller("NdmMwsModalController",e)}(),function(){function e(e,t){var n=this;n.MAX_CLIENTS_IN_TOOLTIP=10,n.tooltipIsVisible=!1,n.allClientsAreVisible=!1,n.showTooltip=function(){n.tooltipIsVisible=!0},n.hideTooltip=function(){n.tooltipIsVisible=!1},n.onClick=function(e){n.clientsCount>0&&e.stopPropagation()},n.toogleClientsListLimit=function(){n.allClientsAreVisible?(n.clientsListLimit=n.MAX_CLIENTS_IN_TOOLTIP,n.allClientsAreVisible=!1):(n.clientsListLimit=n.clientsCount,n.allClientsAreVisible=!0)},n.$onChanges=function(i){if(i.clientsList){n.clientsCount=(i.clientsList.currentValue||[]).length,n.clientsListLimit=n.allClientsAreVisible?n.clientsCount:n.MAX_CLIENTS_IN_TOOLTIP;var a=e.chain(n.clientsList).filter("hostname").sortBy("hostname").value(),o=e.chain(n.clientsList).filter(["hostname",""]).sortBy("mac").value();n.clientsList=e.union(a,o);var s=n.clientsCount-n.clientsListLimit;n.showMoreClientsTextL10n=t.getTranslation(n.showMoreClientsText,null,{num:s}),n.hideMoreClientsTextL10n=t.getTranslation(n.hideMoreClientsText,null,{num:s})}}}e.$inject=["_","utils"],angular.module("keenetic").component("ndmMwsClientsTooltip",{templateUrl:"app/page/controlPanel/myNetwork/wifiSystem/ndm-mws-clients-tooltip/ndm-mws-clients-tooltip.html",bindings:{clientsList:"<",clientsCountTitle:"@",tooltipTitle:"@",showMoreClientsText:"@",hideMoreClientsText:"@"},controller:e,controllerAs:"vm"})}(),function(){function e(e,t,n,i,a,o,s,r,l,c,d){var p=c.DEVICE_TYPE,u=c.WIFI_BANDS,m=c.LOG_EVENT_TYPE,f=a.WIFI_BAND_2_GHZ,g=a.WIFI_BAND_5_GHZ,v={Jan:0,Feb:1,Mar:2,Apr:3,May:4,Jun:5,Jul:6,Aug:7,Sep:8,Oct:9,Nov:10,Dec:11},h=!1,b=[];t.$on(s.events.RESET,function(){h=!1});var _=function(e){return n.map(e,function(e,t){return{id:t,label:e}})},y=function(e,t,n,i){var a=n||"",o=i?" ".concat(t):"";return"".concat(e," (").concat(a).concat(o,")")},S=d.SHOW_IP_HOTSPOT,w=d.SHOW_MWS_MEMBER,C=d.SHOW_RC_INTERFACE,E=d.SHOW_INTERFACE,I=d.SHOW_VERSION,T={showIpHotspotHost:[],showMwsMember:[],showVersion:{},showRcInterface:{},showInterface:{}},k=["timestamp","deviceMac","deviceName","fromMac","fromBand","fromName","toMac","toName","toBand","segmentId","segmentName","eventType"],P=function(e,t){var i=n.get(e,"mac",""),a=n.get(e,"isController")?t:n.get(e,"device","");return i===a?"":a};return{getLogDataRciQueries:function(){return o.toRciQueryList([d.getShowIpHotspotQuery(),w,I,C,E])},destructureLogDataRciQueries:function(e){return{showIpHotspotHost:n.get(e,"0.".concat(S,".host"),[]),showMwsMember:n.toArray(n.get(e,"1.".concat(w),[])),showVersion:n.get(e,"2.".concat(I),{}),showRcInterface:n.get(e,"3.".concat(C),{}),showInterface:n.get(e,"4.".concat(E),{})}},updateAdditionalLogDataCache:function(e){T=e},getTransitionsLog:function(){var t,r=[(t=e.defer(),h?b.push(t):(h=!0,s.post({url:"show/mws/log",silent:!0}).then(angular.noop,function(e){t.reject(e),h=!1},function(e){var n=e.log||{};t.resolve(n),b.forEach(function(e){e.resolve(n)}),b=[]})),t.promise),e.when(T)];return e.all(r).then(function(e){var t=_slicedToArray(e,2),s=t[0],r=t[1],c=r.showIpHotspotHost,d=r.showMwsMember,h=r.showVersion,b=r.showRcInterface,S=function(e,t){var a=n.chain(t).pickBy(function(e){return e.iseg}).mapValues(function(e,t){var n=o.getInterfaceL10n(e);return{id:t,includedAccessPoints:l.getSegmentAccessPoints(e),description:n}}).value(),s=n.reduce(a,function(e,t){var n=t.id,i=t.includedAccessPoints.reduce(function(e,t){return Object.assign({},e,_defineProperty({},t,n))},{});return Object.assign({},e,{},i)},{});return n.chain(e).filter(function(e){return l.isAccessPointInterfaceId(e.id)}).filter(function(e){return n.has(t[e.id],"ssid")}).mapValues(function(e){var a=e.id,o=e.mac,r=s[a],l=t[a];return{id:a,ssid:l.ssid,mac:o,segmentId:r,isUp:Boolean(l.up),band:n.startsWith(a,i.MASTER_5G)?g:f}}).value()}(r.showInterface,b),w=c,C=a.getAllBandsL10n(!1),E=d.map(function(e){return e.mac}),I=l.findSegments(b),T=h.description,k={},P={},A=w.reduce(function(e,t){return Object.assign({},e,_defineProperty({},t.mac,t.name||t.hostname||t.mac))},{});return{logRecords:n.map(s,function(e){var t=e.timestamp,i=e.mac,a=e.ap,o=e.roam,s=e.id,r=e.band,l=e.segment,c=A[i]||"",f=Boolean(o),g="ft"===o,h=f&&!g,b=c===i?"":c,_="Bridge".concat(l),w=n.get(I,[_,"description"],""),E={timestamp:function(e){var t=new Date,n=t.getMonth(),i=t.getFullYear(),a=_slicedToArray(e.replace("  "," ").split(" "),3),o=a[0],s=a[1],r=_slicedToArray(a[2].split(":").map(Number),3),l=r[0],c=r[1],d=r[2],p=new Date,u=v[o],m=u>n?i-1:i;return p.setFullYear(m),p.setMonth(u),p.setDate(Number(s)),p.setHours(l,c,d),p}(t),segmentId:_,mac:i,device:b,to:null,from:null,isReassoc:f,isFt:g,isPmk:h,id:s,raw:e},D=e.left||{};if(E.eventType=function(e){var t=e.leftAp,n=e.toMac,i=e.roam,a=e.isFt;return t&&n?i?a?m.FAST_TRANSITION:m.PMK_CACHE_TRANSITION:m.TRANSITION:t?m.LEFT:m.CONNECTED}({leftAp:D.ap,toMac:a,roam:o,isFt:g}),a){var O=n.find(d,{mac:a}),N=n.find(S,{mac:a});O||N||(O={name:a}),E.to={mac:a,device:N?T:O.name,band:r?u.BAND_5:u.BAND_2,deviceType:N?p.CONTROLLER:p.MEMBER,isController:Boolean(N)},k[a]||(k[a]=y(E.to.device,C[E.to.band],w,N))}if(D.ap){var L=n.find(d,{mac:D.ap}),x=n.find(S,{mac:D.ap});L||x||(L={name:a});var R={};R.mac=D.ap,R.band=D.band?u.BAND_5:u.BAND_2,R.device=x?T:L.name,R.deviceType=x?p.CONTROLLER:p.MEMBER,R.isController=R.deviceType===p.CONTROLLER,E.from=R,P[D.ap]||(P[D.ap]=y(E.from.device,C[R.band],w,x))}return E}),hotspot:w,mwsDeviceMacs:E,segments:I,controllerDescription:T,toOptions:_(k),fromOptions:_(P)}})},resetLogRequest:function(){s.reset(),h=!1},getCsvFromLogData:function(e,t,i){var a=k.reduce(function(e,t){return Object.assign({},e,_defineProperty({},t,t))},{}),o=e.map(function(e){var a=e.timestamp,o=e.to,s=e.from,r=e.segmentId,l=e.eventType,c=n.get(t,[r,"description"],r),d=e.device,p=e.mac,u=n.get(s,"mac",""),m=n.get(s,"band",""),f=P(s,i),g=n.get(o,"mac",""),v=n.get(o,"band","");return{timestamp:a,deviceMac:p,deviceName:d,fromMac:u,fromBand:m,fromName:f,toMac:g,toName:P(o,i),toBand:v,segmentId:r,segmentName:c,eventType:l}});return r.toCsv(o,{header:a,sortByColumnName:!0})}}}e.$inject=["$q","$rootScope","_","NDM","wifiOptions","utils","router","csv","interfaces","MWSConstants","MWSRequester"],angular.module("keenetic").factory("MWSLogService",e)}(),function(){function e(e,t,n,i,a,o,s,r,l,c,d,p,u,m,f,g){var v,h=u.LOG_EVENT_TYPE,b=u.MWS_PAGE_TAB_SWITCHED_EVENT,_=u.TAB,y=(_defineProperty(v={},h.CONNECTED,"mws-device-connected"),_defineProperty(v,h.LEFT,"mws-device-left"),_defineProperty(v,h.TRANSITION,"mws-transition"),_defineProperty(v,h.PMK_CACHE_TRANSITION,"mws-pmk-cache-transition"),_defineProperty(v,h.FAST_TRANSITION,"mws-fast-transition"),v),S=this;S.segments={},S.controllerDescription="",S.isFF=c.isFirefox,S.isHandheld=c.isMobile,S.isActive=!1,S.recordHeight=c.isMobile?75:50,S.showFilters=!S.isHandheld,S.l10n={};var w=function(){S.l10n={logTableStats:"",wifiBands:p.getAllBandsL10n(!1)}};w(),t.$on("$destroy",a.$on("$translateChangeSuccess",function(){return n(w)})),t.$on("$destroy",function(){return g.resetLogRequest()});var C=function(e){return"wifi-system.log-table.columns.".concat(e)},E=function(e){return r.getTranslation("wifi-system.log-table.event-type.".concat(e))},I=function(e){return'<span class="help-text">'.concat(e,"</span>")},T=function(e,t){if(!e)return"&mdash;";var n,i="".concat((n=t.segmentId,o.get(S.segments,[n,"description"],n))," (").concat(S.l10n.wifiBands[e.band],")"),a=r.escapeHtml(e.isController?S.controllerDescription:e.device);return"".concat(a,"<br/>").concat(I(i))};S.logTable={sort:{column:"timestamp",reverse:!0,onClick:function(e){var t=S.logTable.sort;e===t.column?t.reverse=!t.reverse:t.column=e,S.logTable.data.sort(t.sortFn)},sortFn:function(e,t){var n,i=S.logTable.sort,a=i.column,o=i.reverse?-1:1;if("timestamp"===a&&(n=e.timestamp<t.timestamp),"device"===a){var s=e.device||e.mac,r=t.device||t.mac;n=s===r?e.timestamp<t.timestamp:s<r}return o*(n?-1:1)}},data:[],columns:{timestamp:{title:C("timestamp"),modify:function(e){var t=r.getDate(e).split(" ");return"".concat(t[1],"<br/>").concat(I(t[0]))},sortable:!0},device:{title:C("device"),modify:function(e,t){return e?"".concat(r.escapeHtml(e),"<br/>").concat(I(t.mac)):t.mac},sortable:!0},from:{title:C("from"),modify:T},eventTypeIcon:{title:" ",modify:function(e,t){return r.generateIconHtml(y[t.eventType],E(t.eventType))}},to:{title:C("to"),modify:T},eventType:{title:C("event-type"),modify:function(e){return'<span class="mws-log-event">\n                            <span class="mws-log-event__type">'.concat(E(e),"</span>\n                        </span>")}},resetBtn:{title:" ",modify:function(){return" "}}},noDataText:"",dataEverReceived:!1},S.logTable.sortableColumns=Object.keys(o.pickBy(S.logTable.columns,"sortable")),S.logRecords=[],S.logEventIds={},S.filterOptions={to:[],from:[],client:[],eventType:[]},S.matchingOptions={client:[],to:[],from:[],eventType:[]},S.filterValue={to:null,from:null,client:null,eventType:null,minTime:null},S.filterPath={to:"to.mac",from:"from.mac",client:"mac",eventType:"eventType"},S.onMatchFilterChange=function(e,t,n){var i=t.split("_")[1];i&&(S.filterValue[i]=e,S.matchingOptions[i]=n.map(function(e){return e.id}),S.applyLogFilters())},S.setMinTime=function(){S.filterValue.minTime=Date.now(),S.minTimeFilterL10n=r.getTranslation("wifi-system.log-table.time-filter.showing-events-newer-then",null,{time:r.getDate(S.filterValue.minTime)}),S.applyLogFilters()},S.resetMinTime=function(){S.filterValue.minTime=null,S.minTimeFilterL10n=null,S.applyLogFilters()},S.toggleMinTimeFilter=function(){S.filterValue.minTime?S.resetMinTime():S.setMinTime()},S.updateTableNoDataText=function(){var e="loading";S.logTable.dataEverReceived&&(e=S.logTable.noFilters?"wifi-system.log-table.log-is-empty":"wifi-system.log-table.no-matching-events"),S.logTable.noDataText=e},S.resetAllFilters=function(){o.forEach(S.matchingOptions,function(e,t){S.filterValue[t]=""}),S.resetMinTime(),S.l10n.logTableStats=r.getTranslation("wifi-system.log-table.showing-filtered-of-total",null,{filtered:S.logRecords.length,total:S.logRecords.length}),S.logTable.data=S.logRecords.slice(),S.logTable.noFilters=!0,S.updateTableNoDataText()},S.applyLogFilters=s(function(){var e=S.logRecords.slice(),t=!0;S.filterValue.minTime&&(t=!1,e=e.filter(function(e){return e.timestamp>S.filterValue.minTime})),o.forEach(S.matchingOptions,function(n,i){S.filterValue[i]&&(t=!1,e=e.filter(function(e){return-1!==n.indexOf(o.get(e,S.filterPath[i]))}))}),S.l10n.logTableStats=r.getTranslation("wifi-system.log-table.showing-filtered-of-total",null,{filtered:e.length,total:S.logRecords.length}),S.logTable.data=e.sort(S.logTable.sort.sortFn),S.logTable.noFilters=t,S.updateTableNoDataText()}),S.triggerWindowResize=function(){i.dispatchEvent(new Event("resize"))};var k=function(){S.isMobile=c.isMobile||c.getBrowserWidth()<768};d(k,t),k(),t.$on("$destroy",a.$on(b,function(e,t){S.isActive=t===_.LOG,S.isActive&&(a.$broadcast(l.events.PAGE_REDRAW),S.triggerWindowResize())})),S.updateLogData=function(){return S.updateTableNoDataText(),g.getTransitionsLog().then(function(e){var t=e.segments,n=e.controllerDescription,i=e.mwsDeviceMacs,a=e.logRecords.filter(function(e){return!S.logEventIds[e.id]});S.logRecords=S.logRecords.concat(a),S.segments=t,S.controllerDescription=n,o.forEach(S.logRecords,function(e){S.logEventIds[e.id]=!0});var s={};o.uniq(S.logRecords.map(function(e){return e.mac})).forEach(function(e){s[e]=!0}),S.filterOptions.to=S.filterOptions.to.concat(e.toOptions),S.filterOptions.from=S.filterOptions.from.concat(e.fromOptions),S.filterOptions.to=o.uniqBy(S.filterOptions.to,"id"),S.filterOptions.from=o.uniqBy(S.filterOptions.from,"id"),S.filterOptions.client=e.hotspot.map(function(e){return{id:e.mac,label:e.name||e.hostname||e.mac}}).filter(function(e){return!i.includes(e.id)&&s[e.id]}),S.filterOptions.eventType=o.map(u.LOG_EVENT_TYPE,function(e){return{id:e,label:E(e)}}),S.applyLogFilters(),S.logTable.dataEverReceived=!0})},S.downloadAdCsv=function(){var e=g.getCsvFromLogData(S.logTable.data,S.segments,S.controllerDescription),t=r.getDate(new Date,"__").replace("/:|./","-"),n="MWS_LOG__".concat(t,".csv");r.downloadAsFile([e],n,"text/csv")};m.requester.registerCallback(g.getLogDataRciQueries(),function(e){return o.flow(g.destructureLogDataRciQueries,g.updateAdditionalLogDataCache)(e)}),m.setSectionReady()}e.$inject=["$q","$scope","$timeout","$window","$rootScope","_","debounce","utils","CONSTANT","browserCheck","windowResizeWatcher","wifiOptions","MWSConstants","MWSRequester","MWSService","MWSLogService"],angular.module("keenetic").controller("MWSLogController",e)}(),function(){function e(e,t,n,i,a,o,s,r,l,c,d,p,u,m){var f=l.CANDIDATE_ACTIONS,g=l.MEMBER_ACTIONS,v=l.CANDIDATE_REVISITABLE_STATES,h=l.CANDIDATE_LOCKED_STATES,b=l.DEVICE_ARRAYS_PROPS,_=l.SERVICE_NAME,y=c.SHOW_IP_HOTSPOT,S=c.SHOW_RC_INTERFACE,w=c.SHOW_MWS_CANDIDATE,C=c.SHOW_MWS_MEMBER,E=c.SHOW_RC_SERVICE,I=function(e){return t.uniqBy(e,"mac")},T=function(e){var n=t.includes(h,e.state),i=t.includes(v,e.state);return n||(e.action=i?f.REVISIT:f.ACQUIRE,e.actionFn=i?function(){return function(e){var n=e.cid||e.mac||e.ip;return a.post(t.set({},"mws.revisit",{candidate:n}))}(e)}:function(){return function(e){var n=e.cid||e.mac||e.ip,i=e,o=u.LICENSE,s=u.LICENSE_IDS;return d.fixControllerPortConfiguration(e.mac).then(function(){var e=t.set({},"mws.acquire",{candidate:n});return!1===i["eula-accepted"]&&t.set(e,"mws.acquire.eula-accept",!0),!1===i["dpn-accepted"]&&o[s.DPN].textAvailable&&t.set(e,"mws.acquire.dpn-accept",!0),a.post(e)})}(e)}),e.passwordIsSet&&e.errors.unshift("wifi-system.candidate-state.INACCESSIBLE"),Object.assign({},e,{isRevisitable:i,isProcessedByMws:n,isMwsCandidate:!0})},k=function(e,n,o,s){var r,l=t.get(e,"system.memory",!1),c=t.get(e,"system.uptime",""),d=t.get(e,"system.cpuload",{}),p=!(2!==(r=(l||"").split("/")).length||!t.every(r,function(e){return!isNaN(parseInt(e,10))}))&&i.round(100*(r[0]-0)/(r[1]-0),0),u=i.getSplittedTime(c),m=t.get(s,"speed"),f=g.RELEASE,v=t.chain(e.capabilities).pickBy(function(e,n){return!e&&t.get(o,[n,"length"],0)>0}).keys().value();return e.errors=[].concat(_toConsumableArray(e.errors||[]),_toConsumableArray(v.map(function(e){return"wifi-system.device-errors.no-".concat(e)}))),Object.assign({},e,{isMwsMember:!0,cpuLoad:d,memLoad:p,uptime:u,clients:n,action:f,actionFn:function(){return n=e.cid,a.post(t.set({},"mws.member",{member:n,no:!0}));var n},speed:m})},P=function(e,n){if(n){e.ip=e.ip||n.ip,e.hasIp=0!==s.ip2num(e.ip),e.name=n.nameToShow,e.nameModel=e.name,e.passwordIsSet="5243089"===t.get(e.rci,"status.0.code"),e.passwordIsSet&&delete e.rci.status[0],e.errors=e.rci?t.map(a.getNdmResponseErrors(e.rci),"message"):[];var o=n.active?"indicator-online":"indicator-offline",r=n.active?"wifi-system.devices-table.indicator.online":"wifi-system.devices-table.indicator.offline";e.indicator={icon:o,text:i.getTranslation(r)}}var l=function(e){return t.trim(e.replace(/keenetic/i,""))}(e.model||""),c=Boolean(!n||!n.active);return Object.assign({},e,{model:l,isOffline:c})},A=function(e,n){return t.chain(e).pickBy(function(e,i){return t.some(e,function(e){return n(e,i)})}).keys().value()};return{getDeviceDataRciQueries:function(){return i.toRciQueryList([E,c.getShowIpHotspotQuery(),C,w,S])},destructureDeviceDataRciResponses:function(e){return{showRcService:t.get(e,"0.".concat(E),{}),showIpHotspotHost:t.get(e,"1.".concat(y,".host"),[]),showMwsMember:t.toArray(t.get(e,"2.".concat(C),[])),showMwsCandidate:t.toArray(t.get(e,"3.".concat(w),[])),showRcInterface:t.get(e,"4.".concat(S),{})}},processDeviceDataRciResponses:function(e){var n,a=e.showRcService,s=e.showIpHotspotHost,r=e.showMwsMember,l=e.showMwsCandidate,c=e.showRcInterface,d=Boolean(t.get(a,_)),u=s,f=u.filter(function(e){return e.registered}),g=i.getObjectFromArray("name","mac",f),v=r,h=l,y=t.reduce(v,function(e,t){return Object.assign({},e,_defineProperty({},t.cid,[]))},{});u=u.map(function(e){return Object.assign({},e,{nameToShow:e.name||e.hostname||e.mac})});var S=t.reduce(u,function(e,t){return Object.assign({},e,_defineProperty({},t.mac,t))},{}),w=u.filter(function(e){return e.mws});y=w.reduce(function(e,n){var i=t.get(n,"mws.cid","");return e[i]&&e[i].push(n),e},y);var C=t.mapValues(function(e){return t.chain(e).pickBy("iseg").mapValues("iseg").mapValues(function(t){return o.getSegmentAccessPoints({iseg:t}).reduce(function(t,n){return Object.assign({},t,_defineProperty({},n,e[n]))},{})}).value()}(c),function(e){return t.mapValues(e,m.getSecurityProtocolOption)}),E={wpa3:A(C,p.isAnyWpa3),owe:A(C,p.isOwe),"wpa-eap":A(C,p.isAnyWpaEap)};return h=I(h.map(function(e){return P(e,S[e.mac])}).map(T)),v=I(v.map(function(e){return P(e,S[e.mac])}).map(function(e){return k(e,y[e.cid],E,S[e.mac])})),_defineProperty(n={isEnabled:d},b.CANDIDATES,h),_defineProperty(n,b.MEMBERS,v),_defineProperty(n,"hostByMwsCid",y),_defineProperty(n,"registeredNames",g),n},renameMwsDevice:r.registerHost}}e.$inject=["$q","_","NDM","utils","router","interfaces","ipV4Service","portForwarding","MWSConstants","MWSRequester","MWSSegmentsService","wifiOptions","licensesService","wifiSettingsService"],angular.module("keenetic").factory("MWSExtendersService",e)}(),function(){function e(e,t,n,i,a,o,s,r,l,c,d,p,u,m,f,g,v){var h=p.DEVICE_ARRAYS_PROPS,b=p.CANDIDATE_STATE,_=p.CANDIDATE_ACTIONS,y=p.MEMBER_ACTIONS,S=p.MWS_PAGE_TAB_SWITCHED_EVENT,w=p.TAB,C=v.WIFI_BAND_2_GHZ,E=v.WIFI_BAND_5_GHZ,I=a.values(o.SYSMODE),T=this;T.isReady=!1,T.isEmpty=!0;var k=function(){T.l10n={controllerLabel:r.getTranslation("wifi-system.log-table.mws-controller-label"),mode:{},memberAction:{},candidateState:{},candidateAction:{},candidateActionError:{},renameHint:r.getTranslation("wifi-system.devices-table.hint.rename")},I.forEach(function(e){T.l10n.mode[e]=r.getTranslation("system.sysmode.".concat(e))}),a.forEach(b,function(e){T.l10n.candidateState[e]=r.getTranslation("wifi-system.candidate-state.".concat(e))}),a.forEach(_,function(e){T.l10n.candidateAction[e]=e?r.getTranslation("wifi-system.candidate-action.".concat(e)):"",T.l10n.candidateActionError[e]=e?r.getTranslation("wifi-system.candidate-action-error.".concat(e)):""}),a.forEach(y,function(e){T.l10n.memberAction[e]=e?r.getTranslation("wifi-system.member-action.".concat(e)):""})};k(),t.$on("$destroy",n.$on("$translateChangeSuccess",function(){return i(k)}));var P=function(){"$apply"!==t.$root.$$phase&&"$digest"!==t.$root.$$phase&&t.$apply()};T.rowHint="",T.removeRowHint=function(){T.rowHint=""},T.setRowHint=function(){T.rowHint=T.l10n.renameHint},T.changeRowHint=function(e){T.rowHint=r.getTranslation("wifi-system.devices-table.hint.".concat(e.toLowerCase()))},T.columnNames=["name","model","os-version","clients-online","uptime","connection",""],T.stopEventPropagation=function(e){return e.stopPropagation()},a.forEach(h,function(e){T[e]=[]}),T.locks={_memberLocks:{},_candidateLocks:{},_getStore:function(e){return e?T.locks._memberLocks:T.locks._candidateLocks},lock:function(e,t,n){var a=T.locks._getStore(n);a[e]=t,i(function(){a[e]=!1},1e4)},unlock:function(e,t){T.locks._getStore(t)[e]=!1},isLocked:function(e,t){return Boolean(T.locks._getStore(t)[e])},getClassName:function(e,t){var n=T.locks._getStore(t);return n[e]?"action--".concat(n[e]):""}};var A=function(e){T.registeredNames=e.registeredNames,T.tableIsVisible=a.some(h,function(t){return e[t].length>0}),a.forEach(h,function(t){var n=T[t],s=angular.copy(e[t]),l={};s.forEach(function(t){var s=a.find(n,{mac:t.mac});l[t.mac]=!0,s?(t.isRemoved=!1,t.nameModel=t.nameModel===t.mac?s.nameModel:t.nameModel,t.isUiLocked=T.locks.isLocked(t.mac,t.isMwsMember),t.className=T.locks.getClassName(t.mac,t.isMwsMember)):(t.isNew=!0,i(function(){t.isNew=!1},1e3));var c="&mdash;";if(t.uptime){var d=t.uptime.split(/\s+/g);c=d.length>2?"".concat([d[0],d[1]].join(" "),"<br/>").concat(d[2]):t.uptime}t.uptimeHtml=c,t.connectedVia="";var p,u=a.get(t,"backhaul.bridge","");if(u){var v=e.membersData,h=u.startsWith("8")?m.getSharedData("controllerName"):D(u,v);t.connectedVia=r.getTranslation("wifi-system.connected-via-mws-member",null,{mwsMember:h})}if(t.connectionInfoHtml=(p=a.get(t,"backhaul",{}),a.has(p,"ap")?(p.wifiRange=p.ap.includes(g.MASTER_5G)?E:C,r.wifi.formatConnectionData(a.omit(p,["security"]))):p.speed?p.speed+" "+r.format.getSpeedUnit(o.UNIT_SCALE.MEGA):""),t.clientsList=(t.clients||[]).map(function(e){return{name:e.nameToShow,mac:e.mac}}),t.action){t.actionLabel=t.isMwsMember?T.l10n.memberAction[t.action]:T.l10n.candidateAction[t.action];var b=t.actionFn,_=function(){return t.isUiLocked=!0,T.locks.lock(t.mac,t.action,t.isMwsMember),t.className=T.locks.getClassName(t.mac,t.isMwsMember),P(),b()};t.actionFn=function(){return t.action===y.ACQUIRE?f.checkMwsCandidateLicenses(t).then(function(){return _()}):_()}}});var c=T[t].filter(function(e){return!l[e.mac]}).map(function(e){return e.isRemoved=!0,i(function(){var n=a.findIndex(T[t],{mac:e.mac});e.isRemoved=!1,-1!==n&&T[t].splice(n,1)},1e3),e});T[t]=a.orderBy(c.concat(s),"name")}),T.isReady=!0,T.isEmpty=T.membersData.length+T.candidatesData.length===0},D=function(e,t){var n=e.slice(5,e.length),i=a.find(t,function(e){return e.mac===n});return a.get(i,"name","")};T.openRenamePopup=function(e){T.renameDeviceController||(T.renameDeviceController=m.getSharedData("renameDevice"));var t=e.mac;T.renameDeviceController.open(e,T.registeredNames,function(n){return u.renameMwsDevice(t,n).then(function(){var t=e.isMwsCandidate?h.CANDIDATES:h.MEMBERS,i=a.find(T[t],{mac:e.mac});i&&(i.name=n,i.nameModel=n)}).then(P)})},t.$on("$destroy",n.$on(S,function(e,t){T.isActive=t===w.DEVICES,T.isActive?T.setRowHint():T.removeRowHint()}));d.requester.registerCallback(u.getDeviceDataRciQueries(),function(e){return a.flow(u.destructureDeviceDataRciResponses,u.processDeviceDataRciResponses,A)(e)}),d.setSectionReady()}e.$inject=["$q","$scope","$rootScope","$timeout","_","CONSTANT","notification","utils","ValidatorManager","MWSService","MWSRequester","MWSConstants","MWSExtendersService","MWSSharedService","licensesService","NDM","wifiOptions"],angular.module("keenetic").controller("MWSExtendersController",e)}(),function(){function e(e,t,n,i,a,o,s,r){var l=s.SHOW_IP_HOTSPOT,c=s.SHOW_MWS_MEMBER,d=s.SHOW_SYSTEM,p=s.SHOW_VERSION;return{getControllerDataRciQueries:function(){return n.toRciQueryList([s.getShowIpHotspotQuery(),c,p,d])},destructureControllerDataRciResponses:function(t){return{showIpHotspotHost:e.get(t,"0.".concat(l,".host"),[]),showMwsMember:e.toArray(e.get(t,"1.".concat(c),[])),showVersion:e.get(t,"2.".concat(p),{}),showSystem:e.get(t,"3.".concat(d),{})}},processControllerDataRciResponses:function(t){var i,a,o,s,l=t.showIpHotspotHost,c=t.showMwsMember,d=t.showVersion,p=t.showSystem,u=(i=l,a=c,o=e.map(a,"mac"),e.chain(i).uniqBy("mac").filter(function(e){return e.active}).filter(function(e){return!e.mws}).filter(function(t){return!e.includes(o,t.mac)}).value()),m=u.length,f=c.length>0,g="zyxel"===(s=d).vendor.toLowerCase()?e.trim(s.device.replace(/keenetic/i,"")):s.model,v=function(e){return e.replace(/ \(KN.+/,"")}(g),h=n.getSplittedTime(p.uptime),b=d.description,_=n.getFirmwareVersionTitle(d);return r.setSharedData("controllerName",b),{name:b,os:_,clientsCount:m,clients:u,mwsHasConfiguredMembers:f,model:g,modelName:v,uptime:h}},renameMwsController:function(t){return i.postAndSave(e.set({},"system.description",t))}}}e.$inject=["_","NDM","utils","router","interfaces","MWSConstants","MWSRequester","MWSSharedService"],angular.module("keenetic").factory("MWSControllerService",e)}(),function(){function e(e,t,n,i,a,o,s,r,l,c,d,p,u){var m=this;m.isReady=!1,m.view={},m.params={},m.isWizardAvailable=c.isWizardAvailable(),m.hintEnabled=!1;var f=u.localeFactory({title:"wifi-system.controller.title",descriptionWithWizard:"wifi-system.controller.description-with-wizard",descriptionNoWizard:"wifi-system.controller.description-no-wizard",model:"wifi-system.controller.model",os:"wifi-system.controller.os",clients:"wifi-system.controller.clients",uptime:"wifi-system.controller.uptime",addText:"wifi-system.controller.add",buttonAdd:"wifi-system.controller.button.add",buttonRename:"wifi-system.controller.button.rename",hintTitle:"wifi-system.controller.hint-header"}),g=function(){m.view=f(),m.view.description=m.isWizardAvailable?m.view.descriptionWithWizard:m.view.descriptionNoWizard};m.showHint=function(){m.hintEnabled=!0},m.hideHint=function(){m.hintEnabled=!1},m.changeControllerName=function(){m.renameDeviceController||(m.renameDeviceController=p.getSharedData("renameDevice"));var e=s.get(m,"params.name",""),t=Object.assign({},m.params,{isMwsController:!0,nameModel:e});m.renameDeviceController.open(t,m.registeredNames,function(e){return d.renameMwsController(e).then(function(){m.params.name=e}).then(l.requester.poll)})},m.openWizard=function(){return c.openWizard()},l.requester.registerCallback(d.getControllerDataRciQueries(),function(e){return s.flow(d.destructureControllerDataRciResponses,d.processControllerDataRciResponses,function(e){m.params=e,g(),m.isReady=!0})(e)}),l.setSectionReady(),t.$on("$destroy",n.$on("$translateChangeSuccess",function(){return i(g)}))}e.$inject=["$q","$scope","$rootScope","$timeout","$translate","$interval","_","modalFactory","MWSRequester","MWSService","MWSControllerService","MWSSharedService","utils"],angular.module("keenetic").controller("MWSControllerController",e)}(),function(){function e(e,t,n,i){var a=this,o=localStorage.getItem("TRAFFIC_MONITOR_USE_KEENETIC_TIMEZONE");a.shiftOnLastResponse=0,a.timeShift=0,a.isFirstPoll=!0,a.timeShiftIsBigEnough=!1,a.timeShiftIsTooBig=!1,a.isKeeneticTimezoneUsed=!!o&&JSON.parse(o),a.poll=function(){return t.getKeeneticTime().then(function(e){var t=Date.now();a.shiftOnLastResponse=Math.round((t-e)/1e3),a.timeShiftIsBigEnough=Math.abs(a.shiftOnLastResponse)>3600,a.timeShiftIsTooBig=Math.abs(a.shiftOnLastResponse)>86400,a.isFirstPoll&&(a.isFirstPoll=!1,a.toggle(a.timeShiftIsBigEnough&&a.isKeeneticTimezoneUsed))})},a.toggle=function(t){a.timeShift=t?a.shiftOnLastResponse:0,n.setState({timeShift:a.timeShift}),localStorage.setItem("TRAFFIC_MONITOR_USE_KEENETIC_TIMEZONE",JSON.stringify(t)),e.$emit(i.RECALCULATE_BAR_CHART_LABELS)}}e.$inject=["$scope","keeneticTime","trafficMonitorSharedState","trafficMonitorEvents"],angular.module("keenetic").controller("TrafficMonitorTimezoneController",e)}(),function(){function e(e,t,n,i,a,o,s,r,l,c,d){var p=this,u=c.START_POLLING,m=c.STOP_POLLING,f=c.CHART_LEGEND_SELECT_HOST,g=c.CHART_LEGEND_RESET_SELECTED_HOST,v=c.REFRESH_BAR_CHART,h=c.HIDE_DEVICES_LIST,b=c.NEW_TAB_ADDED,_=c.ADD_HOST_TAB,y=c.SET_ACTIVE_TAB_TO_TOP_5,S=c.DISABLE_BAR_CHART,w=c.UPDATE_L10N,C=c.ACTIVE_TAB_SWITCHED,E=c.SET_ACTIVE_TAB_BY_MAC,I=c.CONFIRM_NEW_TAB_DEVICE_CHOICE,T=t.$parent.vm;p.parentController=T,p.array=[],p.isReady=!1,p.hash="",p.activeTabHost=!1,p.newTabId=Date.now(),p.activeTabId=0,p.getDefaultTabsArray=function(){return[{id:0,mac:!1,name:r.getTranslation("traffic-monitor.tabs.top-devices")}]},p.getLocalStorageKey=function(){return"".concat("TRAFFIC_MONITOR_TABS","_").concat(p.hash)},p.updateLocalStorageTabsData=function(){var e=p.getLocalStorageKey(),t=p.array.filter(function(e){return!e.isNew}).map(function(e){return o.omit(e,"$$hashKey")});localStorage.setItem(e,JSON.stringify(t))},p.getInitialTabsConfiguration=function(){var e=p.getLocalStorageKey(),t=localStorage.getItem(e);return t?JSON.parse(t):p.getDefaultTabsArray()},p.init=function(){return a.all([l.getRegisteredHosts(),l.getUniqueHashForKeenetic()]).then(function(n){var a=_slicedToArray(n,2),r=a[0],l=a[1],c=o.union(o.map(r,"mac"),["multicast","unregistered"]);p.hash=l,p.array=p.getInitialTabsConfiguration().filter(function(e){var t=e.mac;return!1===t||o.includes(c,t)});var m=o.find(p.array,"isActive");k(),p.isReady=!0,o.get(m,"mac")&&(p.activeTabHost={name:m.name,mac:m.mac,type:m.type}),d.setState({activeTabHost:p.getActiveTabHost()}),i(function(){e.$broadcast(s.events.TABS_SELECT_TAB,m.name,!0)}),t.$emit(u)})},p.isActiveTabNew=function(){return Boolean(p.getActiveTab().isNew)},p.getActiveTab=function(){return p.getTabById(p.activeTabId)},p.getTabById=function(e){return o.find(p.array,{id:e})||{}},p.addTab=function(){p.newTabId=Date.now();var e={id:p.newTabId,isNew:!0,mac:!1,isRemovable:!0,name:r.getTranslation("traffic-monitor.tabs.choose-new-device")};return a.when(e).then(function(){return T.$relay(b),t.$emit(S),t.$emit(w),e})},p.removeTab=function(e){var n=p.array[e],i=e===p.array.length-1?e-1:e;n.isNew&&T.$relay(h),p.array.splice(e,1),p.array=o.clone(p.array),n.isActive&&t.$emit(g,i),p.updateLocalStorageTabsData()},p.setActiveTab=function(e,i){var a=p.getActiveTab();t.$emit(v),T.ui.lock(),i.isNew||T.ui.setIsLoading(),a.isNew&&p.removeTab(o.findIndex(p.array,{id:a.id})),p.activeTabHost=!1,p.activeTabId=i.id,i.mac?(t.$emit(f,i.mac),p.activeTabHost={name:i.name,mac:i.mac,type:i.type}):i.isNew||t.$emit(g,i.mac),p.array.forEach(function(e){e.isActive=p.activeTabId===e.id}),n.go(".",{tab:i.name}),i.isNew&&t.$emit(m),p.updateLocalStorageTabsData(),d.setState({isActiveTabNew:p.isActiveTabNew(),activeTabHost:p.getActiveTabHost()}),t.$emit(C,i)},p.getActiveTabHost=function(){return p.activeTabHost},p.hasHostTab=function(e){return p.array.some(function(t){return t.mac===e.mac})},t.$on(_,function(e,t){var n=t.mac,i=t.name,a=t.type,o={id:p.newTabId,mac:n,type:a,isRemovable:!0,isNew:!1,name:i,label:i};p.array=[].concat(_toConsumableArray(p.array),[o])}),t.$on(y,function(){n.go(".",{tab:p.array[0].name})}),t.$on(E,function(e,t){var n=o.findIndex(p.array,{mac:t});-1!==n&&p.setActiveTab(n,p.array[n])}),t.$on(I,function(e,t){var n=t.mac,i=t.name,a=t.type,o=p.array.length-1,s=p.array[o];s.name=i,s.label=i,s.mac=n,s.type=a,s.isNew=!1,s.isRemovable=!0,p.setActiveTab(o,s)}),t.$watch(function(){if(!p.isReady)return JSON.stringify([]);var e=p.array.map(function(e){return e.mac}).filter(o.identity);return JSON.stringify(e)},function(e){d.setState({trackedMacs:JSON.parse(e)})}),T.tabs=p,p.init();var k=function(){var e=o.get(p.array,"[0]"),t=o.find(p.array,{isNew:!0}),i=o.filter(p.array,function(e){return e.type});o.set(e,"name",r.getTranslation("traffic-monitor.tabs.top-devices")),o.set(t,"name",r.getTranslation("traffic-monitor.tabs.choose-new-device")),i.forEach(function(e){e.name=r.getTranslation("traffic-monitor.others.".concat(e.type))});var a=o.get(p.getActiveTab(),"name","");n.go(".",{tab:a}),p.updateLocalStorageTabsData()};t.$on("$destroy",e.$on("$translateChangeSuccess",function(){return k()}))}e.$inject=["$rootScope","$scope","$state","$timeout","$q","_","CONSTANT","utils","trafficMonitorService","trafficMonitorEvents","trafficMonitorSharedState"],angular.module("keenetic").controller("TrafficMonitorTabsController",e)}(),function(){function e(e,t,n){var i=n.SHARED_STATE_UPDATED,a={trackedMacs:[],timeShift:0,hostSelectedInLegend:!1,activeTabHost:!1,isActiveTabNew:!1,isDeviceListVisible:!1};return{getByKey:function(t,n){return e.get(a,t,n)},setState:function(n){a=Object.assign({},a,{},e.cloneDeep(n)),t.$broadcast(i)},getState:function(){return a},subscribeOnUpdates:function(e,n){var o=t.$on(i,function(){return n(a)});e.$on("$destroy",o)}}}e.$inject=["_","$rootScope","trafficMonitorEvents"],angular.module("keenetic").factory("trafficMonitorSharedState",e)}(),angular.module("keenetic").factory("trafficMonitorService",["$q","_","utils","router","CONSTANT",function(e,t,n,i,a){return new(function(){function o(){var e;_classCallCheck(this,o),this.RRD={SCALE:{THREE_MINUTES:0,ONE_HOUR:1,THREE_HOURS:2,ONE_DAY:3},TICKS:64},this.RRD.DT=(_defineProperty(e={},this.RRD.SCALE.THREE_MINUTES,3),_defineProperty(e,this.RRD.SCALE.ONE_HOUR,60),_defineProperty(e,this.RRD.SCALE.THREE_HOURS,180),_defineProperty(e,this.RRD.SCALE.ONE_DAY,1440),e),this.TRAFFIC_PROPS=["rxbytes","txbytes"],this.knownHosts=[]}return _createClass(o,[{key:"getHotspotQuery",value:function(){return t.set({},"show.ip.hotspot",{details:a.HOTSPOT_DETAILS.NONE})}},{key:"getHotspotHosts",value:function(){return i.cached(this.getHotspotQuery()).then(function(e){return t.get(e,"host",[])})}},{key:"getRegisteredHosts",value:function(){return this.getHotspotHosts().then(function(e){return e.filter(function(e){return e.registered})})}},{key:"getNotRegisteredHosts",value:function(){return this.getHotspotHosts().then(function(e){return e.filter(function(e){return!e.registered})})}},{key:"getUniqueHashForKeenetic",value:function(){return i.get("show/identification").then(function(e){return n.getStringHash(t.get(e,"cid",""))})}},{key:"getTopTrafficConsumersHosts",value:function(e){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.RRD.SCALE.ONE_HOUR;return i.post({url:"",data:[this.getHotspotQuery(),t.set({},"show.ip.hotspot.summary",{attribute:"sumbytes",count:2*e,detail:a})]}).then(function(i){var a=t.get(i,"[0].".concat("show.ip.hotspot",".host"),[]);return t.chain(i).get("[1].".concat("show.ip.hotspot.summary",".host"),[]).uniqBy(function(e){return e.type||e.name}).slice(0,e).value().map(function(e){return e.type?{name:n.getTranslation("traffic-monitor.others."+e.type),type:e.type,mac:"",sum:e.sumbytes}:{name:e.name,type:e.type,mac:t.find(a,{name:e.name},{}).mac,sum:e.sumbytes}}).sort(function(e,t){return t.sum-e.sum}).slice(0,e)})}},{key:"getTopDevicesOrOneHostData",value:function(n,i,a){var o=this,s=function(i){return i.length?o.getGraphData(i,n).then(function(e){return{hosts:i.map(function(n){return n.mac=n.mac||n.type,n.graph=e.data[n.mac],n.rxbytes=t.sumBy(n.graph,function(e){return e[0]}),n.txbytes=t.sumBy(n.graph,function(e){return e[1]}),n.sum=n.rxbytes+n.txbytes,n})}}):e.when({hosts:[]})};return a?s([a]):this.getTopTrafficConsumersHosts(i,n).then(s)}},{key:"getGraphData",value:function(){var e=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return i.post({url:"",data:t.set({},"show.ip.hotspot",n.map(function(t){var n=Boolean(t.type)?_defineProperty({},t.type,!0):{mac:t.mac};return Object.assign({rrd:e.TRAFFIC_PROPS.map(function(e){return{attribute:e,detail:a}})},n)}))}).then(function(i){return{data:n.reduce(function(n,a,o){var s=t.get(i,"".concat("show.ip.hotspot",".").concat(o,".rrd"),[]),r=e.TRAFFIC_PROPS.map(function(e,n){var i=t.get(s,"".concat(n,".data"),[]);return t.values(i)});return n[a.mac||a.type]=t.times(e.RRD.TICKS,function(n){return e.TRAFFIC_PROPS.map(function(e,i){return t.get(r,[i,n,"v"],0)})}),n},{})}})}}]),o}())}]),function(){function e(e,t){var n,i=t.RRD,a=i.SCALE.THREE_MINUTES,o={ticksLimit:i.TICKS,timeLabelFirstAt:2,timeLabelStep:10,pollingInterval:15e3},s=function(t){return e.extend({},o,t||{})},r=(_defineProperty(n={},i.SCALE.THREE_MINUTES,s({label:"traffic-monitor.scale.3-min",timeRound:30,tickInterval:i.DT[i.SCALE.THREE_MINUTES],pollingInterval:3e3})),_defineProperty(n,i.SCALE.ONE_HOUR,s({label:"traffic-monitor.scale.1-hour",timeRound:60,tickInterval:i.DT[i.SCALE.ONE_HOUR],timeLabelStep:15})),_defineProperty(n,i.SCALE.THREE_HOURS,s({label:"traffic-monitor.scale.3-hours",timeRound:300,tickInterval:i.DT[i.SCALE.THREE_HOURS]})),_defineProperty(n,i.SCALE.ONE_DAY,s({label:"traffic-monitor.scale.1-day",timeRound:600,tickInterval:i.DT[i.SCALE.ONE_DAY]})),n),l=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=new Date;return e?3600*t.getHours()+60*t.getMinutes():3600*t.getHours()+60*t.getMinutes()+t.getSeconds()},c=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=(e%86400/3600|0).toString().padStart(2,"0"),i=(e%3600/60|0).toString().padStart(3,":0"),a=t?"":(e%60).toString().padStart(3,":0");return"".concat(n).concat(i).concat(a)};return{SCALES:r,SCALE_DEFAULTS:o,DEFAULT_SCALE:a,SECONDS_IN_DAY:86400,SECONDS_IN_HOUR:3600,SECONDS_IN_MINUTE:60,getLabels:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n={},i=e.timeLabelStep,a=e.timeRound%60==0,o=l(),s=o-o%e.timeRound,r=!1,d=e.ticksLimit,p=e.ticksLimit;p>=0;p--){var u=o-Math.round((e.ticksLimit-p)*e.tickInterval)-s;(!1===r||u>0&&r>u)&&(r=u,d=p)}for(var m=d;m>=0;m-=i){var f=o-Math.round((e.ticksLimit-m)*e.tickInterval),g=(86400+(f-=f%e.timeRound)-t)%86400;n[m]=c(g,a)}return n},getSecondsOfDay:l,secondsToTimeString:c,getTimeLabelForColumn:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=r[t],o=l(t!==i.SCALE.THREE_MINUTES);return o-=Math.round((a.ticksLimit-e)*a.tickInterval),c(o=(o+86400-n)%86400)}}}e.$inject=["_","trafficMonitorService"],angular.module("keenetic").factory("trafficMonitorLabels",e)}(),angular.module("keenetic").factory("TrafficMonitorPollingHelper",["$timeout",function(e){return function(){function t(e,n){var i=this,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3e3;_classCallCheck(this,t),this.pollingFn=e,this.interval=Math.round(a),this.timerId=!1,this.lastTimeStamp=0,n.$on("$destroy",function(){return i.stop()})}return _createClass(t,[{key:"start",value:function(){this.poll(0)}},{key:"poll",value:function(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(e.cancel(this.timerId),this.lastTimeStamp===n)return this.lastTimeStamp=Date.now(),n=this.lastTimeStamp,this.pollingFn().then(function(){var i=Date.now()-n,a=t.interval-i;t.timerId=e(function(){return t.poll(t.lastTimeStamp)},Math.max(0,a))})}},{key:"stop",value:function(){this.lastTimeStamp=0,e.cancel(this.timerId)}}]),t}()}]),function(){function e(e,t,n,i,a){var o=this,s=t[0].children[0],r=new n(s,"ndm-bar-chart",e);o.options=r.options,e.$watch("vm.labels",function(e){r.labels=e}),e.$watch("vm.columns",function(e){r.columns=e}),e.$watch("vm.minVelocity",function(e){r.minVelocity=e}),e.$watch("vm.data",function(e){r.data=e}),e.$watch("vm.styles",function(e){r.styles=e}),e.$watch("vm.selectedIdx",function(e){r.selectedIdx=e}),e.$watch("vm.isLocked",function(e){r.isLocked=Boolean(e)}),e.$watch("vm.isLoading",function(e){r.isLoading=Boolean(e)}),r.onBarClick=function(e,t){a.isFunction(o.onBarClick)&&i(function(){return o.onBarClick(e,t)})},r.onBarDoubleClick=function(e,t){a.isFunction(o.onBarDoubleClick)&&i(function(){return o.onBarDoubleClick(e,t)})},r.onMouseOverColumn=function(e){a.isFunction(o.onMouseOverColumn)&&i(function(){return o.onMouseOverColumn(e)})},e.$watch(function(){return s.clientWidth^s.clientHeight},function(){return r.redraw(o.onResize)})}e.$inject=["$scope","$element","BarChart","$timeout","_"],angular.module("keenetic").component("ndmBarChart",{templateUrl:"app/page/controlPanel/myNetwork/trafficMonitor/ndm-bar-chart/ndm-bar-chart.html",restrict:"E",replace:!0,controllerAs:"vm",controller:e,bindings:{labels:"<?",columns:"<?",minVelocity:"<?",data:"<?",isLocked:"<?",isLoading:"<?",styles:"<?",selectedIdx:"<?",onBarClick:"=?",onBarDoubleClick:"=?",onMouseOverColumn:"=?",onResize:"<?"}})}(),angular.module("keenetic").factory("barChartColors",function(){return new(function(){function e(){_classCallCheck(this,e),this.STAR_EDGES=13,this.STAR_ROTATION=4}return _createClass(e,[{key:"getStarEdgeDegree",value:function(e,t,n){return((180+360/t)*e+n)%360}},{key:"getHueForIdx",value:function(e){return this.getStarEdgeDegree(e+1,this.STAR_EDGES,this.STAR_ROTATION)}},{key:"getHex",value:function(e){var t=e/(this.STAR_EDGES/2)|0,n=this.getHueForIdx(Math.round(e)),i=85-5*t,a=50+15*t;return this.hslToHex(n,i,a)}},{key:"hslToHex",value:function(e,t,n){var i,a,o;if(e/=360,n/=100,0==(t/=100))i=n,a=n,o=n;else{var s=function(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+(t-e)*(2/3-n)*6:e},r=n<.5?n*(1+t):n+t-n*t,l=2*n-r;i=s(l,r,e+1/3),a=s(l,r,e),o=s(l,r,e-1/3)}var c=function(e){var t=Math.round(255*e).toString(16);return 1===t.length?"0"+t:t};return"#".concat(c(i)).concat(c(a)).concat(c(o))}}]),e}())}),angular.module("keenetic").factory("BarChartUi",["_",function(e){return function(){function t(e){var n=this;_classCallCheck(this,t),this.parent=e,this.objs={bars:{},columns:{},uplBars:{}},this.EVENT={OVER:1,OUT:2,CLICK:3,DOUBLE_CLICK:4},this.currentColumn=!1,this.lastBar={x:-1,y:-1},this.parent.svg.onmouseout=function(){n.handleEvent(n.EVENT.OUT,-1,-1)},this.parent.svg.ondblclick=function(){n.handleEvent(n.EVENT.DOUBLE_CLICK,n.lastBar.x,n.lastBar.y)},this.parent.svg.onmousedown=function(){n.handleEvent(n.EVENT.CLICK,n.lastBar.x,n.lastBar.y)}}return _createClass(t,[{key:"handleBar",value:function(e,t,n){this.objs.bars[t]=this.objs.bars[t]||{},this.objs.bars[t][n]=e,this.observeElement(e.element,t,n)}},{key:"handleUploadBar",value:function(e,t,n){this.objs.uplBars[t]=this.objs.uplBars[t]||{},this.objs.uplBars[t][n]=e,this.observeElement(e.element,t,n)}},{key:"handleColumn",value:function(e,t){this.objs.columns[t]=e,this.observeElement(e.element,t)}},{key:"observeElement",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;e.onmouseover=function(){return t.handleEvent(t.EVENT.OVER,n,i)},e.onmouseout=function(){return t.handleEvent(t.EVENT.OUT,n,i)}}},{key:"handleEvent",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;if(~t&&~n)switch(e){case this.EVENT.OVER:this.lastBar={x:t,y:n},this.overColumn(t),this.objs.bars[t][n].addClass(this.parent.renderer.bemPrefix("bar--selected"));break;case this.EVENT.OUT:this.lastBar={x:-1,y:-1},this.overColumn(!1),this.objs.bars[t][n].removeClass(this.parent.renderer.bemPrefix("bar--selected"));break;case this.EVENT.CLICK:this.parent.onBarClick(t,n);break;case this.EVENT.DOUBLE_CLICK:this.parent.onBarDoubleClick(t,n)}else if(~t&&!~n)switch(e){case this.EVENT.OVER:this.overColumn(t);break;case this.EVENT.OUT:this.overColumn(!1)}else switch(e){case this.EVENT.OUT:this.overColumn(!1)}}},{key:"overColumn",value:function(t){var n=this;t!==this.currentColumn&&(this.currentColumn=t,this.parent.onMouseOverColumn(t),e.forEach(this.objs.columns,function(e,i){t===Number(i)?e.addClass(n.parent.renderer.bemPrefix("column--selected")):e.removeClass(n.parent.renderer.bemPrefix("column--selected"))}))}}]),t}()}]),angular.module("keenetic").factory("BarChartSvgObj",["$document","_",function(e,t){return function(){function n(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"rect";_classCallCheck(this,n),this.element=e[0].createElementNS("http://www.w3.org/2000/svg",t)}return _createClass(n,[{key:"cssClassNameProcess",value:function(e){return e?t.filter(e.split(" "),function(e){return e}):[]}},{key:"setAttr",value:function(e,n){return"style"===e&&t.isObject(n)?this.setStyles(n):"class"===e?this.addClass(n):this.element.setAttributeNS(null,e,n),this}},{key:"setAttrs",value:function(e){var n=this;return t.forEach(e,function(e,t){return n.setAttr(t,e)}),this}},{key:"setStyle",value:function(e,t){return this.element.style[e]=t,this}},{key:"setStyles",value:function(e){var n=this;return t.forEach(e,function(e,t){return n.setStyle(t,e)}),this}},{key:"addClass",value:function(e){var n=this;return t.forEach(this.cssClassNameProcess(e),function(e){return n.classControl(n.element,e,!0)}),this}},{key:"removeClass",value:function(e){var n=this;return t.forEach(this.cssClassNameProcess(e),function(e){return n.classControl(n.element,e,!1)}),this}},{key:"classControl",value:function(e,t,n){var i=e.getAttribute("class")||"";n?e.setAttribute("class",i+" "+t):e.setAttribute("class",i.replace(t," "))}},{key:"visible",value:function(e){return this.setAttr("visibility",e?"inherit":"hidden")}},{key:"show",value:function(){return this.visible(!0)}},{key:"hide",value:function(){return this.visible(!1)}},{key:"appendTo",value:function(e){return e.appendChild(this.element),this}},{key:"destroy",value:function(){this.element.parentNode.removeChild(this.element)}},{key:"bringToFront",value:function(){return this.element.parentNode.appendChild(this.element),this}}]),n}()}]),angular.module("keenetic").factory("BarChartRenderer",["$rootScope","BarChartSvgObj","trafficMonitorEvents","_","utils",function(e,t,n,i,a){return function(){function o(t,i){var a=this;_classCallCheck(this,o),this.parent=t,this.objs={bars:[],g:void 0,lines:[],vLabels:[],hLabels:[],columns:[],bg:void 0},this.velocity=this.parent.params.minVelocity,this.offset=this.parent.STYLE.offset,this.redrawUnsubscriber=e.$on(n.REDRAW_BAR_CHART_TIME_LABELS,function(){return a.redrawTimeLabels()}),i.$on("$destroy",this.redrawUnsubscriber)}return _createClass(o,[{key:"calculateVelocity",value:function(){var e=i.maxBy(i.map(this.parent.params.data,function(e){return i.sum(i.flatten(e))}));return isNaN(parseInt(e,10))?NaN:Math.max(e,this.parent.params.minVelocity)}},{key:"render",value:function(){var e=this.calculateVelocity(),t=isNaN(parseInt(e,10));this.isLocked=t||this.parent.params.isLocked||this.parent.params.isLoading,t||(this.velocity=e,this.velocityScale=this.parent.height/this.velocity),this.width=this.parent.width-this.offset.left-this.offset.right,this.height=this.parent.height-this.offset.top-this.offset.bottom,this.columns=this.parent.params.columns,this.columnWidth=this.width/this.columns,this.drawBackgroundRectangle(),this.redrawGraphContainerGroup();var n=i.isEmpty(i.flattenDeep(this.parent.params.data).filter(i.identity));(this.checkIfBarsChanged()||n)&&(t||this.redrawVelocityLinesAndLabels(),this.redrawColumns(),this.redrawBars(),this.redrawTimeLabels())}},{key:"drawBackgroundRectangle",value:function(){this.objs.bg||(this.objs.bg=this.createObj("rect").addClass(this.bemPrefix("bg")).show())}},{key:"redrawColumns",value:function(){for(var e=this,t=this.objs.columns;t.length>this.columns;)t.pop().destroy();for(;t.length<this.columns;)t[t.length]=this.createObj("rect").addClass(this.bemPrefix("column")).appendTo(this.objs.g.element),this.parent.ui.handleColumn(t[t.length-1],t.length-1);t.forEach(function(t,n){t.setAttrs({y:0,x:n*e.columnWidth,width:e.columnWidth,height:e.height}).bringToFront().show()})}},{key:"redrawTimeLabels",value:function(){i.forEach(this.objs.hLabels,function(e){return e.destroy()}),this.objs.hLabels=[];for(var e=0,t=0;t<=this.columns;t++){var n=this.parent.params.labels[t];if(n){var a=this.createObj("text").addClass(this.bemPrefix("label-h")).addClass(this.bemPrefix(++e%2?"label-h--even":"label-h--odd")).appendTo(this.objs.g.element).show();a.element.textContent=n;var o=a.element.getBoundingClientRect();a.setAttrs({x:t*this.columnWidth-o.width/2,y:this.height+o.height+this.parent.STYLE.timeLabelMarginTop}),this.objs.hLabels[this.objs.hLabels.length]=a}}}},{key:"redrawVelocityLinesAndLabels",value:function(){i.forEach(this.objs.lines,function(e){return e.destroy()}),this.objs.lines=[],i.forEach(this.objs.vLabels,function(e){return e.destroy()}),this.objs.vLabels=[];for(var e=this.parent.STYLE.velocityGridParts+1,t=0;t<e;t++){var n=this.height/(e-1)*t;if(this.objs.lines[t]=this.createObj("line").addClass(this.bemPrefix("line")).appendTo(this.objs.g.element).setAttrs({x1:0,x2:this.width,y1:n,y2:n}).show(),!isNaN(parseInt(this.velocity,10))&&e-t>1){var a=this.velocity-this.velocity/(e-1)*t,s=this.createObj("text").addClass(this.bemPrefix("label-v")).appendTo(this.objs.g.element).show();this.objs.vLabels[t]=s,s.element.textContent=o.getVelocityLabel(a),s.setAttrs({x:-s.element.getBoundingClientRect().width-this.parent.STYLE.velocityLabelMarginRight,y:n})}}}},{key:"getBarsStateArray",value:function(){return i.flatten([this.width,this.height,this.parent.params.selected,this.parent.params.data])}},{key:"checkIfBarsChanged",value:function(){var e=this.getBarsStateArray(),t=!i.isEqual(e,this.lastBarsState);return this.lastBarsState=i.clone(e),t}},{key:"redrawBars",value:function(){var e=this;i.forEach(this.objs.bars,function(e){return e.destroy()}),this.objs.bars=[];var t=this.parent.STYLE.minimalBarChunkHeight;i.forEach(this.parent.params.data,function(n,a){var o=0;i.forEach(n,function(s,r){var l=s.length*n.length,c=1-t*l/e.height,d=i.isArray(s)&&s.length>1,p=d?i.sumBy(s):Number(s),u=d?p-s[0]:0,m=p*e.velocityScale*c,f=u*e.velocityScale*c,g=a*e.columnWidth;m>0&&f<m&&(m+=t),f>0&&(f+=t,m+=t);var v=e.height-m-o;if(m>0){var h=e.createGraphBar(g,v,e.columnWidth,m,"bar");if(~e.parent.params.selected&&e.parent.params.selected!==r)h.addClass(e.bemPrefix("bar--unselected"));else{var b=e.parent.params.styles[r]||{},_=b.color||"",y=b.extraClass||"";y&&h.addClass(e.bemPrefix("extra--"+y)),_&&h.setAttr("fill",_)}e.isLocked||e.parent.ui.handleBar(h,a,r)}if(~e.parent.params.selected&&e.parent.params.selected===r&&u>0){var S=e.createGraphBar(g,v,e.columnWidth,f,"bar-chunk-overlay");e.isLocked||e.parent.ui.handleUploadBar(S,a,r)}o+=m})})}},{key:"createGraphBar",value:function(e,t,n,i,a){var o=this.createObj("rect").addClass(this.bemPrefix(a)).appendTo(this.objs.g.element).setAttrs({x:e,y:t,width:n,height:i}).show();return this.objs.bars[this.objs.bars.length]=o,o}},{key:"redrawGraphContainerGroup",value:function(){return this.objs.g||(this.objs.g=this.createObj("g").addClass(this.bemPrefix("g")).show()),this.objs.g.setAttrs({width:this.width,height:this.height,transform:"translate(".concat(this.offset.left," ").concat(this.offset.top,")")})}},{key:"bemPrefix",value:function(e){var t=this;return e.split(" ").map(function(e){return t.parent.bemCssPrefix+"__"+e}).join(" ")}},{key:"createObj",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"rect";return new t(e).hide().appendTo(this.parent.svg)}}],[{key:"getVelocityLabel",value:function(e){var t=_slicedToArray(a.format.size(e,!0).split(" ",2),2),n=t[0],i=t[1];return(Math.round(10*parseFloat(n.replace(",",".")))/10).toString()+" "+i}}]),o}()}]),angular.module("keenetic").factory("BarChart",["BarChartRenderer","BarChartUi","$timeout","_",function(e,t,n,i){return function(){function a(n,i,o){_classCallCheck(this,a),this.svg=n,this.bemCssPrefix=i,this.RENDER_DEBOUNCE=100,this.STYLE={offset:{top:25,right:25,bottom:24,left:70},velocityLabelMarginRight:10,timeLabelMarginTop:2,velocityGridParts:4,minimalBarChunkHeight:4},this.params={minVelocity:4096,columns:60,labels:{},data:[],styles:[],isLocked:!1,isLoading:!1,selected:!1},this.options={loading:!1,dummy:!1,disabled:!1},this.onBarClick=function(){},this.onBarDoubleClick=function(){},this.onMouseOverColumn=function(){},this.renderer=new e(this,o),this.ui=new t(this)}return _createClass(a,[{key:"redraw",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:i.noop;this.setOptions(!0),n.cancel(this.redrawDebounceTimer),this.redrawDebounceTimer=n(function(){return e.__doRender(t)},this.RENDER_DEBOUNCE)}},{key:"__doRender",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:i.noop;this.renderer.render(),this.setOptions(!1),e(this.width,this.height)}},{key:"setOptions",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=i.isEmpty(this.params.data);e&&(this.options.locked||this.options.loading||this.options.dummy)||(this.options.locked=Boolean(this.params.isLocked),this.options.loading=Boolean(this.params.isLoading&&!t),this.options.dummy=t)}},{key:"minVelocity",set:function(e){!isNaN(parseInt(e,10))&&parseInt(e,10)>1&&(this.params.minVelocity=e,this.redraw())}},{key:"isLocked",set:function(e){this.params.isLocked=Boolean(e),this.redraw()}},{key:"isLoading",set:function(e){this.params.isLoading=Boolean(e),this.redraw()}},{key:"columns",set:function(e){!isNaN(parseInt(e,10))&&parseInt(e,10)>1&&(this.params.columns=parseInt(e,10),this.redraw())}},{key:"labels",set:function(e){(i.isArray(e)||i.isObject(e))&&(this.params.labels=e,this.redraw())}},{key:"styles",set:function(e){i.isArray(e)&&!i.isEmpty(e)&&(this.params.styles=e,this.redraw())}},{key:"data",set:function(e){i.isArray(e)&&(this.params.data=e,this.redraw())}},{key:"height",get:function(){return this.svg.clientHeight||this.svg.getBoundingClientRect().bottom-this.svg.getBoundingClientRect().top}},{key:"width",get:function(){return this.svg.clientWidth||this.svg.getBoundingClientRect().right-this.svg.getBoundingClientRect().left}},{key:"selectedIdx",set:function(e){isNaN(parseInt(e,10))?-1!==this.params.selected&&(this.params.selected=-1,this.redraw()):this.params.selected!==parseInt(e,10)&&(this.params.selected=e,this.redraw())}}]),a}()}]),function(){function e(e,t,n,i,a,o,s,r,l,c){var d=this,p=n.$parent.vm,u=l.START_POLLING,m=l.HIDE_DEVICES_LIST,f=l.SHOW_DEVICES_LIST,g=l.NEW_TAB_ADDED,v=l.ADD_HOST_TAB,h=l.UPDATE_L10N,b=l.CONFIRM_NEW_TAB_DEVICE_CHOICE,_=l.SET_ACTIVE_TAB_BY_MAC,y=l.RESIZE_BAR_CHART;c.subscribeOnUpdates(n,function(e){var t=e.trackedMacs;d.trackedMacs=t}),d.trackedMacs=[],d.l10n={},d.devicesFiltered=[],d.filterString="",d.devicesCountUpdateTimer$=null,d._devices=[],d._deviceSelected=!1,d._notRegisteredDevices=[],d._isVisible=!1,d._element=null;var S=function(){d.l10n.deviceListPrompt=s.getTranslation("traffic-monitor.device-list.prompt",null,{notRegisteredDevicesCount:d.getNotRegisteredCount()})},w=function e(){r.getNotRegisteredHosts().then(function(t){d.setNotRegisteredHosts(t),S(),d.devicesCountUpdateTimer$=a(e,1e3)})};d.show=function(){d._isVisible=!0,d.resize(),d.devicesCountUpdateTimer$||(d.devicesCountUpdateTimer$=a(w,1e3)),c.setState({isDeviceListVisible:!0})},d.hide=function(){d._isVisible=!1,a.cancel(d.devicesCountUpdateTimer$),d.devicesCountUpdateTimer$=null,c.setState({isDeviceListVisible:!1})},d.isVisible=function(){return d._isVisible},d.resize=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=d.resize;if(e?t.height=e:e=t.height,d.isVisible()&&e!==t.height){var n=i[0].querySelector(".page-traffic-monitor__table"),s=i[0].querySelector(".page-traffic-monitor-layout");n.style.opacity=.01,a(function(){var t=i[0].querySelector(".page-traffic-monitor__registered-devices"),r="row"!==o.get(getComputedStyle(s),"flex-direction","row"),l=n.clientHeight-t.clientHeight,c=r?void 0:e-l-20;t.style.height=c&&c+"px",a(function(){n.style.opacity=1})})}},d.setRegisteredHosts=function(e){var t=o.uniqBy(e,"mac");d.devicesFiltered=t,d._devices=t},d.setNotRegisteredHosts=function(e){d._notRegisteredDevices=e||[]},d.clearChooseDeviceFilter=function(){d.filterString=""},d.filterRegisteredDevices=function(e){var t=(e||"").toLowerCase();d.resetSelected(),d.devicesFiltered=d._devices.filter(function(e){return e.name.toLowerCase().includes(t)})},d.isHostTracked=function(e){return o.includes(d.trackedMacs,e.mac)},d.select=function(e){d.isHostTracked(e)||(d._deviceSelected=e)},d.isSelected=function(){return!1!==d._deviceSelected},d.getSelected=function(){return d._deviceSelected},d.getNotRegisteredCount=function(){return d._notRegisteredDevices.length},d.resetSelected=function(){d._deviceSelected=!1},d.confirmSelected=function(){var e=d.getSelected();d.hide(),p.$relay(b,e),n.$emit(u),d.resetSelected()},d.trackHost=function(e){d.isHostTracked(e)?n.$broadcast(_,e.mac):n.$broadcast(v,e)},d.displayHostInSeparateTab=function(e){d.select(e),d.confirmSelected()},n.$on(y,function(e,t){return d.resize(t)}),n.$on(m,function(){return d.hide()}),n.$on(f,function(){return d.show()}),n.$on(g,function(){return e.all([r.getRegisteredHosts(),r.getNotRegisteredHosts()]).then(function(e){var t=_slicedToArray(e,2),n=t[0],i=t[1];d.clearChooseDeviceFilter(),d.resetSelected(),d.setRegisteredHosts(n),d.setNotRegisteredHosts(i),d.show()})}),p.deviceList=d,d.hide(),S(),n.$on("$destroy",t.$on("$translateChangeSuccess",function(){return S()})),n.$on(h,function(){return S()})}e.$inject=["$q","$rootScope","$scope","$document","$timeout","_","utils","trafficMonitorService","trafficMonitorEvents","trafficMonitorSharedState"],angular.module("keenetic").controller("TrafficMonitorDevicesListController",e)}(),function(){function e(e,t,n,i,a,o,s,r,l,c){var d=this,p=n.$parent,u=p.vm,m=l.CHART_HINT_REFRESH,f=l.CHART_HINT_ON_MOUSEMOVE,g=r.SCALES;d.parentController=u,d.top=0,d.left=0,d.column=!1,d.time="",d.hosts=[],d.timeShift=0,d.activeTabHost=!1,c.subscribeOnUpdates(n,function(e){var t=e.timeShift,n=e.activeTabHost;d.timeShift=t,d.activeTabHost=n}),d.init=function(){angular.element(t[0]).on("mousemove",d.handleMouseMove),p.$on("$destroy",function(){angular.element(t[0]).off("mousemove",d.handleMouseMove)})},d.element=function(){return t[0].querySelector("#page-traffic-monitor__chart-hint")},d.controlHintVisible=function(e){var t=d.element();i.cancel(d.hintVisibleCtrlTimer),t&&(e?t.style.display="block":d.hintVisibleCtrlTimer=i(function(){t.style.display="none"},50))},d.handleMouseMove=function(e){var n=d.element();if(n){e=e||t[0].window.event;var i=a.innerWidth,o=e.clientX+8;i-o<300?(n.style.left="inherit",n.style.right=i-o+"px"):(n.style.right="inherit",n.style.left=o+"px"),n.style.top=e.clientY+"px"}},d.onMouseOverChartColumn=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];d.controlHintVisible(!1!==e),(!1!==e&&!u.ui.isLocked()&&d.column!==e||t)&&d.calculate(e),d.column=e},d.calculate=function(e){if(!1!==e&&!0!==e){var t=d.timeShift,n=r.getTimeLabelForColumn(e,u.scaleId,t),i=r.getTimeLabelForColumn(e+1,u.scaleId,t);d.time="".concat(n," - ").concat(i),d.hosts=o.chain(u.hosts).clone().sort(function(e,t){return t.sum-e.sum}).map(function(t){var n=g[u.scaleId].ticksLimit-e-1;return t.download=s.format.size(t.graph[n][0]),t.upload=s.format.size(t.graph[n][1]),t}).value()}},d.refresh=function(){d.onMouseOverChartColumn(!u.ui.isLocked()&&d.column,!0)},n.$on(f,function(e,t){return d.onMouseOverChartColumn(t)}),n.$on(m,function(){return d.refresh()}),u.chartHint=d,d.init()}e.$inject=["$rootScope","$document","$scope","$timeout","$window","_","utils","trafficMonitorLabels","trafficMonitorEvents","trafficMonitorSharedState"],angular.module("keenetic").controller("TrafficMonitorChartHintController",e)}(),function(){function e(e,t,n){return{loadProfiles:function(){var i=t.defer();return e.post(["show/chilli/profiles"]).spread(function(e){var t=e.profile||{};for(var a in t)t[a].preset=n.chilliRawDataToFormData(angular.copy(t[a].preset)),t[a].preset.profile=a;i.resolve(t)},i.reject),i.promise}}}e.$inject=["router","$q","chilliModel"],angular.module("keenetic").factory("chilliService",e)}(),function(){n.$inject=["chilliService","$timeout","$scope","notification","chilliModel","NDM","_"],angular.module("keenetic").controller("ChilliSectionController",n);var e=new RegExp("^(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])(?:\\.(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])){3}$"),t=/(?:^(?:(?:(?:[a-z]+:)?\/\/)?|www\.)(?:\S+(?::\S*)?@)?(?:localhost|(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])(?:\.(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])){3}|(?:(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)(?:\.(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)*(?:\.(?:[a-z\u00a1-\uffff]{2,}))\.?)(?::\d{2,5})?(?:[\/?#][^\s"]*)?$)/i;function n(n,i,a,o,s,r,l){var c="",d=this;d.data={},d.enabled=!1,d.chilliSegment="",d.form={},d.options={profileSelectOptions:[],customFields:!1,isPopupVisible:!1,profilesLoading:!1,profilesLoaded:!1,manualMode:!0,enabled:!1,currentSegment:""};var p,u,m={};function f(){var e=u.get(r.CHILLI_IFACE),t=e.chilli||{};d.data=s.chilliRawDataToFormData(angular.copy(t)),d.enabled=Boolean(e.up),d.data.profile&&(m[d.data.profile]={preset:angular.copy(d.data),custom:[]}),p=angular.copy(d.data),!d.data.profile&&d.data.uamserver&&(h.origManualData=angular.copy(d.data)),d.chilliSegment=t.dhcpif,d.chilliSegment&&e.up||(d.enabled=!1),v()}function g(){if(!d.options.profilesLoading){var e=g;return d.options.profilesLoading=!0,n.loadProfiles().then(function(t){if(d.options.profilesLoaded=Object.keys(t).length>1,d.options.profilesLoaded&&(m=angular.copy(t)),p.profile&&m[p.profile]){var n=m[p.profile]||{};angular.isArray(n.custom)&&n.custom.forEach(function(e){angular.isDefined(p[e])&&p[e]&&(n.preset[e]=p[e])})}e.profilesTouchedOnce||h(d.data.profile),e.profilesTouchedOnce=!0,d.options.profilesLoading=!1,v()})}}function v(){var e=Object.keys(m).map(function(e){return{id:e,name:e}});e.unshift({id:c,name:"segments.chilli.option-my-profile"}),-1!==Number(d.data.profile)&&d.data.profile&&!m[d.data.profile]&&e.push({id:d.data.profile,name:d.data.profile}),d.options.profileSelectOptions=e}function h(e,t){if(!angular.isUndefined(e)&&e!==t){var n=h;if(!n.locked){n.locked=!0,i(function(){n.locked=!1});var a,o=t===c;d.options.manualMode=e===c,a=!d.options.manualMode&&m[e],d.options.customFields={},(a&&a.custom||[]).forEach(function(e){d.options.customFields[e]=!0}),d.options.manualMode?(d.data=angular.copy(n.origManualData||{profile:""}),d.data.uamserver||(n.profileBeforeManual=t,d.advancedSettings.show())):(o&&!d.advancedSettings.customizeMode&&(n.origManualData=angular.copy(d.data),n.origManualData.profile=c),m[e]&&(d.data=angular.copy(m[e].preset||{profile:c})))}}}d.init=function(e){u=angular.copy(e),f(),g()},d.onDataRenew=function(e){u=angular.copy(e)},d.onTabChange=function(e){d.options.currentSegment=e.id,f(),i(function(){l.get(d,"form.$setPristine",l.noop)()})},d.onSelectOpen=function(){d.options.profilesLoaded||d.options.profilesLoading||g().then(function(){d.options.profilesLoaded||o.warning("segments.chilli.cant-update-profiles")})},d.advancedSettings={pristineData:{},customizeMode:!1,origManualData:{},show:function(){d.advancedSettings.customizeMode=!1,d.enabled&&(d.advancedSettings.pristineData=angular.copy(d.data),d.options.isPopupVisible=!0)},cancel:function(){d.advancedSettings.customizeMode&&(h.origManualData=angular.copy(d.advancedSettings.origManualData)),d.data.profile||(d.data=angular.copy(d.advancedSettings.pristineData),d.data.uamserver||(d.data.profile=h.profileBeforeManual)),d.options.isPopupVisible=!1,v()},accept:function(){d.options.isPopupVisible=!1,v()},customize:function(){d.advancedSettings.customizeMode=!0,h.profileBeforeManual=d.data.profile,d.data.profile=c,d.advancedSettings.origManualData=angular.copy(h.origManualData||{profile:""}),h.origManualData=angular.copy(d.data)}},d.isFieldVisible=function(e,t){return t?d.options.manualMode||d.data&&d.data[e]:d.options.customFields&&d.options.customFields[e]},d.isFieldDisabled=function(e,t){return t&&!d.options.manualMode},d.uamAllowedValidator=function(n){return!n||e.test(n)||t.test(n)||"segments.chilli.uamallowed-invalid"},a.$watch("vm.data.profile",h)}}(),function(){function e(e,t){return{chilliRawDataToFormData:function(e){var t=(e=e||{}).radius||{},n=e.dns||{};return{uamserver:e.uamserver||"",uamsecret:e.uamsecret||"",uamallowed:e.uamallowed||[],uamdomain:e.uamdomain||[],radiussecret:e.radiussecret||"",radiusserver1:t.server1||"",radiusserver2:t.server2||"",radiusnasid:e.radiusnasid||"",radiuslocationname:e.radiuslocationname||"",radiuslocationid:e.radiuslocationid||"",dns1:n.dns1||"",dns2:n.dns2||"",profile:e.profile||""}},formDataToRawData:function(n,i,a){var o=n.uamserver;o&&o.split("//").length<2&&(o="http://"+o);var s,r,l,c={up:!0,chilli:{dhcpif:a,uamallowed:p(n.uamallowed),uamdomain:p(n.uamdomain),uamserver:o||{no:!0},uamsecret:n.uamsecret||{no:!0},radiussecret:n.radiussecret||{no:!0},radiuslocationname:n.radiuslocationname||{no:!0},radiuslocationid:n.radiuslocationid||{no:!0},radiusnasid:n.radiusnasid||{no:!0},radius:d("server",[n.radiusserver1,n.radiusserver2]),dns:d("dns",[n.dns1,n.dns2]),profile:n.profile||{no:!0}}};return i.address&&(c.ip={address:{address:i.address,mask:i.mask}}),s=t.CHILLI_IFACE,r=c,(l={interface:{}}).interface[s]=r,l;function d(e,t){var n=0,i={};return t.forEach(function(t){t&&(i[e+ ++n]=t)}),n?i:{no:!0}}function p(t){var n=[];return angular.isArray(t)&&t.length&&(n=t.filter(e.identity)),n.length?n:{no:!0}}}}}e.$inject=["_","NDM"],angular.module("keenetic").factory("chilliModel",e)}(),function(){angular.module("keenetic").directive("ndmTitle",function(){return{templateUrl:"app/page/controlPanel/myNetwork/devicesList/ndm-title/ndm-title.html",replace:!0,transclude:!0,scope:{text:"=",title:"@label"}}})}(),function(){function e(e,t,n,i,a,o){var s=n.PORT_ROLE.FREE,r=o.BUSY_PORT_ROLES,l=o.PORT_ORDER,c=o.WAN_PORT_IS_LEFTMOST,d=function(){return e.mapValues(t.PORTS_IDS,function(){return{role:s,forInterface:""}})},p=function(t){return e.chain(t).split(",").filter().uniq().value()},u=function(t,n,i){return e.reduce(p(t),function(e,t){return Object.assign({},e,_defineProperty({},t,{role:n,forInterface:i}))},d())},m=function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e.reduce(n,function(t,n){return Object.assign({},t,{},e.pickBy(n,function(e){return e.role!==s}))},d())},f=function(e,t){var n=r.filter(function(t){return e["".concat(t,"-port")]}).map(function(n){return u(e["".concat(n,"-port")],n,t)});return m.apply(void 0,_toConsumableArray(n))},g=function(i,o){var s=i.role,r=i.port,l=i.bridge||o;return s===n.PORT_ROLE.INET&&a.IS_DSL_DEVICE?function(t,n,i){return e.reduce([t],function(e,t){return Object.assign({},e,_defineProperty({},t,{role:n,forInterface:i}))},d())}(e.get(t,"PORTS_MAP.DSL.port"),s,l):u(r,s,l)},v=function(t,a){var o=p(t.port),s=i.splitToNumbers(t["vlan-port"]),r=e.difference(o,s).join(",");return u(r,n.PORT_ROLE.VLAN,a)},h=function(i,a){var r=e.map(i,function(e,i){var r=e.role,c=e.forInterface,d=r!==n.PORT_ROLE.VLAN,p=t.PORTS_IDS[i],u=t.PORTS_MAP[p],m=u.isCombo,f=u.isSfp,g=u.isReversed,v="ethernet"===u.type,h="dsl"===u.type,b="blue"===u.color,_=h||r!==s&&c!==a,y=l[p];return h&&(r=n.PORT_ROLE.INET),{portIndex:i,portName:p,portData:u,portOrder:y,role:r,forInterface:c,isBusy:_,isEthernet:v,isDsl:h,isBlue:b,isCombo:m,isSfp:f,isReversed:g,hasRoleIcon:d,roleOptions:u.iface!==t.LAN_SWITCH?o.getSeparateSwitchBluePortOptions():o.getPortRoleOptions()}});return e.sortBy(r,"portOrder")};return{getPortmapForExistingIpoe:function(t,i,a,o){var s=e.pickBy(i,function(e,n){return n!==t}),r=e.pickBy(o,function(e,t){return t!==n.DEFAULT_HOME_SEGMENT_ID}),l=m.apply(void 0,_toConsumableArray(e.map(s,f)).concat(_toConsumableArray(e.map(a,g)),_toConsumableArray(e.map(r,v)),[f(i[t],t)]));return h(l,t)},getPortmapForNewIpoe:function(t,i,a,o){var r,l=e.pickBy(a,function(e,t){return t!==n.DEFAULT_HOME_SEGMENT_ID}),d=m.apply(void 0,_toConsumableArray(e.map(t,f)).concat(_toConsumableArray(e.map(i,g)),_toConsumableArray(e.map(l,v)))),p=h(d,""),u=e.filter(p,function(e){return e.role===s});r=o&&1!==u.length?(c?e.find:e.findLast)(u,function(e){return e.portIndex!==o}):u[0];return r&&(r.role=n.PORT_ROLE.INET),p},splitPortsList:p}}e.$inject=["_","NDM","CONSTANT","utils","dslConstants","wiredConstants"],angular.module("keenetic").factory("wiredPortmapService",e)}(),function(){function e(e,t,n,i,a,o,s,r,l,c,d,p,u,m,f,g,v,h,b){var _={no:!0},y=b.DOT1X_INSTALLED,S=p.WAN_PORT_IS_LEFTMOST,w=p.IS_DOUBLE_SWITCH_DEVICE,C=Boolean(s.pingcheck),E=d.getParentDslInterfaceId(),I=c.getIpGlobalQuery,T=c.getInterfaceDescriptionQuery,k=c.getInterfaceUpQuery,P=c.getAddRoleQuery,A=c.getInterfaceScheduleQuery,D=function(e,t,i){var a=i.rciInterfaceData,o=i.pingcheckData,s=i.allIpoe,l=i.allIpvc,c=i.allIseg,d=f.getPrototype();d.id=t,d.ipoe=e;var p=a[t];d.rename=p.rename,d.ip=p?g.getFormDataFromRawData(p,!1):d.ip,d.ppp=p?v.getFormDataFromRawDataByVia(t,a):d.ppp,d.pppId=d.ppp.id;var m=d.pppId?a[d.pppId]:{up:!0,schedule:"",description:""};d.general=function(e,t){var i=n.get(e,"description")?e:t,a=n.get(e,"ip.global.order");return n.isUndefined(a)&&(a=n.get(t,"ip.global.order")),{order:a,isUp:Boolean(e.up)&&Boolean(t.up),schedule:e.schedule||t.schedule||"",description:r.getInterfaceL10n(i)}}(p,m);var _=d.pppId||d.id;return d.pingcheck=h.getFormDataFromRawData(a[_],o.profile||{}),d.dot1x=b.getDot1xConfiguration(p),d.savedPppType=d.ppp.type,d.savedSchedule=d.general.schedule,d.savedPingcheckProfile=d.pingcheck.profileName,d=Object.assign({},d,{},function(e,t,i){var a=i.allIpoe,o=i.allIpvc,s=i.allIseg,l=r.splitToNumbers(n.get(a,[t,"busy-vlan"],"")).map(String),c=u.getPortmapForExistingIpoe(t,a,o,s),d=e["inet-vlan"],p=e["voip-vlan"],m=r.splitToNumbers(e["iptv-vlan"]),f=n.get(m,"0",""),g=n.get(m,"1","");return{busyVlans:l,portmap:c,currentInetPort:e["inet-port"],inetVlan:d,voipVlan:p,iptvVlan:f,iptvVlan2:g}}(e,t,{allIpoe:s,allIpvc:l,allIseg:c}))},O=function(e){return{showInterfaceData:n.get(e,"0.".concat("show.interface"),{}),rciInterfaceData:n.get(e,"1.".concat("show.rc.interface"),{}),allIpoe:n.get(e,"2.".concat("show.rc.interface",".ipoe"),{}),pingcheckData:n.get(e,"3.".concat("show.rc.ping-check"),{}),allIpvc:n.get(e,"4.".concat("show.rc.interface",".ipvc"),{}),mactable:n.toArray(n.get(e,"5.".concat("show.interface.mac.mactable"),[])),whoami:n.get(e,"6.".concat("whoami"),{})}},N=function(e,t){return n.sortBy(e,function(e){return n.has(e,["interface",t])?n.has(e,["interface",t,"ip"])?2:n.has(e,["interface",t,"mac"])?1:3:3})},L=l.createRequester();return{PINGCHECK_INSTALLED:C,getRequester:function(){return L},stopRequester:function(){L.clearCallbacks(),L.stopPolling()},getConfiguration:function(){return o.postToRciRoot(r.toRciQueryList(["show.interface","show.rc.interface",n.set({},"show.rc.interface",{ipoe:{parent:""}}),C?n.set({},"show.rc.ping-check",{}):{},E?n.set({},"show.rc.interface",{ipvc:{parent:E}}):{},n.set({},"show.interface.mac",{name:i.LAN_SWITCH}),"whoami"])).then(O).then(function(e){var t=e.showInterfaceData,o=e.rciInterfaceData,s=e.allIpoe,l=e.pingcheckData,d=e.allIpvc,p=e.mactable,g=e.whoami,v=n.chain(o).pickBy("iseg").mapValues("iseg").value(),h=S?0:n.size(i.PORTS_MAP)-1,b=n.chain(s).map(function(e,t){return D(e,t,{rciInterfaceData:o,pingcheckData:l,allIpoe:s,allIpvc:d,allIseg:v})}).sortBy(function(e){return Number(e.currentInetPort)-h}).value(),_=c.getAllUsedSubnets(t,o),y=m.getUserPort(p,g),C=u.getPortmapForNewIpoe(s,d,v,y),E=Object.assign({},f.getPrototype(),{usedSubnets:_,portmap:C});E.general.order=c.countGlobalIfaces(o),E.general.isNew=!0;var I=n.find(C,function(e){return!e.isBusy&&e.role===a.PORT_ROLE.INET})||{};E.currentInetPort=I.portIndex;var T=[];return w&&"0"===E.currentInetPort||(T=r.splitToNumbers(n.get(v,[a.DEFAULT_HOME_SEGMENT_ID,"busy-vlan"],""))).push(1),E.busyVlans=T.map(String),{newConnectionCanBeAdded:!n.isEmpty(I),usedSubnets:_,showInterfaceData:t,rciInterfaceData:o,allIpvc:d,pingcheckData:l,allIpoe:s,connectionsList:b,newConnectionModel:E}})},saveConnection:function(i){var s=f.getIpoeObjectFromModel(i);return o.post({url:"interface/ipoe",data:s}).then(function(a){return a.ndmErrors?e.when([{},!1]):(i.nextName=n.get(a,"next-name"),e.all([function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:300,i=e.defer();return t(function(){o.get("interface").then(i.resolve)},Math.max(0,n)),i.promise}(),e.when(i)]))}).then(function(t){var i=_slicedToArray(t,2),s=i[0],r=i[1];if(!r)return e.when({error:"ipoe"});r.id=s[r.nextName]?r.nextName:n.findKey(s,function(e){return e.rename===r.nextName});var l=r.ppp,c=l.type!==v.PPP_TYPE.NONE,d=v.findIfaceIdToSave(l,s),p=c?d:r.id,u=n.get(r,"general.description",r.id),m=n.get(r,"general.schedule",_),f=n.get(r,"general.order",-1),S=Boolean(n.get(r,"general.isUp")),w=[g.isInterfaceIpConfigurationStatic(s[r.id])?g.getResetIpSettingsQuery(r.id):{},c&&g.isInterfaceIpConfigurationStatic(s[d])?g.getResetIpSettingsQuery(d):{}].concat(_toConsumableArray(g.getSavingQueryArray(r.ip,r.id,{noMacMode:!1})),[I(p,f),k(p,S),A(p,m)],_toConsumableArray(v.getSavingQueriesArr(r.id,r.ppp,s)),[r.id===p?{}:I(r.id,-1),r.id===p?{}:A(r.id,_),T(r.id,u),c?T(d,u):{}]);y&&w.push(b.getNdmQuery(r.dot1x,r.id)),C&&w.push.apply(w,_toConsumableArray(h.getSavingQueries(r.pingcheck,p,!0,s))),c&&w.push(P(d,a.INTERFACE_ROLE.INET));var E=N(w,r.id);return o.postAndSave(E)})},deleteConnection:function(e){var t=[n.set({},["interface",e.id,"ipoe"],_)];return e.pppId&&t.push(n.set({},["interface",e.pppId],_)),o.postAndSave(t)}}}e.$inject=["$q","$timeout","_","NDM","CONSTANT","router","components","utils","requesterFactory","interfaces","dslService","wiredConstants","wiredPortmapService","usersService","ipoeConnectionModel","ifaceIpModel","ifacePppModel","pingcheckModel","dot1x"],angular.module("keenetic").factory("wiredIpoeService",e)}(),function(){function e(e,t,n,i){var a=i.HAS_TWO_SWITCHES,o=n.PORT_ROLE,s=e.values(n.PORT_ROLE).filter(function(e){return e!==o.FREE}),r=e.reduce(i.PORTS_MAP,function(e,t,n){var i=Object.keys(e).length;return Object.assign({},e,_defineProperty({},n,i))},{}),l=Object.keys(i.PORTS_MAP)[0],c=function(){return[{id:o.FREE,label:"default",icon:"radio-false"},{id:o.INET,label:"port-role.inet",icon:"role-inet"},{id:o.IPTV,label:"port-role.iptv",icon:"role-iptv"},{id:o.VOIP,label:"port-role.voip",icon:"role-voip"}]};return{WAN_PORT_IS_LEFTMOST:"WAN"===i.PORTS_MAP[l].group,IS_DOUBLE_SWITCH_DEVICE:a,BUSY_PORT_ROLES:s,PORT_ORDER:r,getPortRoleOptions:c,getSeparateSwitchBluePortOptions:function(){return c().filter(function(e){var t=e.id;return t!==o.IPTV&&t!==o.VOIP})}}}e.$inject=["_","utils","CONSTANT","NDM"],angular.module("keenetic").factory("wiredConstants",e)}(),function(){function e(e,t,n,i,a,o,s,r){var l=n.PORT_ROLE,c=r.PORT_ORDER,d=function(e,i){var a=e.iface!==t.LAN_SWITCH;return{portIndex:e.port,portName:i,portData:e,portOrder:c[i],role:n.PORT_ROLE.FREE,forInterface:"",isBusy:!1,roleOptions:a?r.getSeparateSwitchBluePortOptions():r.getPortRoleOptions()}},p=function(t){return(t||[]).map(function(t){return e.get(t,"portData.name")}).join(",")};return{MODEL_VLAN_FIELDS:["inetVlan","voipVlan","iptvVlan","iptvVlan2"],getIpoeObjectFromModel:function(t){var n={},i=e.chain(t.portmap).filter(function(e){return!e.isBusy}).filter(function(e){return e.role!==l.FREE}).groupBy(function(e){return e.role}).value();return n["inet-port"]=p(i[l.INET]),n["inet-vlan"]=t.inetVlan,n["iptv-port"]=p(i[l.IPTV]),n["iptv-vlan"]=[t.iptvVlan,t.iptvVlan2].filter(e.identity).join(","),n["voip-port"]=p(i[l.VOIP]),n["voip-vlan"]=t.voipVlan,n.name=t.id,n},getEmptyIpoeObject:function(){return{"inet-port":"","inet-vlan":"","iptv-port":"","iptv-vlan":"","voip-port":"","voip-vlan":""}},getPrototype:function(){return{general:{isUp:!0,order:0,schedule:"",description:""},portmap:e.sortBy(e.map(t.PORTS_MAP,d),"portOrder"),busyVlans:[],inetVlan:"",voipVlan:"",iptvVlan:"",iptvVlan2:"",id:"",rename:"",pppId:"",savedPppType:"",savedSchedule:"",savedPingcheckProfile:"",ip:a.getFormDataPrototype(),ppp:o.getFormDataPrototype(),pingcheck:s.getFormDataPrototype(),dot1x:i.getDefaultDot1xConfiguration()}}}}e.$inject=["_","NDM","CONSTANT","dot1x","ifaceIpModel","ifacePppModel","pingcheckModel","wiredConstants"],angular.module("keenetic").factory("ipoeConnectionModel",e)}(),function(){function e(e,t,n,i,a,o,s,r,l){var c=[],d=!1,p=[],u=[];o.usbqmi&&(s.registerRequesterCallback(a.toRciQueryList([l.SHOW_INTERFACE]),function(e){d=!0;var t=i.get(e,"[0].".concat(l.SHOW_INTERFACE),{});c=s.filterSuitableInterfaces(t),r.setState({suitableInterfacesList:c}),p.forEach(function(e){e(c)})}),s.registerDynamicRequesterCallback(function(){var e=c.filter(function(e){return"down"!==e.state}).map(function(e){return s.getSmsListQueryData(e.id,t.current.name!==l.SMS_STATE_NAME)});return{query:i.map(e,"query"),dataForCallback:i.map(e,"dataPath")}},function(e,t){var n=i.map(t,function(t,n){return i.get(e,"[".concat(n,"].").concat(t),{})}),a=i.some(n,function(e){return i.some(e.messages,function(e){return!e.read})});r.setState({newSmsAvailable:a}),u.forEach(function(e){e(a,n)})}),s.startPolling());return{getSuitableInterfacesList:function(){return d?e.when(c):s.getSuitableInterfacesList()},addSmsListsUpdateCallback:function(e){u.push(e)},addQmiInterfacesListUpdateCallback:function(e){p.push(e)}}}e.$inject=["$q","$state","$rootScope","_","utils","components","sms","smsSharedState","smsConstants"],angular.module("keenetic").factory("smsStatus",e)}(),function(){function e(e){return function(t){var n=new Date;if(e.isSameDay(t,n)){var i=e.padNumber(t.getHours()),a=e.padNumber(t.getMinutes());return"".concat(i,":").concat(a)}return e.getSmsDate(t)}}e.$inject=["sms"],angular.module("keenetic").filter("smsDate",e)}(),function(){function e(e,t){var n=function(n){var i=e.get(n,"ownerDocument.documentElement");if(!i)return{top:0,left:0};var a=n.getBoundingClientRect();return{top:a.top+(t.pageYOffset||i.scrollTop)-(i.clientTop||0),left:a.left+(t.pageXOffset||i.scrollLeft)-(i.clientLeft||0)}};return{scrollIntoView:function(e,i){var a=t.getComputedStyle(i),o=function(e,t){return parseInt(e[t],10)||0},s=o(a,"borderTopWidth"),r=o(a,"paddingTop"),l=n(e).top-n(i).top-s-r,c=i.scrollTop,d=o(a,"height"),p=e.getBoundingClientRect().height;l<0?i.scrollTop=c+l:l+p>d&&(i.scrollTop=c+l-d+p)},autosizeTextarea:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;e.style.height="inherit";var i=t.getComputedStyle(e),a=function(e){return parseInt(i.getPropertyValue(e),10)},o=e.value.includes("\n")?e.scrollHeight:a("line-height"),s=Math.max(n,o+a("padding-bottom"));e.style.height="".concat(s,"px")}}}e.$inject=["_","$window"],angular.module("keenetic").factory("smsUi",e)}(),function(){function e(e,t,n){var i=n.EVENTS.SMS_SHARED_STATE_UPDATED,a={selectedInterfaceId:"",suitableInterfacesList:[],newSmsAvailable:!1,openedModalCount:0,modemIsOff:!1,modemStateIsOk:!1,modemStateUpdated:!1,simState:"",simStateIsInvalid:!1,dialogs:[],sendersToHide:{},currentDialog:null},o=function(n,o){t.has(a,n)&&(a[n]+=o,e.$broadcast(i))},s=function(n,o){a.sendersToHide=o?Object.assign({},a.sendersToHide,_defineProperty({},n,!0)):t.omit(a.sendersToHide,[n]),e.$broadcast(i)};return{getByKey:function(e,n){return t.get(a,e,n)},setState:function(n){a=Object.assign({},a,{},t.cloneDeep(n)),e.$broadcast(i)},getState:function(){return a},subscribeOnStateChanged:function(t,n){var o=e.$on(i,function(){return n(a)});t.$on("$destroy",o)},increaseStateCounter:function(e){return o(e,1)},decreaseStateCounter:function(e){return o(e,-1)},showSender:function(e){return s(e,!1)},hideSender:function(e){return s(e,!0)}}}e.$inject=["$rootScope","_","smsConstants"],angular.module("keenetic").factory("smsSharedState",e)}(),function(){function e(e,t,n,i,a,o,s,r,l,c,d){var p=/[^\x00-\x7F]/,u=s.STORAGE,m=s.MONTH_INDEX_BY_NAME,f=s.SMS_CHUNK_LENGTH,g=s.SINGLE_SMS_MAX_LENGTH,v=s.CHUNKED_SMS_MAX_LENGTH,h=s.ASCII_7BIT_SMS_MAX_LENGTH,b=s.ASCII_7BIT_SMS_CHUNK_LENGTH,_=s.ASCII_7BIT_CHUNKED_SMS_MAX_LENGTH,y=function(e){return t.chain(e).filter(function(e){return e.type===c.USB_QMI_INTERFACE_TYPE}).filter(function(e){return"yes"===e.plugged||e.id===n.INTERNAL_LTE_ID}).value()},S=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return e?{query:_defineProperty({},"sms",Object.assign(_defineProperty({interface:e},"list",{}),t?{unread:!0}:{})),dataPath:"".concat("sms",".").concat("list")}:(console.warn("sms.getSmsListQueryData: empty interface ID passed"),{query:[],dataPath:"".concat("sms",".").concat("list")})},w=function(e,n){var a=function(e,t){return{query:_defineProperty({},"sms",_defineProperty({interface:e},t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:{})),dataPath:"".concat("sms",".").concat(t)}}(e,n,arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}),o=a.query,s=a.dataPath;return i.postToRciRoot(o).then(function(e){return t.get(e,s,{})})},C=function(e){var t,n,i,a,o,s,r,l,c,d,p,u=e.timestamp,f=(t=u.split(/\s+/g),n=t[1],i=t[2],a=t[3],o=t[4],s=_slicedToArray(a.split(":").map(Number),3),r=s[0],l=s[1],c=s[2],d=new Date,p=m[n],d.setFullYear(o),d.setMonth(p),d.setDate(Number(i)),d.setHours(r,l,c),d);return Object.assign({},e,{timestamp:f,ndmTimestamp:u})},E=function(e){var n=t.chain(e).get("messages",{}).map(function(e,t){return Object.assign({},e,{id:t})}).map(C).value();return t.chain(n).groupBy("from").map(function(e,n){return function(e,n){var i=e.filter(function(e){return!e.read}).length,a=i>0,o=s.PHONE_NUMBER_REGEXP.test(n),r=t.orderBy(e,"timestamp","asc");return{hasUnread:a,unreadCount:i,from:n,messages:r,userCanReply:o,latest:t.last(r)}}(e,n)}).orderBy([function(e){return t.get(e,"latest.timestamp")}],["desc"]).value()},I=function(e){return w(e,"list")},T=function(e){return t.mapValues(u,function(n){return{free:t.get(e,"".concat(n,"-free-slots"),0),total:t.get(e,"".concat(n,"-total-slots"),0)}})},k=function(e){return!p.test(e)},P=function(e){return t.padStart(e,2,"0")},A=function(e){var t=String(e.getFullYear()).substr(2),n=P(e.getMonth()+1),i=P(e.getDate());return"".concat(i,".").concat(n,".").concat(t)},D=d.createRequester();return{STORAGE:u,getSuitableInterfacesList:function(){return i.cached("show.interface").then(y)},filterSuitableInterfaces:y,registerRequesterCallback:function(e,t){return D.registerCallback(e,t)},registerDynamicRequesterCallback:function(e,t){return D.registerDynamicCallback(e,t)},unregisterRequesterCallback:function(e){return D.unregisterCallback(e)},startPolling:function(){return D.startPolling()},stopPolling:function(){return D.stopPolling()},getSmsListQueryData:S,extractDialogsData:E,extractSlotsData:T,getSmsListData:I,getDialogs:function(e){return I(e).then(function(e){return E(e)})},getSlots:function(e){return w(e,"list").then(function(e){return T(e)})},markMessagesRead:function(t,n){return 0===n.length?e.when([]):w(t,"read",n.map(function(e){return{id:e.id}}))},markMessagesUnread:function(t,n){return 0===n.length?e.when([]):w(t,"read",n.map(function(e){return{no:!0,id:e.id}}))},sendMessage:function(e,t,n){return w(e,"send",{to:t,message:n})},deleteMessages:function(t,n){return 0===n.length?e.when([]):w(t,"delete",n.map(function(e){return{id:e.id}}))},calculateMessageStats:function(e){return{chunksNum:function(e){return k(e)?e.length>h?Math.ceil(e.length/b):1:e.length>g?Math.ceil(e.length/f):1}(e),charsLeft:function(e){return k(e)?_:v}(e)-e.length}},padNumber:P,isSameDay:function(e,t){return e.getFullYear()===t.getFullYear()&&e.getMonth()===t.getMonth()&&e.getDate()===t.getDate()},getSmsDate:A,getDialogMessages:function(e){return t.chain(e).groupBy(function(e){return A(e.timestamp)}).map(function(e,t){return{dayMessages:e,day:t}}).orderBy("day","asc").value().reduce(function(e,n){var i,a,o=t.orderBy(n.dayMessages,"timestamp","asc"),s=t.get(o,"[0]");return[].concat(_toConsumableArray(e),[(i=s.timestamp,a=new Date(i.getTime()-5),{isSeparator:!0,text:A(a),timestamp:a,id:a.toString()})],_toConsumableArray(n.dayMessages))},[])},getTabsList:function(e){return e.map(function(e){var t=e.id,i=e.description;return t===n.INTERNAL_LTE_ID&&i===n.INTERNAL_LTE_DESCRIPTION?{id:t,description:a.getTranslation("interface-translations.LTE-ISP")}:{id:t,description:i}})},getUnreadMessagesPerModem:function(e){var n=e.map(function(e){return S(e,!0)}),a=t.map(n,"query");return i.postToRciRoot(a).then(function(e){return n.map(function(n,i){return t.get(e,"[".concat(i,"].").concat(n.dataPath))})})},processInterfaceState:function(e){var t=l.getConnectionStateObject(e).color===r.constants.STATE_CATEGORY.OK,n=e.sim,i=c.ERROR_SIM_CARD_STATES.includes(n);return{modemIsOff:"down"===e.state,modemStateIsOk:t,modemStateUpdated:!0,simState:n,simStateIsInvalid:i}}}}e.$inject=["$q","_","NDM","router","utils","components","smsConstants","interfaces","usbQmi","usbQmiConstants","requesterFactory"],angular.module("keenetic").factory("sms",e)}(),function(){angular.module("keenetic").factory("smsConstants",function(){return{SHOW_INTERFACE:"show.interface",SMS_STATE_NAME:"controlPanel.sms",STORAGE:{SIM:"sim",INTERNAL:"nv"},PHONE_NUMBER_REGEXP:/^\+?[0-9]{1,15}$/,MONTH_INDEX_BY_NAME:{Jan:0,Feb:1,Mar:2,Apr:3,May:4,Jun:5,Jul:6,Aug:7,Sep:8,Oct:9,Nov:10,Dec:11},EVENTS:{CHAT_IS_VISIBLE:"CHAT_IS_VISIBLE",PREVIEWS_ARE_VISIBLE:"PREVIEWS_ARE_VISIBLE",SMS_SHARED_STATE_UPDATED:"SMS_SHARED_STATE_UPDATED",SHOW_MESSAGE_EDITOR:"SHOW_MESSAGE_EDITOR",SHOW_RETRY_MESSAGE_EDITOR:"SHOW_RETRY_MESSAGE_EDITOR",SHOW_MESSAGE_DELETE_MODAL:"SHOW_MESSAGE_DELETE_MODAL",SINGLE_MESSAGE_DELETED:"SINGLE_MESSAGE_DELETED",ALL_MESSAGES_DELETED:"ALL_MESSAGES_DELETED",START_POLLING:"START_POLLING",STOP_POLLING:"STOP_POLLING",SHOW_SENDING_MESSAGE_RESULT_DIALOG:"SHOW_SENDING_MESSAGE_RESULT_DIALOG",TAB_CHANGED:"TAB_CHANGED",SMS_LIST_DATA_LOADED:"SMS_LIST_DATA_LOADED"},MAX_CHUNKS_NUM:5,SINGLE_SMS_MAX_LENGTH:70,SMS_CHUNK_LENGTH:67,CHUNKED_SMS_MAX_LENGTH:335,ASCII_7BIT_SMS_MAX_LENGTH:160,ASCII_7BIT_SMS_CHUNK_LENGTH:152,ASCII_7BIT_CHUNKED_SMS_MAX_LENGTH:760}})}(),function(){function e(e,t,n,i,a,o,s){var r=this,l=e.$parent.vm,c=o.EVENTS.SHOW_RETRY_MESSAGE_EDITOR;r.isVisible=!1,r.isResultSuccessful=!1,r.messageData=null,r.l10n={};r.show=function(e,t){r.l10n=function(e){var t=e?"success":"failure";return{title:"sms.sending-message-result-modal.".concat(t,"-title"),description:"sms.sending-message-result-modal.".concat(t,"-description")}}(e),r.isResultSuccessful=e,r.messageData=t,r.isVisible=!0,s.increaseStateCounter("openedModalCount")},r.close=function(){return r.l10n={},r.isVisible=!1,r.messageData=null,r.isResultSuccessful=!1,s.decreaseStateCounter("openedModalCount"),t.when({})},r.retry=function(){l.$relay(c,r.messageData),r.close()},e.$on(o.EVENTS.SHOW_SENDING_MESSAGE_RESULT_DIALOG,function(e,t){!function(e){var t=e.response,n=e.messageData,a=!i.containsAnyNdmErrors(t);r.show(a,n)}(t)})}e.$inject=["$scope","$q","_","router","sms","smsConstants","smsSharedState"],angular.module("keenetic").controller("SmsSendingMessageResultModalController",e)}(),function(){function e(e,t,n,i,a,o,s,r){var l=this,c=e.$parent.vm,d=s.EVENTS,p=d.SHOW_MESSAGE_DELETE_MODAL,u=d.PREVIEWS_ARE_VISIBLE,m=d.SHOW_MESSAGE_EDITOR;l.selectedInterfaceId="",l.isLoading=!1,l.dialogs=[],l.isVisible=!1,l.modemIsOff=!1,l.modemStateIsOk=!1,l.modemStateUpdated=!1,l.showSlotsWarning=!1,r.subscribeOnStateChanged(e,function(e){var t=e.dialogs,i=e.currentDialog,a=e.modemIsOff,o=e.modemStateIsOk,s=e.modemStateUpdated,r=e.selectedInterfaceId,d=e.sendersToHide;l.selectedInterfaceId!==r&&(l.isLoading=!0),l.selectedInterfaceId=r,l.modemIsOff=a,l.modemStateIsOk=o,l.modemStateUpdated=s,l.dialogs=t.filter(function(e){return!n.has(d,e.from)}),l.isVisible=!i,l.isVisible&&c.$relay(u)}),l.openDialog=function(e,t){r.setState({currentDialog:n.cloneDeep(e),currentDialogIndex:t})},l.sendNewMessage=function(){c.$relay(m)},l.deleteAllMessages=function(){var e=n.chain(l.dialogs).map(function(e){return e.messages}).flatten().value();c.$relay(p,e)};var f=function(e){var t=a.extractDialogsData(e),i=a.extractSlotsData(e),o=e["nv-total-slots"],s=e["nv-free-slots"];l.freeDeviceSlotsPercentage=Math.round(100*s/o),l.slotsUsed=n.chain(t).map(function(e){return e.messages.length}).sum().value(),l.freeSlotsLeft=n.reduce(i,function(e,t){return e+t.free},0),l.showFreeSlotsWarning=l.modemStateUpdated&&l.modemStateIsOk&&l.freeSlotsLeft<5,r.setState({dialogs:t,sendersToHide:{}})};c.registerSmsListPollCallback(f),e.$on(s.EVENTS.SMS_LIST_DATA_LOADED,function(t,n){f(n.smsListData),l.isLoading=!1,i.forceScopeDigest(e)})}e.$inject=["$scope","$timeout","_","utils","sms","smsUi","smsConstants","smsSharedState"],angular.module("keenetic").controller("SmsPreviewsController",e)}(),function(){function e(e,t,n,i,a){var o=this,s=e.$parent.vm;o.messageText="",o.selectedInterfaceId="",o.isVisible=!1,o.phoneNumber={isValid:!1,value:"",validator:function(e){return!e||i.PHONE_NUMBER_REGEXP.test(e)?null:"errors.invalid-phone"}},o.ui={isLocked:!1,lock:function(){o.ui.isLocked=!0},unlock:function(){o.ui.isLocked=!1},updateFooterStatus:t.debounce(function(e){o.phoneNumber.isValid=e},150,{leading:!0,maxWait:400}),isSendButtonDisabled:function(){return o.ui.isLocked||!o.phoneNumber.isValid||!o.messageText||o.charsLeft<0}};var r=function(){o.phoneNumber.value="",o.messageText="",o.isVisible=!1};o.openPopup=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";o.isVisible||(t&&(o.phoneNumber.value=t),o.isVisible=!0,o.messageText=e,o.onMessageTextChange(o.messageText),a.increaseStateCounter("openedModalCount"))},o.closePopup=function(){r(),a.decreaseStateCounter("openedModalCount")},o.sendMessage=function(){return o.ui.lock(),n.sendMessage(o.selectedInterfaceId,o.phoneNumber.value,o.messageText).then(function(e){var t={response:e,messageData:{to:o.phoneNumber.value,message:o.messageText}};s.$relay(i.EVENTS.SHOW_SENDING_MESSAGE_RESULT_DIALOG,t),r()}).finally(o.ui.unlock)},o.onMessageTextChange=function(e){var t=n.calculateMessageStats(e),i=t.chunksNum,a=t.charsLeft;o.chunksNum=i,o.charsLeft=a},e.$on(i.EVENTS.SHOW_MESSAGE_EDITOR,function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";o.openPopup(t)}),e.$on(i.EVENTS.SHOW_RETRY_MESSAGE_EDITOR,function(e,t){o.openPopup(t.message,t.to)}),a.subscribeOnStateChanged(e,function(e){o.selectedInterfaceId=e.selectedInterfaceId})}e.$inject=["$scope","_","sms","smsConstants","smsSharedState"],angular.module("keenetic").controller("SmsMessageEditorController",e)}(),function(){function e(e,t,n,i,a,o,s,r,l,c,d){var p=this,u=t.$parent.vm,m=c.EVENTS,f=m.SHOW_MESSAGE_DELETE_MODAL,g=m.SHOW_MESSAGE_EDITOR,v=m.SHOW_SENDING_MESSAGE_RESULT_DIALOG,h=m.SINGLE_MESSAGE_DELETED,b=m.ALL_MESSAGES_DELETED,_=m.TAB_CHANGED,y="sim-card",S="storage";p.DATE_FORMAT="dd.MM.yy",p.currentDialogIndex=-1,p.currentDialog=null,p.latestMessageId=null,p.scrollableContinerEl=null,p.isVisible=!1,p.textareaHandlerAssigned=!1,p.simStateIsInvalid=!1,p.selectedInterfaceId="",p.isSendLocked=!1,p.messageInput={text:"",isInFocus:!1,chunks:0,charsLeft:0,reset:function(){var e=p.messageInput;e.text="",e.chunksNum=0,e.charsLeft=0},onChange:function(e){var t=p.messageInput,n=s.calculateMessageStats(e),i=n.chunksNum,a=n.charsLeft;t.chunksNum=i,t.charsLeft=a}},d.subscribeOnStateChanged(t,function(e){var t=e.currentDialog,n=e.simStateIsInvalid,a=e.selectedInterfaceId,r=p.latestMessageId,l=/^sim-\d+$/gim;if(p.selectedInterfaceId=a,p.simStateIsInvalid=n,p.currentDialog=t,p.isVisible=Boolean(t),p.isVisible){p.messages=s.getDialogMessages(o.get(t,"messages",[])).map(function(e){return e.isSeparator||(e.storageType=e.id.match(l)?y:S),e});var c=o.get(t,"latest.id");i(function(){r!==c&&T(),p.latestMessageId=c,E(),k()})}});var w=function(){return o.get(p,"currentDialog.messages",[])},C=t.$watch(function(){return n[0].querySelector(".sms-pool__scroll--dialog")},function(e){e&&(p.scrollableContinerEl=e,C())});u.registerSmsListPollCallback(function(e){if(p.currentDialog){var t=s.extractDialogsData(e),n=o.find(t,{from:p.currentDialog.from});d.setState({currentDialog:n})}}),u.canSwitchTab=function(){return p.messageInput.text?l.confirmLeave(o.noop,"sms.dialog.confirm-leave"):e.when(!0)};var E=function(){var e=w(),t=e.filter(function(e){return!e.read});return s.markMessagesRead(p.selectedInterfaceId,t).then(function(){p.currentDialog&&(p.currentDialog.messages=e.map(function(e){return Object.assign({},e,{read:!0})}))})},I=function(e){if(e&&p.scrollableContinerEl){var t=n[0].getElementById(e);r.scrollIntoView(t,p.scrollableContinerEl)}},T=function(){var e=w(),t=e.filter(function(e){return!e.read}),n=o.first(t)||o.last(e);n&&I(n.id)},k=function e(){if(!p.textareaHandlerAssigned){var a=n[0].querySelector(".sms-dialog__textarea-input");a||i(e,300);var o=angular.element(a),s=function(){r.autosizeTextarea(a,24),I(p.latestMessageId)};o.on("input",s),t.$on("$destroy",function(){o.off("input",s)}),r.autosizeTextarea(a,24),p.textareaHandlerAssigned=!0}};p.showAllDialogs=function(){p.messageInput.reset(),p.isSendLocked=!1,d.setState({currentDialog:null,currentDialogIndex:-1})},p.forwardMessage=function(e){p.simStateIsInvalid||u.$relay(g,e.text)},p.deleteMessage=function(e){var t=[e],n=o.get(p,"currentDialog.from",""),i=w().length-1;u.$relay(f,{messages:t,from:n,otherMessagesCount:i,isSingleMessage:!0})},p.sendMessage=function(){return p.messageInput.charsLeft<0||!p.messageInput.text?e.when(!1):p.isSendLocked?e.when(!1):(p.isSendLocked=!0,s.sendMessage(p.selectedInterfaceId,p.currentDialog.from,p.messageInput.text).then(function(e){var t={response:e,messageData:{to:p.currentDialog.from,message:p.messageInput.text}};p.messageInput.reset(),u.$relay(v,t)}).finally(function(){p.isSendLocked=!1}))},p.deleteAllMessages=function(){var e=w(),t=o.get(p,"currentDialog.from","");u.$relay(f,{messages:e,from:t,otherMessagesCount:0,isSingleMessage:!1})},t.$on(h,function(e,t){var n=t.id;p.currentDialog.messages=p.currentDialog.messages.filter(function(e){return e.id!==n}),p.messages=s.getDialogMessages(p.currentDialog.messages)}),t.$on(b,function(e,t){d.hideSender(t.from),p.showAllDialogs()}),t.$on(h,function(e,t){t.isLast&&d.hideSender(t.from),p.showAllDialogs()}),t.$on(_,function(){p.messageInput.reset()}),t.$on("$destroy",function(){p.messageInput.reset()})}e.$inject=["$q","$scope","$document","$timeout","$window","_","sms","smsUi","modal","smsConstants","smsSharedState"],angular.module("keenetic").controller("SmsDialogController",e)}(),function(){function e(e,t,n,i,a,o){var s=this,r=e.$parent.vm,l="single-message",c="all-dialog-messages";s.isVisible=!1,s.isLocked=!1,s.isInSingleMessageMode=!1,s.messages=[],s.messageSender="",s.isLastMessageInDialog=!1,s.show=function(e){s.messageSender=n.get(e,"from",""),s.isInSingleMessageMode=n.get(e,"isSingleMessage",!1),s.isLastMessageInDialog=0===n.get(e,"otherMessagesCount",-1);var t=s.isInSingleMessageMode?l:c;s.l10n=function(e){return{title:"sms.delete-modal.".concat(e,".title"),text:"sms.delete-modal.".concat(e,".text"),deleteBtn:"sms.delete-modal.".concat(e,".delete-button"),cancelBtn:"sms.delete-modal.".concat(e,".cancel-button")}}(t),s.messages=n.get(e,"messages",[]),s.isVisible=!0,o.increaseStateCounter("openedModalCount")},s.close=function(){return s.isInSingleMessageMode=!1,s.isVisible=!1,s.isLocked=!1,s.messages=[],o.decreaseStateCounter("openedModalCount"),t.when({})},s.deleteMessage=function(){return s.isLocked=!0,i.deleteMessages(s.selectedInterfaceId,s.messages).then(function(){var e=s.isInSingleMessageMode?a.EVENTS.SINGLE_MESSAGE_DELETED:a.EVENTS.ALL_MESSAGES_DELETED,t=s.isInSingleMessageMode?{id:n.get(s.messages,"[0].id",""),from:s.messageSender,isLast:s.isLastMessageInDialog}:{from:s.messageSender};r.$relay(e,t),s.close()})},s.cancel=function(){return s.close()},e.$on(a.EVENTS.SHOW_MESSAGE_DELETE_MODAL,function(e,t){s.show(t)}),o.subscribeOnStateChanged(e,function(e){s.selectedInterfaceId=e.selectedInterfaceId})}e.$inject=["$scope","$q","_","sms","smsConstants","smsSharedState"],angular.module("keenetic").controller("SmsDeleteModalController",e)}(),function(){function e(e,t,n,i,a,o,s,r){var l={no:!0},c=o.constants,d=c.INTERFACE_STATE,p=c.ISP_STATE,u=c.STATE_CATEGORY,m="".concat("wireguard.listen-port",".port"),f=[""],g=function(e){return e?"".concat(e.address,"/").concat(r.maskToCidr(e.mask)):""},v=function(e){var t=_slicedToArray(e.split("/"),2),n=t[0],i=t[1];return{address:n,mask:r.cidrToNetmask(Number(i))}},h=function(e,n){var a=[t.set({},["interface",e,"wireguard","private-key"],n),t.set({},"show.interface",{})];return i.postToRciRoot(a).then(function(n){return t.get(n,"[1].".concat("show.interface",".").concat(e,".").concat("wireguard.public-key"))})},b=function(e){var n=e.allowedSubnets.filter(t.identity).map(v),i=e.keepaliveInterval?{interval:e.keepaliveInterval}:l;return t.chain({}).set("key",e.publicKey).set("comment",e.description||"").set("preshared-key",e.presharedKey||l).set("endpoint.address",e.endpoint).set("allow-ips",n).set("keepalive-interval",i).value()},_=["description","publicKey","presharedKey","endpoint","allowedSubnets","keepaliveInterval"],y=function(e,n,i){var o=t.get(n,"wireguard.peer",[]),s=t.get(e,"wireguard.peer",[]);return o.map(function(e){return Object.assign({},e,{},t.find(s,{"public-key":e.key}))}).map(function(e){return function(e,n){var i=t.get(e,"key",""),o=t.get(e,"preshared-key",""),s=t.get(e,"endpoint.address"),r=t.get(e,"allow-ips",[].concat(f)).map(g),l=t.pick(e,["txbytes","rxbytes"]),c=t.get(e,"comment",""),d=t.get(e,"keepalive-interval.interval",""),p=t.get(e,"last-handshake",0),u=p>n?"":"".concat(p," ").concat(a.getTranslation("time.s"));return{description:c,publicKey:i,presharedKey:o,endpoint:s,allowedSubnets:r,keepaliveInterval:d,txrx:l,status:{icon:e.online?"indicator-online":"indicator-offline",text:e.online?"otherConnections.wireguard.table.peer-status.online":"otherConnections.wireguard.table.peer-status.offline"},lastHandshake:u,publicKeyError:""}}(e,i)})};return{EDITOR_ACTION:{SAVE:"SAVE",REMOVE:"REMOVE",CANCEL:"CANCEL"},INTERFACE_TYPE:"Wireguard",createConnection:function(e){return i.postToRciRoot([t.set({},["interface",e],{})])},deleteConnection:function(e){return i.postAndSave(t.set({},["interface",e],l))},savePrivateKey:h,generateNewKeypair:function(e){return h(e,"")},getPublicKey:function(e){var n=t.set({},"show.interface",{name:e});return i.postToRciRoot(n).then(function(e){return t.get(e,"".concat("show.interface",".").concat("wireguard.public-key"),"")})},saveConnection:function(e,n){var a=e.id,o=e.peers,r=e.peersOnLoad,c=e.description,d=e.isGlobal,p=e.wasGlobalOnLoad,u=e.dnsServers.filter(angular.identity).map(function(e){return s.addressToNameServerObj(e)}),f=n?t.set({},"wireguard.private-key",e.privateKey||""):{},g=e.listenPort?t.set({},m,e.listenPort):t.set({},"wireguard.listen-port",l),h=[].concat(_toConsumableArray(r.map(function(e){var t=e.publicKey;return Object.assign({key:t},l)})),_toConsumableArray(o.map(b))),_={};p&&!d?_=t.set({},"ip.global",l):!p&&d&&(_=t.set({},"ip.global",{auto:!0}));var y=v(e.address),S=[l].concat(_toConsumableArray(u)),w=e.mtu||l,C=e.adjustTcpMss?{pmtu:!0}:l,E=[{description:c},t.set({},"ip.address",y),t.set({},"ip.mtu",w),t.set({},"ip.name-server",S),t.set({},"ip.tcp.adjust-mss",C),t.set({},"wireguard.peer",h),g,f,_].filter(function(e){return!t.isEmpty(e)}).map(function(e){return t.set({},["interface",a],e)});return i.postAndSave(E)},getNewPeerModel:function(){return{description:"",publicKey:"",publicKeyError:"",presharedKey:"",endpoint:"",allowedSubnets:[].concat(f),keepaliveInterval:"30",txrx:{txbytes:0,rxbytes:0}}},getNewConnectionModel:function(e){return{id:e,description:"",isEnabled:!1,publicKey:"",address:"",listenPort:"",currentListenPort:"",mtu:"",dnsServers:[].concat(f),peers:[],peersOnLoad:[],adjustTcpMss:!0,isNew:!0,isGlobal:!1,wasGlobalOnLoad:!1}},registerPollRequest:function(e,n){return e.registerCallback(["show.interface","show.rc.interface","show.system"],function(e){var i=t.get(e,"[0].".concat("show.interface"),{}),a=t.get(e,"[1].".concat("show.rc.interface"),{}),r=t.get(e,"[2].".concat("show.system"),{}),l=Number(r.uptime),c=t.uniqBy([].concat(_toConsumableArray(o.getCurrentlyUsedSubnets(i)),_toConsumableArray(o.getStaticSubnets(a,!1))),function(e){return"".concat(e.ifaceId).concat(e.ip)}),d=o.getInterfaceIdToLabelMap(i),p=t.chain(i).pickBy(function(e){return"Wireguard"===e.type}).map(function(e,n){return function(e,n,i,a){var o=n.description||i,r=Boolean(n.up),l=t.get(e,"wireguard.public-key",""),c=y(e,n,a),d=t.cloneDeep(c),p=t.get(n,"ip.address",!1),u=g(p),v=t.get(n,m,""),h=t.get(e,"wireguard.listen-port",v),b=t.get(n,"ip.mtu",""),_=!t.isEmpty(t.get(n,"ip.tcp.adjust-mss")),S=t.chain(n).get("ip.global",{}).has("enabled").value();return{id:i,description:o,publicKey:l,isEnabled:r,address:u,listenPort:v,currentListenPort:h,mtu:b,adjustTcpMss:_,dnsServers:t.get(n,"ip.name-server",[].concat(f)).map(s.nameServerObjToAddress),peers:c,peersOnLoad:d,isGlobal:S,wasGlobalOnLoad:S,privateKeyIsSet:!0,isNew:!1}}(e,a[n],n,l)}).value(),u=p.map(function(e){return e.listenPort}).filter(t.identity);n({tunnels:p,usedSubnets:c,usedPorts:u,interfaceIdToLabelMap:d})})},peerComparatorFunction:function(e,n){return t.isEqual(t.pick(e,_),t.pick(n,_))},getConnectionState:function(e,t,n){return o.isScheduleOff(t)?o.getInterfaceStatusObject(d.DOWN_ON_SCHEDULE,u.INFO,e):"down"===e.state?o.getInterfaceStatusObject(d.DOWN,u.INFO,e):"down"===e.link?o.getInterfaceStatusObject(d.NO_LINK,u.INFO,e):o.isInternetAvailable(n)?o.getInterfaceStatusObject(d.CONNECTED,u.SUCCESS,e):o.getInterfaceStatusObject(p.NO_INTERNET_ACCESS,u.INFO,e,o.getConnectionStateL10n(p.NO_INTERNET_ACCESS))},addressStringToObject:v}}e.$inject=["$q","_","CONSTANT","router","utils","interfaces","ifaceIpModel","ipV4Service"],angular.module("keenetic").factory("wireguard",e)}(),function(){function e(e,t,n,i,a,o,s,r,l,c){var d=this,p=c.EDITOR_ACTION;d.PRIVATE_KEY_FIELD="wireguard__privateKey",d.isVisible=!1,d.model={},d.ui={isLocked:!1,lock:function(){return d.ui.isLocked=!0,t.when(!0)},unlock:function(){return d.ui.isLocked=!1,t.when(!0)}},d.isPristine=function(t){return e.get(d,"form.".concat(t,".$pristine"),!1)},d.isValid=function(t){return e.get(d,"form.".concat(t,".$valid"),!1)},d.revalidate=function(t){return e.invoke(d,"form.".concat(t,".revalidate"))},d.setPristine=function(t){return e.invoke(d,"form.".concat(t,".$setPristine"))},d.setFormsPristine=function(){e.invoke(d,"form.$setPristine"),e.invoke(d,"peersForm.$setPristine")},d.show=function(n,a,o){return d.peer.isPeerConfigurationChanged=!1,d.dns.isDnsConfigurationChanged=!1,d.model=n,d.modelOnLoad=e.cloneDeep(n),d.usedSubnets=a.filter(function(e){return e.ifaceId!==d.model.id}),d.usedPorts=o.filter(function(e){return e!==d.model.listenPort}),d.model.privateKeyIsSet=!d.model.isNew,d.deferred=t.defer(),d.setFormsPristine(),i(function(){d.isVisible=!0,d.revalidate("wireguard__privateKey")}),d.deferred.promise},d.peer={isPeerConfigurationChanged:!1,comparePeerConfiguration:function(){i(function(){var t=e.differenceWith(d.model.peers,d.model.peersOnLoad,c.peerComparatorFunction),n=e.differenceWith(d.model.peersOnLoad,d.model.peers,c.peerComparatorFunction);d.peer.isPeerConfigurationChanged=0!==t.length||0!==n.length})},addNew:function(){d.model.peers.push(c.getNewPeerModel()),d.peer.comparePeerConfiguration()},remove:function(e){(c.peerComparatorFunction(d.model.peers[e],c.getNewPeerModel())?t.when(!0):r.confirm()).then(function(){d.model.peers.splice(e,1),d.peer.comparePeerConfiguration()})},getSubnets:function(t){return e.get(d.model,"peers.[".concat(t,"].allowedSubnets"),[])},addAllowedSubnet:function(e){d.peer.getSubnets(e).push("")},removeAllowedSubnet:function(e,t){d.peer.getSubnets(e).splice(t,1),d.peer.comparePeerConfiguration()},checkPublicKeys:function(){var t=_slicedToArray(e.chain(d.model.peers).groupBy("publicKey").partition(function(e){return e.length>1}).map(function(t){return e.flatMap(t)}).value(),2),n=t[0],i=t[1];n.forEach(function(e){e.publicKeyError="otherConnections.wireguard.peer.error.public-key-is-not-unique"}),i.forEach(function(e){e.publicKeyError=""})},isPublicKeyUnique:function(){i(function(){return d.peer.checkPublicKeys()})}},d.isListenPortUnique=function(t){if(e.includes(d.usedPorts,Number(t)))return"otherConnections.wireguard.tunnel.error.listen-port-is-already-used"},d.privateKey={validator:function(e){return d.isVisible?e||d.model.privateKeyIsSet?e&&32!==o.atob(e).length?"otherConnections.wireguard.tunnel.error.invalid-private-key":void 0:"errors.required-field":null},save:function(){if(d.isValid("wireguard__privateKey"))return d.ui.lock().then(function(){return c.savePrivateKey(d.model.id,d.model.privateKey)}).then(function(e){d.model.privateKeyIsSet=!0,d.model.publicKey=e,d.setPristine("wireguard__privateKey")}).finally(d.ui.unlock)},generateNewKeypair:function(){return(d.isPristine("wireguard__privateKey")&&!d.model.privateKeyIsSet?t.when(!0):r.confirm()).then(d.ui.lock).then(function(){return c.generateNewKeypair(d.model.id)}).then(function(e){l.success("otherConnections.wireguard.notifications.private-key-updated"),d.model.privateKeyIsSet=!0,d.model.privateKey="",d.model.publicKey=e,d.setPristine("wireguard__privateKey")}).finally(d.ui.unlock)}},d.onPopupClose=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";d.deferred&&d.deferred.resolve({action:e,modelId:t}),d.isVisible=!1},d.save=function(){return d.ui.lock().then(function(){return c.saveConnection(d.model,!d.isPristine("wireguard__privateKey"))}).then(function(){return d.onPopupClose(p.SAVE)}).finally(d.ui.unlock)};var u=function(){return c.deleteConnection(d.model.id).then(function(){return d.setFormsPristine()}).then(function(){return d.onPopupClose(p.REMOVE,d.model.id)}).finally(d.ui.unlock)};d.cancel=function(){var e=d.model.isNew&&d.model.privateKeyIsSet?function(){return u()}:function(){return d.onPopupClose(p.CANCEL)};return d.ui.lock().then(e).finally(d.ui.unlock)},d.deleteConnection=function(){return r.confirm().then(function(){return u()})},d.isConfigurationModified=function(){return e.get(d,"form.modified")||e.get(d,"peersForm.modified")||d.peer.isPeerConfigurationChanged||d.dns.isDnsConfigurationChanged},d.changesCheckerFunction=function(){return d.isConfigurationModified()?r.confirm("confirm-cancelling-changes","stay-leave.leave","stay-leave.stay"):t.when(!0)},d.dns={isDnsConfigurationChanged:!1,addServer:function(){d.model.dnsServers.push(""),d.dns.compareDnsConfiguration()},removeServer:function(e){d.model.dnsServers.splice(e,1),d.dns.compareDnsConfiguration()},compareDnsConfiguration:function(){i(function(){d.dns.isDnsConfigurationChanged=!e.isEqual(d.model.dnsServers.filter(e.identity),d.modelOnLoad.dnsServers.filter(e.identity))})}},d.publicKey={isCopied:!1,copyToClipboard:function(){s.copyToClipboard(d.model.publicKey),d.publicKey.isCopied=!0,i(function(){d.publicKey.isCopied=!1},3e3)}}}e.$inject=["_","$q","$scope","$timeout","$rootScope","$window","utils","modal","notification","wireguard"],angular.module("keenetic").controller("WireguardEditorController",e)}(),function(){function e(e,t,n,i,a,o,s,r,l,c,d){var p=this,u=l.INTERFACE_TYPE,m=l.EDITOR_ACTION,f=d.requester,g=d.EMPTY_VAL_HTML;p.EMPTY_VAL_HTML=g,p.HR_IS_VISIBLE=!1,p.requester=f,p.isAddNewTunnelBtnLocked=!1,p.editConnection=function(e){return p.requester.stopPolling(),p.editor.show(e,p.usedSubnets,p.usedPorts).then(function(e){var t=e.action,i=e.modelId;t===m.REMOVE&&(p.table.data=p.table.data.filter(function(e){return e.id!==i}),o.forceScopeDigest(n)),p.requester.startPolling()})},p.table={columns:[{property:"isEnabled",title:"otherConnections.wireguard.table.description"},{title:"otherConnections.wireguard.table.address"},{property:"peer",title:"otherConnections.wireguard.table.peer"},{property:"sent",title:"otherConnections.wireguard.table.sent"},{property:"received",title:"otherConnections.wireguard.table.received"},{property:"endpoint",title:"otherConnections.wireguard.table.endpoint"},{property:"lastHandshake",title:"otherConnections.wireguard.table.last-handshake"}],dataLoaded:!1,data:[]};var v=function(e){var t=e.map(function(e){return e.id}).map(function(e){return Number(e.replace(u,""))});return"".concat(u).concat(o.firstUnusedId(t))};p.addNewTunnel=function(){if(p.isAddNewTunnelBtnLocked)return t.when(!1);var e=v(p.table.data);return p.isAddNewTunnelBtnLocked=!0,p.requester.stopPolling(),p.editor.show(l.getNewConnectionModel(e),p.usedSubnets,p.usedPorts).then(function(){return p.requester.startPolling()}).finally(function(){p.isAddNewTunnelBtnLocked=!1})},p.configImporter={inputId:"configImporter",fileInputEl:null,fileInputEl$:null,file:null,isLocked:!1,unlockOnDataUpdate:!1,lock:function(){return p.configImporter.isLocked=!0,t.when(!0)},unlock:function(){return p.configImporter.isLocked=!1,t.when(!1)},importFromFile:function(n){if(p.configImporter.isLocked)return t.when(!1);var a=e.get(n,"target.files[0]",null);return a?p.configImporter.lock().then(function(){return c.readConfigFile(a)}).then(function(e){var n,i=v(p.table.data),s=c.parseConfigFile({fileDataAsStr:e,fileName:a.name,newConnectionId:i,usedSubnets:p.usedSubnets});return s.error?(n=s.error===c.IMPORT_FAILURE_REASON.IP_CONFLICT?o.getTranslation("otherConnections.wireguard.notifications.config-import-conflict",null,{connection:s.conflictingSubnet.label}):"otherConnections.wireguard.notifications.config-import-failure",r.error(n),p.configImporter.unlock().then(function(){return t.reject()})):t.all([l.saveConnection(s,!0),t.when(s)])}).then(function(e){var t=e[1],n=l.addressStringToObject(t.address);p.usedSubnets.push(Object.assign({},n,{ifaceId:t.id,ifaceName:t.id})),r.success("otherConnections.wireguard.notifications.config-import-success"),p.requester.poll(),p.configImporter.file=null}).finally(function(){p.configImporter.unlock(),i(function(){return p.configImporter.setOnChangeEventHandler()})}):t.when(!1)},setOnChangeEventHandler:function(){var e=p.configImporter;e.fileInputEl=a[0].getElementById(e.inputId),e.fileInputEl?(e.fileInputEl$=angular.element(e.fileInputEl),e.fileInputEl$.on("change",e.importFromFile),n.$on("destroy",function(){return e.fileInputEl$.off("change",e.importFromFile)})):(e.lock(),i(function(){return e.setOnChangeEventHandler()},300),console.warn("Failed to get DOM Element to upload config files"))}};var h={};i(function(){l.registerPollRequest(p.requester,function(e){p.table.data=e.tunnels.map(function(e){var t=e.id;return h[t]&&(e.isEnabled=h[t],delete h[t]),e.onToggleClick=function(e){return h[t]=e,p.requester.stopPolling(),s.toggleState(t,e).finally(function(){p.requester.startPolling()})},e.tableRows=e.peers.length>0?e.peers:[{dummy:!0}],e}),p.interfaceIdToLabelMap=e.interfaceIdToLabelMap,p.usedPorts=e.usedPorts,p.usedSubnets=e.usedSubnets.map(function(e){return Object.assign({},e,{label:p.interfaceIdToLabelMap[e.ifaceId]})}),p.isReady=!0,p.table.dataLoaded=!0}),p.configImporter.setOnChangeEventHandler(),d.setSectionReady()})}e.$inject=["_","$q","$scope","$timeout","$document","utils","interfaces","notification","wireguard","wireguardConfigImport","otherConnectionsService"],angular.module("keenetic").controller("WireguardController",e)}(),function(){function e(e,t,n,i,a){var o={FAILED_TO_PARSE:"FAILED_TO_PARSE",IP_CONFLICT:"IP_CONFLICT"},s={PrivateKey:"privateKey",PublicKey:"publicKey",PresharedKey:"presharedKey",AllowedIPs:"allowedSubnets",Endpoint:"endpoint",Address:"address",DNS:"dnsServers",PersistentKeepalive:"keepaliveInterval"},r=["DNS","AllowedIPs"],l=/^[A-Za-z0-9+/=]+$/,c=function(e){return l.test(e)&&44===e.length},d={Address:function(t){return e.chain(t).split(",").filter(n.isValidAddressAndCidr).first().value()}},p={DNS:function(e){return n.IPV4_REGEX.test(e)},AllowedIPs:n.isValidAddressAndCidr,Endpoint:function(e){return n.isValidAddressAndPort(e)||i.regexes.domainAndPort.test(e)},PrivateKey:c,PublicKey:c,PresharedKey:c,PersistentKeepalive:function(e){return/^\d+$/.test(e)}},u=/[\r\n]+/g,m=function(t){var n=t.split(u).map(function(e){return e.trim()}).filter(function(t){return t.length>0&&!e.includes([";","#"],t[0])}).reduce(function(e,t){var n=t.trim();if("["===n[0]&&"]"===n.slice(-1)){var i=n.substr(1,n.length-2);e.names.push(i),e.properties.push([])}else e.properties.length>0&&e.properties[e.properties.length-1].push(n);return e},{names:[],properties:[]});return n.names.length===n.properties.length&&e.zip(n.names,n.properties)},f=function(t,n){return e.reduce(t.properties,function(t,n,i){var a=s[i];if(!a)return t;var o,l=p[i]||e.identity,c=(d[i]||e.identity)(n);return o=e.includes(r,i)?c.split(",").map(function(e){return e.trim()}).filter(l):l(c)?c:void 0,e.isUndefined(o)?t:Object.assign({},t,_defineProperty({},a,o))},n)};return{readConfigFile:function(e){var n=new FileReader,i=t.defer();return n.onload=function(e){return i.resolve(e.target.result)},n.onerror=function(){return i.resolve(n.result)},n.readAsText(e),i.promise},parseConfigFile:function(e){var t=e.fileDataAsStr,i=e.fileName,s=e.newConnectionId,r=e.usedSubnets,l=m(t);if(!l)return{error:o.FAILED_TO_PARSE};var c=function(e){return e.map(function(e){return{name:e[0],properties:e[1].reduce(function(e,t){var n=t.indexOf("=");if(-1===n)return e;var i=t.substr(0,n).trim(),a=t.substr(n+1).trim();return Object.assign({},e,_defineProperty({},i,a))},{})}})}(l),d=c.filter(function(e){return"Peer"===e.name}),p=c.filter(function(e){return"Interface"===e.name});if(1!==p.length)return{error:o.FAILED_TO_PARSE};var u=f(p[0],a.getNewConnectionModel(s)),g=n.splitAddressAndCidr(u.address),v=!!g&&n.findConflictingSubnet(g.address,g.mask,r);return g&&v?{error:o.IP_CONFLICT,conflictingSubnet:v}:(u.description=i.replace(".conf",""),u.peersOnLoad=[],u.peers=d.map(function(e){return f(e,a.getNewPeerModel())}).filter(function(e){return e.publicKey}),u)},IMPORT_FAILURE_REASON:o}}e.$inject=["_","$q","ipV4Service","ValidatorManager","wireguard"],angular.module("keenetic").factory("wireguardConfigImport",e)}(),function(){function e(e,t,n,i,a,o,s,r,l,c,d,p,u,m,f,g,v,h){var b=v.IS_DSL_DEVICE||Boolean(r.usbdsl),_=f.getParentDslInterfaceId(),y=a.SINGLE_IP_MASK,S=a.INTERFACE_ROLE,w=a.PPP_AUTH_ALGORITHM,C=m.PPP_TYPE,E=m.VIA_ANY_OPTION,I=m.IKE_INTERFACE_TYPE,T=m.IKEV2_IMPORT_ERROR,k={no:!0},P={Pvc:!0,AccessPoint:!0,WifiStation:!0},A=function(e){return n.sortBy(e,"label")},D=function(e,t){var i=n.get(e,"ip",{});angular.extend(t,e),t.type===C.L2TP&&t.ipsec&&(t.type=C.L2TP_OVER_IPSEC),t.type===I&&(t.peer=n.get(t,"tunnel.destination"),t.type=M(t),t.certificateSubject=n.get(t,"ike.server-certificate-subject",""),t.certificateSelected=!1),t.dns=(i&&i["name-server"]||[]).map(p.nameServerObjToAddress);for(var a=t.dns.length;a<3;a++)t.dns.push();return t.ipConfig=n.get(t,"ip.address.address","")?p.IP_CONFIG_MODE.STATIC:p.IP_CONFIG_MODE.AUTO,t.service=n.get(t,"pppoe.service",""),t.type===C.PPPOE&&t.peer&&(t.pppoePeer=t.peer,delete t.peer),t.algorithm=c.getAuthenticationType(t),t.psk=n.get(t,["ipsec","preshared-key","key"],""),t.ip||(t.ip={}),t.ip.tcp={"adjust-mss":n.get(t,"ip.tcp.adjust-mss",{})},t.mtu=n.get(t,"ip.mtu",""),t.currentName=t["interface-name"],t.currentIpGlobal=n.has(t,"ip.global"),t.currentIpGlobalOrder=n.get(t,"ip.global.order"),t.schedule=t.schedule||"",r.openvpn&&t.openvpn&&(t.via=n.get(t,"openvpn.connect.via","")),t},O=function(e,t,i,a){var o=!!b&&f.getDslInetInterfaceId(a),s=n.chain(e).pickBy("ipoe").mapValues("ipoe").value(),r=c.getInterfaceIdToLabelMap(t),l=n.pickBy(t,function(e){return c.isPublic(e)&&!e.group&&e.mac&&(P[e.type]||e.id===o||s[e.id])}),d=A(n.map(l,function(e){var t=e.id;return{id:t,label:r[t]}})),p=n.mapValues(u.findOtherConnections(e),function(e){var i=n.get(e,"connect.via");i=i?n.get(t,[i,"id"],i):void 0;var a=t[e.id]||n.find(t,function(t){return t.id===e.id});return Object.assign({},a,{via:i})}),m=Object.keys(p);p=n.mapValues(p,function(t){var n=e[t.id];return D(n,t)});var g=c.getAllUsedSubnets(t,e).map(function(e){return Object.assign({},e,{label:r[e.ifaceId]})}),v=A(n.map(n.pickBy(t,function(e){return c.isPublic(e)&&angular.isDefined(e)}),function(e){var t=e.id;return{id:t,label:r[t]}}));return{interfaceIdsByType:c.groupInterfaceIdsByType(t),viaOptionsForPppoe:d,pppIfaces:p,viaIfaces:v,restrictedNets:g,rciInterfaceData:e,ifacesToStat:m,schedulesData:i}},N="show.interface",L="show.rc.interface",x=function(t){var n=new FileReader,i=e.defer();return n.onload=function(e){i.resolve(btoa(e.target.result))},n.onerror=function(){i.resolve({error:n.result})},n.readAsBinaryString(t),i.promise},R=function(e){return e.type===C.L2TP_OVER_IPSEC?C.L2TP:e.type===C.IKEV2||e.type===C.IKEV1?I:e.type},M=function(e){return n.get(e,"ipsec.ikev2")||n.get(e,"ipsec-ikev2-enabled")?C.IKEV2:C.IKEV1};return{PPP_TYPE:C,VIA_ANY_OPTION:E,getInterfaceIdsByType:function(){return o.get("show/interface").then(function(e){return c.groupInterfaceIdsByType(e)})},updateIkeV2CertificateState:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return e.certificateSelected=Boolean(t),e.certificateSelected?e.certificateState=s.getTranslation("otherConnections.ppp.ike-v2.server-certificate.file-selected",null,{file:t.name}):e.certificateState=e.certificateSubject?s.getTranslation("otherConnections.ppp.ike-v2.server-certificate.certificate-imported",null,{certificateSubject:e.certificateSubject}):s.getTranslation("otherConnections.ppp.ike-v2.server-certificate.no-certificate-imported"),e},encodeFileAsBase64:x,getPppModel:function(e){var t=[n.set({},N,{name:e}),n.set({},L,{name:e})];return o.postToRciRoot(t).then(function(t){var i=n.get(t,"[0].".concat(N),{}),a=n.get(t,"[1].".concat(L,".").concat(e),{});return D(a,i)})},getIkeType:M,registerPollRequest:function(t,i){var a=[];return a.push(N),a.push("show.rc.schedule"),a.push(L),a.push("show.schedule"),_&&a.push(n.set({},"show.rc.interface.ipvc",{parent:_})),t.registerCallback(a,function(t){var a=n.get(t[0],N,{}),s=n.get(t[1],"show.rc.schedule",{}),r={interface:[{interface:n.get(t,"[2].".concat(L),{})},{ipvc:n.get(t,"[4].".concat("show.rc.interface.ipvc"),{})}]},l=f.processShowRcInterfaceIpvcData(r,_),c=l.ifaces,d=l.ipvcList,p=n.get(t,"show.schedule",{}),u=O(c,a,s,d),m=u.ifacesToStat,g=u.pppIfaces,v=e.resolve();return m.length>0&&(v=o.post({url:"show/interface/stat",data:m.map(function(e){return{name:e}})})),v.then(function(e){m.forEach(function(t,n){var i=e[n]||{},a=g[t];a.txbytes=i.txbytes,a.rxbytes=i.rxbytes}),u.shSchedules=p,i(u)})})},getData:function(){var e=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i={},a=[{}];return t&&a.push({ipvc:{parent:t}}),n.set(i,N,{}),n.set(i,"show.rc.schedule",{}),n.set(i,L,a),e&&n.set(i,"show.schedule",{}),i}(!1,_);return o.postToRciRoot(e).then(function(e){var t=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=n.get(e,N,{}),a=f.processShowRcInterfaceIpvcData(n.get(e,"show.rc",{}),t),o=a.ifaces,s=a.ipvcList,r=n.get(e,"show.rc.schedule",{});return{shIfaces:i,shSchedules:n.get(e,"show.schedule",{}),ifaces:o,ipvcList:s,schedulesData:r}}(e,_),i=t.ifaces,a=t.shIfaces,o=t.schedulesData,s=t.ipvcList;return O(i,a,o,s)})},save:function(t,i,a,l){var c=R(t),u=t.currentName,m=!i&&!n.includes(u,c),f=function(e,t){var i=R(e),a=e.currentName;if(a&&n.includes(a,i))return a;if(!t[i])return"".concat(i,"0");var o=t[i].map(function(e){return Number(e.replace(i,""))}),r=s.firstUnusedId(o);return"".concat(i).concat(r)}(t,a),g=function(e,t,n){var i=e.currentName,a=R(e);return i&&(t!==i||a===C.L2TP&&e.type!==C.L2TP_OVER_IPSEC&&e.ipsec||n===C.IKEV2&&e.type===C.IKEV1)}(t,f,l),v=n.get(t,"ip.remote.address"),b=n.get(t,"authentication.password"),_=t.dns.filter(angular.identity);_=_.length>0&&[k].concat(_.map(p.addressToNameServerObj));var P,A,D=(A=(P=t).type===d.PPP_TYPE.PPPOE)&&!P.pppoePeer||!A&&!P.peer?k:A?P.pppoePeer:P.peer,O=t.ccp,N=t.description,L=t.mtu,M={via:t.via===E?"":t.via,no:!1},$={ccp:O,description:N,peer:D,connect:M,role:[S.MISC],ip:{tcp:{"adjust-mss":n.get(t,"ip.tcp.adjust-mss.pmtu")?{pmtu:!0}:k},address:t.ipConfig===p.IP_CONFIG_MODE.AUTO?k:[k,{address:t.ip.address.address,mask:y}],remote:t.ipConfig!==p.IP_CONFIG_MODE.AUTO&&v?[k,{address:v,mask:y}]:k,"name-server":_,global:!1,mtu:L||k},ipv6cp:t.ipv6cp||k,authentication:{identity:n.get(t,"authentication.identity","")}};if(i?$.up=k:m&&($.up=Boolean(t.up)),$=function(e,t,n){var i=e.currentIpGlobal;return i&&!e.global?t.ip.global=k:!i&&e.global?t.ip.global={auto:!0}:i&&n?t.ip.global={order:e.currentIpGlobalOrder}:delete t.ip.global,t}(t,$,m),b&&($.authentication.password=b),c===C.PPTP){var F=n.get(t,"encryption.mppe");$.encryption={mppe:F||!1}}if(c===C.PPPOE&&($.pppoe={service:t.service||k},$.ccp=Boolean(t.ccp)),t.algorithm!==w.AUTO&&($.authentication[t.algorithm]=!0),!t.psk||t.type!==C.L2TP_OVER_IPSEC&&t.type!==C.IKEV1?t.psk&&t.type===C.IKEV2&&($.ipsec={"preshared-key":k}):$.ipsec={"preshared-key":{key:t.psk}},r.ip6&&t.ipv6cp&&($.ipv6={address:{auto:!0},prefix:{auto:!0},"name-servers":{auto:!0}}),c===C.OPENVPN){var V=t.openvpn||{};delete $.peer,delete $.ip.remote,delete $.ipv6cp,delete $.ccp,n.get($,"authentication.identity")||delete $.authentication;var U=n.get(V,"config.config")?V.config:k;$.openvpn={"accept-routes":V["accept-routes"],config:U,connect:M},delete $.connect}c===I&&(delete $.peer,delete $.ccp,delete $.connect,delete $.ip.remote,delete $.ip.address,delete $.ip.mtu,delete $.ip["name-server"],delete $.ipv6cp,$.authentication={"eap-mschapv2":!0,identity:n.get(t,"authentication.identity",""),password:b||k},$.tunnel={destination:t.peer},$=n.set($,"ipsec.ikev2",t.type===C.IKEV2)),$.schedule=t.schedule||k;var B=[];return(c===I&&n.get(t,"certificate.file")?x(t.certificate.file).then(function(e){if(e.error){var i=s.getTranslation("otherConnections.ppp.ike-v2.server-certificate.failed-to-read-certificate",null,{file:n.get(t,"certificate.file.name")});h.warning(i)}else $.ipsec["server-certificate"]=e}):e.when(!0)).then(function(){return g&&B.push({interface:{name:u,no:!0}}),B.push(n.set({},["interface",f,"authentication"],k),n.set({},["interface",f],$)),o.postAndSave(B).then(function(e){if(c===I&&o.containsNdmErrorCode(e,T.CERTIFICATE_IMPORT_FAILURE)){var i=s.getTranslation("otherConnections.ppp.ike-v2.server-certificate.invalid-certificate-file",null,{file:n.get(t,"certificate.file.name")});h.showNotificationOncePopupIsClosed("warning",i)}})})},delete:function(e){return o.postAndSave(n.set({},["interface",e],k))}}}e.$inject=["$q","$timeout","_","NDM","CONSTANT","router","utils","components","schedules","interfaces","ifacePppModel","ifaceIpModel","pppPurposeChecker","pppConstants","dslService","usbdslConsts","dslConstants","notification"],angular.module("keenetic").factory("pppConnectionsService",e)}(),function(){function e(e,t,n,i,a,o,s,r,l,c,d,p,u,m,f,g,v){var h=this,b=m.PPP_TYPE,_=m.VIA_ANY_OPTION,y=m.IKEV2_CERTIFICATE_FILESIZE_LIMIT,S=m.IKE_INTERFACE_TYPE,w=m.IKEV2_IMPORT_ERROR,C=v.EMPTY_VAL_HTML,E=v.WIREGUARD_INSTALLED,I=v.formatBytesColumn,T=_;h.HR_IS_VISIBLE=E,h.VIA_ANY_OPTION=_,h.PPPOE_VIA_NOT_SET_OPTION=T,h.PPP_TYPE=b,h.SINGLE_IP_MASK=a.SINGLE_IP_MASK,h.IP_CONFIG_MODE=f.IP_CONFIG_MODE,h.requester=v.requester,h.options={type:m.getPppOptions(),ipConfiguration:f.getModesSelectOptions(!0,!1),authAlgorithm:m.getPppAuthAlgorithmOptions()},h.PPPOE_ONLY=1===h.options.type.length&&h.options.type[0].id===b.PPPOE,h.pppRequiresServerAddress=m.pppRequiresServerAddress;h.ikev2={configurationInput:{onInit:function(e){h.ikev2.configurationInput.api=e},onFileSelect:function(e){if(e){h.pppEditor.lock();var t=s.getTranslation("otherConnections.ppp.ike-v2.import-configuration.failed-to-import-configuration",null,{file:e.name}),a=h.pppEditor.data,o=i.get(h.pppEditor,"pppModelToRestore.type","");n.when(!0).then(function(){return a.isNew||o===b.IKEV2?n.when(!0):u.delete(a.id).then(function(){a.id=null,a.isNew=!0})}).then(function(){return u.encodeFileAsBase64(e)}).then(function(e){var t=function(e,t){if(e.id)return e.id;var n=(h.interfaceIdsByType[t]||[]).map(function(e){return Number(e.replace(t,""))}),i=s.firstUnusedId(n);return"".concat(S).concat(i)}(a,S),n=i.set({},["interface",t,"ipsec","import"],e);return a.isImported=!0,a.id=t,r.postToRciRoot(n)}).then(function(e){return!r.containsNdmErrorCode(e,w.CONFIG_IMPORT_FAILURE)?u.getPppModel(a.id).then(function(e){return h.pppEditor.data=Object.assign({},a,{},e),h.ikev2.certificateInput.api.resetState(),n.when(!0)}):(d.warning(t),h.pppEditor.unlock(),n.when(!1))}).then(function(e){h.ikev2.configurationInput.api.resetState(),h.pppEditor.isPppTypeLocked=e,h.pppEditor.unlock()}).catch(function(e){console.warn("IKEv2 configuration import error: ".concat(e)),d.warning(t),h.pppEditor.unlock(),h.ikev2.configurationInput.api.resetState()})}else h.pppEditor.ikeConfigurationInputApi.resetState()},api:{resetState:i.noop}},certificateInput:{onInit:function(e){h.ikev2.certificateInput.api=e},onFileSelect:function(e){if(e.size>y){var t=s.getTranslation("otherConnections.ppp.ike-v2.server-certificate.certificate-file-is-too-big",null,{file:e.name});return d.warning(t),!1}h.pppEditor.data=u.updateIkeV2CertificateState(h.pppEditor.data,e);var n=i.get(h.pppEditor,"form.certificateFile");i.invoke(n,"$setTouched")},onReset:function(){h.pppEditor.data=u.updateIkeV2CertificateState(h.pppEditor.data,null);var e=i.get(h.pppEditor,"form.certificateFile");i.invoke(e,"$setPristine")},api:{resetState:i.noop}}},h.pppEditor={isVisible:!1,isLocked:!1,isPppTypeLocked:!1,ikeConfigurationInputApi:{resetState:i.noop},lock:function(){return h.pppEditor.isLocked=!0,n.when(h.pppEditor.isLocked)},unlock:function(){return h.pppEditor.isLocked=!1,n.when(h.pppEditor.isLocked)},advancedSettings:{isVisible:!1,getLabel:function(e){var t=e?"hide":"show";return s.getTranslation("otherConnections.ppp.editor.".concat(t,"-advanced-settings"))},showHide:function(){h.pppEditor.advancedSettings.isVisible=!h.pppEditor.advancedSettings.isVisible}},onMppeToggle:function(){return t(function(){i.get(h,"pppEditor.data.encryption.mppe")&&(h.pppEditor.data.ccp=!0)})}},h.pppTable={data:[],dataResponseReceived:!1,columns:{up:{title:"otherConnections.ppp.connection",directive:{name:"ndm-toggle",options:{"label-on":"{{row.connection | escapeHtml}}","label-off":"{{row.connection | escapeHtml}}",description:"row.status","ng-attr-call-on-change":"row.onToggle","ng-class":"{'three-lines-description' : row.hasIpAddress}",name:"tunnel-{{row.id}}-"}}},type:{title:"otherConnections.ppp.type"},txbytes:{title:"otherConnections.ppp.transmitted",modify:I},rxbytes:{title:"otherConnections.ppp.received",modify:I},uptime:{title:"otherConnections.ppp.connected",modify:function(e,t){return t.up?s.getSplittedTime(e):C}}}},h.rciInterfaceData={},h.shSchedules={};var k={};u.registerPollRequest(h.requester,function(e){var t,n=e.pppIfaces,i=e.rciInterfaceData,a=e.schedulesData,o=e.restrictedNets,s=e.shSchedules,r=e.interfaceIdsByType,l=e.viaIfaces,d=e.viaOptionsForPppoe;h.rciInterfaceData=i,h.schedulesData=a,h.pppIfaces=n,h.restrictedNets=o,h.shSchedules=s,h.interfaceIdsByType=r,h.pppTable.dataLoaded=!0,h.pppTable.dataResponseReceived=!0,h.pppEditor.pppOptions=[{id:_,name:"otherConnections.ppp.any"}].concat(_toConsumableArray(l)),h.pppEditor.pppoeOptions=[{id:T,name:"selectbox.select"}].concat(_toConsumableArray(d)),h.pppTable.data=(t=n,Object.keys(t).map(function(e){var n=t[e],i=n.id,a=Boolean(n.up);k[i]&&(a=k[i],delete k[i]),n.via||(n.via=h.pppEditor.pppOptions[0].id);var o=c.determineInterfaceState(n,n.up?(h.shSchedules||{})[n.schedule]:{}),s=!1;o.name===c.constants.INTERFACE_STATE.CONNECTED&&(s=Boolean(n.address),o.text+=s?"\n(".concat(n.address,")"):"");var r={id:i,up:a,status:o,hasIpAddress:s,connection:n.description||e,active:!1,uptime:n.uptime||0,txbytes:n.txbytes,rxbytes:n.rxbytes,name:e,type:n.type,onToggle:function(e){h.requester.stopPolling();var t=function(){e||(r.hasIpAddress=!1,r.status=c.determineInterfaceState({state:"down"})),h.requester.startPolling()};if(r.type===b.L2TP_OVER_IPSEC){var a;if(e)a=!0;else{var o=v.getSharedData("ipsecEntities",[]);a=g.shouldIpsecServiceBeActive(o,n.id)}return g.toggleL2tpIpsec(i,e,a).finally(t)}return k[i]=e,c.toggleState(i,e).finally(t)}};return r})),k={}}),h.pppEditor.edit=function(e){var t=!0===e;h.requester.stopPolling();var n=function(){var n=angular.copy(h.pppEditor.pppOptions),a=angular.copy(h.options.type);t||(n=n.filter(function(t){return t.id!==e.id})),l.pppoe&&(t||e.type!==b.PPPOE)&&(a=a.filter(function(e){return e.id!==b.PPPOE})),h.pppEditor.typeOptions=a,h.previousType=e.type,h.pppEditor.vpnOptions=n,h.pppEditor.data=t?m.getNewPppConnectionModel():angular.copy(h.pppIfaces[e.name]),h.pppEditor.data.up=!t&&Boolean(e.up),h.pppEditor.isNew=t;var o=angular.copy(h.restrictedNets);t||(o=o.filter(function(t){var n=h.pppIfaces[e.name],a=i.get(n,"ip.address.address"),o=i.get(n,"ip.address.mask");return!(a===t.ip&&o===t.mask)})),h.pppEditor.data=u.updateIkeV2CertificateState(h.pppEditor.data,null),h.pppEditor.data.ikev2Configuration=null,h.pppEditor.pppModelToRestore=!t&&i.cloneDeep(h.pppEditor.data),h.pppEditor.isPppTypeLocked=!1,h.pppEditor.restrictedNets=o,h.pppEditor.isVisible=!0,h.pppEditor.advancedSettings.isVisible=!1};if(t)n();else{var a=p.checkIfCanBeAssignedToIsp(e.id,h.rciInterfaceData);a?o.confirm(s.getTranslation("otherConnections.make-ppp-an-isp-tunnel-confirm-text",null,{iface:s.getInterfaceL10n(a)}),"otherConnections.make-ppp-an-isp-tunnel-confirm-yes-btn","otherConnections.make-ppp-an-isp-tunnel-confirm-no-btn").then(function(){return c.assignPppToIsp(e.id,a.id).then(h.requester.startPolling)}).catch(n):n()}},h.pppEditor.pppoeViaValidator=function(e){return e===T?"error":null},h.pppEditor.close=function(){if(!h.pppEditor.isLocked){var e;h.pppEditor.lock();var t=h.pppEditor.data.isNew&&h.pppEditor.data.isImported;if(h.pppEditor.pppModelToRestore&&(h.pppEditor.pppModelToRestore.id!==h.pppEditor.data.id||h.pppEditor.data.isImported))e=(e=i.get(h.pppEditor,"pppModelToRestore.type","")!==i.get(h.pppEditor,"data.type","")&&t?u.delete(h.pppEditor.data.id):n.when(!0)).then(function(){return h.pppEditor.data=h.pppEditor.pppModelToRestore,h.pppEditor.unlock(),h.pppEditor.save()});else e=t?u.delete(h.pppEditor.data.id):n.when(!0);e.then(function(){h.pppEditor.unlock(),h.pppEditor.isVisible=!1,h.requester.startPolling()})}},h.pppEditor.updateTableDataAfterEdit=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return u.getData().then(function(t){var n=i.mapValues(t.pppIfaces,function(e){return e.via=e.via||h.pppEditor.pppOptions[0].id,e});h.pppTable.data=h.pppTable.data.map(function(e){var t=i.find(n,function(t){return t.id===e.id});return t&&(e.via=t.via),e}),e&&(h.pppTable.data=h.pppTable.data.filter(function(t){return t.id!==e})),h.pppIfaces=n,h.pppEditor.isVisible=!1,h.requester.startPolling()})},h.pppEditor.save=function(){if(!h.pppEditor.isLocked){var e=i.get(h.pppEditor,"pppModelToRestore.type","");return h.pppEditor.isLocked=!0,i.invoke(h,"pppEditor.form.$setSubmitted"),u.getInterfaceIdsByType().then(function(t){return u.save(h.pppEditor.data,h.pppEditor.isNew,t,e)}).then(function(){return h.pppEditor.updateTableDataAfterEdit()}).finally(function(){h.pppEditor.isLocked=!1})}},h.pppEditor.delete=function(){return o.confirm().then(function(){if(!h.pppEditor.isLocked){h.pppEditor.isLocked=!0,i.invoke(h,"pppEditor.form.$setSubmitted");var e,t=h.pppEditor.data.id;if(h.pppEditor.data.type===b.L2TP_OVER_IPSEC){var n=v.getSharedData("ipsecEntities",[]),a=g.shouldIpsecServiceBeActive(n,t);e=g.deleteL2tpIpsec(t,a)}else e=u.delete(h.pppEditor.data.id);e.then(function(){return h.pppEditor.updateTableDataAfterEdit(t)}).finally(function(){h.pppEditor.isLocked=!1})}})},v.setSectionReady()}e.$inject=["$scope","$timeout","$q","_","CONSTANT","modal","utils","router","components","interfaces","notification","pppPurposeChecker","pppConnectionsService","pppConstants","ifaceIpModel","ipsecConnectionsService","otherConnectionsService"],angular.module("keenetic").controller("PppController",e)}(),function(){function e(e,t,n,i,a){var o={PPPOE:"PPPoE",PPTP:"PPTP",L2TP:"L2TP",L2TP_OVER_IPSEC:"L2TP/IPSec",OPENVPN:"OpenVPN",SSTP:"SSTP",IKEV2:"IKEv2",IKEV1:"IKEv1"},s=a.PPP_AUTH_ALGORITHM,r=function(){var e=[];return i.pppoe&&e.push({id:o.PPPOE,label:"PPPoE"}),i.pptp&&e.push({id:o.PPTP,label:"PPTP"}),i.l2tp&&e.push({id:o.L2TP,label:"L2TP"}),i.l2tp&&i.ipsec&&e.push({id:o.L2TP_OVER_IPSEC,label:"L2TP/IPsec"}),i.openvpn&&e.push({id:o.OPENVPN,label:"OpenVPN"}),i.sstp&&e.push({id:o.SSTP,label:"SSTP"}),i["ike-client"]&&e.push({id:o.IKEV1,label:"IKEv1"},{id:o.IKEV2,label:"IKEv2"}),e},l=r().filter(function(e){return e.id!==o.PPPOE});return{PPP_TYPE:o,VIA_ANY_OPTION:"any",IKE_INTERFACE_TYPE:"IKE",IKEV2_IMPORT_ERROR:{INSUFFICIENT_CONFIG_DATA:"75369200",CONFIG_IMPORT_FAILURE:"75368600",CERTIFICATE_IMPORT_FAILURE:"75367900"},IKEV2_CERTIFICATE_FILESIZE_LIMIT:16384,getPppOptions:r,getPppAuthAlgorithmOptions:function(){return[{id:s.AUTO,label:"auto"},{id:s.PAP,label:"PAP"},{id:s.CHAP,label:"CHAP"},{id:s.MSCHAP,label:"MS-CHAP"},{id:s.MSCHAP_V2,label:"MS-CHAP v2"}]},pppRequiresServerAddress:function(t){return e.includes([o.PPTP,o.L2TP,o.L2TP_OVER_IPSEC,o.SSTP,o.IKEV1,o.IKEV2],t)},getNewPppConnectionModel:function(){return{isNew:!0,via:"any",type:e.get(l,[0,"id"]),up:!1,ipConfig:t.IP_CONFIG_MODE.AUTO,algorithm:s.AUTO,dns:[],mtu:"",ip:{tcp:{"adjust-mss":{pmtu:!0}}}}}}}e.$inject=["_","ifaceIpModel","ifacePppModel","components","CONSTANT"],angular.module("keenetic").factory("pppConstants",e)}(),function(){function e(e,t,n){var i={no:!0};return{registerPollRequest:function(t,n){t.registerCallback(["show.interface","show.rc.interface"],function(t){var i=e.get(t,"[0].".concat("show.interface"),{}),a=e.get(t,"[1].".concat("show.rc.interface"),{}),o=e.map(e.pickBy(i,function(e){return"TunnelSixInFour"===e.type}),function(t,n){var i=a[n];return{id:n,isNew:!1,isEnabled:Boolean(i.up),isGlobal:e.get(i,"ipv6.force-default",!1),description:t.description||n,ipV4:e.get(i,"ip.remote.address",""),ipV6:e.get(i,"ipv6.address.0",""),ipV6Prefix:e.get(i,"ipv6.prefix.0","")}}),s=o.map(function(e){return Number(e.id.replace("TunnelSixInFour",""))}),r={},l=0;s.forEach(function(e){r[e]=l,l++}),n({tunnels:o,idToRowIdx:r,ids:s})})},saveTunnel:function(t){var a=t.id,o={"force-default":t.isGlobal,address:t.ipV6?[t.ipV6]:i,prefix:t.ipV6Prefix?[t.ipV6Prefix]:i},s={};return e.set(s,"ip.remote.address",t.ipV4),s.type="",s.ipv6=o,s.description=t.description,n.postAndSave(e.set({},["interface",a],s))},deleteTunnel:function(t){return n.postAndSave(e.set({},["interface",t],i))},toggleTunnelState:function(t,i){return n.postAndSave(e.set({},["interface",t],{up:i,type:""}))},getNewTunnelModel:function(e){return{id:"TunnelSixInFour"+t.firstUnusedId(e),isNew:!0,isEnabled:!1,isGlobal:!1,description:"",ipV4:"",ipV6:"",ipV6Prefix:""}},IFACE_TYPE:"TunnelSixInFour"}}e.$inject=["_","utils","router"],angular.module("keenetic").factory("Ipv6To4Service",e)}(),function(){function e(e,t,n,i,a,o,s){var r=this,l=o.EMPTY_VAL_HTML,c=o.ANY_PPP_INSTALLED,d=o.IPSEC_INSTALLED,p=o.WIREGUARD_INSTALLED,u=o.requester,m=s.IFACE_TYPE,f=function(e){return"otherConnections.ipv6to4.tunnel.".concat(e)},g=function(e){return Number(e.replace(m,""))},v=function(){e(function(){r.l10n={yes:a.getTranslation("yes"),no:a.getTranslation("no")}})};v(),t.$on("destroy",n.$on("$translateChangeSuccess",v)),r.requester=u,r.HR_IS_VISIBLE=c||d||p,r.addTunnel=function(){r.requester.stopPolling(),r.editor.model=s.getNewTunnelModel(r.ids),r.editor.isVisible=!0},r.editTunnel=function(e,t){r.requester.stopPolling(),e.rowIdx=t,r.editor.model=e,r.editor.isVisible=!0},r.deleteTunnel=function(e){i.confirm().then(function(){var t=g(e),n=r.ids.indexOf(t);s.deleteTunnel(e).then(function(){r.ids[n]&&r.ids.splice(n,1)}).finally(r.editor.close)})};var h=function(e){return e||l};r.ready=!1,r.table={columns:{isEnabled:{title:"otherConnections.ipv6to4.table.name",width:180,directive:{name:"ndm-toggle",options:{"label-on":"{{row.description | escapeHtml}}","label-off":"{{row.description | escapeHtml}}","ng-attr-call-on-change":"row.onToggle",name:"tunnel-{{row.id}}-"}}},isGlobal:{title:"otherConnections.ipv6to4.table.is-global",modify:function(e){return e?r.l10n.yes:r.l10n.no}},ipV4:f("ipv4-address"),ipV6:{title:f("ipv6-address"),modify:h},ipV6Prefix:{title:f("ipv6-prefix"),modify:h}},dataLoaded:!1,data:[]},r.editor={isVisible:!1,model:{},close:function(){r.editor.model={},r.editor.isVisible=!1,r.requester.startPolling()},save:function(){s.saveTunnel(r.editor.model).then(function(){if(r.editor.model.rowIdx){var e=r.editor.model.rowIdx;if(r.table.data[e]){var t=angular.copy(r.editor.model);delete t.rowIdx,r.table.data[e]=t}}r.ids.push(g(r.editor.model.id))}).finally(r.editor.close)},cancel:function(){r.editor.close()}};var b={};e(function(){s.registerPollRequest(r.requester,function(e){r.ready=!0,r.table.dataLoaded=!0,r.table.data=e.tunnels.map(function(e){return b[e.id]&&(e.isEnabled=b[e.id],delete b[e.id]),e.onToggle=function(t){return b[e.id]=t,r.requester.stopPolling(),s.toggleTunnelState(e.id,t).finally(function(){r.requester.startPolling()})},e}),r.ids=e.ids}),o.setSectionReady()})}e.$inject=["$timeout","$scope","$rootScope","modal","utils","otherConnectionsService","Ipv6To4Service"],angular.module("keenetic").controller("Ipv6To4Controller",e)}(),function(){function e(e,t,n,i,a,o,s,r,l){var c=l.getApps(!0),d=l.APPS,p={no:!0},u=c[d.VPN_IPSEC_VIRTUAL_IP].service,m=[c[d.VPN_IPSEC_VIRTUAL_IP].cryptoMapName,c[d.VPN_IKEV2].cryptoMapName];c[d.VPN_L2TP_OVER_IPSEC].component&&m.push(c[d.VPN_L2TP_OVER_IPSEC].cryptoMapName);var f=function(e){return["","WEBADMIN","IPSEC",e].join("_")},g=function(e,n){var i={},a=[],o=[];return t.forEach(e.map||{},function(e,t){i[t]={enabled:e.enable,type:-1===m.indexOf(t)?"ipsec":"vpn-app"},e.enable?a.push(t):o.push(t)}),t.forEach(n,function(e,t){if(e.ipsec){var n=Boolean(e.up);i[t]={enabled:n,type:"l2tp"},n?a.push(t):o.push(t)}}),{entities:i,enabled:a,disabled:o,enabledCount:a.length}},v=function(e){return{rcInterface:t.get(e,"0.".concat("show.rc.interface"),{}),rcCrypto:t.get(e,"1.".concat("show.rc.crypto"),{})}},h=function(e){var a=function(e){return{"tunnel-enabled":!1,"wait-connections":!1,autoconnect:!1,name:e||"","nail-up":!0,"remote-gateway":"","dead-peer":!0,"dead-peer-interval":30,"local-identity-type":"address","local-identity":"","remote-identity-type":"address","remote-id-address-type":"manual","remote-identity":"",psk:"","ike-version":"ikev2","ike-lifetime":"3600","ike-encryption":["des"],"ike-integrity":["md5"],"ike-dh-group":["1"],"ike-aead":!1,"ike-aead-config":!1,"ike-aead-from-config":!1,"x-auth-mode":"none",mode:"tunnel","sa-lifetime":"3600","sa-encryption":["esp-des"],"sa-integrity":["esp-md5-hmac"],"sa-aead":!1,"sa-aead-config":!1,"sa-aead-from-config":!1,"dh-group-phase2":"","local-network-ip":"","local-network-mask":r.DEFAULT_NETMASK,"remote-network-ip":"","remote-network-mask":r.DEFAULT_NETMASK,"negotiation-mode":"main","lan-ip":[],"lan-mask":"","used-identities":[],"used-names":[],"used-ips":[],"used-routes":[],"ipsec-enabled":!0}}(e),o=n.arrayToQueryData(["show.interface","show.crypto.map","show.rc.service","show.rc.crypto.ike.key"]);return e&&t.set(o,"show.rc.crypto.map",{}),n.postToRciRoot(o).then(function(n){var o=t.get(n,"show.rc.crypto.ike.key",[]),l=t.get(n,"show.crypto.map.crypto_map",{}),c=t.get(n,"show.interface",{}),d=t.get(n,"show.rc.crypto.map",{})[e];a.ipsecEnabled=Boolean(t.get(n,"".concat("show.rc.service",".ipsec"),"")),t.forEach(c,function(e,t){var n=e.address,o=e.mask;if(n&&n!==r.ZERO_IP_ADDRESS&&o&&o!==r.ZERO_IP_ADDRESS&&a["used-ips"].push({ip:n,mask:o}),t===s.LAN){var l=n.split(".");l[l.length-1]=0,a["lan-ip"]=[{ip:l.join("."),mask:o}],a["lan-mask"]=o}"connected"===i.getInterfaceStatus(e).name&&e.global&&e.defaultgw&&(a["local-identity"]=e.address)});var p=t.find(o,{name:e});if(p){var u=p.id,m=p.name,f=p.psk;a.psk=f,a.pskName=m,a["used-identities"].push(u)}return l&&t.forEach(l,function(e,t){var n=e.config;!(e.status.virtual_ip_clients||n.virtual_ip_pool)&&n.remote_peer&&a["used-routes"].push(n.remote_peer),a["used-names"].push(t)}),{connectionObj:a,rcCryptoMap:d}})},b=function(e,i){return n.postAndSave([e,(a=i,t.set({},["service",u],{no:!a}))]);var a};return{IPSEC_NAME_REGEX:/[^a-zA-Z0-9_\\.\-]/g,shouldIpsecServiceBeActive:function(e,t){return!e||e.enabled.filter(function(e){return e!==t}).length>0},getAllIpsecEntities:function(){var e=i.toRciQueryList(["show.rc.interface","show.rc.crypto"]);return n.postToRciRoot(e).then(v).then(function(e){var n=e.rcInterface,i=e.rcCrypto;return t.extend({},g(i,n),{crypto:i})})},registerPollRequest:function(e,n){var s=i.toRciQueryList(["show.crypto.map","show.rc.service","show.rc.crypto",!!o.l2tp&&"show.rc.interface"]);e.registerCallback(s,function(e){var o=function(e){return{cryptoMap:t.get(e,"[0].".concat("show.crypto.map",".crypto_map"),{}),ipsecServiceEnabled:Boolean(t.get(e,"[1].".concat("show.rc.service"),{})[u]),rcCrypto:t.get(e,"[2].".concat("show.rc.crypto"),{}),rcInterface:t.get(e,"[3].".concat("show.rc.interface"),{})}}(e),s=o.cryptoMap,l=o.ipsecServiceEnabled,c=o.rcCrypto,d=o.rcInterface,p=g(c,d),m={};s&&t.forEach(s,function(e,n){var o=e.config,s=e.status;if("yes"!==o.virtual_ip&&"yes"!==o.l2tp){var l=s.phase2_sa_list,c=0;l&&t.forEach(l.phase2_sa||{},function(e){c<Number(e)&&(c=e)});var d,p=l?l.phase2_sa[c]:void 0,u=t.get(s,"phase1.reauth_time"),f=u>0?i.getDate(1e3*u):"-",g=t.get(p,"rekey_time"),v=g>0?i.getDate(1e3*g):"-",h=o.local_network||"",b=h.net===r.ZERO_IP_ADDRESS?r.ZERO_IP_ADDRESS:[h.net,h.mask].join(" / "),_=o.remote_network||"",y=_.net===r.ZERO_IP_ADDRESS?r.ZERO_IP_ADDRESS:[_.net,_.mask].join(" / ");d="PHASE2_ESTABLISHED"===s.state?a.constants.INTERFACE_STATE.CONNECTED:"UNDEFINED"===s.ike_state?a.constants.INTERFACE_STATE.NO_LINK:a.constants.INTERFACE_STATE.STANDING_BY,d="yes"===o.enabled?d:a.constants.INTERFACE_STATE.DOWN;var S=[];o.remote_peer&&S.push(o.remote_peer),o.remote_peer_fallback&&S.push(o.remote_peer_fallback),m[n]={enabled:"yes"===o.enabled,status:"interface-state."+d,name:n,route:S.join(" / "),mode:o.mode,localNetwork:" / "===b?"-":b,remoteNetwork:" / "===y?"-":y,reauth:f,rekey:v}}}),n(m,p,l)})},getConnectionData:function(e){if(!e)return h("").then(function(e){return e.connectionObj});var i;return h(e).then(function(e){return i=e.connectionObj,e.rcCryptoMap}).then(function(a){var o,s=a["set-peer"];i.aclName=t.get(a,"match-address.access-list",f(e)),i.profileName=t.get(a,"set-profile.profile",e),i.transformName=a["set-transform"]["transform-set"],i["tunnel-enabled"]=!0===a.enable&&!0,i.autoconnect=!0===a.connect,i["nail-up"]=a["nail-up"],i["wait-connections"]="any"===s["remote-ip"],i["remote-gateway"]=s["remote-ip"]&&"any"!==s["remote-ip"]?s["remote-ip"]:"",i["used-routes"]=i["used-routes"].filter(function(e){return e!==i["remote-gateway"]});var r=n.objectToQueryData((_defineProperty(o={},"access-list",{acl:i.aclName}),_defineProperty(o,"crypto.ipsec.profile",i.profileName),_defineProperty(o,"crypto.ipsec.transform-set",i.transformName),o));return n.postToRciRoot(t.set({},"show.rc",r))}).then(function(e){var a=t.get(e,"".concat("show.rc",".").concat("crypto.ipsec.profile"),{}),o=t.get(e,"".concat("show.rc",".").concat("crypto.ipsec.transform-set"),{}),s=t.get(e,"".concat("show.rc",".").concat("access-list.0"),{}),r=a[i.profileName]||{},l=o[i.transformName]||{},c=r["identity-local"],d=r["match-identity-remote"];return i.policyName=r.policy,i["local-network-ip"]=s.source,i["local-network-mask"]=s["source-mask"],i["remote-network-ip"]=s.destination,i["remote-network-mask"]=s["destination-mask"],i["dead-peer"]=Boolean(t.get(r,"dpd-interval.interval")),i["dead-peer-interval"]=t.get(r,"dpd-interval.interval",i["dead-peer-interval"]),i["local-identity-type"]=c.type||"",i["local-identity"]=c.id||"",i["remote-identity-type"]=d.type||"",i["remote-identity"]=d.id||"",i["x-auth-mode"]=t.get(r,"xauth.type","none"),i["x-auth-identity"]=t.get(r,"xauth-identity.identity",""),i["x-auth-password"]=t.get(r,"xauth-password.password",""),i.mode=r.mode||"tunnel",i["sa-aead-from-config"]=!0,i["sa-aead-config"]=!0===l.aead,i["sa-aead"]=!0===l.aead,i["sa-encryption"]=l.cypher||["des"],i["sa-encryption-aead"]=l.cypher||["chacha20-poly1305"],i["sa-integrity"]=l.hmac||["esp-md5-hmac"],i["sa-lifetime"]=l.lifetime||"",i["dh-group-phase2"]=l["dh-group"]||[],i["dh-group-phase2-prev"]=angular.copy(i["dh-group-phase2"]),i["sa-integrity-prev"]=angular.copy(i["sa-integrity"]),i["sa-encryption-prev"]=angular.copy(i["sa-encryption"]),i["sa-encryption-aead-prev"]=angular.copy(i["sa-encryption-aead"]),n.post("show/rc/crypto/ike/policy")}).then(function(a){var o=t.get(a,["policy",i.policyName],{});return i.proposalName=o.proposal&&o.proposal[0]||e,i["ike-lifetime"]=o.lifetime,i["ike-version"]=o.mode||"des",i["negotiation-mode"]=o["negotiation-mode"]||"main",n.post("show/rc/crypto/ike/proposal")}).then(function(e){var n=t.get(e,["proposal",i.proposalName],{});return i["ike-aead-from-config"]=!0,i["ike-aead-config"]=!0===n.aead,i["ike-aead"]=!0===n.aead,i["ike-encryption"]=n.encryption||[],i["ike-encryption-aead"]=n.encryption||["chacha20-poly1305"],i["ike-dh-group"]=n["dh-group"]||[],i["ike-integrity"]=n.integrity||[],i["ike-prf"]=n.prf||["sha256"],i["ike-dh-group-prev"]=angular.copy(i["ike-dh-group"]),i["ike-integrity-prev"]=angular.copy(i["ike-integrity"]),i["ike-prf-prev"]=angular.copy(i["ike-prf"]),i["ike-encryption-prev"]=angular.copy(i["ike-encryption"]),i["ike-encryption-aead-prev"]=angular.copy(i["ike-encryption-aead"]),i})},save:function(e){function i(n,i){for(var a=[],o=e[n]||[],s=e[n+"-prev"]||[],r=0;r<s.length;r++)if(!t.includes(o,s[r])){var l=Object.assign({},p);l[i]=s[r],a.push(l)}for(var c=0;c<o.length;c++){var d={};d[i]=o[c],a.push(d)}return a}var a=e.name,o={},s={},r={},l=e.proposalName||a,c={},d=e.policyName||a,u={},m=e.transformName||a,g={},v=e.profileName||a;e.aclName=e.aclName||f(a),r[l]={"dh-group":i("ike-dh-group","dh-group")},e["ike-aead"]?(e["ike-aead-from-config"]||(r[l].aead=!0),r[l].encryption=i("ike-encryption-aead","encryption"),r[l].prf=i("ike-prf","prf")):(r[l].encryption=i("ike-encryption","encryption"),r[l].integrity=i("ike-integrity","integrity")),c[d]={proposal:l,lifetime:e["ike-lifetime"],mode:e["ike-version"]},"ikev1"===e["ike-version"]&&(c[d]["negotiation-mode"]=e["negotiation-mode"]||p),u[m]={lifetime:e["sa-lifetime"]?e["sa-lifetime"]:p,"dh-group":i("dh-group-phase2","dh-group")},e["sa-aead"]?(e["sa-aead-from-config"]||(u[m].aead=!0),u[m].cypher=i("sa-encryption-aead","cypher")):(u[m].cypher=i("sa-encryption","cypher"),u[m].hmac=i("sa-integrity","hmac"));var h="gateway"===e["remote-identity-type"]?e["remote-gateway"]:e["remote-identity"],b=e["x-auth-mode"]&&"none"!==e["x-auth-mode"];e["remote-identity-type"]="gateway"===e["remote-identity-type"]?"address":e["remote-identity-type"],g[v]={"authentication-local":{auth:"pre-share"},policy:d,"dpd-interval":e["dead-peer"]?{interval:e["dead-peer-interval"]}:p,"identity-local":e["local-identity"]?{type:e["local-identity-type"],id:e["local-identity"]}:p,"match-identity-remote":{type:e["remote-identity-type"],id:h},xauth:b?{type:e["x-auth-mode"]}:p,mode:e.mode},"client"===e["x-auth-mode"]&&(b?(g[v]["xauth-identity"]={identity:e["x-auth-identity"]},g[v]["xauth-password"]={password:e["x-auth-password"]}):(g[v]["xauth-identity"]=p,g[v]["xauth-password"]=p));var _=[{name:e.pskName||a,psk:e.psk,id:h,type:e["remote-identity-type"]}];return s[a]={connect:Boolean(e.autoconnect),"nail-up":Boolean(e["nail-up"]),"set-peer":{"remote-ip":e["wait-connections"]?"any":e["remote-gateway"],no:!e["remote-gateway"]&&!e["wait-connections"]},"set-profile":{profile:v},"set-transform":{"transform-set":a},"set-tcpmss":{"mss-value":"pmtu"},"match-address":{"access-list":e.aclName}},e.isNew&&(s[a].enable=!1),o["access-list"]=[Object.assign({acl:e.aclName},p),{acl:e.aclName,action:"permit",source:e["local-network-ip"],"source-mask":e["local-network-mask"],destination:e["remote-network-ip"],"destination-mask":e["remote-network-mask"],protocol:"ip"}],o.crypto={ike:{proposal:r,policy:c,key:_},ipsec:{"transform-set":u,profile:g},map:s},e["tunnel-enabled"]&&!e.ipsecEnabled&&(o.service={ipsec:{}}),n.postAndSave(o)},delete:function(e,t){var n=e.name,i=function(e){return _defineProperty({},e,p)};return b({crypto:{ike:{proposal:i(e.proposalName||n),policy:i(e.policyName||n),key:[{name:e.pskName||n,no:!0}]},ipsec:{"transform-set":i(e.transformName||n),profile:i(e.profileName||n)},map:i(n)},"access-list":[{acl:f(n),no:!0}]},t)},toggle:function(e,n,i){return b(t.set({},"crypto.map",_defineProperty({},String(e),{enable:n})),i)},deleteL2tpIpsec:function(e,n){return b(t.set({},["interface",e],p),n)},toggleL2tpIpsec:function(e,n,i){return b(t.set({},["interface",e,"up"],{no:!n}),i)}}}e.$inject=["$q","_","router","utils","interfaces","components","NDM","CONSTANT","appsPresets"],angular.module("keenetic").factory("ipsecConnectionsService",e)}(),function(){angular.module("keenetic").factory("ipsecPresetsService",function(){var e=function(e){return"".concat("otherConnections.ipsec.editor",".").concat(e)},t={};return t.localIdentityTypeList=[{id:"address",name:e("identity-option-address")},{id:"fqdn",name:e("identity-option-fqdn")},{id:"dn",name:e("identity-option-dn")},{id:"email",name:e("identity-option-email")}],t.remoteIdentityTypeList=[{id:"address",name:e("identity-option-address")},{id:"gateway",name:e("remote-gateway-address")},{id:"fqdn",name:e("identity-option-fqdn")},{id:"dn",name:e("identity-option-dn")},{id:"email",name:e("identity-option-email")},{id:"any",name:e("identity-option-any")}],t.remoteIdAddressTypeList=[{id:"auto",name:e("remote-identity-address-type-auto")},{id:"manual",name:e("remote-identity-address-type-manual")}],t.ikeVersionList=[{id:"ikev1",name:"IKE v1"},{id:"ikev2",name:"IKE v2"}],t.xAuthModeList=[{id:"none",name:"None"},{id:"client",name:"Client"},{id:"server",name:"Server"}],t.negotiationModeList=[{id:"main",name:"Main"},{id:"aggressive",name:"Aggressive"}],t.ipsecModeList=[{id:"tunnel",name:"Tunnel"},{id:"transport",name:"Transport"}],t.ikeEncryption={des:"DES","3des":"3DES","aes-cbc-128":"AES-128","aes-cbc-192":"AES-192","aes-cbc-256":"AES-256","aes-ctr-128":"AES-128-CTR","aes-ctr-192":"AES-192-CTR","aes-ctr-256":"AES-256-CTR"},t.ikeEncryptionAead={"aes-128-ccm-8":"AES-128-CCM-8","aes-192-ccm-8":"AES-192-CCM-8","aes-256-ccm-8":"AES-256-CCM-8","aes-128-ccm-12":"AES-128-CCM-12","aes-192-ccm-12":"AES-192-CCM-12","aes-256-ccm-12":"AES-256-CCM-12","aes-128-ccm-16":"AES-128-CCM-16","aes-192-ccm-16":"AES-192-CCM-16","aes-256-ccm-16":"AES-256-CCM-16","aes-128-gcm-8":"AES-128-GCM-8","aes-192-gcm-8":"AES-192-GCM-8","aes-256-gcm-8":"AES-256-GCM-8","aes-128-gcm-12":"AES-128-GCM-12","aes-192-gcm-12":"AES-192-GCM-12","aes-256-gcm-12":"AES-256-GCM-12","aes-128-gcm-16":"AES-128-GCM-16","aes-192-gcm-16":"AES-192-GCM-16","aes-256-gcm-16":"AES-256-GCM-16","chacha20-poly1305":"CHACHA20-POLY1305","chacha20-poly1305-256":"CHACHA20-POLY1305-256"},t.ikeIntegrity={md5:"MD5",sha1:"SHA1",sha256:"SHA256",sha384:"SHA384",sha512:"SHA512"},t.ikePrf={md5:"MD5",sha1:"SHA1",sha256:"SHA256",sha384:"SHA384",sha512:"SHA512","aes-xcbc":"AES-XCBC","aes-cmac":"AES-CMAC"},t.ikeDhGroup=["1","2","5","14","15","16","17","18","25","26","19","20","21","31","32"],t.saEncryption={"esp-des":"DES","esp-3des":"3DES","esp-aes-128":"AES-128","esp-aes-192":"AES-192","esp-aes-256":"AES-256","esp-aes-128-ctr":"AES-128-CTR","esp-aes-192-ctr":"AES-192-CTR","esp-aes-256-ctr":"AES-256-CTR","esp-null":"NULL"},t.saEncryptionAead={"esp-aes-128-ccm-8":"AES-128-CCM-8","esp-aes-192-ccm-8":"AES-192-CCM-8","esp-aes-256-ccm-8":"AES-256-CCM-8","esp-aes-128-ccm-12":"AES-128-CCM-12","esp-aes-192-ccm-12":"AES-192-CCM-12","esp-aes-256-ccm-12":"AES-256-CCM-12","esp-aes-128-ccm-16":"AES-128-CCM-16","esp-aes-192-ccm-16":"AES-192-CCM-16","esp-aes-256-ccm-16":"AES-256-CCM-16","esp-aes-128-gcm-8":"AES-128-GCM-8","esp-aes-192-gcm-8":"AES-192-GCM-8","esp-aes-256-gcm-8":"AES-256-GCM-8","esp-aes-128-gcm-12":"AES-128-GCM-12","esp-aes-192-gcm-12":"AES-192-GCM-12","esp-aes-256-gcm-12":"AES-256-GCM-12","esp-aes-128-gcm-16":"AES-128-GCM-16","esp-aes-192-gcm-16":"AES-192-GCM-16","esp-aes-256-gcm-16":"AES-256-GCM-16","esp-chacha20-poly1305":"CHACHA20-POLY1305","esp-chacha20-poly1305-256":"CHACHA20-POLY1305-256","esp-null":"NULL"},t.saIntegrity={"esp-md5-hmac":"MD5","esp-sha1-hmac":"SHA1","esp-sha256-hmac":"SHA256"},t.dhGroupPhase2=["1","2","5","14","15","16","17","18","25","26","19","20","21","31","32"],function(){return angular.copy(t)}})}(),function(){function e(e,t,n,i,a,o,s,r){var l=this,c=o.ANY_PPP_INSTALLED,d=o.WIREGUARD_INSTALLED;l.HR_IS_VISIBLE=c||d;var p=r(),u=function(e){return"otherConnections.ipsec.".concat(e)};l.requester=o.requester,l.ipsecEditor={isVisible:!1,nameValidator:function(e){if(s.IPSEC_NAME_REGEX.test(e))return"otherConnections.ipsec.error.invalid-name"},advancedSettings:{isVisible:!1}},l.lists={mask:i.idsToOptions(a.getMasksArray(),t.identity),ipsec:angular.copy(p)},l.ipsecTable={data:{},dataLoaded:!1,connections:!1,columns:{name:"otherConnections.ppp.connection",route:u("route"),mode:u("mode"),localNetwork:u("local-network"),remoteNetwork:u("remote-network"),reauthRekey:u("rekey-time")}};var m={};s.registerPollRequest(l.requester,function(e,n,i){for(var a in e)t.has(m,a)&&(e[a].enabled=m[a]),l.ipsecTable.data[a]=e[a];for(var s in m={},l.ipsecTable.data)e[s]||delete l.ipsecTable.data[s];o.setSharedData("ipsecEntities",n),o.setSharedData("ipsecServiceEnabled",i),l.ipsecEntities=n,l.ipsecServiceEnabled=i,l.ipsecTable.dataLoaded=!0,l.ipsecTable.connections=Object.keys(l.ipsecTable.data).length}),l.ipsecEditor.edit=function(e,t){"toggle"!==e.target.className&&l.ipsecEditor.openEditor(t||"")},l.ipsecEditor.addConnection=function(){l.ipsecEditor.openEditor("")},l.ipsecEditor.openEditor=function(e){l.requester.stopPolling(),l.ipsecEditor.loading=!0,l.ipsecEditor.isVisible=!0,s.getConnectionData(e).then(function(n){l.ipsecEditor.data=n,l.ipsecEditor.isNew=!e,l.ipsecEditor.loading=!1,t.invoke(l,"ipsecEditor.form.$setPristine")})},l.ipsecEditor.close=function(){l.ipsecEditor.isVisible=!1,l.requester.startPolling()},l.ipsecEditor.save=function(){l.ipsecEditor.data.isNew=l.ipsecEditor.isNew,s.save(t.cloneDeep(l.ipsecEditor.data)).then(l.ipsecEditor.close)},l.ipsecEditor.delete=function(){n.confirm().then(function(){var e=s.shouldIpsecServiceBeActive(l.ipsecEntities,l.ipsecEditor.data.name);s.delete(l.ipsecEditor.data,e).then(l.ipsecEditor.close)})},l.ipsecEditor.toggle=function(e,t){var n;return n=!!e||s.shouldIpsecServiceBeActive(l.ipsecEntities,t),l.requester.stopPolling(),m[t]=e,s.toggle(t,e,n).finally(function(){l.requester.startPolling()})},l.ipsecEditor.onSaEncriptionChange=function(){var n=t.includes(l.ipsecEditor.data["sa-encryption"],"esp-null");e(function(){t.includes(l.ipsecEditor.data["sa-encryption"],"esp-null")&&(n?l.ipsecEditor.data["sa-encryption"].splice(1,1):l.ipsecEditor.data["sa-encryption"]=["esp-null"])})},l.ipsecEditor.getIdentityValidators=function(e){switch(t.get(l.ipsecEditor,["data","".concat(e,"-identity-type")])){case"address":return"required,ip";case"dn":case"fqdn":case"email":return"required,ascii";default:return""}},l.ipsecEditor.updateRemoteIdentityTypes=function(){e(function(){var e=angular.copy(p.remoteIdentityTypeList);l.ipsecEditor.data["wait-connections"]&&"ikev1"===l.ipsecEditor.data["ike-version"]&&(e=[e.pop()],l.ipsecEditor.data["remote-identity-type"]=e[0].id),l.lists.ipsec.remoteIdentityTypeList=e})},o.setSectionReady()}e.$inject=["$timeout","_","modal","utils","ipV4Service","otherConnectionsService","ipsecConnectionsService","ipsecPresetsService"],angular.module("keenetic").controller("IpsecController",e)}(),function(){function e(e,t,n,i,a,o,s,r,l,c,d,p,u,m,f,g){var v=this,h=t.$parent.vm;v.IPV6_INSTALLED=f.IPV6_INSTALLED,v.PINGCHECK_INSTALLED=f.PINGCHECK_INSTALLED,v.PPP_AUTH_ALGORITHM=s.PPP_AUTH_ALGORITHM,v.CELLULAR_STANDARD=f.CELLULAR_STANDARD,v.progress=0,v.isReady=!1,v.simApn="",v.l10nOverride={descriptionLabel:"usbqmi.connection-name"},v.NDM_CONNECTION_STATE=f.NDM_CONNECTION_STATE;var b=function(e){return e.map(function(e){var t=o.get(e,"band","");return{id:t,band:t,checked:o.get(e,"checked",!1),label:r.getTranslation("usbqmi.additional-settings.frequency-bands.band-x",null,{band:t})}})},_=function(e){v.options=f.MODEL_BAND_PROPS.reduce(function(t,n){return t[n]=o.get(e,["bandOptions",n],[]),t},v.options)},y=function(){v.options=f.MODEL_BAND_PROPS.reduce(function(e,t){var n=v.model[t];return e[t]=e[t].map(function(e){return Object.assign({},e,{checked:n.includes(e.id)})}),e},v.options)},S=function(){v.options.umtsFddBands=b(v.options.umtsFddBands),v.options.lteFddBands=b(v.options.lteFddBands),v.options.lteTddBands=b(v.options.lteTddBands)};t.$on("$destroy",a.$on("$translateChangeSuccess",function(){return i(S)})),v.options={authenticationType:f.getAuthenticationTypeOptions(),cellularStandard:f.getCellularStandardOptions(),umtsFddBands:[],lteFddBands:[],lteTddBands:[]},v.ui={saveIsInProgress:!1,isLocked:!1,isParentLocked:!1,isBandsDataVisible:!1,isBandsDataLoadInProgress:!1,lock:function(){return v.ui.isLocked=!0,e.when(!0)},unlock:function(){return v.ui.isLocked=!1,e.when(!0)}},v.isPlugged=!1,v.interfaceId="",v.statusCallbackRegistered=!1,v.connectionInfo=[],v.connectionInfoInterfaceId="",v.connectionInfoCallbackRegistered=!1;var w=function(){v.connectionInfo=[],r.forceScopeDigest(t)};g.subscribeOnStateChanged(t,function(e){var t=e.interfaceId;v.interfaceId!==t&&(v.simApn="",v.status="",v.ui.isBandsDataVisible="",v.isPlugged=!1,v.ui.lock().then(function(){return C(t,!0)}).then(function(){return E()}).finally(function(){v.ui.saveIsInProgress||v.ui.unlock()})),v.interfaceId=t}),v.onBandsSelectorToggle=function(e){e&&(f.MODEL_BAND_PROPS.every(function(e){return 0===v.options[e].length})?(v.ui.isBandsDataLoadInProgress=!0,m.getBandsData(v.interfaceId).then(function(e){v.ui.isBandsDataLoadInProgress=!1,_(e),S(),v.model=Object.assign({},v.model,{},e.model),y(),o.invoke(v,"form.bandsSubform.$setPristine")})):v.ui.isBandsDataLoadInProgress=!1)};var C=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return m.getConfiguration(e,t).then(function(n){return v.savedModel=o.cloneDeep(n.model),t?(_(n),v.model=n.model,S()):v.model=Object.assign({},n.model,{},o.pick(v.model,f.MODEL_BAND_PROPS)),y(),g.setState({simState:n.simState,pinAttemptsLeft:n.pinAttemptsLeft}),v.isPlugged=n.isPlugged,v.isRemovable=e!==f.INTERFACE_ID,v.statusCallbackRegistered?n:(m.requester.registerDynamicCallback(function(){var e=o.get(v.model,"general.savedSchedule","");return v.ui.saveIsInProgress?[]:m.getStateQueries(v.interfaceId,e)},function(e){var t=o.get(v.model,"general.savedSchedule",""),n=m.destructureStateResponses(e),i=n.showInterfaceData,a=n.showSchedule,s=o.get(a,t,{}),r=m.getConnectionStateObject(i,s);v.simApn=i.apn,v.status=r.name===f.NDM_CONNECTION_STATE.UNKNOWN?{}:r,v.ui.saveIsInProgress||v.ui.unlock()}),v.statusCallbackRegistered=!0,v.connectionInfoCallbackRegistered||(m.requester.registerDynamicCallback(function(){return v.connectionInfoInterfaceId=v.model.id,{query:m.getConnectionInfoQueries(v.savedModel),dataForCallback:v.model.id}},function(e,t){var n=m.processConnectionInfoResponses(e);v.interfaceId===t?v.connectionInfo=m.getConnectionInfo(n):w()}),v.connectionInfoCallbackRegistered=!0),i(function(){return m.requester.poll()}),n)})},E=function(){return o.invoke(v,"form.$setPristine")},I=function(){return o.invoke(v,"form.reset")};a.$on(s.events.TAB_CHANGE_STARTED,w),t.$on(c.USBQMI_TAB_ACTIVE,function(){m.requester.startPolling()}),t.$on(c.EXTERNAL_MODEM_TAB_ACTIVE,function(){m.requester.stopPolling()});var T=function(e){return C(e,!0).then(function(){m.requester.startPolling(),E(),h.onSwitchFromUsbQmiTab=function(){return!o.get(v,"form.modified")||(a.$broadcast(c.STOP_TABS_SYNC),l.confirmLeave(function(e){return I(),m.requester.stopPolling(),e&&a.$broadcast(c.START_TABS_SYNC),e}))},v.ui.unlock(),v.progress=100,v.isReady=!0})};v.getApnPlaceholder=function(){return v.simApn?r.getTranslation("usbqmi.additional-settings.sim-apn-value",null,{apn:v.simApn}):""},v.toggleUsbQmiState=function(e){return v.ui.lock().then(function(){return p.toggleState(v.model.id,e)}).then(function(){return m.requester.poll()}).finally(function(){return v.ui.unlock()})},v.save=function(){if(!v.ui.isLocked)return v.ui.saveIsInProgress=!0,v.ui.lock(),m.saveConfiguration(v.model,v.options).then(function(){return C(v.interfaceId,!1)}).then(E).finally(function(){v.ui.unlock(),v.ui.saveIsInProgress=!1})},v.cancel=function(){v.ui.isLocked||I()},v.startScan=function(){n.go("controlPanel.modems.airScan",{interfaceId:v.interfaceId})},v.removeConnection=function(){a.$broadcast(c.STOP_TABS_SYNC),m.requester.stopPolling(),v.ui.lock();var e=function(){v.ui.unlock(),m.requester.startPolling(),a.$broadcast(c.START_TABS_SYNC)};return l.confirm("modems.editor.delete-confirm").then(function(){m.removeConnection(angular.copy(v.model)).then(function(t){d.containsAnyNdmErrors(t)?(u.info("modems.editor.failed-to-delete-modem",1500),e()):(u.success("modems.editor.deleted",1500),a.$broadcast(c.CONNECTION_REMOVED))})},e)};var k=[a.$on(c.LOCK_UI,function(){v.ui.isParentLocked=!0}),a.$on(c.UNLOCK_UI,function(){v.ui.isParentLocked=!1})];!function(){if(v.interfaceId)return T(v.interfaceId);var t=e.defer();(function e(){var n=g.getState();n.interfaceId?(v.interfaceId=n.interfaceId,T(v.interfaceId).then(t.resolve)):i(e,500)})(),t.promise}(),t.$on("$destroy",function(){m.requester.stopPolling(),m.requester.clearCallbacks(),k.forEach(function(e){return e()})})}e.$inject=["$q","$scope","$state","$timeout","$rootScope","_","CONSTANT","utils","modal","modems","router","interfaces","notification","usbQmi","usbQmiConstants","usbQmiSharedState"],angular.module("keenetic").controller("UsbQmiController",e)}(),function(){function e(e,t){var n=function(e){return{system:{set:{name:"dev.usb.force_usb2",value:e?"1":"0"}}}};return{request:{initialPaths:["show.rc.system.set"],pollPaths:["ls"]},forceUsb2Mode:function(e){return t.postAndSave(n(e))},forceUsb2ModeQuery:n}}e.$inject=["_","router"],angular.module("keenetic").factory("usbPorts",e)}(),function(){function e(e,t,n,i,a,o,s,r){var l=this,c=o.profile.features;l.isReady=!1,l.flashDriveIsInserted=!1,l.selectboxes=[],l.portOptions=[{id:"usb2",name:"USB 2.0"},{id:"usb3",name:"USB 3.0"}],l.onLoad=function(){l.initialRequestCallbackId=l.requester.registerCallback(r.request.initialPaths,l.onInit)},l.onInit=function(e){l.requester.unregisterCallback(l.initialRequestCallbackId),l.requester.registerCallback(r.request.pollPaths,function(e){var t=_slicedToArray(e,1)[0];l.flashDriveIsConnected=s.getUsbDrivesListFromLsResponse(t).length>0});var n=t.get(e,"[0].show.rc.system.set",{})["dev.usb.force_usb2"]||{value:"0"};l.selectboxes.push({options:angular.copy(l.portOptions),model:"1"===n.value?"usb2":"usb3",isDisabled:!1});var i=c.usb_3_first?"push":"unshift";l.selectboxes[i]({options:angular.copy(l.portOptions).slice(0,1),model:"usb2",isDisabled:!0}),l.isReady=!0},l.save=function(){return t.get(l,"form.modified")?r.forceUsb2Mode(!l.selectboxes.some(function(e){return"usb3"===e.model})):e.when(!0)}}e.$inject=["$q","_","router","utils","components","NDM","storage","usbPorts"],angular.module("keenetic").controller("UsbPortsController",e)}(),function(){function e(e,t,n,i){var a=n.NTP_SERVICE_NAME;return{request:{initialPaths:["show.rc.service","show.system","show.clock.date","show.clock.timezone-list","show.rc.ntp.server"],pollPaths:[]},constant:{NTP_SERVICE_NAME:a},processClockData:function(e,t){var n=e.timezones.tz,i=t.tz[0],a=[];return n.forEach(function(e){var t=e.stdoffset/3600;a.push({key:e.locality,utc:t,value:"UTC"+(t>=0?"+":"")+t+"  "+e.locality})}),{options:a.sort(function(e,t){return e.utc===t.utc?e.key>t.key?1:-1:e.utc>t.utc?1:-1}).map(function(e){return{id:e.key,label:e.value}}),value:i.locality}},saveSettings:function(e){return i.postAndSave(function(e){var n={};t.set(n,"clock.timezone",{locality:e.timezone}),n.hostname=e.hostname,n.domainname=e.domainname;var i=t.set({},"server",e.ntpServers.map(function(e){return e.name}));if(!e.isSystemTimeAutosynced){var o=e.date.split("-").map(Number),s=e.time.split(":").map(Number);t.set(n,"clock.date",{day:o[0],month:o[1],year:o[2],hour:s[0],min:s[1],sec:s[2]})}return{system:n,service:_defineProperty({},a,{no:!e.isSystemTimeAutosynced}),ntp:i}}(e)).then(n.resetInternalTimer)}}}e.$inject=["$q","_","keeneticTime","router"],angular.module("keenetic").factory("systemSettingsService",e)}(),function(){function e(e,t,n,i,a,o,s,r){var l=this,c=r.constant.NTP_SERVICE_NAME;l.isReady=!1,l.secondsPassed=0,l.timerHandle=null;l.onInit=function(t){l.requester.unregisterCallback(l.initialRequestCallbackId);var i=o.get(t,"[1].show.system",{}),a=o.get(t,"[2].show.clock",{}),s=o.get(t,"[4].show.rc.ntp.server",[]).map(function(e){return{name:e,error:""}}),d=a.date;l.ntpServersOnLoad=s.map(function(e){return e.name}),l.ntpConfigChanged=!1;var p=r.processClockData(o.get(t,"[3].show.clock.timezone-list",{}),d),u=o.get(t,"[0].show.rc.service.".concat(c),!1),m=function(e,t){var n=o.padStart(e.hour,2,"0"),i=o.padStart(e.min,2,"0"),a=o.padStart(e.sec,2,"0"),s=o.padStart(e.day,2,"0"),r=o.padStart(e.month,2,"0"),l=e.year,c=t?"":"".concat(o.padStart(n,2,"0"),":").concat(o.padStart(i),":").concat(a);return{date:t?"":"".concat(s,"-").concat(r,"-").concat(l),time:c}}(d,u);l.timerHandle=e(function(){return l.secondsPassed++},1e3),n.$on("$destroy",function(){return e.cancel(l.timerHandle)}),l.data=Object.assign({timezone:p.value,hostname:i.hostname,domainname:i.domainname,ntpServers:s,isSystemTimeAutosynced:u},m,{datetime:d,secondsSinceEpoch:Math.floor(Date.now()/1e3)}),l.timezoneOptions=p.options,e(function(){l.isReady=!0})},l.onLoad=function(){l.initialRequestCallbackId=l.requester.registerCallback(r.request.initialPaths,l.onInit)},l.addNTP=function(){l.data.ntpServers.push({name:"",error:""}),e(function(){s.setFocusToNode('input[name="ntp'.concat(l.data.ntpServers.length-1,'"]'))})},l.removeNTP=function(t){l.data.ntpServers=l.data.ntpServers.filter(function(e,n){return n!==t}),e(function(){p(),d()})},l.reset=function(){l.data.ntpServers=l.ntpServersOnLoad.map(function(e){return{name:e,error:""}}),l.ntpConfigChanged=!1,l.setMainFormPristine()};var d=a(function(){var e=o.chain(l.data.ntpServers).countBy("name").pickBy(function(e){return e>1}).keys().value();l.data.ntpServers=o.map(l.data.ntpServers,function(t){return e.includes(t.name)?Object.assign({},t,{error:"system.system-settings.ntp-repeat-error"}):Object.assign({},t,{error:""})})}),p=function(){var e=l.data.ntpServers.map(function(e){return e.name});l.ntpConfigChanged=!o.isEqual(l.ntpServersOnLoad,e)};l.onNtpChange=function(){e(function(){p(),d()})},l.save=function(){if(!o.get(l,"form.modified"))return t.when(!0);var e=angular.copy(l.data);if(l.ntpConfigChanged=!1,l.ntpServersOnLoad=l.data.ntpServers.map(function(e){return e.name}),!e.isSystemTimeAutosynced){if(!e.time){var n=new Date(1e3*Math.floor(e.secondsSinceEpoch+l.secondsPassed));e.time=n.toTimeString().split(" ")[0]}if(!e.date){var i=e.datetime;e.date=[i.day,i.month,i.year].join("-")}}return r.saveSettings(e)}}e.$inject=["$timeout","$q","$scope","$document","debounce","_","utils","systemSettingsService"],angular.module("keenetic").controller("SystemSettingsController",e)}(),function(){function e(e,t,n,i,a,o,s,r){var l="lte-firmware",c=["startup-config","firmware",l,"dect-firmware"],d="dsl-statistics.csv",p=["dect-firmware","sharing-config"],u=function(e,t){var n=[],a={main:[],secondary:[]};return e.forEach(function(e,a){var o=e.directory;i.forEach(t.ls[a].entry,function(e,t){-1===p.indexOf(t)&&n.push({dir:o,icon:function(e){return i.startsWith(e,"dect")?"dect-firmware":e===d?"self-test":e}(t),l10nId:t.replace(".csv",""),name:"lte:"===o?l:t,uploadUrl:o+t,downloadIsDisabled:"lte:"===o})})}),n.forEach(function(e){i.includes(c,e.name)?a.main.push(e):a.secondary.push(e)}),a.main=i.orderBy(a.main,[function(e){return e.name.includes("firmware")}],["desc"]),a},m=function(){var e=["flash:","ndm:"].map(function(e){return{directory:e,cache:!0}});return s.nvox&&e.push({directory:"dect:"}),a.INTERNAL_LTE_ID&&e.push({directory:"lte:"}),e},f=function(n){var i=e.defer();return t.location.assign("".concat(r.constants.CI_URL,"/").concat(n)),i.resolve(!0),i.promise},g=function(e){var t=i.trim(e);return""===t||Boolean(t.match(/^[a-z!]/i))},v=function(t,a){return(o=t,s=e.defer(),r=new FileReader,l=n(s.reject,3e4),r.readAsText(o),r.onload=function(){s.resolve(r.result)},s.promise.then(function(e){return n.cancel(l),e})).then(function(e){var t=e.split("\n");if(t.length!==t.filter(g).length)return console.warn("Not every line is a valid line:"),console.warn(t.filter(function(e){return!g(e)})),!1;var n=function(e){var t=e.match(/Model:(.*)/);return i.trim(i.get(t,"[1]",""))}(e);return n?n===a||(console.warn("Model mismatch: this device -- ".concat(a," / config -- ").concat(n)),!1):(console.warn("Failed to determine device model from the configuration file"),!1)});var o,s,r,l};return{DECT_CALL_LOG_FILENAME:"dect-call-history.csv",LTE_DIR:"lte:",SHOW_NVOX_INFO:"show.nvox.info",FIRMWARE_FILENAME:"firmware",LTE_FIRMWARE_FILENAME:l,request:{initialPaths:function(){var e,t=["show.version",(e=m(),i.set({},"ls",e))];if(a.INTERNAL_LTE_ID){var n=i.set({},"show.interface",{name:a.INTERNAL_LTE_ID});t.push(n)}return t}(),pollPaths:s.nvox?["show.nvox.info"]:[]},getSystemFilesList:m,getSystemFiles:function(){var e=m(),t={url:"",data:{ls:e}};return r.post(t).then(function(t){return u(e,t)})},processSystemDirsLsData:u,downloadFile:function(e){var t=e.name;return"dect-call-history.csv"===t?o.download():"firmware"===t?f(t):[d,l].includes(t)?f(e.uploadUrl):f(t+".txt")},downloadViaCiResource:f,uploadFile:function(t,n){var a=e.when(!0);return"startup-config"===t.name&&(a=v(t.file,n)),a.then(function(n){if(!n)return e.reject(i.set({},"status",[{code:9999999,message:"INVALID_CONFIG"}]));var a=e.defer();return r.disableLogoutAlert(),r.post({url:"put",data:{filename:t.uploadUrl,redirect:"no"}}).then(function(e){angular.isDefined(e.ndmErrors)&&a.reject(e),a.resolve(e)},null,function(e){angular.isDefined(e.continued)&&e.port&&"in"===e.port.direction&&r.uploadFile(e,t.file)}),a.promise})}}}e.$inject=["$q","$window","$timeout","_","NDM","callHistoryService","components","router"],angular.module("keenetic").factory("systemFilesService",e)}(),function(){function e(e,t,n,i,a,o,s,r,l){var c=this,d=l.LTE_DIR,p=(s.FW_SHUTDOWN_TIME+s.FW_BOOT_TIME)/100;c.FIRMWARE_FILENAME=l.FIRMWARE_FILENAME,c.LTE_FIRMWARE_FILENAME=l.LTE_FIRMWARE_FILENAME,c.internalModemData={modemName:"",firmwareVersion:""},c.files={},c.selectedFile="",c.isReady=!1,c.uploadAlert={progress:0,isVisible:!1,status:"",reset:function(){var e=c.uploadAlert;e.isVisible=!1,e.progress=0,e.status=""}},c.toggleFile=function(e){c.selectedFile=c.selectedFile===e?"":e},c.downloadFile=function(e,t){if(!t.downloadIsDisabled)return e.stopPropagation(),l.downloadFile(t)},c.uploadFile=function(n){if(!c.isMainCtrlLocked()){c.requester.stopPolling();var u=c.uploadAlert;u.isVisible=!0,u.status=a.getTranslation("system.system-files.upload-alert.prepare-to-install"),l.uploadFile(n,c.currentDeviceModel).then(function(){if(n.dir===d)return o.success("LTE firmware uploaded"),u.reset(),void c.requester.startPolling();u.status=a.getTranslation("system.system-files.upload-alert.install"),u.isVisible=!0,u.progress=0;var t,l,m,f,g,v=p,h=null;if("flash:firmware"===n.url){var b=(t=i.get(n,"file.size"),l=1e3*(t||s.MAX_FW_SIZE),m=s.FW_FLASHING_SPEED,f=s.FW_UPDATE_TIME+s.FW_SHUTDOWN_TIME,{total:g=(l/m||f)+s.FW_BOOT_TIME,tick:g/100});v=b.tick,h=e.when(!0)}else h=r.rebootDevice();h.then(function(){r.progressCtor(v,function(e){u.progress=e},c.goToDashboard)})},function(e){var n=i.get(e,"status.0.code"),s="system.system-files.errors."+n,r=a.getTranslation(s);r===s&&(r=e.status[0].message+" ("+n+")"),u.reset(),c.requester.startPolling(),t(function(){return o.warning(r,5e3)})})}},c.onInit=function(e){c.requester.unregisterCallback(c.initialRequestCallbackId);var t=i.get(e,"[0].show.version",{}),n=r.processShowVersionData(t);c.currentDeviceModel="".concat(t.vendor," ").concat(t.device),c.deviceName=n.model,c.currentFirmwareVersion=a.getFirmwareVersionTitle(t);var o=i.get(e,"[1].ls",{}),s=l.getSystemFilesList();c.files=l.processSystemDirsLsData(s,{ls:o}),c.isReady=!0;var d=i.get(e,"[2].show.interface",{});c.internalModemData.modemName=d.product,c.internalModemData.firmwareVersion=d.fw},c.onLoad=function(){c.initialRequestCallbackId=c.requester.registerCallback(l.request.initialPaths,c.onInit),0!==l.request.pollPaths.length&&c.requester.registerCallback(l.request.pollPaths,function(e){var t=_slicedToArray(e,1)[0],n=i.get(t,l.SHOW_NVOX_INFO,{}),a=i.find(c.files.secondary,{name:l.DECT_CALL_LOG_FILENAME});a&&(a.downloadIsDisabled=!n.plugged)})}}e.$inject=["$q","$timeout","$interval","_","utils","notification","NDM","system","systemFilesService"],angular.module("keenetic").controller("SystemFilesController",e)}(),function(){function e(e,t,n,i,a){var o="show.system.mode".replace(/\./g,"/"),s=function(t){return e.when({isHardwareSwitchDevice:t.hw_controlled,currentMode:t.active,supportedModes:t.supported.split(",").map(function(e){return e.trim()})})};return{SHOW_SYSTEM_MODE:"show.system.mode",request:{initialPaths:["show.system.mode"],pollPaths:[]},getSystemMode:function(){return i.get(o).then(s)},getModelData:s,getModeSwitchFinishText:function(i){var o="",s="";return i===n.SYSMODE.ROUTER?(o=a.getTranslation("system.sysmode.finish-notice-alert.router"),e.when({text:o,subText:s})):t("system.sysmode.finish-notice-alert.common").then(function(e){return{text:o=e.replace(/%%NEWMODE%%/g,a.getTranslation("system.sysmode."+i)),subText:s="system.sysmode.finish-notice-alert."+i}})},setSystemMode:function(e){return i.post({url:"",data:[{system:{mode:e}},{system:{reboot:{}}}]})}}}e.$inject=["$q","$translate","CONSTANT","router","utils"],angular.module("keenetic").factory("sysmode",e)}(),function(){function e(e,t,n,i,a,o,s,r,l,c,d,p,u,m,f){var g=this,v=u.SHOW_SYSTEM_MODE,h=m.SHOW_IP_ROUTE,b=m.SHOW_MWS_CONTROLLER;g.currentMode="",g.newMode="",g.status="",g.isTwoModeDevice=!1,g.isReady=!1,g.rebootTickInterval=null,g.supportedModes=[];var _=function(e){var t=l.getTranslation("system.sysmode.".concat(e));return l.getTranslation("system.sysmode.title",null,{mode:"@mode@"}).replace("@mode@",t)},y=function(e,t){var n=l.getTranslation("system.sysmode.".concat(e)),i=l.l10n.getLinkChunks("controller",{class:l.EXTERNAL_LINK_CLASS,href:"http://".concat(t),target:"_blank"});return l.getTranslation("system.sysmode.mws-member-title",null,Object.assign({mode:"@mode@"},i)).replace("@mode@",n)};g.l10n={};var S=function(){g.l10n={titles:{},subtitles:{},descriptions:{}};var e=g.isTwoModeDevice?"two-mode-device.":"";g.supportedModes.forEach(function(t){var n=l.getTranslation("system.sysmode.".concat(e).concat(t,"-subtitle"),null,null,!0);g.l10n.titles[t]=l.getTranslation("system.sysmode.".concat(e).concat(t)),g.l10n.subtitles[t]=n||"",g.l10n.descriptions[t]=l.getTranslation("system.sysmode.".concat(t,"-description"))})};S(),s.$on("destroy",i.$on("$translateChangeSuccess",function(){n(function(){S(),c.DEVICE_IS_MWS_MEMBER?g.currentModeStr=y(g.currentMode,c.LAST_KNOWN_CONTROLLER_ADDRESS):g.currentModeStr=_(g.currentMode),g.newMode=g.currentMode})})),g.openSysModePopup=function(){return o.go("controlPanel.system.mode")},g.popup={isVisible:!1,resetForm:function(){r.get(g,"form.reset",angular.noop)()},open:function(){g.onPopupOpen(),g.popup.isVisible=!0,n(g.popup.resetForm)},close:function(){g.popup.resetForm(),g.popup.isVisible=!1,g.onPopupClose()},showConfirmModeSwitchAlert:function(){g.popup.isVisible=!1,g.alert.show()}},g.popupToggle=function(e){g.parentController.toggleModePopup(e)},g.alert={isVisible:!1,status:"",subTitle:"",show:function(){g.alert.isVisible=!0,g.alert.status=l.getTranslation("system.sysmode.alert.reboot.status"),g.alert.subTitle="system.sysmode.alert.description-"+g.newMode},close:function(){g.popup.resetForm(),g.alert.isVisible=!1}},g.modeSwitchAlert={isVisible:!1,progress:0,progressBarIsVisible:!1,isSwitchFinished:!1,text:"",subText:"",show:function(){return u.getModeSwitchFinishText(g.newMode).then(function(e){var t=g.modeSwitchAlert;t.isSwitchFinished=!1,t.text=e.text,t.subText=e.subText,t.progress=0,t.progressBarIsVisible=!0,t.isVisible=!0})}},g.switchMode=function(){g.alert.isVisible=!1,g.requester.stopPolling(),g.setMainFormPristine();var e=g.modeSwitchAlert;e.show(),i.$emit(d.events.SYSTEM_REBOOT_STARTED),u.setSystemMode(g.newMode).then(function(){return p.progressCtor(p.constant.REBOOT_TICK,function(t){e.progress=t},function(){e.isSwitchFinished=!0,e.progressBarIsVisible=!1,i.$emit(d.events.SYSTEM_REBOOT_FINISHED)},{checkDevice:!1})})},g.onInit=function(e){g.requester.unregisterCallback(g.initialRequestCallbackId);var t=r.get(e,"[0].".concat(v),{}),n=r.toArray(r.get(e,"[1].".concat(h))),i=r.get(e,"[2].".concat(b),{});u.getModelData(t).then(function(e){if(r.forEach(e,function(e,t){g[t]=e}),c.DEVICE_IS_MWS_MEMBER){var t=f.getControllerAddress(n,i);g.currentModeStr=y(g.currentMode,t)}else g.currentModeStr=_(g.currentMode);g.isTwoModeDevice=r.isEqual(g.supportedModes,[d.SYSMODE.ROUTER,d.SYSMODE.EXTENDER]),S(),g.newMode=g.currentMode,g.isReady=!0})},g.onLoad=function(){var e=_toConsumableArray(u.request.initialPaths);c.DEVICE_IS_MWS_MEMBER&&e.push(h,b),g.initialRequestCallbackId=g.requester.registerCallback(e,g.onInit)}}e.$inject=["$q","$interval","$timeout","$rootScope","$sce","$state","$scope","_","utils","NDM","CONSTANT","system","sysmode","MWSRequester","MWSService"],angular.module("keenetic").controller("SysmodeController",e)}(),function(){function e(e,t,n,i,a,o){return{SHOW_INTERFACE:"show.interface",SHOW_RC_INTERFACE:"show.rc.interface",request:{initialPaths:["show.interface","show.rc.interface"],pollPaths:[]},getSwitchportModeOptions:function(){var e=["auto","full::10","half::10","auto::10","full::100","half::100","auto::100"],t=n.get(o.PORTS_MAP,"WAN.iface","");return n.startsWith(t,"GigabitEthernet")&&e.push("full::1000","auto::1000"),e.push("off"),e.map(function(e){return{id:e,label:"system.switchports.value.".concat(e),valueLabel:"system.switchports.view-value.".concat(e)}})},processSwitchportsData:function(e,t,i){return e.map(function(e){var a=e.interfaceId,o=t[a]||n.find(t,{id:a});if(!o)return console.warn("Port interface status is missing for ".concat(e.port)),Object.assign({},e,{id:a,configValue:"",isNotConfigurable:!0});var s,r=o.id,l=i[r],c="Port"!==o.type||"sfp"===e.type;if(l.up)if(l.speed||l.duplex){var d=n.get(l,"duplex","auto"),p=n.startsWith(r,"GigabitEthernet")?"1000":"100",u=n.get(l,"speed",p);s="".concat(d).concat("::").concat(u)}else s="auto";else s="off";return Object.assign({},e,{id:r,configValue:s,isNotConfigurable:c})})},setSwitchportsData:function(e,t){var a=t.map(function(t){var i=n.find(e,{name:t}),a=i.id,o=i.configValue,s={id:a,up:!0};if("off"===o)return Object.assign({},s,{up:{no:!0}});if("auto"===o)return Object.assign({},s,{speed:"auto",duplex:"auto"});var r=_slicedToArray(o.split("::"),2),l=r[0],c=r[1];return Object.assign({},s,{duplex:l,speed:c})}).map(function(e){var t=e.id;return n.set({},["interface",t],n.omit(e,"id"))});return i.postAndSave(a)}}}e.$inject=["$q","$timeout","_","router","utils","NDM"],angular.module("keenetic").factory("switchportsService",e)}(),function(){function e(e,t,n,i,a,o,s,r,l,c){var d=this,p=c.SHOW_INTERFACE,u=c.SHOW_RC_INTERFACE;d.switchportsList=l.getSwitchportsList(),d.isReady=!1,d.onInit=function(e){var t=o.get(e,"[0].".concat(p),{}),n=o.get(e,"[1].".concat(u),{});d.requester.unregisterCallback(d.initialRequestCallbackId),d.ports=c.processSwitchportsData(d.switchportsList,t,n),d.portModeOptions=c.getSwitchportModeOptions(),d.isReady=!0},d.onLoad=function(){d.initialRequestCallbackId=d.requester.registerCallback(c.request.initialPaths,d.onInit)},d.save=function(){if(!o.get(d,"form.modified"))return e.when(!0);var t=o.get(d,"form.modifiedModels",[]).map(function(e){return e.$name.split("__")[1]});return c.setSwitchportsData(d.ports,t)}}e.$inject=["$q","$scope","$rootScope","$document","$window","_","NDM","CONSTANT","utils","switchportsService"],angular.module("keenetic").controller("SwitchportsController",e)}(),function(){function e(e,t,n,i){return{resetDeviceToFactorySettings:function(){return i.disableLogoutAlert(),i.postToRciRoot([n.set({},"system.configuration.factory-reset",{}),n.set({},"system.reboot",{})]).then(function(){return e.$broadcast(t.events.FACTORY_RESET)})}}}e.$inject=["$rootScope","CONSTANT","_","router"],angular.module("keenetic").factory("rebootService",e)}(),function(){function e(e,t,n,i,a,o,s){var r=this,l=!1;r.confirmationText="RESET",r.rebootDevice=a.rebootDevice,r.resetDeviceToFactorySettings=function(){var e=s.location.host;n.every(["192.168.1.1","localhost"],function(t){return!n.startsWith(e,t)})&&(l=!0),o.resetDeviceToFactorySettings()};var c=function(t,n){t.isProgressBarVisible=!0,t.progress=0,r.requester.stopPolling(),e.when(n()).then(function(){a.progressCtor(a.constant.REBOOT_TICK,function(e){t.progress=e},function(){return function(e){e.close(),l?a.goToMyKeeneticNet():a.goToDashboard()}(t)})})};r.alert={isVisible:!1,isProgressBarVisible:!1,confirmationRequired:!1,confirmationText:"",currentConfirmationText:"",confirmationIsValid:!1,progress:0,title:"",subTitle:"",confirmBtnLabel:"",onSubmit:angular.noop,checkConfirmationText:function(e){return r.alert.confirmationIsValid=e===r.alert.confirmationText,r.alert.confirmationIsValid?null:"not-confirmed"},open:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",a=r.alert,o=i.translatePrefixCtor(e);a.isProgressBarVisible=!1,a.title=o("title"),a.confirmationText=n,a.confirmationRequired=Boolean(n),a.currentConfirmationText="",a.confirmationPlaceholder=i.getTranslation("".concat(e,".confirmation-placeholder"),null,{confirmation:n}),a.checkConfirmationText(a.currentConfirmationText),a.btnClass=a.confirmationRequired?"btn--warning":"btn--primary",a.confirmationRequired||(a.subTitle=o("description")),a.confirmBtnLabel=o("confirm-button"),a.onSubmit=function(){if(!a.confirmationRequired||a.confirmationIsValid)return a.subTitle=o("description"),c(a,t)},a.isVisible=!0},close:function(){var e=r.alert;e.isVisible=!1,e.progress=0,e.onSubmit=angular.noop}}}e.$inject=["$q","$interval","_","utils","system","rebootService","$window"],angular.module("keenetic").controller("RebootController",e)}(),function(){function e(e,t){return{SHOW_RC_SYSTEM_DUMP_REPORT:"show.rc.system.ndss.dump-report",toggleDumpReports:function(n){var i=e.set({},"system.ndss.dump-report.disable",!n);return t.postAndSave(i)}}}e.$inject=["_","router"],angular.module("keenetic").factory("diagnosticReports",e)}(),function(){function e(e,t){var n=this,i=t.SHOW_RC_SYSTEM_DUMP_REPORT;n.isReady=!1,n.areReportsEnabled=!1,n.toggleReportsState=t.toggleDumpReports,n.onLoad=function(){n.initialRequestCallbackId=n.requester.registerCallback([i],n.onInit)},n.onInit=function(t){var a=e.get(t,"[0].".concat(i));n.requester.unregisterCallback(n.initialRequestCallbackId),n.areReportsEnabled=!a.disable,n.isReady=!0}}e.$inject=["_","diagnosticReports"],angular.module("keenetic").controller("DiagnosticReportsController",e)}(),function(){function e(e,t,n,i,a){var o=this,s=function(){o.creditsPageLink=i.getTranslation("system.credits.credits-page-link",null,i.l10n.getLinkChunks("creditsPage",{"ui-sref":"controlPanel.credits",class:"ref-link"})),o.eulaModalLink=i.getTranslation("system.credits.eula-modal-link",null,i.l10n.getLinkChunks("eula",{"ng-click":"vm.showEula()",class:"ref-link"})),o.dpnModalLink=i.getTranslation("system.credits.dpn-modal-link",null,i.l10n.getLinkChunks("dpn",{"ng-click":"vm.showDpn()",class:"ref-link"}))};o.showEula=function(){a.previewLicense(a.LICENSE_IDS.EULA)},o.showDpn=function(){a.previewLicense(a.LICENSE_IDS.DPN)},o.onLoad=function(){var e=["show.dpn.list"];o.initialRequestCallbackId=o.requester.registerCallback(e,o.onInit)},o.onInit=function(e){o.requester.unregisterCallback(o.initialRequestCallbackId),o.isDpnAvailable=n.has(e,"[0].".concat("show.dpn.list.dpn"))},s(),e.$on("destroy",t.$on("$translateChangeSuccess",s))}e.$inject=["$scope","$rootScope","_","utils","licensesService"],angular.module("keenetic").controller("CreditsSectionController",e)}(),function(){function e(e,t,n,i,a,o){var s=Boolean(n.get(i,"profile.features.dual_image")),r="".concat("show.rc.components.auto-update",".disable"),l="".concat("show.rc.components.auto-update",".channel"),c="".concat("show.rc.components.auto-update",".schedule"),d={WILL_BE_INSTALLED:"will-be-installed",WILL_BE_REMOVED:"will-be-removed",INSTALLED:"installed",NOT_INSTALLED:"not-installed",UPDATE_AVAILABLE:"update-available",REQUIRED:"required",CONFLICTS:"conflicts"},p={STABLE:"stable",PREVIEW:"preview",DRAFT:"draft"},u={beta:[p.PREVIEW]},m=[p.STABLE,p.PREVIEW,p.DRAFT],f=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];i=!isNaN(i)&&i>0?i:-1;var s=e.defer(),r=0,l={};return function e(){r++,o.post("components/list"+(n?"?sandbox="+n:"")).then(function(e){l=e},function(e){return a&&-1===e.status?s.reject():null},angular.noop).then(function(){!l.component||l.error?i>0&&r<=i||i<0?(s.notify(l),t(e,1e4)):l.component?s.resolve(l):s.reject():s.resolve(l)})}(),s.promise},g=function(){return o.disableLogoutAlert(),o.post({url:"components/commit",data:{reason:"manual"},noRetry:!0})},v=function(t,i){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",s=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],r=[],l=e.when(!0);a&&(l=o.post({url:"components/list",data:{sandbox:a}}));var c=function(e){return{component:e}};return i.length>0&&r.push(n.set({},"components.remove",i.map(c))),t.length>0&&r.push(n.set({},"components.install",t.map(c))),r.length>0&&o.disableLogoutAlert(),l.then(function(){return r.length>0?o.post({url:"",data:r}):e.when(!0)}).then(s?g:e.when(!0))},h=function(e){var t=n.get(e,"priority","");return["critical","important"].includes(t)},b=function(e){return h(e)?d.REQUIRED:!e.queued||e.shouldBeUncheckedOnLoad?e.installed?d.WILL_BE_REMOVED:d.NOT_INSTALLED:e.installed?e.installed===e.version?d.INSTALLED:d.UPDATE_AVAILABLE:d.WILL_BE_INSTALLED};return{constant:{FW_CHANNEL:p,DEPRECATED_FW_CHANNEL_ALIAS:u,AUTO_UPDATE_CHANNELS_LIST:m,RECOMMENDED_PRESET:"recommended",MINIMAL_PRESET:"minimal",FW_AUTO_UPDATE_PATH:"components.auto-update.disable",FW_GET_AUTO_UPDATE_STATE_PATH:r,FW_GET_AUTO_UPDATE_CHANNEL_PATH:l,FW_GET_AUTO_UPDATE_SCHEDULE_PATH:c,CAN_AUTOUPDATE_FIRMWARE:s,ITEM_STATE:d,SHOW_VERSION:"show.version",COMPONENTS_GROUP_ORDER:{"":0,Languages:1,"Base system":2,Modes:3,"Internet filters":4,Networking:5,Applications:6,"USB modems":7,"USB storage":8,Opkg:9}},request:{initialPaths:["show.version",{probe:"factory"},s?"show.rc.components.auto-update":{}],pollPaths:["show.version"]},getAutoUpdateChannelName:function(e){var t=n.values(p);return n.includes(t,e)?e:u[e]?u[e]:p.STABLE},setAutoUpdateChannel:function(e){return o.postAndSave(n.set({},"components.auto-update.channel",e))},isNewAutoUpdateChannelMoreUnstable:function(e,t){var i=n.findIndex(m,function(t){return t===e||t===u[e]});return n.findIndex(m,function(e){return e===t||e===u[t]})>i},resetComponentsListQuery:function(){return o.del("components/list")},getComponentsList:f,getFirmwareUpdateTitle:function(e){return n.get(e,"firmware.title")||n.get(e,"firmware.version")||n.get(e,"component.base.version","")},getComponentStateName:b,isComponentUnremovable:h,changeComponents:v,updateFirmware:g,setAutoUpdateState:function(e){var t=n.set({},"components.auto-update.disable",{no:e});return o.postAndSave(t)},setAutoUpdateSchedule:function(e){var t=n.set({},"components.auto-update.schedule",e||{no:!0});return o.postAndSave(t)},processNdssError:function(e){var t=e["status.0"],i=String(n.get(t,"message","")).match(/\d{3}/),o="";if(i&&i.length&&(i=i[0]),"503"===i&&(i="502"),i){var s="system.components.errors."+i;(o=a.getTranslation(s))===s&&(o="")}return{text:o||a.getTranslation("system.components.error"),code:i?Number(i):0}},resetComponentsQueue:function(){return f().then(function(e){var t=[],i=[];return n.forEach(e.component,function(e,n){var a=b(e);a===d.WILL_BE_INSTALLED?t.push(n):a===d.WILL_BE_REMOVED&&i.push(n)}),v(i,t,"",!1)})}}}e.$inject=["$q","$timeout","_","NDM","utils","router"],angular.module("keenetic").factory("componentsService",e)}(),function(){function e(e,t,n,i,a,o,s,r,l,c,d,p,u,m,f,g){var v,h=this,b=m.constant,_=b.RECOMMENDED_PRESET,y=b.MINIMAL_PRESET,S=b.ITEM_STATE,w=b.FW_GET_AUTO_UPDATE_STATE_PATH,C=b.FW_GET_AUTO_UPDATE_CHANNEL_PATH,E=b.FW_GET_AUTO_UPDATE_SCHEDULE_PATH,I=b.SHOW_VERSION,T=b.DEPRECATED_FW_CHANNEL_ALIAS,k=b.COMPONENTS_GROUP_ORDER,P=(_defineProperty(v={},S.WILL_BE_INSTALLED,"green"),_defineProperty(v,S.WILL_BE_REMOVED,"red"),_defineProperty(v,S.REQUIRED,"gray"),_defineProperty(v,S.CONFLICTS,"red"),v);h.ui={isLocked:!1,lock:function(){return h.ui.isLocked=!0,a.when(!0)},unlock:function(){return h.ui.isLocked=!1,a.when(!1)}},h.canAutoUpdateFirmware=m.constant.CAN_AUTOUPDATE_FIRMWARE,h.isReady=!1,h.isFactoryFirmware=!1,h.componentsListIsLoading=!1,h.hideErrorMessageTimeoutHandle=!1,h.noNdssConnection=!0,h.retryNdssConnectionTimeout=null,h.noUpdateAvailable=!1,h.error=!1,h.retryTimeoutHandle=null,h.availableNdmsVersion="",h.availableNdmsVersionDate="",h.availableNdmsVersionHasReleaseData="",h.currentNdmsVersion="",h.status="",h.obsoleteComponents=[],h.componentNameFilter="",h.noMatchingComponents=!1,h.lastFilterVal="",h.filterComponents=function(e){if(h.lastFilterVal=e,e){var t=r.createMatchStrRegexp(e),n=!1;o.forEach(h.allComponents,function(e){var i=e.description[h.selectedLanguage]||e.description.EN,a=Boolean(t.exec(i));e.isNotMatchingFilter=!a,e.isMatchingFilter=!e.isInvisible&&a,a&&(n=!0),e.matchedTitle=r.highlightMatch(i,t)}),o.forEach(h.componentGroups,function(e){e.hasMatches=o.some(h.components[e.name],function(e){return e.isMatchingFilter})}),h.noMatchingComponents=!n}else h.noMatchingComponents=!1,o.forEach(h.componentGroups,function(e){e.hasMatches=!0}),o.forEach(h.allComponents,function(e){e.isNotMatchingFilter=!1})},h.autoUpdate={state:!1,schedule:"",savedSchedule:"",toggleState:function(e){return m.setAutoUpdateState(e).then(function(){var t=h.autoUpdate;if(e&&t.schedule!==t.savedSchedule){var i=t.schedule;t.schedule="";var a=n.$watch("vm.".concat("autoUpdateScheduleForm",".autoUpdateSchedule"),function(e){e&&(t.schedule=i,o.invoke(h,"".concat("autoUpdateScheduleForm",".autoUpdateSchedule.$setDirty")),a())})}})}},h.selectedLanguage="";var A=function(){if(!h.availableNdmsVersion)return a.when(!0);var e=l.getRealLanguage();return g.getReleaseNotes(h.availableNdmsVersion,e).then(function(e){h.availableNdmsVersionHasReleaseData=!o.isEmpty(e),h.availableNdmsVersionDate=o.get(e,"date","")})},D=function(){h.selectedLanguage=l.getRealLanguage().toUpperCase(),A(),Q()};n.$on("destroy",e.$on("$translateChangeSuccess",D));var O=function(){return o.get(h,"form.$setPristine",angular.noop)()},N=function(){return o.get(h,"form.reset",angular.noop)()};h.popup={isVisible:!1,open:function(){h.onPopupOpen(),h.popup.isVisible=!0,o.isEmpty(h.queuedComponents)||t(function(){var e=h.form;e&&Object.keys(h.queuedComponents).forEach(function(n){e[n]&&(e[n].$setViewValue(void 0),t(function(){return e[n].$setViewValue(h.allComponents[n].isIncluded)}))})})},close:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];h.componentNameFilter="",h.filterComponents(),N(),h.resetComponents(),h.onPopupClose(),h.popup.isVisible=!1,e&&h.requester.startPolling()}},h.alert={isVisible:!1,progress:0,status:"",show:function(){h.alert.isVisible=!0,h.requester.stopPolling()},hide:function(){h.alert.isVisible=!1,h.alert.progress=0,h.requester.startPolling()}};var L=function(e){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]&&(e=S.REQUIRED),{name:e,color:P[e]||""}};h.checkComponentsChanged=function(){return!h.noNdssConnection&&o.find(h.allComponents,function(e){return(!e.isLanguagePackage||!function(e){return o.get(h,["form","vm.form['".concat(e.group,"']"),e.name,"$pristine"])}(e))&&!e.installedVersion!=!e.isIncluded})};var x=function(e,t){var n="";return o.forEach({install:e,remove:t},function(e,t){var i=o.filter(e,function(e){return Boolean(h.allComponents[e])});if(i.length){var a=i.map(function(e){return r.generateHtmlTag("li",(t=e,(n=h.allComponents[t]).description[h.selectedLanguage]||n.description.EN||t));var t,n}).join("\n");n+=(n?"<br>":"")+r.generateHtmlTag("b",r.getTranslation("system.components.update-confirm-list-title."+t))+r.generateHtmlTag("ul",a)}}),n+=(n?"<br>":"")+r.getTranslation("system.components.update-confirm")},R=o.noop,M=function(){var e=S.WILL_BE_INSTALLED,t=[],n=[],i=[];return m.getComponentsList().then(function(t){return o.chain(t.component).mapValues(function(e){return m.getComponentStateName(e)}).pickBy(function(t){return e===t}).value()}).then(function(a){return o.forEach(h.allComponents,function(o,s){o.installedVersion&&!o.isIncluded?n.push(s):!o.installedVersion&&o.isIncluded&&t.push(s),a[s]!==e||o.isIncluded||i.push(s)}),s.confirm(x(t,n))}).then(function(){return function e(t,n,i){var a=function(t,n){h.alert.hide();var i=m.processNdssError(t);i.code&&507===i.code?s.confirm(i.text,"system.components.reset-changed-components","system.components.reopen-popup").then(R,h.changeComponents):s.confirm(i.text,"retry","cancel").then(function(){return e.apply(void 0,_toConsumableArray(n))},h.changeComponents)};h.popup.isVisible=!1,h.componentGroups.forEach(function(e){return h.components[e.name].forEach(function(e){e.bodyIsVisible=!1})});var l=h.alert;return l.status=r.getTranslation("system.components.alert.status.connecting"),l.show(),m.changeComponents(t,n,i).then(function(e){if(e.ndmErrors)a(e.ndmErrors,[t,n,i]);else{var o=1e3*(e.file_size||c.MAX_FW_SIZE);if(l.progress=50,l.status=r.getTranslation("system.components.alert.status.flashing"),o){var s=(Math.round(o/c.FW_FLASHING_SPEED)+c.FW_SHUTDOWN_TIME+c.FW_BOOT_TIME)/(100-l.progress);u.progressCtor(s,function(e){l.progress=e},h.goToDashboard,{startCheckingDeviceAt:75,initialProgress:50})}else console.warn("componentsService.changeComponents() resolved w/o file_size",e),h.onPopupClose(),l.hide()}},function(e){return a(e.ndmErrors||e.error||{},[t,n,i])},function(e){var t=o.get(e,["progress","Components::Manager"],-1);t>0&&(l.progress=Math.round(t/2),l.status=r.getTranslation("system.components.alert.status.downloading"))})}(t,n.concat(h.obsoleteComponents,i),h.currentAutoUpdateChannel)})};h.updateComponents=M,h.changeComponents=function(){h.requester.stopPolling(!1),h.popup.open()},h.updateFirmware=function(){if(!h.noNdssConnection&&h.updatesAvailable)return M()},h.initialComponentStates={};var $=function(e,t){var n=m.isComponentUnremovable(e)?S.REQUIRED:t&&e.installedVersion?e.updateAvailable?S.UPDATE_AVAILABLE:S.INSTALLED:t?S.WILL_BE_INSTALLED:e.installedVersion?S.WILL_BE_REMOVED:S.NOT_INSTALLED;e.state=L(n,e.isRequired)},F=function e(t){t.dependsOn.forEach(function(t){var n=h.allComponents[t];n&&(n.isRequired=!0,n.isIncluded||(n.isIncluded=!0,e(n)))})},V=function(){return!o.some(h.allComponents,function(e){return!e.isInRecommendedSet!=!e.isIncluded})},U=function(){return!o.some(h.allComponents,function(e){return!e.isInMinimalSet!=!e.isIncluded})},B=function(e){e.dependsOn.forEach(function(e){var t=h.allComponents[e];t&&(t.isRequired=h.dependencies[e].some(function(e){return h.allComponents[e].isIncluded}),t.isRequired?(t.includedByRequire=t.includedByRequire||!t.isIncluded,h.toggleComponentState(t,!0)):t.includedByRequire&&t.isIncluded?(t.includedByRequire=!1,h.toggleComponentState(t,!1)):h.toggleComponentState(t,t.isIncluded))})},W=function(){o.forEach(h.allComponents,function(e){e.conflicting=!1,e.includedByRequire=!1})};h.resetComponents=function(){W(),o.forEach(h.allComponents,function(e){e.state=angular.copy(e.initialState),h.toggleComponentState(e,e.includedOnLoad)}),h.componentsSetIsRecommendedSet=V(),h.componentsSetIsMinimalSet=U()};var H=function(e){var t={};return o.forEach(h.allComponents,function(n){var i=n.conflict?n.conflict.split(","):[];i.length&&o.forEach(i,function(i){i===e?t[n.name]=!0:n.name===e&&(t[i]=!0)})}),o.keys(t)},q=function(e){return!(!e.isHidden&&!e.isObsolete)||"low"===e.priority&&e.dependsOn.some(function(e){return!h.allComponents[e].isIncluded})};h.toggleComponentState=function(e,t){e.isIncluded=t,$(e,t),B(e),function(e,t){o.forEach(H(e.name),function(n){var i=h.allComponents[n];t&&o.get(i,"isIncluded")?(i.isIncluded=!1,i.conflicting=e.name,i.state=L(S.CONFLICTS,!1)):t||i.conflicting!==e.name||(i.conflicting=!1,e.conflicting=!1,h.toggleComponentState(i,!0))})}(e,t),e.isDependencyOf.forEach(function(e){var t=h.allComponents[e];t&&(t.isInvisible=q(t))}),h.componentsSetIsRecommendedSet=V(),h.componentsSetIsMinimalSet=U()},h.checkIfGroupLimitReached=function(e){if(-1!==e.componentsLimit){var t=o.filter(h.components[e.name],function(e){return e.isIncluded});e.limitReached=t.length===e.componentsLimit}},h.onCheckboxClick=function(e,t){e.isRequired||(h.toggleComponentState(e,e.isIncluded),h.checkIfGroupLimitReached(t))},h.onDetailsBtnClick=function(e,n,i){e.stopPropagation(),n.isRequired||t(function(){h.toggleComponentState(n,!n.isIncluded),h.checkIfGroupLimitReached(i)})},h.selectOnlyRecommendedComponents=function(){h.componentsSetIsRecommendedSet||(W(),o.forEach(h.allComponents,function(e){var t=e.isInRecommendedSet;t?(e.isIncluded=!0,F(e)):(e.isRequired=!1,e.isIncluded=!1,B(e)),$(e,t)}),h.componentsSetIsRecommendedSet=!0,h.componentsSetIsMinimalSet=!1)},h.selectOnlyMinimalComponents=function(){h.componentsSetIsMinimalSet||(W(),o.forEach(h.allComponents,function(e){var t=e.isInMinimalSet;t?(e.isIncluded=!0,F(e)):(e.isRequired=!1,e.isIncluded=!1,B(e)),$(e,t)}),h.componentsSetIsRecommendedSet=!1,h.componentsSetIsMinimalSet=!0)};var j=function(e){D();var n=[],i={},a={},s={},l={},c={},d={},p=[],u=m.getComponentStateName;angular.forEach(e.group,function(e,t){n.push({name:t,details:e.details||null,description:e.description,componentsLimit:e["max-select"]?Number(e["max-select"]):-1,limitReached:!1,order:o.has(e,"order")?e.order:o.get(k,t,100)})});var f=function(e){return e.startsWith("lang-")},g=o.filter(e.component,function(e,t){return f(t)&&e.installed}),v=o.find(n,function(e){return e.name===o.get(g,"[0].group")}),b=r.getCurrentLanguage(),w=o.get(v,"componentsLimit",-1),C=-1!==w&&g.length>w,E=C?function(e){return o.endsWith(e,"-en")||o.endsWith(e,"-".concat(b))}:function(){return!0};angular.forEach(e.component,function(t,g){if("base"!==g){var v=f(g)&&!E(g),b=C&&f(g)&&E(g);t.shouldBeUncheckedOnLoad=v;var w,I=t.group||"",T=function(e){return e.preset&&angular.isString(e.preset)&&e.preset===_||angular.isArray(e.preset)&&-1!==e.preset.indexOf(_)}(t),k=function(e){return e.preset&&angular.isString(e.preset)&&e.preset===y||angular.isArray(e.preset)&&-1!==e.preset.indexOf(y)}(t),P=m.isComponentUnremovable(t),A=(Boolean(t.installed)||P||b)&&!v,D=L(u(t)),O={order:t.order,name:g,conflict:t.conflict||"",group:I,description:t.description,details:(w=t.details,o.mapValues(w,r.newlineToBr)),installedVersion:t.installed||"",availableVersion:t.version||"",state:D,initialState:angular.copy(D),bodyIsVisible:o.get(h.allComponents,[g,"bodyIsVisible"],!1),priority:t.priority,isInRecommendedSet:T,isInMinimalSet:k,isRequired:!1,isIncluded:A,shouldBeUncheckedOnLoad:v,isLanguagePackage:f(g),includedOnLoad:A,isObsolete:Boolean(t.obsolete),isHidden:Boolean(t.isHidden),isInvisible:!1,hasNoDetails:!o.has(t,"details"),isUnremovable:P,updateAvailable:t.version!==t.installed,dependsOn:t.depend?t.depend.split(","):[],isDependencyOf:[]};T&&(s[g]=!0),k&&(l[g]=!0),!h.noNdssConnection&&o.includes([S.WILL_BE_INSTALLED,S.WILL_BE_REMOVED],D.name)&&(O.includedOnLoad=D.name===S.WILL_BE_INSTALLED,O.isIncluded=O.includedOnLoad,d[O.name]=D.name===S.WILL_BE_INSTALLED),t.depend&&(t.depend.split(",")||[]).forEach(function(e){c[e]||(c[e]=[]),c[e].push(g)}),i[I]||(e.group||n.push({name:I,description:{EN:I}}),i[I]=[]),i[I].push(O),a[g]=O,O.state.name===S.WILL_BE_INSTALLED&&p.push(O.name)}}),h.allComponents=a,n.forEach(function(e){i[e.name].sort(function(e,t){return Number(e.order)-Number(t.order)}),e.hasMatches=!0}),o.forEach(c,function(e,t){var n=a[t];if(n){var i=e.some(function(e){return a[e].isIncluded});n.isRequired=i,n.isDependencyOf=n.isDependencyOf.concat(e),i&&(n.isIncluded=!0,n.state=L(n.state.name,!0))}}),n.forEach(function(e){i[e.name].forEach(function(e){e.isInvisible=q(e),e.isObsolete&&(e.isDependencyOf.forEach(function(e){a[e].isIncluded=!0}),h.obsoleteComponents.push(e.name))})}),h.componentGroups=o.sortBy(n,"order"),h.components=i,h.recommendedComponents=s,h.minimalComponents=l,h.dependencies=c,h.componentsSetIsRecommendedSet=V(),h.componentsSetIsMinimalSet=U(),h.queuedComponents=d,h.versionToInstall=m.getFirmwareUpdateTitle(e),o.forEach(h.allComponents,function(e){e.conflictsWith=H(e.name)}),t(function(){return p.forEach(function(e){return h.toggleComponentState(h.allComponents[e],!0)})}),h.filterComponents(h.lastFilterVal),h.componentGroups.forEach(function(e){h.checkIfGroupLimitReached(e)})},K=function(e){return{id:e,label:"system.components.sandboxes.".concat(e,".option-text"),details:{title:"system.components.sandboxes.".concat(e,".description-name"),shortDescription:"system.components.sandboxes.".concat(e,".description-short-text"),description:"system.components.sandboxes.".concat(e,".description-text")}}},G=function(e){var n=e.component.base,i=function(e){return"system.components.status.".concat(e)};d.containsAnyNdmErrors(e)?h.error=!0:(h.error=!1,t.cancel(h.hideErrorMessageTimeoutHandle),n.installed!==n.version||h.isFactoryFirmware?(h.availableNdmsVersionTitle=m.getFirmwareUpdateTitle(e),h.availableNdmsVersion=n.version,h.ndmsVersionPopup=h.availableNdmsVersionTitle,h.status=i("updates-available"),h.updatesAvailable=!0,A()):(h.availableNdmsVersion="",h.availableNdmsVersionDate="",h.availableNdmsVersionHasReleaseData="",h.availableNdmsVersionTitle="",h.ndmsVersionPopup=h.currentFirmwareVersionTitle,h.status=i("no-updates-available"),h.updatesAvailable=!1))},Y=function(){h.error=!0,h.noNdssConnection=!0,h.updatesAvailable=!1,h.hideErrorMessageTimeoutHandle=t(function(){h.error=!1,h.componentsListIsLoading=!0,h.status=r.getTranslation("system.components.status.reconnecting")},5e3),h.retryNdssConnectionTimeout=t(function(){X(h.currentAutoUpdateChannel)},1e4)};R=function(){return h.ui.lock(),m.resetComponentsQueue().then(function(){return m.getComponentsList()}).then(function(e){h.componentsListIsLoading=!1,e.ndmErrors?(Y(),N()):(t.cancel(h.hideErrorMessageTimeoutHandle),h.error=!1,h.noNdssConnection=!1,j(e),G(e),t(function(){h.changeComponents()}))}).finally(h.ui.unlock)},h.updateFirmwareInfo=function(){return h.requester.stopPolling(!0),h.componentsListInProcess=!1,X(h.currentAutoUpdateChannel)};var z=function(e){return h.componentsListInProcess=!1,h.availableNdmsVersionHasReleaseData=!1,a.when(function(){return h.requester.stopPolling(!0)}).then(function(){return m.setAutoUpdateChannel(e)}).then(function(){return X(e)}).then(function(){return A()}).finally(function(){return h.requester.startPolling()})};h.onAutoUpdateChannelChange=function(e,t){m.isNewAutoUpdateChannelMoreUnstable(t,e)?s.confirm("system.components.confirm-switch-to-unstable-channel").then(function(){z(e)},function(){h.currentAutoUpdateChannel=t}):z(e)};var Q=function(){return g.getNotesLink(h.currentFirmwareVersion).then(function(e){e&&(h.currentVersionReleaseNotes=e)})},X=function(e){var n=a.defer();return t.cancel(h.retryNdssConnectionTimeout),h.componentsListInProcess=!0,m.getComponentsList(e).then(function(e){h.componentsListIsLoading=!1,e.ndmErrors?Y():(t.cancel(h.hideErrorMessageTimeoutHandle),h.error=!1,h.noNdssConnection=!1),j(e),G(e),t(O)},null,function(e){h.componentsListIsLoading=!1,d.containsAnyNdmErrors(e)?(Y(),j(e),G(e)):console.warn("componentsService.getComponentsList() rejected w/o error",e)}).finally(function(){h.componentsListInProcess=!1,n.resolve()}),n.promise};h.showComponentsPopup=function(){return i.go("controlPanel.system.components")},h.onInit=function(e){h.isFactoryFirmware=o.get(e,"[1].probe.found",!1),h.requester.unregisterCallback(h.initialRequestCallbackId),h.requester.registerCallback(m.request.pollPaths,o.noop);var t=o.get(e,"[0].".concat(I),{}),n=u.processShowVersionData(t);h.deviceName=n.model,h.currentFirmwareVersionTitle=r.getFirmwareVersionTitle(t),h.currentFirmwareVersion=n.release;var i,s=o.get(e,"[2].".concat(C)),l=t.sandbox;o.has(T,s)?(h.currentAutoUpdateChannel=T[s],i=m.setAutoUpdateChannel(h.currentAutoUpdateChannel)):s?(h.currentAutoUpdateChannel=s,i=a.when(!0)):(h.currentAutoUpdateChannel=m.getAutoUpdateChannelName(l),i=m.setAutoUpdateChannel(h.currentAutoUpdateChannel)),i.then(function(){h.isReady=!0,h.noUpdateAvailable=!1,h.error=!1,h.availableNdmsVersion="",h.ndmsVersionPopup=h.currentFirmwareVersionTitle,h.status=r.getTranslation("system.components.status.connecting"),h.canAutoUpdateFirmware&&(h.autoUpdate.state=!o.get(e,"[2].".concat(w),!0),h.autoUpdate.schedule=o.get(e,"[2].".concat(E),""),h.autoUpdate.savedSchedule=h.autoUpdate.schedule),Q(),h.autoUpdateChannels=m.constant.AUTO_UPDATE_CHANNELS_LIST.map(K),X(h.currentAutoUpdateChannel)})},h.onLoad=function(){h.initialRequestCallbackId=h.requester.registerCallback(m.request.initialPaths,h.onInit)},h.save=function(){if(!o.get(h,"".concat("autoUpdateScheduleForm",".modified")))return a.when(!0);var e=h.autoUpdate.state?h.autoUpdate.schedule:"";return m.setAutoUpdateSchedule(e).then(function(){h.autoUpdate.savedSchedule=h.autoUpdate.schedule})},h.reset=function(){h.autoUpdate.schedule=h.autoUpdate.savedSchedule}}e.$inject=["$rootScope","$timeout","$scope","$state","$q","_","modal","utils","language","NDM","router","notification","system","componentsService","browserCheck","webHelpReleaseNotesService"],angular.module("keenetic").controller("ComponentsController",e)}(),function(){function e(e,t){var n="show.rc.".concat("cloud.control2.security-level");return{constant:{SERVICE_NAME:"cloud-control2",SHOW_RC_SERVICE:"show.rc.service",SHOW_IDENTIFICATION:"show.identification",SHOW_VERSION:"show.version",SHOW_RC_CLOUD_CONTROL2_SECURITY_LEVEL:n},request:{initialPaths:[n,"show.identification"]},getServiceState:function(){return t.get("service.cloud-control2").then(function(e){return!0===e})},setServiceState:function(n){var i=n?"public":"private",a=e.set({},"cloud.control2.security-level",_defineProperty({},i,!0));return t.postAndSave(a)}}}e.$inject=["_","router"],angular.module("keenetic").factory("cloudcontrol",e)}(),function(){function e(e,t,n,i,a,o,s,r,l,c){var d=this,p=c.constant,u=p.SHOW_RC_CLOUD_CONTROL2_SECURITY_LEVEL,m=p.SHOW_IDENTIFICATION,f=p.SHOW_VERSION;d.cloudcontrolIsEnabled=!1,d.isReady=!1,d.cid="",d.cidLinkIsCopied=!1;var g=function(){var e="&locale=".concat(s.getCurrentLanguage(),"&from=web").concat(d.appLinkArgs),t=function(t){return s.l10n.getLinkChunks(t,{class:s.EXTERNAL_LINK_CLASS,target:"_blank",href:"https://keenetic.com/getapp?".concat(t,".next").concat(e)})};d.l10n={description:s.getTranslation("system.cloudcontrol.description",null,Object.assign({},t("ios"),{},t("android")))}};g(),e.$on("$destroy",t.$on("$translateChangeSuccess",function(){return n(g)})),d.onToggleCloudcontrol=function(e){return c.setServiceState(e)},d.copyCidToClipboard=function(){s.copyToClipboard(d.cid),d.cidLinkIsCopied=!0,n(function(){d.cidLinkIsCopied=!1},3e3)},d.onInit=function(e){d.requester.unregisterCallback(d.initialRequestCallbackId),d.cloudcontrolIsEnabled=i.has(e,"[0].".concat(u,".public")),d.cid=i.get(e,"[1].".concat(m,".cid")),d.isReady=!0},d.onLoad=function(){d.initialRequestCallbackId=d.requester.registerCallback(c.request.initialPaths,d.onInit),d.requester.registerCallback([f],function(e){var t=i.get(e,"[0].".concat(f),{}),n=t.region,a=t.release;d.appLinkArgs="&region=".concat(encodeURIComponent(n),"&version=").concat(encodeURIComponent(a)),g()},!0)}}e.$inject=["$scope","$rootScope","$timeout","_","router","modal","utils","NDM","CONSTANT","cloudcontrol"],angular.module("keenetic").controller("CloudcontrolController",e)}(),function(){function e(e,t,n,i,a,o){var s=Boolean(o.profile.features.led_control),r=function(e,t){return e+"__"+t},l=function(e){var n=e.value.split("__"),i=n[0],a=n[1],o={};return"not-used"===i?t.set(o,"system.led",{led:e.id,no:!0,indicate:!0}):t.set(o,"system.led",{led:e.id,control:i,indicate:!0}),a&&("SelectedWan"===i?t.set(o,["interface",a],{led:{wan:!0}}):"SelectedSchedule"===i&&t.set(o,["schedule",a],{led:{action:"start"}})),o};return{constant:{LED_CONTROL_AVAILABLE:s,LED_IS_UNUSED_HANDLER:"not-used",BTN_IS_UNUSED_HANDLER:"not-used",LED_LIMITED_ACTIONS:["SelectedWan","SelectedSchedule"],UNCONFIGURABLE_BTN:"RESET"},request:{initialPaths:["show.button","show.button.bindings","show.button.handlers","show.rc.interface","show.interface","show.rc.schedule",s?"show.led.controls":{},s?"show.led.bindings":{}],pollPaths:[]},leds:{processConfiguration:function(e,n,i,o,s){var l,c,d=[],p={},u=[];t.forEach(s,function(e,t){e.led&&(l=t),u.push({id:t,label:e.description||t})}),(e.binding||[]).filter(function(e){return e.user_configurable}).forEach(function(e){d.push({id:e.led,label:e.led.replace("_",""),activeCtrl:e.active_control||"not-used",defaultCtrl:e.default_control||"not-used"})});for(var m=a.getInterfaceOptions(o).filter(function(e){return e.global}),f=Object.keys(i),g=0,v=f.length;g<v;++g){var h=f[g],b=i[h];if(t.get(b,"led.wan")){c=h;break}}var _=function(e,t){t.forEach(function(t){var n=r(e,t.id);p[n]={id:n,prefix:e,suffix:t.label}})};return t.forEach(n.control||{},function(e,t){e.user_configurable&&("SelectedSchedule"===t?_(t,u):"SelectedWan"===t?_(t,m):p[t]={id:t,prefix:t,suffix:void 0})}),t.forEach(d,function(e){"SelectedWan"===e.activeCtrl?e.value=r(e.activeCtrl,c):"SelectedSchedule"===e.activeCtrl?e.value=r(e.activeCtrl,l):e.activeCtrl?e.value=e.activeCtrl:e.value="not-used",e.defaultValue=e.defaultCtrl||"not-used"}),{leds:d,controls:p}}},getAllButtons:function(){return n.get("show/button")},getButtonHandlers:function(e){e=angular.isArray(e)?e:[e];var i="show.button.handlers";return n.post({url:"",data:t.set({},i,e.map(function(e){return{name:e}}))}).then(function(e){return t.get(e,i,[]).map(function(e){return e.handlers.handler})})},setAllButtonHandlers:function(e){var i=[];return t.forEach(e,function(e){return e.forEach(function(e){var n,a,o;"RESET"!==e.button&&i.push((n=e.button,a=e.action,o=e.value,t.set({},"system.button",{button:n,action:a,handler:"not-used"===o?"":o,no:"not-used"===o})))})}),n.postAndSave(i)},setAllLedsControls:function(e){return n.postAndSave(e.map(l))},resetAllButtonBindings:function(){return n.postAndSave(t.set({},"system.button",{no:!0}))}}}e.$inject=["$q","_","router","utils","interfaces","NDM"],angular.module("keenetic").factory("buttonsAndLeds",e)}(),function(){function e(e,t,n,i,a,o,s,r,l,c,d){var p=this,u=d.constant,m=u.BTN_IS_UNUSED_HANDLER,f=u.LED_IS_UNUSED_HANDLER,g=u.LED_LIMITED_ACTIONS;p.isReady=!1,p.ledCtrlAvailable=d.constant.LED_CONTROL_AVAILABLE;var v=r.translatePrefixCtor("system.buttons-and-leds.buttons"),h=function(e){p.buttonGroups=a.mapValues(p.buttonGroups,function(){return[]}),a.forEach(e.bindings,function(t){e.isConfigurable[t.button]&&(p.buttonGroups[t.button]||(p.buttonGroups[t.button]=[]),t.value=t.active_handler||m,t.defaultValue=t.default_handler||m,p.btnConfigurationIsDefault&&t.value!==t.defaultValue&&(p.configurationIsDefault=!1,p.btnConfigurationIsDefault=!1),t.buttonHandlers=[],t.button===d.constant.UNCONFIGURABLE_BTN?t.buttonHandlers.push({id:t.defaultValue,label:v("handler."+t.defaultValue)}):(t.buttonHandlers=a.map(e.handlers[t.button],function(e,n){return{id:n,label:v("handler."+n)+(n===t.defaultValue?" "+v("handler.default"):"")}}),t.buttonHandlers.unshift({id:m,label:t.defaultValue===m?v("handler.not-used-by-default"):v("handler.not-used")})),p.buttonGroups[t.button].push(t),p.l10n.actions[t.action]=v("action."+t.action))})},b=r.translatePrefixCtor("system.buttons-and-leds.leds.control"),_=function(e){var t={},n=a.map(e.controls,function(e,t){return{id:t,label:b(e.prefix)+(e.suffix?" "+e.suffix:"")}});n.unshift({id:f,label:b(f)}),p.leds=e.leds.map(function(e){t[e.id]=angular.copy(n);var i=a.find(t[e.id],{id:e.defaultValue});return i&&(i.label+=" "+b("default")),p.ledConfigurationIsDefault&&e.activeCtrl!==e.defaultCtrl&&(p.configurationIsDefault=!1,p.ledConfigurationIsDefault=!1),e.options=t[e.id],e.allOptions=a.clone(e.options),e}),p.leds.forEach(function(e){return S(e.id)})},y=function(){p.l10n={actions:{}},p.btnData&&h(p.btnData),p.ledData&&_(p.ledData)};y(),t.$on("$destroy",n.$on("$translateChangeSuccess",function(){return i(y)})),p.buttonGroups={},p.onKeydown=function(e){if(!c.isSpace(e)||p.isMainCtrlLocked())return!0;e.stopPropagation(),e.preventDefault(),p.resetToDefaults()},p.resetToDefaults=function(){p.configurationIsDefault||p.isMainCtrlLocked()||(a.forEach(p.buttonGroups,function(e){return e.forEach(function(e){e.value=e.defaultValue})}),p.btnConfigurationIsDefault=!0,p.ledCtrlAvailable&&p.leds.forEach(function(e){e.value=e.defaultValue}),p.ledConfigurationIsDefault=!0,p.configurationIsDefault=!0)},p.onBtnHandlerSelect=function(){i(function(){p.btnConfigurationIsDefault=!a.find(p.buttonGroups,function(e){return a.find(e,function(e){return e.value!==e.defaultValue})}),p.configurationIsDefault=p.btnConfigurationIsDefault&&p.ledConfigurationIsDefault})};var S=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:p.leds[0].id,t=a.find(p.leds,{id:e}),n=t.value.split("__")[0],i=!g.includes(n);a(p.leds).filter(function(e){return e.id!==t.id}).forEach(function(e){e.options=e.allOptions.filter(function(a){var o=a.id===t.value&&e.value===t.value,s=n!==a.id.split("__")[0];return i||s||o})})};p.onLedControlSelect=function(e){i(function(){S(e),p.ledConfigurationIsDefault=!a.find(p.leds,function(e){return e.value!==e.defaultValue}),p.configurationIsDefault=p.btnConfigurationIsDefault&&p.ledConfigurationIsDefault})};var w=function(e){p.requester.unregisterCallback(p.initialRequestCallbackId),p.btnConfigurationIsDefault=!0,p.ledConfigurationIsDefault=!0,p.configurationIsDefault=!0,p.ledCtrlAvailable&&(p.ledData=d.leds.processConfiguration(a.get(e,"[7].show.led.bindings",{}),a.get(e,"[6].show.led.controls",{}),a.get(e,"[3].show.rc.interface",{}),a.get(e,"[4].show.interface",{}),a.get(e,"[5].show.rc.schedule",{})),_(p.ledData));var t=a.get(e,"[0].show.button",{}).buttons.button,n=Object.keys(t),i={};return i.bindings=a.get(e,"[1].show.button.bindings.binding",[]),i.handlers={},i.isConfigurable={},d.getButtonHandlers(n).then(function(e){e.forEach(function(e,a){var o=n[a];i.handlers[o]=e,i.isConfigurable[o]=!t[o].is_switch}),p.btnData=i,h(p.btnData),p.isReady=!0})};p.onLoad=function(){p.initialRequestCallbackId=p.requester.registerCallback(d.request.initialPaths,w)},p.save=function(){var t=a.get(p,"buttonsForm.modified"),n=p.ledCtrlAvailable&&a.get(p,"ledsForm.modified");if(!t&&!n)return e.when(!0);var i=[];return t&&i.push(d.setAllButtonHandlers(angular.copy(p.buttonGroups))),n&&i.push(d.setAllLedsControls(angular.copy(p.leds))),e.all(i)}}e.$inject=["$q","$scope","$rootScope","$timeout","_","router","modal","utils","NDM","keyboard","buttonsAndLeds"],angular.module("keenetic").controller("ButtonsAndLedsController",e)}(),function(){function e(e,t,n){var i={firmware:"",bidirectional:!1,disableStatusPolling:!1},a={DIRECT:"direct",CIFS:"cifs"};return{PRINTER_TYPE:a,STATUS_POLLING_PROP:"status-polling",getData:function(a){var o=t.toRciQueryList(["show.rc.printer","show.printers"]);return n.postToRciRoot(o).then(function(t){var n=e.get(t,"[0].".concat("show.rc.printer"),{}),o=e.get(t,"[1].".concat("show.printers"),{});if(!n[a])return Object.assign({},i);var s,r=n[a],l=e.get(o,["printer",a]);return Object.assign({},i,{},r,{id:a,connectionType:r.type,status:l,disableStatusPolling:(s=r,!e.get(s,["status-polling"],!0))})})},setData:function(e){var t=_defineProperty({id:e.id,name:e.name,type:e.connectionType,firmware:e.firmware||{no:!0},bidirectional:Boolean(e.bidirectional)},"status-polling",!e.disableStatusPolling);return t.type===a.DIRECT&&(t.port=e.port),n.postAndSave({printer:t})},getPrinterStatus:function(e){var n=e.status.toLowerCase();return t.getTranslation("usb-device-list.printer-status.".concat(n))}}}e.$inject=["_","utils","router"],angular.module("keenetic").factory("PrinterPopupService",e)}(),function(){function e(e,t,n,i,a,o,s,r){var l=this,c=a.translatePrefixCtor("apps.printer-settings-popup"),d=function(){l.l10n={id:c("id"),status:c("status")},l.connectionTypes=i.map(r.PRINTER_TYPE,function(e){return{id:e,name:a.getTranslation("apps.printer-settings-popup.connection-type.".concat(e))}})};d(),t.$on("destroy",n.$on("$translateChangeSuccess",function(){return e(d)})),l.isVisible=!1,l.form=null;var p=i.noop();l.show=function(t){return r.getData(t).then(function(t){l.model=t,l.model.showFirmwareSection=Boolean(l.model.firmware),e(function(){i.get(l,"form.$setPristine",angular.noop)(),l.isVisible=!0})})},l.save=function(){return r.setData(l.model).then(l.close).then(function(){e(function(){return o.success("notifications.saved")})})},t.$on("$destroy",n.$on("apps-open-printer-popup",function(e,t){l.show(t.id)})),l.close=function(){i.get(l,"form.reset",angular.noop)(),l.isVisible=!1,i.isFunction(p)&&p()}}e.$inject=["$timeout","$scope","$rootScope","_","utils","notification","appsService","PrinterPopupService"],angular.module("keenetic").controller("PrinterPopupAppsController",e)}(),function(){function e(e,t,n,i,a){var o,s={POST:"POST",GET:"GET",DELETE:"DELETE"},r={},l=function(){return n.isEmpty(r)?i.get("show/version").then(function(e){return r=e,angular.copy(r)}):e.when(angular.copy(r))},c={config:{open:'<file name="ndm:sharing-config">',close:"</file>",mutator:function(e){return n.trim(e.split("<![CDATA[")[1].split("]]>")[0])}},adminData:{open:"user admin",close:"!"},sandbox:{open:"<sandbox>",close:"</sandbox>"},components:{open:"<components>",close:"</components>",mutator:function(e){return n.trim(e).split(",").sort()}},hwid:{open:"<hw_id>",close:"</hw_id>"}},d=function(e,t,n){var i=e.indexOf(n.open,t);if(-1===i)throw new Error("Failed to locate [".concat(n.open,"] starting from [").concat(t,"]"));var a=e.indexOf(n.close,i);if(-1===i)throw new Error("Failed to locate [".concat(n.close,"] starting from [").concat(i,"]"));var o=e.substr(i+n.open.length,a-i-n.open.length);return{data:(n.mutator||angular.identity)(o),openIdx:i,closeIdx:a}},p=/(\r?)(\n)/,u=function(e){var t=function(e){var t=e.match(p);return"\n"===t[0]?"\n":"\r\n"===t[0]?"\r\n":void 0}(e);return{strings:e.split(t),EOL:t}};return{SANDBOXES_LIST:["stable","alpha","preview","gamma","delta","draft","legacy","nightly","custom"],REQUEST_METHOD:s,REQUEST_METHOD_OPTIONS:[s.POST,s.GET,s.DELETE].map(function(e){return{id:e,name:e}}),readSelfTestFile:function(t){var n=new FileReader,i=e.defer();return n.onload=function(e){return i.resolve(e.target.result)},n.onerror=function(){return i.resolve(n.result)},n.readAsText(t),i.promise},getDeviceComponentsList:function(){return l().then(function(e){return n.get(e,"ndw.components","").split(",").sort()})},getVersionData:l,checkIfDeviceConnectionRestored:function(){return i.get({url:"show/version",timeout:3e3,noRetry:!0})},processSelfTest:function(t){var i=e.defer(),a=0,o={};["config","sandbox","components","hwid"].forEach(function(e){try{var n=d(t,a,c[e]);a=n.closeIdx,o[e]=n.data}catch(e){i.resolve({error:e})}});try{var s=d(o.config,0,c.adminData).data,r=u(s),l=r.strings,p=r.EOL,m=l.filter(function(e){return-1===n.trim(e).indexOf("password")}).join(p);o.config=o.config.replace(s,m)}catch(e){i.resolve({error:e})}return i.resolve(o),i.promise},parse:function(e){return i.post({url:"",noRetry:!0,data:{parse:e}})},query:function(e,t,n){var a={url:e,method:t,noRetry:!0};return"POST"===t&&(a.data=n||{}),i.get(a)},changeComponents:function(t,n){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return a.changeComponents(t,n,o,!1).then(function(){var t=e.defer();return i.post({url:"components commit",data:{reason:"manual"},silent:!0}).then(t.resolve,null,t.notify).finally(function(){r={}}),t.promise})},addTabSupportToTextarea:function(e){if(!angular.isUndefined(HTMLTextAreaElement)){HTMLTextAreaElement.prototype.getCaretPosition=function(){return this.selectionStart},HTMLTextAreaElement.prototype.setCaretPosition=function(e){this.selectionStart=e,this.selectionEnd=e,this.focus()},HTMLTextAreaElement.prototype.hasSelection=function(){return this.selectionStart===this.selectionEnd},HTMLTextAreaElement.prototype.getSelectedText=function(){return this.value.substring(this.selectionStart,this.selectionEnd)},HTMLTextAreaElement.prototype.setSelection=function(e,t){this.selectionStart=e,this.selectionEnd=t,this.focus()};var n=angular.isString(e)?t[0].querySelector(e):e,i="    ".length;n&&(n.onkeydown=function(e){if(9===e.keyCode){var t=n.getCaretPosition()+"    ".length;return n.value=n.value.substring(0,n.getCaretPosition())+"    "+n.value.substring(n.getCaretPosition(),n.value.length),n.setCaretPosition(t),!1}if(8===e.keyCode&&"    "===n.value.substring(n.getCaretPosition()-i,n.getCaretPosition())){var a=n.getCaretPosition()-i+1;n.value=n.value.substring(0,n.getCaretPosition()-i+13)+n.value.substring(n.getCaretPosition(),n.value.length),n.setCaretPosition(a)}37===e.keyCode&&"    "===n.value.substring(n.getCaretPosition()-i,n.getCaretPosition())&&n.setCaretPosition(n.getCaretPosition()-i+1),39===e.keyCode&&"    "===n.value.substring(n.getCaretPosition()+i,n.getCaretPosition())&&n.setCaretPosition(n.getCaretPosition()+i-1)})}},getInternetStatus:function(){var t=e.when(!0);return angular.isDefined(o)||(t=i.post({url:"probe",data:{probe:"show internet status"}}).then(function(e){o=Boolean(e.found)})),t.then(function(){return o?i.get("show/internet/status"):e.when({internet:!0,reliable:!0})})}}}e.$inject=["$q","$document","_","router","componentsService"],angular.module("keenetic").factory("cli",e)}(),function(){function e(e,t,n,i){var a=/"(\\[\\"]|[^\\"])*"/g,o=/^[a-zA-Z][\x21-\x7E]*$/,s=/^[\x21-\x7E]+$/,r=/__#__/g,l=function(e){return n.endsWith(e," ")},c=function(e){return function(e,t){return n.countBy(e)[t]||0}(e.replace(/\\"/g,function(e,t,n){for(var i=t-1,a=0;i>=0&&"\\"===n[i];)a++,i--;return a%2==0?"":'"'}),'"')%2==0},d=function(e){var t=[],i=0;return e.replace(a,function(e){return t.push(e)," ".concat("__#__").concat(i++).concat("__#__"," ")}).split(/\s+/g).map(function(e){return n.startsWith(e,"__#__")?t[e.replace(r,"")-0]:e}).filter(n.identity)},p=function(e,t){return 0===t?o.test(e):s.test(e)||n.startsWith(e,'"')||n.endsWith(e,'"')},u=function(e,t,i){var a=e+t,o=!l(t)||i.completion&&" "!==i.completion?" ":"",s=a+o,r=s.length,c=n.trimEnd(a);return n.map(i.choice,function(t){var i=function(e,t){if(!e||!t)return"";var i=[e];return l(e)&&!n.startsWith(t," ")&&i.push(n.trimEnd(e)),n.chain(i).map(function(e){for(var i=e.length-1;i>0;i--){var a=t.substr(0,i);if(n.endsWith(e,a))return a}return""}).maxBy("length").value()}(s,t),o=n.trimEnd(i),p=c.lastIndexOf(o),u=s;if(i&&n.endsWith(c,o)&&(0===p||" "===a[p-1])){var m=i.length,f=l(i)?1:0;u=s.substr(0,r-1-m-f)}var g="".concat(u," ").concat(t),v=e+d(g).join(" ");return{id:v,label:v}})},m=function(e,t,n){if(!n.hint)return"";var i=d(t),a=d(n.hint),o=i.indexOf(a[0]);if(-1===o)return"";var s=i.slice(0,o).join(" ");return"".concat(s," ").concat(n.hint)},f=function(e,t,i){var a=n.uniqBy(t,"id"),o=a.length>1?a.filter(function(t){return t.id!==e}):a,s=o.length>0&&o.every(function(t){return t.id===e||n.startsWith(t.id,e+" ")}),r=0===o.length&&""!==i,c=!l(e)&&(s||r);return{options:o,cmdIsInvalid:!1,cmd:c?e+" ":e,addSpace:c,hint:i}},g=function(e){var t=n.get(e,"choice",[]),i=n.get(e,"hint",""),a=n.get(e,"command",{}),o=n.get(e,"completion","");return{choice:t,hint:i,command:a,completion:t.includes(o)?"":o}},v=function(e,t,i){var a=t+i.completion,o=m(0,a,i);return{options:[].concat(_toConsumableArray(u(e,a,i)),_toConsumableArray(function(e,t,i){var a=d(n.trim(t)),o=a.pop()||"",s=a.length>0?a.join(" ")+" ":"",r=o&&l(o)?"":" ";return n.map(i.command,function(t,i){var a,l="";n.trim(s)===i?a=i:(l=s,a=0===i.indexOf(o)?i:o+r+i);var c=e+l+a;return{id:c,label:c}})}(e,a,i))),hint:o}},h=function(n){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20,o=e.defer();return t(function(){i.postToRciRoot(n).then(o.resolve)},a),o.promise},b={},_=function(e,t){b[e]&&(b[e].forEach(function(e){e.resolve(t)}),delete b[e])};return{DEFAULT_CONTEXT:"(config)",getAutocompleteData:function t(a){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;if(b[a]){var s=e.defer();return b[a].push(s),s.promise}b[a]=[];var r=a.match(/^(\s)*/g),u=r?a.replace(r[0],""):a,y=r?r[0]:"",S=l(a)?" ":"",w=function(e){if(!e)return{isValid:!0,endsWithSpace:!1,tokens:[]};if(!c(e))return{isValid:!1,endsWithSpace:l(e),tokens:[]};var t=d(e);return{isValid:t.every(p),endsWithSpace:l(e),tokens:t}}(u);if(!w.isValid){var C=Object.assign({},function(t){return e.when({cmd:t,options:[],cmdIsInvalid:!1,addSpace:!1})}(u),{cmdIsInvalid:!0});return _(a,C),e.when(C)}var E=w.tokens.join(" ")+S;if(""===E||l(E))return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a={help:e};return(t?h(a,t):i.postToRciRoot(a)).then(function(e){var t=n.get(e,"help",{});return g(t)})}(E,o).then(function(e){var t=E+e.completion,n=v(y,E,e),i=n.options,o=n.hint,s=f(t,i,o);return _(a,s),s});var I=[E,E+" "],T={help:I};return(o?h(T,o):i.postToRciRoot(T)).then(function(e){var i=n.get(e,"help",[]);if(n.get(i,"[0].help.completion")){var o=i[0].help,s=E+n.get(i,"[0].help.completion"),r=d(s),c=n.last(r);return n.has(o.command,c)?{options:[],cmdIsInvalid:!1,cmd:s,addSpace:!l(s),hint:m(0,s,o)}:t(s,20).then(function(e){return _(a,e),e})}var p=n.get(i,"[0].help.choice"),u=(n.isArray(p)?[i[0]]:i).map(function(e,t){var i=n.get(e,"help",{}),a=g(i);return v(y,I[t],a)}),h=n.chain(u).map("options").flatten().value(),b=n.chain(u).map("hint").filter().first().defaultTo("").value(),S=f(E,h,b);if(1===S.options.length){var w=n.get(S,"options.[0]");return w.hint||w.id===E?(_(a,S),S):t(w.id,20).then(function(e){return _(a,e),e})}return _(a,S),S})}}}e.$inject=["$q","$timeout","_","router"],angular.module("keenetic").factory("cliAutocomplete",e)}(),angular.module("keenetic").factory("CliHistory",["_","relaxedJson","localStorage",function(e,t,n){return function(){function i(e,t,n,a){_classCallCheck(this,i),this.pool=e,this.history=[],this.goPointer=-1,this.customUserInputData={},this.emptyData=angular.copy(a),this.getRecordData=t,this.applyRecord=n,this.loadHistory()}return _createClass(i,[{key:"getLocalStorageName",value:function(){return"NDM_CLI_HISTORY--"+this.pool}},{key:"loadHistory",value:function(){var e=n.getItem(this.getLocalStorageName());this.history=JSON.parse(e||"[]"),this.sortHistory()}},{key:"saveHistory",value:function(){n.setItem(this.getLocalStorageName(),JSON.stringify(this.history))}},{key:"goUp",value:function(){this.walkByHistory(!0)}},{key:"goDown",value:function(){this.walkByHistory(!1)}},{key:"walkByHistory",value:function(e){if(this.history.length){-1===this.goPointer&&(this.customUserInputData=this.getRecordData(this.pool)),this.goPointer+=e?1:-1,this.goPointer<-1?this.goPointer=this.history.length-1:this.goPointer>this.history.length-1&&(this.goPointer=-2);var t=this.goPointer>-1?this.history[this.goPointer].data:this.customUserInputData;this.applyRecord(t,this.pool)}}},{key:"sortHistory",value:function(){this.history=this.history.sort(function(e,t){return t.time-e.time})}},{key:"addItem",value:function(){var n=this.getRecordData(this.pool),i=e.find(this.history,function(i){var a=e.clone(i.data),o=e.clone(n);try{a.data=t.parse(a.data),o.data=t.parse(o.data)}catch(e){}return e.isEqual(o,a)});i?i.time=(new Date).getTime():this.history.push({time:(new Date).getTime(),data:n,$$hashKey:this.pool+(new Date).getTime()}),this.sortHistory(),this.goPointer=-1,this.customUserInputData=this.emptyData,this.saveHistory()}}]),i}()}]),function(){function e(e,t,n,i,a,o){var s=o.selectboxOptions,r=["unplugged","disabled","disable","registered","unavailable"],l=[],c=function(e){var n=e.status;return"disable"===n&&(n="disabled"),"failure"===n&&(n="error"),"error"!==n&&1!==r.indexOf(n)?{status:n,text:t.getTranslation("dect.lines.line-status."+n)}:"error"===n&&e.text?e:{status:n,text:e.code&&"error"===n?t.getTranslation("dect.lines.line-status.error",null,{error:e.code+" "+e.description}):t.getTranslation("dect.lines.line-status."+n)}},d=function(e){return{status:e,text:t.getTranslation("dect.state."+e)}},p=function(){var e="nvox.sip-common";return{agent:{path:e+".agent",default:""},localUdpPort:{path:e+".udp-port.port",default:5060},localTcpPort:{path:e+".tcp-port.port",default:5060},localTlsPort:{path:e+".tls-port.port",default:5061},rtpFromPort:{path:e+".rtp-port.port",default:4e3},rtpToPort:{path:e+".rtp-port.end-port",default:4015},unescapeHash:{path:e+".unescape-hash-char",default:!1},stunServer:{path:e+".stun-server.stun",default:""}}},u={id:{path:"id"},isEnabled:{path:"disable",default:!1},sipRegistrationIsEnabled:{path:"password",default:!1},name:{path:"name",default:""},sipId:{path:"identity",default:""},displayName:{path:"display-name.name",default:""},login:{path:"login",default:""},password:{path:"password",default:"",deleteExplicitly:!0},regUri:{path:"registration-uri.uri",default:""},domain:{path:"domain",default:""},proxy:{path:"proxy",default:""},transport:{path:"transport",default:s.transport[0].id},tlsSecurityMode:{path:"tls-security-mode.mode",default:s.tlsSecurityMode[0].id},audioProtocol:{path:"audio-protocol.protocol",default:s.audioProtocol[0].id},regTimeout:{path:"reg-timeout.timeout",default:180},keepalive:{path:"keepalive",default:15},digitmap:{path:"digit-map.map",default:"",deleteExplicitly:!0},substitute:{path:"substitute",default:"",deleteExplicitly:!0},enableStun:{path:"disable-stun",default:!1,deleteExplicitly:!0},sdpNatRewrite:{path:"sdp-nat-rewrite",default:!1,deleteExplicitly:!0},dtmfMode:{path:"dtmf-mode.mode",default:s.dtmfMode[0].id},selectionId:{path:"selection-id.sel-id",default:s.selectionId[0].id,deleteExplicitly:!0},priority:{path:"priority",default:1},doNotDisturb:{path:"dnd",default:!1,deleteExplicitly:!0},forwardAlways:{path:"forward",default:!1,deleteExplicitly:!0},forwardAlwaysNumber:{path:"forward.number",default:""},forwardIfBusy:{path:"forward-if-busy",default:!1,deleteExplicitly:!0},forwardIfBusyNumber:{path:"forward-if-busy.number",default:""},forwardByTimeout:{path:"forward-if-timeout",default:!1,deleteExplicitly:!0},forwardByTimeoutNumber:{path:"forward-if-timeout.number",default:""},forwardByTimeoutTimeout:{path:"forward-if-timeout.timeout",default:""},codecsList:{path:"codec",default:[]},lockSingleCodec:{path:"lock-codec",default:!0,deleteExplicitly:!0},status:{path:"status",default:{}}},m=function(e){return e.replace(/^g(\d{3})(\d?)([a-z]*)$/,function(e,t,n,i){return"G."+t+(n&&"."+n)+i})},f=function(t){(t=angular.copy(t)).isEnabled=!t.isEnabled,t.sipRegistrationIsEnabled=Boolean(t.sipRegistrationIsEnabled),t.enableStun=!t.enableStun,t.sdpNatNoRewrite=!t.sdpNatNoRewrite,t.status=c(t.status),t.forwardAlways=!e.isEmpty(t.forwardAlways),t.forwardIfBusy=!e.isEmpty(t.forwardIfBusy),t.forwardByTimeout=!e.isEmpty(t.forwardByTimeout);var n=angular.copy(l),i=[];t.codecsList.forEach(function(e,t){var a=n.indexOf(e);i.push({priority:t+1,isUsed:!0,id:e,name:m(e)}),-1!==a&&delete n[a]});var a=0;return n.forEach(function(e){e&&(i.push({priority:a+t.codecsList.length+1,isUsed:!1,id:e,name:m(e)}),a++)}),t.codecsList=i,t},g=e.flow([i.ndmDataToModelCtor(u),f]),v=e.flow([function(e){return(e=angular.copy(e)).isEnabled=!e.isEnabled,e.enableStun=!e.enableStun,e.sipRegistrationIsEnabled||(e.login=e.sipId,e.password=!1),e.selectionId===o.constant.NO_SELECTION_ID&&delete e.selectionId,e.forwardAlways&&(e.forwardAlways={}),e.forwardIfBusy&&(e.forwardIfBusy={}),e.forwardByTimeout&&(e.forwardByTimeout={}),e.codecsList=e.codecsList.sort(function(e,t){return Number(e.priority)-Number(t.priority)}).filter(function(e){return e.isUsed}).map(function(e){return e.id}),delete e.status,e},i.modelToNdmDataCtor(u)]),h=function(t){return e.set({},"nvox.sip",t)},b=function(t,n,i){var a=i.sip||{},o=e.get(n,"lines.line",{}),s=Object.keys(a),r=[];return l=(t.supported_codecs||"").split(","),u.codecsList.default=l.slice(),s.forEach(function(e){var t=a[e]||{},n=o[e]||{};r.push(angular.extend({},{id:e},t,{status:n}))}),r.map(g).sort(function(e,t){return Number(t.priority)-Number(e.priority)})};return{recalculatePriorities:function(e,t){var n,i,a=[],o=!1,s=e.length;if(t.isRemoved)for(n=0;n<s;++n)(i=e[n]).id===t.id?o=!0:(o||i.priority--,a.push(i));else if(a=angular.copy(e),t.isNew)for(a.push({id:String(t.id),priority:t.priority}),n=0;n<s;++n)(i=a[n]).priority>=t.priority&&i.priority++,a[n]=i;else{if(t.priority<t.initialPriority)for(n=s-t.initialPriority+1;n<=s-t.priority;++n)(i=a[n]).priority++,a[n]=i;else if(t.priority>t.initialPriority)for(n=s-t.initialPriority-1;n>=s-t.priority;--n)(i=a[n]).priority--,a[n]=i;a[s-t.initialPriority].priority=t.priority}return a.map(function(e){var t=e.id,n=e.priority;return{id:t,priority:Number(n)}})},saveLinePriorities:function(e){return n.postAndSave(h(e))},toggleLineState:function(e,t){return n.postAndSave(h({id:e,disable:!t}))},saveLine:function(t,i){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=v(t),s=o.name,r=o.id,l=[];delete o.name,l.push(h({id:r,name:{name:s}})),i&&l.push(h(i)),l.push(h(o));var c=function(){return n.postAndSave(l)};return a?n.get("show/nvox/handsets").then(function(t){(t.handset||[]).forEach(function(t){return l.push(e.set({},"nvox.sip",{id:r,"incoming-mask":{ipui:t.ipui,no:!1},"outgoing-mask":{ipui:t.ipui,no:!1}}))})}).then(c):c()},deleteLine:function(e){return n.postAndSave(h({id:e,no:!0}))},getData:function(){var t={};return e.set(t,"show.nvox.info",{}),e.set(t,"show.nvox.sip-lines",{}),e.set(t,"show.rc.nvox",{}),n.post({url:"",data:t}).then(function(t){var n=e.get(t,"show.nvox.info",{}),a=e.get(t,"show.nvox.sip-lines",{}),o=e.get(t,"show.rc"),s=o.nvox||{};return{lines:b(n,a,s),sip:i.ndmDataToModelCtor(p(),"")(o)}})},createLineModels:b,getNewLineModel:function(){var t={};return e.forEach(u,function(e,n){t[n]=e.default}),t.isNew=!0,t.isEnabled=!1,t.enableStun=!0,f(t)},getOperatorName:function(t){return o.$.getOperatorsList().then(function(n){return e.forEach(n,function(e){for(var n=!0,i=Object.keys(e).filter(function(e){return"regTimeout"!==e&&"operatorName"!==e}),a=0,o=i.length;a<o;++a){var s=i[a];if(t[s]!==e[s]){n=!1;break}}n&&(t.operatorPreset=e.operatorName)}),t})},colorizeLineStatus:function(e){var t,n=e.text,i=e.status;switch(i){case"registered":t="success";break;case"error":t="warning";break;default:t="gray"}return{status:i,text:n,toggleStatus:{status:t,text:n}}},formatStatus:c,getUnknownLineStatus:function(){return{status:"unavailable",text:t.getTranslation("dect.lines.line-status.unavailable")}},getDisabledLineStatus:function(){return{status:"disabled",text:t.getTranslation("dect.lines.line-status.disabled")}},formatDectStateStatus:d,getLineStatus:function(t,n){var i=t.status;return"unplugged"===i||"unavailable"===i||e.isEmpty(t)?d(n):c(t)},tryDial:function(t,i){return n.post({url:"",data:e.set({},"show.nvox.try-dial",e.map(t,function(e){return{ipui:e,number:i}}))}).then(function(t){return e.get(t,"show.nvox.try-dial",[])})},saveSipSettings:function(e){return n.postAndSave(i.getObj2SetByMap(p(),e))},validators:a,UNPLUGGED_LINE_STATUS:"unplugged",UNAVAILABLE_LINE_STATUS:"unavailable"}}e.$inject=["_","utils","router","dectService","dectValidators","dectLinesOptions"],angular.module("keenetic").factory("dectLines",e)}(),function(){function e(e,t){for(var n={SIPNET:{operatorName:"SIPNET",regUri:"sipnet.ru",proxy:"sipnet.ru",domain:"sipnet.ru",regTimeout:1800},"SIPNET (TLS)":{operatorName:"SIPNET (TLS)",regUri:"sipnet.ru:5061",proxy:"sipnet.ru:5061",domain:"sipnet.ru",regTimeout:1800,transport:"tls",dtmfMode:"rfc2833",audioProtocol:"both"},"TelMe (Телфин)":{operatorName:"TelMe (Телфин)",regUri:"sip.telphin.com:5068",proxy:"voice.telphin.com:5068",domain:"sip.telphin.com",regTimeout:1800},YouMagic:{operatorName:"YouMagic",regUri:"voip.mtt.ru",proxy:"voip.mtt.ru",domain:"voip.mtt.ru",regTimeout:180},PCTEL:{operatorName:"PCTEL",regUri:"sip.pctel.ru",proxy:"sip.pctel.ru",domain:"sip.pctel.ru",regTimeout:60},SIPmobile:{operatorName:"SIPmobile",regUri:"sipmobile.ru",proxy:"sipmobile.ru",domain:"sipmobile.ru",regTimeout:60},FreeCall:{operatorName:"FreeCall",regUri:"sip.voiparound.com",proxy:"sip.voiparound.com",domain:"sip.voiparound.com",regTimeout:180},Nonoh:{operatorName:"Nonoh",regUri:"sip.nonoh.net",proxy:"sip.nonoh.net",domain:"sip.nonoh.net",regTimeout:180},ActionVOIP:{operatorName:"ActionVOIP",regUri:"sip.actionvoip.com",proxy:"sip.actionvoip.com",domain:"sip.actionvoip.com",regTimeout:180},WebCallDirect:{operatorName:"WebCallDirect",regUri:"webcalldirect.com",proxy:"webcalldirect.com",domain:"webcalldirect.com",regTimeout:180},"Мегафон - Мультифон":{operatorName:"Мегафон - Мультифон",regUri:"sbc.multifon.ru",proxy:"sbc.multifon.ru",domain:"multifon.ru"},"Мегафон - Мультифон (TCP)":{operatorName:"Мегафон – Мегафон - Мультифон (TCP)",regUri:"sbc.multifon.ru",proxy:"sbc.multifon.ru",domain:"multifon.ru",transport:"tcp",lineName:"Мегафон - Мультифон"},"МСН Телеком":{operatorName:"МСН Телеком",regUri:"sip.mcn.ru",proxy:"sip.mcn.ru",domain:"sip.mcn.ru"},"Telbo.com":{operatorName:"Telbo.com",regUri:"sip.telbo.com",proxy:"sip.telbo.com",domain:"sip.telbo.com"},UISCOM:{operatorName:"UISCOM",regUri:"voip.uiscom.ru:9060",proxy:"voip.uiscom.ru:9060",domain:"voip.uiscom.ru"},"Chief 070 TW":{operatorName:"Chief 070 TW",regUri:"",proxy:"202.133.231.17",domain:"chiefcall.com.tw"},"Onlime – Ростелеком":{operatorName:"Onlime – Ростелеком",regUri:"tel2.moscow.rt.ru",proxy:"tel2.moscow.rt.ru",domain:"tel2.moscow.rt.ru",regTimeout:300},Zadarma:{operatorName:"Zadarma",regUri:"sip.zadarma.com",proxy:"sip.zadarma.com",domain:"sip.zadarma.com",regTimeout:120},"Zadarma (TCP)":{operatorName:"Zadarma (TCP)",regUri:"sip.zadarma.com:5065",proxy:"sip.zadarma.com:5065",domain:"sip.zadarma.com",regTimeout:120,transport:"tcp",dtmfMode:"rfc2833"},"Zadarma PBX (UDP)":{operatorName:"Zadarma PBX (UDP)",regUri:"pbx.zadarma.com:5060",proxy:"pbx.zadarma.com:5060",domain:"pbx.zadarma.com",regTimeout:120,transport:"udp"},"Zadarma PBX (TCP)":{operatorName:"Zadarma PBX (TCP)",regUri:"pbx.zadarma.com:5065",proxy:"pbx.zadarma.com:5065",domain:"pbx.zadarma.com",regTimeout:120,transport:"tcp",dtmfMode:"rfc2833"},Talk37:{operatorName:"Talk37",regUri:"talk37.ru",proxy:"talk37.ru",domain:"talk37.ru",regTimeout:300}},i=function(e){return e.toUpperCase()},a=["NO"],o=0;o<=9;++o)a.push(o+"");var s={lineStatus:["disable","disabled","unplugged","unavailable","registered"],transport:["udp","tcp","tls"],audioProtocol:["rtp","srtp","both"],tlsSecurityMode:["sip-tls","sips"],selectionId:a},r={transport:i,audioProtocol:function(e){return"dect.lines.options.audio-protocol.".concat(e)},tlsSecurityMode:i,selectionId:function(e){return"NO"!==e?"#"+e:"dect.lines.editor-popup.form.no-line-selection-id"}},l={};return Object.keys(s).forEach(function(e){r[e]=t.idsToOptions(s[e],r[e]||angular.identity),l[e]=function(e){var t={};return e.forEach(function(e){return t[e]=e}),t}(s[e])}),r.dtmfMode=[{id:"rfc2833",label:"RFC2833"},{id:"sip-info",label:"SIP Info"},{id:"inband",label:"Inband"}],l.dtmfMode={},r.dtmfMode.forEach(function(e){return l.dtmfMode[e.id]=e.id}),{$:{getOperatorsList:function(){return e.when(n)}},constant:{NO_SELECTION_ID:"NO",MAX_SELECTION_ID:9,CUSTOM_OPERATOR_PRESET:"CUSTOM",DEFAULT_DECT_OPERATOR:{regUri:"",proxy:"",domain:"",regTimeout:180,transport:"udp",dtmfMode:"rfc2833"}},enums:l,selectboxOptions:r}}e.$inject=["$q","utils"],angular.module("keenetic").factory("dectLinesOptions",e)}(),function(){function e(e,t,n,i,a,o,s,r,l,c){var d=this,p=l.constant.DECT_RESTART_TIMEOUT,u=c.constant.MAX_SELECTION_ID+1;d.progress=0,d.dectIsRestarting=!1,d.dectDongleIsPlugged=!1,d.dectStatus="",d.ui={locked:!0,callTestIsDisabled:!0,lock:function(){return d.ui.locked=!0,e.when(!0)},unlock:function(){if(d.ui.unlockPending)return e.when(!0);d.ui.unlockPending=!0;var n=e.defer();return t(function(){d.ui.locked=!1,d.ui.unlockPending=!1,n.resolve(!0)},d.ui.unlockTimeout),n.promise},reset:angular.noop};var m=function(){var e=[];return d.table.data.forEach(function(t){e.push({id:t.id,name:t.name,priority:t.priority-0,selectionId:t.selectionId})}),e},f=!0,g=function(){(!(arguments.length>0&&void 0!==arguments[0])||arguments[0])&&o.success("notifications.saved"),d.dectDongleIsPlugged&&(d.dectIsRestarting=!0,d.table.data.forEach(function(e){e.dectIsRestarting=!0}),t(function(){d.dectIsRestarting=!1,d.table.data.forEach(function(e){e.dectIsRestarting=!1})},p))},v=function(){return(d.table.dataLoaded?e.when(!0):d.ui.lock()).then(r.getData).then(function(e){d.table.data=e.lines.map(function(e){var t=n.find(d.table.data,{id:e.id});return t?(e.isEnabled=t.isEnabled,e.dectIsRestarting=t.dectIsRestarting):e.dectIsRestarting=d.dectIsRestarting,e.status=d.dectIsRestarting&&t?t.status:r.getLineStatus(e.status,d.dectStatus),e.onToggle=function(t){return r.toggleLineState(e.id,t).then(function(){t||(e.status=r.colorizeLineStatus(r.getDisabledLineStatus()))}).then(function(){return g(!1)})},e.status=r.colorizeLineStatus(e.status),e}),d.table.dataLoaded=!0,f&&(d.sip=e.sip,f=!1,n.get(d,"form.$setPristine",angular.noop)())}).finally(d.ui.unlock)},h=function(e){e&&g()};d.onDectCheck=function(e){d.dectIsRestarting||(d.dectStatus=e.status),d.dectDongleIsPlugged=e.plugged,d.ui.callTestIsDisabled=!e.plugged||!e.handsetCount||!d.table.dataLoaded||0===d.table.data.length,d.editor.isVisible||v().then(function(){0===d.table.data.length&&(d.ui.callTestIsDisabled=!0)})},d.addNewLine=function(){d.table.data.length===u?a.alert("dect.lines.maximum-number-of-lines-is-configured"):d.editor.show(null,m()).then(h).then(v)},d.testCall=function(){d.callTestCtrl&&d.callTestCtrl.show()},d.table={data:[],dataLoaded:!1,columns:{isEnabled:{title:"dect.lines.table.line-name",width:380,directive:{name:"ndm-toggle",options:{"label-on":"{{row.name}}","label-off":"{{row.name}}",description:"row.status.toggleStatus","ng-attr-call-on-change":"row.onToggle","ng-attr-disabled":"row.dectIsRestarting",name:"sip-line-{{row.id}}-"}},clickable:!0},selectionId:{title:"dect.lines.table.line-selection-id",width:40,modify:function(e){return e===c.constant.NO_SELECTION_ID?"—":"#"+e}},digitmap:{title:"dect.lines.editor-popup.form.digitmap",modify:function(e){return e||i.getTranslation("dect.lines.table.digitmap-is-not-used")}},editHint:{title:" ",width:20,directive:"ndm-icon",modify:function(){return"pencil"}}},onRowClick:function(e){d.editor.show(e,m()).then(h).then(v)},onToggleCellClick:function(){var e=arguments.length<=3?void 0:arguments[3];d.table.onRowClick(e)},onDragEnd:function(e){if(e.source.index!==e.dest.index){var t=d.table.data.length,n=[];return d.table.data.forEach(function(e,i){var a=t-i;n.push({id:e.id,priority:a}),d.table.data[i].priority=a}),r.saveLinePriorities(n).then(g)}}},d.saveSipSettings=function(){return r.saveSipSettings(d.sip).then(function(){f=!0,d.ui.lock()})},v().then(function(){d.progress=100})}e.$inject=["$q","$timeout","_","utils","modal","notification","dectCheck","dectLines","dectService","dectLinesOptions"],angular.module("keenetic").controller("DectLinesController",e)}(),function(){function e(e,t,n,i,a,o,s,r){var l=this;l.validators=angular.extend({},o.validators,{isLineNameUnique:function(e){if(e)return n.includes(l.lineNames,e)?i.getTranslation("dect.lines.editor-popup.validation-error.not-unique-name"):void 0}}),l.postValidator={_fields:[],_addField:function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",o=l.postValidator;o[e]={error:"",resetError:function(){o[e].error=""},setError:function(){o[e].error=i.getTranslation(t)},isInvalid:function(t){return n.some(Object.keys(t.ndmErrors),function(t){return n.includes(t,"".concat(a||e,".status"))})}},o._fields.push(e)},markInvalidFields:function(e){var t=l.postValidator;t._fields.forEach(function(n){var i=t[n];i.isInvalid(e)&&i.setError()})},checkForInvalidFields:function(e){var t=l.postValidator;return n.some(t._fields,function(n){return t[n].isInvalid(e)})}},l.postValidator._addField("digitmap",r.INVALID_DIGITMAP_L10N,"digit-map"),l.postValidator._addField("substitute",r.INVALID_SUBSTITUTION_L10N),l.constant=s.constant,l.isVisible=!1,l.codecsOrderChanged=!1,l.deferred=null,l.model={},l.saveIsInProgress=!1,l.ui={isReady:!1,isLocked:!1,sipSettingsIsVisible:!1,additionalSettingsIsVisible:!1,lock:function(){return l.ui.isLocked=!0,e.when(!0)},unlock:function(){return l.ui.isLocked=!1,e.when(!1)},reset:angular.noop,showSipSettingsSubform:function(){l.ui.sipSettingsIsVisible=!0,l.ui.onSipSettingsToggle(!0)},onSipSettingsToggle:function(e){if(e){var t=n.get(l,"form.sipSettingsSubform"),i=n.pickBy(t,function(e){return n.has(e,"$modelValue")});n.forEach(i,function(e){return n.invoke(e,"revalidate")})}}},l.options=s.selectboxOptions,l.options.allAudioProtools=angular.copy(l.options.audioProtocol.slice()),l.options.allSelectionIds=angular.copy(l.options.selectionId),l.options.onlyRtpAudioProtocol=angular.copy(l.options.audioProtocol.slice(0,1));var c=function(){n.get(l,"form.$setPristine",angular.noop)()};l.options.operatorPreset=[],l.show=function(a,r){l.ui.isReady=!1,l.ui.lock();var d=r.length,p=angular.copy(l.options.allSelectionIds);l.ndmReturnedErrorsOnLastSave=!1,l.deferred=e.defer(),l.isVisible=!0,l.codecsOrderChanged=!1,l.nameByOperator={},l.priorities=r.slice(),l.model=a||o.getNewLineModel(),r.forEach(function(e){e.selectionId!==s.constant.NO_SELECTION_ID&&delete p[e.selectionId+1]}),l.options.selectionId=p;var u=[],m=d;if(n.get(l,"model.isNew")){m=d+1,l.model.sipRegistrationIsEnabled=!0;var f=[],g=[];angular.copy(l.priorities).forEach(function(e){f.push(Number(e.id)),g.push(Number(e.priority))}),l.model.id=String(i.firstUnusedPositiveId(f)),l.model.priority=i.firstUnusedPositiveId(g)}for(var v=0;v<m;++v)u.push({id:v+1,label:String(v+1)});u[0].label+=" ("+i.getTranslation("dect.lines.editor-popup.form.line-priority-lowest")+")",u[m-1].label+=" ("+i.getTranslation("dect.lines.editor-popup.form.line-priority-highest")+")",l.initialModelPriority=l.model.priority,l.options.priority=u,o.getOperatorName(l.model).then(function(){l.model.operatorPreset===s.constant.CUSTOM_OPERATOR_PRESET&&l.ui.showSipSettingsSubform()}),l.model.codecsListOnLoad=l.model.codecsList.slice();var h=0;return l.model.codecsList.forEach(function(e){return e.isUsed&&h++}),1===h&&l.model.codecsList.forEach(function(e){e.singleCodecIsUsed=!0}),t(function(){return s.$.getOperatorsList().then(function(e){l.operatorPresets=e;var t=Object.keys(e),n=angular.copy(r).map(function(e){return e.name}),a=[{id:s.constant.CUSTOM_OPERATOR_PRESET,label:i.getTranslation("dect.lines.editor-popup.form.custom-operator-preset")}];l.model.isNew||(n=n.filter(function(e){return e!==l.model.name})),t.forEach(function(e){n.forEach(function(t){0===t.indexOf(e)&&(l.nameByOperator[e]?l.nameByOperator[e]++:l.nameByOperator[e]=1)}),a.push({id:e,label:e})}),l.options.operatorPreset=a,l.lineNames=n,l.multipleLinesExist=l.model.isNew&&d>0||d>1,l.model.isNew||l.model.operatorPreset||(l.ui.showSipSettingsSubform(),l.model.operatorPreset=s.constant.CUSTOM_OPERATOR_PRESET)}).finally(function(){l.ui.unlock(),t(function(){c(),n.get(l,"form.modifiedModels",[]).forEach(function(e){e.$setPristine()}),l.form&&(l.form.modified=!1),l.ui.isReady=!0})})}),l.deferred.promise},l.codecsTable={columns:{name:{title:"dect.lines.editor-popup.form.codec",width:60},isUsed:{title:"dect.lines.editor-popup.form.is-used",directive:{name:"ndm-checkbox",options:{label:"","ng-attr-disabled":"row.singleCodecIsUsed && row.isUsed",name:"tunnel-{{row.id}}-is-used"}},clickable:!0,width:120}},onCellClick:function(e,t,n,i){if(!1!==n){var a=e.target.tagName;if("INPUT"===a||"LABEL"===a||"checkbox"===e.target.className){e.preventDefault();var o=0;l.model.codecsList.forEach(function(e){return e.isUsed&&o++}),t||1!==o?2===o&&t?(i.isUsed=!i.isUsed,l.model.codecsList.forEach(function(e){e.singleCodecIsUsed=!0})):i.isUsed=!i.isUsed:(i.isUsed=!i.isUsed,l.model.codecsList.forEach(function(e){e.singleCodecIsUsed=!1}))}}},onDragEnd:function(){for(var e=l.model.codecsList,t=!1,n=0,i=e.length;n<i;++n)l.model.codecsListOnLoad[n].name!==e[n].name&&(t=!0),e[n].priority=n+1;l.codecsOrderChanged=t}};var d=function(){return l.saveIsInProgress=!1,l.cancel(!0)},p=function(e){l.ndmReturnedErrorsOnLastSave=!0,l.postValidator.markInvalidFields(e),l.ui.unlock()};l.save=function(){if(l.ui.isLocked)return!1;l.ui.lock(),l.saveIsInProgress=!0;var e=o.recalculatePriorities(l.priorities,{id:l.model.id,name:l.model.name,isNew:Boolean(l.model.isNew),priority:Number(l.model.priority),initialPriority:Number(l.initialModelPriority)});return l.model.isNew?o.saveLine(l.model,e,!0).then(function(e){if(!e.ndmErrors||!l.postValidator.checkForInvalidFields(e))return d();p(e)}).finally(function(){l.saveIsInProgress=!1}):o.saveLine(l.model).then(function(t){if(!t.ndmErrors||!l.postValidator.checkForInvalidFields(t))return o.saveLinePriorities(e).then(d);p(t)}).finally(function(){l.saveIsInProgress=!1})},l.deleteLine=function(){return l.ui.lock().then(function(){return a.confirm("dect.lines.editor-popup.confirm.delete-line")}).then(function(){return o.deleteLine(l.model.id).then(function(){return o.saveLinePriorities(o.recalculatePriorities(l.priorities,{id:l.model.id,isRemoved:!0}))}).then(l.cancel)},l.ui.unlock)},l.cancel=function(i){if(!l.saveIsInProgress){var a=e.when(!0);if(n.get(l,"model.isNew")&&l.ndmReturnedErrorsOnLastSave){var s=n.get(l,"model.id");angular.isDefined(s)&&(a=o.deleteLine(s))}return a.then(function(){n.get(l,"form.reset",angular.noop)(),l.model.codecsList=n.get(l,"model.codecsListOnLoad",[]).slice(),t(c),t(l.ui.unlock),l.isVisible=!1,l.model=null,l.ui.additionalSettingsIsVisible=!1,l.ui.sipSettingsIsVisible=!1,l.deferred&&(l.deferred.resolve(Boolean(i)),l.deferred=null)})}},l.closePopup=function(){return l.cancel(!1)},l.cbk={onToggleEnableStun:function(){l.model.enableStun||(l.model.sdpNatRewrite=!0)},onToggleForwardAlways:function(){l.model.forwardAlways||(l.model.forwardIfBusy=!1,l.model.forwardByTimeout=!1)},applyOperatorPreset:function(e,t){var i=angular.merge(angular.copy(s.constant.DEFAULT_DECT_OPERATOR),l.operatorPresets[e]);if(t===s.constant.CUSTOM_OPERATOR_PRESET&&(l.ui.sipSettingsIsVisible=!1),e===s.constant.CUSTOM_OPERATOR_PRESET&&l.ui.showSipSettingsSubform(),n.forEach(i,function(e,t){l.model[t]=e}),n.get(l,"form.lineName.$pristine"))if(l.nameByOperator[e]){for(var a,o=l.nameByOperator[e],r=!1;!r;)a="".concat(e," (").concat(o,")"),r=!n.includes(l.lineNames,a),o++;l.model.name=a}else l.model.name=i.lineName||e},onSipTransportChange:function(e){"tls"===e?l.options.audioProtocol=l.options.allAudioProtools.slice():(l.options.audioProtocol=l.options.onlyRtpAudioProtocol.slice(),l.model.audioProtocol=l.options.audioProtocol[0].id)}}}e.$inject=["$q","$timeout","_","utils","modal","dectLines","dectLinesOptions","dectValidators"],angular.module("keenetic").controller("DectLineEditorController",e)}(),function(){function e(e,t,n,i,a,o){var s=this;s.isVisible=!1,s.phoneNumber="",s.deferred=null,s.validators=i,s.lines={},s.handsets={},s.ui={isLocked:!1,lock:function(){return s.ui.isLocked=!0,e.when(!0)},unlock:function(){return s.ui.isLocked=!1,e.when(!1)}},s.show=function(){return s.deferred=e.defer(),o.getHSTableData().then(function(e){var n=[];t.forEach(e.handsets,function(e){n.push({handsetId:e.id,handset:e.name,ipui:e.ipui})}),t.forEach(e.sips,function(e){s.lines[e.id]=e}),s.table.data=t.sortBy(n,"id"),s.table.dataLoaded=!0,s.isVisible=!0}),s.deferred.promise},s.testNumber=function(){return s.ui.lock().then(function(){return a.tryDial(t.map(s.table.data,"ipui"),s.phoneNumber)}).then(function(e){t.map(e,function(e,i){var o=s.table.data[i];o&&(t.isEmpty(e)?(o.line=n.getTranslation("dect.lines.call-test-popup.no-suitable-lines"),o.status=""):(o.line=(s.lines[e.line]||{}).name,o.status=a.formatStatus(e).text))})}).finally(s.ui.unlock)},s.close=function(){s.isVisible=!1,s.lines={},s.table.data=[],s.table.dataLoaded=!1,s.phoneNumber="",s.ui.unlock(),s.deferred&&s.deferred.resolve(!0)},s.table={dataLoaded:!1,data:[],columns:{handset:n.getTranslation("dect.handsets.popup.form.name"),line:n.getTranslation("dect.lines.call-test-popup.table.line"),status:n.getTranslation("dect.lines.call-test-popup.table.status")}}}e.$inject=["$q","_","utils","dectValidators","dectLines","dectBaseService"],angular.module("keenetic").controller("DectLineCallTestController",e)}(),function(){function e(e,t,n){var i={OK:"OK",NOT_ANSWERED:"NOT_ANSWERED",REJECTED:"REJECTED",FORWARDED:"FORWARDED",MISSED:"MISSED"},a={revision:"",data:[]};return{CALL_STATUS:i,getData:function(){return t.get("show/nvox/call-history/status").then(function(e){return e.revision}).then(function(n){return n===a.revision?a.data:(a.revision=n,t.get("show/nvox/call-history").then(function(t){var n=e.get(t,"call_history.call",[]).map(function(t){var n=t.hs,a=t.line,o=t.type,s=t.start_time,r=Number(t.duration),l=Number(t.release_code),c=e.get(t,"release_reason",""),d=t.other_party_number,p=t.other_party_name,u={};switch(o){case"outgoing":switch(l){case 0:r?(u.duration=r,u.status=i.OK):u.status=i.NOT_ANSWERED;break;case 200:u.duration=r,u.status=i.OK;break;default:u.status=i.NOT_ANSWERED,u.code=l,u.reason=c}break;case"accepted":u.duration=r,u.status=i.OK;break;case"missed":"rejected"===c?u.status=i.REJECTED:487!==l&&l?(u.status=i.MISSED,u.code=l,u.reason=c):u.status=i.MISSED;break;case"forwarded":u.status=i.FORWARDED,u.reason=c;break;case"internal":r>0?(u.status=i.OK,u.duration=r):c||l?(u.code=l,u.reason=c,u.status=c.toUpperCase()):u.status=i.NOT_ANSWERED}return{direction:"forwarded"===o?"forwarded":"accepted"===o||"missed"===o?"in":"out",time:s,call:{number:p?"internal"===o?p:{name:p,number:d}:d,status:u},status:u,handset:n,line:a}});return a.data=n,n}))})},clearAll:function(){return t.post("nvox/call-history/clear",{}).then(function(){a={revision:"",data:[]}})},download:function(){return t.post({url:"get",data:{filename:"dect:dect-call-history.csv"}}).then(function(e){e.ndmErrors||void 0===e.port||"out"!==e.port.direction||n.location.assign(t.constants.CI_URL+"/dect:dect-call-history.csv")})}}}e.$inject=["_","router","$window"],angular.module("keenetic").factory("callHistoryService",e)}(),function(){function e(e,t){var n=this,i=e.CALL_STATUS;n.progress=100,n.isBasePlugged=!1,n.onDectCheck=function(e){return n.isBasePlugged=e.plugged,n.init()},n.clearAll=function(){return e.clearAll()},n.download=function(){return e.download()};n.table={dataLoaded:!1,columns:{icon:{title:" ",width:30,directive:"ndm-icon",modify:function(e,t){var n=t.direction,a=t.status.status;switch(n){case"in":switch(a){case i.OK:return"call-incoming";case i.MISSED:case i.REJECTED:return"call-missed"}break;case"forwarded":return"call-forwarded";default:switch(a){case i.OK:return"call-outgoing";case i.NOT_ANSWERED:return"call-not-answered";case i.REJECTED:return"call-missed"}}}},call:{title:"dect.call-history.table.call",width:120,modify:function(e){var n=e.name,i=e.number.number||e.number;return"hs*"===i&&(i=t.getTranslation("dect.call-history.common_call")),n?n+'<div class="help-text">'+i+"</div>":i}},time:{title:"dect.call-history.table.time",width:110,modify:function(e){var n=new Date(e),i=new Date,a=i.getFullYear(),o=i.getMonth(),s=i.getDate(),r=n.getFullYear(),l=n.getMonth(),c=s-n.getDate();if(a!==r||o!==l||c>1)return t.getDate(n,"<br>");n=3600*n.getHours()+60*n.getMinutes()+n.getSeconds();var d=0===c?"today":"yesterday";return t.getTranslation("dect.call-history.".concat(d),"",{time:t.getSplittedTime(n)})}},handset:{width:120,title:"dect.call-history.table.handset"},line:{width:140,title:"dect.call-history.table.line"},status:{title:"dect.call-history.table.status",modify:function(e,n){var a,o=n.direction,s=n.line,r=e.status,l=e.code,c=e.reason,d=!(a=r===i.OK?"status-ok":r===i.NOT_ANSWERED?"":"status-problem")&&l&&c,p="";if("intercom"!==s&&(p+='<div class="'+a+'">'+t.getTranslation("dect.call-history."+(d?"out-not-answered":o))),"forwarded"===o)return t.getTranslation("dect.call-history.forwarded","",{number:c});switch(r){case i.OK:p+="<div>"+t.getSplittedTime(e.duration)+"</div>";break;case i.NOT_ANSWERED:p+=d?"<div>"+(l&&c?"("+l+" "+c+")":"")+"</div>":"<div>"+t.getTranslation("dect.call-history.not_answered")+"</div>";break;default:p+="<div>"+t.getTranslation("dect.call-history."+r.toLowerCase())+"</div>"}return p+="</div>"}}},data:[]},n.init=function(){return e.getData().then(function(e){n.table.data=n.isBasePlugged?e:[],n.table.dataLoaded=!0})}}e.$inject=["callHistoryService","utils"],angular.module("keenetic").controller("CallHistoryController",e)}(),function(){function e(e,t,n,i,a,o){var s=n.constant.SERVICE_NAME,r={no:!0},l=["parallelCallExternal","parallelHoldResume","parallelToggle","parallelAccept"],c=["parallelReplace","parallelReject","parallelReleasePassive","parallelReleaseActive","parallelTransfer","parallelIntercept","parallelCallInternal"],d=function(){var e="nvox.call-history",t="nvox.parallel";return{enable:{path:"service.".concat(s),default:!1},pin:{path:"nvox.dect.base.pin",default:"0000"},offHookTimer:{path:"nvox.phone.offhook-timer.timer",default:1e4},dialDigitTimer:{path:"nvox.phone.dial-digit-timer.timer",default:5e3},callHistoryDirectory:{path:e+".directory",default:""},handsetCallHistoryEdit:{path:e+".handset-edit",default:!1},callHistoryLength:{path:e+".length",default:500},handsetPhoneBookEdit:{path:"nvox.phonebook.handset-edit",default:!1},phoneBookLastNameFirst:{path:"nvox.phonebook.last-name-first",default:0},parallelDisable:{path:t+".disable",default:!0},parallelReplace:{path:t+".replace",default:!0},parallelToggle:{path:t+".toggle",default:!1},parallelHoldResume:{path:t+".hold-resume",default:!1},parallelAccept:{path:t+".accept",default:!1},parallelReject:{path:t+".reject",default:!1},parallelReleasePassive:{path:t+".release-passive",default:!1},parallelReleaseActive:{path:t+".release-active",default:!1},parallelTransfer:{path:t+".transfer",default:!1},parallelIntercept:{path:t+".intercept",default:!1},parallelCallInternal:{path:t+".call-internal",default:!1},parallelCallExternal:{path:t+".call-external",default:!1}}},p=function(e,t){return e.filter(function(e){return e.ipui===t})[0]||null},u=function(e,t,n){var a=[];return i.forEach(n,function(e,t){e.id=t,a.push(e)}),t=angular.copy(t),a.sort(function(e,t){return Number(t.priority)-Number(e.priority)}),t=t.map(function(t){var n=p(e,t.ipui)||{};return(t=angular.merge(t,n)).continuous=!t["disable-continuous-ring"],t.sips=[],t.status=n.status||"offline",t}),a.forEach(function(e){var n=e.id,a=e["incoming-mask"]||{},o=e["outgoing-mask"]||{},s="sipLine"+n;t.map(function(t){return t[s]={in:!1,out:!1},t.sips.push({id:n,name:e.name,digitmap:i.get(e,"digit-map.map",""),incoming:!1,outgoing:!1}),t}),i.forEach(a,function(e){var i=p(t,e.ipui);i&&(i[s].in=!0,i.sips.filter(function(e){return e.id===n})[0].incoming=!0)}),i.forEach(o,function(e){var i=p(t,e.ipui);i&&(i[s].out=!0,i.sips.filter(function(e){return e.id===n})[0].outgoing=!0)})}),{handsets:t,sips:a}},m=i.flow([n.ndmDataToModelCtor(d(),"show.rc."),function(e){return e.enable=(!i.isObject(e.enable)||!i.isEmpty(e.enable))&&Boolean(e.enable),e.offHookTimer/=1e3,e.dialDigitTimer/=1e3,e.isStoreLog=Boolean(e.callHistoryDirectory),e.parallelEnable=!e.parallelDisable,e.phoneBookLastNameFirst=e.phoneBookLastNameFirst.toString(),delete e.parallelDisable,c.forEach(function(t){e[t]=e[t]||""}),e}]),f=function(e){var t=i.get(e,"show.nvox.handsets.handset",[]),n=i.get(e,"show.rc.nvox.dect.handset",[]),a=i.get(e,"show.rc.nvox.sip",{});return angular.isArray(n)||(n=[]),angular.isArray(t)||(t=[]),u(t,n,a)};return{SERVICE_NAME:s,MERGED_PARALLEL_CALLS_FIELDS:l,getInitialData:function(){return o.post({url:"",data:{show:{nvox:{handsets:{}},rc:{nvox:{},service:_defineProperty({},s,{})}}}}).then(function(e){return e=t.convertNvoxFormatToNormal(e),{handsets:f(e),base:m(e)}})},getHSTableData:function(){return o.post({url:"",data:{show:{nvox:{handsets:{}},rc:{nvox:{}}}}}).then(function(e){return f(t.convertNvoxFormatToNormal(e))})},saveBaseSettings:function(e){return o.postAndSave(function(e){(e=angular.copy(e)).offHookTimer*=1e3,e.dialDigitTimer*=1e3,e.parallelDisable=!e.parallelEnable,delete e.parallelEnable,l.forEach(function(t){e[t]=e.parallelReplace}),e.phoneBookLastNameFirst="true"===e.phoneBookLastNameFirst,c.forEach(function(t){e[t]=e[t]||!1});var t=d(),a=n.getObj2SetByMap(t,e);return e.isStoreLog||i.set(a,t.callHistoryDirectory.path,r),a}(e))},toggleBaseState:function(t){return e.toggleService(s,t)},findHSByIpui:p,register:function(){return o.post("nvox/dect/base/handset-register",{})},stopRegistration:function(){return o.post({url:"nvox/dect/base/handset-register",data:r})},initHS:function(e,t,n){var a=p(t,e),s=Number(a.name.split(" ")[1]),r=isNaN(s)?t.length:s,l=[{dect:{handset:{ipui:e,name:"New handset "+r}}}];return n.forEach(function(t){l.push(i.set({},"nvox.sip",{id:t.id,"incoming-mask":{ipui:e}})),l.push(i.set({},"nvox.sip",{id:t.id,"outgoing-mask":{ipui:e}}))}),o.postAndSave(l)},deleteHs:function(e){return o.postAndSave([i.set({},"nvox.dect.base.handset-delete",{ipui:e}),i.set({},"nvox.dect.handset",Object.assign({ipui:e},r))])},saveHSSettings:function(e){var t=e.ipui,n=e.sips,a=e.name,s=e.continuous,l={ipui:t,name:a,"disable-continuous-ring":s?r:{}},c=[i.set({},"nvox.dect.handset",l)];return n.forEach(function(e){c.push(i.set({},"nvox.sip",{id:e.id,"incoming-mask":{ipui:t,no:!e.incoming}})),c.push(i.set({},"nvox.sip",{id:e.id,"outgoing-mask":{ipui:t,no:!e.outgoing}}))}),o.postAndSave(c)},createHSAndLinesModels:u,paging:{start:function(e){var t=i.set({},"nvox.dect.base.handset-paging",{ipui:e,melody:0});return o.post(t)},stop:function(e){var t=i.set({},"nvox.dect.base.handset-paging",{ipui:e,no:!0});return o.post(t)}}}}e.$inject=["appsService","dectCheck","dectService","_","utils","router"],angular.module("keenetic").factory("dectBaseService",e)}(),function(){function e(e,t,n,i,a,o,s,r,l,c){var d=this,p=o.translatePrefixCtor("dect.handsets.table"),u=function(e,t){r[t||"success"]({message:"dect.handsets.notifications."+e,timeout:1e3})};d.l10n={};var m=function(){var e=[],t=[];c.MERGED_PARALLEL_CALLS_FIELDS.forEach(function(n){n=a.camelCase(n.replace("parallel",""));var i=o.getTranslation("dect.base.form.parallel.".concat(n));e.push(i),t.push('\n                    <span class="page-dectBase__parallel-calls-balloon-title">'.concat(i,"</span>\n                    <br/>\n                    ").concat(o.getTranslation("dect.base.form.parallel.".concat(n,"Help")),"\n                "))}),d.l10n={parallelReplaceLabel:e.join("<br/>"),parallelReplaceBaloon:t.join("<br/><br/>")}};n.$on("$destroy",i.$on("$translateChangeSuccess",function(){return e(m)})),m(),d.progress=0,d.ready=!1,d.baseData={},d.tableData={},d.baseState="",d.isInRegistration=!1,d.isViewInRegistration=!1,d.isBasePlugged=!1,d.isPaging=!1,d.onToggle=function(e){return c.toggleBaseState(e)},d.isValidPin=l.pin,d.isValidSequence=l.parallelSequence,d.preRegistrationPopup={isVisible:!1,getDescription:function(){return o.getTranslation("dect.handsets.modal-before-registration.description","",{pin:d.baseData.pin})},open:function(){d.preRegistrationPopup.isVisible=!0},close:function(){d.preRegistrationPopup.isVisible=!1}},d.registrationPopup={isVisible:!1,progress:0,cancelTimer:function(){d.registrationPopup.timer&&t.cancel(d.registrationPopup.timer)},getDescription:function(){return o.getTranslation("dect.handsets.registration-popup.description","",{pin:d.baseData.pin})},close:function(){d.registrationPopup.isVisible=!1,d.registrationPopup.cancelTimer()}},d.onDectCheck=function(e){d.isInRegistration=e.isInRegistration,d.isBasePlugged=e.plugged;var t=o.translatePrefixCtor("dect.base.form.baseState");e.plugged?d.baseData.enable?d.baseState={color:"green",text:t("enabled")}:d.baseState={color:"gray",text:t("disabled")}:(d.baseState={color:"red",text:t("dongleUnplugged")},d.preRegistrationPopup.isVisible&&d.preRegistrationPopup.close(),d.registrationPopup.isVisible&&d.registrationPopup.close()),d.registrationPopup.isVisible&&d.table.data.length<e.handsetCount?(d.registrationPopup.close(),s.alert("dect.handsets.success-registration").then(function(){return c.getHSTableData().then(function(e){var t=angular.copy(d.table.data),n=[];d.tableData=e,e.handsets.forEach(function(e){t.filter(function(t){return t.ipui===e.ipui}).length>0||n.push(e)});var i=n[0].ipui;if(i)return c.initHS(i,e.handsets,e.sips).then(c.getHSTableData).then(d.onTableDataUpdate).then(function(){return d.isViewInRegistration=!1,d.HSEditor.show(i)})})})):d.HSEditor.isVisible||d.registrationPopup.isVisible||d.isViewInRegistration||c.getHSTableData().then(d.onTableDataUpdate).then(function(){d.progress=100}),d.isPaging=Boolean(e.paging)},d.preRegisterHS=function(){if(d.table.data&&d.table.data.length>=6)return s.alert("dect.handsets.registered-maximum");d.preRegistrationPopup.open()},d.registerHS=function(e){return d.preRegistrationPopup.close(),d.isViewInRegistration=!0,c.register().then(function(){e&&u("registration-started"),d.waitHS()})},d.waitHS=function(){var e=0;d.registrationPopup.progress=0,d.registrationPopup.isVisible=!0,d.registrationPopup.cancelTimer(),d.registrationPopup.timer=t(function(){e<=120?(e++,d.registrationPopup.progress=e/120*100):(d.registrationPopup.close(),s.confirm("dect.handsets.registration-failed","dect.handsets.retry-registration").then(d.registerHS,angular.noop))},1e3)},d.stopRegistration=function(){return c.stopRegistration().then(function(){d.registrationPopup.close(),u("registration-stopped")})},d.startPaging=function(e){return c.paging.start(e)},d.stopPaging=function(){return c.paging.stop()},d.table={columns:{},dataLoaded:!1,data:[]},d.onTableDataUpdate=function(e){d.tableData=e,d.table.dataLoaded=!0;var t={name:{title:p("name"),width:150,modify:function(e,t){return"<span>"+o.generateIconHtml("indicator-".concat("online"===t.status?"online":"offline"))+e+'</span><div class="help-text number-comment">'+o.getTranslation("dect.handsets.table.number","",{number:t.id})+"</div>"}}};e.sips.forEach(function(n){t["sipLine"+n.id]={title:n.name||n.id,width:30,sortable:!1,directive:"ndm-icon",modify:function(t){var n;return n=t.in&&t.out?"Incoming_Outgoing_call":t.in?"call-incoming":t.out?"call-outgoing":"",Object.keys(e.sips).length>6&&n&&(n+="_small"),n}}}),d.table.columns=t,d.table.data=e.handsets};var f=!0;d.init=function(){return c.getInitialData().then(function(e){f&&(f=!1,d.onTableDataUpdate(e.handsets)),d.baseData=e.base,d.ready=!0,a.get(d,"form.$setPristine",angular.noop)()})},d.saveBaseSettings=function(){return c.saveBaseSettings(angular.copy(d.baseData)).then(a.get(d,"form.$setPristine",angular.noop)).then(function(){d.init(),r.success("notifications.saved")})};var g=o.translatePrefixCtor("dect.handsets.popup.table");d.HSEditor={data:{},isVisible:!1,textFieldsList:[],table:{columns:{name:{title:g("line"),width:155,sortable:!1},outgoing:{title:" ",subTitle:"".concat(o.generateIconHtml("call-outgoing"),"\n                            <span>").concat(g("outgoing"),"</span>"),width:130,sortable:!1,directive:{name:"ndm-checkbox",options:{label:"",name:"line-{{row.id}}-outgoing",clickable:!0}}},incoming:{title:" ",subTitle:"".concat(o.generateIconHtml("call-incoming"),"\n                            <span>").concat(g("incoming"),"</span>"),width:130,sortable:!1,directive:{name:"ndm-checkbox",options:{label:"",name:"line-{{row.id}}-incoming",clickable:!0}}},digitmap:{title:g("digitmap"),sortable:!1,modify:function(e){return e||o.getTranslation("dect.lines.table.digitmap-is-not-used")}}},data:[]},show:function(e){if(e){e=angular.isObject(e)?e.ipui:e;var t,n,i=angular.copy(d.tableData),o=c.findHSByIpui(i.handsets,e)||{};d.HSEditor.textFieldsList=[{label:"dect.handsets.popup.form.model",info:o.model||"IPUI:"+e},{label:"dect.handsets.popup.form.catiq",info:(t=o,n=["DECT/GAP"],Number(t.catiq1)&&n.push("HD Voice"),Number(t.catiq20)&&n.push("CAT-iq 2.0"),n.join(", "))}],d.HSEditor.data=o,d.HSEditor.table.data=o.sips,a.get(d.HSEditor,"form.$setPristine",angular.noop)(),d.HSEditor.isVisible=!0}},save:function(){return c.saveHSSettings(d.HSEditor.data).then(function(){d.HSEditor.close(),e(function(){return u("handset-saved")})})},close:function(){d.HSEditor.isVisible=!1},delete:function(){return c.deleteHs(d.HSEditor.data.ipui).then(function(){d.HSEditor.close(),e(function(){return u("handset-removed")})})}},d.init()}e.$inject=["$timeout","$interval","$scope","$rootScope","_","utils","modal","notification","dectValidators","dectBaseService"],angular.module("keenetic").controller("DectBaseController",e)}(),function(){function e(e,t,n,i,a){var o="none",s="permit",r="deny",l=function(){return{type:o,address:[]}},c=!1,d=!1,p=[],u=function(e,n){return t.set({},function(e){return["interface",e,"mac","access-list"]}(e),n)},m=function(e,t){return a.postAndSave(u(e,t))},f={addHostToAcl:function(e,t){return u(e,{address:t})},removeHostFromAcl:function(e,t){return u(e,{address:{address:t,no:!0}})},saveHostPermission:function(e,t,n,i){return n===i?f.addHostToAcl(e,t):f.removeHostFromAcl(e,t)},clearAcl:function(e){return u(e,{type:o,address:!1})}};return{MAX_ACL_SIZE:128,ACL_TYPE_NONE:o,ACL_TYPE_PERMIT:s,ACL_TYPE_DENY:r,queryBuilder:f,getAclConfiguration:function(){var n=arguments.length>0&&void 0!==arguments[0]&&arguments[0],s=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!s&&d)return e.when(d);s&&(d=!1);var r=e.defer();return p.push(r),c?r.promise:(c=!0,i.getSegments(n).then(function(n){var s=[];if(t.forEach(n,function(e){e.accessPoints=i.getSegmentAccessPoints(e),e.includesAccessPoints=e.accessPoints.length>0,e.includesAccessPoints?s.push(e.id):e.acl=l()}),0===s.length)return e.when(n);var r=s.map(function(e){return{name:e,"access-list":{}}}),c=t.set({},"show.rc.interface.mac",r);return a.postToRciRoot(c).then(function(e){var i=t.get(e,"show.rc.interface.mac",[]);s.forEach(function(e,a){var o=t.extend(l(),i[a]?i[a]["access-list"]:{});o.typeOnLoad=o.type,n[e].acl=o});var a=!t.some(n,function(e){return e.acl.type!==o});return{segments:n,noAclConfigured:a}})}).then(function(e){p.forEach(function(t){t.resolve(e)}),c=!1,d=e}),r.promise)},clearAclConfigurationCache:function(){d=!1},getAclTypeOptions:function(){return[o,s,r].map(function(e){return{id:e,label:"wireless-acl.acl-mode.".concat(e)}})},getHostsData:function(){var e=n.toRciQueryList(["show.rc.known.host"]);return a.postToRciRoot(e).then(function(e){var n=t.get(e,"[0].".concat("show.rc.known.host"),{});return{host:t.map(n,function(e,t){return{name:t,mac:e.mac,registered:!0}})}})},checkIfAclConfiguredForAccessPoints:function(n){if(0===n.length)return e.when(!1);var i=t.set({},"show.rc.interface.mac",n.map(function(e){return{name:e,"access-list":{}}}));return a.post({url:"",data:i}).then(function(e){var n=t.get(e,"show.rc.interface.mac",[]);return t.some(n,function(e){return t.get(e,"access-list.type")!==o})})},saveSegmentAcl:function(e,t,n){return m(e,{type:t,address:n.length>0&&n})},clearSegmentAcl:function(e){return m(f.clearAcl(e))},getDefaultAclObj:l}}e.$inject=["$q","_","utils","interfaces","router"],angular.module("keenetic").factory("wirelessAcl",e)}(),function(){function e(e,t,n,i,a,o,s,r,l,c,d,p,u,m,f){var g=this;g.tabs=[];var v=function(){g.l10n={deviceNameExists:c.getTranslation("errors.name-exists"),description:c.getTranslation("wireless-acl.page-description",null,{blacklist:c.getTranslation("wireless-acl.acl-mode.".concat(m.ACL_TYPE_DENY)),whitelist:c.getTranslation("wireless-acl.acl-mode.".concat(m.ACL_TYPE_PERMIT))}),getDeviceButtonDescription:c.getTranslation("wireless-acl.add-device-button-description",null,{devicesListRef:s.sysmode===r.SYSMODE.ROUTER?c.generateSrefLinkHtml(c.getTranslation("menu.connected-devices"),"controlPanel.devicesList"):c.generateSrefLinkHtml(c.getTranslation("menu.wifi-clients"),"controlPanel.wifiClients")}),getNoWifiSegmentDescription:function(e){return c.getTranslation("wireless-acl.segment-includes-no-access-points",null,c.l10n.getLinkChunks("ref",{"ui-sref":"controlPanel.segments({tab: '".concat(e,"'})"),class:"ref-link"}))}},g.tabs.length>0&&d.getSegments().then(function(e){g.tabs=g.tabs.map(function(t){return Object.assign({},t,{description:o.get(e,[t.id,"description"],t.id)})})})};v(),i.$on("$destroy",a.$on("$translateChangeSuccess",function(){return t(v)})),i.$on("$destroy",m.clearAclConfigurationCache);var h=function(){g.activeSegment&&t(function(){var e=g.hostsTable,t=e.data.filter(function(e){return e.isIncluded}).length;t>=m.MAX_ACL_SIZE?(e.data.forEach(function(e){e.isDisabled=!e.isIncluded}),g.aclLimitNoticeIsVisible=!0):(e.data.forEach(function(e){e.isDisabled=!1}),g.aclLimitNoticeIsVisible=!1),e.columns&&(e.columns.isIncluded.checkbox.model=e.data.length>0&&t===e.data.length)})},b=function(){var e=g.activeSegment.acl.address;g.hostsTable.data=o.chain(g.hosts).uniqBy("mac").map(function(t){return Object.assign({},t,{onChange:h,isIncluded:o.includes(e,t.mac)})}).value(),h()},_=function(){return m.getHostsData().then(function(e){g.hosts=e.host||[]})},y=function(e){return g.activeSegment=g.segments[e],m.checkIfAclConfiguredForAccessPoints(g.activeSegment.accessPoints).then(function(e){g.activeSegment.apAclNoticeRequired=e})},S=function(){return m.getAclConfiguration().then(function(e){g.segments=e.segments,g.segmentAclEnabled=o.some(g.segments,function(e){return e.acl.type!==m.ACL_TYPE_NONE})}).then(_).then(function(){return g.activeSegment.id?y(g.activeSegment.id):e.when(!0)})},w={isVisible:!1,name:"",mac:"",resetState:function(){w.name="",w.mac=""},show:function(){w.resetState(),w.isVisible=!0,t(o.get(g,"offlineRegistrationForm.deviceName.revalidate",angular.noop))},close:function(){w.isVisible=!1},register:function(){return u.registerHost(w.mac,w.name).then(_).then(b).then(w.close)},isDeviceNameUnique:function(e){return e&&o.find(g.hosts||[],{name:e})?g.l10n.deviceNameExists:null},isDeviceMacUnique:function(e){return e&&o.find(g.hosts||[],{mac:e})?"errors.mac-address-used":""}};g.offlineRegistrationPopup=w,g.onAclTypeChange=function(e,t){if(g.showNoticeOnAclTypeChange&&(f.setItem("segment-acl-shown",!0),l.alert("wireless-acl.notification-on-difference-with-ndw-acl"),g.showNoticeOnAclTypeChange=!1),g.activeSegment.acl.typeOnLoad===m.ACL_TYPE_NONE&&e!==m.ACL_TYPE_NONE&&t===m.ACL_TYPE_NONE&&0===g.activeSegment.acl.address.length)return e===m.ACL_TYPE_PERMIT?g.hostsTable.includeAllHosts():g.hostsTable.excludeAllHosts(),void h();e!==m.ACL_TYPE_NONE&&t&&t!==m.ACL_TYPE_NONE&&(g.hostsTable.data.forEach(function(e){e.isIncluded=!e.isIncluded}),h())},g.progress=0,g.isReady=!1,g.activeTab=null,g.activeSegment={},g.aclTypeOptions=m.getAclTypeOptions(),g.saveSegmentAcl=function(){g.ui.lock();var e=g.hostsTable.data.filter(function(e){return e.isIncluded}).map(function(e){return e.mac});return m.saveSegmentAcl(g.activeSegment.id,g.activeSegment.acl.type,e).then(function(){g.segments[g.activeSegment.id].acl.address=e}).then(S).then(b).then(g.setFormPristine).finally(g.ui.unlock)},g.resetSegmentAcl=function(){return o.get(g,"form.reset",angular.noop)()},g.setFormPristine=function(){return o.get(g,"form.$setPristine",angular.noop)()},g.ui={isLocked:!1,lock:function(){return g.ui.isLocked=!0,e.when(!0)},unlock:function(){return g.ui.isLocked=!1,e.when(!1)}},g.canSwitchTab=function(){return!g.ui.isLocked&&(!g.activeSegment.includesAccessPoints||!g.form.modified||l.confirmLeave())},g.setActiveTab=function(e,t){y(t.id),g.activeSegment.includesAccessPoints&&b(),g.setFormPristine()};var C=function(e){return"wireless-acl.hosts-table.".concat(e)};g.hostsTable={columns:{name:{title:C("name"),modify:c.escapeHtml},mac:C("mac-address"),isIncluded:{checkbox:{model:!1,disabled:!1,label:C("is-included"),onChange:function(e){e?g.hostsTable.includeAllHosts():g.hostsTable.excludeAllHosts()}},directive:{name:"ndm-checkbox",options:{label:"","ng-attr-disabled":"vm.ui.isLocked || row.isDisabled","on-change":"row.onChange()",name:"device-{{row.mac}}-is-included","ndm-disabled-by-mws-tooltip":"@"}}}},data:[],includeAllHosts:function(){g.hostsTable.data.forEach(function(e){e.isIncluded=!0}),o.set(g,"hostsTable.columns.isIncluded.checkbox.model",!0)},excludeAllHosts:function(){g.hostsTable.data.forEach(function(e){e.isIncluded=!1}),o.set(g,"hostsTable.columns.isIncluded.checkbox.model",!1)}};g.ui.lock().then(S).then(function(){return g.segmentAclEnabled?e.when(!1):m.checkIfAclConfiguredForAccessPoints(p.ALL_ACCESS_POINTS)}).then(function(e){g.showNoticeOnAclTypeChange=e,g.tabs=o.map(g.segments,function(e){return{id:e.id,description:e.description}}),g.progress=100,g.isReady=!0,h()}).finally(g.ui.unlock)}e.$inject=["$q","$timeout","$window","$scope","$rootScope","_","NDM","CONSTANT","modal","utils","interfaces","wifiOptions","portForwarding","wirelessAcl","localStorage"],angular.module("keenetic").controller("WirelessAclController",e)}(),function(){function e(e,t,n,i,a,o,s,r){var l=s.ROUTE_TYPE,c=[l.TO_HOST,l.TO_NETWORK,l.DEFAULT_ROUTE],d={ALWAYS_VALID_NET_OBJ:{ip:r.ZERO_IP_ADDRESS,mask:r.ZERO_IP_ADDRESS},ANY_INTERFACE_OPTION:{id:"",label:"staticRoutes.any-interface",name:"staticRoutes.any-interface"}},p=null,u=[],m=!1,f=function(e){p=angular.copy(e)},g=function(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&p){var e=a.defer();return e.resolve(p),e.promise}if(p=null,m){var t=a.defer();return u.push(t),t.promise}return m=!0,n.get("show/interface").then(function(e){return f(e),u.forEach(function(e){e.resolve(p)}),u=[],p}).finally(function(){m=!1})};return{ROUTES_CONST:d,clearShowInterfaceDataCache:function(){p=null},setShowInterfaceDataCache:f,getNetmaskSelectOptions:function(){return e.idsToOptions(t.getMasksArray(),o.identity)},getRouteTypeSelectOptions:function(){return e.idsToOptions(c,function(e){return"staticRoutes.route-properties.type-values.".concat(e)})},getInterfaceSelectOptions:function(){return g().then(function(e){var t=i.getInterfaceOptions(e).filter(function(e){return!angular.isUndefined(e.global)});return[d.ANY_INTERFACE_OPTION].concat(_toConsumableArray(t))})},getShowInterfaceData:g}}e.$inject=["utils","ipV4Service","router","interfaces","$q","_","routesService","CONSTANT"],angular.module("keenetic").factory("staticRoutesHelperService",e)}(),function(){function e(e,t,n,i,a,o,s,r,l,c,d,p,u){var m=this,f=o.DEFAULT_NETMASK,g=p.ROUTES_CONST,v=d.DEFAULT_ROUTE,h=d.ROUTE_TYPE;m.ROUTE_TYPE=h,m.ipv6Installed=Boolean(c.ip6),m.defaultRouteExists=!1,m.progress=0,m.l10n={};var b,_,y=function(){m.l10n={anyInterface:s.getTranslation("staticRoutes.any-interface"),yes:s.getTranslation("yes"),no:s.getTranslation("no"),defaultRoute:s.getTranslation("staticRoutes.route-properties.default"),uploadBtnTitle:s.getTranslation("staticRoutes.uploader-subform.upload-file-input"),uploadBtnTitleFileSelected:s.getTranslation("staticRoutes.uploader-subform.upload-file-selected")}};y(),n.$on("$destroy",i.$on("$translateChangeSuccess",function(){return e(y)})),n.$on("$destroy",p.clearShowInterfaceDataCache),b=function(e){return"staticRoutes.route-properties.".concat(e)},m.routesTable={routesLoaded:!1,routeCount:0,routeCountDiff:0,data:[],columns:{destination:{title:b("destination"),modify:function(e){return e===v?m.l10n.defaultRoute:e}},gateway:b("gateway"),interfaceForTable:{title:b("interface"),modify:s.escapeHtml},auto:{title:b("auto"),modify:function(e){return e?m.l10n.yes:m.l10n.no}},comment:{title:b("description"),modify:s.escapeHtml}},sortBy:"destination",sortReverse:!0,init:function(){m.routesTable.loadRoutes()},flushRoutes:function(){l.confirm("staticRoutes.delete-confirm").then(function(){d.$q.flushRoutes(m.routesTable.data).then(m.routesTable.loadRoutes)})},loadRoutes:function(){return m.defaultRouteExists=!1,m.routesTable.routesLoaded=!1,m.routesTable.data=[],t.all([d.$q.getRoutesList(),p.getInterfaceSelectOptions()]).then(function(e){var t=_slicedToArray(e,2),n=t[0],i=t[1];n=n.map(function(e){var t=a.get(e,"interface",""),n=!!t&&a.find(i,function(e){var n=e.id,i=e.name;return n===t||i===t}),o=a.get(n,"label",m.l10n.anyInterface);return Object.assign({},e,{interfaceForTable:o})}),m.defaultRouteExists=n.some(function(e){return e.default}),m.routesTable.data=n.slice(),m.routesTable.routesLoaded=!0;var o=n.length;m.routesTable.routeCountDiff=o-m.routesTable.routeCount,m.routesTable.routeCount=o,m.progress<100&&(m.progress+=60)})}},m.routesTable.init(),(_=a.reduce(u.ROUTE_TABLE_PROPS,function(e,t){return Object.assign({},e,_defineProperty({},t,"staticRoutes.routes-table.columns.".concat(t)))},{})).interface={title:_.interface,modify:s.escapeHtml},m.currentRoutesTable={data:[],dataIpv6:[],columns:_,reloadTimeoutId:null,reload:function(){return u.getData().then(function(t){m.currentRoutesTable.data=t.rows,m.currentRoutesTable.dataIpv6=t.rowsIpv6,m.currentRoutesTable.reloadTimeoutId=e(m.currentRoutesTable.reload,3e3)})},init:function(){m.currentRoutesTable.reload().then(function(){m.progress+=25})}},n.$on("$destroy",function(){u.destroy(),e.cancel(m.currentRoutesTable.reloadTimeoutId)}),u.init().then(m.currentRoutesTable.init),function(){m.editor={opened:!1,interfacesLoaded:!1,interfaces:null,interfaceNets:[],interfaceNetsLastCalc:[],interfaceLastSelected:!1,interfaceOptions:[],routeTypeOptions:p.getRouteTypeSelectOptions(),netmaskOptions:p.getNetmaskSelectOptions(),isNewRoute:!1,routeData:{},routeDataNotEdited:{},editStaticRouteForm:null,doneValidation:!0,alwaysValidNetsObject:[g.ALWAYS_VALID_NET_OBJ],ready:function(){return m.editor.interfacesLoaded},show:function(){m.editor.opened=!0},hide:function(){m.editor.opened=!1},resetState:function(){m.editor.isNewRoute=!1,m.editor.routeData={},m.editor.routeDataNotEdited={},m.editor.interfaceNetsLastCalc=[],m.editor.interfacesLoaded=!1,m.editor.interfaceLastSelected=!1},isAnyInterface:function(e){return angular.isUndefined(e.interface)||e.interface===g.ANY_INTERFACE_OPTION.id},prepareEditorForm:function(e){var t=m.editor.isAnyInterface(e)?null:e.interface;return p.getShowInterfaceData().then(function(n){return m.editor.interfaces=n,m.editor.interfaceNetsLastCalc=m.editor.recalcInterfaceNets(t),m.editor.interfaceNets=e.auto?m.editor.alwaysValidNetsObject.slice():m.editor.interfaceNetsLastCalc.slice(),m.editor.interfaceLastSelected=t,p.getInterfaceSelectOptions().then(function(e){return m.editor.interfaceOptions=e,m.editor.interfacesLoaded=!0,!0})})},cancelEditRoute:function(){m.editor.hide(),m.editor.resetState()},finishEditing:function(){m.editor.cancelEditRoute(),m.routesTable.loadRoutes()},saveRoute:function(){return(m.editor.isNewRoute?d.$q.saveRoute(m.editor.routeData):d.$q.replaceRoute(m.editor.routeDataNotEdited,m.editor.routeData)).then(m.editor.finishEditing)},deleteRoute:function(){return d.$q.deleteRoute(m.editor.routeDataNotEdited).then(m.editor.finishEditing)},editRoute:function(e){m.editor.isNewRoute||(m.editor.routeDataNotEdited=angular.copy(e));var t={type:m.editor.routeTypeOptions[0].id,interface:g.ANY_INTERFACE_OPTION.id,mask:f,auto:!1};e=angular.extend(t,e),m.editor.routeData=e,m.editor.prepareEditorForm(e).then(function(){var t=e.interface;if(t!==g.ANY_INTERFACE_OPTION.id){var n=a.find(m.editor.interfaces,function(e){return e.id===t||e["interface-name"]===t});n&&(m.editor.routeData.interface=n.id)}}).then(m.editor.show)},editNewRoute:function(){m.editor.isNewRoute=!0,m.editor.editRoute({network:"",mask:f,host:"",gateway:"",type:h.TO_HOST})},recalcInterfaceNets:function(e){var t=angular.copy(m.editor.interfaces),n=[];return Boolean(e)&&e!==g.ANY_INTERFACE_OPTION.id&&((t={})[e]=a.find(m.editor.interfaces,function(t){return t.id===e||t["interface-name"]===e})),Object.keys(t).forEach(function(e){var i,a=t[e];(i=a).address&&i.mask&&i.address!==o.ZERO_IP_ADDRESS&&i.mask!==o.ZERO_IP_ADDRESS&&n.push({ip:a.address,mask:a.mask})}),n.slice()}};m.checkGateway=function(){m.editor.editStaticRouteForm&&(m.editor.doneValidation=!1,e(function(){m.editor.routeData.type===v&&(m.editor.routeData.auto=!1);var e=m.editor.routeData.interface;e!==m.editor.interfaceLastSelected&&(m.editor.interfaceNetsLastCalc=m.editor.recalcInterfaceNets(e),m.editor.interfaceLastSelected=e),m.editor.interfaceNets=m.editor.routeData.auto?m.editor.alwaysValidNetsObject.slice():m.editor.interfaceNetsLastCalc.slice(),m.editor.editStaticRouteForm.gateway.revalidate&&m.editor.editStaticRouteForm.gateway.revalidate(),m.editor.doneValidation=!0},0))},m.gatewayOrInterfaceAndAutoRequired=function(e){if(m.editor.editStaticRouteForm){var t=function(e){if(m.editor.editStaticRouteForm[e])return m.editor.editStaticRouteForm[e].$viewValue}("route-interface"),n=g.ANY_INTERFACE_OPTION.id;return!e&&n===t?{message:s.getTranslation("staticRoutes.errors.gateway-required")}:void 0}}}(),m.uploader={interface:!1,interfaceOptions:[],routesFile:{file:!1},interfacesLoaded:!1,uploaderForm:null,onFileChangeListener:null,visible:!1,toggle:function(){m.uploader.visible=!m.uploader.visible},ready:function(){return m.uploader.interfacesLoaded},init:function(){return p.getInterfaceSelectOptions().then(function(e){e=e.filter(function(e){return!angular.equals(e,g.ANY_INTERFACE_OPTION)}),m.uploader.interfaceOptions=e,m.uploader.interface=e.length&&e[0].id,m.uploader.interfacesLoaded=!0,m.progress+=40})},uploadRoutes:function(){return d.$q.uploadRoutesFile(m.uploader.interface,m.uploader.routesFile.file).then(function(){m.routesTable.loadRoutes().then(function(){var t=[s.getTranslation("staticRoutes.notifications.upload-success"),m.routesTable.routeCountDiff].join(" ");e(function(){r.success(t,1500)})})},function(){r.warning("staticRoutes.notifications.upload-error",3e3)})}},m.uploader.init()}e.$inject=["$timeout","$q","$scope","$rootScope","_","CONSTANT","utils","notification","modal","components","routesService","staticRoutesHelperService","currentStaticRoutes"],angular.module("keenetic").controller("StaticRoutesController",e)}(),function(){function e(e,t,n,i,a){var o={DEFAULT_ROUTE:"default",TO_NETWORK:"network",TO_HOST:"host"},s=function(e){var t=["auto","gateway","interface","comment"].filter(function(t){return e[t]}).reduce(function(t,n){return Object.assign({},t,_defineProperty({},n,e[n]))},{});switch(e.type){case o.DEFAULT_ROUTE:t.default="",delete t.auto;break;case o.TO_NETWORK:t.network=e.network,t.mask=e.mask;break;case o.TO_HOST:t.host=e.host}return t},r=function(t){return e.set({},"ip.route",t)},l=e.flowRight(r,s),c=e.flowRight(r,function(e){return Object.assign({},e,{no:!0,name:e.interface||""})},s),d=function(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return t.postAndSave(n)},p=e.flowRight(d,l),u=e.flowRight(d,c);return{ROUTE_TYPE:o,DEFAULT_ROUTE:"default",$q:{getRoutesList:function(){return t.get("ip/route").then(function(t){return(t=e.isArray(t)?t:[]).map(function(e){return e.destination||(e.default?(e.destination="default",e.type=o.DEFAULT_ROUTE):e.network&&e.mask?(e.destination="".concat(e.network,"/").concat(i.maskToCidr(e.mask)),e.type=o.TO_NETWORK):e.host&&(e.destination=e.host,e.type=o.TO_HOST)),angular.isUndefined(e.auto)&&(e.auto=!1),e})})},saveRoute:p,deleteRoute:u,replaceRoute:function(e,t){return d(c(e),l(t))},flushRoutes:function(e){return t.postAndSave(e.map(c))},uploadRoutesFile:function(e,n){var i=a.defer();return t.getUploadPort("ip/route/import",{interface:e,save:""}).then(function(e){return t.uploadFile(e,n)},i.reject).then(i.resolve,i.reject),i.promise}}}}e.$inject=["_","router","utils","ipV4Service","$q"],angular.module("keenetic").factory("routesService",e)}(),function(){function e(e,t,n,i,a,o,s,r){var l=s.IFACE_TYPE,c=o.AP_IFACE_PREFIX,d=Boolean(n.ip6),p=["destination","gateway","interface"],u=null,m={},f={},g=function(e){var t=e.global;return angular.isDefined(t)},v=function(e){return e.type===l},h=function(t){var n=a.getInterfaceOptions(t),i=[].concat(_toConsumableArray(n.filter(g).filter(function(e){return!(e.type===c)||(t=e.id,Number(t.split(c)[1])<=1);var t})),_toConsumableArray(n.filter(v)));f=e.reduce(i,function(e,t){var n;return Object.assign({},e,(_defineProperty(n={},t.id,t.label),_defineProperty(n,t.name,t.label),n))},{}),m=angular.copy(f)},b=function(t){return e.isArray(t)?t:[]},_=function(e){var t,n=p.reduce(function(t,n){return Object.assign({},t,_defineProperty({},n,e[n]))},{});return n.interface=(t=n.interface,m[t]||t),n};return{ROUTE_TABLE_PROPS:p,init:function(){return r.getShowInterfaceData().then(function(e){h(e),u=i.poll("show/interface",10,function(e){r.setShowInterfaceDataCache(e),h(e)})})},destroy:function(){u&&u.cancel()},getData:function(){var t=i.arrayToQueryData(["show.ip.route",d?"show.ipv6.routes":""]);return i.postToRciRoot(t).then(function(t){var n=e.get(t,"show.ip.route",[]),i=e.get(t,"show.ipv6.routes.route_",[]);return{rows:b(n).map(_),rowsIpv6:b(i).map(_)}})}}}e.$inject=["_","utils","components","router","interfaces","wifiOptions","Ipv6To4Service","staticRoutesHelperService"],angular.module("keenetic").factory("currentStaticRoutes",e)}(),function(){function e(e,t){var n=this;n.progress=0,n.tabs=[],n.tabContentsChanged={},e.cloudcontrol&&(n.keendns=!0,n.tabs.push({id:"keendns",name:"KeenDNS"})),e.ddns&&(n.ddns=!0,n.tabs.push({id:"ddns",name:"DDNS"})),n.canChangeTab=function(){return!n.tabContentsChanged[n.activeTab]||n.tabContentsChanged[n.activeTab]()},n.callOnTabChange={},n.onSelectTab=function(e){n.activeTabId=e,n.activeTab=n.tabs[e].id,(n.callOnTabChange[n.activeTab]||angular.noop)(),t(function(){n.progress=100},500)}}e.$inject=["components","$timeout"],angular.module("keenetic").controller("RemoteAccessController",e)}(),function(){function e(e,t,n,i,a,o){var s={no:!0},r=["all",o.PROTOCOL.ICMP],l=function(e){return angular.isDefined(e.global)&&("AccessPoint"!==e.type||e.index<=1)},c=function(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=e.set({},"ip.static",t),a=[];return t.schedule=t.schedule||s,n?(i.ip.static.no=!0,delete t.schedule,delete t.index,delete t.disable):(a.push(e.set({},"ip.static",{index:t.index,schedule:t.schedule})),a.push(e.set({},"ip.static",{index:t.index,disable:t.disable})),delete i.ip.static.schedule,delete i.ip.static.disable),a.unshift(i),a},d=function(t){return i.postAndSave(e.set({},"ip.static",t))};return{isValidSourceIface:l,getSourceInterfaces:function(){return i.get("show/interface").then(function(t){var n=angular.copy(t),i={},a=0,o=!1,s={},r=[],c={};return e.forEach(t,function(e,t){var n=e.id;e.id=t,l(e)&&(i[t]=e,r.push(n),e.priority&&e.priority>a&&(a=e.priority,o=n),n&&n!==t&&(s[n]=e)),"public"===e["security-level"]&&(c[n]=e,t!==n&&(c[t]=e))}),{ifaces:i,aliases:s,showInterfaceData:n,ifaceIds:r,allPublicIfaces:c,maxPriorityIfaceId:o}})},getData:function(){var a=t.toRciQueryList(["show.rc.ip.static",e.set({},"show.ip.hotspot",{details:o.HOTSPOT_DETAILS.NONE}),n.miniupnpd?"show.upnp.redirect":{}]);return i.postToRciRoot(a).then(function(t){var n=e.get(t,"[0].".concat("show.rc.ip.static"),[]),i=e.isArray(n)?n:[],a=e.get(t,"[1].".concat("show.ip.hotspot.host"),[]),o=e.get(t,"[2].".concat("show.upnp.redirect.entry"),[]);return{ipStatic:i,hosts:a.map(function(e){var t=e.ip,n=e.mac,i=e.name,a=e.hostname,o=e.registered;return{id:n,label:i||a||n,hostname:a,mac:n,ip:t,isRegistered:Boolean(o)}}),upnp:o}})},saveItem:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=c(e,t);return i.postAndSave(n)},saveItemFromDevicesList:function(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=c(t,n).filter(function(t){return!e.has(t,"".concat("ip.static",".disable"))});return i.postAndSave(a)},deleteItem:function(e){return d({index:e,no:!0})},registerHost:function(t,n){return i.postAndSave(e.set({},"known.host",{mac:t,name:n}))},unregisterHost:function(t){return i.postAndSave(e.set({},"known.host",{mac:t,no:!0}))},saveOrder:function(e,t){return d({rule:_defineProperty({index:e},"new-index",t.toString())})},toggleItem:function(e,t){return d({index:e,disable:!t})},flush:function(){return d(s)},getProtocolOptions:function(){var n=e.chain(o.deviceProtocol).map(function(e){var n,i,a,s=e.name;return s===o.PROTOCOL.TCP_UDP?{id:o.PROTOCOL.TCP_UDP,label:o.TCP_UDP_LABEL}:{id:s,label:"".concat(s.toUpperCase()).concat(e.description?" - "+(n=s,i=t.getTranslation("devices-list.ports.protocols.".concat(n)),a=i.split("."),a[a.length-1]===n?n.toUpperCase():i):"")}}).filter(function(t){return!e.includes(o.PROTOCOLS_WITHOUT_PORTS,t.id)}).value(),i=e.findIndex(n,{id:o.PROTOCOL.TCP_UDP})+1,a=[{id:o.PROTOCOL.ICMP,label:o.PROTOCOL.ICMP.toUpperCase()},{id:"all",label:t.getTranslation("portforwarding.all-protocols")}];return[].concat(_toConsumableArray(e.slice(n,0,i)),a,_toConsumableArray(e.slice(n,i)))},OTHER_DEVICE_OPTION:"_BY_IP_",OTHER_SUBNET_INPUT:"_OTHER_SUBNET_INPUT_",ALL_PORTS_PROTOCOL_ID:"all",PROTOCOLS_WITHOUT_TO_PORT:r,IP_STATIC_NDM_CODES:{RULE_ALREADY_EXISTS:"101187586",RULE_ALTERS_EXISTING:"101187591"}}}e.$inject=["_","utils","components","router","ipV4Service","CONSTANT"],angular.module("keenetic").factory("portForwarding",e)}(),function(){function e(e,t,n,i,a,o,s,r,l,c,d,p,u,m){var f=this,g={SINGLE_RULE:237,MULTIPLE_RULES:272},v=m.OTHER_DEVICE_OPTION,h=m.OTHER_SUBNET_INPUT,b=m.ALL_PORTS_PROTOCOL_ID,_=m.PROTOCOLS_WITHOUT_TO_PORT,y=m.IP_STATIC_NDM_CODES,S={ifaces:{},ifaceOptions:[],aliases:{},allPublicIfaces:{},showInterfaceData:{},ifaceIds:[],hosts:[],items:[],isFilled:!1};f.ALL_PORTS_PROTOCOL_ID=b,f.TCP_PROTOCOL=l.PROTOCOL.TCP,f.UDP_PROTOCOL=l.PROTOCOL.UDP,f.TCP_UDP_OPTION_ID=l.PROTOCOL.TCP_UDP,f.ICMP_PROTOCOL=l.PROTOCOL.ICMP,f.upnpAvailable=Boolean(r.miniupnpd),f.progress=40;var w=function(){f.progress+=30};f.isHostNameUnique=function(e){return S.hosts.filter(function(e){return e.isRegistered}).map(function(e){return e.label}).includes(e)?{message:"errors.name-exists"}:null};var C={interval:2e3,enabled:void 0,$timer:void 0,start:function(){return angular.isUndefined(C.enabled)&&t.$on("$destroy",C.stop),C.enabled=!0,C.loop()},stop:function(){e.cancel(C.$timer),C.enabled=!1},loop:function(){if(e.cancel(C.$timer),C.enabled)return T().then(C.timeout)},timeout:function(t){return e.cancel(C.$timer),C.enabled&&(C.$timer=e(C.loop,C.interval)),t}},E=function(e,t){if(e===l.LOCALHOST_IP)return c.getTranslation("this-device");var n,i,o=a.has(t,"raw.to-host"),s=a.has(t,"raw.to-address");return o||s?o?a.get(e,"address","")===l.ZERO_IP_ADDRESS?e.name:"".concat(c.escapeHtml(e.name),'<div class="help-text">').concat(e.address,"</div>"):e.name?"".concat(e.address,'<div class="help-text">').concat(c.escapeHtml(e.name),"</div>"):e:c.escapeHtml((n=e,(i=a.find(S.ifaceOptions,{id:n})||a.find(S.ifaceOptions,{id:(S.aliases[n]||{}).id}))?i.label:n))};e(function(){m.getSourceInterfaces().then(function(e){S.ifaces=e.ifaces,S.aliases=e.aliases,S.allPublicIfaces=e.allPublicIfaces,S.defaultIfaceId=e.maxPriorityIfaceId,S.ifaceIds=e.ifaceIds,S.showInterfaceData=e.showInterfaceData,S.isFilled=!0,P()}).then(w).then(C.start).then(w)});var I=function(e){return{connection:{title:"portforwarding.list-columns.source",width:214,modify:c.escapeHtml},to:{title:"portforwarding.list-columns.to-address",width:Number(e),modify:E},ports:{title:"portforwarding.list-columns.ports",width:133},description:{title:"portforwarding.list-columns.comment"}}};function T(){return m.getData().then(function(e){var t=e.hosts;S.hosts=t,f.anyHosts=t.length>0,f.schedulesData=e.schedulesData,f.list.dragging||f.editor.visible||(f.list.items=e.ipStatic.map(k)),f.list.loading=!1;var n=g[f.list.items.length<2?"SINGLE_RULE":"MULTIPLE_RULES"];n!==f.upnpTable.firstColumnWidth&&(f.upnpTable.firstColumnWidth=n,f.upnpTable.columns=I(n)),f.upnpTable.items=e.upnp.map(k)})}function k(e){var t={raw:e,comment:e.comment,description:e.description,protocol:"",connection:e.interface?function(e){var t=S.ifaceOptions,n=S.aliases,i=a.findIndex(t,{id:e});-1===i&&n[e]&&(i=a.findIndex(t,{id:n[e].id}));-1===i&&S.allPublicIfaces&&(i=a.findIndex(t,{id:[e].id}));return-1===i?e:t[i].label}(e.interface):e.address+"/"+d.maskToCidr(e.mask),ports:"*",to:e["to-host"]||e["to-address"]||e["to-interface"],index:e.index,enabled:!e.disable,schedule:e.schedule};if(e.protocol){var n=e.protocol===l.PROTOCOL.TCP_UDP;t.ports=n?l.TCP_UDP_LABEL+" ":e.protocol.toUpperCase(),e["end-port"]?t.ports+=(n?"":"/")+e.port+" - "+e["end-port"]:e.port&&(t.ports+=(n?"":"/")+e.port,e["to-port"]&&(t.ports+=" → "+e["to-port"]))}else t.ports=c.getTranslation("portforwarding.all-protocols-short");return S.hosts.forEach(function(e){e.ip!==t.to&&e.mac!==t.to||(e.mac===t.to&&e.ip&&(t.to=e.ip),e.label&&(t.to={address:t.to,name:e.label}))}),t.onToggle=function(e){return t.raw.disable=!e,m.toggleItem(t.index,e).then(T)},t.stringRepresentation=t.description||"".concat(t.connection," -> ").concat(E(t.to,t)," (").concat(t.ports,")"),t}f.list={items:[],sortableOptions:{},loading:!1,dragging:!1},f.list.columns={enabled:{title:"portforwarding.list-columns.enabled",width:70,directive:{name:"ndm-toggle",options:{"label-on":"","label-off":"","ng-attr-call-on-change":"row.onToggle",name:"rule-{{row.index}}-"}}},connection:{title:"portforwarding.list-columns.source",width:180,modify:c.escapeHtml},to:{title:"portforwarding.list-columns.to-address",width:180,modify:E},ports:{title:"portforwarding.list-columns.ports",width:140},comment:{title:"portforwarding.list-columns.comment",modify:c.escapeHtml},editHint:{title:" ",width:20,directive:"ndm-icon",modify:function(){return"pencil"}}},f.list.dragEnd=function(e){if(f.list.dragging=!1,e.source.index!==e.dest.index)return m.saveOrder(f.list.items[e.dest.index].index,e.dest.index).then(C.start).then(function(){return s.success("notifications.saved")})},f.list.dragStart=function(){f.list.dragging=!0},f.list.flush=function(){C.stop(),o.confirm("portforwarding.list-flush-confirm").then(function(){f.list.loading=!0,m.flush().then(function(){C.start(),L("flushed")})}).catch(C.start)},f.upnpTable={items:[],sortColumn:"to",sortReverse:!1,columns:I(g.MULTIPLE_RULES),firstColumnWidth:g.MULTIPLE_RULES};var P=function(){S.ifaceOptions=p.getInterfaceOptions(S.showInterfaceData).filter(function(e){return a.includes(S.ifaceIds,e.id)})};var A=function(){S.isFilled&&P()};function D(){f.editor.visible&&f.editor.form&&f.editor.form.port&&f.editor.form.port.$validate()}function O(e){var t=!1;angular.isObject(e)||(t=!0,e={mask:l.DEFAULT_NETMASK});var n={interface:e.interface||S.defaultIfaceId,port:e.port,enabled:!e.disable,address:e.address,mask:e.mask,toPort:e["to-port"],endPort:e["end-port"],comment:e.comment,schedule:e.schedule,protocol:t?"tcp":e.protocol,toHost:e["to-host"],toInterface:e["to-interface"],toIp:e["to-address"]||""};return e["to-address"]?e["to-address"]===l.LOCALHOST_IP?n.toHost=l.LOCALHOST_IP:(n.toHost=v,n.toHostIsToIp=!0):e["to-interface"]&&(n.toHost=e["to-interface"]),e.address&&(n.interface=h,n.inputIsCustomNet=!0),n.portMode=n.endPort?1:0,n.protocolPreset=N.getIDByData(n),n.endPort||n.toPort||(n.toPort=n.port),n}t.$on("$destroy",n.$on("$translateChangeSuccess",function(){return e(A)})),f.editor={form:void 0,isNew:!1,visible:!1,data:{comment:"",address:"",mask:"",toAdress:"",toHost:"",toHostName:"",toIp:"",interface:"",index:0,toPort:0,endPort:0,port:0,protocol:"",protocolPreset:"",schedule:!1,portMode:0},errors:{protocol:void 0},options:{protocols:[],portModes:[],interfaces:[],toAddressInfo:""},showToPortInput:function(e){return!a.includes(_,e)}},t.$watch("vm.editor.data.protocolPreset",function(t,n){f.editor.visible&&t!==n&&e(function(){N.setDataByID(f.editor.data.protocolPreset,f.editor.data)})}),f.editor.onHostPresetsChange=function(t){if(t)if(t===v)f.editor.data.toHostIsToIp=!0,f.editor.data.toHostIsUnregistered=!1;else if(t===l.LOCALHOST_IP)f.editor.data.toHostIsToIp=!1,f.editor.data.toHostIsUnregistered=!1;else{f.editor.data.toHostIsToIp=!1;var n=a.find(S.hosts,{id:t});if(n){var i=t!==l.LOCALHOST_IP&&!n.isRegistered&&t!==v;f.editor.data.toHostIsUnregistered=i,i&&(f.editor.data.toHostName=n.hostname)}else f.editor.data.toHostIsUnregistered=!1}f.editor.visible&&e(function(){var e=f.editor.data.toHost;S.hosts.forEach(function(t){t.ip!==e&&t.mac!==e||t.mac!==e||!t.ip||(e=t.ip)}),f.editor.options.toAddressInfo=e})},f.editor.onInputChange=function(e){f.editor.data.inputIsCustomNet=e===h},f.editor.getDeviceGroup=function(e){return e.isInterface?"interface":e.id===l.LOCALHOST_IP?"this-keenetic":e.isRegistered?"registered":"unregistered"},f.editor.edit=function(e,t){f.editor.options={};var n=f.editor.options;angular.isObject(e)&&angular.isObject(e.raw)?(f.editor.isNew=!1,f.editor.index=t,f.editor.data=O(angular.copy(e.raw))):(f.editor.isNew=!0,f.editor.index=!1,f.editor.data=O(!0)),n.portModes=[{id:0,name:c.getTranslation("portforwarding.editor.port-mode-single")},{id:1,name:c.getTranslation("portforwarding.editor.port-mode-range")}],n.masks=c.idsToOptions(d.getMasksArray(),angular.identity),n.hosts=[{id:l.LOCALHOST_IP,label:c.getTranslation("this-device"),isRegistered:!0}],n.hosts=n.hosts.concat(angular.copy(S.hosts)),n.hosts.push({id:v,label:c.getTranslation("portforwarding.editor.other-device"),isRegistered:!1}),n.groupLabels=[{id:"this-keenetic",label:""},{id:"registered",label:"devices-list.registered-devices.header"},{id:"unregistered",label:"devices-list.not-registered-devices.header"},{id:"interface",label:"portforwarding.interfaces-group-title"}],n.interfaces=S.ifaceOptions,a.forEach(n.interfaces,function(e){e.id!==h&&n.hosts.push({id:e.id,label:e.label,isInterface:!0})}),f.editor.data.toInterface&&!a.find(n.interfaces,{id:f.editor.data.toHost})&&n.hosts.push({id:f.editor.data.toHost,label:f.editor.data.toHost,isInterface:!0}),f.editor.isNew&&(f.editor.data.interface=S.defaultIfaceId||n.interfaces[0].id),n.interfaces.push({id:h,name:c.getTranslation("portforwarding.editor.other-destination")}),a.find(n.interfaces,{id:f.editor.data.interface})||n.interfaces.push({id:f.editor.data.interface,name:f.editor.data.interface}),n.protocolPresets=m.getProtocolOptions(),C.stop(),f.editor.visible=!0,f.editor.onHostPresetsChange()},t.$watch("vm.editor.data.protocolPreset",D),t.$watch("vm.editor.data.interface",D),f.editor.close=function(){f.editor.visible=!1,f.editor.pending=!1,f.editor.data={},C.start()},f.editor.pending=!1,f.editor.save=function(){if(!f.editor.pending){f.editor.pending=!0;var e=function(e){var t={comment:e.comment||""};t.schedule=e.schedule,t["to-host"]=e.toHost,t["to-address"]=e.toIp,e.toHostIsToIp?delete t["to-host"]:e.toHost===l.LOCALHOST_IP?(t["to-address"]=l.LOCALHOST_IP,delete t["to-host"]):a.find(f.editor.options.interfaces,{id:e.toHost})||e.toHost===f.editor.data.toInterface?(delete t["to-address"],delete t["to-host"],t["to-interface"]=e.toHost):delete t["to-address"];t.disable=!e.enabled,e.protocol&&(t.protocol=e.protocol,e.protocol===l.PROTOCOL.ICMP&&(delete e.port,delete e.toPort,delete e.portMode),e.port&&(t.port=e.port),e.toPort&&e.toPort!==e.port&&!Number(e.portMode)&&(t["to-port"]=e.toPort),Number(e.portMode)&&(t["end-port"]=e.endPort));e.interface===h?(t.address=e.address,t.mask=e.mask):t.interface=e.interface;return t}(f.editor.data),t=f.editor.data.toHostIsUnregistered?m.registerHost(f.editor.data.toHost,f.editor.data.toHostName):i.when(!0);!1!==f.editor.index&&(e.index=f.editor.index),t.then(function(){return m.saveItem(e).then(function(e){var t=u.getNdmStatuses(e),n=!a.some(y,function(e){return a.some(t,function(t){return t.code===e})}),i=a.some(t,function(e){return e.code===y.RULE_ALREADY_EXISTS});if(n)return T().then(function(){f.editor.close(),L(!1===f.editor.index?"added":"saved")});if(f.editor.pending=!1,i)return s.info("portforwarding.notifications.rule-already-exists");var o=_toConsumableArray(a.chain(e.ndmErrors).map().first().get("message","").value().matchAll(/rule "\d+"/g)),r=a.chain(o).get("[1][0]","").split(/"/g).map(Number).get("[1]").value();if(isNaN(r))return s.error("portforwarding.notifications.conflicts-with-existing-rule");var l=f.list.items[r],d={description:a.get(l,"stringRepresentation",""),index:r+1},p=c.getTranslation("portforwarding.notifications.conflicts-with-existing-rule-index",null,d);return s.error(p)})})}},f.editor.delete=function(){o.confirm("portforwarding.editor.delete-confirm").then(function(){m.deleteItem(f.list.items[f.editor.index].index).then(function(){f.editor.close(),L("deleted")})})};var N={getIDByData:function(e){if(e.port&&e.protocol&&!e.endPort&&!Number(e.portMode))for(var t=e.protocol+"/"+Number(e.port),n=0;n<l.deviceProtocol.length;++n)if(l.deviceProtocol[n].name===t)return t;return e.protocol||b},setDataByID:function(e,t){if(f.editor.errors.protocol=void 0,e&&e!==b){var n=e.split("/");n[1]&&(t.portMode=0,Number(t.port)!==Number(t.toPort)&&Number(t.toPort)||(t.toPort=n[1]),t.port=n[1]),t.protocol=n[0]}else t.protocol=!1}};function L(t,n){e(function(){s.success("portforwarding.notifications."+t,n)},100)}}e.$inject=["$timeout","$scope","$rootScope","$q","_","modal","notification","components","CONSTANT","utils","ipV4Service","interfaces","router","portForwarding"],angular.module("keenetic").controller("PortForwardingController",e)}(),function(){function e(e,t,n,i,a,o,s,r,l,c,d){var p=this;function u(){var e=p.form;angular.isObject(e)&&(e.$setPristine(),e.modified=!1,e.modifiedCount=0,e.modifiedModels=[])}p.progress=1,p.lockUiCtrls=!1,p.lockUi=function(){return p.lockUiCtrls=!0,e.when(!0)},p.unlockUi=function(t){return p.lockUiCtrls=!1,t||u(),e.when(!1)},p.updateProgress=function(){p.progress+=25};var m,f,g,v=e.defer();p.resetCtrl=function(){return e.when(!0)},p.resetForm=function(){return d.get(p,"form.reset",angular.noop)()},p.onAllSubcontrollersLoaded=function(){v.resolve()},p.subcontroller=(m=p.onAllSubcontrollersLoaded,f={STATIC_DNS:!0,DNS_OVER_X:Boolean(c["dns-tls"])||Boolean(c["dns-https"]),INTERNET_SAFETY:Boolean(c.ydns)||Boolean(c.skydns)||Boolean(c.safedns)||Boolean(c["adguard-dns"])},(g={_controllers:{},_list:{},_count:{},init:function(){g._list=angular.copy(f),g._count=d.filter(g._list,angular.identity).length},register:function(t,n){g._controllers[n]=t,t.setMainFormPristine=u,t.resetMainForm=p,t.parentController=p,t.lockUi=function(){return p.lockUi()},t.unlockMainUi=function(e){return p.unlockUi(e)},t.isMainCtrlLocked=function(){return p.lockUiCtrls},t.updateProgress=function(){return p.updateProgress()},t.progress=function(){return p.progress},e.when((t.onLoad||angular.noop)()).then(function(){angular.isUndefined(g._list[n])?console.warn('Unknown subcontroller ID "'.concat(n,'"')):(g._list[n]=!1,g._count--,0===d.filter(g._list,angular.identity).length&&(m||angular.noop)())})},get:function(e){return g._controllers[e]},callInEvery:function(t){for(var n=arguments.length,i=new Array(n>1?n-1:0),a=1;a<n;a++)i[a-1]=arguments[a];var o=[];return d.forEach(g._controllers,function(n){angular.isFunction(n[t])&&o.push(e.when(n[t].apply(n[t],i)))}),0===o.length?e.when(!0):e.all(o)}}).init(),g),p.save=function(){return p.lockUi().then(function(){return p.subcontroller.callInEvery("save")}).then(u).then(p.unlockUi)},p.reset=function(){return p.lockUi().then(p.resetForm()).then(function(){return p.subcontroller.callInEvery("reset")}).then(u).finally(p.unlockUi)}}e.$inject=["$q","$scope","$window","$document","$timeout","$rootScope","utils","keyboard","notification","components","_"],angular.module("keenetic").controller("NetFilterController",e)}(),function(){function e(e,t,n,i){var a={},o=i.constants;e.deviceProtocol.forEach(function(e){a[e.name]=e.description||e.name});var s=function(e){return!e||o.singleIpNetmask===e||o.anyNetmask===e},r=function(e){var t={eq:"",gt:">",lt:"<"};return t[e]||t.eq};return{ipOrSubnet:function(e,t){return s(e)?o.anyAddr:s(t)?e:[e,n.maskToCidr(t)].join("/")},addPrefix:r,getProtocolName:function(e){var n,i,o=e["dst-port-operator"]||e[t.dashesToCamelCase("dst-port-operator")],s=e.destination_port||e[t.dashesToCamelCase("destination_port")];return(""===r(o)?(n=e.protocol,(i=s)&&(n=[n,i].join("/")),a[n]||n||e.protocol):e.protocol).toUpperCase()}}}e.$inject=["CONSTANT","utils","ipV4Service","firewallEditorService"],angular.module("keenetic").factory("firewallRulesService",e)}(),function(){function e(e,t,n,i){var a={"address-type":["any","subnet","single"],"port-operator":["any","eq","lt","gt","range"],action:["permit","deny"]},o=function(){var o={};return e.forEach(a,function(e,t){var n=i.dashesToCamelCase(t);o[n]=i.idsToOptions(e,function(e){return"firewall.ENUM."+t+"."+e})}),o.protocol=e.chain(t.deviceProtocol).map(function(e){var n,a,o,s=e.name;return s===t.PROTOCOL.TCP_UDP?{id:t.PROTOCOL.TCP_UDP,label:t.TCP_UDP_LABEL}:{id:s,label:"".concat(s.toUpperCase()).concat(e.description?" - "+(n=s,a=i.getTranslation("devices-list.ports.protocols."+n),o=a.split("."),o[o.length-1]===n?n.toUpperCase():a):"")}}).filter(function(e){return e.id!==t.PROTOCOL.TCP_UDP}).value(),o.netmask=i.idsToOptions(n.getMasksArray(),angular.identity),o};return{defaults:angular.extend(e.mapValues(o(),function(e){return e[0].id}),{netmask:t.DEFAULT_NETMASK}),getOptions:o,enums:a,constants:{protocolsRequiringBothPorts:["tcp","udp"],anyIp:t.ZERO_IP_ADDRESS,anyNetmask:t.ZERO_IP_ADDRESS,anyAddr:"*",singleIpNetmask:o().netmask[0].id}}}e.$inject=["_","CONSTANT","ipV4Service","utils"],angular.module("keenetic").factory("firewallEditorService",e)}(),function(){function e(e,t,n,i,a,o,s){var r=["disable","schedule","description"],l=s.constants,c="_WEBADMIN",d=function(e,n){for(var i=[c,n].join("_"),a=t.get(e,"ip.access-group",[]),o=0,s=a.length;o<s;++o)if("in"===a[o].direction){i=a[o].acl;break}return i},p=function(e){return{"access-list":e}},u=function(e){var n={},o={},s=function(e){o[e]=i.camelCaseToDashes(e)};e.oldAction&&e.action!==e.oldAction&&(n.oldAction=e.oldAction),["source","destination"].forEach(function(t){var i,a;if(e[t+"AddressType"])switch(e[t+"AddressType"]){case"any":i=l.anyIp,a=l.anyNetmask;break;case"single":i=e[t],a=l.singleIpNetmask;break;case"subnet":i=e[t],a=e[t+"Mask"]}else i=e[t]||l.anyIp,a=e[t+"Mask"]||l.anyNetmask;n[t]=i,n[t+"-mask"]=a});var r={source:"src",destination:"dst"};t.forEach(r,function(t,n){var i=t+"PortOperator";if(!e[i])return s(n+"Port"),s(n+"EndPort"),void s(i);switch(e[i]){case"any":break;case"eq":case"lt":case"gt":s(n+"Port"),s(i);break;case"range":s(n+"Port"),s(n+"EndPort"),s(i)}}),t.forEach(o,function(t,i){e[i]&&(n[t]=e[i])});var c=e.protocol;if(t.includes(c,"/")){var d=c.split("/");n.protocol=d[0],n["dst-port-operator"]="eq",n["destination-port"]=d[1]}else n.protocol=c;return-1!==a.PROTOCOLS_WITHOUT_PORTS.indexOf(n.protocol)&&t.forEach(r,function(e,t){delete n[t+"-port"],delete n[t+"-end-port"],delete n[e+"-port-operator"]}),n.description=e.description||{no:!0},n.action=e.action,n.disable=!e.isEnabled,n.schedule=e.schedule||{no:!0},n.index=e.isNew?e.index:e.hash,n},m=function(e){return r.map(function(t){var n;return _defineProperty(n={},t,e[t]),_defineProperty(n,"index",e.index),n})},f=function(e,n,i){return n.map(function(n,a){var o=u(n);o.index=i+a;var s=[t.omit(o,r)].concat(_toConsumableArray(m(o)));return p(_defineProperty({acl:e},n.action,s))})},g=function(e,n){return n.map(function(n){var i=Object.assign({},u(n),{no:!0});return p(_defineProperty({acl:e},n.action,t.omit(i,r)))})},v=function(e,n){return t.set({},["interface",e,"ip","access-group"],[{acl:n,direction:"in"}])},h=function(e,t,n){return t===n?{}:p({acl:e,rule:{index:t,"new-index":n}})},b=function(e,n){e.sourceAddress=o.ipOrSubnet(e.source,e["source-mask"]),e.destinationAddress=o.ipOrSubnet(e.destination,e["destination-mask"]),e.sourceAddress===l.anyAddr&&(e.source="",e["source-mask"]=l.singleIpNetmask),e.destinationAddress===l.anyAddr&&(e.destination="",e["destination-mask"]=l.singleIpNetmask);var a="range"===e["src-port-operator"],s="range"===e["dst-port-operator"];return e.sourcePorts=a?[e["source-port"],e["source-end-port"]].join("-"):[o.addPrefix(e["src-port-operator"]),e["source-port"]].join(""),e.destinationPorts=s?[e["destination-port"],e["destination-end-port"]].join("-"):[o.addPrefix(e["dst-port-operator"]),e["destination-port"]].join(""),e.protocolName=o.getProtocolName(e),e.selected=!1,e.isEnabled=!e.disable,e.hash=e.index,e.oldOrder=n,e.oldAction=e.action,t.forEach(e,function(t,n){-1!==n.indexOf("-")&&(e[i.dashesToCamelCase(n)]=t,delete e[n])}),e};return{saveRule:function(e,i,a,o){return i.isNew?function(e,i,a,o){var s=i.index,l=u(i);l.index=a;var c=[t.omit(l,r)].concat(_toConsumableArray(m(l))),d=[p(_defineProperty({acl:e},i.action,c)),h(e,a,s),v(o,e)];return n.postAndSave(d)}(e,i,a,o):function(e,i,a,o){var s=i.oldOrder,l=i.oldAction,c=i.index,d=u(i),m=d.disable,f=d.schedule,g=d.description,b=d.index,_=[p(_defineProperty({acl:e},l,{index:b,disable:m,schedule:f,description:g})),p(_defineProperty({acl:e},i.action,[t.omit(d,r)])),h(e,s,c),v(o,e)];return n.postAndSave(_)}(e,i,0,o)},dropRule:function(e,i){var a=Object.assign({},u(i),{no:!0});return n.postAndSave(p(_defineProperty({acl:e},i.action,t.omit(a,r))))},toggleRule:function(e,t,i){return n.postAndSave(p(_defineProperty({acl:e},t.action,{disable:!i,index:t.hash})))},dropRules:function(e,t){return n.postAndSave(g(e,t))},copyRules:function(e,t,i,a){var o=[].concat(_toConsumableArray(f(e,t,i)),[v(a,e)]);return n.postAndSave(o)},moveRules:function(e,t,i,a,o){var s=[].concat(_toConsumableArray(f(t,i,a)),_toConsumableArray(g(e,i)),[v(o,t)]);return n.postAndSave(s)},dropAcl:function(e){return n.postAndSave(p({acl:e,no:!0}))},changeRulePosition:function(e,t,i){return n.postAndSave(h(e,t,i))},getInterfacesList:function(){return n.cached("show.interface").then(function(e){var n={};return t.forEach(e,function(e,t){e.name=e["interface-name"],angular.isDefined(e.global)&&("AccessPoint"!==e.type||e.index<=1)&&(n[t]=e,n[t].alias=function(e){return"Switch0/VLAN".concat(e.index)}(e))}),{filteredIfacesList:n,showInterface:e}})},getAclRowsList:function(e,i){return function(e,i){return i=i||e,n.post({url:"",data:t.set({},"show.rc",{"access-list":{},interface:{}})}).then(function(n){var a=n.show.rc||{},o=a.interface||{},s=o[e]||t.find(o,function(t){return t.rename===e}),r=d(s,e),l=a["access-list"];angular.isArray(l)||(l=[]);var p={},u={};return t.forEach(o,function(e,t){u[t]=d(e,t)}),l.forEach(function(e){var t=e.acl;p[t]||(p[t]=0),p[t]++}),{aclToIfaceMap:u,aclSizes:p,aclName:r,rulesList:l.filter(function(e){var t=e.acl,n=t.replace(c,"");return(t===r||n===i)&&e.action})}})}(e,i).then(function(e){return e.rulesList=e.rulesList.map(b),e})}}}e.$inject=["$q","_","router","utils","CONSTANT","firewallRulesService","firewallEditorService"],angular.module("keenetic").factory("firewallService",e)}(),function(){function e(e,t,n,i,a,o,s,r,l,c,d,p,u,m){var f=this;f.progress=0,f.interfacesLoaded=!1,f.noSuitableInterfaces=!1,f.moveDestination=null,f.copyDestination=null;var g=function(){f.l10n={anyAddress:r.getTranslation("firewall.ENUM.address-type.any"),anyPort:r.getTranslation("firewall.ENUM.port-operator.any")},f.interfaceIdToLabelMap=c.getInterfaceIdToLabelMap(f.showInterfaceData),f.interfaceTabs=f.interfaceTabs.map(function(e){return Object.assign({},e,{name:f.interfaceIdToLabelMap[e.id]})})};t.$on("destroy",n.$on("$translateChangeSuccess",function(){return i(g)}));var v=function(e,t){l[t||"success"]({message:"firewall.notifications."+e,timeout:1e3})},h=function(e){return function(){return v("success."+e,"success")}},b=function(e){return function(){return v("error."+e,"error")}};f.onInterfaceValueChange=function(e){return f.moveDestination=null,f.copyDestination=null,e=e||f.interface.id,f.interface=o.find(f.interfaces,{name:e}),f.interface||(f.interface=o.find(f.interfaces,{id:e})),f.rulesTable.resetGroupActionToolbar(),f.rulesTable.loadRules(f.interface,f.interface.name)},f.onTabSelect=function(e,t){return f.onInterfaceValueChange(t.id)};var _,y,S,w,C,E;f.init=function(){return f.interfaceTabs=[],m.getInterfacesList().then(function(e){f.interfaces=e.filteredIfacesList,f.showInterfaceData=e.showInterface,f.progress=50;var t=o.map(f.interfaces,"id"),n=o.chain(c.getIfacesTabs(e.showInterface)).sortBy("id").filter(function(e){return t.includes(e.id)}).value();return f.interfaceTabs=function(e,t){var n=(o.find(e,{defaultgw:!0})||{}).id;if(n){var i=o.findIndex(t,{id:n});if(-1!==i){var a=angular.copy(t[i]),s=t.filter(function(e){return e.id!==n});return[a].concat(_toConsumableArray(s))}}return t}(f.interfaces,n),f.interface=o.find(f.interfaces,{id:f.interfaceTabs[0].id}),f.interfacesLoaded=!0,g(),f.onInterfaceValueChange(f.interface.id).then(function(){f.progress=100})})},S={isSelected:{title:!1,width:18,clickable:!0,checkbox:{model:!1,disabled:!1,onChange:function(e){e?f.rulesTable.selectAll():f.rulesTable.deselectAll()}},directive:{name:"ndm-checkbox",options:{label:"",model:"row.isSelected","ng-attr-on-change":"row.onCheckboxToggle(row.isSelected, row)","ng-attr-disabled":"row.isLocked",name:"rule-{{row.index}}-"}}},isEnabled:{width:75,clickable:!0,directive:{name:"ndm-toggle",options:{"label-on":"","label-off":"","ng-attr-call-on-change":"row.onToggle","ng-attr-disabled":"row.isLocked",name:"rule-{{row.index}}-"}}},action:{modify:function(e){return r.getTranslation("firewall.ENUM.action.".concat(e))}},protocolName:{},sourceAddress:{modify:_=function(e){return"*"===e?f.l10n.anyAddress:e}},sourcePorts:{modify:y=function(e,t){return o.includes(p.PROTOCOLS_WITHOUT_PORTS,t.protocol)?"&mdash;":""===e?f.l10n.anyPort:e}},destinationAddress:{modify:_},destinationPorts:{modify:y},description:{modify:r.escapeHtml},editHint:{title:" ",width:20,directive:"ndm-icon",modify:function(){return"pencil"}}},o.forEach(S,function(e,t){e.title=e.title||"firewall.rule-table.columns.".concat(t)}),f.rulesTable={toIface:null,toIfaceOptions:[],data:[],selectedRulesCount:0,hashByIdx:[],columns:S,rulesLoaded:!1,dragStarted:!1,isLocked:!1,resetGroupActionToolbar:function(){var e=f.rulesTable;e.deselectAll(),e.toIface=null,e.toIfaceOptions=f.interfaceTabs.slice().filter(function(e){return e.id!==f.interface.id})},deselectAll:function(){var e=f.rulesTable;e.data.forEach(function(e){e.isSelected=!1}),e.columns.isSelected.checkbox.model=!1,e.selectedRulesCount=0},selectAll:function(){var e=f.rulesTable;e.data.forEach(function(e){e.isSelected=!0}),e.columns.isSelected.checkbox.model=!0,e.selectedRulesCount=e.data.length},init:function(){i(function(){f.rulesTable.loadRules(f.interface,f.interface.id)})},lock:function(){f.rulesTable.data.forEach(function(e){e.isLocked=!0}),f.rulesTable.isLocked=!0},unlock:function(){f.rulesTable.data.forEach(function(e){e.isLocked=!1}),f.rulesTable.isLocked=!1},_updateRuleHashList:function(){f.rulesTable.hashByIdx=f.rulesTable.data.map(function(e){return e.hash})},_updateOrderData:function(){f.rulesTable.data.forEach(function(e,t){e.oldOrder=t})},loadRules:function(e,t){var n=f.rulesTable,i={};return n.data.forEach(function(e){e.isSelected&&(i[e.hash]=!0)}),n.rulesLoaded=!1,n.lock(),m.getAclRowsList(t,e.alias||t).then(function(e){f.aclSizes=e.aclSizes,f.aclToIfaceMap=e.aclToIfaceMap,n.data=e.rulesList.map(function(e){return e.onToggle=function(t){return e.isEnabled=t,f.rulesTable.lock(),m.toggleRule(f.aclName,e,t).then(angular.noop,b("rule-disable-toggled")).finally(f.rulesTable.unlock)},e.isSelected=Boolean(i[e.hash]),e.onCheckboxToggle=function(e){n.selectedRulesCount+=e?-1:1,n.columns.isSelected.checkbox.model=n.selectedRulesCount===n.data.length},e}),n._updateRuleHashList(),n.rulesLoaded=!0,f.aclName=e.aclName}).finally(n.unlock)},onDragEnd:function(e){var t=f.rulesTable;if(t.dragStarted=!1,e.source.index!==e.dest.index){var n=t.hashByIdx;return t.lock(),m.changeRulePosition(f.aclName,n[e.source.index],n[e.dest.index]).then(function(){h("resort")(),t._updateRuleHashList(),t._updateOrderData()},b("resort")).finally(t.unlock)}},onDragStart:function(){f.rulesTable.dragStarted=!0},onCellClick:function(e,t,n,i){e.stopPropagation(),"isEnabled"===n?i.onToggle(!t):(i.onCheckboxToggle(t,i),i[n]=!t)},getIfaceLabel:function(e){return(o.find(f.rulesTable.toIfaceOptions,{id:e})||{}).label||e}},f.rulesTable.flushRules=function(){return s.confirm("firewall.confirmations.flush").then(function(){return f.rulesTable.lock(),m.dropAcl(f.aclName).then(h("flush"),b("flush")).finally(f.onInterfaceValueChange)})},f.rulesTable.copySelectedRules=function(e){var t=f.rulesTable.getIfaceLabel(e);return s.confirm(r.getTranslation("firewall.confirmations.copy",null,{interface:t})).then(function(){var t=f.aclToIfaceMap[e];return m.copyRules(t,f.rulesTable.data.filter(function(e){return e.isSelected}),f.aclSizes[t]||0,e).then(h("copy"),b("copy")).finally(f.onInterfaceValueChange)})},f.rulesTable.moveSelectedRules=function(e){var t=f.rulesTable.getIfaceLabel(e);return s.confirm(r.getTranslation("firewall.confirmations.move",null,{interface:t})).then(function(){var t=f.aclToIfaceMap[e];return m.moveRules(f.aclName,t,f.rulesTable.data.filter(function(e){return e.isSelected}),f.aclSizes[t]||0,e).then(h("move"),b("move")).finally(f.onInterfaceValueChange)})},f.rulesTable.deleteSelectedRules=function(){return s.confirm("firewall.confirmations.drop-multiple").then(function(){return m.dropRules(f.aclName,f.rulesTable.data.filter(function(e){return e.isSelected})).then(h("drop-multiple"),b("drop-multiple")).finally(f.onInterfaceValueChange)})},w=u,C=r.translatePrefixCtor("firewall.range"),E=w.defaults,f.ruleEditor={isOpened:!1,formCtrl:null,ruleData:{},ruleDataNotEdited:{},rulePositions:[],defaultRuleData:{action:E.action,protocol:E.protocol,enable:!0,schedule:!1,sourceAddressType:E.addressType,sourceMask:E.netmask,srcPortOperator:E.portOperator,destinationAddressType:E.addressType,destinationMask:E.netmask,dstPortOperator:E.portOperator},constants:angular.copy(w.constants),options:w.getOptions(),show:function(){f.ruleEditor.isOpened=!0},close:function(){var t=e.defer();return f.ruleEditor.isOpened=!1,f.ruleEditor.resetState(),i(t.resolve),t.promise},resetState:function(){f.ruleEditor.ruleData={},f.ruleEditor.ruleDataNotEdited={},f.ruleEditor.rulePositions=[]},sourcePortRequired:!0,destinationPortRequired:!0,_checkPorts:function(e){var t=p.PROTOCOLS_WITHOUT_PORTS,n=w.constants.protocolsRequiringBothPorts,i=t.concat(n),a=-1!==t.indexOf(e),o=-1===i.indexOf(e);f.ruleEditor.sourcePortRequired=!a,f.ruleEditor.destinationPortRequired=!o&&!a},_getPositionOptions:function(e,t){for(var n=" "+C("current"),i=[{id:0,label:C("start")+(0===t?n:"")}],a=1;a<e;a++){var o="".concat(C("position")," ").concat(a+1);a===t&&(o+=n),i.push({id:a,label:o})}return i.push({id:e-1,label:C("end")+(t===e-1?n:"")}),i},editRule:function(e,t){f.ruleEditor._openRuleEditor(e,f.rulesTable.data.length,t)},addNewRule:function(){var e=f.rulesTable.data.length;f.ruleEditor._openRuleEditor({isNew:!0},e+1,e)},_openRuleEditor:function(e,t,n){var i=angular.copy(e);if(i.index=n,i.isEnabled=Boolean(e.isEnabled),e.protocol&&(i.protocol=e.protocol),"eq"===e.dstPortOperator){var a=[e.protocol,e.destinationPort].join("/"),s=f.ruleEditor.options.protocol.map(function(e){return e.id});i.protocol=o.includes(s,a)?a:e.protocol}var r=f.ruleEditor.constants;e.sourceAddress===r.anyAddr?(i.sourceAddressIp="",i.sourceAddressType="any"):e.sourceAddress&&(i.sourceAddressIp=e.source,i.sourceAddressMask=e.sourceMask,e.sourceMask===r.singleIpNetmask?i.sourceAddressType="single":i.sourceAddressType="subnet"),e.destinationAddress===r.anyAddr?(i.destinationAddressIp="",i.destinationAddressType="any"):e.destinationAddress&&(i.destinationAddressIp=e.destination,i.destinationAddressMask=e.destinationMask,e.destinationMask===r.singleIpNetmask?i.destinationAddressType="single":i.destinationAddressType="subnet"),"any"!==i.sourceAddressType&&"single"!==i.sourceAddressType||(i.sourceMask=E.netmask),"any"!==i.destinationAddressType&&"single"!==i.destinationAddressType||(i.destinationMask=E.netmask);var l=f.ruleEditor;l.ruleDataNotEdited=angular.copy(e),l.ruleData=angular.extend({},l.defaultRuleData,i),l._checkPorts(l.ruleData.protocol),l.rulePositions=l._getPositionOptions(t,n),l.ruleData.index=n,l.ruleCount=t,l.hashByIndex=f.rulesTable.data.map(function(e){return e.hash}),l.show()},save:function(){var e=f.ruleEditor.ruleData,t=e.isNew?"save-new":"save";return e.isNew||e.index!==f.rulesTable.data.length||e.index--,m.saveRule(f.aclName,e,f.rulesTable.data.length,f.interface.id).then(f.ruleEditor.close).then(h(t),b(t)).finally(f.onInterfaceValueChange)},drop:function(){return s.confirm("firewall.confirmations.drop").then(function(){return m.dropRule(f.aclName,f.ruleEditor.ruleData)}).then(f.ruleEditor.close).then(h("drop"),b("drop")).finally(f.onInterfaceValueChange)},checkIfPortsAreRequired:function(e){f.ruleEditor._checkPorts(e)},sourceAddressTypeChanged:function(e){"subnet"!==e&&(f.ruleEditor.ruleData.sourceAddressMask=f.ruleEditor.constants.singleIpNetmask)},destinationAddressTypeChanged:function(e){"subnet"!==e&&(f.ruleEditor.ruleData.destinationAddressMask=f.ruleEditor.constants.singleIpNetmask)}},t.$on("destroy",n.$on("$translateChangeSuccess",function(){return i(function(){f.ruleEditor.options=w.getOptions()})})),f.init()}e.$inject=["$q","$scope","$rootScope","$timeout","$document","_","modal","utils","notification","interfaces","browserCheck","CONSTANT","firewallEditorService","firewallService"],angular.module("keenetic").controller("FirewallController",e)}(),function(){function e(e,t,n,i,a,o,s,r,l,c,d,p,u,m,f){var g=this,v=m.MWS_PAGE_TAB_SWITCHED_EVENT,h=m.TAB;f.resetUninitializedSubcontrollerCount(),g.TAB=h,g.mwsDevicesUpdated=!1;var b=function(e){return o.getTranslation("wifi-system.tab.".concat(e))},_=function(){g.isNarrowAsMobile=c.isMobile||c.getBrowserWidth()<768};d(_,e),g.onTabSwitch=function(e,t){g.currentTab=t.id,n.$broadcast(v,g.currentTab)},g.showMwsModal=function(){return l.showMwsModal()},g.currentTab=g.TAB.DEVICES,g.isWizardAvailable=p.isWizardAvailable(),g.tabs=o.idsToOptions([g.TAB.DEVICES,g.TAB.LOG,g.TAB.SETTINGS],b),g.isMobile=c.isMobile,e.$on("$destroy",n.$on("$translateChangeSuccess",function(){t(function(){g.tabs=g.tabs.map(function(e){return Object.assign({},e,{label:b(e.id)})})})})),f.requester.setOnPollCallback(function(){_(),g.progress=100}),e.$on("$destroy",function(){return f.resetServiceState()})}e.$inject=["$scope","$timeout","$rootScope","$q","_","utils","appsService","CONSTANT","modalFactory","browserCheck","windowResizeWatcher","MWSService","MWSControllerService","MWSConstants","MWSRequester"],angular.module("keenetic").controller("MWSController",e)}(),function(){function e(e,t,n,i,a,o,s){return{getData:function(){var o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,r=a.toRciQueryList(["show.associations","show.rc.interface","show.rc.known.host"]);return n.postToRciRoot(r,{timeout:o}).then(function(n){var o=e.get(n,"[0].".concat("show.associations"),{}),r=e.get(n,"[1].".concat("show.rc.interface"),{}),l=e.get(n,"[2].".concat("show.rc.known.host"),{}),c=e.mapValues(e.invertBy(l,function(e){return e.mac}),function(e){return e[0]}),d=e.pickBy(r,function(e){return e.iseg}),p=e.mapValues(d,function(e){return a.getInterfaceL10n(e)}),u=e.reduce(d,function(e,t,n){return i.getSegmentAccessPoints(t).forEach(function(t){e[t]=n}),e},{}),m=(o.station||[]).map(function(n){var i=n.txrate,a=n.ht,o=n.txss,r=n.mode,l=n.security,d=e.startsWith(n.ap,s.MASTER)?t.WIFI_BAND_2_GHZ:t.WIFI_BAND_5_GHZ;return n.connection={txrate:i,ht:a,txss:o,rssi:Number(n.rssi),wifiRange:d,_11:n._11,mode:r,security:l},n.segment={name:p[u[n.ap]],id:u[n.ap],wifiBand:d},n.txrx={tx:n.txbytes,rx:n.rxbytes},c[n.mac]?(n.name=c[n.mac],delete c[n.mac]):n.name="",n.isOffline=!1,n});return{clients:m=(m=m.concat(e.map(c,function(e,t){return{name:e,mac:t,txrx:null,connection:null,segment:null,wifi:null,isOffline:!0}}))).map(function(e,t){return Object.assign({},e,{idx:t})}),knownHosts:e.map(l,function(e,t){return{mac:e.mac,name:t}})}})}}}e.$inject=["_","wifiOptions","router","interfaces","utils","CONSTANT","NDM"],angular.module("keenetic").factory("wifiClients",e)}(),function(){function e(e,t,n,i,a,o,s,r,l,c,d,p,u){var m="<wbr>/&nbsp;",f=this,g=l.translatePrefixCtor("wifiClients.table-columns"),v=function(){if(!c.DEVICE_IS_MWS_MEMBER)return l.getTranslation("wifiClients.description");var e=c.LAST_KNOWN_CONTROLLER_ADDRESS?l.l10n.getLinkChunks("controller",{class:l.EXTERNAL_LINK_CLASS,href:"http://".concat(c.LAST_KNOWN_CONTROLLER_ADDRESS),target:"_blank"}):{};return l.getTranslation("wifiClients.description-mws-member",null,e)};f.l10n={};var h=function(){f.l10n={range:r.getAllBandsL10n(!1),deleteDeviceEntry:l.getTranslation("wifiClients.delete-device-entry-title"),clearDeviceName:l.getTranslation("wifiClients.clear-device-name-title"),bandwidth:l.getTranslation("wifiClients.bandwidth"),wifiBand:l.getTranslation("wifiClients.wifi-band"),deviceNamePlaceholder:l.getTranslation("wifiClients.device-name-placeholder"),deviceNameExists:l.getTranslation("errors.name-exists"),mhz:l.getTranslation(d.UNIT.MHZ),mbitps:l.format.getSpeedUnit(d.UNIT_SCALE.MEGA),description:v()}};h(),n.$on("$destroy",i.$on("$translateChangeSuccess",function(){return t(h)})),n.$watch(function(){return c.LAST_KNOWN_CONTROLLER_ADDRESS},function(){f.l10n.description=v()}),f.progress=0;var b=function(e){return l.format.size(Number(e),!0).replace(/\s/g,"&nbsp;")};f.table={comparatorFn:function(e,t,n,i){var a=e.value||{},o=t.value||{};if(a.isOffline!==o.isOffline)return a.isOffline?1:-1;if(!a[n]||!o[n])return a[n]?-1:1;var s,r=i?1:-1;switch(n){case"mac":s=((!1===a.nameBeforeEdit?a.name:a.nameBeforeEdit)||a.mac)<((!1===o.nameBeforeEdit?o.name:o.nameBeforeEdit)||o.mac)?-1:1;break;case"txrx":s=a.txrx.rx+a.txrx.tx-(a.txrx.rx+o.txrx.tx);break;case"connection":s=a.connection.txrate-o.connection.txrate;break;default:s=a[n]<o[n]?-1:1}return s*r},data:[],columns:{mac:{title:g("device"),directive:{name:"ndm-edit-in-place",options:{subtext:"{{row.mac}}",model:"row.name",placeholder:c.DEVICE_IS_MWS_MEMBER?"—":f.l10n.deviceNamePlaceholder,validation:"isNameUnique,length[0..63]","validation-data":"{mac: row.mac}","is-locked":"row.isLocked",name:"nameEditor_{{row.idx}}","ng-attr-on-editing-start":"row.onEdit","ng-attr-on-cancel":"row.onCancel","ng-attr-on-submit":"row.onSubmit"}}},segment:{title:g("segment"),width:120,modify:function(e){return e?e.name+(t=e.wifiBand,'<br/><span class="help-text">'.concat(f.l10n.wifiBand,": ").concat(f.l10n.range[t],"</span>")):"&mdash;";var t}},connection:{title:g("connection"),width:100,modify:function(e){return e?l.wifi.formatConnectionData(e,f.l10n):"&mdash;"}},txrx:{title:"".concat(g("received")).concat(m).concat(g("transmitted")),modify:function(e){return e?"".concat(b(e.rx)).concat(m).concat(b(e.tx)):"&mdash;"}},uptime:{title:g("connected"),width:75,modify:function(e){return e?l.getSplittedTime(e):"&mdash;"}},isOffline:{title:" ",width:6,unsortable:!0,clickable:!0,modify:function(e,t){if(c.DEVICE_IS_MWS_MEMBER)return"";var n=t.isOffline||t.name?"":"remove-host-icon--disabled",i=t.isOffline?f.l10n.deleteDeviceEntry:f.l10n.clearDeviceName;return'<span class="remove-host-icon '.concat(n,'" title="').concat(i,'"></span>')}}}};var _=function(t){f.knownHosts=t.knownHosts,f.table.data=t.clients.map(function(t){return t.onEdit=function(){f.currentPollRequestCanceller&&f.currentPollRequestCanceller.resolve(),f.pollingIsStopped=!0,t.isBeingEdited=!0,t.nameBeforeEdit=t.name},t.onCancel=function(){t.isBeingEdited=!1,t.nameBeforeEdit=!1,f.pollingIsStopped=!1},t.onSubmit=function(n){return(n?u.registerHost(t.mac,n):t.nameBeforeEdit?u.unregisterHost(t.mac):e.when(!0)).then(function(){t.isBeingEdited=!1,t.nameBeforeEdit=!1,f.pollingIsStopped=!1})},t.isLocked=c.DEVICE_IS_MWS_MEMBER,t})};f.currentPollRequestCanceller=null,f.updateData=function(){f.pollingIsStopped||(f.currentPollRequestCanceller=e.defer(),s.getData(f.currentPollRequestCanceller.promise).then(_).then(function(){f.currentPollRequestCanceller=null}))};var y={isVisible:!1,name:"",mac:"",resetState:function(){y.name="",y.mac=""},show:function(){y.resetState(),y.isVisible=!0,t(a.get(f,"offlineRegistrationForm.offlineDeviceName.revalidate",angular.noop))},close:function(){y.isVisible=!1},register:function(){return u.registerHost(y.mac,y.name).then(y.close)}};f.offlineRegistrationPopup=y,f.isNameUnique=function(e){var t=(arguments.length<=1?0:arguments.length-1)>1?arguments.length<=2?void 0:arguments[2]:null,n=t?t.mac:null;if(e){var i,o=a.find(f.knownHosts||[],function(t){return t.name===e});if(o)return n?o.mac!==n&&(i={message:f.l10n.deviceNameExists}):i=f.l10n.deviceNameExists,i}},f.isMacUnique=function(e){if(e&&a.find(f.table.data||[],function(t){return t.mac===e}))return"errors.mac-address-used"},f.onTrashIconClick=function(){var e=arguments.length<=3?void 0:arguments[3];(e.isOffline||e.name)&&o.confirm(l.getTranslation(e.isOffline?"wifiClients.confirm-offline-host-removal":"wifiClients.confirm-clearing-device-name",null,e)).then(function(){return u.unregisterHost(e.mac)})},f.init=function(){return s.getData().then(_).then(function(){f.progress=100,f.pollingIsStopped=!1})},f.init()}e.$inject=["$q","$timeout","$scope","$rootScope","_","modal","wifiClients","wifiOptions","utils","NDM","CONSTANT","router","portForwarding"],angular.module("keenetic").controller("WifiClientsController",e)}(),function(){function e(e,t,n,i,a,o,s,r,l,c){var d=l.get(o,"profile.features",{}),p=c.WIFI_BAND_2_GHZ,u=c.WIFI_BAND_5_GHZ,m=c.HAS_WPA3,f=c.SECURITY_PROTOCOL,g=c.SECURITY_WITH_PSK,v=c.AP_IFACE_PREFIX,h=c.WPA_EAP_SECURITY,b=c.HAS_WPA_EAP,_=c.HAS_AX,y=c.WIFI_2_CHANNEL_WIDTH_FOR_STANDARD,S=c.WIFI_5_CHANNEL_WIDTH_FOR_STANDARD,w=c.DOWNLINK_MUMIMO,C=c.UPLINK_MUMIMO,E=c.DOWNLINK_OFDMA,I=c.UPLINK_OFDMA,T=["wpa-eap","radius"],k=c.getConst(),P=k.HAS_WIFI_5,A=k.HAS_FT,D=c.NO_BAND_STEERING,O=a.saveQueryStr().data,N={no:!0},L={auto:"",mhz:""},x=function(){L={auto:i.getTranslation("auto"),mhz:i.getTranslation(s.UNIT.MHZ)}};x(),n.$on("$translateChangeSuccess",function(){return t(x)});var R=function(e){return e["40-above"]?"40-above":e["40-below"]?"40-below":"20"},M=function(e,t){switch(e){case"40-below":case"40-above":return"40";case"40-below/80":case"40-above/80":return"80";case"80-plus-80":case"160":return"160"}return e||(P&&(t["wave2-80-80"]||t["wave2-160"])?"160":P&&t["vht-80"]?"80":t["ext-40-below"]||t["ext-40-above"]?"40":"20")},$=function(e,t,n){var i=l.get(n,"channel.channel","0"),a={"ext-40-below":!0},o={},s=[{id:String("0"),label:L.auto}],r={},d=[],p=L.mhz,u=c.getStandardOptions(t,e);return(e||[]).forEach(function(e){var t=String(e.number);s.push({id:String(t),label:String(t)});var n={};n[40]=e["ext-40-below"]||e["ext-40-above"],n[80]=P&&e["vht-80"],n[160]=P&&(e["wave2-80-80"]||e["wave2-160"]),i===t&&(a=e,o=n);var l=[{id:"20",name:"20 "+p}];n[40]&&l.push({id:"40",name:"20/40 "+p}),n[80]&&l.push({id:"80",name:"20/40/80 "+p}),n[160]&&l.push({id:"160",name:"20/40/80/160 "+p}),r[t]=l,l.length>d.length&&(d=angular.copy(l))}),r[0]=d,{channelOptions:s,standardOptions:u,channelWidthOptions:r,channelWidth:M(l.get(n,"channel.width"),o),channelType:R(a)}},F=["tx-queue","mtu","last-change","last-overflow"],V=function(e,t){var n={},i={};return l.forEach(t,function(t,a){t.currentChannel=t.channel;var o=angular.extend({},t,e[t.id]||{});F.forEach(function(e){delete o[e]}),n[a]=o,i[t.id]=a}),{config:n,aliases:i,get:function(e){return this.config[e]||this.config[this.aliases[e]]||!1},getByType:function(e){return l.pickBy(n,function(t){return t.type===e})}}},U=function(){return a.post({show:{interface:{},rc:{interface:{}}}}).then(function(e){var t=e.show||{},n=t.rc||{};return V(n.interface,t.interface)})},B=function(t){if(D)return e.when(!0);var n={interface:{}},i=!1;switch(t){case"no":i=N;break;case p:case u:i=[{enabled:!0},{preference:{band:t}}];break;case"default":i=[{enabled:!0},{preference:!1}]}return n.interface[o.MASTER_5G]={"band-steering":i},n},W=function(e){return{segmentId:e,radiusServer:"",radiusSecret:""}},H=function(e,t){return l.set({},["interface",e].concat(T),{server:t.radiusServer?(n=t.radiusServer,i=_slicedToArray(n.split(":"),2),{address:i[0],port:i[1]}):N,secret:t.radiusSecret||N});var n,i},q=function(e,t){return l.set({},["interface",e,"iapp","key"],t||N)},j=function(e,t,n){n=(n=Number(n))>0&&n<5?n:1;var i=f.DISABLED,a=f.WEP,o=f.WPA,s=f.WPA2,r=f.WPA_WPA2,c=f.WPA3,d=f.WPA2_WPA3,p=f.OWE,u=f.WPA2_EAP,v=f.WPA_WPA2_EAP,b=f.WPA3_EAP,_=f.WPA3_EAP_SUITE_B,y=f.WPA2_WPA3_EAP_TRANSITION,S=l.includes([o,r,v],e),w=l.includes([r,s,d,u,v,y],e),C=l.includes([d,c,b,_,y],e),E=e===p,I=e!==i,T=l.includes(g,e),k=l.includes(h,e),P={enable:{no:!I},wpa:{no:!S},wpa2:{no:!w}};m&&(P.owe={no:!E},P.wpa3=e===_?{enable:!0,"suite-b":!0}:{no:!C});var A,D={encryption:P,authentication:{"wpa-psk":{no:!T}}};e===a?((A=l.isArray(t)?(A=t.slice()).map(function(e,t){return Object.assign({},e,{id:t+1})}):l.map(t,function(e,t){return{hex:e,id:Number(t),no:!e}}))[n-1].default=!0,D.encryption.key=A):T&&(D.authentication["wpa-psk"]=k?N:{psk:t});return D},K=function(e){var t,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i={wmm:e.wmm,ssid:{ssid:e.ssid},"hide-ssid":{no:!e.hideSsid},schedule:e.schedule||N,wps:[{no:!e.wps},{"auto-self-pin":{no:!e.wpsPinEnabled}}],rrm:e.rrm,ft:{enable:e.ftEnabled,mdid:e.ftMdid||N}};return A&&!n||(delete i.rrm,delete i.ft),l.set({},["interface",e.id],(t=angular.extend(i,j(e.security,e.security===f.WEP?e.wepKeys:e.psk,1)),(o.DEVICE_IS_MWS_MEMBER?function(e){return{wps:e.wps,wmm:e.wmm}}:angular.identity)(t)))},G=function(e){var t=e.id,n={interface:{}},i=function(e,t){switch(e){case"40":return t["ext-40-below"]?"40-below":t["ext-40-above"]?"40-above":"20";case"80":return t["ext-40-above"]?"40-above/80":t["ext-40-below"]?"40-below/80":"20";case"160":if(t["wave2-160"])return"160";if(t["wave2-80-80"])return"80-plus-80"}return"20"}(e.channelWidth,e.channelData);if(n.interface[t]={channel:[{channel:e.channel},{"auto-rescan":function(e,t){if("0"!==t)return N;var n={hour:"3",min:"0"};switch(e){case"on-device-start":return N;case"dynamically":return angular.extend({},n,{interval:"1"});default:return angular.extend({},n,{interval:e.replace(/[^\d]/g,"")})}}(e.autoRescan,e.channel),width:i}],"country-code":{code:e.countryCode},compatibility:{annex:e.standard},power:{power:e.transmitPower},"tx-burst":e.txBurst},d.vht2ghz&&t===o.MASTER&&(n.interface[t].vht=e.qam256),c.isBeamformingSupported(e.band)){var a=e.beamforming?{enabled:!0}:N;n.interface[t].beamforming={explicit:a},(e.band===u||c.isAxStandard(e.standard))&&(n.interface[t][w]=e.downlinkMuMimo)}return _&&(e.beamforming&&(n.interface[t][E]=e.downlinkOfdma),n.interface[t][C]=e.uplinkMuMimo,n.interface[t][I]=e.uplinkOfdma),d.atf5ghz&&t===o.MASTER_5G&&(e.atfEnable?n.interface[t].atf={disable:!1,inbound:e.atfInbound}:n.interface[t].atf={disable:!0,inbound:!1}),e.countryCode||delete n.interface[t]["country-code"],e.canSelectChannel||(n.interface[t].channel=[{width:i}]),n},Y=function(){var e={enable:N,wpa:N,wpa2:N,key:[]};return m&&(e.wpa3=N,e.owe=N),e},z=function(e){var t={up:N,ssid:N,"hide-ssid":N,encryption:Y(),schedule:N,authentication:{"wpa-psk":{psk:"",no:!0}},wps:N,wmm:N,ft:{enable:N,mdid:N,otd:N},rrm:N};return l.set({},["interface",e],t)},Q=function(e){var t=l.get(e,"encryption");if(!t)return f.DISABLED;var n=!J(e),i=Boolean(t.wpa),a=Boolean(t.wpa2),o=Boolean(t.wpa3),s=Boolean(t.owe);return i&&a?n?f.WPA_WPA2_EAP:f.WPA_WPA2:a&&o?n?f.WPA2_WPA3_EAP_TRANSITION:f.WPA2_WPA3:i?f.WPA:a?n?f.WPA2_EAP:f.WPA2:o?n?l.isObject(t.wpa3)?f.WPA3_EAP_SUITE_B:f.WPA3_EAP:f.WPA3:s?f.OWE:f.WEP},X=function(e){var t=null,n={};return l.get(e,"encryption.key",[]).forEach(function(e){n[e.id]=e.hex,e.default&&(t=e.id)}),{wepKeys:n,defaultWepKey:t}},Z=function(e){var t;switch(e.security){case f.DISABLED:case f.OWE:t="";break;case f.WEP:t=e.wepKeys[e.defaultWepKey]||"";break;case f.WPA:case f.WPA2:case f.WPA3:case f.WPA_WPA2:case f.WPA2_WPA3:t=e.psk}return t},J=function(e){return l.get(e,"authentication.wpa-psk.psk")};return{queryConstructor:{resetAp:z},WIFI_FIELD_PREFIX:"wifi",getDefaultWpaEapSectionSettings:W,getWpaEapSectionSettings:function(e,t){var n,i,a=l.get(e,T);return a?{segmentId:t,radiusServer:(n=a.server,i=n.port?":"+n.port:"",n.address+i),radiusSecret:a.secret}:W(t)},saveBandSettings:function(e,t,n){var i=e.ap.id,s=K(e.ap,Boolean(e.doNotSaveFt));t||o.DEVICE_IS_MWS_MEMBER||(s.interface[i]["security-level"]={protected:""});var r=[s,G(e.master)];return!1===n||D||r.push(B(n)),e.roaming&&r.push(q(o.LAN,e.roaming.iappKey)),b&&e.wpaEap&&r.push(H(o.LAN,e.wpaEap)),a.postAndSave(r)},saveAll:function(e,t,n,i){var o=l.map(e,function(e){return t=e.ap,n=e.segment,i=t.id,a=K(t),n.isHomeSegment||(a.interface[i]["security-level"]={protected:""}),a;var t,n,i,a});return!1!==t&&o.push(B(t)),A&&n&&o.push(q(n.segmentId,n.iappKey)),b&&i&&o.push(H(i.segmentId,i)),a.postAndSave(o)},includeAp:function(e,t,n){return a.postAndSave(l.set({},["interface",n.id,"include"],[{interface:e,no:!t}]))},excludeAp:function(t,n){var i=n.iseg,o=i.include.split(",").filter(angular.identity),s=o.indexOf(t);return-1===s?e.when(!0):(delete i["free-port"],delete i["busy-vlan"],o.splice(s,1),i.include=o.join(","),a.postAndSave(l.set({},["interface",n.id,"iseg"],i)))},resetAp:function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return 0===n.length?e.when(!0):a.postAndSave(n.map(z))},getAllInterfacesData:function(t){if(t){var n=t.interface,i=t["show/interface"];return n&&i?e.when(V(n,i)):U()}return U()},getWifiStatus:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0]?0:2e3;return a.cached("show.interface",e).then(function(e){return{hwstate:"on"===l.get(e,[o.MASTER,"hwstate"]),dfsTime:l.get(e,[o.MASTER_5G,"dfs","cac"],0)}})},getSegmentAccessPoints:function(e,t){var n,i=e.get(t),a=(_defineProperty(n={},p,null),_defineProperty(n,u,null),n),s=l.chain(i).get("iseg.include","").split(",").filter(function(e){return l.includes(e,v)}).sort().value(),r=_slicedToArray(l.partition(s,function(e){return l.startsWith(e,o.MASTER)}),2),c=r[0],d=r[1],m=l.get(c,"[0]"),f=l.get(d,"[0]");return a[p]=m?e.get(m):null,a[u]=f?e.get(f):null,a.count=l.values(a).filter(l.identity).length,a},getFreeAccessPoints:function(e){var t,n=Object.keys(e.getByType("Bridge")),i={},a=(_defineProperty(t={},p,[]),_defineProperty(t,u,[]),t);return l.forEach(e.config,function(e){-1!==e.id.indexOf(v)&&(i[e.id]=!0)}),n.forEach(function(t){var n=e.get(t);n&&n.include&&n.include.forEach(function(t){var n=t.interface,a=e.get(n).id||n;a&&i[a]&&delete i[a]})}),l.forEach(i,function(e,t){var n=0===t.indexOf(o.MASTER)?p:u;a[n].push(t)}),a},getExistingSsids:function(e){var t,n=(_defineProperty(t={},p,[]),_defineProperty(t,u,[]),t);return l.forEach(e.config,function(e){if(r.isAccessPointInterfaceId(e.id)){var t=e.id.split("/")[0]===o.MASTER?p:u;e.ssid&&n[t].push({ssid:e.ssid,id:e.id})}}),n},getBandSteeringSetting:function(e){if(!P||D)return"no";var t=e.get(o.MASTER_5G)["band-steering"];return t=!0===t?"default":t.preference?String(t.preference.band):"no"},getSecurityProtocolOption:Q,getEncryptionConfig:j,ap:{dummyModel:function(e){var t={id:e.id,masterId:e.id.split("/")[0],band:p,isEnabled:e.up,ssid:"",ssidOnLoad:"",security:f.DISABLED,securityOnInit:f.DISABLED,psk:"",passkey:"",schedule:"",savedSchedule:"",wmm:!1,wps:!1,wpsPin:"",wpsPinEnabled:!1,rrm:!1,ftEnabled:!1,ftMdid:"","hide-ssid":!1};return t=angular.extend(t,X(e))},ifaceToModel:function(e){var t=e.id,n=t.split("/")[0],i=n===o.MASTER?p:u,a=Q(e),s=e.schedule||"",r={id:t,masterId:n,band:i,isEnabled:Boolean(e.up),ssid:e.ssid,ssidOnLoad:e.ssid,hideSsid:Boolean(e["hide-ssid"]),schedule:s,savedSchedule:s,security:a,securityOnInit:a,psk:J(e),wmm:Boolean(e.wmm),wps:angular.isObject(e.wps)&&e.wps.enabled||Boolean(e.wps),wpsPin:"",wpsPinEnabled:e.wps&&e.wps["auto-self-pin"],rrm:Boolean(e.rrm),ftEnabled:l.get(e,"ft.enable",!1),ftMdid:l.get(e,"ft.mdid","")};return(r=angular.extend(r,X(e))).passkey=Z(r),r["hide-ssid"]=Boolean(e["hide-ssid"]),r},modelToIface:K,modelGetPasskey:Z,getPin:function(e){return a.get("show/interface/wps/pin?name=".concat(e))},setSchedule:function(e,t){return a.postAndSave(l.set({},["interface",e,"schedule"],t||N))},getResetJson:z,getResetEncryptionJson:Y,toggleWpsSession:function(e,t){var n=["interface",e,"wps"],i=[];return t?i.push(l.set({},n,{button:{direction:"send"}})):(i.push(l.set({},n,{no:!0})),i.push(l.set({},n,{no:!1})),i.push(O)),a.post({url:"",data:i})}},master:{ifaceToModel:function(e,t){var n,i,a=function(e){return{id:e.id,countryCode:"",standard:e.id===o.MASTER?"BGN":"A",channelWidth:e.id===o.MASTER?"20":"160",channel:"0",currentCfg:{"40-below":!0},currentChannel:"0",canSelectChannel:!0,autoRescan:"on-device-start",transmitPower:"100",txBurst:!1,qam256:!1,beamforming:!1,downlinkMuMimo:!1,uplinkMuMimo:!1,downlinkOfdma:!1,uplinkOfdma:!1,atfInbound:!1,atfEnable:!0}}(e),s=Object.keys(a),r={id:e.id,band:e.id===o.MASTER?p:u,countryCode:l.get(e,"country-code.code"),standard:l.get(e,"compatibility.0.annex"),channelWidth:l.get(e,"channel.width"),channel:(n=e,i=n.channel,i?angular.isString(i)?i:i.channel||"0":"0"),currentCfg:e.channel||{},currentChannel:e.currentChannel,canSelectChannel:Boolean(t),autoRescan:function(e){var t=l.get(e,"channel.auto-rescan.interval",null);return t?"1"===t?"dynamically":"every-"+t+"h":"on-device-start"}(e),transmitPower:e.power,txBurst:e["tx-burst"],beamforming:!1,downlinkMuMimo:l.get(e,w,!1),uplinkMuMimo:l.get(e,C,!1),downlinkOfdma:l.get(e,E,!1),uplinkOfdma:l.get(e,I,!1)};return e.id===o.MASTER&&(r.qam256=!!angular.isUndefined(e.vht)||Boolean(e.vht)),c.isBeamformingSupported(r.band)&&(r.beamforming=l.get(e,"beamforming.explicit",!1)),d.mimo5ghz&&e.id===o.MASTER_5G&&(r=angular.extend(r,function(e){var t=!1,n=!1;return e.atf&&(t=Boolean(l.get(e,"atf.inbound")),n=Boolean(l.get(e,"atf.disable"))),{atfEnable:!n,atfInbound:t}}(e))),s.forEach(function(e){angular.isUndefined(r[e])&&(r[e]=a[e])}),r},modelToIface:G,getOptions:function(e,t){var n="show/interface/channels/channel";return n+="?name="+e,t&&(n+="&country-code="+t),a.get(n).then(function(t){return function(e,t){var n=[{id:String("0"),label:L.auto}],i={},a={},s=[],r={"ext-40-below":!1,"ext-40-above":!1,"vht-80":!1,"wave2-80-80":!1,"wave2-160":!1},d=L.mhz,m=e===o.MASTER?p:u,f=c.getStandardOptions(m,t);return(t||[]).forEach(function(e){var t=String(e.number),o=[{id:"20",name:"20 "+d}];e["ext-40-below"]&&(r["ext-40-below"]=!0),e["ext-40-above"]&&(r["ext-40-above"]=!0),(e["ext-40-below"]||e["ext-40-above"])&&o.push({id:"40",name:"20/40 "+d}),P&&e["vht-80"]&&(r["vht-80"]=!0,o.push({id:"80",name:"20/40/80 "+d})),P&&(e["wave2-160"]||e["wave2-80-80"])&&(e["wave2-160"]&&(r["wave2-160"]=!0),e["wave2-80-80"]&&(r["wave2-80-80"]=!0),l.filter(o,{id:"160"}).length||o.push({id:"160",name:"20/40/80/160 "+d})),o.length>s.length&&(s=angular.copy(o)),a[t]=o,i[t]=angular.extend({},{"ext-40-below":!1,"ext-40-above":!1,"vht-80":!1,"wave2-80-80":!1,"wave2-160":!1},e),n.push({id:t,label:t})}),a[0]=s,i[0]=r,{channelOptions:n,standardOptions:f,widthOptionsPerChannel:a,allChannelsData:i}}(e,t)})},filterWidthsByStandard:function(e,t,n){var i=n===p?y:S;if(e&&t){var a={};return l.forEach(i,function(e,n){l.includes(t,n)&&e.forEach(function(e){a[e]=!0})}),e.filter(function(e){return a[e.id]})}},getChannelData:function(e,t){var n=e.channel,i=t[l.get(e,"channel.channel","0")];return{channelData:i,channelWidth:M(l.get(e,"channel.width"),i),savedCfg:n,savedChannelType:n?R(n):void 0}},getCountryCodeOptions:function(e){return a.get("show/interface/country-codes/country-code?name=".concat(e)).then(function(e){return e.map(function(e){return{id:e.code,label:e.country}})})},getChannelsAndStandards:function(e,t){t=t||e["country-code"]&&e["country-code"].code;var n=e.id,i=n===o.MASTER?p:u,s="show/interface/channels/channel";return s+="?name="+n,t&&(s+="&country-code="+t),a.get(s).then(function(t){return $(t,i,e)})},checkIfChannelIsDfs:function(e){var t=c.DFS_RANGES;return l.inRange(e,t[0].start,t[0].end+1)||l.inRange(e,t[1].start,t[1].end+1)},getDfsBadge:function(){return'<div class="dfs-badge option-badge">DFS</div>'},getDfsScanStatusMessage:function(e){return i.getTranslation("wifi-settings.form.dfs-status",null,{cac:i.getSplittedTimeInMS(e)})},getWifiDisabledWarning:function(){return'<span class="warning-text" data-translate>dashboard.card_segments.wifi-disabled</span>'},processChannelsData:$,WIFI_DEFAULT_CHANNEL:"0"}}}e.$inject=["$q","$timeout","$rootScope","utils","router","NDM","CONSTANT","interfaces","_","wifiOptions"],angular.module("keenetic").factory("wifiSettingsService",e)}(),function(){function e(e,t,n,i,a,o,s){var r=n.get(o,"profile.features",{}),l=n.has(r,"wifi5ghz"),c=n.has(r,"wifi_ft"),d=n.has(r,"wifi6"),p=n.has(r,"no_band_steering"),u=n.has(r,"wpa3"),m=Boolean(i["wpa-eap"]),f="2",g="5",v=l?[f,g]:[f],h=[{id:"B",label:"802.11b"},{id:"BG",label:"802.11b/g"},{id:"GN",label:"802.11g/n"},{id:"N",label:"802.11n"},{id:"BGN",label:"802.11b/g/n"}],b=[{id:"N+AX",label:"802.11n/ax"},{id:"GN+AX",label:"802.11g/n/ax"},{id:"BGN+AX",label:"802.11b/g/n/ax"}],_=[{id:"A",label:"802.11a"},{id:"AN",label:"802.11a/n"}],y=[{id:"N+AC",label:"802.11n/ac"},{id:"AN+AC",label:"802.11a/n/ac"}],S=[{id:"AN+AC+AX",label:"802.11a/n/ac/ax"},{id:"N+AC+AX",label:"802.11n/ac/ax"}],w=l?[].concat(_toConsumableArray(o.AP),_toConsumableArray(o.AP_5G)):o.AP,C=a.getTranslation(s.UNIT.GHZ),E=function(){T.forEach(function(e){e.label=a.getTranslation("wifi-settings.form.band-steering.options.".concat(e.id))}),k.forEach(function(e){e.label=a.getTranslation("wifi-settings.form.auto-rescan.options.".concat(e.id))}),M[0].label=a.getTranslation("wifi-settings.form.security-protocol.options.none"),C=a.getTranslation(s.UNIT.GHZ)};t.$on("$translateChangeSuccess",function(){return e(E)});var I=a.idsToOptions(["10","25","50","75","100"],function(e){return e+"%"}),T=["default",g,f,"no"].map(function(e){return{id:e,label:"wifi-settings.form.band-steering.options.".concat(e)}}),k=a.idsToOptions(["on-device-start","dynamically","every-6h","every-12h","every-24h"],a.translatePrefixCtor("wifi-settings.form.auto-rescan.options")),P={DISABLED:"disable",WEP:"wep",WPA:"wpa",WPA2:"wpa2",WPA_WPA2:"wpa+wpa2",WPA3:"wpa3",WPA2_WPA3:"wpa2+wpa3",OWE:"owe",WPA2_EAP:"wpa2-eap",WPA_WPA2_EAP:"wpa-wpa2-eap",WPA2_WPA3_EAP_TRANSITION:"wpa2-wpa3-eap-transition",WPA3_EAP:"wpa3-eap",WPA3_EAP_SUITE_B:"wpa3-eap-suite-b"},A=[P.WPA2_EAP,P.WPA_WPA2_EAP,P.WPA2_WPA3_EAP_TRANSITION,P.WPA3_EAP,P.WPA3_EAP_SUITE_B],D=[P.WPA_WPA2,P.WPA2_WPA3].concat(A),O=[P.WPA,P.WPA2,P.WPA3,P.OWE],N=[P.DISABLED,P.OWE].concat(A),L=[P.WPA,P.WPA_WPA2,P.WPA2,P.WPA2_WPA3,P.WPA3],x=[P.OWE,P.WEP,P.WPA,P.WPA3_EAP_SUITE_B],R=[P.WPA3,P.WPA3_EAP,P.WPA3_EAP_SUITE_B],M=[{id:P.DISABLED,label:a.getTranslation("wifi-settings.form.security-protocol.options.none")},{id:P.WEP,label:"WEP"},{id:P.WPA,label:"WPA-PSK"},{id:P.WPA2,label:"WPA2-PSK"},{id:P.WPA_WPA2,label:"WPA-PSK + WPA2-PSK"}];u&&M.push({id:P.WPA2_WPA3,label:"WPA2-PSK + WPA3-PSK"},{id:P.WPA3,label:"WPA3-PSK"},{id:P.OWE,label:"OWE"}),m&&(M.push({id:P.WPA2_EAP,label:"WPA2 Enterprise"},{id:P.WPA_WPA2_EAP,label:"WPA + WPA2 Enterprise"}),u&&M.push({id:P.WPA2_WPA3_EAP_TRANSITION,label:"WPA2 + WPA3 Enterprise"},{id:P.WPA3_EAP,label:"WPA3 Enterprise"},{id:P.WPA3_EAP_SUITE_B,label:"WPA3-192 Enterprise"}));var $=M.filter(function(e){var t=e.id;return!n.includes(D,t)});return{getAllBandsL10n:function(){var e,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return _defineProperty(e={},f,"".concat(f).concat(a.getDecimalSeparator(),"4").concat(t?"":" "+C)),_defineProperty(e,g,"".concat(g).concat(t?"":" "+C)),e},getConst:function(){return angular.copy({transmitPower:I,security:M,bandSteering:T,autoRescan:k,WIFI_TYPES:v,HAS_WIFI_5:l,HAS_FT:c})},WIFI_BAND_STEERING_OPTIONS:T,SECURITY_PROTOCOL:P,SECURITY_WITH_PSK:L,SECURITY_WITHOUT_PSK:N,UNSUITABLE_FOR_ROAMING:x,WIFI_SECURITY_PROTOCOL_OPTIONS:M,WISP_SECURITY_OPTIONS:$,HAS_WIFI_5:l,HAS_AX:d,ALL_ACCESS_POINTS:w,MASTER_IFACE_PREFIX:"WifiMaster",AP_IFACE_PREFIX:"AccessPoint",FAST_TRANSITION_MODE_OPTIONS:{DISABLED:"disabled",ENABLED_ON_WIFI2:"enabled-on-wifi2",ENABLED_ON_WIFI5:"enabled-on-wifi5",ENABLED_ON_BOTH:"enabled-on-both"},WPS_SESSION_DURATION:120,WIFI_BAND_2_GHZ:f,WIFI_BAND_5_GHZ:g,L10N_ID_AP_SYNC_LOCK:"wifi-settings.ap-5ghz-sync-lock",L10N_ID_AP_SECURITY_DESCRIPTION:"wifi-settings.form.security-protocol.description",NO_BAND_STEERING:p,HAS_WPA3:u,NON_WEP_ENCRYPTION_COMMANDS:O,HAS_WPA_EAP:m,WPA_EAP_SECURITY:A,DFS_RANGES:[{start:52,end:64},{start:100,end:140}],DOWNLINK_MUMIMO:"downlink-mumimo",UPLINK_MUMIMO:"uplink-mumimo",DOWNLINK_OFDMA:"downlink-ofdma",UPLINK_OFDMA:"uplink-ofdma",WIFI_2_STANDARDS:h,WIFI_2_AX_STANDARDS:b,WIFI_5_STANDARDS:_,WIFI_5_80MHZ_STANDARDS:y,WIFI_5_AX_STANDARDS:S,WIFI_2_CHANNEL_WIDTH_FOR_STANDARD:{AX:["20","40"],B:["20"],N:["20","40"],G:["20"]},WIFI_5_CHANNEL_WIDTH_FOR_STANDARD:{AX:["20","40","80","160"],AC:["160","80"],A:["20"],N:["20","40"]},getStandardOptions:function(e,t){if(e===f)return d?[].concat(h,b).filter(function(e){return"N"!==e.id}):h;var n=t.some(function(e){return e["vht-80"]||e["wave2-80-80"]||e["wave2-160"]})?[].concat(_,y):_;return d?[].concat(_toConsumableArray(n),S):n},isAxStandard:function(e){return[].concat(b,S).some(function(t){return t.id===e})},isBeamformingSupported:function(e){return e===f?n.has(r,"bf2ghz")||n.has(r,"mimo2ghz"):n.has(r,"mimo5ghz")},isWep:function(e){return e===P.WEP},isAnyWpaPsk:function(e){return n.includes(L,e)},isAnyWpaEap:function(e){return n.includes(A,e)},isWpa3Psk:function(e){return e===P.WPA3},isAnyWpa3:function(e){return n.includes(R,e)},isOwe:function(e){return e===P.OWE},getApIfaceId:function(e,t){var n=String(e)===f?0:1;return"".concat("WifiMaster").concat(n,"/").concat("AccessPoint").concat(t)},getOtherBand:function(e){var t;return(t={},_defineProperty(t,f,g),_defineProperty(t,g,f),t)[e]},wifiStandardIdxToLabel:function(e){return"802.11"+e.toLowerCase()},events:{ADVANCED_SETTINGS_POPUP_READY:"ADVANCED_SETTINGS_POPUP_READY"}}}e.$inject=["$timeout","$rootScope","_","components","utils","NDM","CONSTANT"],angular.module("keenetic").factory("wifiOptions",e)}(),function(){function e(e,t,n,i,a,o,s,r,l,c,d,p,u){var m=this,f=u.WIFI_BAND_2_GHZ,g=u.WIFI_BAND_5_GHZ,v=u.L10N_ID_AP_SYNC_LOCK,h=u.isWep,b=u.isAnyWpaPsk,_=u.isAnyWpaEap,y=p.master.WIFI_DEFAULT_CHANNEL,S=t.path().split("/").filter(angular.identity),w=s.translatePrefixCtor("wifi-settings");S.forEach(function(e){0===e.indexOf("wifi")&&(m.wifiBand=e.replace("wifi",""))}),m.isWep=h,m.isAnyWpaPsk=b,m.isAnyWpaEap=_,m.autoChannelOptionId=y,m.options=u.getConst(),m.ready=!1,m.apSettingsEqual=!1,m.progress=0,m.otherBandSettings={},m.securitySelectboxDescription="",m.onSsidChange=function(e){m.wifiBand===g&&(m.apSyncLock=e&&e===o.get(m,"otherBandSettings.ssid"),m.securitySelectboxDescription=m.apSyncLock?v:"")},m.updateInfo=function(){return m.ap.savedSchedule&&m.ap.isEnabled?r.cached("show.schedule").then(function(e){m.ap.downOnSchedule=!l.isActive(e[m.ap.savedSchedule])}):(m.ap.downOnSchedule=!1,e.when(!0))};var C=m.wifiBand===g&&u.HAS_WIFI_5&&!u.NO_BAND_STEERING;m.ui={apHeaderIsVisible:!0,masterHeaderIsVisible:!1,toggleIsVisible:!0,footerIsVisible:!1,qam256IsVisible:m.wifiBand===f&&d.profile.features.vht2ghz,beamformingIsVisible:u.isBeamformingSupported(m.wifiBand),bandSteeringSelectboxIsVisible:C,roamingSectionIsVisible:m.options.HAS_FT,isPopup:!1},m.ui.isDlMuMimoVisible=m.wifiBand===g&&m.ui.beamformingIsVisible,m.validationData={},m.validation={isSsidUnique:angular.noop};var E=function(e,t){return p.master.getOptions(e.id,t).then(function(e){m.allChannelsData=e.allChannelsData,m.widthOptionsPerChannel=e.widthOptionsPerChannel,m.options=angular.extend(m.options,{channel:e.channelOptions,standard:e.standardOptions})})},I=function(){o.get(m,"form.$setPristine",o.noop)()},T=function(){var e,t;m.l10n={schedule:w("form.schedule"),key:w("form.psk.label"),placeholder:{psk:w("placeholder.passkey")},header:(e={},_defineProperty(e,u.WIFI_BAND_2_GHZ,w("ap-header")),_defineProperty(e,u.WIFI_BAND_5_GHZ,w("ap-header")),e),masterLabel:(t={},_defineProperty(t,u.WIFI_BAND_2_GHZ,w("general-settings-".concat(u.WIFI_BAND_2_GHZ))),_defineProperty(t,u.WIFI_BAND_5_GHZ,w("general-settings-".concat(u.WIFI_BAND_5_GHZ))),t),radiusSettingsAreEqual:w("form.radius-server.description-repeater")},m.radiusServerDescription=m.options.HAS_WIFI_5?m.l10n.radiusSettingsAreEqual:""};i.$on("$destroy",a.$on("$translateChangeSuccess",function(){return n(T)}));var k=function(e){m.options.channelWidth=o.clone(m.widthOptionsPerChannel[e]),m.options.channelWidth=p.master.filterWidthsByStandard(m.options.channelWidth,m.master.standard,m.master.band),m.master.channelWidth&&-1!==o.map(m.options.channelWidth,"id").indexOf(m.master.channelWidth)||(m.master.channelWidth=o.last(m.options.channelWidth).id)};m.onStandardChange=function(){n(function(){k(m.master.channel),m.isAxStandardSelected=u.isAxStandard(m.master.standard)})};m.onChannelSelect=function(e){k(e),m.master.channelData=m.allChannelsData[e]},m.onCountryCodeChange=function(e){return E(m.masterIface,e).then(function(){-1===o.map(m.options.channel,"id").indexOf(m.master.channel)?(m.master.channel=y,m.onChannelSelect(m.master.channel)):k(m.master.channel)})},m.onSecurityTypeChange=function(e){m.unsuitableSecurityForRoaming="WPA2"!==e&&"disabled"!==e},m.toggleIfaceState=function(e){return c.toggleState(m.ap.id,e)},m.cancel=function(){o.get(m,"form.reset",o.noop)()},m.save=function(){return p.saveBandSettings({ap:m.ap,master:m.master,doNotSaveFt:!1,roaming:{iappKey:m.iappKey},wpaEap:m.wpaEap},!0,!(!m.ui.bandSteeringSelectboxIsVisible||!m.apSettingsEqual)&&m.master.bandSteering).then(function(){m.ap.savedSchedule=m.ap.schedule}).finally(I)},T(),p.getAllInterfacesData().then(function(e){m.ifacesData=e,m.progress=50;var t=u.getApIfaceId(m.wifiBand,0),i=m.ifacesData.get(t),a=u.getOtherBand(m.wifiBand),s=u.getApIfaceId(a,0),r=m.ifacesData.get(s);if(m.ap=p.ap.ifaceToModel(i),m.otherBandSettings=r?p.ap.ifaceToModel(r):{},m.onSsidChange(m.ap.ssid),m.wifiBand===u.WIFI_BAND_5_GHZ&&m.options.HAS_WIFI_5){var l=u.getApIfaceId(u.WIFI_BAND_2_GHZ,0),c=m.ifacesData.get(l),f=p.ap.ifaceToModel(c);m.apSettingsEqual=o.every(["ssid","schedule","passkey"],function(e){return m.ap[e]===f[e]})}var g=m.wifiBand===u.WIFI_BAND_2_GHZ?d.WIFI.BGN.STA:d.WIFI.AC.STA,v=m.ifacesData.get(g),h=m.ifacesData.get(d.LAN);m.iappKey=o.get(h,"iapp.key"),m.wpaEap=p.getWpaEapSectionSettings(h,d.LAN),m.masterIface=m.ifacesData.get(m.ap.masterId),m.master=p.master.ifaceToModel(m.masterIface,!v||!v.ssid&&!v.backhaul||!v.up),m.master.bandSteering=p.getBandSteeringSetting(m.ifacesData),p.ap.getPin(t).then(function(e){m.ap.wpsPin=e,m.ready=!0,m.progress+=10}).finally(function(){p.master.getCountryCodeOptions(m.masterIface.id).then(function(e){m.options.countryCode=e,m.progress+=20}).then(function(){return E(m.masterIface,o.get(m,"masterIface.country-code.code"))}).then(function(){m.progress+=20,m.master=angular.extend(m.master,p.master.getChannelData(m.masterIface,m.allChannelsData)),m.isAxStandardSelected=u.isAxStandard(m.master.standard),k(m.master.channel)}).finally(function(){n(I),m.progress=100,m.ready=!0})})})}e.$inject=["$q","$location","$timeout","$scope","$rootScope","_","utils","router","schedules","interfaces","NDM","wifiSettingsService","wifiOptions"],angular.module("keenetic").controller("WifiController",e)}(),function(){angular.module("keenetic").factory("trafficMonitorEvents",function(){return{START_POLLING:"START_POLLING",STOP_POLLING:"STOP_POLLING",CHART_LEGEND_SELECT_HOST:"CHART_LEGEND_SELECT_HOST",CHART_LEGEND_RESET_SELECTED_HOST:"CHART_LEGEND_RESET_SELECTED_HOST",REFRESH_BAR_CHART:"REFRESH_BAR_CHART",RESIZE_BAR_CHART:"RESIZE_BAR_CHART",DISABLE_BAR_CHART:"DISABLE_BAR_CHART",RECALCULATE_BAR_CHART_LABELS:"RECALCULATE_BAR_CHART_LABELS",REDRAW_BAR_CHART_TIME_LABELS:"REDRAW_BAR_CHART_TIME_LABELS",HIDE_DEVICES_LIST:"HIDE_DEVICES_LIST",SHOW_DEVICES_LIST:"SHOW_DEVICES_LIST",UPDATE_L10N:"UPDATE_L10N",ADD_HOST_TAB:"ADD_HOST_TAB",SET_ACTIVE_TAB_TO_TOP_5:"SET_ACTIVE_TAB_TO_TOP_5",SET_ACTIVE_TAB_BY_MAC:"SET_ACTIVE_TAB_BY_MAC",CONFIRM_NEW_TAB_DEVICE_CHOICE:"CONFIRM_NEW_TAB_DEVICE_CHOICE",NEW_TAB_ADDED:"NEW_TAB_ADDED",ACTIVE_TAB_SWITCHED:"ACTIVE_TAB_SWITCHED",CHART_HINT_REFRESH:"CHART_HINT_REFRESH",CHART_HINT_ON_MOUSEMOVE:"CHART_HINT_ON_MOUSEMOVE",SHARED_STATE_UPDATED:"SHARED_STATE_UPDATED"}})}(),function(){function e(e,t,n,i,a,o,s,r,l,c,d,p,u,m,f,g,v){var h=this,b=p.SCALES,_=p.DEFAULT_SCALE,y=p.SECONDS_IN_MINUTE,S=u.UPDATE_L10N,w=u.START_POLLING,C=u.STOP_POLLING,E=u.CHART_LEGEND_SELECT_HOST,I=u.CHART_LEGEND_RESET_SELECTED_HOST,T=u.REFRESH_BAR_CHART,k=u.DISABLE_BAR_CHART,P=u.RESIZE_BAR_CHART,A=u.ADD_HOST_TAB,D=u.SET_ACTIVE_TAB_TO_TOP_5,O=u.SET_ACTIVE_TAB_BY_MAC,N=u.ACTIVE_TAB_SWITCHED,L=u.CHART_HINT_ON_MOUSEMOVE,x=u.CHART_HINT_REFRESH,R=u.RECALCULATE_BAR_CHART_LABELS,M=u.REDRAW_BAR_CHART_TIME_LABELS,$=d.RRD;h.$relay=function(){return t.$broadcast.apply(t,arguments)},h.timeShift=0,h.trackedMacs=[],h.isActiveTabNew=!1,h.activeTabHost=!1,h.isDeviceListVisible=!1,h.hostSelectedInLegend=!1,m.subscribeOnUpdates(t,function(e){var t=e.isActiveTabNew,n=e.isDeviceListVisible,i=e.trackedMacs,a=e.activeTabHost,o=e.hostSelectedInLegend,s=e.timeShift;h.isActiveTabNew=t,h.isDeviceListVisible=n,h.trackedMacs=i,h.activeTabHost=a,h.hostSelectedInLegend=o,h.timeShift=s});var F=new f(function(){return V()},t,b[_].pollingInterval);t.$on(w,function(){return F.start()}),t.$on(C,function(){return F.stop()});var V=function e(){var t=(e.__counter||0)+1;return e.__counter=t,d.getTopDevicesOrOneHostData(h.scaleId,7,h.activeTabHost).then(function(n){t!==e.__counter||h.isDeviceListVisible||B(n)})},U=function(e){return r.orderBy(e,["type","sum"],["desc","asc"])},B=function(e){var n=b[h.scaleId],i=U(e.hosts);h.sum.rxbytes=r.sumBy(i,function(e){return e.rxbytes}),h.sum.txbytes=r.sumBy(i,function(e){return e.txbytes}),h.sum.total=h.sum.rxbytes+h.sum.txbytes,h.hosts=i.map(function(e,t){return e.type?(e.idx=-t,e.style={extraClass:e.type}):(e.idx=W.getSlotIdxForMac(e.mac),e.style={color:g.getHex(e.idx)}),e});for(var a=[],o=function(e){a[e]=a[e]||[],i.forEach(function(t,n){a[e][n]=t.graph[e]||[0,0]})},s=0;s<n.ticksLimit;s++)o(s);d.getRegisteredHosts().then(function(e){h.noRegisteredHosts=0===e.length,i.length||!h.noRegisteredHosts?(h.barChart.params={columns:n.ticksLimit,data:a.reverse(),labels:p.getLabels(n,h.timeShift),styles:h.hosts.map(function(e){return e.style})},h.chartLegend.refreshBarCharSelectedHost(),h.ui.unlock(),t.$broadcast(x)):h.noRegisteredHosts&&(F.stop(),h.barChart.setRandomParams()),h.ui.progress=100})},W={normalDevicesAmount:8,minimalLifetime:3*y*1e3,knownDevices:[],getSlotIdxForMac:function(e){var t=W,n=r.findIndex(t.knownDevices,{mac:e});return~n?(t.knownDevices[n].timestamp=Date.now(),n):(t.knownDevices.length>=t.normalDevicesAmount&&(n=r.findIndex(t.knownDevices,function(e){return Date.now()-e.timestamp>t.minimalLifetime})),~n||(n=t.knownDevices.length),t.knownDevices[n]={mac:e,timestamp:Date.now()},n)}};h.l10n={};var H=function(){h.l10n={deviceListFilterPlaceholder:l.getTranslation("traffic-monitor.device-list.filter-placeholder"),description:l.getTranslation("traffic-monitor.page-description",null,{registerDevicesLink:'<a \n                            data-ui-sref="controlPanel.devicesList()"\n                            class="ref-link"\n                            data-translate>\n                            traffic-monitor.register-devices-link\n                        </a>'})},h.l10n.lang=l.getCurrentLanguage(),v.isMobile?(h.l10n.hintDescription=h.l10n.description,h.l10n.pageDescription=""):(h.l10n.hintDescription="",h.l10n.pageDescription=h.l10n.description)};h.scaleId=_,h.hosts=[],h.sum={rxbytes:0,txbytes:0,total:0},h.barChart={redrawLabelsFunction:r.noop,params:{labels:{},columns:$.TICKS,minVelocity:1e3,data:[],colors:[],selectedIdx:-1},setDisabledParams:function(){h.barChart.params.data=[]},setRandomParams:function(){var e=h.barChart,t=b[h.scaleId];e.params={columns:t.ticksLimit,data:Array(t.ticksLimit).fill([]).map(function(){return[[Math.floor(700*Math.random())+300,0]]}),labels:p.getLabels(t,h.timeShift),colors:["#eee"]}},selectBarByMac:function(e){h.barChart.params.selectedIdx=r.findIndex(U(h.hosts),{mac:e})},onBarDoubleClick:function(e,t){var n=U(h.hosts)[t];n&&n.mac!==h.activeTabHost.mac&&h.chartLegend.displayHostInSeparateTab(n.mac)},onBarClick:function(e,t){if(!h.ui.isLocked()&&!h.activeTabHost)if(-1===t)h.chartLegend.resetSelectedHost();else{var n=U(h.hosts)[t];h.chartLegend.selectHost(n.mac)}},onResize:function(e,n){t.$broadcast(P,n)},onMouseOverColumn:function(e){t.$broadcast(L,e)}},t.$on(k,function(){return h.barChart.setDisabledParams()}),t.$on(R,function(){h.isActiveTabNew||(h.barChart.params.labels=p.getLabels(b[h.scaleId],h.timeShift),e(function(){return i.$broadcast(M)}))}),h.chartLegend={host:!1,scales:r.map(b,function(e,t){return{id:t,label:e.label}}),setScale:function(e){h.ui.isLocked()||(h.ui.lock(),h.ui.setIsLoading(),h.scaleId=e.id,F.stop(),F.interval=b[h.scaleId].pollingInterval,F.start())},_updateSelectedHost:function(e){var t=h.chartLegend;t.host=t.host!==e&&e||!1,t.refreshBarCharSelectedHost(),m.setState({hostSelectedInLegend:t.host})},selectHost:function(e){h.activeTabHost&&h.activeTabHost.mac===e||h.chartLegend._updateSelectedHost(e)},displayHostInSeparateTab:function(e){if(!h.activeTabHost||h.activeTabHost.mac!==e){h.chartLegend.host=!1;var n=r.find(h.hosts,{mac:e});if(n)h.trackedMacs.some(function(e){return e===n.mac})?t.$broadcast(O,n.mac):t.$broadcast(A,n)}},refreshBarCharSelectedHost:function(){h.barChart.selectBarByMac(h.chartLegend.host)},resetSelectedHost:function(){t.$broadcast(D),h.chartLegend._updateSelectedHost(!1)}},t.$on(E,function(e,t){t&&(h.chartLegend.host=t,h.chartLegend.refreshBarCharSelectedHost())}),t.$on(I,function(e,t){return h.chartLegend.resetSelectedHost(t)}),t.$on(T,function(){return h.chartLegend.refreshBarCharSelectedHost()}),t.$on(N,function(e,t){F.stop(),r.get(t,"isNew")||(F.start(),h.chartLegend.selectHost(t.mac))}),h.ui={progress:0,_isLocked:!0,_isLoading:!1,lock:function(){h.ui._isLocked=!0},unlock:function(){h.ui._isLocked=!1,h.ui._isLoading=!1},isLocked:function(){return h.ui._isLocked},setIsLoading:function(){h.ui._isLoading=!0},isLoading:function(){return h.ui._isLoading}},t.$on("$destroy",i.$on("$translateChangeSuccess",function(){return H()})),t.$on(S,function(){return H()}),H()}e.$inject=["$timeout","$scope","$document","$rootScope","$window","$state","$q","_","utils","localStorage","trafficMonitorService","trafficMonitorLabels","trafficMonitorEvents","trafficMonitorSharedState","TrafficMonitorPollingHelper","barChartColors","browserCheck"],angular.module("keenetic").controller("TrafficMonitorController",e)}(),function(){function e(e,t,n,i,a,o,s,r,l,c,d,p,u){var m=this,f=o.get(l,"profile.features",{}),g=p.master.WIFI_DEFAULT_CHANNEL,v=r.translatePrefixCtor("wifi-settings"),h=u.WIFI_BAND_2_GHZ,b=u.WIFI_BAND_5_GHZ,_=u.L10N_ID_AP_SYNC_LOCK,y=u.isWep,S=u.isAnyWpaPsk,w=u.isAnyWpaEap;m.isWep=y,m.isAnyWpaPsk=S,m.isAnyWpaEap=w,m.securitySelectboxDescription="",m.__name__="WifiSettingsController",m.autoChannelOptionId=g,m.isVisible=!1,m.options=u.getConst(),m.segmentData={},m.unbindAp={},m.bindAp={},m.freeAccessPoints={},m.savePromises=[],m.ifacesData={},m.resolvedOnClose=null,m.__defer=null,m.form=null,m.busySsids=[],m.l10n={},m.wpaEap={},m.dfsTimer$=null,m.ui={apHeaderIsVisible:!1,masterHeaderIsVisible:!0,toggleIsVisible:!1,footerIsVisible:!1,bandSteeringSelectboxIsVisible:!1,roamingSectionIsVisible:!1,isPopup:!0,isLocked:!1,lock:function(){return m.ui.isLocked=!0,e.when(!0)},unlock:function(){return m.ui.isLocked=!1,e.when(!1)}};var C=function(){var e,t;m.l10n={popupHeader:"",schedule:v("form.schedule"),key:v("form.psk.label"),placeholder:{psk:v("placeholder.passkey")},header:(e={},_defineProperty(e,h,v("section-header.2")),_defineProperty(e,b,v("section-header.5")),_defineProperty(e,"both",v("section-header.both")),e),masterLabel:(t={},_defineProperty(t,h,v("general-settings-2")),_defineProperty(t,b,v("general-settings-5")),t),error:{ssidIsTooLong:r.getTranslation("errors.too-long-named",null,{name:"SSID"}),notUniqueSsid:v("validation-error.not-unique-ssid")},radiusSettingsAreEqual:v("form.radius-server.description"),dfsChannel:{title:v("form.dfs-channel"),description:v("form.dfs-description")}},m.validationData={errorMessage:o.get(m,"l10n.error.ssidIsTooLong")},m.radiusServerDescription=m.options.HAS_WIFI_5?m.l10n.radiusSettingsAreEqual:""};n.$on("$destroy",i.$on("$translateChangeSuccess",function(){return t(C)})),m.validation={isSsidUnique:function(e){return o.includes(m.busySsids,e)?m.l10n.error.notUniqueSsid:null}},m.validationData={};var E=function(){return o.get(m,"form.$setPristine",angular.noop)()},I=function(e){m.options.channelWidth=o.clone(m.widthOptionsPerChannel[e]),m.options.channelWidth=p.master.filterWidthsByStandard(m.options.channelWidth,m.master.standard,m.master.band),m.master.channelWidth&&-1!==o.map(m.options.channelWidth,"id").indexOf(m.master.channelWidth)||(m.master.channelWidth=(o.last(m.options.channelWidth)||{}).id)},T=function(e){return o.has(m.allChannelsData,[e,"dfs"])},k=function(){var e=m.dfsScanTime>0&&p.master.getDfsScanStatusMessage(m.dfsScanTime);m.dfsStatus=e&&T(m.master.channel)?'<div class="dfs-status">'.concat(e,"</div>"):""},P=function(e,t){return p.master.getOptions(e.id,t).then(function(e){m.allChannelsData=e.allChannelsData,m.widthOptionsPerChannel=e.widthOptionsPerChannel,m.options=angular.extend(m.options,{channel:e.channelOptions,standard:e.standardOptions}),m.options.channel=m.options.channel.map(function(e){var t=T(e.id);return e.details={title:"",description:""},t&&(e.labelSuffix=p.master.getDfsBadge(),e.details=m.l10n.dfsChannel),e})})};m.onChannelSelect=function(e){I(e),m.master.channelData=m.allChannelsData[e],k()},m.onCountryCodeChange=function(e){return P(m.masterIface,e).then(function(){var e=o.map(m.options.channel,"id");o.includes(e,m.master.channel)?I(m.master.channel):(m.master.channel=g,m.onChannelSelect(m.master.channel))})},m.onSecurityTypeChange=angular.noop,m.onStandardChange=function(){t(function(){m.isAxStandardSelected=u.isAxStandard(m.master.standard),I(m.master.channel)})},m.init=function(t){return C(),function(t){return(t?e.when(t):p.getAllInterfacesData(t)).then(function(e){return m.ifacesData=angular.copy(e),m.ifacesData})}(t)},m.show=function(n){var s=n.allIfacesObj,c=n.wifiBand,d=n.apIfaceId,_=n.segmentSettings,y=n.apModel,S=n.otherBandSettings,w=n.wpaEap;m.resolvedOnClose=e.defer(),m.ifacesData=s,m.isVisible=!0,m.ready=!1,m.ui.footerIsVisible=!1,m.dataSaved=!1,m.masterSettingsVisible=!1,m.segmentData=angular.copy(_),m.wifiBand=c,m.otherBandSettings=S,m.options=u.getConst(),m.wpaEap=w,m.busySsids=p.getExistingSsids(s)[c].filter(function(e){return e.id!==d}).map(function(e){return e.ssid}),c===b&&(m.bandSteeringVal=p.getBandSteeringSetting(s)),m.ui.qam256IsVisible=c===h&&f.vht2ghz,m.ui.beamformingIsVisible=u.isBeamformingSupported(c),m.ui.isDlMuMimoVisible=c===b&&m.ui.beamformingIsVisible,m.ui.airtimeFairnessIsVisible=c===b&&f.atf5ghz,m.l10n.popupHeader=r.getTranslation("segments.wifi-popup-header",null,{band:u.getAllBandsL10n(!1)[c],segment:r.getInterfaceL10n(_)});var C=!1,T=m.ifacesData.get(d);m.ap=p.ap.ifaceToModel(T),y.ssid!==m.ap.ssid&&(m.ap.ssid=y.ssid,C=!0),y.schedule!==m.ap.schedule&&(m.ap.schedule=y.schedule,C=!0),y.security&&m.ap.security!==y.security&&(m.ap.security=y.security,C=!0),m.ap.isEnabled=y.isEnabled,m.onSsidChange(m.ap.ssid);var A=m.ap.masterId,D=m.ifacesData.get(c===h?l.WIFI.BGN.STA:l.WIFI.AC.STA);return m.masterIface=m.ifacesData.get(A),m.master=p.master.ifaceToModel(m.masterIface,!D||!D.ssid&&!D.backhaul||!D.up),m.hasBackhaul=Boolean(D.backhaul),p.getAllInterfacesData().then(function(e){var t=e.get(m.master.id);m.isDfsEnabled=o.has(t,"dfs");var n=m.isDfsEnabled?'<div class="dfs-badge">DFS</div>':"";m.dfsScanTime=o.get(t,["dfs","cac"],0),m.dfsStatus="",m.dfsTimer$=a(function(){k(),m.dfsScanTime<=0&&a.cancel(m.dfsTimer$),m.dfsScanTime--},1e3),m.master.channel===g&&m.master.currentChannel!==g||m.isDfsEnabled?m.l10n.currentChannel="".concat(v("form.current-channel"),": ").concat(m.master.currentChannel).concat(n):m.l10n.currentChannel=""}),m.__defer=e.defer(),p.ap.getPin(d).then(function(e){m.ap.wpsPin=e,m.ui.footerIsVisible=C}).finally(function(){p.master.getCountryCodeOptions(m.masterIface.id).then(function(e){e.unshift({id:"",hide:!0,label:v("form.country-code-not-selected-option")}),m.options.countryCode=e}).then(function(){return P(m.masterIface,o.get(m,"masterIface.country-code.code"))}).then(function(){m.master=angular.extend(m.master,p.master.getChannelData(m.masterIface,m.allChannelsData)),m.isAxStandardSelected=u.isAxStandard(m.master.standard),I(m.master.channel)}).finally(function(){t(E),m.ready=!0,t(function(){i.$broadcast(u.events.ADVANCED_SETTINGS_POPUP_READY,m.ap.id,m.segmentData.id)}),m.__defer.resolve(m.resolvedOnClose.promise),m.__defer=null})}),m.__defer.promise};var A=function(){return o.get(m.master,"savedCfg.channel",g)};m.shouldCurrentChannelBeVisible=function(){var e=A();return String(m.master.channel)===m.autoChannelOptionId||String(m.master.currentChannel)!==e||m.isDfsEnabled&&m.dfsScanTime>0},m.onSsidChange=function(e){m.wifiBand!==h&&(m.apSyncLock=e===o.get(m,"otherBandSettings.ssid"),m.securitySelectboxDescription=m.apSyncLock?_:"")},m.save=function(){if(m.ui.isLocked)return e.when(!1);var t=["ssid","securityProtocol"],n=m.userInfo,i=angular.copy(o.get(m,"form.modifiedModels",[])),l=!1,d=e.defer();if(a.cancel(m.dfsTimer$),n.disconnected||n.type!==s.USER_CONNECTION_TYPE.WIFI||n.ap!==m.ap.id)d.resolve(!0);else{var u="access-point-used-to-connect-to-the-device-settings-changed";l=i.some(function(e){var n=e.$name.split("__");return o.includes(t,n[0])});var f=A()!==m.master.channel;if(!l&&f&&T(m.master.channel)){var g=m.otherBandSettings.ssid===m.ap.ssid&&m.otherBandSettings.isEnabled;l=!g,u=g?u:"connection-will-be-lost-due-to-a-dfs-check"}if(l){var v=r.getTranslation(u,null,{ssid:m.ap.ssidOnLoad});c.confirm(v,"continue-anyway").then(function(){return d.resolve(!0)},function(){return d.resolve(!1)})}else d.resolve(!0)}return d.promise.then(function(t){return t?(m.ui.lock(),m.apSyncLock&&(m.ap.passkey=m.otherBandSettings.passkey,m.ap.security=m.otherBandSettings.security,m.ap.wepKeys=angular.copy(m.otherBandSettings.wepKeys)),p.saveBandSettings({ap:m.ap,master:m.master,doNotSaveFt:!0,wpaEap:m.wpaEap},m.segmentData.isHomeSegment,m.wifiBand===b&&m.bandSteeringVal).finally(function(){m.ui.unlock(),m.dataSaved=!0,m.cancel()})):e.when(!1)})},m.cancel=function(){if(m.ui.isLocked)return e.when(!1);m.resolvedOnClose&&(m.resolvedOnClose.resolve({data:m.ap,saved:m.dataSaved,band:m.wifiBand}),m.resolvedOnClose=null),!m.resolvedOnClose&&m.__defer&&(m.__defer.resolve({data:m.ap,saved:m.dataSaved,band:m.wifiBand}),m.__defer=null),E(),a.cancel(m.dfsTimer$),m.isVisible=!1,m.ui.footerIsVisible=!1,m.ready=!1,m.dataSaved=!1,m.ap={},m.master={},m.ui.unlock()},m.setUserInfo=function(e){m.userInfo=e},m.onDataRenew=function(e,t){m.schedules=t},m.updateMwsBackhaulStatus=function(){return d.canExtenderSelectWifiChannel(o.get(m,"master.id")).then(function(e){o.set(m,"master.canSelectChannel",e),m.hasBackhaul=!e})}}e.$inject=["$q","$timeout","$scope","$rootScope","$interval","_","CONSTANT","utils","NDM","modal","MWSService","wifiSettingsService","wifiOptions"],angular.module("keenetic").controller("WifiSettingsController",e)}(),function(){function e(e,t,n,i,a,o,s,r,l,c,d,p,u,m,f,g,v){var h=g.getConst(),b=g.WIFI_BAND_2_GHZ,_=g.WIFI_BAND_5_GHZ,y=g.L10N_ID_AP_SYNC_LOCK,S=g.WIFI_SECURITY_PROTOCOL_OPTIONS,w=g.UNSUITABLE_FOR_ROAMING,C=g.SECURITY_PROTOCOL,E=g.HAS_WPA_EAP,I=g.isWep,T=g.isAnyWpaPsk,k=g.isAnyWpaEap,P=v.WIFI_FIELD_PREFIX,A=["ssid","passkey","schedule","enabled"],D="bandSteering",O=["ftEnabled","ftMdid","rrm"],N=["id","masterId","isVisible","isSaved","isEnabled"].concat(O),L=v.master,x=L.getWifiDisabledWarning,R=L.getDfsScanStatusMessage,M=h.HAS_WIFI_5,$=h.WIFI_TYPES,F=g.FAST_TRANSITION_MODE_OPTIONS,V={ADD_AP:s.events.SEGMENT_ADD_AP,REMOVE_AP:s.events.SEGMENT_REMOVE_AP},U=c.translatePrefixCtor("wifi-settings"),B=this;B.L10N_ID_AP_SYNC_LOCK=y,B.__name__="WifiSectionController",B.EVENTS=V,B.HAS_WIFI_5=M,B.HAS_FT=h.HAS_FT,B.l10n={},B.dfsTimer$=null,B.dfsCountdownTime=0,B.ftOptions=[],B.form=null,B.popupCtrl=null,B.options=h,B.options.security=S,B.hasBandSteering=!g.NO_BAND_STEERING,B.bandSteeringOptions=o.cloneDeep(g.WIFI_BAND_STEERING_OPTIONS),B.bandSteeringVal=!1,B.unsuitableSecurityForRoaming=o.reduce($,function(e,t){return Object.assign({},e,_defineProperty({},t,!1))},{}),B.unsuitableForRoamingBandsCount=0,B.wifiStatus={},B.shSchedules={},B.isWep=I,B.isAnyWpaPsk=T,B.isAnyWpaEap=k,B.roaming={},B.wpaEap={},B.ready=!1,B.readyEventSent=!1;B.advancedSettingsPopupIsOpened={},o.forEach($,function(e){B.advancedSettingsPopupIsOpened[e]=!1});var W=function(){o.get(B,"form.".concat(K(D),".$setPristine"),angular.noop)()},H=function(e){var t=B.apSettings[e]||{};return t.isEnabled||t.isAssigned},q=function(){var e=[F.DISABLED];if(B.apSameSettings&&B.apCount!==B.unsuitableForRoamingBandsCount&&e.push(F.ENABLED_ON_BOTH),H(b)&&!B.unsuitableSecurityForRoaming[b]&&e.push(F.ENABLED_ON_WIFI2),H(_)&&!B.unsuitableSecurityForRoaming[_]&&e.push(F.ENABLED_ON_WIFI5),B.ftOptions=c.idsToOptions(e,function(e){return"wifi-settings.form.ft-mode.options.".concat(e)}),h.HAS_FT){var t=o.get(B,"roaming.ftMode"),n=!o.includes(e,t);t&&n&&(B.roaming.ftMode=e[0])}},j=function(){var e,n=o.get(B,"bandSteeringVal")===o.get(B,"l10n.bandSteeringUnavailable");B.l10n={ssidIsTooLong:c.getTranslation("errors.too-long-named",null,{name:"SSID"}),state:{on:U("form.enabled.on"),off:U("form.enabled.off"),hwstateOff:c.getTranslation("dashboard.card_segments.wifi.wifi-disabled-by-button"),offOnSchedule:c.getTranslation("interface-state.down-on-schedule")},header:(e={},_defineProperty(e,b,U("section-header.2")),_defineProperty(e,_,U("section-header.5")),_defineProperty(e,"both",U("section-header.both")),e),error:{notUniqueSsid:U("validation-error.not-unique-ssid")},unbindAp:U("button.unbind-access-point"),schedule:U("form.schedule"),confirmUnbindAp:U("confirm.unbind-access-point"),bandSteeringUnavailable:U("form.band-steering.unavailable"),bandSteeringBottomDescription:U("form.band-steering.bottom-description"),radiusSettingsAreEqual:U("form.radius-server.description")},n&&(B.bandSteeringVal=B.l10n.bandSteeringUnavailable,t(W)),B.apSettings&&q(),B.bandSteeringOptions=o.cloneDeep(g.WIFI_BAND_STEERING_OPTIONS),B.radiusServerDescription=M?B.l10n.radiusSettingsAreEqual:""};j(),n.$on("$destroy",i.$on("$translateChangeSuccess",function(){return t(j)})),B.allIfacesData={},B.busySsids={},B.apSettings={},B.apSyncLock=_defineProperty({},_,!1),B.apCount=0,B.apSameSettings=!1,B.freeAccessPoints={},B.freeApCount=0,B.ready=!1,B.hasWifi5=M,B.segmentSettings={},B.settingsBySegment={},B.iappKeyBySegment={},B.wpaEapSettingsBySegment={};var K=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return t?[P,t,e].join("__"):[P,e].join("__")},G=function(e){return e.split("__")[1]};B.validation={isSsidUnique:function(e,t){var n=G(t),i=B.busySsids[n].slice();return B.apSettings[n].isSaved&&(i=i.filter(function(e){return e.id!==B.apSettings[n].id})),o.includes(i.map(function(e){return e.ssid}),e)?B.l10n.error.notUniqueSsid:null},checkSsidLength:f.maxLengthValidatorConstructor(32,B.l10n.ssidIsTooLong),ssid:function(e,t){return B.validation.isSsidUnique(e,t)||B.validation.checkSsidLength(e,t)||null}};var Y=function(e,t){if(2===B.apCount){var n=g.getOtherBand(t);B.apSyncLock[_]=Boolean(e&&e===o.get(B.apSettings,[n,"ssid"]))}else B.apSyncLock[_]=!1};B.onSsidChange=function(e,t){Y(e,G(t))};var z=function(){t(function(){o.get(B,"form.$setPristine",o.noop)()})},Q=function(e){A.forEach(function(t){var n=K(t,e);o.get(B,["form",n,"$setPristine"],o.noop)()})},X=function(e){return function(t){return e.apSettings[b][t]===e.apSettings[_][t]}},Z=function(e){return{segmentId:e,rrm:!1,ftMode:F.DISABLED,ftMdid:"",iappKey:B.iappKeyBySegment[e]||""}},J=function(e,t){return t?e===b?F.ENABLED_ON_WIFI2:F.ENABLED_ON_WIFI5:F.DISABLED},ee=function(e,t){var n=X(e),i=Z(t);if(e.apCount>0)if(i.iappKey=o.get(e,"roaming.iappKey")||i.iappKey,1===e.apCount){var a=!M||e.apSettings[b].isAssigned?b:_;O.forEach(function(t){i[t]=e.apSettings[a][t]}),i.ftMode=J(a,e.apSettings[a].ftEnabled)}else{var s;n("ftEnabled")?(s=b,i.ftMode=e.apSettings[b].ftEnabled?F.ENABLED_ON_BOTH:F.DISABLED):(s=e.apSettings[b].ftEnabled?b:_,i.ftMode=J(s,!0)),O.forEach(function(t){i[t]=e.apSettings[s][t]})}return i},te=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=X(e);return M&&2===e.apCount&&i("ssid")&&i("passkey")&&i("schedule")?(e.apSettings[5].isVisible=!1,e.apSameSettings=!0,t&&(e.bandSteeringVal=v.getBandSteeringSetting(B.allIfacesData))):(e.apSameSettings=!1,e.bandSteeringVal=B.l10n.bandSteeringUnavailable),n||(e.roaming=ee(e,e.segmentId),o.forEach(e.apSettings,function(e,t){de(e.security,t)})),e},ne=function(e,t){B.settingsBySegment[e]={apCount:B.apCount,apSameSettings:B.apSameSettings,apSettings:angular.copy(B.apSettings),bandSteeringVal:t,roaming:angular.copy(B.roaming),wpaEap:angular.copy(B.wpaEap)}};B.filterSegmentTabData=function(e){var t={};return["id","description"].forEach(function(n){t[n]=angular.copy(e[n])}),["isNew","isHomeSegment","isGuestSegment"].forEach(function(n){t[n]=Boolean(e[n])}),t};var ie=function(){return{ssid:"",ssidOnLoad:"",passkey:"",securityOnInit:C.DISABLED,isEnabled:!1,isSaved:!1,isVisible:!0,isAssigned:!1,wasEnabled:!1}},ae=function(e){var t={apCount:0,apSettings:{},apSameSettings:!1,bandSteeringVal:B.l10n.bandSteeringUnavailable,roaming:Z(e),wpaEap:v.getDefaultWpaEapSectionSettings(e)};return $.forEach(function(e){t.apSettings[e]=ie()}),angular.copy(t)};B.toggleApState=function(n,i){var a=G(i),s=B.apSettings[a];if(s.isAssigned){var r=e.defer();if(n)B.apSettings[a].wasEnabled=!0,r.resolve(!0);else{var l=B.userInfo;l.disconnected||"wifi"!==l.type||s.id!==l.ap?r.resolve(!0):s.id===l.ap&&d.confirm("access-point-is-used to connect-to-the-device","continue-anyway").then(function(){return r.resolve(!0)},function(){return r.resolve(!1)})}return r.promise.then(function(i){if(i){var r=n?u.toggleState(B.segmentId,!0):e.when(!0);return s.isSaved&&s.ssid?r.then(function(e){var i=u.getIpConflictErrorData(e);if(!i)return u.toggleState(B.apSettings[a].id,n).then(function(){ne(B.segmentSettings.id,B.bandSteeringVal)});var s=o.mapValues(i,B.getInterfaceLabel),r=c.getTranslation("notifications.toggle-failed-ip-conflict-error",null,s);p.error(r),t(function(){B.apSettings[a].isEnabled=!n})}):void 0}t(function(){B.apSettings[a].isEnabled=!n})})}if(n&&!s.id){var m=o.get(B,"roaming.ftMode");return B.addFreeApToSegment(a).then(function(){B.roaming=ee(B,B.segmentSettings.id),B.roaming.ftMode=m,q()})}var f=!!M&&B.apSameSettings;$.slice().filter(function(e){return e!==a}).forEach(function(e){B.apSettings[e].isAssigned&&!B.apSettings[e].isSaved&&(f=!0)}),B.setModified(f),Q(a),ne(B.segmentSettings.id,B.l10n.bandSteeringUnavailable),B.roaming=ee(B,B.segmentSettings.id),q()};var oe=function(e){if(e.saved){var n=e.band;B.apSettings[n].isSaved||B.apCount++,o.forEach(e.data,function(e,t){B.apSettings[n][t]=e,B.apSettings[n].isSaved=!0,B.apSettings[n].isVisible=!0}),B.apSettings[n].passkey=v.ap.modelGetPasskey(e.data),B.form&&t(function(){Q(n),(B=te(B,!0)).settingsBySegment[B.segmentSettings.id].apSameSettings=B.apSameSettings}),Y(B.apSettings[n].ssid,n),(B=te(B,!0)).roaming=ee(B,B.segmentSettings.id),q();var i=!1;return-1===B.ftOptions.map(function(e){return e.id}).indexOf(B.roaming.ftMode)&&(i=B.apSettings[b].isSaved?F.ENABLED_ON_WIFI2:F.ENABLED_ON_WIFI5),B.apSameSettings?B.bandSteeringVal=B.settingsBySegment[B.segmentSettings.id].bandSteeringVal:B.bandSteeringVal=B.l10n.bandSteeringUnavailable,ne(B.segmentSettings.id,B.bandSteeringVal),t(z),B.renewAllIfacesData().then(B.renewFreeAccessPointLists).finally(function(){B.updateWifiStatus(!0).then(re),i&&(B.roaming.ftMode=i)})}};B.getApIfaceIds=function(){var e=[];return $.forEach(function(t){B.apSettings[t]&&B.apSettings[t].ssid&&e.push(B.apSettings[t].id)}),e},B.removeAp=function(t){var n=B.apSettings[t].id;d.confirm(B.l10n.confirmUnbindAp).then(function(){var a=e.when(!0);return B.segmentSettings.isNew||(a=v.resetAp(n).then(function(){return B.apSettings[t].isAssigned?v.excludeAp(n,B.getActiveSegment()):e.when(!0)})),a.then(function(){B.apSettings[t]=ie(),M&&t===b&&B.apSameSettings&&(B.apSettings[_].isVisible=!0);var e,a=!1;$.slice().filter(function(e){return e!==t}).forEach(function(e){B.apSettings[e].isAssigned&&!B.apSettings[e].isSaved&&(a=!0)}),B.setModified(a),B.apSameSettings=!1,B.apSyncLock[_]=!1,B.freeApCount++,B.apCount--,B.freeAccessPoints[t].unshift(n),B.unsuitableSecurityForRoaming[t]=!0,B.unsuitableForRoamingBandsCount=o.filter(B.unsuitableSecurityForRoaming).length,B.roaming=ee(B,B.segmentSettings.id),q(),Q(t),B=te(B,!0),ne(B.segmentSettings.id,B.l10n.bandSteeringUnavailable),i.$broadcast(B.EVENTS.REMOVE_AP,n),B.HAS_FT&&(e=K("ftMode"),o.get(B,["form",e,"$touched"])||o.get(B,["form",e,"$setPristine"],angular.noop)())})})},B.editApSettings=function(e,t){B.advancedSettingsPopupIsOpened[t]=!0;var n=B,i=n.wpaEap,a=n.segmentSettings,o=B.apSettings[t],s=2===B.apCount?B.apSettings[g.getOtherBand(t)]:null;return B.popupCtrl.show({allIfacesObj:B.allIfacesData,wifiBand:t,apIfaceId:e,segmentSettings:a,apModel:o,otherBandSettings:s,wpaEap:i}).then(oe).finally(function(){B.advancedSettingsPopupIsOpened[t]=!1})},B.goToApSettingsState=function(t){return B.advancedSettingsPopupIsOpened[t]?e.when(!1):a.go("controlPanel.segments.WiFi",{band:t,tab:B.segmentSettings.description})},B.onLinkKeydown=function(e,t,n,i){if(!m.isSpace(e)||t)return!0;e.preventDefault(),B.editApSettings(n,i)};var se=function(e){var t,n=B.l10n.state;e.isDisabledOnSchedule=e.isEnabled&&!(!(t=e.savedSchedule)||!B.shSchedules[t]||l.isActive(B.shSchedules[t])),e.isDisabledForDfsCheck=e.masterId===r.MASTER_5G&&B.dfsCountdownTime>0,B.wifiStatus.hwstate?e.isDisabledOnSchedule?e.toggleOnText=n.offOnSchedule:e.isDisabledForDfsCheck?e.toggleOnText=x()+R(B.dfsCountdownTime):e.toggleOnText=n.on:e.toggleOnText=n.hwstateOff},re=function(){return o.forEach(B.apSettings,se)},le=function e(){if(B.dfsCountdownTime<=0)return t.cancel(B.dfsTimer$),void(B.dfsTimer$=null);B.dfsCountdownTime--,re(),B.dfsTimer$=t(e,1e3)};B.updateScheduleInfo=function(e){B.shSchedules=e,re()},B.addFreeApToSegment=function(t){var n=B.freeAccessPoints[t].shift();if(!n)return!1;B.freeApCount--;var a=null,o=g.getOtherBand(t);return M&&0!==B.apCount&&B.apSettings[o].isAssigned?((a=angular.copy(B.apSettings[o])).id=n,a.masterId=n.split("/")[0],a.isVisible=t===b,B.apSameSettings=!0,t===b&&(B.apSettings[_].isVisible=!1),B.bandSteeringVal=v.getBandSteeringSetting(B.allIfacesData)):((a=v.ap.dummyModel(B.allIfacesData.get(n))).isVisible=!0,B.apSameSettings=!1,B.bandSteeringVal=B.l10n.bandSteeringUnavailable),B.apSettings[t]=a,a.isSaved=!1,a.isEnabled=!0,a.isAssigned=!1,se(a),B.segmentSettings.isNew||B.setModified(!0),a.wasEnabled=!0,e.when(!0).then(function(){B.apCount++,ne(B.segmentSettings.id,B.bandSteeringVal),Y("",t),i.$broadcast(B.EVENTS.ADD_AP,n)})},B.renewFreeAccessPointLists=function(){return B.freeAccessPoints=v.getFreeAccessPoints(B.allIfacesData),B.freeApCount=0,$.forEach(function(e){B.freeApCount+=B.freeAccessPoints[e].length}),e.when(!0)},B.renewAllIfacesData=function(t){return(Boolean(t)&&angular.isFunction(t.get)?e.when(t):v.getAllInterfacesData()).then(function(e){B.allIfacesData=angular.copy(e),B.busySsids=v.getExistingSsids(e)})};var ce=function(e){["apSettings","apCount","apSameSettings","bandSteeringVal","roaming","segmentId","wpaEap"].forEach(function(t){B[t]=angular.copy(e[t])}),o.forEach(B.apSettings,function(e,t){se(e),de(e.security||e.securityOnInit,t)}),q(),Y(o.get(B,"apSettings.".concat(_,".ssid")),_),t(function(){z(),B.ready=!0,B.readyEventSent||(t(function(){i.$broadcast(s.events.SEGMENT_WIFI_SECTION_READY)}),B.readyEventSent=!0)})},de=function(e,t){if(B.unsuitableSecurityForRoaming[t]=o.includes(w,e),B.apSameSettings){var n=g.getOtherBand(t);B.unsuitableSecurityForRoaming[n]=B.unsuitableSecurityForRoaming[t]}B.unsuitableForRoamingBandsCount=o.filter(B.unsuitableSecurityForRoaming).length,h.HAS_FT&&q()};B.onSecurityTypeChange=function(e,t,n){var i=G(n);de(e,i)},B.shouldAdvancedSettingsBeLocked=function(e){if(e===b||!B.apSameSettings)return!1;var t=g.getOtherBand(e);return o.get(B,["form","apSettings",t,"modified"])};var pe=function(e){var t={},n=v.getSegmentAccessPoints(B.allIfacesData,e);if(0===n.count)return ae(e);$.forEach(function(e){if(n[e]){var i=v.ap.ifaceToModel(n[e]);if(i.isSaved=!0,i.isVisible=!0,i.isAssigned=!0,i.wasEnabled=i.isEnabled,se(i),t[e]=i,!E&&o.includes(t[e].securityOnInit,"eap")){var a=o.includes(t[e].securityOnInit,"wpa3")?C.WPA3:C.WPA2;t[e].security=a,t[e].securityOnInit=a}}else t[e]={isAssigned:!1,isVisible:!1,isSaved:!1}});var i={segmentId:e,apCount:n.count,apSameSettings:!1,apSettings:t,bandSteeringVal:B.l10n.bandSteeringUnavailable,wpaEap:B.wpaEapSettingsBySegment[e]};return te(i,!0)};B.onReset=function(n){if(n.isNew){var i=[];return $.forEach(function(e){var t=B.apSettings[e].id;t&&(i.push(v.queryConstructor.resetAp(t)),B.freeApCount++,B.apCount--,B.freeAccessPoints[e].unshift(t))}),delete B.settingsBySegment[n.id],i.length>0?e.all(i):e.when(!0)}var a=n.iseg.include.split(",").filter(angular.identity),s=!1,r=e.defer(),l=[];$.forEach(function(e){var t=o.get(B,["apSettings",e,"id"]);t&&(-1===a.indexOf(t)?(B.apSettings[e].isSaved&&l.push(v.resetAp(B.apSettings[e].id)),B.apSettings[e]=ie(),B.freeApCount++,B.apCount--,B.freeAccessPoints[e].unshift(t),s=!0):B.apSettings[e]=B.settingsBySegment[B.segmentSettings.id].apSettings[e],B=te(B,!0),q(),ne(B.segmentSettings.id,B.bandSteeringVal),e===_&&Y(o.get(B,["apSettings",e,"ssidOnLoad"]),e),Q(e))});return s?(l.length>0?e.all(l):e.when(!0)).then(function(){t(function(){B=te(B,!0),z(),B.setModified(!1),r.resolve(!0)})}):r.resolve(!0),r.promise},B.onTabChange=function(t){B.segmentSettings=B.filterSegmentTabData(angular.copy(t));var n=B.segmentSettings.id;B.segmentSettings.isNew?(B.settingsBySegment[n]||(B.settingsBySegment[n]=ae(n)),ce(B.settingsBySegment[n])):(B.settingsBySegment[n]?e.when(B.settingsBySegment[n]):B.renewAllIfacesData().then(B.renewFreeAccessPointLists).then(function(){return B.settingsBySegment[n]=pe(n),B.settingsBySegment[n]})).then(ce)},B.onTabDelete=function(t){var n=[],i=e.when(!0);return o.forEach(B.apSettings,function(e){e.isAssigned&&n.push(e.id)}),(i=n.length>0?v.resetAp.apply(v,n):i).finally(function(){return B.settingsBySegment[t]&&delete B.settingsBySegment[t],B.renewAllIfacesData().then(B.renewFreeAccessPointLists)})},B.checkIfApSettingsChanged=function(e){var t=o.chain(B.apSettings).pickBy(function(e){return e.isSaved&&e.ssid}).map("id").value();if(!t.includes(e))return!1;var n=c.getFormModifiedModels(B.form),i=e.startsWith(r.MASTER)?b:_;return n.some(function(n){var a=o.get(n,"$name","");if(!a.startsWith(P))return!1;if(["schedule",D].some(function(e){return a.includes(e)}))return!1;var s=G(a);return!isNaN(Number(s))&&s===i||B.apSameSettings&&o.includes(t,e)})},B.save=function(){var n,i,a,s=[],r={bandSteering:!1};o.get(B,"form.modifiedModels",[]).forEach(function(e){var t=e.$name;if(t&&0===t.indexOf(P)){if(-1!==t.indexOf(D))return void(r.bandSteering=!0);var n=G(t);isNaN(Number(n))||(r[n]=!0)}}),M&&(B.apSameSettings?(n=b,i=_,a=B.apSettings[n],Object.keys(a).filter(function(e){return-1===N.indexOf(e)}).forEach(function(e){B.apSettings[i][e]=angular.copy(a[e])})):2===B.apCount&&B.apSyncLock[_]&&function(e,t){var n=B.apSettings[e];["ssid","passkey","psk","wepKeys","security"].forEach(function(e){B.apSettings[t][e]=angular.copy(n[e])})}(b,_));var l={};return B.unsuitableForRoamingBandsCount===B.apCount&&(B.roaming.ftMode=F.DISABLED),$.forEach(function(e){B.apSettings[e].ssid&&(l[e]={ap:o.extend(B.apSettings[e],function(e,t){var n={ftEnabled:!0,ftMdid:e.ftMdid,rrm:e.rrm},i={ftEnabled:!1,ftMdid:!1,rrm:e.rrm};switch(e.ftMode){case F.ENABLED_ON_BOTH:return n;case F.ENABLED_ON_WIFI2:return t===_?i:n;case F.ENABLED_ON_WIFI5:return t===b?i:n;case F.DISABLED:default:return i}}(B.roaming,e)),segment:B.segmentSettings},B.apSettings[e].isSaved=!0)}),s.push(v.saveAll(l,!!(B.hasBandSteering&&r.bandSteering&&M&&B.apSameSettings)&&B.bandSteeringVal,B.roaming,B.wpaEap)),(s.length>0?e.all(s):e.when(!0)).then(function(){$.forEach(function(e){B.apSettings[e].isSaved&&(B.apSettings[e].isAssigned=!0)}),B=te(B,!r.bandSteering,!0),t(W),ne(B.segmentSettings.id,B.bandSteeringVal)}).then(B.renewAllIfacesData).then(B.renewFreeAccessPointLists).finally(function(){B.apSettings=o.mapValues(B.apSettings,function(e){return e.savedSchedule=e.schedule,e}),B.setModified(!1),B.setFormPristine()})},B.setFormCtrl=function(e){B.form=e},B.setPopupCtrl=function(e){B.popupCtrl=e},B.setUserInfo=function(e){B.userInfo=e},B.updateWifiStatus=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return v.getWifiStatus(e).then(function(e){B.wifiStatus=e,B.wifiStatus.dfsTime>0&&!B.dfsTimer$?(B.dfsCountdownTime=B.wifiStatus.dfsTime,B.dfsTimer$=t(le,1e3)):B.wifiStatus.dfsTime<=0&&B.dfsTimer$&&(t.cancel(B.dfsTimer$),B.dfsCountdownTime=0,B.dfsTimer$=null)})},B.init=function(e,t){return B.renewAllIfacesData(e).then(B.renewFreeAccessPointLists).then(function(){j(),(t||[]).forEach(function(e){var t=e.id,n=B.allIfacesData.get(t);B.wpaEapSettingsBySegment[t]=v.getWpaEapSectionSettings(n,t),B.iappKeyBySegment[t]=o.get(n,"iapp.key",""),B.settingsBySegment[t]=pe(t)}),B.updateWifiStatus()})}}e.$inject=["$q","$timeout","$scope","$rootScope","$state","_","CONSTANT","NDM","schedules","utils","modal","notification","interfaces","keyboard","ValidatorManager","wifiOptions","wifiSettingsService"],angular.module("keenetic").controller("WifiSectionController",e)}(),function(){function e(e,t,n,i,a,o,s,r,l,c,d,p,u,m,f,g){var v={mask:r.DEFAULT_NETMASK,igmpProtocol:"auto"},h={no:!0},b=a.saveQueryStr().data,_=s.sysmode===r.SYSMODE.ROUTER,y=Boolean(l.igmp),S=Boolean(l.pppoe),w=Boolean(l.trafficcontrol),C=Boolean(l.dhcpd),E=Boolean(l.corewireless),I=["tx-queue","last-change","last-overflow"],T=angular.copy(s.PORTS_MAP),k={TRUNK:"trunk",ACCESS:"access",EXCLUDED:"excluded"},P={SERVER:"server",RELAY:"relay",OFF:"off"},A=s.LAN_DHCP_POOL_NAME,D=20,O=25200,N={},L=function(){N={portMode:{},dhcpMode:{},igmpAuto:"segments.igmp-auto"},[k.EXCLUDED,k.ACCESS,k.TRUNK].forEach(function(e){N.portMode[e]="segments.port-mode.".concat(e)}),[P.SERVER,P.OFF,P.RELAY].forEach(function(e){N.dhcpMode[e]="segments.form.dhcp-mode.mode.".concat(e)})};t.$on("$translateChangeSuccess",function(){return n(L)}),L();var x=function(e){return e.split(",").filter(angular.identity)},R=function(e,t,n){var a=D,o=e.range||{},s=t?u.num2ip(u.ip2num(t)+1):"";if(t&&n){var r=t&u.ip2num(n),l=u.invertMask(n),c=(t|u.ip2num(l))^r;a=c>=a?a:c-1,(!o.size||Number(o.size)>a)&&(o.size=a)}return o.begin=o.begin||s||"",{range:o,lease:String(e.lease||O),gateway:i.get(e,"default-router.address",""),dnsServer1:i.get(e,"dns-server.address1",""),dnsServer2:i.get(e,"dns-server.address2","")}},M=function(e){return A+"_"+(e.rename||e.id).toUpperCase().replace(" ","_")},$=function(e,t,n){var a,o=[],s=e.segmentIfaces.slice(),r=s.indexOf(t),l=e.segmentAliases[t],c=e.lanIfaces.map(function(e){return{interface:e}});n?s=s.map(function(e){return{interface:e,no:e===l}}):(-1===r&&s.push(l||t),s=s.map(function(e){return{interface:e}})),s.unshift(h),s=s.concat(c);var d=n&&2===s.length;return n||e.enabled?d&&o.push(i.set({},"service.dhcp-relay",!1)):o.push(i.set({},"service.dhcp-relay",!0)),a={lan:s,wan:e.wanIface&&"__NO_DHCP_RELAY_WAN__"!==e.wanIface?[h,{interface:e.wanIface}]:h},e.address?a.server={address:e.address}:a.server=[h],d&&(a.server=[h],a.wan=[h]),o.unshift(i.set({},"ip.dhcp.relay",a)),o},F=function(e,t){var n,a=e.dhcp;if(t||!a.enabled){if(e.isNew||!a.exists)return{};n={name:a.poolName,no:!0}}else{if(n={name:a.poolName,bind:{interface:e.id},enable:a.enabled,lease:a.lease,range:{begin:a.range.begin,size:Number(a.range.size)}},a.dnsServer1||a.dnsServer2){var o=[a.dnsServer1,a.dnsServer2].filter(angular.identity);1===o.length?n["dns-server"]={address1:o[0]}:2===o.length&&(n["dns-server"]={address1:o[0],address2:o[1]})}else n["dns-server"]=h;n["default-router"]=a.gateway?{address:a.gateway}:h}return i.set({},"ip.dhcp.pool",n)},V=function(e,t,n){return e.isNew&&!e.natEnabled?{}:t&&n&&n.every(function(t){return t.interface!==e.rename})?{}:{ip:{nat:{no:!e.natEnabled||Boolean(t),interface:e.id}}}},U=function(){return i.set({},["interface",s.CHILLI_IFACE],{up:!1,description:h,chilli:{dhcpif:h}})},B=function(e){return i.set({},"service.igmp-proxy",{no:!e})},W=function(e,t,n){var a=[],o=[],r="";return i.forEach(e,function(e,n){if(n!==s.WAN_PORT||!s.HAS_TWO_SWITCHES||"dsl"!==e.type){var i=T[n].port;e.value===k.ACCESS?a.push(i):e.value===k.TRUNK&&(a.push(i),o.push(i),r=t)}}),a.sort(),o.sort(),{include:n.join(","),port:a.join(","),vlan:r,"vlan-port":o.join(",")}},H={width:14,height:14},q={mask:o.idsToOptions(u.getMasksArray().filter(function(e){return!{"255.255.255.255":!0,"255.255.255.254":!0}[e]}),angular.identity),igmpProtocol:[{id:"auto",label:N.igmpAuto},{id:"igmp-v2",label:"IGMPv2"},{id:"igmp-v1",label:"IGMPv1"}],portMode:[{id:k.EXCLUDED,label:"segments.port-mode.".concat(k.EXCLUDED),icon:"port-mode-excluded",iconDimensions:H},{id:k.ACCESS,label:"segments.port-mode.".concat(k.ACCESS),icon:"port-mode-access",iconDimensions:H},{id:k.TRUNK,label:"segments.port-mode.".concat(k.TRUNK),icon:"port-mode-trunk",iconDimensions:H}],dhcpMode:[]};[P.SERVER,P.OFF,P.RELAY].forEach(function(e){q.dhcpMode.push({id:e,name:N.dhcpMode[e]})});var j=function(e){return[{role:e}]},K=function(e,t){var n=x(e["inet-port"]),i=x(e["iptv-port"]),a=x(e["voip-port"]);return n.includes(t.port)?j(r.INTERFACE_ROLE.INET):i.includes(t.port)?j(r.INTERFACE_ROLE.IPTV):!!a.includes(t.port)&&j(r.INTERFACE_ROLE.VOIP)};return{getInitialData:function(){var e={show:{interface:{}}},t={interface:[{}],service:{},schedule:{}};if(_){C&&i.set(t,"ip.dhcp",{}),i.set(t,"ip.nat",{}),S&&i.set(t,"pppoe.pass",{}),y&&i.set(t,"igmp-proxy",{});var n=p.getParentDslInterfaceId();n&&t.interface.push({ipvc:{parent:n}}),i.set(t,"ip.policy",{}),i.set(t,"ip.hotspot.default-policy",{}),i.set(t,"ip.hotspot.policy",{})}return e.show.rc=t,a.post({url:"",data:e}).then(function(e){var t,n=e.show,a=n.interface,l=n.rc,p=i.get(l,"interface.0.interface",{}),u=i.get(l,"interface.1.ipvc",{}),m=l["igmp-proxy"],f=a[s.LAN].id,g={},h={},b={},w=s.AP.concat(s.AP_5G),E=[],T=[],k=i.get(p[f],"iseg.busy-vlan",""),P=x(k),A=c.getInterfaceIdToDescriptionMap(n.interface);P.unshift(String(s.LAN_VID)),T.push({id:"__NO_DHCP_RELAY_WAN__",label:"segments.form.dhcp-relay.no-wan-specified"});var D={interface:angular.copy(p),"show interface":angular.copy(n.interface)};i.forEach(a,function(e,n){e.channel&&(e.currentChannel=e.channel);var i=e.description,a=angular.extend({},e,p[e.id]||{});if(I.forEach(function(e){delete a[e]}),h[n]=a,b[e.id]=n,a.iseg&&(0===E.length&&(E=x(a.iseg["free-port"])),g[n]=a),a.igmp&&a.igmp.upstream&&(t=a.id),e.mac&&!e.group){i=g[n]?o.getInterfaceL10n(a):i?[i," (",n,")"].join(""):n;var s=e.id;T.push({id:s,label:A[s]||i||s})}});var O=c.getInterfaceOptions(h),N={};if(C){var L=i.get(l,"ip.dhcp.relay",{}),R=i.get(L,"wan.interface","__NO_DHCP_RELAY_WAN__"),M=i.findKey(b,function(e){return e===R})||R,$={},F=[],V=[];(i.isEmpty(L.lan)?[]:L.lan).map(function(e){return e.interface}).forEach(function(e){if(g[e])V.push(e),$[g[e].id]=e;else if(g[b[e]]){var t=b[e];V.push(t),$[e]=t}else F.push(e)});var U=i.get(L,"server.address","");N={wanIface:M,wanIfaceOnLoad:M,wanOptions:T,lanIfaces:F,segmentIfaces:V,segmentAliases:$,configurable:!0,enabled:i.get(l,"service.dhcp-relay",!1),address:U,addressOnLoad:U}}var B={},W=function(e){return-1!==w.indexOf(e.id)},H=function(e){var t=e["security-level"];return t&&("public"===t||angular.isObject(t)&&t.public)};if(_&&y){var j=i.filter(h,function(e){return(!e.role||c.hasRole(e,r.INTERFACE_ROLE.INET)||c.hasRole(e,r.INTERFACE_ROLE.IPTV))&&!W(e)&&angular.isDefined(e["security-level"])&&H(e)&&!e.group&&e.id!==s.CHILLI_IFACE}).map(function(e){return e.id});(B={protocol:{options:q.igmpProtocol,value:i.get(m,"force.protocol",v.igmpProtocol)},iface:{options:O.filter(function(e){var t=e.id;return i.includes(j,t)})}}).downstreamIfaceIds=i.filter(h,function(e){return i.get(e,"igmp.downstream[0].enabled")}).map(function(e){return e.id}),B.upstreamNotConfigurable=!1,t?B.iface.value=t:(0===B.iface.options.length&&(B.iface.options=[{id:"-",label:"-"}],B.upstreamNotConfigurable=!0),B.iface.value=B.iface.options[0].id),B.isEnabled=i.get(l,"service.igmp-proxy",!1),B.upstreamIfaceSelected=Boolean(t)}var K={};if(_&&S){var G=i.get(l,"pppoe.pass.wan-iface"),Y=i.chain(h).filter(function(e){return!e.role||c.hasRole(e,r.INTERFACE_ROLE.INET)}).filter(function(e){return angular.isDefined(e.global)&&!W(e)}).filter(function(e){return t=e,!(-1!==[s.STA,s.STA_5G].indexOf(t.id))||Boolean(e.ssid);var t}).filter(function(e){return angular.isDefined(e["security-level"])&&H(e)}).filter(function(e){return e.id!==s.CHILLI_IFACE}).filter(function(e){return i.has(e,"mac")}).map(function(e){return e.id}).value(),z=(K={wan:{options:O.filter(function(e){var t=e.id;return i.includes(Y,t)}),value:G&&a[G].id||"",notConfigurable:!1},lan:i.get(l,"pppoe.pass.lan-iface")}).wan;z.options.length||(z.notConfigurable=!0),!z.value&&z.options.length&&(z.value=z.options[0].id)}var Q=i.get(l,"ip.nat");Q&&!i.isEmpty(Q)||(Q=[]),Q=Q.filter(function(e){return i.has(e,"interface")});var X=i.get(l,"ip.hotspot.policy",{}),Z=i.get(l,"ip.hotspot.default-policy",{}),J=i.isEmpty(Z)?d.constants.DEFAULT_PERMIT_POLICY:Z.access||Z.policy,ee={};return i.forEach(g,function(e){ee[e.id]=J}),i.forEach(X,function(e){var t=e.interface;if(!ee[t]){if(!g[t])return;t=g[t].id}ee[t]=e.policy||e.access}),{labelByIfaceId:c.getInterfaceIdToLabelMap(n.interface),segments:g,nat:Q,dhcp:i.get(l,"ip.dhcp.pool",{}),dhcpRelay:N,igmp:B,pppoePassThrough:K,busyVlans:P,schedules:l.schedule||{},policyData:{defaultPolicy:J,segmentPolicies:ee,ipPolicy:i.get(l,"ip.policy",{}),interface:p||{}},interfaces:{ipvcConfig:u,config:h,alias:b,raw:D,get:function(e){return this.config[e]||this.config[this.alias[e]]||!1},getByType:function(e){return i.pickBy(h,function(t){return t.type===e})},getNextFreeName:function(e){var t=[];return i.forEach(this.getByType(e),function(e){t.push(e.id.replace(/[^\d]/g,"")-0)}),e+String(o.firstUnusedId(t))}}}})},segment:{save:function(e,t,n,r,l,c,p,u){var I=[],T=!1,k=[],A={},D={},O=function(e,t,n){if(n)return h;var i={description:e.description};return(e.isHomeSegment||e.isGuestSegment)&&e.description===o.getTranslation("interface-translations."+(e.isHomeSegment?s.LAN:s.GUEST))&&(i.description=e.isHomeSegment?s.LAN_DESCRIPTION:s.GUEST_DESCRIPTION),_&&(w&&!e.isHomeSegment&&(i["traffic-shape"]=f.getRciQueryObjectFromModel(e.speedLimit,{checkIsEnabled:!1})),e.ip.address&&!e.controlledByChilli&&(i.ip={address:{address:e.ip.address,mask:e.ip.mask}}),i["security-level"]=e.systemAccess?{private:!0}:{protected:!0},y&&(i.igmp={downstream:{no:!e.igmpEnabled}})),E&&e.include.length>0&&(i["peer-isolation"]={no:!e.peerIsolation}),i}(t,e.get(t.id),!1);if(_){var N=!t.controlledByChilli&&C,L=!1;if(C)switch(t.dhcpMode){case P.RELAY:(t.isNew||t.dhcpModeOnLoad===P.SERVER)&&(L=!0),k=$(c,t.id,!1);break;case P.OFF:case P.SERVER:t.dhcp.enabled=t.dhcpMode===P.SERVER,t.dhcpModeOnLoad!==P.SERVER||t.dhcp.enabled||(L=!0),t.isNew||t.dhcpModeOnLoad!==P.RELAY||(k=$(c,t.id,!0))}var x={};y&&(!n.isEnabled&&t.igmpEnabled?x=B(!0):t.igmpEnabled||0!==n.downstreamIfaceIds.filter(function(e){return e!==t.id}).length||(x=B(!1)),T=function(e){if(!y)return{};var t=e.protocol.value;return i.set({},"igmp-proxy.force",t===v.igmpProtocol?h:{protocol:t})}(n)),D=angular.merge(D,x,function(e){return!y||e.upstreamNotConfigurable?{}:i.set({},["interface",e.iface.value,"igmp"],{upstream:!0})}(n),function(e){if(!S)return{};var t={pppoe:{pass:{}}};return e.enabled||!e.isNew&&e.lanPrev&&e.lanPrev!==e.lan?t.pppoe.pass={"wan-iface":e.wan.value,"lan-iface":e.lan}:t.pppoe.pass=h,t}(r),N?F(t,L):{},t.controlledByChilli?{}:V(t))}else if(!s.DEVICE_IS_MWS_MEMBER){var R=m.getSavingQuery(angular.copy(t.ipModel),t.id,{noIpv6:!0}),M=R.interface[t.id],H=M.ip;if(!t.isNew){var q=i.get(t,"raw.ip.dhcp");q&&(H.dhcp=q)}if(t.isHomeSegment&&i.has(t,"raw.ip.address.address")&&t.ipModel.mode===m.IP_CONFIG_MODE.AUTO){var j=i.get(t,"raw.ip.address",{}),K=j.address,G=j.mask;M.ip={dhcp:!0,address:K,mask:G}}delete H.tcp,delete H.mtu,delete H.global,delete M.ipv6,H.address.no&&delete H.address.no,D=angular.merge(D,R)}return l=l.map(Number),i.forEach(t.otherSegmentsSwitchports,function(t){var n,a;if(t.isNew)n=o.firstUnusedId(l),a=W(t.switchports,n,t.include),D=angular.merge(D,i.set({},["interface",t.id,"security-level","protected"],!0)),I.push(i.set({},["interface",t.id],{iseg:a})),A[t.id]=a;else{var s=e.get(t.id),r=s.iseg;n=r.vlan||function(e){if(e.iseg&&e.iseg.vlan)return e.iseg.vlan;var t=i.get(e,"inherit.interface","");if(t)return t.split("/Vlan")[1];for(var n=e.include,a=0,o=n.length;a<o;++a){var s=n[a].interface;if(s.indexOf("/Vlan")>-1)return s.split("/Vlan")[1]}return!1}(s)||o.firstUnusedId(l),a=W(t.switchports,n,t.include),delete r["busy-vlan"],delete r["free-port"],angular.equals(r,a)||(D=angular.merge(D,i.set({},["interface",t.id],{iseg:a})),A[t.id]=a)}}),O.iseg=W(t.switchports,t.vlanId,t.include),D=angular.merge(D,i.set({},["interface",t.id],O)),A[t.id]=O.iseg,I.unshift(D),T&&!i.isEmpty(T)&&I.unshift(T),p&&_&&I.push(p.enabled?g.formDataToRawData(p,u&&t.ip,t.id):U()),k.length>0&&(I=I.concat(k)),_&&I.push(d.queryCtor.setSegmentPolicy(t.policy,{id:t.id})),I.push(b),a.post({url:"",data:I}).then(function(){return A})},remove:function(e,t,n,o,s){var r=[],l=angular.merge({},i.set({},["interface",t.id,"iseg"],h));return _&&(C&&t.dhcpModeOnLoad===P.RELAY&&(r=$(o,t.id,!0)),l=angular.merge(l,C?F(t,!0):{},t.controlledByChilli?U():V(t,!0,n)),y&&0===s.downstreamIfaceIds.filter(function(e){return e!==t.id}).length&&(l=angular.merge(l,B(!1)))),a.post({url:"",data:[l].concat(r).concat([b])})},getPorts:function(e,t,n){var a=i.pickBy(e.config,function(e){return e.iseg}),o=i.map(a,function(e,t){return Object.assign({},e.iseg,{id:t})}),l=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return i.mapValues(T,function(a,o){var l=a.port,c=e.get(l);if(i.includes(n,l))return{value:k.EXCLUDED,ifaceId:t.id,state:c.up};var d=e.ipvcConfig||{},u=i.findKey(d,function(e){return i.includes(e.port,l)});if(u){var m=d[u];return{ifor:m.bridge||u,roles:[{role:m.role}],noRoleIcon:!0}}var f=e.config;for(var g in f){var v=f[g],h=v.ipoe;if(h){var b=c.up,_=v.id,y=K(h,a);if(y)return{roles:y,state:b,ifor:_}}}return o===s.WAN_PORT&&"dsl"===a.type?{roles:j(r.INTERFACE_ROLE.INET),ifor:p.getParentDslInterfaceId(),noRoleIcon:!0,state:c.up}:{value:k.EXCLUDED,ifaceId:t.id,state:c.up}})}(e,t,i.chain(o).map(function(e){return i.get(e,"port","")+","+i.get(e,"vlan-port","")}).words().uniq().value()),c="dsl"===i.get(s,["PORTS_MAP",s.WAN_PORT,"type"]);if(!_&&c&&(l[s.WAN_PORT]={roles:[{role:"cancel"}],isSfp:!1,isDisabled:!0,value:k.EXCLUDED}),n)return l;var d=t.iseg,u=x(d["vlan-port"]),m=x(d.port).filter(function(e){return!i.includes(u,e)});return u.forEach(function(e){l[s.PORTS_IDS[e]].value=k.TRUNK}),m.forEach(function(e){l[s.PORTS_IDS[e]].value=k.ACCESS}),l},getDhcpPoolData:function(e,t){for(var n={},a=Object.keys(e),o=0,s=a.length;o<s;++o){var r=a[o],l=e[r],c=t.rename||t["interface-name"];if(i.get(l,"bind.interface")===c)return(n=R(l)).poolName=r,n.exists=!0,n.enabled=!0,n}return angular.extend(R({},i.get(t,"ip.address.address"),i.get(t,"ip.address.mask")),{enabled:!1,exists:!1,poolName:M(t)})},getNextSubnetIp:function(e){for(var t="192.168".split(".").map(Number),n=i.chain(e).map(function(e){return u.getMaxAndMinNetworkHostIp(e.ip,e.mask)}).reduce(function(e,n){var a=n.minNetworkAddress,o=n.maxNetworkAddress,s=a.split(".").map(Number),r=o.split(".").map(Number),l=s[2],c=r[2];if(s[0]<t[0]&&t[0]<r[0]||s[0]===t[0]&&s[1]<t[1]&&r[0]===t[0]&&t[1]<r[1])return i.range(0,255);if(i.startsWith(a,"192.168")){var d=i.startsWith(o,"192.168")?c:255;return i.union(e,i.range(l,d+1))}return i.startsWith(o,"192.168")?i.union(e,i.range(0,c+1)):e},[]).uniq().value(),a=1;i.includes(n,a);)a++;return a<255?"".concat("192.168",".").concat(a,".1"):""}},dhcp:{getDummyPool:function(e,t,n){return angular.extend(R({},t,n),{enabled:!1,poolName:M(e)})}},options:q,portModes:angular.copy(k),defaults:v,constants:{DHCP_MODE:angular.copy(P)}}}e.$inject=["$q","$rootScope","$timeout","_","router","utils","NDM","CONSTANT","components","interfaces","policies","dslService","ipV4Service","ifaceIpModel","trafficShaperModel","chilliModel"],angular.module("keenetic").factory("SegmentsService",e)}(),function(){function e(e,t,n,i,a,o,s,r,l,c,d,p,u,m,f,g,v,h,b,_,y,S,w,C,E,I,T,k,P,A){var D=this,O=P.constants.DHCP_MODE,N=c.current.name,L=S.getConst(),x=S.WIFI_BAND_2_GHZ,R=S.WIFI_BAND_5_GHZ,M=s.USER_CONNECTION_TYPE,$=s.events,F=function(e){var n=t.defer(),i=o.$on($.TABS_SELECT_TAB,function(){i(),n.resolve()});return o.$broadcast($.TABS_SELECT_TAB,e,!0),n.promise},V=function(e){return D.activeSegment.description!==e?F(e).then(function(){return D.activeSegment.description}):t.when(D.activeSegment.description)};D.openWiFiDialog=function(e){var n=e.band;if(!d.includes(L.WIFI_TYPES,n))return c.go("^");var i=e.tab,o=D.activeSegment.description||e.tab,s=t.defer();if(D.wifiInitialized)V(i).then(s.resolve);else var r=a.$watch("segments.wifiInitialized",function(e){e&&(r(),V(i).then(s.resolve))});s.promise.then(function(){return d.get(D,["ctrls","WC","apSettings",n,"id"])?D.ctrls.WC.editApSettings(D.ctrls.WC.apSettings[n].id,n).then(function(){return F(o)}):(D.ui.allowTransitions=!0,c.go("^",{tab:o}).finally(function(){D.ui.allowTransitions=!1}))})},D.switchportsList=b.getSwitchportsList(),D.updateIforL10n=function(e){return d.mapValues(e,function(e){var t=D.getIforL10n(e.ifor);return Object.assign({},e,{iforL10n:t})})},a.$on("$destroy",l.onBefore({from:N},function(e){return 0===e.to().name.indexOf(e.from().name)||(!(d.get(r.get(),"state.name")!==e.to().name||!d.get(o,"modalConfirm.open"))||!(D.ui.locked&&!D.ui.allowTransitions)&&(D.activeSegment.isNew||D.subctrlModified?_.confirmLeave():!D.form.modified||(0===D.getModifiedModels().filter(function(e){return!e.$name.includes("schedule")||e.$modelValue!==p.ADD_SCHEDULE_OPTION_ID}).length||_.confirmLeave())))})),D.progress=0,D.ready=!1,D.inRouterMode=h.sysmode===s.SYSMODE.ROUTER,D.portsMap=angular.copy(h.PORTS_MAP),D.options=angular.copy(P.options),D.defaults=angular.copy(P.defaults),D.portModes={},D.portModePrefix="seg_",D.portCfgValidity={},D.portCfgIsInvalid=!1,D.labelByIfaceId={},D.getIforL10n=d.noop;var U=function(){D.portsMap=d.mapValues(D.portsMap,function(e){return d.omit(e,["error"])})},B=function(){d.forEach(h.PORTS_IDS,function(e){D.portCfgValidity[e]=!0})};B(),D.igmpInstalled=Boolean(g.igmp),D.pppoeInstalled=Boolean(g.pppoe),D.trafficcontrolInstalled=Boolean(g.trafficcontrol),D.dhcpInstalled=Boolean(g.dhcpd),D.chilliInstalled=Boolean(g.chilli),D.wifiInstalled=Boolean(g.corewireless),D.wifiInitialized=!1,D.busyVlans=[],D.tabs=[],D.activeTab=0,D.l10n={},D.validationData={},D.activeSegment={},D.isAddTabDisabled=!1,D.userInfo={},D.lastKnownUserInfo={},D.pollDeviceInfo=function(){if(!D.ui.locked)return E.getCurrentUserInfo().then(function(e){return D.userInfo=angular.copy(e),D.lastKnownUserInfo=e,D.subCtrl.callInEvery("setUserInfo",[angular.copy(e)]),m.get("show/schedule").then(function(e){D.subCtrl.callInEvery("updateScheduleInfo",[e])})},function(){D.userInfo={disconnected:!0}})};var W=function(e,t){var n,i=d.get(D,e,[]);d.set(D,e,(n=t,i.map(function(e){return Object.assign({},e,{label:n[e.id]||e.label})})))},H=function(){if(d.get(D,"tabs.length",-1)>0){var e=Boolean(d.get(D,"form.modified")),t=D.activeSegment.description,n=D.activeSegment.id,i=Boolean(d.get(D,"form.segmentName.modified"));D.tabs=D.tabs.map(function(e){var t=e.id;if((i||e.isNew)&&n===t)return Object.assign({},e,{description:D.activeSegment.description});var a=D.interfaces.get(t);return Object.assign({},e,{description:b.getInterfaceL10n(a)})});var a=d.find(D.tabs,{id:D.activeSegment.id});D.activeSegment.description=a?a.description:t,e||q()}D.l10n={descriptionValidationMsg:b.getTranslation("errors.too-long-named",null,{name:b.getTranslation("segments.form.segment-name")}),newSegmentNamePrefix:b.getTranslation("segments.new-segment-name-prefix"),ipConfig:{getDescription:function(){return b.getTranslation("segments.section.ip-config.description",null,{segmentDescription:D.activeSegment.description})}},dhcpConfig:{dnsServer:b.getTranslation("segments.form.dhcp.dns-server")},confirmSegmentDelete:b.getTranslation("segments.confirm.delete-segment"),vlanInput:b.getTranslation("segments.form.vlan-id.label"),vlanUnused:b.getTranslation("segments.form.vlan-id.unused"),showOtherSwitchports:b.getTranslation("segments.details.switchports.show-other-segments"),hideOtherSwitchports:b.getTranslation("segments.details.switchports.hide-other-segments"),showOtherSwitchportsShort:b.getTranslation("segments.details.switchports.show-other-segments-short"),hideOtherSwitchportsShort:b.getTranslation("segments.details.switchports.hide-other-segments-short"),error:{notUniqueName:b.getTranslation("segments.validation-error.not-unique-name"),notUniqueVlanId:b.getTranslation("segments.validation-error.not-unique-vlan-id"),poolIsTooLarge:b.getTranslation("segments.validation-error.dhcp-pool-is-too-large")},notification:{save:function(){return b.getTranslation("segments.notification.save",null,{segmentDescription:D.activeSegment.description})}},pppoePassThrough:{getWarning:function(){return b.getTranslation("segments.form.pppoe-pass-through.warning",null,{segment:b.getInterfaceL10n(D.segments[D.pppoePassThrough.lanPrev])})}}},D.validationData={errorMessage:D.l10n.descriptionValidationMsg},D.rawRciData&&(D.interfaceIdToLabelMap=v.getInterfaceIdToLabelMap(D.rawRciData["show interface"]),D.interfaceIdToDescriptionMap=v.getInterfaceIdToDescriptionMap(D.rawRciData["show interface"]),W("igmp.iface.options",D.interfaceIdToLabelMap),W("dhcpRelay.wanOptions",D.interfaceIdToDescriptionMap),W("pppoePassThrough.wan.options",D.interfaceIdToLabelMap))};a.$on("$destroy",o.$on("$translateChangeSuccess",function(){return e(H)})),D.canSwitchTab=function(e,t,n,i){return!D.ui.locked&&(!(i.isNew||D.form.modified||D.subctrlModified)||_.confirmLeave())};var q=function(){var n=t.defer();return e(function(){D.form&&D.form.$setPristine(),n.resolve()}),n.promise};D.ui={allowTransitions:!1,dhcpConfigIsVisible:!1,otherSwitchportsAreVisible:!1,locked:!1,unlockPending:!1,unlockTimeout:500,switchport:{},toggle:function(e){angular.isDefined(D.ui[e])&&(D.ui[e]=!D.ui[e])},set:function(e,t){angular.isDefined(D.ui[e])&&(D.ui[e]=t)},get:function(e){return D.ui[e]||!1},lock:function(){D.ui.locked=!0},unlock:function(){D.ui.unlockPending||(D.ui.unlockPending=!0,e(function(){D.ui.locked=!1,D.ui.unlockPending=!1},D.ui.unlockTimeout))},reset:function(){o.$broadcast(s.events.SELECTBOX_TOGGLE_CLOSE,null),D.ui.otherSwitchportsAreVisible=!1,D.ui.dhcpConfigIsVisible=!1},onOtherSegmentsLinkKeypress:function(e){f.isSpace(e)&&!D.ui.locked&&(e.preventDefault(),D.ui.toggle("otherSwitchportsAreVisible"))}};var j=function(e){return!!e&&d.some(e,function(e){return e.value===P.portModes.TRUNK})},K=function(e,t){e=Number(e);var n=!isNaN(e)&&e>0&&e<4095?String(e):"";return t?"VLAN "+n:""},G=function(){d.get(D,"form.vlanId.revalidate",d.noop)()},Y=function(){D.tabs.forEach(function(e){D.ui.switchport[e.id]={active:!1}})};a.$on("$destroy",o.$on("ndm-selectbox-toggle-open",function(e,t,n){Y(),n&&0===n.indexOf(D.portModePrefix)&&(D.ui.switchport[n.split("_")[1]].active=!0)})),a.$on("$destroy",o.$on("ndm-selectbox-toggle-close",Y)),D.updateVlanData=function(){D.activeSegment.hasTrunkPorts=j(D.activeSegment.switchports),D.activeSegment.isHomeSegment&&(D.activeSegment.vlanId=D.activeSegment.hasTrunkPorts?h.LAN_VID:""),D.activeSegment.vlanLabel=K(D.activeSegment.vlanId,D.activeSegment.hasTrunkPorts)},D.cbk={toggleDhcpSettings:function(){D.activeSegment.dhcp.enabled&&(D.ui.dhcpConfigIsVisible=!1)},onDhcpModeChange:function(t){if(t===O.SERVER&&!d.get(D,"activeSegment.dhcp.range.begin")){D.ui.lock();var n=D.activeSegment.id,i=d.get(D,"activeSegment.ip.address");i||(i=P.segment.getNextSubnetIp(Q())),D.activeSegment.dhcp=P.dhcp.getDummyPool({id:n},i?T.num2ip(T.ip2num(i)+1):"",d.get(D,"activeSegment.ip.mask",D.defaults.mask)),D.activeSegment.ip.address=i,D.ui.set("dhcpConfigIsVisible",!0),e(D.ui.unlock)}},onMaskValueChange:function(e){var t=D.activeSegment.ip.address,n=D.activeSegment.dhcp.range.begin;C.ip(t)&&C.ip(n)&&D.inRouterMode&&C.validators.inNet(n,t+";"+e)&&D.cbk.recalculateDhcpPoolStart(D.cbk.isSegmentIpValid())},onSwitchportChange:function(e,n,i){var a=i.split(/__/g),o=a[2],s=a[1];if(D.activeSegment.switchports){var r=t.defer(),l=D.ui.otherSwitchportsAreVisible,c=h.PORTS_MAP[s],p=D.userInfo;p.disconnected||"ethernet"!==p.type?r.resolve(!0):c.port===D.userInfo.port&&(o===D.userInfo.ifaceId&&e!==D.portModes.ACCESS||o!==D.userInfo.ifaceId&&e===D.portModes.ACCESS)?_.confirm("switchport-is-used-to-connect-to-the-device","confirm-using-switchport").then(function(){r.resolve(!0)},function(){o===D.activeSegment.id?D.activeSegment.switchports[s].value=n:D.activeSegment.otherSegmentsSwitchports.forEach(function(e){e.id===o&&(e.switchports[s].value=n)}),D.ui.otherSwitchportsAreVisible=l,r.resolve(!1)}):r.resolve(!0),e===D.portModes.EXCLUDED&&(D.ui.otherSwitchportsAreVisible=!0),r.promise.then(function(t){if(t){if(o===D.activeSegment.id)e===D.portModes.ACCESS&&D.activeSegment.otherSegmentsSwitchports.forEach(function(e){e.switchports[s].value!==D.portModes.TRUNK&&(e.switchports[s].value=D.portModes.EXCLUDED)}),D.activeSegment.switchports[s].value=e;else if(D.activeSegment.otherSegmentsSwitchports.forEach(function(t){if(t.id===o)t.switchports[s].value=e;else if(e===D.portModes.ACCESS){t.switchports[s].value!==D.portModes.TRUNK&&(t.switchports[s].value=D.portModes.EXCLUDED)}}),e===D.portModes.ACCESS)D.activeSegment.switchports[s].value!==D.portModes.TRUNK&&(D.activeSegment.switchports[s].value=D.portModes.EXCLUDED);D.updateVlanData(),G(),D.activeSegment.otherSegmentsSwitchports.forEach(function(e){e.hasTrunkPorts=j(e.switchports),e.vlanLabel=K(e.vlanId,e.hasTrunkPorts)});var n=D.activeSegment.switchports[s].value===D.portModes.EXCLUDED;if(n)for(var i=D.activeSegment.otherSegmentsSwitchports,a=0,r=i.length;a<r;++a){if(i[a].switchports[s].value!==D.portModes.EXCLUDED){n=!1;break}}D.portCfgValidity[s]=!n,D.portCfgIsInvalid=!1,d.forEach(D.portCfgValidity,function(e,t){D.portsMap[t].error=!e,D.activeSegment.switchports[t].error=!e,D.activeSegment.otherSegmentsSwitchports.forEach(function(n){n.switchports[t].error=!e}),e||(D.portCfgIsInvalid=!0)})}})}},isSegmentIpValid:function(){return d.get(D,"form.segmentIpAddress.$valid")},onDhcpRangeBeginChange:function(){e(function(){D.cbk.recalculateDhcpPoolStart(D.cbk.isSegmentIpValid(),!0)})},onSegmentIpValidationEnd:function(e){D.cbk.recalculateDhcpPoolStart(e)},recalculateDhcpPoolStart:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e&&D.inRouterMode){var n=D.activeSegment;if(n.ip&&n.dhcp&&D.form){var i,a,o=n.ip.address,s=n.ip.mask,r=n.dhcp.range.size-0,l=n.dhcp.range.begin,c=T.ip2num(o),d=c&T.ip2num(s),p=T.invertMask(s),u=T.ip2num(p)-1;c<(i=C.validators.inNet(l,o+";"+s)?d+1:T.ip2num(l))&&(u=u-i+c),(u<r||D.form.dhcpPoolSize&&D.form.dhcpPoolSize.modified)&&(r=u),a=i+r,i===c&&(i++,a++);var m=Math.min(1250,u);n.dhcp.range.maxSize=m,t||(r>m&&(r=m),D.form.modified&&!D.form.$pristine&&angular.extend(n.dhcp.range,{begin:T.num2ip(i),end:T.num2ip(a),size:r}))}}}},D.validation={uniqueDescription:function(e){if(!e)return null;var t=D.tabs.filter(function(e){return e.id!==D.activeSegment.id}).map(function(e){return e.description});return d.includes(t,e)?D.l10n.error.notUniqueName:null},uniqueVlanId:function(e){if(!e||!D.activeSegment)return null;var t=D.activeSegment.isNew?D.busyVlans:D.activeSegment.iseg["busy-vlan"].split(",").filter(angular.identity);return d.includes(t,e)?D.l10n.error.notUniqueVlanId:null}},D.subctrlModified=!1,D.ctrls={},D.subCtrl={register:function(e,t){D.ctrls[t]=e,D.ctrls[t].accessCtrl=D.subCtrl.get,D.ctrls[t].getActiveSegment=function(){return D.activeSegment},D.ctrls[t].isMainCtrlLocked=function(){return D.ui.locked},D.ctrls[t].openWiFiDialog=D.openWiFiDialog,D.ctrls[t].setModified=function(e){D.subctrlModified=e},D.ctrls[t].setFormPristine=q,D.ctrls[t].getInterfaceLabel=function(e){return d.get(D,["interfaceIdToLabelMap",e],e)},D.ctrls[t].getInterfaceDescription=function(e){return d.get(D,["interfaceIdToDescriptionMap",e],e)}},get:function(e){return D.ctrls[e]},callInEvery:function(e,n){var i=d.filter(D.ctrls,function(t){return angular.isFunction(t[e])}).map(function(i){return t.when(i[e].apply(i[e],n))});return 0===i.length?t.when(!0):t.all(i)}};var z=function(){return P.getInitialData().then(function(e){D.schedules=e.schedules,D.policyData=e.policyData,D.segments=e.segments,D.interfaces=e.interfaces,D.busyVlans=e.busyVlans,D.dhcp=e.dhcp,D.dhcpRelay=e.dhcpRelay,D.igmp=e.igmp,D.pppoePassThroughInitData=angular.copy(e.pppoePassThrough),D.pppoePassThrough=e.pppoePassThrough,D.nat=e.nat,D.portModes=P.portModes,D.labelByIfaceId=e.labelByIfaceId;var n=-1;return D.options.dhcpMode.forEach(function(e,t){e.id===O.RELAY&&(n=t)}),-1!==n&&(D.options.dhcpMode[n].disabled=!D.dhcpRelay.configurable),D.dhcpRelay.usedByOtherSegments=!1,D.rawRciData=d.get(e,["interfaces","raw"]),D.interfaceIdToLabelMap=v.getInterfaceIdToLabelMap(D.rawRciData["show interface"]),D.getIforL10n=v.getPortIforL10nFunction(v.getInterfaceIdToDescriptionMap(D.rawRciData["show interface"])),t.when(D)}).then(function(){return D.subCtrl.callInEvery("onDataRenew",[D.interfaces,D.schedules])})};D.init=function(){return H(),z().then(function(){return D.tabs=d.map(D.segments,function(e){var t=D.interfaces.get(e.id);return{id:e.id,description:b.getInterfaceL10n(e),isHomeSegment:t["interface-name"]===h.LAN}}),D.subCtrl.callInEvery("init",[D.interfaces,d.values(D.segments)])}).finally(function(){H(),D.progress=100;var t=o.$on(s.events.SEGMENT_WIFI_SECTION_READY,function(){D.wifiInitialized=!0,t()});a.$on("$destroy",t),D.wifiInstalled&&!D.wifiInitialized&&e(function(){var e=D.subCtrl.get("WC");e.setFormCtrl(D.form),e.setUserInfo(D.userInfo),e.setPopupCtrl(D.subCtrl.get("WSC"));var t=e.EVENTS;a.$on("$destroy",o.$on(t.ADD_AP,function(){D.activeSegment.apCount++})),a.$on("$destroy",o.$on(t.REMOVE_AP,function(){D.activeSegment.apCount--}))}),e(function(){D.ready=!0})})};var Q=function(){return v.getAllUsedSubnets(D.interfaces.raw["show interface"],D.interfaces.raw.interface)};D.setActiveSegment=function(e,t,n,i){if(!t||!i||t.id!==i.id){if(i&&i.isNew){var a=D.tabs.slice();return a.splice(a.length-1,1),a=a.map(function(e){return e.isActive=t.id===e.id,e}),D.tabs=a,D.isAddTabDisabled=!1,void D.setActiveSegment(e,t,-1,{})}var o=t.id;return D.ui.reset(),D.ui.lock(),t.isNew?(D.activeSegment=function(e,t){var n={};n.id=e,n.description=t,n.vlanId="",n.isHomeSegment=!1,n.isGuestSegment=e===D.interfaces.get(h.GUEST).id,n.isNew=!0,n.ip={mask:D.defaults.mask,address:P.segment.getNextSubnetIp(Q())},D.inRouterMode||(n.ipModel=k.getFormDataPrototype(),n.ipModelOnLoad=angular.copy(n.ipModel)),n.policy=D.policyData.defaultPolicy,n.controlledByChilli=!1;var i=d.get(D,["interfaces","raw","interface"],{}),a=d.get(D,["interfaces","raw","show interface"],{});return n.usedIpAddresses=v.getAllUsedSubnets(a,i).map(function(e){return Object.assign({},e,{label:D.labelByIfaceId[e.ifaceId]})}),n.speedLimit=A.getDefaultModel(),n.systemAccess=!1,n.peerIsolation=!1,n.switchports=P.segment.getPorts(D.interfaces,{id:n.id},!0),n.hasTrunkPorts=!1,n.vlanLabel="",n.natEnabled=!0,n.dhcpMode=O.SERVER,n.dhcp=P.dhcp.getDummyPool({id:n.id},n.ip.address?T.num2ip(T.ip2num(n.ip.address)+1):"",n.ip.mask),n.dhcp.enabled=!0,D.pppoeInstalled&&(D.pppoePassThrough.lan=n.id),D.igmpInstalled&&(n.igmpEnabled=!1),n}(t.id,t.description),D.isAddTabDisabled=!0):(D.pppoePassThrough=angular.copy(D.pppoePassThroughInitData),D.activeSegment=function(e){var t={};["id","description","iseg"].forEach(function(n){t[n]=angular.copy(e[n])});var n=e["interface-name"];t.controlledByChilli=e.group===h.CHILLI_IFACE,t.policy=D.policyData.segmentPolicies[e.id]||D.policyData.defaultPolicy,t.vlanId=e.iseg.vlan,t.isHomeSegment=n===h.LAN,t.isGuestSegment=n===h.GUEST,t.description=b.getInterfaceL10n(e),t.ip=d.get(t.controlledByChilli?D.interfaces.get(h.CHILLI_IFACE):e,"ip.address",{address:"",mask:D.defaults.mask}),D.inRouterMode||(t.ipModel=k.getFormDataFromRawData(e),t.ipModelOnLoad=angular.copy(t.ipModel));var i=d.get(D,["interfaces","raw","interface"],{}),a=d.get(D,["interfaces","raw","show interface"],{}),o=t.controlledByChilli?h.CHILLI_IFACE:e.id;t.usedIpAddresses=v.getAllUsedSubnets(a,i,o).map(function(e){return Object.assign({},e,{label:D.labelByIfaceId[e.ifaceId]})});var s=d.get(e,"traffic-shape",{});if(t.speedLimit=A.getModelFromRciData(s),t.systemAccess=Boolean(d.get(e,"security-level.private")),t.peerIsolation=Boolean(d.get(e,"peer-isolation")),t.isNew=!1,t.iseg=e.iseg,t.dhcp=P.segment.getDhcpPoolData(D.dhcp,e),d.get(D,["dhcpRelay","segmentAliases",t.id])?t.dhcpMode=O.RELAY:t.dhcpMode=t.dhcp.enabled?O.SERVER:O.OFF,t.dhcpModeOnLoad=t.dhcpMode,t.natEnabled=D.nat.some(function(t){return e.id===t.interface||e.rename===t.interface}),t.switchports=D.updateIforL10n(P.segment.getPorts(D.interfaces,e,!1)),t.hasTrunkPorts=j(t.switchports),t.vlanLabel=K(t.vlanId,t.hasTrunkPorts),D.igmpInstalled&&(t.igmpEnabled=D.igmp.isEnabled&&D.igmp.upstreamIfaceSelected&&d.get(e,"igmp.downstream[0].enabled",!1)),D.pppoeInstalled&&D.inRouterMode){var r=e.rename||e.id;t.pppoePassThroughEnabled=angular.isObject(D.pppoePassThrough)&&D.pppoePassThrough.wan.value&&r===D.pppoePassThrough.lan,D.pppoePassThrough.lanPrev=D.pppoePassThrough.lan,D.pppoePassThrough.lan=r}return t.raw=d.extend({},e),t}(D.interfaces.get(o))),D.activeSegment.otherSegmentsSwitchports=D.tabs.slice().filter(function(e){return e.id!==o}).map(function(e){var t,n;if(e.isNew)t=P.segment.getPorts(D.interfaces,{id:e.id},!0),n=b.firstUnusedId(D.busyVlans);else{var i=D.interfaces.get(e.id);t=P.segment.getPorts(D.interfaces,i,!1),n=function(e){if(e.inherit){var t=e.inherit.interface;return(D.interfaces.get(t).id||t).split("/")[1].replace("Vlan","")-0}if(e.include){for(var n=e.include,i=0,a=n.length;i<a;++i){var o=n[i].interface;if(o.indexOf("/Vlan")>-1)return o.split("/Vlan")[1]}return!1}return!1}(i)}t=D.updateIforL10n(t);var a=j(t),o=e.isNew?[]:D.interfaces.get(e.id).iseg.include.split(",").filter(angular.identity);return{id:e.id,isNew:Boolean(e.isNew),vlanId:e.isHomeSegment?h.LAN_VID:n,description:e.description,switchports:t,hasTrunkPorts:a,include:o,vlanLabel:K(n,a)}}),D.activeSegment.noOtherSwitchports=0===D.activeSegment.otherSegmentsSwitchports.length,U(),Y(),D.updateVlanData(),G(),B(),D.subCtrl.callInEvery("onTabChange",[D.activeSegment,D.interfaces.get(D.activeSegment.id)]).then(function(){D.wifiInstalled&&(D.activeSegment.apCount=D.subCtrl.get("WC").getApIfaceIds().length)}).then(q).then(function(){D.dhcpRelay.usedByOtherSegments=!1;for(var e=D.dhcpRelay.segmentIfaces||[],t=0,n=e.length;t<n;++t)if(D.activeSegment.id!==D.interfaces.get(e[t]).id){D.dhcpRelay.usedByOtherSegments=!0;break}}).finally(D.ui.unlock)}},D.newSegmentTabCtor=function(){for(var e=D.tabs.length+1,t=D.l10n.newSegmentNamePrefix,n=t+" "+e,i=D.tabs.map(function(e){return e.description.toLowerCase()});i.indexOf(n.toLowerCase())>-1;)n=t+" "+ ++e;return{id:D.interfaces.getNextFreeName("Bridge"),description:n}};var X=function(){return D.activeSegment?D.wifiInstalled?D.subCtrl.get("WC").onReset(D.activeSegment):t.when(!0):t.when(!1)};D.resetSegment=function(){if(D.ready){if(D.ui.lock(),D.activeSegment.isNew){var t=D.tabs.slice();return t.splice(D.tabs.length-1,1),D.tabs=t,D.isAddTabDisabled=!1,X().then(D.ui.unlock).then(q)}d.get(D,"form.reset",d.noop)(),e(function(){U(),Y(),D.updateVlanData(),G(),B()}),X().then(q).finally(D.ui.unlock)}};var Z=function(){q(),u.updateMenu(),D.activeSegment.isNew&&(D.activeSegment.isNew=!1,D.isAddTabDisabled=!1);var t=D.interfaces.get(D.activeSegment.id);D.activeSegment.iseg=t.iseg,D.activeSegment.dhcpModeOnLoad=D.activeSegment.dhcpMode,D.activeSegment.dhcp=P.segment.getDhcpPoolData(D.dhcp,t),D.inRouterMode&&e(function(){D.cbk.recalculateDhcpPoolStart(D.cbk.isSegmentIpValid())}),q()};D.isChilliEnabled=function(){var e=D.subCtrl.get("CHILLI");return D.activeSegment.controlledByChilli||e&&!(e.chilliSegment||e.chilliSegment===D.activeSegment.id)&&e.enabled},D.getModifiedModels=function(){return b.getFormModifiedModels(D.form)};var J=function(e){return d.startsWith(e.$name,w.WIFI_FIELD_PREFIX)};D.saveSegment=function(){D.ui.lock();var e,n=D.getModifiedModels(),i=d.some(n,J),a=n.filter(function(e){return!J(e)}),o=t.when(!0),s=D.activeSegment.isNew?[]:d.get(D.activeSegment,"iseg.include","").split(",").filter(angular.identity);D.activeSegment.include=s.filter(function(e){return!v.isAccessPointInterfaceId(e)}),D.wifiInstalled&&(e=D.subCtrl.get("WC"),D.activeSegment.include=D.activeSegment.include.concat(e.getApIfaceIds()));var r=!1;if(D.inRouterMode&&D.chilliInstalled&&!D.activeSegment.isHomeSegment){var l=D.subCtrl.get("CHILLI");l.chilliSegment&&l.chilliSegment!==D.activeSegment.id||((r=l.data).enabled=l.enabled)}var c=D.userInfo,p=t.defer(),u=D.inRouterMode&&d.get(D,"form.segmentIpAddress.modified")||!D.inRouterMode&&(D.activeSegment.ipModelOnLoad.mode!==D.activeSegment.ipModel.mode||D.activeSegment.ipModelOnLoad.ip!==D.activeSegment.ipModel.ip),m=c.ifaceId===D.activeSegment.id&&!c.disconnected&&!D.activeSegment.isNew;if(D.wifiInstalled&&!c.disconnected&&c.type===M.WIFI){var f=(e=D.subCtrl.get("WC")).checkIfApSettingsChanged(c.ap),g=d.startsWith(c.ap,h.MASTER_5G)?R:x;f||u&&m?_.confirm(b.getTranslation("access-point-used-to-connect-to-the-device-settings-changed",null,{ssid:e.apSettings[g].ssidOnLoad}),"continue-anyway").then(function(){return p.resolve(!0)},function(){return p.resolve(!1)}):p.resolve(!0)}else if(c.ifaceId!==D.activeSegment.id||"ethernet"!==c.type&&(D.inRouterMode||"remote"!==c.type))p.resolve(!0);else{var S=T.ip2num(c.host),w=D.inRouterMode&&D.activeSegment.dhcpMode!==d.get(D,"form.dhcpMode.masterValue")||!D.inRouterMode&&u;if(!w&&D.activeSegment.dhcpMode===O.SERVER)if(a.some(function(e){return d.startsWith(e.$name||"","dhcp")})){var C=D.activeSegment.dhcp,E=T.ip2num(C.range.begin),I=E+(C.range.size-0);w=S<E||S>I}w||r&&r.enabled||u&&m?_.confirm("segment-used-to-access-the-device-dhcp-settings-changed","continue-anyway").then(function(){return p.resolve(!0)},function(){return p.resolve(!1)}):p.resolve(!0)}return p.promise.then(function(t){if(!t)return D.ui.unlock();(D.activeSegment.isNew||a.length>0||!angular.equals(s,D.activeSegment.include))&&(D.pppoeInstalled&&(D.pppoePassThrough.enabled=D.activeSegment.pppoePassThroughEnabled,D.pppoePassThrough.isNew=D.activeSegment.isNew),o=P.segment.save(D.interfaces,D.activeSegment,D.igmp,D.pppoePassThrough,D.busyVlans,D.dhcpRelay,r,u).then(function(e){var t=D.activeSegment.id;D.activeSegment.iseg||(D.activeSegment.iseg={}),e[t]&&d.forEach(e[t],function(e,t){D.activeSegment.iseg[t]=e}),D.activeSegment.hasTrunkPorts?D.activeSegment.vlanLabel=K(D.activeSegment.vlanId,D.activeSegment.hasTrunkPorts):(D.activeSegment.vlanId="",D.activeSegment.vlanLabel="")})),o.then(function(){y.success(D.l10n.notification.save())}).then(D.wifiInstalled&&(i||D.subctrlModified)?e.save:angular.noop).then(function(){var e=D.tabs.slice(),t=d.find(e,function(e){return e.id===D.activeSegment.id});-1!==t&&(t.description=D.activeSegment.description,D.tabs=e)}).then(D.init).then(Z).finally(D.ui.unlock)})},D.removeSegment=function(){if(!D.ui.locked){var e=D.activeSegment.id;_.confirm(D.l10n.confirmSegmentDelete).then(function(){D.activeSegment.removed=!0,D.ui.lock(),P.segment.remove(D.interfaces,D.activeSegment,D.nat,D.dhcpRelay,D.igmp).then(z).then(function(){return D.tabs=D.tabs.filter(function(t){return t.id!==e}),b.scrollTop(),u.updateMenu(),D.subCtrl.callInEvery("onTabDelete",[e])}).finally(function(){Z(),D.ui.unlock()})})}},D.init()}e.$inject=["$timeout","$q","$window","$document","$scope","$rootScope","CONSTANT","$previousState","$transitions","$state","_","schedules","menuService","router","keyboard","components","interfaces","NDM","utils","modal","notification","wifiOptions","wifiSettingsService","ValidatorManager","usersService","browserCheck","ipV4Service","ifaceIpModel","SegmentsService","trafficShaperModel"],angular.module("keenetic").controller("SegmentsController",e)}(),function(){function e(e,t,n,i,a,o){return{getConfiguration:function(){var e=a.arrayToQueryData(["show.interface","show.rc.service"]);return a.postToRciRoot(e).then(function(e){var n=Boolean(t.get(e,"show.rc.service",{}).ntce),i=t.get(e,"show.interface",{}),s=o.getInterfaceOptions(i).filter(function(e){return e.global});return a.post({url:"",data:t.set({},"show.rc.interface.bandwidth-limit",s.map(function(e){return{name:e.name}}))}).then(function(e){var a=t.get(e,"show.rc.interface.bandwidth-limit",[]);return{ifaces:s=s.map(function(e,n){return e.limit=t.get(a,[n,"bandwidth-limit","limit"].join("."),void 0),e}),showInterfaceData:i,serviceIsRunning:n}})})},saveConfiguration:function(e,n){var i=e.map(function(e){var n=e.limit?{limit:e.limit}:{no:!0};return t.set({},["interface",e.name,"bandwidth-limit"],n)});return i.unshift(t.set({},"ntce.shaping",{no:!n})),i.unshift(t.set({},"service.ntce",{no:!n})),a.postAndSave(i)},testConnectionSpeed:function(e){return a.post({url:"bwmeter/run",noRetry:!0,data:{interface:e}})},constant:{SERVICE_NAME:"ntce"}}}e.$inject=["$q","_","appsService","utils","router","interfaces"],angular.module("keenetic").factory("intelliqos",e)}(),function(){function e(e,t,n,i,a,o,s,r,l,c,d,p){var u=this;u.progress=0,u.speedTestIfaceId=null,u.ui={locked:!1,speedTestInProgress:!1,lock:function(){return u.ui.locked=!0,e.when(!0)},unlock:function(){return u.ui.locked=!1,e.when(!0)}},u.l10n={};var m=function(){u.l10n={kbitps:s.format.getSpeedUnit(d.UNIT_SCALE.KILO),speedTestStart:s.getTranslation("intelliqos.placeholder.speed-test-start"),noInternetAlert:s.getTranslation("intelliqos.alert.no-internet")},u.interfaceIdToDescriptionMapMap=l.getInterfaceIdToDescriptionMap(u.showInterfaceData),u.ifaces=u.ifaces.map(function(e){return Object.assign({},e,{label:u.interfaceIdToDescriptionMapMap[e.id]})})};t.$on("$destroy",i.$on("$translateChangeSuccess",function(){return n(m)}));u.toggleServiceState=function(e){return c.toggleService(p.constant.SERVICE_NAME,e)},u.save=function(){return u.ui.lock().then(function(){return p.saveConfiguration(u.ifaces,u.serviceState)}).finally(function(){r.success("notifications.saved"),a.get(u,"form.$setPristine",angular.noop)(),u.ui.unlock()})},u.cancel=function(){return a.get(u,"form.reset",angular.noop)()},u.runSpeedTest=function(e){if(!u.ui.locked&&!u.ui.speedTestInProgress){u.ui.speedTestInProgress=!0,u.speedTestIfaceId=e;var t=a.findIndex(u.ifaces,{id:e}),n=t>-1?u.ifaces[t]:{},i=e+"__limit",r=function(e){return Boolean(a.get(u,["form",e,"$pristine"]))}(i),l=n.limit;n.limit=u.l10n.speedTestStart,n.showUnits=!1,isNaN(Number(l))||(l*=s.format.MULTIPLIER_SPEED);var c=function(e){e&&isNaN(Number(e))||(n.showUnits=!0),n.limit=e?e/s.format.MULTIPLIER_SPEED|0:e},d=function(){r&&function(e){a.get(u,["form",e,"$setPristine"],angular.noop)()}(i),o.alert(u.l10n.noInternetAlert),c(l)};return p.testConnectionSpeed(e).then(function(e){if(e.ndmErrors)d();else{var t=e.download||{},n=t.average,i=t.maximum;c(n||i||l)}},d,function(e){var t=a.get(e,"download.maximum");t&&c(t)}).finally(function(){u.ui.speedTestInProgress=!1,u.speedTestIfaceId=null})}},p.getConfiguration().then(function(e){u.ifaces=e.ifaces,u.showInterfaceData=e.showInterfaceData,u.serviceState=e.serviceIsRunning,u.ifaces.forEach(function(e){e.showUnits=!0}),m(),u.progress=100})}e.$inject=["$q","$scope","$timeout","$rootScope","_","modal","utils","notification","interfaces","appsService","CONSTANT","intelliqos"],angular.module("keenetic").controller("IntelliQosController",e)}(),function(){function e(e,t,n,i,a,o,s,r,l,c){var d,p=function(){for(var t in d.addRulePopupForm.$setPristine(),d.addRulePopupForm.modifiedModels)d.addRulePopupForm.modifiedModels[t].reset();d.isSecondaryPopupOpened=!1,d.updateAdvancedInfo(),d.updateTableWithRules(function(){d.tableRulesTimeout=e(d.updateTableWithRules,1500),d.portTransfer.id=void 0,d.isProtocolInputsHidden=!1,d.portsValidation.portStart.isFocused=!1,d.portsValidation.portEnd.isFocused=!1,d.portsValidation.portEnd.allowedRange="",d.portsValidation.portStart.allowedRange="",d.portsValidation.portStart.errorMessage="",d.portsValidation.portEnd.errorMessage="",d.addRulePopupForm.reset(),d.portTransfer.format.value=c.PORT_ID.single})},u=function(e){var t=d.portTransfer,i=t.interfaces,a=t.protocols,o=function(){d.closeAddRulePopup(),d.poll.start()};if(e)return r.deleteItem(d.ruleHash).then(o);var s=t.description,p=i.array[i.value-1].interfaceName,u=a.array[a.value-1].name,m=u.split("/")[0].toLowerCase();u===l.TCP_UDP_LABEL&&(m=l.PROTOCOL.TCP_UDP);var f={interface:p,protocol:m,port:Number(t.portStart),comment:s,schedule:t.schedule||{no:!0}},g=Number(t.format.value);if(t.isToAddress?f["to-address"]=d.deviceCard.ip:f["to-host"]=d.deviceCard.mac,g!==c.PORT_ID.single&&(f["end-port"]=Number(t.portEnd)),t.toPort&&g===c.PORT_ID.single&&(f["to-port"]=Number(t.toPort)),t.hidePortInputsOptions.includes(a.value)&&(f=n.omit(f,["port","to-port","end-port"]),t.allProtocolsOptionIndex===a.value&&(f=n.omit(f,["protocol"]))),d.ruleHash){var v=n.findIndex(d.allIpStatic,function(e){return e.index===d.ruleHash});f.index=-1===v?d.ruleHash:v}return r.saveItemFromDevicesList(f,!1).then(o)},m=function(e){e?s.confirm("devices-list.delete-rule-confirm").then(function(){return u(e)}):u(e)};return function(t){(d=this).poll.stop();var o,s,u,f=d.portTransfer;f.schedule=t?t.schedule:"",f.index=t?t.index:void 0,f.isToAddress=!!t&&Boolean(t.isToAddress),angular.isUndefined(t)&&(d.portTransfer.protocols.value=void 0,d.portTransfer.interfaces.value=void 0);var g=function(n,i){var a,o=d.portTransfer.protocols.array[d.portTransfer.protocols.value||0].name,s=d.portTransfer.interfaces.array[(d.portTransfer.interfaces.value||1)-1].interfaceName,r={},l=function(){for(var e=d.allIpStatic,t={},n=function(e,n){if(n=n||e.port,t[n])return t[n].secondPort=e.protocol,!0},i=function(n){t[n]={name:e[a].name,currentName:e[a].currentName,portName:e[a].protocol,interface:e[a].interface}},a=0,o=e.length;a<o;a++){for(var s=0,r=d.hostsAccess.length;s<r;s++)if(e[a]["to-host"]===d.hostsAccess[s].mac){e[a].currentName=d.hostsAccess[s].name;break}if(e[a].port){if(angular.isDefined(e[a]["end-port"])&&e[a]["end-port"]!==e[a].port){for(s=Number(e[a].port);s<=Number(e[a]["end-port"]);s++)n(e[a],s)||i(s);continue}n(e[a])||i(e[a].port)}}return d.portsValidation&&(d.portsValidation.isPortsValid=!0),t}();for(var c in l)a=l[c].portName===o||l[c].secondPort===o,s===l[c].interface&&((t?a&&!t.rangeObj[c]:a)||angular.isDefined(l[c].secondPort))&&(r[c]=l[c]);d.portTransfer.usedPorts=r,n&&n!==i&&(d.portsValidation.validationOnUsedPorts("portStart"),d.portsValidation.validationOnUsedPorts("portEnd")),e(function(){d.portsValidation.portStart.keyup()})};if(d.closeAddRulePopup=p,d.addRule=m,e.cancel(d.tableRulesTimeout),e.cancel(d.advancedInfoTimeout),d.refreshUsedPorts=g,g(),d.isSecondaryPopupOpened=!0,d.portsValidation={isPortsValid:!0,rangeConflict:!1,minAllowed:0,maxAllowed:0,portStart:{isValidationOk:function(){return i.isValueInRange(Number(d.portTransfer.portStart),d.portsValidation.minAllowed,d.portsValidation.maxAllowed)},radioClick:function(){d.portsValidation.portStart.keyup(!0)},keyup:function(e){if(e){if(d.portTransfer.portEnd=d.portTransfer.portEnd?Number(d.portTransfer.portEnd):Number(d.portTransfer.portStart),d.portsValidation.portEnd.errorMessage="",d.portsValidation.isPortsValid=!0,!d.portsValidation.validationOnUsedPorts("portStart"))return!1}else{if(!d.portsValidation.validationOnUsedPorts("portStart")||d.portsValidation.isPortStartBigerPortEnd())return!1;if(Number(d.portTransfer.format.value)===c.PORT_ID.range){if(d.portTransfer.portEnd&&(Number(d.portTransfer.portStart)>Number(d.portTransfer.portEnd)||d.portsValidation.isRangeConflict()))return!1;d.portsValidation.portEnd.errorMessage=""}}d.portsValidation.isPortsValid=!0},focus:function(){if(d.portsValidation.portStart.isFocused=!0,!d.portsValidation.validationOnUsedPorts("portStart"))return!1},blur:function(){d.portsValidation.portStart.isFocused=!1,d.portTransfer.portStart||(d.portsValidation.portStart.errorMessage="")},minAllowedPort:"",allowedRange:"",isFocused:!1,errorMessage:""},portEnd:{isValidationOk:function(){return i.isValueInRange(Number(d.portTransfer.portEnd),d.portsValidation.minAllowed,d.portsValidation.maxAllowed)},keyup:function(){return!!d.portsValidation.validationOnUsedPorts("portEnd")&&(d.portTransfer.portStart&&d.portsValidation.portStart.errorMessage&&d.portsValidation.portStart.isValidationOk()?(d.portsValidation.portStart.errorMessage="",!1):d.portsValidation.portStart.errorMessage||d.portTransfer.portStart&&!d.portsValidation.portEnd.isValidationOk()?(d.portsValidation.portEnd.errorMessage=" ",d.portsValidation.isPortsValid=!1,!1):void(d.portsValidation.isPortsValid=!0))},focus:function(){return d.portsValidation.portEnd.isFocused=!0,d.portsValidation.getMinMax("portEnd"),!d.portsValidation.validationOnUsedPorts("portStart")||d.portsValidation.portStart.errorMessage?(d.portsValidation.portEnd.errorMessage=" ",d.portsValidation.portEnd.allowedRange=d.portsValidation.minAllowed=d.portsValidation.maxAllowed=0,d.portsValidation.getMinMax("portEnd"),!1):!d.portsValidation.isPortStartBigerPortEnd()&&void(d.portsValidation.isPortsValid=d.portsValidation.portEnd.isValidationOk())},blur:function(){d.portsValidation.portEnd.isFocused=!1,d.portTransfer.portEnd||(d.portsValidation.portEnd.errorMessage="")},minAllowedValue:"",maxAllowedValue:"",allowedRange:"",isFocused:!1,errorMessage:""},toPort:{keyup:function(){return d.portsValidation.toPort.errorMessage="",d.portsValidation.isPortsValid=!0,d.portTransfer.toPort&&!i.isPortNumber(Number(d.portTransfer.toPort))?(d.portsValidation.toPort.errorMessage="errors.ports.not-number",d.portsValidation.isPortsValid=!1,!1):d.portsValidation.portStart.errorMessage?(d.portsValidation.isPortsValid=!1,!1):void 0},errorMessage:""},isRangeConflict:function(){var e=Number(d.portTransfer.portStart);if(!e)return!1;for(var t=d.portTransfer.portEnd;e<=t;e++)if(d.portTransfer.usedPorts[e])return d.portsValidation.isPortsValid=!1,!0;return!1},validationOnUsedPorts:function(e){var t,n=d.portTransfer[e],a=d.portTransfer.usedPorts,o=function(n,i){if(a[n])return i||(d.portsValidation[e].errorMessage="portStart"===e||"portEnd"===e&&!d.portTransfer.portStart?"errors.ports.port-used":" "),(t=a[n].currentName)!==d.deviceCard.name&&(d.portTransfer.usedPortName=t),!0};if(d.portTransfer.usedPortName="",d.portsValidation[e].errorMessage="",o(n))return d.portsValidation.isPortsValid=!1;if(Number(d.portTransfer.format.value)===c.PORT_ID.range)if("portEnd"===e){if(o(d.portTransfer.portStart,!0),d.portTransfer.portEnd&&(Number(d.portTransfer.portEnd)<Number(d.portTransfer.portStart)||d.portsValidation.isRangeConflict()))return d.portsValidation.portEnd.errorMessage=" ",d.portsValidation.isPortsValid=!1}else if(d.portsValidation.isRangeConflict())return d.portsValidation.portEnd.errorMessage=" ",d.portsValidation.isPortsValid=!1;return!(d.portTransfer[e]&&!i.isPortNumber(Number(d.portTransfer[e])))||(d.portsValidation[e].errorMessage="portStart"===e||"portEnd"===e&&!d.portTransfer.portStart?"errors.ports.not-number":" ",d.portsValidation.isPortsValid=!1)},getMinMax:function(e){var t,n=d.portTransfer.usedPorts,i=Object.keys(n),a=i.length,o=0,s="portStart"===e,r=function(t,i){n[t]||n[i]||(d.portsValidation.minAllowed=t=Number(t),d.portsValidation.maxAllowed=i=Number(i)>65535?65535:Number(i),d.portsValidation[e].allowedRange=t===i?i:t+"-"+i)};if(a&&(o=a-1),d.portsValidation[e].allowedRange="",!d.portTransfer[s?"portEnd":"portStart"])return!1;if(s){if(t=Number(d.portTransfer.portEnd),!a)return r(1,t),!1;if(t>Number(i[o]))return r(Number(i[o])+1,t),!1;for(var l=0;l<a;l++)if(t<Number(i[l])){r(0===l?1:Number(i[l-1])+1,t);break}}else{if(t=Number(d.portTransfer.portStart),!a||t>Number(i[o]))return r(t,65535),!1;for(l=0;l<a;l++)if(t<Number(i[l])){r(t,Number(i[l])-1);break}}},inputValidationOnNumber:function(e){!i.isNumberKey(e)&&e.preventDefault()},isPortStartBigerPortEnd:function(){return!!(d.portTransfer.portEnd&&Number(d.portTransfer.portEnd)<d.portTransfer.portStart&&Number(d.portTransfer.portStart))&&(d.portsValidation.portEnd.errorMessage=" ",d.portsValidation.isPortsValid=!1,!0)}},f.hidePortInputs=!1,t){for(var v=r.getProtocolOptions().reduce(function(e,t){return Object.assign({},e,_defineProperty({},t.id,t.label))},{}),h=0,b=d.ipStatic.length;h<b;h++)if(t.id===d.ipStatic[h].id){o=d.ipStatic[h];break}var _=!1;for(h=0;h<f.interfacesLen;h++)if(f.interfaces.array[h].interfaceName===o.interface){_=!0,f.interfaces.value=f.interfaces.array[h].id;break}if(!_){var y=n.find(f.interfaces.array,function(e){return e.id===o.interface||e.rename===o.interface});f.interfaces.value=y?y.id:f.interfaces.value}for(f.isRemoveRuleButtonHidden=!1,f.description=o.comment,f.portStart=Number(o.port),o["to-port"]?f.toPort=Number(o["to-port"]):o.port&&!o["end-port"]&&(f.toPort=f.portStart),f.id=o.id,o["end-port"]&&o["end-port"]!==o.port?(f.format.value=c.PORT_ID.range,f.portEnd=Number(o["end-port"])):(f.format.value=c.PORT_ID.single,f.portEnd=Number(o.port)),u=o.protocol||v[r.ALL_PORTS_PROTOCOL_ID],f.hidePortInputs=!o.protocol||o.protocol===l.PROTOCOL.ICMP,f.portStart===f.toPort&&(u+="/",u+=f.portStart,d.isProtocolInputsHidden=!0),h=0;h<f.protocolsLen;h++)if(0===(s=f.protocols.array[h]).name.toLowerCase().indexOf(u.toLowerCase())){f.protocols.value=s.id;break}f.protocols.value||(f.protocols.value="udp"===t.protocol&&c.PORT_ID.range||c.PORT_ID.single),f.cashedInfo={portStart:f.portStart,portEnd:f.portEnd,toPort:f.toPort,formatValue:f.format.value,interfacesValue:f.interfaces.value,protocolsValue:f.protocols.value,comment:f.description},d.ruleHash=t.index,d.isNewForwardingRule=!1}else d.ruleHash="",d.isNewForwardingRule=!0,f.isRemoveRuleButtonHidden=!0,f.description=f.portStart=f.toPort=f.portEnd="",f.interfaces.value=f.protocols.value=f.format.value=c.PORT_ID.single;f.format.array=[{id:1,name:a.getTranslation("devices-list.ports.single"),value:c.PORT_ID.single},{id:2,name:a.getTranslation("devices-list.ports.range"),value:c.PORT_ID.range}],d.interfaceValueChange=function(){var t=d.portTransfer.interfaces;e(function(){t.interfaceName=t.array[t.value-1].interfaceName})},d.protocolValueChange=function(){var t=d.portTransfer;t.cashedInfo||(t.cashedInfo={toPort:t.toPort,portEnd:t.portEnd,portStart:t.portStart}),e(function(){var e=t.protocols,n=e.array[e.value-1].name,i=n===l.TCP_UDP_LABEL?[n]:n.split("/");1!==i.length?(t.toPort=t.portEnd=t.portStart=parseInt(i[1],10),d.isProtocolInputsHidden=!0):(t.toPort=t.cashedInfo.toPort,t.portEnd=t.cashedInfo.portEnd,t.portStart=t.cashedInfo.portStart,d.isProtocolInputsHidden=!1),t.hidePortInputs=t.hidePortInputsOptions.includes(t.protocols.value)})}}}e.$inject=["$timeout","$q","_","ValidatorManager","utils","router","modal","portForwarding","CONSTANT","deviceList"],angular.module("keenetic").factory("popupRuleManager",e)}(),function(){function e(e,t,n,i,a,o,s,r,l,c,d,p,u,m){var f,g=p.SHOW_INTERFACE_PATH,v=p.SHOW_IP_HOTSPOT_PATH,h=p.SHOW_ASSOCIATIONS_PATH,b=p.SHOW_SCHEDULE_PATH,_=p.SHOW_VERSION_PATH,y=p.SHOW_RC_IP_HOTSPOT_HOST_PATH,S=p.SHOW_RC_IP_HOTSPOT_POLICY_PATH,w=p.SHOW_RC_IP_HOTSPOT_DEFAULT_POLICY_PATH,C=p.SHOW_RC_IP_TRAFFIC_SHAPE_PATH,E=p.SHOW_RC_IP_DHCP_PATH,I=m.constants,T=I.DEFAULT_PERMIT_POLICY,k=I.DEFAULT_DENY_POLICY,P=d.WIFI_BAND_2_GHZ,A=d.WIFI_BAND_5_GHZ,D=Boolean(r.trafficcontrol),O=Boolean(r.dhcpd),N={},L=function(){N.range=d.getAllBandsL10n()};L(),t.$on("$translateChangeSuccess",function(){return e(L)});var x=function(){f.isAllDataLoaded=!0,e.cancel(f.allDeviceTimeout),f.allDeviceTimeout=e($,1e3)},R=function(){e.cancel(f.allDeviceTimeout)},M=function(e){return a.format.size(Number(e))},$=function(){var e=a.toRciQueryList([g,v,h,b,_,y,S,w,D?C:{},O?E:{}]);o.postToRciRoot(e).then(function(e){return{showInterfaceData:n.get(e,"0.".concat(g),{}),hosts:n.get(e,"1.".concat(v,".host"),[]),associations:n.get(e,"2.".concat(h,".station"),[]),shSchedule:n.get(e,"3.".concat(b),{}),showVersionData:n.get(e,"4.".concat(_),{}),hostsAccess:n.get(e,"5.".concat(y)),policiesData:n.get(e,"6.".concat(S)),defaultHotspotPolicy:n.get(e,"7.".concat(w),{}),trafficShape:n.get(e,"8.".concat(C),{}),dhcp:n.get(e,"9.".concat(E,".host"),[])}}).then(function(e){var t=e.showInterfaceData,o=e.hosts,r=e.associations,c=e.shSchedule,d=e.showVersionData,p=e.hostsAccess,g=e.policiesData,v=e.defaultHotspotPolicy,h=e.trafficShape,b=e.dhcp,_=f.mwsMembers||[],y=_.reduce(function(e,t){var n=t.mac;return Object.assign({},e,_defineProperty({},n,!0))},{});if(f.allPermanentIps=a.getObjectFromArray("mac","ip",b),f.allInterfaces=t,f.allInterfacesOptions=l.getInterfaceOptions(t),f.ifaceLabelById=a.getObjectFromArray("id","label",f.allInterfacesOptions),f.hostsAccess=p,f.speedLimit){var S=n.get(h,"unknown-host",{}),w=u.getModelFromRciData(S);f.speedLimit.viewValue=u.getModelViewValue(w)}var C=n.reduce(h.host,function(e,t){var i=t.mac;return Object.assign({},e,_defineProperty({},i,n.omit(t,["mac"])))},{}),E=n.isEmpty(v)?m.constants.DEFAULT_PERMIT_POLICY:v.access||v.policy,I=o.map(function(e){if(!e.mws)return e;var t=e.mws,i=t.cid;(e=Object.assign({},e,{},t)).mwsMemberCid=i;var a=n.find(_,{cid:i});return a&&(e.mwsMemberMac=a.mac),e});I=I.map(function(e){var t=!e.registered&&E===k||e.registered&&e.access===k;if(!e.registered&&e.interface){var o=n.get(e,"interface.name",""),s=n.find(g,{interface:o})||{};s.access&&s.access===k&&(t=!0)}var l=e.active,c=e.hostname,d=e.mac,p=e.name||c||d,m="down"===e.link?"doffline":e.ap?e.via!==e.mac?"cadapter":"":"bwire",v=a.getSplittedTime(e.uptime),h=!1;if(e.ap){var b=e.mwsMemberCid?n.get(e,"mws.uptime",0):n.get(n.find(r,{mac:d}),"uptime",0);h=a.getSplittedTime(b)}var _=e.ht,y=e.mode,S=e.txss,w=e.speed,I=e.security,T=e.port,O=e.registered,L=e.access,x=e.ip,R=e.schedule,$={accessDenied:t,active:l,mac:d,name:p,hostname:c,uptimeCalculated:v,wifiUptime:h,ht:_,mode:y,txss:S,speed:w,security:I,port:T,connectionBy:m,registered:O,access:L,ip:x,schedule:R,savedSchedule:R,mwsMemberMac:e.mwsMemberMac,mwsMemberCid:e.mwsMemberCid,macAccess:e["mac-access"]||{},ap:e.ap||"",rxbytesCalculated:M(e.rxbytes),txbytesCalculated:M(e.txbytes),speedInMb:e.txrate&&Number(e.txrate)||e.speed||"",txrate:Boolean(e.ap)&&e.txrate?e.txrate:e.speed,isConnectedByWiFi:Boolean(e.ap),isWired:!e.ap,isPermanentIp:Boolean(f.allPermanentIps[e.mac]),systemMode:e["system-mode"]||!1,description:e.interface&&a.getInterfaceL10n(e.interface)||""};if($.isConnectedByWiFi){var F=n.startsWith(e.ap,i.MASTER_5G)?A:P;$._11=e._11,$.rssi=e.rssi,$.rssiQuality=a.rssiToQuality(e.rssi),$.wifiImage=a.rssiToLevel(e.rssi),$.wifiRange=e.ap?N.range[F]:"",$.wifiRangeTranslated=e.ap?a.getTranslation("wifi.".concat(F)):"",$.connectionBy="awifi"+F}if(D){var V=C[$.mac];$.speedLimitModel=u.getModelFromRciData(V),$.speedLimitViewValue=u.getModelViewValue($.speedLimitModel)}return $});var O=a.getObjectFromArray("mac","cid",_);I=I.map(function(e){var t=e.mac;if(!O[t])return e;var i=n.find(_,{mac:t}),a=e;return i&&(a.ip=i.ip),O[t]=a,a}),f.allDevicesIpAddresses=I.filter(function(e){return e.ip}),f.mwsServiceIsEnabled&&(I=I.filter(function(e){return!y[e.mac]})),I=I.map(function(e){return e.mwsMemberMac&&O[e.mwsMemberMac]&&(e.mwsMember=O[e.mwsMemberMac]),e}),f.registeredDevices=I.filter(function(e){return e.registered&&e.access===T}),f.notRegisteredDevices=I.filter(function(e){return!e.registered}),f.devicesLocked=I.filter(function(e){return e.registered&&e.access===k}),f.allDevices=I,f.mwsControllerDescription=n.get(d,"description",""),f.schedulesData=n.mapValues(c,function(e){return s.isActive(e)}),x()})};return function(){(f=this).poll={start:x,stop:R},$()}}e.$inject=["$timeout","$rootScope","_","NDM","utils","router","schedules","components","interfaces","wirelessAcl","wifiOptions","deviceListRciPaths","trafficShaperModel","policies"],angular.module("keenetic").factory("requestManager",e)}(),function(){function e(e,t,n,i,a,o,s,r,l,c,d,p,u,m,f,g){var v=this,h=c.constants,b=h.DEFAULT_DENY_POLICY,_=h.DEFAULT_PERMIT_POLICY;n.$on("$destroy",function(){e.invoke(v,"poll.stop")}),v.progress=0,v.getDeviceCard=u.getDeviceCard.bind(v),v.wifiIsSupported=Boolean(l.corewireless),v.HAS_WIFI_5=f.HAS_WIFI_5,v.l10n={};var y=function(){var e=o.getTranslation("policies.deny-policy");v.l10n={notRegisteredDescription:o.getTranslation("devices-list.device-card.not-registered.description",null,{defaultDenyPolicy:e}),policySelectDescription:o.getTranslation("devices-list.policy-select-description",null,{defaultDenyPolicy:e}),noDnsConfigured:o.getTranslation("devices-list.device-card.no-dns-configured",null,o.l10n.getSrefChunks("controlPanel.netFilter",{},"ref"))}};n.$on("$destroy",i.$on("$translateChangeSuccess",function(){return a(y)})),y(),n.$on("$destroy",r.clearAclConfigurationCache),v.CONSTANT_PORT_ID=m.PORT_ID,v.ALL_PORTS_PROTOCOL_ID=d.ALL_PORTS_PROTOCOL_ID,v.DEFAULT_DENY_POLICY=b;var S={isVisible:!1,name:"",mac:"",policy:_,permissions:{},resetState:function(){S.permissions={},S.name="",S.mac="",S.policy=_},show:function(){S.resetState(),S.isVisible=!0,a(e.get(v,"offlineRegistrationForm.offlineDeviceName.revalidate",angular.noop))},close:function(){S.isVisible=!1},getHostAclRequestsList:function(t,n,i){return e.chain(t).pickBy(function(t,n){return t&&e.get(v,["segmentsData",n,"acl","type"])!==r.ACL_TYPE_NONE}).map(function(e,t){return r.queryBuilder.saveHostPermission(t,n,e,i[t].acl.type)}).value()},register:function(){var n=S.mac.toLowerCase().replace(/[^a-f0-9]+/g,""),i=e.toArray(n.match(/.{1,2}/g)).join(":");return u.registerDeviceAndSetPolicy(S.name,i,S.policy).then(function(){var e=S.getHostAclRequestsList(S.permissions,i,v.segmentsData);return e.length>0?s.postAndSave(e):t.when(!0)}).then(S.close)}};v.offlineRegistrationPopup=S,v.isNameUnique=function(t){if(t&&e.find(v.allDevices||[],function(e){return e.name===t}))return"errors.name-exists"},v.isMacUnique=function(t){if(t&&e.find(v.allDevices||[],function(e){return e.mac===t}))return"errors.mac-address-used"},v.mwsServiceIsEnabled=!1,v.mwsMembers=[],v.updateMwsData=function(){return g.getMwsMembers().then(function(e){v.mwsMembers=e.members,v.mwsServiceIsEnabled=e.serviceIsEnabled})},v.save=function(){m.saveDeviceList({internetFilter:v.internetFilter,defaultProfile:v.dnsFilter.value,trafficShapeData:e.get(v,"speedLimit.model"),trafficcontrolAvailable:v.trafficcontrolAvailable}).then(function(){v.advancedForm.$setPristine(),v.speedLimit.isOpen=!1})},v.reset=function(){v.advancedForm.reset()};m.getActiveDnsFilterData().then(function(e){var t,n=e.enabled;v.dnsFilter={value:e.defaultProfile},v.dnsFiltersAvailable=e.available.length>0,v.internetFilter=n,n&&(t=n,m.getDnsOptions(t).then(function(e){v.dnsFilter.options=e}))}),m.onload.call(v).then(r.getAclConfiguration).then(function(e){v.segmentsData=e.segments}).then(g.getMwsMembers).then(function(e){v.mwsMembers=e.members,v.mwsServiceIsEnabled=e.serviceIsEnabled,v.progress=100}),p.call(v),n.$on("$destroy",function(){a.cancel(v.allDeviceTimeout),a.cancel(v.tableRulesTimeout)}),v.openSecondaryPopup=!1,v.isDeviceCardVisible=!1,v.pageName="devicesList"}e.$inject=["_","$q","$scope","$rootScope","$timeout","utils","router","wirelessAcl","components","policies","portForwarding","requestManager","deviceCardManager","deviceList","wifiOptions","MWSService"],angular.module("keenetic").controller("DevicesListController",e)}(),function(){function e(e,t,n,i,a,o,s,r,l,c,d,p,u){var m=p.SHOW_RC_IP_TRAFFIC_SHAPE_PATH,f=d.SERVICE,g={},v=function(){g={ghz:a.getTranslation(r.UNIT.GHZ),mhz:a.getTranslation(r.UNIT.MHZ),mbitps:a.format.getSpeedUnit(r.UNIT_SCALE.MEGA),mwsControllerTitle:a.getTranslation("wifi-system.devices-table.header.controller"),sysmode:{},noName:a.getTranslation("devices-list.device-has-no-hostname"),inetAccessBlockedOnSchedule:a.getTranslation("devices-list.device-card.internet-access-blocked-on-schedule"),online:a.getTranslation("devices-list.status.online"),offline:a.getTranslation("devices-list.connection.no-connect"),blocked:a.getTranslation("devices-list.status.blocked"),blockedOffline:a.getTranslation("devices-list.status.blocked-offline")},i.forEach(r.SYSMODE,function(e){g.sysmode[e]=a.getTranslation("devices-list.system-mode.".concat(e))})};e.$on("$translateChangeSuccess",function(){return t(v)}),v();var h;return{onload:function(){function e(e){this.header={deviceName:{tdClass:"table__col table__col--1",label:"devices-list.title-device",sortArguments:[e,"deviceName","_name_"]},ipAddress:{tdClass:"table__col table__col--2 cssMax1line",label:"devices-list.title-address",sortArguments:[e,"ipAddress","ip"]},segment:{tdClass:"table__col table__col--3 cssMax1line",label:"devices-list.title-activity",sortArguments:[e,"segment","interface","connectionBy"]},connection:{tdClass:"table__col table__col--4 cssMax1line",label:"devices-list.title-connection",sortArguments:[e,"connection","speedInMb"]},speedLimit:{tdClass:"table__col table__col--5 cursor-default",label:"devices-list.title-speed-limit"},empty:{tdClass:"table__col table__col--6 cursor-default"}},this.defaultSort="deviceName"}(h=this).isDeviceCardVisible=!1,h.trafficcontrolAvailable=c.trafficcontrol,h.miniupnpdAvailable=c.miniupnpd,h.speedLimit={isOpen:!1,model:null};var t=function(e){return(e.active?'<a\n                        href="http://'.concat(e.ip,'"\n                        target="_blank"\n                        class="external-link special-mode-keenetic"\n                        onclick="event.stopPropagation()">'):'<span class="special-mode-keenetic help-text">')+g.sysmode[e.systemMode]+(e.active?"</a>":"</span>")},n=function(e){if(!h.mwsServiceIsEnabled||e.isWired)return"";var t=e.mwsMember,n=a.getTranslation("devices-list.connected-via-mws-member",null,{mwsMember:a.generateExternalLinkHtml("".concat(a.escapeHtml(t.name||t.hostname)),"http://".concat(t.ip),{onclick:"event.stopPropagation()"})});return'<br/><span class="via-mws-msg">'.concat(n,"</span>")},s=function(e){return!h.mwsServiceIsEnabled||e.isWired?"":e.active?'<br/><span class="via-mws-msg">'.concat(a.getTranslation("devices-list.connected-via-mws-member",null,{mwsMember:h.mwsControllerDescription}),"</span>"):""},d=function(e){return{_isWiFi_:function(e){return e.isDeviceOnline&&e.isConnectedByWiFi},_name_:function(t){switch(e){case"unreg":return t.hostname||t.mac;case"reg":case"block":return t.name}},hostname:function(e){return e.name||e.mac},ip:function(e){return l.ip2num(e.ip||"255.255.255.255")},isDeviceOnline:function(e){return e.active||!1}}},p=function(e){return e.ip&&"0.0.0.0"!==e.ip?e.ip:""};h.sortBy={reg:{alwaysSortBy:["_isWiFi_","isDeviceOnline"],firstSort:"speedInMb",secondSort:"hostname",getter:d("reg")},unreg:{alwaysSortBy:["isConnectedByWiFi","isDeviceOnline"],firstSort:"speedInMb",getter:d("unreg")},block:{alwaysSortBy:["isConnectedByWiFi","isDeviceOnline"],firstSort:"speedInMb",secondSort:"hostname",getter:d("block")}},h.tableObj={unreg:new e("unreg"),reg:new e("reg"),block:new e("block"),sortFunction:function(e,t,n,i){h.sortBy[e].sortFiled===t?h.sortBy[e].isReverse=!h.sortBy[e].isReverse:h.sortBy[e].isReverse=!1,h.sortBy[e].sortFiled=t,h.sortBy[e].firstSort=n,h.sortBy[e].secondSort=i||n}};var f=function(e){return"indicator-".concat(e.accessDenied?"block-":"").concat(e.active?"online":"offline")};h.tableObj.unreg.body={deviceName:{tdClass:"table__col table__col--1",tdData:function(e){var i=e.name===e.mac,o=e.active?g.online:g.offline,r=(i?g.noName:e.name).replace(/"/g,'\\"');return'<span class="overflow-transperent">'+a.generateIconHtml(f(e),o)+'<span title="'.concat(a.escapeHtml(r),'" class="device-name')+(e.accessDenied?"--blocked":"")+'">'+(i?'<span class="help-text">'.concat(g.noName,"</span>"):a.escapeHtml(e.name))+"</span>"+(e.systemMode?t(e):"")+(e.mwsMember?n(e):s(e))+"</span>"}},ipAddress:{tdClass:"table__col table__col--2 table-ip",tdData:function(e){return p(e)+(e.mac?a.generateHtmlTag("div",e.mac,{class:"table__note __hint-text"}):"")}},segment:{tdClass:"table__col table__col--3",tdData:function(e){var t,n=e.active||"cadapter"===e.connectionBy,i=e.description;return n?(t='<div class="table__col--long-name overflow-transperent">',t+='<div class="table__note table__col-item--long-name">'+(i||" ")+"</div>","bwire"===e.connectionBy?t+='<div class="__hint-text">'.concat(a.getTranslation("devices-list.connection.wired"),"</div>"):e.isConnectedByWiFi?t+='<div class="__hint-text">'.concat(a.getTranslation(e.wifiRangeTranslated),"</div>"):t+="",t+="</div>"):t='<div class="table__note help-text table__col-item--long-name">'+a.getTranslation("devices-list.connection.no-connect")+"</div>",t}},connection:{tdClass:"table__col table__col--4",tdData:function(e){if("doffline"===e.connectionBy||e.isConnectedByWiFi&&!e.active)return"-";var t="<div>",n=e.active||"cadapter"===e.connectionBy;return e.isConnectedByWiFi?t+=a.wifi.formatConnectionData(e,g):e.txrate?t+="<span>"+e.txrate+" "+a.format.getSpeedUnit(r.UNIT_SCALE.MEGA)+"</span>":t+="-",n&&"bwire"===e.connectionBy&&e.port&&(t+='<div class="__hint-text">'.concat(a.getTranslation("devices-list.connected-to-port",null,{port:e.port}),"</div>")),t+="</div>"}},speedLimit:{tdClass:"table__col table__col--5",tdData:function(){return i.get(this,"speedLimit.viewValue","-")}.bind(h)},empty:{tdClass:"table__col table__col--6",tdData:function(){return'<i class="icon icon--pencil icon--table-pencil"></i>'}}},h.tableObj.reg.body={deviceName:{tdClass:"table__col table__col--1",tdData:function(e){var i=e.active?g.online:g.offline,o=e.name.replace(/"/g,'\\"');return'<span class="overflow-transperent">'+a.generateIconHtml(f(e),i)+'<span title="'.concat(a.escapeHtml(o),'" class="device-name').concat(e.accessDenied?"--blocked":"",'">')+"".concat(a.escapeHtml(e.name),"</span>")+(e.systemMode?t(e):"")+(e.mwsMember?n(e):s(e))+(e.accessDenied?'\n                    <br class="invisible-on-mobile"/>\n                    <span\n                        title="'.concat(g.inetAccessBlockedOnSchedule,'"\n                        class="device-row__internet-access-blocked-on-schedule"\n                    >\n                        ').concat(g.inetAccessBlockedOnSchedule,"\n                    </span>"):"")+"</span>"}},ipAddress:{tdClass:"table__col table__col--2 table-ip",tdData:function(e){var t=p(e),n="";return t&&(n+=" "+t,"permanent"==(e.isPermanentIp?h.allPermanentIps[e.mac]===e.ip?"permanent":"changed":"dynamic")&&(n+=a.generateHtmlTag("span","",{class:"icon icon--push-pin-blue-fill",title:a.getTranslation("devices-list.device-card.permanent-ip")}))),n+=a.generateHtmlTag("div",e.mac,{class:"table__note __hint-text"})}},segment:h.tableObj.unreg.body.segment,connection:h.tableObj.unreg.body.connection,speedLimit:{tdClass:"table__col table__col--5",tdData:function(e){return e.speedLimitViewValue||"-"}},empty:h.tableObj.unreg.body.empty},h.tableObj.block.body={deviceName:{tdClass:"table__col table__col--1",tdData:function(e){var i=e.active?g.blocked:g.blockedOffline,o=e.name.replace(/"/g,'\\"');return'<span class="overflow-transperent">'+a.generateIconHtml("indicator-block-".concat(e.active?"online":"offline"),i)+'<span title="'.concat(a.escapeHtml(o),'" class="device-name').concat(e.accessDenied?"--blocked":"",'">')+"".concat(a.escapeHtml(e.name),"</span>")+(e.systemMode?t(e):"")+(e.mwsMember?n(e):s(e))+"</span>"}},ipAddress:h.tableObj.reg.body.ipAddress,segment:h.tableObj.unreg.body.segment,connection:h.tableObj.unreg.body.connection,speedLimit:{tdClass:"table__col table__col--5",tdData:function(){return""}},empty:h.tableObj.unreg.body.empty},h.tableObj.reg.header.speedLimit.tdClass="table__col table__col--5 cssMax1line",h.tableObj.reg.header.speedLimit.sortArguments=["reg","speedLimit","speedLimitInKb"];var v=a.toRciQueryList([c.trafficcontrol?m:{}]);return o.postToRciRoot(v).then(function(e){return{trafficShape:i.get(e,"0.".concat(m),{})}}).then(function(e){var t=e.trafficShape;h.speedLimit.model=u.getModelFromRciData(i.get(t,"unknown-host",{})),h.speedLimit.viewValue=u.getModelViewValue(h.speedLimit.model),i.invoke(h,"advancedForm.$setPristine")})},PORT_ID:{single:1,range:2},getActiveDnsFilterData:function(){return d.getServicesInitData()},getDnsOptions:function(e){var t,n=(_defineProperty(t={},f.YANDEXDNS,"ya"),_defineProperty(t,f.ADGUARD_DNS,"adguard-dns"),_defineProperty(t,f.CLOUDFLARE_DNS,"cloudflare-dns"),_defineProperty(t,f.SKYDNS,"sky"),_defineProperty(t,f.SAFEDNS,"safedns"),t);return function(e){return d.getFilterProfiles(e).then(function(t){return t[e].profiles})}(e).then(function(t){return i.map(t,function(t){var i="netFilter.".concat(n[e],".title"),o=a.getTranslation(i)+" / "+a.getTranslation(t.label);return{id:t.id,label:o}})})},saveDeviceList:function(e){if(h.advancedForm.$invalid)return!1;var t=e.internetFilter,a=e.defaultProfile,s=e.trafficShapeData;if(!e.trafficcontrolAvailable)return d.setDeviceProfiles(t,[{profile:{id:a}}]);var r=u.getRciQueryObjectFromModel(s,{checkIsEnabled:!1,hasSchedule:!1}),l=i.set({},"ip.traffic-shape.unknown-host",r);return n.all([o.postAndSave(l),d.setDeviceProfiles(t,[{profile:{id:a}}])])},DNS_SERVICES:f}}e.$inject=["$rootScope","$timeout","$q","_","utils","router","NDM","CONSTANT","ipV4Service","components","netFilter","deviceListRciPaths","trafficShaperModel"],angular.module("keenetic").factory("deviceList",e)}(),function(){angular.module("keenetic").factory("deviceListRciPaths",function(){return{SHOW_RC_SKY_DNS_ASSIGN_PATH:"show.rc.skydns.assign",SHOW_RC_YANDEX_DNS_ASSIGN_PATH:"show.rc.yandexdns.assign",SHOW_RC_ADGUARD_DNS_ASSIGN_PATH:"show.rc.adguard-dns.assign",SHOW_RC_SAFE_DNS_ASSIGN_PATH:"show.rc.safedns.assign",SHOW_RC_SKY_DNS_ENABLE_PATH:"show.rc.skydns.enable",SHOW_RC_YANDEX_DNS_ENABLE_PATH:"show.rc.yandexdns.enable",SHOW_RC_ADGUARD_DNS_ENABLE_PATH:"show.rc.adguard-dns.enable",SHOW_RC_SAFE_DNS_ENABLE_PATH:"show.rc.safedns.enable",SHOW_IP_HOTSPOT_PATH:"show.ip.hotspot",SHOW_UPNP_REDIRECT_PATH:"show.upnp.redirect",SHOW_INTERFACE_PATH:"show.interface",SHOW_ASSOCIATIONS_PATH:"show.associations",SHOW_SCHEDULE_PATH:"show.schedule",SHOW_VERSION_PATH:"show.version",SHOW_RC_IP_STATIC_PATH:"show.rc.ip.static",SHOW_RC_SERVICE_PATH:"show.rc.service",SHOW_RC_IP_HOTSPOT_HOST_PATH:"show.rc.ip.hotspot.host",SHOW_RC_IP_HOTSPOT_POLICY_PATH:"show.rc.ip.hotspot.policy",SHOW_RC_IP_HOTSPOT_DEFAULT_POLICY_PATH:"show.rc.ip.hotspot.default-policy",SHOW_RC_IP_TRAFFIC_SHAPE_PATH:"show.rc.ip.traffic-shape",SHOW_RC_IP_DHCP_PATH:"show.rc.ip.dhcp",SHOW_RC_INTERFACE_SSID_PATH:"show.rc.interface.ssid"}})}(),function(){function e(e,t,n,i,a,o,s,r,l,c,d,p,u,m,f,g,v,h,b,_){var y,S,w=h.SHOW_IP_HOTSPOT_PATH,C=h.SHOW_UPNP_REDIRECT_PATH,E=h.SHOW_RC_IP_STATIC_PATH,I=h.SHOW_RC_SERVICE_PATH,T=h.SHOW_RC_IP_HOTSPOT_HOST_PATH,k=h.SHOW_RC_INTERFACE_SSID_PATH,P=h.SHOW_ASSOCIATIONS_PATH,A=l.SERVICE,D=(_defineProperty(y={},A.SAFEDNS,"token"),_defineProperty(y,A.SKYDNS,"token"),_defineProperty(y,A.ADGUARD_DNS,"type"),_defineProperty(y,A.CLOUDFLARE_DNS,"type"),_defineProperty(y,A.YANDEXDNS,"type"),y),O={},N=function(){O={anyPort:a.getTranslation("devices-list.ports.all-ports")}};t.$on("$translateChangeSuccess",function(){return e(N)}),N();var L=function(e,t){return c.set({},"known.host",{name:e,mac:t})},x=function(e,t){var n=e.mac;return c.chain(e.macAccess).pickBy(function(e,n){var i=c.get(t,"".concat(n,".acl.type"),p.ACL_TYPE_NONE);return e&&i!==p.ACL_TYPE_NONE}).map(function(e,i){return p.queryBuilder.saveHostPermission(i,n,e,c.get(t,"".concat(i,".acl.type")))}).value()},R=function(e){var t=e.mac,n=x(e,S.segmentsData),i=c.get(e,"wifiBandRestrictions",{}),a=_.getWifiBandRestrictionQueries(i,t),s=[L(e.newName,t),u.queryCtor.setHostPolicy(e.policy,{mac:t})].concat(_toConsumableArray(n),_toConsumableArray(a));return o.postAndSave(s).then(function(){S.segmentsData=_.updateSegmentsData(S.segmentsData,i,t),W()})},M=function(e){var t=c.find(S.allInterfaces,function(t){return t.id===e||t["interface-name"]===e});return t?S.ifaceLabelById[t.id]:e},$=function(e,t,n){var i=n&&n.mac||S.deviceCard&&S.deviceCard.mac,o=n&&n.ip||S.deviceCard&&S.deviceCard.ip,s="devices-list.ports.protocols.";return angular.isArray(t)||(t=t.entry||[]),S.allIpStatic=function(e){var t=S.registeredDevices.concat(S.devicesLocked);return angular.forEach(e,function(e){for(var n=0,i=t.length;n<i;n++)if(e["to-host"]===t[n].mac){e.name=t[n].hostname;break}}),e}(t),[t=(t=t.filter(function(e,t){var n,r;if(e["to-host"]===i||e["to-address"]===o){e.id=t+1,e.rangeObj={},e.isToAddress=e["to-address"]===o;var l=c.find(S.allInterfacesOptions,function(t){return t.id===e.interface||t["interface-name"]===e.interface});if(e.interfaceName=l?l.label:e.interface,angular.isDefined(e["end-port"])&&e.port!==e["end-port"])for(e.range=e.port+" - "+e["end-port"],n=Number(e.port);n<=Number(e["end-port"]);n++)e.rangeObj[n]&&(e.rangeObj[n].secondProtocol=e.protocol),e.rangeObj[n]={protocol:e.protocol};else e.port!==e["end-port"]&&e.port!==e["to-port"]||r&&(r=e.protocol+"/"+e.port,e.advancedInfo=a.getTranslation(s+r,s)),e.rangeObj[e.port]&&(e.rangeObj[e.port].secondProtocol=e.protocol),e.rangeObj[e.port]={protocol:e.protocol};return!0}return!1})).map(function(e){return e.enabled=!e.disable,e.onToggle=function(t){return g.toggleItem(e.index,t).then(function(){return e.enabled=t})},e}),e=e.entry?e.entry.filter(function(e){return e.interfaceName=e.interface,e["to-address"]===o}):[]]},F=function(){S.upnpTable.length>0?K("upnp"):S.tableObjUpnp={header:{},body:{}},S.ipStatic.length>0?K():S.tableObjTransfering={header:{},body:{}}},V=function t(n){var i=a.toRciQueryList([r.miniupnpd?C:{},E]);o.postToRciRoot(i).then(function(e){return{upnp:c.get(e,"0.".concat(C),{}),ipStatic:c.get(e,"1.".concat(E),{})}}).then(function(i){var a=i.upnp,o=i.ipStatic,s=$(a,o);S.ipStatic=s[0],S.upnpTable=s[1],F(),e.cancel(S.tableRulesTimeout),S.openSecondaryPopup||(S.tableRulesTimeout=e(t,1500)),n&&n()})},U=function(e){var t=function(){S.deviceCard=e,S.updateAdvancedInfo=G,G(),S[e.status+"DevicesForm"].$setPristine(),S.isDeviceCardVisible=!0};r.dpi&&e.isDpiEnabled?o.get(["show ntce hosts"]).spread(function(n){n=n.host||[],angular.isArray(n)||(n=[n]);for(var i=0,a=n.length;i<a;i++)if(n[i].mac===e.mac){e.os=n[i].device_name,e.apps=n[i].flow_types&&n[i].flow_types.flow_type;break}t()}):t()},B=function(e){var t=a.toRciQueryList([P]);n.all([o.postToRciRoot(t),l.getServicesInitData()]).spread(function(t,n){var o,s,r,l,p=(o=t,{showAssociations:c.get(o,"0.".concat(P),{})}),u=n.enabledServiceData,m=p.station||[],f=m.length;if(s={},function(e){for(var t=0,n=e.length;t<n;t++)angular.isDefined(e[t].ip)&&!s[e[t].ip]&&(s[e[t].ip]={name:e[t].name||e[t].hostname||e[t].mac})}(S.allDevicesIpAddresses),S.allIpArray=s,S.ipValidationInController=function(){var e=S.registeredDevicesForm&&S.registeredDevicesForm.ipAddressInput||{},t=S.deviceCard.ip;if(t){var n=!1;if(angular.forEach(S.allInterfaces,function(e){e.address&&e.address===t&&(n=!0)}),n)return s("busy");if(e.modified&&S.allIpArray[t])return s("busy");var i=!1,o=d.ip2num(t);if(angular.forEach(S.allInterfaces,function(e){if(!i&&e.mask&&e.address){var t=d.ip2num(e.mask),n=d.ip2num(e.address)&t;(o&d.ip2num(e.mask)|0)===n&&(i=!0)}}),!i)return s("errors.in-net")}function s(e){if(!1!==e)return{message:a.getTranslation(e)}}},u.enable){var g=u.name,v=c.find(u.assign,{host:e.mac});e.dnsFilter={value:c.get(v,D[g],n.defaultProfile)}}S.isIpValid=!0;for(var h=0;h<f;h++)if(m[h].mac===e.mac){e.uptime=a.getSplittedTime(m[h].uptime),e.rate=m[h].ht,e.txrate=m[h].txrate+" "+a.format.getSpeedUnit(i.UNIT_SCALE.MEGA);break}return r=e,(l=S.allPermanentIps[r.mac])&&(r.isPermanentIp=!0,r.oldIp=r.ip,r.ip=l),U(e)})},W=function(){m.call(S),e.cancel(S.tableRulesTimeout),e.cancel(S.advancedInfoTimeout),S.upnpTable=[],S.ipStatic=[],c.get(S,[S.deviceCard.status+"DevicesForm","$setPristine"],angular.noop)(),S.deviceCard={},S.registeredDevicesForm.modified=S.isDeviceCardVisible=!1},H=function(e,t){s.confirm("devices-list.delete-all-rules-confirm").then(function(){var n=[];return c.forEach(S.allIpStatic,function(i){i["to-host"]!==e&&i["to-address"]!==t||n.push(i.index)}),o.postAndSave(n.map(function(e){return c.set({},"ip.static",{index:e,no:!0})})).then(function(){S.ipStatic=[],S.allIpStatic=c.filter(S.allIpStatic,function(e){return n.includes(e.index)})})})},q=function(){s.confirm("devices-list.delete-registration-confirm").then(function(){var e=[];S.deviceCard.isPermanentIp&&e.push({url:"ip dhcp host",data:{mac:S.deviceCard.mac,no:!0}}),e.push({url:"known host",data:{name:S.deviceCard.name,mac:S.deviceCard.mac,no:!0}}),e.push("system configuration save"),o.post(e).spread(function(){var e=S.deviceCard.mac;S.segmentsData&&(S.segmentsData=c.mapValues(S.segmentsData,function(t){var n=c.get(t,"mac.band",[]).filter(function(t){return t.mac!==e});return c.set(t,"mac.band",n)})),S.closeDeviceCard()})})},j=function(e){var t=[],i=e?S.deviceCard.registeredName:S.deviceCard.newName,a=function(){var e=c.get(S,"deviceCard.speedLimitModel"),n=b.getRciQueryObjectFromModel(e),i=c.set({},"ip.traffic-shape",{mac:S.deviceCard.mac,host:n});t.push({url:"",data:i})},s=null,r={deviceName:function(){t.push({url:"known host",data:{name:i,mac:S.deviceCard.mac}})},deviceAccess:function(){s||(s={mac:S.deviceCard.mac},t.push({url:"ip hotspot host",data:s}));var e=S.deviceCard.policy,n=e===u.constants.DEFAULT_DENY_POLICY;e===u.constants.DEFAULT_PERMIT_POLICY||e===u.constants.DEFAULT_DENY_POLICY?(s[e]=!0,s.policy=!1):(s.policy=e,s.permit=!0),s.schedule=!!S.deviceCard.schedule&&S.deviceCard.schedule,n&&(S.deviceCard.isNotDeviceBlocked=!1,S.deviceCard.status="blocked"),t.push({url:"ip hotspot host",data:s})},permanentIp:function(){-1===t.indexOf("ip dhcp host")&&t.push({url:"ip dhcp host",data:S.deviceCard.isPermanentIp?{mac:S.deviceCard.mac,ip:S.deviceCard.ip}:{mac:S.deviceCard.mac,no:!0}})},dnsFiltration:function(){l.setDeviceProfiles(S.internetFilter,[{device:!0,profile:{id:S.deviceCard.dnsFilter.value,mac:S.deviceCard.mac}}]),c.invoke(S,"registeredDevicesForm.dnsFiltration.$setPristine"),c.invoke(S,"blockedDevicesForm.dnsFiltration.$setPristine")}},d=n.when(!0);S.wifiIsSupported&&(S.segmentsData||(d=p.getAclConfiguration().then(function(e){S.segmentsData=e.segments})),d=d.then(function(){var e=x(S.deviceCard,S.segmentsData);t.push.apply(t,_toConsumableArray(e))})),r.schedule=r.deviceAccess,r.policy=r.deviceAccess;var m=function(e){for(var t=0,n=e.length;t<n;t++)r[e[t].$name]&&r[e[t].$name]()};switch(r.ipAddressInput=r.permanentIp,S.deviceCard.status){case"registered":if(!S.registeredDevicesForm.modified||S.registeredDevicesForm.$invalid)return!1;m(S.registeredDevicesForm.modifiedModels),a();break;case"blocked":if(!S.blockedDevicesForm.modified||S.blockedDevicesForm.$invalid)return!1;m(S.blockedDevicesForm.modifiedModels),a();break;case"notRegistered":if(S.notRegisteredDevicesForm.$invalid)return!1;r.deviceName(),r.deviceAccess()}d.then(function(){if(S.HAS_WIFI_5){var e=_.getWifiBandRestrictionQueries(S.deviceCard.wifiBandRestrictions,S.deviceCard.mac);t.push.apply(t,_toConsumableArray(e)),S.segmentsData=_.updateSegmentsData(S.segmentsData,S.deviceCard.wifiBandRestrictions,S.deviceCard.mac)}t.push("system configuration save"),o.post(t).then(function(){return S.closeDeviceCard()})})},K=function(e){var t,n,i=function(e,t){this.header={},this.body={};for(var n,i=0,a=e.length;i<a;i++)n=e[i],this.header[n]={tdClass:"table__col-2",label:n},this.body[n]={tdClass:"table__col-2 cssMax1line",tdData:t[i]}};"upnp"===e?(t=["devices-list.ports.interface","devices-list.ports.external-port","devices-list.ports.protocol","devices-list.ports.internal-port"],n=[function(e){return a.escapeHtml(M(e.interface))},function(e){return e.range||e.port},function(e){return e.protocol.toUpperCase()},function(e){return e.range||e["to-port"]||e.port}],S.tableObjUpnp=new i(t,n)):(t=[" ","devices-list.ports.interface","devices-list.ports.external-port","devices-list.ports.internal-port","devices-list.ports.table-title-description"],n=[function(e){return M(e.interface)},function(e){var t="";return e.protocol&&(t+=e.protocol.toUpperCase()),(e.range||e.port)&&(t&&(t+="/"),t+=e.range||e.port),t},function(e){return e.range||e["to-port"]||e.port},function(e){return e.comment||e.advancedInfo}],S.tableObjTransfering=new i(t,n))},G=function t(){var n=c.get(S,"deviceCard.mac"),i=a.toRciQueryList([c.set({},w,{mac:n}),S.deviceCard.isWired?{}:P,r.dpi?I:{}]);o.postToRciRoot(i).then(function(e){return{host:c.get(e,"0.".concat(w,".host.0"),!1),associations:c.get(e,"1.".concat(P,".station"),!1),isDpi:c.get(e,"2.".concat(I,".ntce"),!1)}}).then(function(i){var o=i.host,s=i.associations,r=i.isDpi;if(o){if(S.deviceCard.additionalInfoObj||(S.deviceCard.additionalInfoObj={calculated:{},received:{},transferred:{}}),S.deviceCard.additionalInfoObj.calculated.info=a.getSplittedTime(o.uptime),!S.deviceCard.isWired){S.deviceCard.additionalInfoObj.wifiTime||(S.deviceCard.additionalInfoObj.wifiTime={});var l=o.mws?c.get(o,"mws.uptime",0):c.get(c.find(s,{mac:n}),"uptime",0);S.deviceCard.additionalInfoObj.wifiTime.info=a.getSplittedTime(l)}S.deviceCard.isDpiEnabled=!0===r,S.deviceCard.additionalInfoObj.received.info=a.format.size(Number(o.rxbytes)),S.deviceCard.additionalInfoObj.transferred.info=a.format.size(Number(o.txbytes)),e.cancel(S.advancedInfoTimeout),S.openSecondaryPopup||(S.advancedInfoTimeout=e(t,1500))}})};return{getDeviceCard:function(t,n,s){if(!("A"===s.target.tagName||t.systemMode&&function(e,t){for(e=e.parentElement;e&&!e.classList.contains(t);)e=e.parentElement;return e}(s.target,"table__col--1"))){(S=this).speedLimit.isOpen=!1,S.closeDeviceCard=W,S.updateTableWithRules=V,S.openPopupRule=v.bind(this),S.deleteAllDeviceForwardingRules=H,S.deleteRegistration=q,S.saveConfiguration=j,S.registerDevice=R,S.ipValidationInBlockedController=function(){var e=S.blockedDevicesForm&&S.blockedDevicesForm.ipAddressInput||{},t=S.deviceCard.ip;if(t){var n=!1;if(angular.forEach(S.allInterfaces,function(e){e.address&&e.address===t&&(n=!0)}),n)return s("busy");if(e.modified&&S.allIpArray[t])return s("busy");var i=!1,o=d.ip2num(t);if(angular.forEach(S.allInterfaces,function(e){if(!i&&e.mask&&e.address){var t=d.ip2num(e.mask),n=d.ip2num(e.address)&t;(o&d.ip2num(e.mask)|0)===n&&(i=!0)}}),!i)return s("errors.in-net")}function s(e){if(!1!==e)return{message:a.getTranslation(e)}}},S.wakeOnLanInProgress=!1,S.wakeOnLan=function(t){S.wakeOnLanInProgress=!0,o.post({url:"ip/hotspot/wake",data:{mac:t}}).then(function(){e(function(){S.wakeOnLanInProgress=!1},3e3)})},S.portForwardingColumns={enabled:{title:"portforwarding.list-columns.enabled",width:40,directive:{name:"ndm-toggle",options:{"label-on":"","label-off":"","ng-attr-call-on-change":"row.onToggle",name:"rule-{{row.index}}-"}},clickable:!0},interfaceName:{title:"devices-list.ports.interface",modify:function(e){return a.escapeHtml(M(e))}},externalPort:{title:"devices-list.ports.external-port",modify:function(e,t){if(!t.protocol)return O.anyPort;var n=t.protocol===i.PROTOCOL.TCP_UDP,a=(n?i.TCP_UDP_LABEL:t.protocol).toUpperCase();if(!t.range&&!t.port)return a;var o=n?" ":"/";return"".concat(a).concat(o).concat(t.range||t.port)}},internalPort:{title:"devices-list.ports.internal-port",modify:function(e,t){return t.protocol?t.range||t["to-port"]||t.port:O.anyPort}},comment:{title:"devices-list.ports.table-title-description",modify:function(e,t){return a.escapeHtml(t.comment||t.advancedInfo)}}};var l=a.toRciQueryList([r.miniupnpd?C:{},E,r.dpi?I:{},T,t.ap?c.set({},k,{name:t.ap}):{}]);o.postToRciRoot(l).then(function(e){return{upnp:c.get(e,"0.".concat(C),!1),ipStatic:c.get(e,"1.".concat(E),[]),isDpi:c.get(e,"2.".concat(I,".ntce"),!1),hotspotHost:c.get(e,"3.".concat(T),{}),ssid:c.get(e,"4.".concat(k),"")}}).then(function(o){var s=o.upnp,r=o.ipStatic,l=o.isDpi,d=o.hotspotHost,p=o.ssid;s=s||[],angular.isArray(s.entry)&&s.entry.sort(function(e,t){return parseInt(e.port,10)===parseInt(t.port,10)?0:parseInt(e.port,10)>parseInt(t.port,10)?1:-1}),e.cancel(S.allDeviceTimeout),t.isConnectedByWiFi?(t.ssid=p,t.connectionInfo="Wi-Fi "+t.wifiRange+" "+a.getTranslation("rate")+" ("+t.ssid+")"):t.connectionInfo=a.getTranslation("devices-list.connection.wired"),t.isDpiEnabled=!0===l,t.hostnameClear=t.hostname,t.registeredName=t.name,t.hostname=t.hostname||t.mac,t.name=t.name||t.hostname,t.newName=t.name||t.hostname,t.mac===t.newName&&(t.newName=""),t.status=n,t.isNotDeviceBlocked="blocked"!==n,t.wifiBandRestrictions={};var m=c.find(d,{mac:t.mac});if(t.policy=("blocked"===n?c.get(m,"access")||c.get(m,"policy"):c.get(m,"policy")||c.get(m,"access"))||u.constants.DEFAULT_PERMIT_POLICY,t.getDeviceStatus=function(e){return{notRegistered:"help-text",registered:"status-ok",blocked:"status-problem"}[e]},S.validationOnUsedName=function(){for(var e="notRegistered"!==S.deviceCard.status?"registeredName":"newName",t=0,n=S.allDevices.length;t<n;t++)if(S.allDevices[t].name===S.deviceCard[e]&&S.deviceCard.mac!==S.allDevices[t].mac&&S.allDevices[t].registered)return{message:"errors.name-exists"};return{}},"registered"!==n&&t.isNotDeviceBlocked||(t.additionalInfoObj={name:{label:"devices-list.device-card.additional-info.name-in-network",info:t.hostnameClear||"-"},connection:{label:"devices-list.title-connection",info:t.connectionInfo},mac:{label:"devices-list.device-card.blocked.mac",info:t.mac},ip:{label:"devices-list.device-card.IP-address",info:t.ip},calculated:{label:"devices-list.components.uptime",info:t.uptimeCalculated},wifiTime:{label:"devices-list.components.wifi-uptime",info:t.wifiUptime,isHidden:t.isWired},transferred:{label:"devices-list.data-transferred",info:t.txbytesCalculated},received:{label:"devices-list.data-received",info:t.rxbytesCalculated}},function(t,n,a){var o,s,r,l=c.filter(S.allInterfaces,g.isValidSourceIface).map(function(e){return e.id}),d=S.allInterfacesOptions.filter(function(e){return-1!==l.indexOf(e.id)}).map(function(e,t){return{name:e.label,interfaceName:e.id,rename:(c.find(S.allInterfaces,{id:e.id})||{})["interface-name"],id:t+1}}),p=g.getProtocolOptions().map(function(e,t){return e.id===g.ALL_PORTS_PROTOCOL_ID&&(s=t+1),e.id===i.PROTOCOL.ICMP&&(r=t+1),e.name=e.label,e.id=t+1,e});S.portTransfer={allProtocolsOptionIndex:s,hidePortInputsOptions:[s,r],hidePortInputs:!1,format:{value:1},interfaces:{array:d,value:0},protocols:{array:p,value:0},protocolsLen:p.length,interfacesLen:d.length,description:""},o=$(t,n,a),S.ipStatic=o[0],S.upnpTable=o[1],F(),"registered"!==a.status&&"blocked"!==a.status||(S.tableRulesTimeout=e(V,1500))}(s,r,t)),"registered"!==n&&t.isNotDeviceBlocked)return t.additionalInfoObj={name:{label:"devices-list.device-card.additional-info.name-in-network",info:t.hostname||t.hostname.mac},connection:{label:"devices-list.title-connection",info:t.connectionInfo},mac:{label:"devices-list.device-card.blocked.mac",info:t.mac,isHidden:t.isWired},calculated:{label:"devices-list.components.uptime",info:t.uptimeCalculated,isHidden:t.isWired},wifiTime:{label:"devices-list.components.wifi-uptime",info:t.wifiUptime,isHidden:t.isWired},transferred:{label:"devices-list.data-transferred",info:t.txbytesCalculated,isHidden:t.isWired},received:{label:"devices-list.data-received",info:t.rxbytesCalculated,isHidden:t.isWired}},U(t);B(t)})}},registerDevice:function(e,t){return o.postAndSave(L(e,t))},registerDeviceAndSetPolicy:function(e,t,n){return o.postAndSave([L(e,t),u.queryCtor.setHostPolicy(n,{mac:t})])}}}e.$inject=["$timeout","$rootScope","$q","CONSTANT","utils","router","modal","components","netFilter","_","ipV4Service","wirelessAcl","policies","requestManager","interfaces","portForwarding","popupRuleManager","deviceListRciPaths","trafficShaperModel","deviceWifiBand"],angular.module("keenetic").factory("deviceCardManager",e)}(),function(){function e(e,t,n,i,a,o,s,r,l,c,d,p,u,m,f,g,v,h,b,_,y){var S=this,w=_.PINGCHECK_INSTALLED,C=l.PORT_ROLE,E=h.WAN_PORT_IS_LEFTMOST,I=o.current.name,T=v.getTypesSelect().filter(function(e){return e.id!==v.PPP_TYPE.NONE}).map(function(e){return e.id}).join(" / ");S.PORT_ROLE_FIELD_PREFIX="role__",S.PINGCHECK_INSTALLED=w,S.DOT1X_INSTALLED=y.DOT1X_INSTALLED,S.usedSubnets=[],S.connectionsList=[],S.showInterfaceData={},S.rciInterfaceData={},S.newConnectionModel={},S.newConnectionCanBeAdded=!1,S.userData={},S.status={},S.l10n={},S.isReady=!1;var k=function(){S.interfaceIdToLabelMap=m.getInterfaceIdToLabelMap(S.showInterfaceData),S.getIforL10n=m.getPortIforL10nFunction(S.interfaceIdToLabelMap),S.l10n.pppTitle=c.getTranslation("wired.title-ppp-config",null,{pppType:" (".concat(T,")")})};i.$on("$destroy",a.$on("$translateChangeSuccess",function(){return t(k)})),S.error={inetVlan:"",voipVlan:"",iptvVlan:"",iptvVlan2:""},S.ui={isLocked:!1,showVlans:!1,lock:function(){return S.ui.isLocked=!0,e.when(!0)},unlock:function(){return S.ui.isLocked=!1,e.when(!0)}};var P=function(){0===S.tabs.list.length&&(S.model=null)};S.tabs={list:[],createNewTab:function(){var e=S.tabs.list.length?"  ".concat(S.tabs.list.length+1):"";return{id:"",label:"".concat(c.getTranslation("wired.new-connection-description")).concat(e)}},canNotAddTab:function(){return!S.newConnectionCanBeAdded||s.get(S,"model.isNew")},canSwitchTab:function(e,t,n,i){return!s.get(i,"isNew")&&!s.get(S,"form.modified")||p.confirmLeave(S.cancel)},onSelectTab:function(e,n){if(S.status={},n){if(s.get(n,"isNew")){var i=angular.copy(S.newConnectionModel);return i.general.description=n.label,i.isNew=!0,S.model=i,S.model.currentInetPort!==s.get(S.userData,"port",-1)?S.setFormPristine():(S.ui.lock(),p.confirm("switchport-is-used-to-connect-to-the-device","confirm-using-switchport").then(function(){return S.ui.unlock().then(S.setFormPristine)},function(){S.ui.unlock(),S.cancel()}))}var a=n.id,r=s.find(S.connectionsList,{id:a});if(!r)return S.tabs.list=S.tabs.list.filter(function(e){return e.id!==a}),void console.warn("Can't find connection corresponding to the ".concat(JSON.stringify(n)," [").concat(e,"]"));r.usedSubnets=S.usedSubnets.filter(function(e){var t=e.ifaceId;return!s.includes([r.id,r.pppId],t)}).map(function(e){return Object.assign({},e,{label:S.interfaceIdToLabelMap[e.ifaceId]})}),S.model=r,t(S.setFormPristine),_.getRequester().poll()}else o.go(I,{tab:null})}},S.setFormPristine=function(){return s.invoke(S,"form.$setPristine")},S.validation={onVlanChange:function(e){e&&t(S.validation.checkAllVlans)},checkAllVlans:function(){var e=s.chain(b.MODEL_VLAN_FIELDS).map(function(e){return{value:s.get(S,["model",e]),prop:e}}).filter("value").groupBy("value").value(),t=_slicedToArray(s.partition(e,function(e){return e.length>1}),2),n=t[0];t[1].forEach(function(e){var t=e[0].prop;S.error[t]=""}),n.forEach(function(e){var t=e.map(function(e){return e.prop}).sort();s.isEqual(t,["inetVlan","iptvVlan"])?t.forEach(function(e){S.error[e]=""}):t.forEach(function(e){S.error[e]="errors.vlan-used"})})},checkVoipVlan:function(e){if(s.chain(S.model.portmap).filter(function(e){return!e.isBusy}).some({role:l.PORT_ROLE.VOIP}).value()&&!e)return"errors.vlan-allowed"},getNextInetPort:function(e){return(E?s.find:s.findLast)(S.model.portmap,function(e){return e.role===C.FREE&&e.portIndex!==S.userData.port},e)||s.find(S.model.portmap,function(e){return e.role===C.FREE})},onPortRoleChanged:function(t,n,i){var a,o=i.replace(S.PORT_ROLE_FIELD_PREFIX,""),r=s.find(S.model.portmap,{portName:o})||{},l=r.portIndex,c=l===S.userData.port,d=e.when(!0);n===C.INET&&(a=l===S.model.currentInetPort?S.validation.getNextInetPort(r.portOrder):s.find(S.model.portmap,{portIndex:S.model.currentInetPort})),(c&&t!==C.FREE||s.get(a,"portIndex")===s.get(S.userData,"port",-1))&&(d=p.confirm("switchport-is-used-to-connect-to-the-device","confirm-using-switchport")),d.then(function(){(a&&(a.role=C.INET),t!==C.VOIP&&n!==C.VOIP||(s.invoke(S.form,"portmap.voipVlan.revalidate"),S.model.voipVlan||(S.ui.showVlans=!0)),t===C.INET)&&(s.find(S.model.portmap,function(e){return!e.isBusy&&e.role===C.INET}).role=C.FREE)},function(){r.role=n})}},S.onPppChange=function(e,t,n){s.includes(n,"ppp-type")&&S.model.savedPppType!==t&&delete S.model.ppp.ip.mtu},S.cancel=function(){S.ui.isLocked||(S.ui.lock(),S.model.isNew?(_.getRequester().cancelCurrentPollRequest(),S.tabs.list=S.tabs.list.filter(function(e){return!e.isNew}),P()):S.form.reset(),t(S.ui.unlock))},S.save=function(){if(!S.ui.isLocked)return S.ui.lock(),_.getRequester().stopPolling(),_.saveConnection(S.model).then(function(e){return e.error&&d.error("wired.failed-to-save-settings"),A()}).finally(S.ui.unlock)},S.toggleWiredConnectionState=function(e){return S.ui.lock().then(function(){return m.toggleState(S.model.id,e)}).then(function(){return _.getRequester().poll()}).finally(function(){return S.ui.unlock()})},S.deleteConnection=function(){if(!S.ui.isLocked)return S.ui.lock(),p.confirm(c.getTranslation("sure")).then(function(){return _.getRequester().stopPolling()}).then(function(){return _.deleteConnection(S.model)}).then(A).then(function(){return c.scrollTop()}).then(function(){return d.success("wired.delete-success",1500)}).finally(S.ui.unlock)};var A=function(){return _.getConfiguration().then(function(e){var t,n,i,a=e.connectionsList,o=e.newConnectionModel,r=e.usedSubnets,l=e.newConnectionCanBeAdded,c=e.rciInterfaceData,d=e.showInterfaceData;S.usedSubnets=r,S.connectionsList=a,S.newConnectionModel=o,S.newConnectionCanBeAdded=l,S.showInterfaceData=d,S.rciInterfaceData=c,S.setFormPristine(),k(),S.tabs.list=a.map(function(e){return{id:e.id,label:e.general.description}}),P(),t=[g.getWhoamiQuery(),g.getHostsQuery()],n=t.map(function(e){return e.query}),i=t.map(function(e){return e.responsePath}),_.getRequester().registerCallback(n,function(e){var t=s.get(e[0],i[0],{}),n=s.get(e[1],i[1],[]);S.userData=g.combineUserData(n,t)}),_.getRequester().registerDynamicCallback(function(){if(!S.model||S.model.isNew)return[];var e=S.model.id,t=S.model.pppId,n=S.model.currentInetPort,i=S.model.rename,a=S.model.savedSchedule,o=S.model.savedPingcheckProfile,s=m.getIspConnectionStateQueryData({main:e,ppp:t,phy:n,alias:i},{schedule:a,pingcheck:o});return{query:s.query,dataForCallback:s}},function(e,t){if(S.model&&!S.model.isNew){var n=m.processIspConnectionStateResponse(e[0],t),i=n.names,a=n.data;S.status=m.determineIspConnectionState(i,a)}})}).finally(function(){t(function(){_.getRequester().startPolling()},500),S.isReady=!0,S.progress=100})};A(),i.$on("$destroy",function(){return _.stopRequester()})}e.$inject=["$q","$timeout","$parse","$scope","$rootScope","$state","_","NDM","CONSTANT","utils","notification","modal","debounce","interfaces","components","usersService","ifacePppModel","wiredConstants","ipoeConnectionModel","wiredIpoeService","dot1x"],angular.module("keenetic").controller("WiredController",e)}(),function(){function e(e,t,n,i,a,o,s,r,l,c,d,p){var u={no:!0},m=d.getConst(),f=a.MASTER,g=a.MASTER_5G,v=m.HAS_WIFI_5?[f,g]:[f],h=a.STA,b=a.STA_5G,_=m.HAS_WIFI_5?[h,b]:[h],y=a.sysmode===o.SYSMODE.ROUTER,S=a.sysmode===o.SYSMODE.CLIENT,w=l.IP_CONFIG_MODE,C=Boolean(s.pingcheck)&&y,E=!1,I=v.reduce(function(e,t){return Object.assign({},e,_defineProperty({},t,[]))},{});return{constant:{HAS_WIFI_5:m.HAS_WIFI_5,STATIONS:_,MASTER_IFACE_IDS:v,IS_IN_ROUTER_MODE:y,IS_IN_CLIENT_MODE:S},wps:{start:function(e){var n=[];return e.forEach(function(e){n.push(t.set({},["interface",e],{up:!0})),n.push(t.set({},["interface",e],{wps:!0})),n.push(t.set({},["interface",e,"wps","button"],{direction:"receive"}))}),i.post({url:"",data:n})},setState:function(e,n){var a=[];return e.forEach(function(e){a.push(t.set({},["interface",e,"wps"],{no:!n}))}),i.post({url:"",data:a})},getStatus:function(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=angular.copy(e).map(function(e){return{name:e,wps:{status:{}}}});return n&&(a=a.concat(v.map(function(e){return{name:e}}))),i.post({url:"",data:t.set({},"show.interface",a)}).then(function(i){var a={},o={},s=!1,r=1e3,l=1e3;if(e.forEach(function(e,n){a[e]=t.get(i,["show","interface",n],{});var o=t.get(a[e],"wps.status.wps",{});"active"===o.status&&(s=!0,l=Math.min(l,Number(o.left)),r=Math.min(r,Number(o.duration)))}),n){var c=e.length;o.hwstate={},v.forEach(function(e,n){o.hwstate[e]=t.get(i,["show","interface",n+c,"hwstate"])})}return o.started=s,o.left=l,o.duration=r,o.state=a,o})}},getData:function(){var e={},o={},s=angular.copy(_),l={show:{interface:[{},{wps:_.map(function(e){return{name:e,status:{}}})}],rc:{interface:{}}}};return C&&(l.show.rc["ping-check"]={}),i.post({url:"",data:l}).then(function(i){var l=i.show,u=l.rc,m=u.interface,b=t.get(l,"interface.0.interface",{}),_=t.get(l,"interface.1.wps",[]);r.getInterfaceOptions(b);var y=C?t.get(u,"ping-check.profile",{}):{},w={state:{},hwstate:{}};y.default=c.getFormDataPrototype(),v.forEach(function(n){var i=m[n]||{};i.id=n,i.name=n,i.hwstate=(b[n]||{}).hwstate,i.channelWidth=t.get(i,"channel.width"),w.hwstate[n]=i.hwstate,e[n]=i});var E=!1,I={},T=1e3,k=1e3;s.forEach(function(e,i){var a=angular.copy(m[e])||{},s=_[i]||{},r=t.get(s,"status.wps",{});"active"===r.status&&(E=!0,k=Math.min(k,r.left),T=Math.min(T,r.duration)),I[e]="active"===r.status,w.state[e]=b[e],w.state[e].wps=s,a.id=e,a.name=e,a.schedule=a.schedule||"",a.bssid=t.get(m[e]||{},"mac.bssid"),a.savedBssid=a.bssid,a.activeBssid=(b[e]||{}).ap,a.savedSsid=a.ssid,a.description=t.get(a,"description",""),a.isUp=t.get(a,"up",!1);var l=t.get(a,"ip.global.order");a.order=l,a.savedOrder=l;var d=t.get(a,"schedule","");a.schedule=d,a.savedSchedule=d,a.masterId=e===h?f:g,a.password=t.get(a,"authentication.wpa-psk.psk",""),a.encryptionMethod=p.getSecurityProtocolOption(a),a.encryption=a.encryption||{},a.encryption.key=a.encryption.key||[],a.pingcheckProfile=t.get(a,"ping-check.profile",!1),a.pingcheck=!!C&&c.getFormDataFromRawData(a,y),a.pingcheck&&!a.pingcheck.port&&(a.pingcheck.port=0);var u=b[e];u&&(a.state=n.getInterfaceStatus(u)),o[e]=a}),w.started=E,w.startedOn=I,w.left=k,w.duration=T;var P=d.WISP_SECURITY_OPTIONS;if(S){var A=(t.find(m,{rename:a.LAN})||{}).ip;o=t.mapValues(o,function(e){return e.ip=angular.copy(A),e})}return{masterIfaceIds:v,stationIfaceIds:s,masterInterfaces:e,wifiStations:o,allInterfaces:b,ifaces:m,unsavedTabName:n.getTranslation("wifiClient.new-network"),encryptionsList:P,pingcheck:y,wps:w}})},getState:function(e,n){var a,o=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s={},r=angular.isArray(n)&&n.length>0,l=e.map(function(e){return{name:e,wps:{status:{}}}});return r&&(l=l.concat(n.map(function(e){return{name:e}}))),a=l.length,l=l.concat(e.map(function(e){return{name:e}})),s.interface=l,C&&o&&(s["ping-check"]={}),i.post({url:"",silent:Boolean(o),data:{show:s}}).then(function(i){var s=i.show,l=s.interface||[],c={},d={},p={state:{},hwstate:{}},u=!1,m=1e3,f=1e3;if(e.forEach(function(e,n){c[e]=l[a+n]||{},c[e].wps=t.get(l[n],"wps",{});var i=t.get(c[e],"wps.status.wps",{});"active"===i.status&&(u=!0,f=Math.min(f,Number(i.left)),m=Math.min(m,Number(i.duration)))}),p.state=angular.copy(c),r){var g=e.length;n.forEach(function(e,t){p.hwstate[e]=(l[t+g]||{}).hwstate})}d.started=u,d.left=f,d.duration=m,d.state=c,d.hwstate=angular.copy(p.hwstate);var v=t.get(s,"ping-check.pingcheck",[]).filter(function(e){return e.profile===o.profile});return 0===v.length?p.pingcheck=!1:p.pingcheck=t.get(v,[0,"interface",o.ifaceId],!1),p.wps=d,p})},getStationState:function(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=(e||"").split("/")[0],s={interface:[{name:e},{name:o},{name:e,wps:{status:{}}}],rc:{interface:[{name:e},{name:o}]}};return C&&n&&(s["ping-check"]={profile:n.profile}),a&&(s.schedule=[{name:a}]),i.post({url:"",silent:Boolean(n),data:{show:s}}).then(function(i){var s=i.show,l=s.interface||[],c=t.get(s,"rc.interface",[]),d=l[0],p=l[1],u={},m={},f={state:{},hwstate:{}},g=!1,v=1e3,h=1e3,b=t.get(l[2],"wps.status.wps",{}),_=a?t.get(s,"schedule.0.schedule."+a+".action",[]):[],y=!!n&&t.get(s,"ping-check.pingcheck.0",{});u[e]=d,f.state[e]=d,f.hwstate[o]=(p||{}).hwstate,f.pingcheck=t.get(y,["interface",e],!1);var S=r.determineIspConnectionState({main:e,ppp:"",phy:o,schedule:a,pingcheck:!!n&&n.profile},{show:{main:d,ppp:!1,phy:p},config:{main:t.get(c,[0,"interface",e],{}),ppp:!1,phy:t.get(c,[1,"interface",o],{})},schedule:_,pingcheck:f.pingcheck||{},internetStatus:!1});return"active"===b.status&&(g=!0,h=Math.min(h,Number(b.left)),v=Math.min(v,Number(b.duration))),m.started=g,m.left=h,m.duration=v,m.state=u,m.hwstate=angular.copy(f.hwstate),f.ispState=S,f.wps=m,f})},setIfaceDescription:function(e,n){return i.postAndSave(t.set({},["interface",e,"description"],n))},setIfaceIp:function(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o={global:n?{order:Number(n)}:{auto:!0}};return a&&(o.address={no:!0,dhcp:!0}),i.postAndSave(t.set({},["interface",e,"ip"],o))},getIfaceConfig:function(e){return i.get("interface?name="+e).then(function(t){return t[e]})},saveConfiguration:function(n,o,s){var r=n.id,m=S?a.LAN:r,f=[],g=e.when(!0),v={up:{no:!n.isUp},ssid:{ssid:n.ssid},mac:{bssid:n.bssid||u},schedule:n.schedule||u,description:n.description||u},h=n.encryptionMethod,b=h===d.SECURITY_PROTOCOL.WEP?n.encryption.key:n.password;v=angular.extend(v,p.getEncryptionConfig(h,b,1));var _=o.channelWidth,E=p.master.WIFI_DEFAULT_CHANNEL;_&&(E={channel:E,width:_},f.push(t.set({},["interface",o.id],E)));var I=l.getSavingQuery(angular.copy(n.ipModel),m,{noIpv6:!0}).interface[m].ip;return delete I.tcp,delete I.mtu,delete I.global,y&&-1!==n.order&&t.set(I,"global.order",n.order),g.then(function(){var e=[];if(C&&(e=c.getSavingQueries(n.pingcheck,r,!0,s)),S){var o,l=n.ipModel,d=l.mask,p=l.ip,m=l.mode===w.AUTO,g="192.168.1.3"===p&&"255.255.255.0"===d;o=m&&g?{address:p,mask:d,dhcp:!0}:m&&!g?[u,{dhcp:!0}]:[{dhcp:!1},{address:p,mask:d}],f.push(t.set({},["interface",a.LAN,"ip","address"],o))}else v.ip=I;return f.push(t.set({},["interface",r],v)),f=f.concat(e),i.postAndSave(f)})},resetStation:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=[function(e){var n={up:u,ssid:{ssid:""},mac:{bssid:u},description:u,encryption:p.ap.getResetEncryptionJson(),authentication:{"wpa-psk":{psk:"",no:!0}},wps:u,ip:{address:{address:"",mask:"",no:!0},global:u,gateway:u,"name-server":u},schedule:u};return y||delete n.ip.global,t.set({},["interface",e],n)}(e)];return C&&n&&(o=o.concat(c.getClearPingcheckQueries(e,a))),i.postAndSave(o)},getSiteSurvey:function(n){if(E)return e.when(I[n]);E=!0;var o=t.set({},"show.site-survey",{name:n});return i.postToRciRoot(o).then(function(e){var i=t.get(e,"".concat("show.site-survey",".ap_cell"),[]);return I[n]=i.map(function(e){return e.channel=Number(e.channel),e.wifiType=n===a.MASTER?d.WIFI_BAND_2_GHZ:d.WIFI_BAND_5_GHZ,e}),E=!1,I[n]})}}}e.$inject=["$q","_","utils","router","NDM","CONSTANT","components","interfaces","ifaceIpModel","pingcheckModel","wifiOptions","wifiSettingsService"],angular.module("keenetic").factory("wifiClientService",e)}(),function(){function e(e,t,n,i,a,o,s,r,l,c,d,p,u,m,f,g,v,h){var b=this,_=f.constant.IS_IN_ROUTER_MODE,y=f.constant.IS_IN_CLIENT_MODE,S=Boolean(p.pingcheck)&&_,w=function(){b.l10n={unitGhz:r.getTranslation(s.UNIT.GHZ),wepKey:r.getTranslation("wifiClient.key"),selectNetwork:r.getTranslation("wifiClient.network-select"),pskPlaceholder:r.getTranslation("wifiClient.create-password"),wireless:r.getTranslation("wifiClient.wireless"),range:g.getAllBandsL10n(),mwsControllerWarning:r.getTranslation("wifiClient.mws-controller-warning")}};t.$on("$destroy",n.$on("$translateChangeSuccess",function(){return i(w)}));t.$on("$destroy",n.$on(s.events.IFACE_ORDER_VALUE_REPAIR,function(e,t,n){var a=!o.get(b,"data.order")||-1===o.get(b,"data.order");if(t&&!o.get(t,"$touched")&&a){t.$setPristine(!1);var s=o.get(n,"".concat(t.$name,".selectbox_").concat(t.$name));s&&i(function(){o.invoke(s,"$setPristine"),s.modified=!1})}}));var C=function(){var t=b.form;if(!t)return e.when(!1);t.$setPristine();var n=e.defer();return i(function(){o.invokeMap(t.modifiedChildForms,"$setPristine"),t.modified=!1,t.modifiedModels=[],t.modifiedChildFormsCount=0,n.resolve(!0)}),n.promise},E=function(){return o.get(b,"form.$setSubmitted()",angular.noop)},I=g.SECURITY_PROTOCOL,T=g.isWep,k=g.isAnyWpaPsk;b.isWep=T,b.isAnyWpaPsk=k,b.progress=0,b.sysmode=d.sysmode,b.isInRouterMode=_,b.isInClientOrRouterMode=y||_,b.stateUpdateTimeout=3e3,b.siteSurveryUpdateTimeout=1e4,b.pingcheckAvailable=S,b.wpsStarted=!1,b.wpsFinished=!0,b.additionalSettingsBlockIsVisible=!1,b.data={},b.autoOrder={},b.ui={isLocked:!1,lock:function(){return b.ui.isLocked=!0,e.when(!0)},unlock:function(){return b.ui.isLocked=!1,e.when(!0)}};var P,A,D=function(e){b.wifiStations=e.wifiStations,b.masterInterfaces=e.masterInterfaces,b.allInterfaces=e.allInterfaces,b.ifaces=e.ifaces,b.encryptionsList=e.encryptionsList,b.pingcheck=e.pingcheck,b.tabs=N(),i(function(){if(b.tabs&&b.tabs.length>0){var e=b.tabs[b.activeTabIdx]?b.activeTabIdx:0;b.setActiveTab(e,b.tabs[e])}C()})};P={isVisible:!1,progressBarIsVisible:!1,isClosing:!1,isStopping:!1,ifaceState:{},progress:100,time:0,timeStr:"00:00",timeoutHandler:null,stations:[],masterIfaceIds:[]},A=angular.copy(P),P.initPopupState=function(e,t,n){if(0===o.filter(e.hwstate,function(e){return"on"===e}).length)return f.wps.setState(t,!1);o.forEach(e.state,function(e,t){var i=o.get(e,"wps.status.wps",{});P.ifaceState[t]={wasUp:"up"===e.state,ssidOnWpsStart:e.ssid,wasConfigured:Boolean(i.configured),wpsStarted:Boolean(i.duration),wpsFinished:n&&!i.duration}}),b.wpsStarted=n;var i=function(){P.isVisible=!0,P.progressBarIsVisible=!0,b.wpsStarted=!0,b.wpsFinished=!1};n?(P.time=e.left,P.updateTime(),i()):f.wps.start(t).then(P.onUpdate).finally(i)},P.startWps=function(e){b.ui.lock(),P.reset(),P.stations=[b.data.id],P.masterIfaceIds=[b.data.masterId],e?P.initPopupState(e,P.stations,!0):f.getState(P.stations,P.masterIfaceIds).then(function(e){P.initPopupState(e.wps,P.stations,!1)})},P.updateTime=function(){if(b.wpsStarted||P.isVisible){P.time<0&&(P.time=0);var e=Math.floor(P.time/60),t=P.time%60;P.time--,P.timeStr=o.padStart(e,2,"0")+":"+o.padStart(t,2,"0"),P.timeoutHandler=i(P.updateTime.bind(P),1e3)}else P.timeoutHandler&&i.cancel(P.timeoutHandler)},P.reset=function(){P.timeoutHandler&&i.cancel(P.timeoutHandler),P=angular.extend(P,angular.copy(A))},P.close=function(e,t){var n=P.isStopping;return P.reset(),t?b.ui.unlock().then(function(){b.wpsStarted=!1,b.wpsFinished=!0,n||i(function(){return u.error("wifiClient.wps-popup.no-stations-configured")})}):P.stop(e)},P.stop=function(t){if(P.timeoutHandler&&i.cancel(P.timeoutHandler),!P.isStopping){P.isStopping=!0;var n=angular.copy(P.stations);return f.wps.setState(n,!1).then(function(){b.wpsStarted=!1}).then(function(){var t=[];return o.forEach(P.ifaceState,function(e,n){e.wasUp||t.push(n)}),t.length>0?m.toggleState(t,!1):e.when(!0)}).then(function(){if(t)return f.setIfaceDescription(b.data.id,b.data.ssid)}).then(f.getData).then(D).then(function(){return f.wps.setState(n,!0)}).then(function(){b.wpsFinished=!0}).finally(b.ui.unlock)}},P.onUpdate=function(){if(!P.isClosing){if(P.progress<=0)return P.progress=0,P.isClosing=!0,void P.close(null,!0);var t=[],n=[];f.getState(P.stations,P.masterIfaceIds).then(function(a){var s=a.wps;if(0===o.filter(s.hwstate,function(e){return"on"===e}).length)return P.reset(),void P.stop();if(P.isVisible&&!P.isClosing){var l=s.state,c={};P.stations.forEach(function(e){c[e]=P.ifaceState[e].wpsFinished}),P.stations.forEach(function(a){var s=o.get(l[a],"wps.status.wps",{}),d=P.ifaceState[a];if(s.duration)P.duration=s.duration,d.wpsStarted=!0,n.push(s.left),t.push(r.round(100*s.left/s.duration,1));else if(d.wpsStarted&&"active"!==s.status)if(!s.configured||d.wpsFinished)c[a]=!0;else{var p=e.when(!0);d.wpsFinished=!0,d.wasConfigured&&(p=f.getIfaceConfig(a).then(function(e){return e.ssid!==d.ssidOnWpsStart})),p.then(function(t){if(t){P.isClosing=!0,P.timeoutHandler&&i.cancel(P.timeoutHandler);var n=e.when(!0),o=b.data.savedOrder;n.then(function(){return f.setIfaceIp(a,o,!0)}).then(function(){return P.close(null,!1)})}})}}),o.every(o.values(c))&&(P.isClosing=!0,P.close(null,!0)),t.sort(),n.sort(),P.time||(P.time=n[0],P.updateTime()),P.progress=Math.min(t[0],99.99)}})}},b.wpsPopup=P;var O=function(e){return b.isInRouterMode?e.description||e.ssid||function(e){return"WISP ".concat(b.l10n.range[e===d.STA_5G?"5":"2"]," ").concat(b.l10n.unitGhz)}(e.id):(t=e.id,"".concat(b.l10n.range[t===d.STA_5G?"5":"2"]," ").concat(b.l10n.unitGhz," ").concat(b.l10n.wireless));var t},N=function(){return o.map(b.wifiStations,function(e,t){return{id:t,name:O(e)}})},L=function(t){w(),D(t),b.tabs=N();var n=0,o=b.tabs[0];if(a.params.tab)for(var s=0,r=b.tabs.length;s<r;++s){var l=b.tabs[s];if(a.params.tab===l.name){n=s,o=l;break}}if(b.setActiveTab(n,o),b.removeIfaceOnSave=!1,b.progress=100,C(),t.wps.started&&t.wps.left>3){var c=e.when(!0);if(!t.wps.startedOn[b.data.id]){for(var d=0,p=b.tabs[0],u=!1,m=0,f=b.tabs.length;m<f;++m){var g=b.tabs[m];if(t.wps.startedOn[g.id]){d=m,p=g,u=!0;break}}u&&(c=b.setActiveTab(d,p))}c.then(function(){b.wpsPopup.startWps(t.wps)})}else"off"!==b.masterInterface.hwstate||_||i(x,3e3)};t.$watch("::WCC.form",function(){return i(function(){b.isReady=!0},3e3)});var x=function(){return b.ui.lock().then(f.getData).then(L).finally(b.ui.unlock)};b.setActiveTab=function(t,n){if(n=n||b.tabs[0],b.popup.isVisible||(b.popup.table.data=[]),!n)return e.when(!0);l.reset(),b.activeTabName=n.name,b.data=angular.copy(b.wifiStations[n.id]),b.tabs[t].name=O(b.data),b.data.order=angular.isDefined(b.data.order)?b.data.order:b.autoOrder[n.id],b.data.ipModel=v.getFormDataFromRawData(b.data,!0),b.data.usedIpAddresses=m.getAllUsedSubnets(b.allInterfaces,b.ifaces,_?b.data.id:b.allInterfaces[d.LAN].id),_||(b.data.state=""),b.masterInterface=b.masterInterfaces[b.data.masterId];var a=e.defer();return i(function(){r.scrollTop(),C().then(function(){return d.DEVICE_IS_MWS_MEMBER?h.canExtenderSelectWifiChannel(b.data.masterId):e.when(!0)}).then(function(e){b.data.isWirelessMWSControllerLink=!e}).then(a.resolve),b.activeTabIdx=t,b.data.order!==b.data.savedOrder&&(b.autoOrder[n.id]=b.data.order)}),a.promise},b.canSwitchTab=function(){return!o.get(b,"form.modified")||c.confirmLeave(b.cancel)};var R,M,$=S?function(){var e=b.data;return!(!e.name||!e.pingcheckProfile)&&{ifaceId:e.id,profile:e.pingcheckProfile}}:angular.noop;b.updateState=function(){var e=$();return f.getStationState(b.data.id,e,b.data.savedSchedule).then(function(e){b.masterInterface.hwstate=e.hwstate[b.data.masterId],b.wpsPopup.isVisible||(b.data.ipStatus=e.ispState.ip,b.data.state=e.ispState.connection,b.data.pingCheckStatus=e.ispState.pingcheck,e.wps.started&&e.wps.left>3&&b.wpsPopup.startWps(e.wps))})},b.onToggleClick=function(e){return b.ui.lock().then(function(){if(b.data.isWirelessMWSControllerLink&&!e)return c.confirm(b.l10n.mwsControllerWarning)}).then(function(){return m.toggleState(b.data.id,e)}).then(function(){var t=b.wifiStations[b.data.id];t&&(t.isUp=e)}).finally(b.ui.unlock)},b.cancel=function(){b.ui.isLocked||(b.ui.lock(),o.get(b,"form.reset",angular.noop)(),b.ui.unlock())},b.save=function(){if(!b.ui.isLocked)return E(),b.ui.lock().then(function(){return f.saveConfiguration(b.data,b.masterInterface,b.ifaces)}).then(f.getData).then(D).finally(b.ui.unlock)},b.resetSettings=function(){if(!b.ui.isLocked)return c.confirm(r.getTranslation("sure")).then(function(){return E(),b.ui.lock().then(function(){return f.resetStation(b.data.id,b.data.pingcheck,b.ifaces).then(function(){b.autoOrder={}})}).then(f.getData).then(D).finally(b.ui.unlock)})},M={isVisible:!1,isProcessingUserChoice:!1,ssidFilter:"",table:{columns:{essid:{title:(R=function(e){return"wifiClient.site-survey-popup.table.".concat(e)})("essid"),modify:function(e,t){var n=b.data.savedBssid||b.data.activeBssid;return(e===b.data.ssid&&n===t.address?r.generateIconHtml("check-green"):"")+'<span class="wifiClient-site-survey-popup__ssid">'+(t.highlightedSsid||e)+"</span>"}},encryption:{title:R("encryption"),width:75,modify:function(e){return function(e){return e.replace("enabled","WEP")}(e).replace("disabled",b.encryptionsList[0].label)}},quality:{title:R("quality"),directive:"ndm-meter",width:75},ieee:{title:R("ieee"),width:55},channel:{title:R("channel"),width:85,modify:function(e){return String(e)}},address:{title:R("address"),width:130}},data:[],filteredData:[],sortBy:"quality",sortReverse:!0},show:function(){M.isVisible=!0},close:function(e){M.isProcessingUserChoice=!1,M.isVisible=!1,M.ssidFilter="",i(function(){b.networkIsSelected=e})},cancel:function(){M.isProcessingUserChoice||M.close(!1)},selectNetwork:function(e){if(!M.isProcessingUserChoice){M.isProcessingUserChoice=!0,b.data.ssid=e.essid,b.data.bssid="";var t,n=o.get(e,"encryption","").toLowerCase();t="disabled"===n?I.DISABLED:"enabled"===n?I.WEP:o.includes(n,"wpa3")?I.WPA3:n,b.data.encryptionMethod=t,b.data.password="",b.data.encryption.key.forEach(function(e){e.hex=""}),b.data.description!==b.data.savedSsid&&b.data.description||(b.data.description=b.data.ssid),b.popup.close(!0,!1)}},_filterAndHighlightTableData:function(e,t){if(!t)return e.map(function(e){return Object.assign({},e,{highlightedSsid:""})});var n=r.createMatchStrRegexp(t);return e.filter(function(e){var t=n.test(e.essid);return n.lastIndex=0,t}).map(function(e){return Object.assign({},e,{highlightedSsid:r.highlightMatch(e.essid,n)})})},filterTableData:function(e){M.table.filteredData=M._filterAndHighlightTableData(_toConsumableArray(M.table.data),e)},updateData:function(){return f.getSiteSurvey(b.data.masterId).then(function(e){M.table.data=e,M.filterTableData(M.ssidFilter)})}},b.popup=M,x()}e.$inject=["$q","$scope","$rootScope","$timeout","$state","_","CONSTANT","utils","router","modal","NDM","components","notification","interfaces","wifiClientService","wifiOptions","ifaceIpModel","MWSService"],angular.module("keenetic").controller("WifiClientController",e)}(),function(){function e(e,t,n,i){return{USSD_REGEXP:/^\*[0-9]+([0-9*])*#$/,getTabsList:function(e){return e.map(function(e){var i=e.id,a=e.description;return i===t.INTERNAL_LTE_ID&&a===t.INTERNAL_LTE_DESCRIPTION?{id:i,description:n.getTranslation("interface-translations.LTE-ISP")}:{id:i,description:a}})},sendRequest:function(e,t){var n={interface:e,request:t};return i.post({url:"ussd/send",data:n})}}}e.$inject=["_","NDM","utils","router"],angular.module("keenetic").factory("ussdService",e)}(),function(){function e(e,t,n,i,a,o,s,r,l,c){var d=this,p={modemIsOff:!1,modemStateIsOk:!1,modemStateUpdated:!1,simState:"",simStateIsInvalid:!1};d.progress=0,d.isReady=!1,d.showInterfaceList=[],d.tabs=[],d.selectedInterfaceState=Object.assign({},p),d.notificationUid="",d.selectedInterfaceId="",d.requestStrings={},d.responseStrings={};var u=function(){d.l10n={invalidRequest:o.getTranslation("ussd.messages.invalid-ussd-request"),requestFailed:o.getTranslation("ussd.messages.request-failed"),emptyResponse:o.getTranslation("ussd.messages.empty-response")}};n.$on("$destroy",function(){t.$on("$translateChangeSuccess",function(){return i(u)})}),u(),d.ui={isLocked:!1,isParentLocked:!1,lock:function(){return d.ui.isLocked=!0,e.when(!0)},unlock:function(){return d.ui.isLocked=!1,e.when(!0)}};var m=function(){var e=a.find(d.showInterfaceList,function(e){return e.id===d.selectedInterfaceId});d.selectedInterfaceState=e?c.processInterfaceState(e):Object.assign({},p);var t=d.selectedInterfaceState,n=t.modemIsOff,i=t.simState;t.simStateIsInvalid?d.notificationUid=r.warning("sms.invalid-sim-state.".concat(i),-1):n?d.notificationUid=r.warning("sms.previews.modem-is-off",-1):(r.hide(d.notificationUid),d.notificationUid=null)};d.onTabSelect=function(e,t){d.selectedInterfaceId=t.id,m()},d.isValidUssd=function(e){return e&&!s.USSD_REGEXP.test(e)?d.l10n.invalidRequest:""},d.sendUssdRequest=function(){return d.responseStrings[d.selectedInterfaceId]="",d.ui.lock().then(function(){var e=d.requestStrings[d.selectedInterfaceId];return s.sendRequest(d.selectedInterfaceId,e)}).then(function(e){var t="";t=e.ndmErrors?d.l10n.requestFailed:a.get(e,"response",d.l10n.emptyResponse),d.responseStrings[d.selectedInterfaceId]=t}).finally(d.ui.unlock)},d.resetRequestString=function(){d.requestStrings[d.selectedInterfaceId]=""},l.addQmiInterfacesListUpdateCallback(function(e){d.showInterfaceList=e,d.tabs=s.getTabsList(e),i(function(){m()}),d.requestStrings=d.tabs.reduce(function(e,t){var n=a.get(d.requestStrings,[t.id],"");return Object.assign({},e,_defineProperty({},t.id,n))},{}),d.responseStrings=d.tabs.reduce(function(e,t){var n=a.get(d.responseStrings,[t.id],"");return Object.assign({},e,_defineProperty({},t.id,n))},{}),d.isReady=!0,d.progress=100})}e.$inject=["$q","$rootScope","$scope","$timeout","_","utils","ussdService","notification","smsStatus","sms"],angular.module("keenetic").controller("UssdController",e)}(),function(){function e(e,t,n,i,a){var o=this;o.dsls=[],t.usbdsl&&o.dsls.push(a.USBDSL_IFACE);var s=e.filter(i.PORTS_MAP,function(e,t){return"DSL"===t});s.length&&s.forEach(function(e){return o.dsls.push(e.port)}),n.getShowIfaces(o.dsls).then(function(e){o.tabs=e.map(function(e){return{id:e.id,label:e.description||e.id}})})}e.$inject=["_","components","interfaces","NDM","usbdslConsts"],angular.module("keenetic").controller("DslsController",e)}(),function(){function e(e,t,n,i,a,o,s,r,l,c,d,p,u,m,f,g,v){var h=d.IS_DSL_DEVICE,b={no:!0},_=i.VDSL_CLIENT_OPMODE,y=i.VDSL_CLIENT_OPTION_ID,S=i.ALL_SERVICES,w=i.ROLES,C={},E=function(e){return f.chain(e).words().uniq().map(f.toNumber).filter(f.isInteger).value()},I=function(e,t){return{interface:_defineProperty({},e,t||{})}},T=function(e,t,n){var i={ip:{}},a=i.ip;return a.global=t&&n>-1?{enabled:!0,order:Number(n)}:b,I(e,i)},k=function(e,t){var n=C.ifaces[e].iseg.include,i=n?n.split(","):[],a=i.indexOf(t);return-1!==a&&i.splice(a,1),I(e,{iseg:{include:i.join(",")}})},P=function(e,t,n){var i;return i=0===t.length?b:n.map(function(e){var n;return _defineProperty(n={},e,!0),_defineProperty(n,"no",-1===t.indexOf(e)),n}),I(e,{olr:i})},A=function(e){var t={interface:{}};return f.forEach(C.ipoeData,function(n,i){t.interface[i]={ipoe:{parent:e,"inet-vlan":"","voip-vlan":"","iptv-vlan":"","voip-port":"","iptv-port":""}}}),t},D=function(n,d,m){var h,y,w,E,D,N=d.data,L=N.mode,x=n.data,R=x.inet,M=x.dsl,$=x.mode,F=$.mode.indexOf("vdsl")>-1,V=L.mode.indexOf("vdsl")>-1,U=F&&"server"===$.type,B=L.segment,W=M.iface,H=[],q=x.ppp,j=x.mode.segment,K=f.some(S.slice(1),function(e){return f.get(d,["data",e,"ports"],[]).length>0}),G=function(e,t){return a.getSavingQuery(t,e)},Y=function(e){H.push(I(e,{description:x.description===t.getTranslation("interface-translations.DSL-ISP")?v.WAN_DESCRIPTION:x.description}))},z=function(){var e=function(e){return f.includes(e.mode.mode,"vdsl")?e.inet.vlan?"Vlan"+e.inet.vlan:e.iptv.ports.length&&!e.iptv.vlan?"Bridge":"dsl":"pvc"};return e(x)!==e(N)};if(j=F&&"client"!==$.type&&j||!1,F){var Q=[];f.forEach(C.ifaces,function(e){-1===e.id.indexOf("Pvc")||e.role||Q.push(e.id)}),Q.length>0&&Q.forEach(function(e){H.push(f.set({},["interface",e,"ipvc"],b))})}if(!B||j===B&&j||H.push(k(B,W)),V&&!F&&H.push(A(m)),H.push((y={mode:F?U?"vdsl2-co":_:i.capabilityIdToOpmode(x.mode.operationMode||"adsl2")},F||(y.annex=M.annex||"auto"),I(W,{"operating-mode":y}))),x.dsl.isUsbdsl||H.push(P(W,f.get(x,"dsl.olr",[]),n.allOlrModes)),F&&H.push((w=f.get(M,"profiles",[]),E={carrier:M.carrier.length?M.carrier:b,profile:n.allVdslProfiles.map(function(e){return{profile:e,no:!f.includes(w,e)}})},U&&(E.psdmask={mask:M.psd}),I(W,{vdsl:E}))),F&&$.type!==i.VDSL_CLIENT_OPTION_ID&&K&&H.push(A(m)),F&&!j&&H.push(function(e){var t=C.ipoe.id||e;if(0===C.ipoe.id.indexOf("Bridge")&&x.inet.vlan){var n=I(t,{ipoe:{"iptv-port":""}}),i=W+"/Vlan"+x.inet.vlan;return n.interface[i]={ipoe:{parent:e,"inet-vlan":Number(x.inet.vlan)||"","voip-vlan":Number(x.voip.vlan)||"","iptv-vlan":Number(x.iptv.vlan)||"","voip-port":x.voip.ports.join(","),"iptv-port":x.iptv.ports.join(",")}},n}return I(t,{ipoe:{parent:e,"inet-vlan":Number(x.inet.vlan)||"","voip-vlan":Number(x.voip.vlan)||"","iptv-vlan":Number(x.iptv.vlan)||"","voip-port":x.voip.ports.join(","),"iptv-port":x.iptv.ports.join(",")}})}(m)),F||j||(D=[],S.forEach(function(e){var t=x[e].pvc,n=t.vpi,i=t.vci,a=t.encapsulation,o=n&&i,s=t.iface||!1;if(o||!s){if(o||s){s||(s=function(e){for(var t=0;;){var n=e+t;if(!C.ifaces[n]&&!f.includes(D,n))return n;t++}}(M.iface+"/Pvc"),D.push(s),t.iface=s);var r={up:!0,ipvc:{role:e.substring(0,4),port:x[e].ports.join(","),vpi:n,vci:i,encapsulation:a}};H.push(I(s,r))}}else H.push(I(s,{ipvc:b}))})),h=F?W+(R.vlan?"/Vlan"+R.vlan:""):R.iface,R.iface=h,F&&!R.vlan&&!x.iptv.vlan&&x.iptv.ports.length){h="Bridge"===C.ipoe.id.substring(0,6)?C.ipoe.id:function(){for(var e=0;C.ifaces["Bridge"+e];)e++;return"Bridge"+e}()}!j&&o.componentExists()||((q=q||{}).type=o.PPP_TYPE.NONE),j&&N.inet.iface?H.push(G(N.inet.iface,!1)):j||H.push(G(h,R.ip)),o.componentExists()&&o.getSavingQueriesArr(h,q,C.ifaces).forEach(function(e){return H.push(e)});var X,Z,J,ee,te=q&&q.type!==o.PPP_TYPE.NONE,ne=x.order,ie=R.pvc.iface,ae=q.id;return j?H.push(T(W,!1)):(Y(W),F?(W!==h&&H.push(T(W,!1)),te&&(H.push(T(h,!1)),H.push(T(ae,!0,ne)),Y(ae)),Y(h)):(H.push(T(W,!1)),te&&(H.push(T(ie,!1)),H.push(T(ae,!0,ne)),Y(ae)),Y(ie))),te&&H.push(I(ae,{role:g.INTERFACE_ROLE.INET})),l.pingcheck&&(X=function(e,t,n){s.getSavingQueries(t,e,n,C.ifaces,C.pingcheck).forEach(function(e){H.push(e)})},Z=O(N),J=O(x),ee=!(R.vlan||N.ppp.id||z()),j&&!B&&Z&&X(Z,!1,ee),j||(B||!Z||z()||Z===J||N.inet.iface===N.dsl.id||X(Z,!1,ee),X(J,x.pingcheck,ee))),F&&!V&&S.forEach(function(e){if(e!==g.INTERFACE_ROLE.INET){var t=N[e].pvc.iface;t&&H.push(I(t,{ipvc:b}))}}),l.igmp&&function(){var e=["iptv","iptv2","iptv3"],t=function(t){var n=[];return e.forEach(function(e){t.data[e].pvc.vpi&&t.data[e].pvc.vci&&n.push(t.data[e].pvc.iface)}),n},i=F||t(n).length>0,a="",o=!1;if(e.forEach(function(e){n.data[e].ports.length&&(o=!0)}),i&&!o)if(F)a=x.iptv.vlan?M.iface+"/Vlan"+x.iptv.vlan:h;else if(t(n).length>1)if(V||t(d).length<2){for(var s=0;C.ifaces["Bridge"+s];)s++;a="Bridge"+s}else f.forEach(C.ifaces,function(t,i){if("Bridge"===i.substr(0,6)&&t.include&&t.include.length>1){var o=0;e.forEach(function(e){~f.findIndex(t.include,{interface:n.data[e].pvc.iface})&&o++}),o>1&&(a=i)}});else a=t(n)[0];!function(e,t){var n=f.find(C.ifaces,function(e){return e.igmp&&e.igmp.upstream}),i=n&&(n.id.indexOf("Dsl")>-1||Boolean(f.find(n.include,function(e){return e.interface.indexOf("Dsl")>-1})));!e||t&&!i&&n?!e&&i&&H.push(f.set({},["interface",n.id,"igmp"],{upstream:b})):H.push(f.set({},["interface",e,"igmp"],{upstream:!0}))}(a||!1,F&&!x.iptv.vlan)}(),e.postAndSave(H).then(function(){return p.loadNdmIpvcList(m)}).then(function(t){var n,i,a,o=f.get(t,["ipvcByRole",g.INTERFACE_ROLE.INET,0],{}),s=o.bridge||o.interfaceId;if(!s)return u.when(!0);if(j&&j!==L.segment){var l=c.createEmptyIpvcObject(g.INTERFACE_ROLE.INET);return e.postAndSave([f.set({},["interface","ipvc",o.interfaceId],l),(n=j,i=m,a=C.ifaces[n].iseg.include,I(n,{iseg:{include:a+(a?",":"")+i}}))])}return te&&ae?r.assignPppToIsp(ae,s):e.postAndSave(T(s,!0,ne))})},O=function(e){var t=e.mode,n=e.dsl,i=e.ppp,a=e.inet;return t.segment?n.id||n.iface:i&&i.type!==o.PPP_TYPE.NONE?i.id:a.iface},N=function(e,c){var d=n.getPrototype(c),u=d.data,h=d.options;d.labelByIfaceId=r.getInterfaceIdToLabelMap(e.ifs);var b,_,y,S,C,I,T=u.mode,k=u.inet,P=e.ifaces;u.iface=c,h.usedIps=r.getAllUsedSubnets(e.ifs,e.ifaces),h.busyPortRoles=(b=P,_=f.pickBy(b,function(e){return e.ipoe}),y=f.map(_,function(e,t){return Object.assign({},e.ipoe,{id:t})}),S=f.pickBy(b,function(e){return e.iseg&&e.rename!==v.LAN}),C=f.map(S,function(e){return Object.assign({},e.iseg,{id:e.id})}),I={},y.forEach(function(e){w.forEach(function(t){var n=e[t+"-port"]||"";n.length&&n.split(",").forEach(function(n){I[Number(n)]={role:t,ifor:e.id}})})}),C.forEach(function(e){E(e.port).forEach(function(t){I[Number(t)]={role:g.PORT_ROLE.VLAN,ifor:e.id}})}),I);!function(){var t,n=e.ifaces[u.iface]||{},a=n["operating-mode"]||{},o=i.opmodeToCapabilityId(a.mode||"adsl2"),s=n.vdsl||{},r="vdsl2-co"===o,l=o.indexOf("vdsl")>-1,c=u.iface,d=u.mode;d.mode=l?"vdsl":"adsl",d.segment=function(e,t){for(var n in e){var i=e[n].iseg||{};if(f.get(i,"include",[]).indexOf(t)>-1)return n}}(e.ifaces,c)||angular.undefined,t=r?"server":d.segment?"bridge":"client",d.type=t,d.operationMode=o,u.dsl=angular.extend(u.dsl,{mode:o,iface:c,annex:a.annex||"auto",olr:(n.olr||[]).map(function(e){return Object.keys(e)[0]}),profiles:s.profile,psd:s.psdmask&&s.psdmask.mask,carrier:s.carrier})}();var A,D,N="vdsl"===T.mode;A=N,D=e.ipoe,u.inet.vlan=Number(D["inet-vlan"])||"",u.voip.vlan=Number(D["voip-vlan"])||"",u.iptv.vlan=Number(D["iptv-vlan"])||"",A&&(u.voip.ports=E(D["voip-port"]),u.iptv.ports=E(D["iptv-port"])),function(t){w.forEach(function(n){var i=function(e,t){var n=[];for(var i in t)if(0===i.indexOf(u.dsl.iface+"/Pvc")){var a=t[i];(e===(a.ipvc||{}).role||"inet"===e&&!a.role)&&n.push(a)}return n}(n,e.ifaces),a=i[0]||{},o=a.ipvc||{};t&&(u[n].ports=E(o.port||"")),u[n].pvc={iface:a.id||"",vpi:o.vpi||"",vci:o.vci||"",encapsulation:o.encapsulation||"aal5snap"},"iptv"===n&&[2,3].forEach(function(e){var n=i[e-1]||{},a=n.ipvc||{};u["iptv"+e].pvc={iface:n.id||"",vpi:a.vpi||"",vci:a.vci||"",encapsulation:a.encapsulation||"aal5snap"},t&&(u["iptv"+e].ports=E(a.port||""))})})}(!N);var L=p.getDslInetInterfaceId(e.ipvcList);k.iface=L;var x=!1;if(o.componentExists()){var R=m.findIspTunnel(L,P);x=R?o.getFormDataFromRawData(R):o.getFormDataFromRawDataByVia(L,P)}u.ppp=x;var M=a.getFormDataPrototype();!P[k.iface]||T.segment||!N&&k.iface===c||(M=a.getFormDataFromRawData(P[k.iface])),k.ip=M,h.freePorts=function(t){var n=[],i=e.ipoe,a=f.get(i,"free-port",!1);a&&a.split(",").forEach(function(e){return n.push(Number(e))});var o=function(e){e.forEach(function(e){!f.includes(n,e)&&e&&n.push(Number(e))})};for(var s in i&&(o(E(i["voip-port"])),o(E(i["inet-port"])),o(E(i["iptv-port"]))),t)if(0===s.indexOf(u.dsl.iface)){var r=t[s].ipvc;if(!r)continue;N&&T.segment||o(E(r.port)),o(E(r["free-port"]))}return v.HAS_TWO_SWITCHES&&(n=n.filter(function(e){return 0!==e})),n.sort()}(P),h.capabilities=e.capabilities;var $,F=P[c];if(u.mode.segment)u.description=F.description;else{var V=O(u),U=P[V]||{};if(u.order=V?f.get(U,"ip.global.order"):f.get(P[c],"ip.global.order"),isNaN(parseInt(u.order,10))){var B=r.countGlobalIfaces(P);u.order=U.ip?-1:B}u.pingcheck=!!l.pingcheck&&s.getFormDataFromRawData(U,e.pingcheck),$=U.description?U:F.description?F:{},u.description=$.description}return u.description=function(e){return e.description===v.WAN_DESCRIPTION?t.getTranslation("interface-translations.DSL-ISP"):e.description}(u),u.savedMode=angular.copy(u.mode),u.up=F.up,r.getSegments(P).then(function(e){return h.segments=e,d})},L=function(t){return function(t){var n={show:{interface:[f.set({},"dsl.capabilities.name",t),{}],rc:{interface:[{},{ipvc:{parent:t}}]}}};return l.pingcheck&&(n.show.rc["ping-check"]={}),u.all([e.post(n),e.get("interface/ipoe?parent=".concat(t))]).then(function(e){var n=e[0].show,i=f.get(n,"interface.1.interface",{}),a=n.rc,o=p.processShowRcInterfaceIpvcData(a,t),s=o.ifaces,l=o.ipvcList,c=a["ping-check"],d=f.get(n,"interface.0.dsl.capabilities"),u=e[1],m=f.keys(u)[f.keys(u).length-1]||"",g=m&&u[m]||{};for(var v in g.id=m,s)s[v].id=v;return C={ifaces:s,ipoe:g,ipoeData:u,ifs:i,ipvcList:l,pingcheck:c&&c.profile||{},capabilities:d},r.updateInterfaceNamesCache().then(function(){return C})})}(t).then(function(e){return N(e,t)})};return{IS_DSL_DEVICE:h,isUsbDslPlugged:function(){return e.get("show/interface?name="+i.USBDSL_IFACE).then(function(e){return"yes"===e.plugged})},loadModel:L,saveModel:function(e,t){return L(e).then(function(n){return D(t,n,e)})},resetAndSaveModel:function(t){return L(t).then(function(n){return function(t,n){var l=t.data,c=l.dsl,d=l.mode,p=d.mode.indexOf("vdsl")>-1,u=p&&d.type!==y,m=c.iface,v=l.ppp,h=v&&v.type!==o.PPP_TYPE.NONE,S=l.mode.segment,w=[];if(l.pingcheck&&"none"!==l.pingcheck.type){var E=f.filter(C.ifaces,function(e){return-1!==e.id.indexOf(m)});h&&E.push(C.ifaces[v.id]),E.forEach(function(e){w=w.concat(s.getClearPingcheckQueries(e.id,C.ifaces))})}if(w.push(a.getSavingQuery(a.getFormDataPrototype(),m)),w.push(I(m,{description:b})),p)w.push(I(m,{vdsl:{profile:i.VDSL_ALL_PROFILES,carrier:i.VDSL_AUTO_CARRIER},"operating-mode":{mode:_}})),u&&S&&w.push(k(S,m)),w.push(A(n));else{var D=[];f.forEach(C.ifaces,function(e){f.includes(e.id||"","Pvc")&&!r.hasRole(e,g.INTERFACE_ROLE.INET)&&D.push(e.id)}),D.length>0&&D.forEach(function(e){return w.push(f.set({},["interface",e,"ipvc"],b))});var O=m===i.USBDSL_IFACE?i.USBDSL_ADSL_OPMODE:i.DSL_ADSL_AUTO_OPMODE;O=i.capabilityIdToOpmode(O),I(m,{"operating-mode":{mode:O},annex:i.ADSL_AUTO_ANNEX})}return w.push(T(m,!1)),l.dsl.isUsbdsl||w.push(P(m,[],t.allOlrModes)),h&&w.push(I(v.id,b)),e.postAndSave(w)}(n,t)})}}}e.$inject=["router","utils","usbdslModel","usbdslConsts","ifaceIpModel","ifacePppModel","pingcheckModel","interfaces","components","dslModel","dslConstants","dslService","$q","pppPurposeChecker","_","CONSTANT","NDM"],angular.module("keenetic").factory("usbdslService",e)}(),function(){function e(e,t){var n=function(){return{iface:"",vpi:"",vpc:"",encapsulation:""}};return{getEmptyPvcConfiguration:n,getPrototype:function(n){return{id:n,allVdslProfiles:[],data:{iface:n,description:"",mode:{type:"client",mode:"adsl2",segment:!1},dsl:{iface:n,mode:"adsl2",annex:"auto",profiles:[],olr:[],psd:"",carrier:""},inet:{iface:t.USBDSL_IFACE,vlan:"",pvc:{iface:"",vpi:"",vpc:"",encapsulation:""},ip:e.getFormDataPrototype()},voip:{vlan:"",pvc:{iface:"",vpi:"",vpc:"",encapsulation:""},ports:[]},iptv:{vlan:"",pvc:{iface:"",vpi:"",vpc:"",encapsulation:""},ports:[]},iptv2:{vlan:"",pvc:{iface:"",vpi:"",vpc:"",encapsulation:""},ports:[]},iptv3:{vlan:"",pvc:{iface:"",vpi:"",vpc:"",encapsulation:""},ports:[]},ppp:{iface:"",via:"",used:!1,ip:e.getFormDataPrototype()}},options:{segments:[],freePorts:[]}}}}}e.$inject=["ifaceIpModel","usbdslConsts"],angular.module("keenetic").factory("usbdslModel",e)}(),function(){function e(e,t,n,i,a,o,s,r,l,c,d,p,u,m,f,g,v){var h=this;h.vdslClientMode=g.VDSL_CLIENT_OPTION_ID,h.dslPort=r.DSL,h.labelByIfaceId={},h.getIforL10n=o.noop;var b=g.ROLES,_=g.ALL_SERVICES,y=g.VDSL_CLIENT_OPTION_ID,S=function(){return{connection:{text:" ",color:d.constants.STATE_CATEGORY.INFO}}},w=-1,C=function(){return h.IFACE===r.DSL?a.when(!0):v.isUsbDslPlugged()},E=function(e){h.IFACE!==r.DSL&&(e&&!h.msgId?(h.msgId=p.warning("dsl.no-modem",-1),h.state={connection:{text:s.getTranslation("connection-status."+d.constants.ISP_STATE.UNPLUGGED),color:d.constants.STATE_CATEGORY.INFO}}):!e&&h.msgId&&(p.hide(h.msgId),h.msgId=!1))},I=function(){if(!o.get(h,"form.$pending")&&!h.toggle.pending){var e=o.get(h,"data.inet.iface",""),t="adsl"===o.get(h,"data.mode.mode"),n=o.get(h,"data.inet.pvc.iface","");return!t||e&&n.includes("Pvc")?h.toggle.state&&(e||t)&&"server"!==o.get(h,"data.savedMode.type")&&"server"!==o.get(h,"data.mode.type")&&o.get(h,"data.savedMode.mode")===o.get(h,"data.mode.mode")?d.getIspConnectionState({main:h.data.inet.iface,ppp:"none"!==h.data.ppp.type&&h.data.ppp.id,phy:h.IFACE},{schedule:"",pingcheck:h.data.pingcheck?h.data.pingcheck.profileName:""}).then(function(e){h.state=e;var t=h.IFACE===g.USBDSL_IFACE&&h.state.connection.name===d.constants.ISP_STATE.UNPLUGGED;if(h.state.connection.name===d.constants.ISP_STATE.DOWN&&(h.state=S()),E(t),h.data.pingcheck&&h.data.pingcheck.profileName&&e.pingcheck){var n="pass"===e.pingcheck.name?"pass":"fail",i="fail"===n?"red":"green";h.state.pingcheck={color:i,text:s.getTranslation("pingcheck-status."+n)}}else h.state.pingcheck=!1}):C().then(function(e){E(!e),e&&(h.state=S())}):C().then(function(e){E(!e),e&&(h.state={connection:{text:s.getTranslation("connection-status."+d.constants.ISP_STATE.NOT_CONFIGURED),color:d.constants.STATE_CATEGORY.INFO}})})}},T=function(t,n){var i,s=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:"").split("__")[1],r=a.defer();if(s){var c=h.userInfo;if(c.disconnected||"ethernet"!==c.type||s!==c.port)r.resolve(!0);else{var d=h.portmap.data;i=d[s],e(function(){"free"!==d[s]?l.confirm("switchport-is-used-to-connect-to-the-device","confirm-using-switchport").then(function(){r.resolve(!0)},function(){d[s]=i,r.resolve(!1)}):r.resolve(!0)})}}else r.resolve(!0);r.promise.then(function(){e(function(){var e=h.portmap.data;h.portmap.usedRoles=o.uniq(o.filter(e,function(e){return o.includes(b,e)}))})})},k={};h.usedSubnets=[],h.progress=0,h.form={},h.data={},h.submit=function(){if(!h.form.$pending)return h.form.$pending=!0,R(),k.allOlrModes=h.options.olrModes.map(function(e){return e.id}),k.allVdslProfiles=h.options.profiles.map(function(e){return e.id}),v.saveModel(h.IFACE,k).then(A).then(function(){return p.success("notifications.saved",3e3)})},h.isDslDevice=v.IS_DSL_DEVICE,h.options={portsMap:s.getSwitchportsList(),rolesWithoutIcon:_defineProperty({},u.PORT_ROLE.VLAN,!0),types:g.getOptionsForOperatingTypeSelect(),profiles:[],carriers:[],annexes:[],olrModes:[],encapsulationSelect:g.getEncapsulationSelectOptions(),segments:[],freePorts:[],busyPortsRoles:[],portRoles:g.getPortRoleSelectOptions()},h.toggle={state:!1,loaded:!1,pending:!1,text:"...",color:"gray",onToggle:function(e){h.toggle.pending=!0;var t=[h.data.iface];return e&&_.forEach(function(e){var n=o.get(h,"data.".concat(e,".pvc.iface"));n&&t.push(n)}),d.toggleState(t,e).finally(function(){h.toggle.pending=!1})},polling:I},h.portmap={data:{0:"",1:"",2:"",3:"",4:"",5:"",6:"",7:"",8:""},usedRoles:[],onChange:T},h.errors={vlan:{inet:!1,iptv:!1,voip:!1},pvc:{inet:!1,iptv:!1,voip:!1}},h.userInfo={},h.lastKnownUserInfo={},h.updateUserInfo=function(){c.getCurrentUserInfo().then(function(e){h.userInfo=angular.copy(e),h.lastKnownUserInfo=e},function(){h.userInfo={disconnected:!0}})},h.onModeChange=function(e){o.get(h,"data.savedMode.mode")!==e&&(h.state=S())},h.resetSettings=function(){if(!h.form.$pending)return l.confirm(s.getTranslation("sure")).then(function(){return h.form.$pending=!0,v.resetAndSaveModel(h.IFACE).then(A).then(function(){return p.success("notifications.saved",3e3)})})};var P=f.getCapabilityPropertyOptionsList;h.onOperationModeChange=function(e){var t=h.options.capabilities[e],n=-1!==e.toLowerCase().indexOf("vdsl");if(t)if(t.olr&&(h.options.olrModes=P(t.olr).map(function(e){return e.checked=-1!==h.data.dsl.olr.indexOf(e.id),e})),n){h.options.carriers=P(t.carrier);var i=P(t.profile),a=i.map(function(e){return e.id});o.get(h,"data.dsl.profiles",[]).forEach(function(e){var t=a.indexOf(e);-1!==t&&(i[t].checked=!0)}),h.options.profiles=i}else{h.options.annexes=P(t.annex);var s=h.options.annexes.map(function(e){return e.id});-1===s.indexOf(o.get(h,"data.dsl.annex"))&&(h.data.dsl.annex=s[0])}};var A=function(){return v.loadModel(h.IFACE).then(function(e){k=e,h.labelByIfaceId=k.labelByIfaceId,h.getIforL10n=d.getPortIforL10nFunction(h.labelByIfaceId),h.data=k.data,h.data.isUsbdsl=h.data.dsl.iface===g.USBDSL_IFACE,w=h.data.order,O(k.options.usedIps),h.toggle.state=h.data.up,h.options.freePorts=k.options.freePorts,h.options.busyPortRoles=k.options.busyPortRoles;var t=k.options.capabilities,n=o.find(t,function(e){return Boolean(e.psdmask)});n&&(h.options.psds=P(n.psdmask)),h.options.capabilities=k.options.capabilities;var i=h.options.types,a=o.findIndex(i,function(e){return"server"===e.id});!h.options.capabilities["vdsl2-co"]&&a>-1&&i.splice(a,1),h.options.modes=o.map(o.uniq(o.map(t,function(e){return e.category})),function(e){return{id:e,name:e.toUpperCase()}}),h.showMoreIptvPvcs=1,h.data.iptv2.pvc.vci&&h.showMoreIptvPvcs++,h.data.iptv3.pvc.vci&&h.showMoreIptvPvcs++,x(),h.options.segments=[],o.forEach(k.options.segments,function(e){return h.options.segments.push({id:e.id,name:e.description})});var s=o.get(h,"data.dsl.mode"),r=s===m.DSL_MODE.AUTO;r&&(s=m.DSL_MODE.ADSL),h.options.modes=h.options.modes.filter(function(e){return e.id!==m.DSL_MODE.AUTO});var l=-1!==s.toLowerCase().indexOf("vdsl");h.options.operationModes=M(t,l?"vdsl":"adsl"),l||h.onOperationModeChange(s),r&&(h.data.mode.mode=s,h.data.mode.operationMode=g.DSL_ADSL_AUTO_OPMODE),h.progress=100,h.form.$pending&&(h.form.$pending=!1),o.get(h,"form.$setPristine",o.noop)()})},D=function(){n.$watch("vm.data.mode.mode",$),n.$watch("vm.data.mode.operationMode",h.onOperationModeChange),n.$watchGroup(["vm.data.mode.mode","vm.data.inet.vlan","vm.data.voip.vlan","vm.data.iptv.vlan"],L),n.$watchGroup(["vm.data.mode.mode","vm.data.inet.pvc.vci","vm.data.inet.pvc.vpi","vm.data.voip.pvc.vci","vm.data.voip.pvc.vpi","vm.data.iptv.pvc.vci","vm.data.iptv.pvc.vpi"],L),n.$watchGroup(["vm.data.mode.mode","vm.data.inet.pvc.vci","vm.data.inet.pvc.vpi","vm.data.voip.pvc.vci","vm.data.voip.pvc.vpi","vm.data.iptv.pvc.vci","vm.data.iptv.pvc.vpi","vm.data.iptv2.pvc.vci","vm.data.iptv2.pvc.vpi","vm.data.iptv3.pvc.vci","vm.data.iptv3.pvc.vpi"],N)};h.init=function(e,t){h.IFACE=e,A().then(I).then(D).then(function(){t.progress=100})};var O=function(e){h.usedSubnets=[],e.forEach(function(e){var t=h.data.inet.ip,n=o.get(h.data,"ppp.ip",{});e.ip===t.ip&&t.mask===e.mask||e.ip===n.ip&&n.mask===e.mask||h.usedSubnets.push(e)})},N=function(){h.errors.pvc={};var e=h.errors.pvc;if("vdsl"!==h.data.mode.mode){var t=[];_.forEach(function(n){var i=h.data[n].pvc,a=parseInt(i.vpi,10),o=parseInt(i.vci,10);if(!isNaN(a)&&!isNaN(o)&&o>=32&&o<=65535&&a>=0&&a<=255){for(var r=!1,l=0;l<t.length;l++){var c=t[l];if(c[0]===a&&c[1]===o){r=c[2];break}}if(r){var d=s.getTranslation("dsl.error-pvc-busy");e[n]=d,e[r]=d}else t.push([a,o,n])}})}},L=function(){h.errors.vlan={},"vdsl"===h.data.mode.mode&&b.forEach(function(e){var t=parseInt(h.data[e].vlan,10);isNaN(t)||b.forEach(function(n){if(e!==n){var i=parseInt(h.data[n].vlan,10);isNaN(i)||t===i&&(h.errors.vlan[e]=s.getTranslation("errors.vlan-used"))}})})},x=function(){var e=h.portmap.data;h.options.freePorts.forEach(function(t){e[t]=h.options.portRoles[0].id}),_.forEach(function(t){o.get(h.data,"".concat(t,".ports"),[]).forEach(function(n){e[n]=t.substring(0,4)})}),T()},R=function(){b.forEach(function(e){h.data[e].ports=[];var t=h.data[e].ports;h.options.freePorts.forEach(function(n){o.includes(b,e)&&h.portmap.data[Number(n)]===e&&t.push(Number(n))})}),h.data.iptv2.ports=h.data.iptv.ports,h.data.iptv3.ports=h.data.iptv.ports},M=function(e,t){return o.map(o.filter(e,function(e,n){return e.id=n,e.category===t}),function(e){return{id:e.id,name:s.getTranslation("dsl.options.operation-mode."+g.capabilityIdToOpmode(e.id))}})};n.$watch("vm.data.mode.type",function(e){e!==y&&(h.data.order=w)});var $=function(e,t){if(e!==t){var n=h.data.mode,i=h.options.capabilities;n.mode&&h.options.types.forEach(function(t){(t.disabled=t.id!==y&&"vdsl"!==e)&&n.type===t.id&&(n.type=y)}),h.options.operationModes=M(i,e),h.data.mode.operationMode=h.options.operationModes[0].id}}}e.$inject=["$timeout","$rootScope","$scope","$parse","$q","_","utils","NDM","modal","usersService","interfaces","notification","CONSTANT","dslConstants","dslService","usbdslConsts","usbdslService"],angular.module("keenetic").controller("UsbDslController",e)}(),function(){function e(e,t,n,i,a){var o=i.PORT_ROLE,s=function(t){return e.getTranslation("dsl.options."+t)};return{DSL_IFACE_PREFIXES:[n.DSL,"UsbDsl0"],USBDSL_IFACE:"UsbDsl0",USBDSL_ADSL_OPMODE:"adsl2-plus",DSL_BAD_LINE_STATUSES:["idle","down"],ALL_SERVICES:["inet","voip","iptv","iptv2","iptv3"],ROLES:["inet","voip","iptv"],DSL_ADSL_AUTO_OPMODE:"adsl-auto",ADSL_AUTO_ANNEX:"auto",VDSL_CLIENT_OPTION_ID:"client",VDSL_CLIENT_OPMODE:"vdsl2-cpe",VDSL_AUTO_CARRIER:"auto",VDSL_ALL_PROFILES:"all",getOptionsForOperatingTypeSelect:function(){var e=[{id:"client",name:s("mode.client")}];return a.usbdsl&&e.push({id:"bridge",name:s("mode.bridge")},{id:"server",name:s("mode.server")}),e},getEncapsulationSelectOptions:function(){return[{id:"aal5snap",name:"LLC"},{id:"aal5mux",name:"VC"}]},getPortRoleSelectOptions:function(){return[{id:o.FREE,label:"default",icon:"radio-false"},{id:o.IPTV,label:"port-role.iptv",icon:"role-iptv"},{id:o.VOIP,label:"port-role.voip",icon:"role-voip"}]},opmodeToCapabilityId:function(e){return e.replace("adsl2+","adsl2-plus")},capabilityIdToOpmode:function(e){return e.replace("adsl2-plus","adsl2+")}}}e.$inject=["utils","_","NDM","CONSTANT","components"],angular.module("keenetic").factory("usbdslConsts",e)}(),function(){function e(e,t,n,i,a,o,s,r,l,c,d,p,u,m){var f=this,g=n.current.name;f.isReady=!1,f.currentDialog=null,f.notificationUid=null,f.selectedInterfaceId="",f.selectedInterfaceCallbackId=null,f.smsPollCallbacks=[],f.smsPollRequesterCallbackId="",f.$relay=function(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),a=1;a<n;a++)i[a-1]=arguments[a];t.$broadcast.apply(t,[e].concat(i))},f.selectDialog=function(e){f.currentDialog=e},f.onTabSelect=function(e,t){if(t.id!==f.selectedInterfaceId)return c.hideAll(),o.stopPolling(),f.selectedInterfaceId=t.id,m.setState({selectedInterfaceId:f.selectedInterfaceId,currentDialog:null,currentDialogIndex:-1,dialogs:[],sendersToHide:{}}),o.startPolling(),f.$relay(s.EVENTS.TAB_CHANGED),h(f.selectedInterfaceId)},f.canSwitchTab=function(){return e.when(!0)},f.registerSmsListPollCallback=function(e){f.smsPollCallbacks.push(e)};m.subscribeOnStateChanged(t,function(e){var t=e.currentDialog,n=e.openedModalCount,i=e.simState,s=e.simStateIsInvalid,r=e.suitableInterfacesList;f.isModalVisible=n>0,f.isPreviewVisible=!t,s?f.notificationUid=c.warning("sms.invalid-sim-state.".concat(i),-1):(c.hide(f.notificationUid),f.notificationUid=null),f.tabs=o.getTabsList(r),a.map(f.tabs,"id").includes(f.selectedInterfaceId)||f.onTabSelect(0,f.tabs[0])});var v=function(e){m.setState(o.processInterfaceState(e))},h=function(e){return o.getSmsListData(e).then(function(e){return f.$relay(s.EVENTS.SMS_LIST_DATA_LOADED,{smsListData:e}),o.startPolling(),u.getSuitableInterfacesList().then(function(e){var t=a.find(e,function(e){return e.id===f.selectedInterfaceId});v(t)})})};u.getSuitableInterfacesList().then(function(e){return f.tabs=o.getTabsList(e),f.selectedInterfaceId=f.tabs[0].id,m.setState({selectedInterfaceId:f.selectedInterfaceId}),f.smsPollRequesterCallbackId=o.registerDynamicRequesterCallback(function(){var e=o.getSmsListQueryData(f.selectedInterfaceId);return{query:e.query,dataForCallback:e.dataPath}},function(e,t){var n=a.get(e,"[0].".concat(t),{});f.smsPollCallbacks.forEach(function(e){return e(n)})}),h(f.selectedInterfaceId)}).then(function(){f.selectedInterfaceCallbackId=o.registerDynamicRequesterCallback(function(){return d.getStateQueries(f.selectedInterfaceId)},function(e){var t=d.destructureStateResponses(e).showInterfaceData;v(t)}),o.startPolling(),f.isReady=!0,f.progress=100}),t.$on("$destroy",function(){f.smsPollCallbacks=[],o.unregisterRequesterCallback(f.smsPollRequesterCallbackId),o.unregisterRequesterCallback(f.selectedInterfaceCallbackId)}),i.onStart({from:g},function(){return o.stopPolling(),f.canSwitchTab().then(function(e){return o.startPolling(),e})})}e.$inject=["$q","$scope","$state","$transitions","_","sms","smsConstants","NDM","interfaces","notification","usbQmi","usbQmiConstants","smsStatus","smsSharedState"],angular.module("keenetic").controller("SmsController",e)}(),function(){function e(e,t,n,i,a,o,s,r,l){var c={no:!0},d=function(e){return"permit"===e||"deny"===e},p=function(e,t){return e.index=t,e.isEnabled=!angular.isDefined(e.enabled)||e.enabled,delete e.enabled,e},u=function(e,t,n,i){return n=n||[],i=i||[],t=(t||[]).map(p).map(function(e){return Object.assign({},e,{isEnabled:!1})}),{description:e||"",isAuto:!1,isHotspotDefaultPolicy:!1,interfaces:t,segments:n,hosts:i,consumersCount:n.length+i.length}},m={setSegmentPolicy:function(e,n){return n=angular.isArray(n)?n:[n],t.set({},"ip.hotspot.policy",n.map(function(t){var n=d(e)?"access":"policy";return _defineProperty({interface:t.id},n,e)}))},setHostPolicy:function(e,n){return n=angular.isArray(n)?n:[n],n=t.map(n,"mac").filter(angular.identity),t.set({},"ip.hotspot.host",n.map(function(t){var n={mac:t};return d(e)?(n[e]=!0,n.policy=c):(n.permit=!0,n.policy=e),n}))},setPolicyDescription:function(e,n){return t.set({},["ip","policy",e],{description:n})},setPolicyInterfacesOrder:function(e,n){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=t.sortBy(n,"order").map(function(e){return{interface:e.interface,no:angular.isUndefined(e.order)}});return a.push({auto:i}),t.set({},"ip.policy."+e,{permit:a})},setInterfacesGlobalOrder:function(e){var n={};return e.forEach(function(e){t.set(n,["interface",e.interface,"ip","global"],e.isEnabled?{order:e.order}:c)}),n},setDefaultHotspotPolicy:function(e){return t.set({},"ip.hotspot.default-policy",d(e)?{access:e}:{policy:e})},addConsumerToPolicy:function(e,t){return"host"===t.type?m.setHostPolicy(e,t):"segment"===t.type?m.setSegmentPolicy(e,t):{}},savePolicyConsumers:function(e,t){var n=[],i=angular.copy(t);return i.segments.length>0&&n.push(m.setSegmentPolicy(e,i.segments)),i.hosts.length>0&&n.push(m.setHostPolicy(e,i.hosts)),n},savePolicyConfig:function(e,n){return d(e)?n.interfaces.length>0?m.setInterfacesGlobalOrder(n.interfaces):{}:t.merge(m.setPolicyInterfacesOrder(e,n.interfaces,n.isAuto),m.setPolicyDescription(e,n.description||e))},savePolicy:function(e,n){var i=[],a=t.extend(u(),angular.copy(n)),o=m.savePolicyConfig(e,a);return t.isEmpty(o)||i.push(o),i=i.concat(m.savePolicyConsumers(e,a))},removePolicy:function(e){return t.set({},"ip.policy."+e,c)}},f=[],g=!1,v=function(e){return e.description||e.rename||e.ssid},h=function(t){return function(){var n=t.apply(void 0,arguments);return 0===(n=angular.isArray(n)?n:[n]).length?e.when(!0):l.postAndSave(n)}};return{queryCtor:m,doesPolicyExist:function(e){return l.get("ip/policy").then(function(t){return Boolean(t[e])})},addConsumerToPolicy:h(m.addConsumerToPolicy),savePolicyConsumers:h(m.savePolicyConsumers),savePolicy:h(m.savePolicy),savePoliciesConfigurations:function(n){var i=t.map(n,function(e,t){return m.savePolicyConfig(t,e)});return 0===i.length?e.when(!0):l.postAndSave(i)},renamePolicy:h(m.setPolicyDescription),removePolicy:h(m.removePolicy),getFreePolicyName:function(e){var t=(e||[]).map(function(e){return Number(e.replace("Policy",""))}).filter(function(e){return!isNaN(e)});return"Policy"+i.firstUnusedId(t)},getNewPolicyData:u,getPoliciesSelectData:function(){var n=e.defer();if(f.push(n),g)return n.promise;g=!0;var a=i.toRciQueryList(["show.interface","show.rc.ip.policy"]);return l.postToRciRoot(a).then(function(e){return{showInterface:t.get(e,"0.".concat("show.interface"),{}),ipPolicy:t.get(e,"1.".concat("show.rc.ip.policy"),{})}}).then(function(e){f.forEach(function(t){t.resolve(e)})}).finally(function(){g=!1}),n.promise},getInitialData:function(){var e={},i={show:{interface:{},ip:{hotspot:{details:n.HOTSPOT_DETAILS.NONE}}}};return["interface","ip.hotspot.default-policy","ip.hotspot.policy","ip.hotspot.host","ip.policy"].forEach(function(n){return t.set(e,n,{})}),i.show.rc=e,l.post({url:"",data:i}).then(function(e){var i,o=e.show,l=o.interface||{},c=o.rc,d=c.interface||{},m=c.ip,f=m.hotspot,g=m.policy||{},h=t.get(o,"ip.hotspot.host",[]),b=f.host||[],_=function(e){var t="permit";return e.access?t=e.access:e.policy&&(t=e.policy),t}(f["default-policy"]||{}),y=(_defineProperty(i={},"permit",t.extend(u(),{id:"permit",isAuto:!0})),_defineProperty(i,"deny",t.extend(u(),{id:"deny"})),i),S={};return a.getSegments(d).then(function(e){var i=function(e){var n={},i={},o={},s={};return a.getInterfaceOptions(e).forEach(function(e){s[e.id]=e.type}),t.forEach(e,function(e,t){e.id!==t&&(n[e.id]=t,i[t]=e.id);var a=e.type;switch(a){case"Vlan":case"GigabitEthernet":case"UsbModem":case"UsbLte":case"UsbQmi":case"CdcEthernet":case"YotaOne":case"Yota":case"WifiStation":case"UsbDsl":case"Pvc":case"Dsl":case"AccessPoint":case"Bridge":a="isp";break;case"L2TP":a+=e["ipsec-enabled"]?"/IPsec":""}o[e.id]=a}),{aliases:n,aliasIds:i,kinds:o,types:s}}(l),o=i.aliases,c=i.kinds,u=i.aliasIds,m=i.types,w={};g=t.mapValues(g||{},function(e,n){return e.id=n,e.description=e.description||e.id,e.segments=[],e.hosts=[],e.isAuto=Boolean(t.find(e.permit||[],"auto")),e.isHotspotDefaultPolicy=!1,e.interfaces=t.map(t.reject(e.permit.slice(),"auto"),function(e,t){var n=e.interface;(e=p(e,t)).description="",d[n]||(n=(o[n]||{}).id);var i=d[n];return i&&(e.description=v(i)),e}),delete e.permit,e}),y=t.mapValues(y,function(e){return e.isDefaultDevicePolicy=!0,e}),("permit"===_?y.permit:"deny"===_?y.deny:g[_]).isHotspotDefaultPolicy=!0,t.forEach(e,function(t,n){t.policy="permit",S[n]=!0,e[n]=t}),t.forEach(f.policy||{},function(t){var n=t.interface;if(l[n]&&(n=l[n].id),e[n]){var i={id:n,description:e[n].description};t.policy?g[t.policy].segments.push(i):t.access&&(y[t.access].segments.push(i),e[n].policy=t.access),delete S[n]}}),h.forEach(function(e){var n=t.find(b,{mac:e.mac})||{},i=t.extend({policy:_},n,{name:e.name||n.mac});if(("deny"===n.access||n.access&&!n.policy)&&(i.policy=n.access),e.name){var a=i.policy;("permit"===a?y.permit:"deny"===a?y.deny:g[a]||{hosts:[]}).hosts.push(i)}}),Object.keys(S).forEach(function(t){y.permit.segments.push({id:t,description:e[t].description})});var C=a.getGlobalInterfaces(d),E=t.sortBy(C,"ip.global.order"),I={};E=E.map(function(e,i){var o=c[e.id]||"isp",l=v(e),d=t.get(e,"connect.via");return d&&"any"!==d&&(o=a.hasRole(e,n.INTERFACE_ROLE.INET)?"isp":o),o===s.IKE_INTERFACE_TYPE&&(o=r.getIkeType(e)),c[e.id]=o,w[e.id]=l,I[e.id]=t.get(e,"connect.via",!1),{index:i,interface:e.id,id:e.id,name:e.rename||e["interface-name"]||e.name||e.id,description:l,kind:o.toLowerCase(),type:m[e.id],isEnabled:-1!==t.get(e,"ip.global.order",-1),via:I[e.id]}}),y.permit.interfaces=E;var T=t.sortBy(g,"id");return T.unshift(y.permit),T.push(y.deny),T=T.map(function(n,i){return n.segments=t.sortBy(n.segments,"id").map(function(t){return t.policyIndex=i,e[t.id].policyIndex=i,t}),n.hosts=t.sortBy(n.hosts,"name").map(function(e){return e.policyIndex=i,e}),n.interfaces=n.interfaces.map(function(e){var t=u[e.interface]||e.interface;return e.id=t,e.description=w[t]||t,e.name=o[e.interface]||e.interface,e.kind=c[e.interface]||"isp",e.type=m[t],e.via=I[t],e}),n.consumersCount=n.segments.length+n.hosts.length,n}),{interfaceIdToDescriptionMap:a.getInterfaceIdToDescriptionMap(l),segments:e,hosts:b,ifaceAliases:o,ifaceAliasIds:u,policiesList:T,policiesCount:T.length,globalInterfaces:angular.copy(E),raw:{interface:d,"show interface":l}}})})},getInterfacesOrderObject:function(){return l.get("ip/policy").then(function(e){return t.mapValues(e,function(e){var n={};return t.reject(t.get(e,"permit",[]),"auto").forEach(function(e,t){n[e.interface]=t}),n})})},updateHotspotData:function(e){return l.get("show/ip/hotspot").then(function(n){var i={},a={};return t.forEach(e,function(e,t){a[t]=[]}),(n.host||[]).forEach(function(n){if(n.registered)i[n.mac]=!!t.some(n["mac-access"],function(e){return e===o.ACL_TYPE_DENY})&&t.mapValues(n["mac-access"],function(t,n){return{accessAllowed:t===o.ACL_TYPE_PERMIT,description:e[n].description||n}});else{var s=t.get(n,"interface.id");e[s]&&a[s].push(n.hostname||n.mac)}}),{registeredHosts:i,unregisteredHostsBySegment:a}})},constants:{ISP:"isp",DEFAULT_PERMIT_POLICY:"permit",DEFAULT_DENY_POLICY:"deny",POLICY_NAME_PREFIX:"Policy",CONSUMER_ID_PROP_MAP:{segments:"id",hosts:"name"}}}}e.$inject=["$q","_","CONSTANT","utils","interfaces","wirelessAcl","pppConstants","pppConnectionsService","router"],angular.module("keenetic").factory("policies",e)}(),function(){function e(e,t,n,i,a,o,s,r,l,c,d,p,u,m,f,g,v,h,b,_){var y=this,S=_.constants;y.PAGE_TAB={INTERFACE_PRIORITIES:"interface-priorities",POLICY_CONSUMERS:"policy-consumers"};if(p.isIE||s.noLoad)y.selection={enable:r.noop,disable:r.noop,clearSelection:r.noop,select:r.noop,removeFromSelection:r.noop};else{y.selection=s.create({class:"policy-consumers-selection-area",singleClick:!1,disableTouch:!0,selectables:[".policy-consumers-list__consumer"],boundaries:[".policies-editor--consumers-mode"]}),y.selection.on("start",function(t){var n=t.inst;if(y.dragStarted){n.cancel();var i=t.area;i&&(i.hidden=!0,e(function(){i.hidden=!1}))}else t.oe.shiftKey||y.deselectSelectedConsumers()}).on("stop",function(e){e.inst.keepSelection();var t=angular.copy(y.selectedConsumers);e.selected.forEach(function(e){var n=angular.element(e),i=r.get(y,["policiesToShowConsumersFrom",Number(n.attr("policy-idx")),n.attr("item-prop"),Number(n.attr("item-idx"))]);if(i){var a=n.attr("item-prop"),o=i[S.CONSUMER_ID_PROP_MAP[a]];t[o]=i,i.isSelected=!0}}),y.selectedConsumers=t,y.selectedConsumersCount=Object.keys(t).length,u.forceScopeDigest(n)}).on("beforestart",function(e){var t=r.get(e,"oe.target.className","");return y.mode===y.PAGE_TAB.POLICY_CONSUMERS||t.includes("policy-consumers-list__consumer")})}y.isMobile=p.isMobile;var w=function(e){return e.preventDefault()};p.isIos&&!p.isChrome&&(t.addEventListener("touchmove",w),n.$on("$destroy",function(){return t.removeEventListener("touchmove",w)}));var C=["wired","wisp","modem","internal-lte","UsbDsl",b.PPP_TYPE.IKEV1,b.PPP_TYPE.IKEV2],E={IPoE:"wired",PPTP:"wired",L2TP:"wired",PPPoE:"wired","USB DSL":"UsbDsl","USB 3G/4G":"modem",WISP:"wisp"},I=function(e){return u.getTranslation("policies.tabs.".concat(e))},T=function(){y.modeDescription=u.getTranslation("policies.".concat(y.mode,".description"))};y.tabs=u.idsToOptions([y.PAGE_TAB.INTERFACE_PRIORITIES,y.PAGE_TAB.POLICY_CONSUMERS],I);var k=function(){y.l10n={viewAllUnregisteredHosts:u.getTranslation("policies.consumer-tooltip.segment-unregistered-hosts.see-all-hosts",null,{deviceListRef:u.generateSrefLinkHtml(u.getTranslation("menu.connected-devices"),"controlPanel.devicesList")}),ispType:u.getTranslation("policies.interface-type.isp"),connTypes:{},wispRange:d.getAllBandsL10n(!1)},C.forEach(function(e){y.l10n.connTypes[e]=u.getTranslation("dashboard.card_internet.types.".concat(e))}),y.rawRciData&&(y.interfaceIdToDescriptionMap=m.getInterfaceIdToDescriptionMap(y.rawRciData["show interface"])),y.tabs=y.tabs.map(function(e){return Object.assign({},e,{label:I(e.id)})}),T()};k(),n.$on("$destroy",i.$on("$translateChangeSuccess",function(){return e(k)})),y.progress=0,y.MAX_UNREG_HOSTS_IN_TOOLTIP=5,y.data={},y.constants=S,y.ui={isLocked:!1,lock:function(){return y.ui.isLocked=!0,a.when(!0)},unlock:function(){return y.ui.isLocked=!1,a.when(!0)}};var P=function(e,t){y.noAclConfigured||e.hosts.forEach(function(e){e.aclTooltipData=t.registeredHosts[e.mac],e.wirelessAccessRestricted=e.aclTooltipData&&r.some(t.registeredHosts[e.mac],function(e){return!e.accessAllowed}),e.wirelessAccessRestricted&&(e.type="blocked-device")}),e.segments.forEach(function(e){e.unregisteredHosts=t.unregisteredHostsBySegment[e.id]})};y.updateTooltipData=function(){return _.updateHotspotData(y.segments).then(function(e){y.policiesList.forEach(function(t){P(t,e)}),y.policiesToShowConsumersFrom.forEach(function(t){P(t,e)})})},y.onModeSwitch=function(e,t){y.mode=t.id,-1!==y.selectedPolicyIndex&&y.selectedPolicy.isBeingRenamed&&y.cancelPolicyRename(),y.selectedConsumersCount>0&&y.deselectSelectedConsumers(),y.mode===y.PAGE_TAB.POLICY_CONSUMERS?(y.selection.enable(),y.selection.clearSelection()):y.selection.disable(),(-1===y.selectedPolicyIndex||y.selectedPolicy.id===S.DEFAULT_DENY_POLICY||y.selectedPolicy.isBeingRenamed&&!y.selectedPolicy.isSaved)&&y.selectPolicy(0),T()},y.onKeydown=function(e,t){if(f.isSpace(e))return e.preventDefault(),e.stopPropagation(),t(),e.target.blur(),!0},y.canSwitchMode=function(e,t,n,i){return i.id!==y.PAGE_TAB.INTERFACE_PRIORITIES||!(y.otherModifiedPoliciesCount>0||y.selectedPolicy.isModified)||g.confirmLeave(function(){return y.resetAllModifiedPolicies()})},y.selectedConsumersCount=0,y.toPolicyOptions=[],y.policiesList=[],y.selectedPolicy={},y.selectedPolicyIndex=-1,y.unsavedNewPolicyIsBeingRenamed=!1,y.policyNames=[],y.policiesToShowConsumersFrom=[];var A=function(e){var t=[],n=[],i=0;return e.forEach(function(e){e.isEnabled?(e.order=i++,t.push(e)):(delete e.order,n.push(e))}),t.concat(n)},D=function(e){return e.isSelected=!1,e.isBeingDragged=!1,e},O=function(){y.selectedPolicy.description=y.selectedPolicy.descriptionOnSelect,y.selectedPolicy.isBeingRenamed=!1,y.policyIsBeingRenamed=!1},N=function(){return y.policiesList.splice(y.policiesList.length-2,1),y.unsavedNewPolicyIsBeingRenamed=!1,y.selectPolicy(0)},L=function(e){y.toPolicy=null,y.toPolicyOptions=angular.copy(y.policiesList).filter(function(t){return t.id!==e.id}).map(function(e){return{id:e.id,label:e.description}})},x=function(e,t,n){var i=0,a={},o={};return y.consumerProps.forEach(function(n){var s=[],r=[];y.policiesToShowConsumersFrom.forEach(function(e){e[n].forEach(function(e){var t=e.isSelected;e=D(e),t?s.push(e):r.push(e)})}),i+=s.length,a[n]=s,o[n]=r,e[n]=e[n].concat(angular.copy(s).map(function(e){return e.policyIndex=t,e.isSelected=!1,e}))}),-1===y.selectedPolicyIndex?y.consumerProps.forEach(function(n){var i=a[n],o=S.CONSUMER_ID_PROP_MAP[n];i.forEach(function(i){var a=i.policyIndex===t?e:y.policiesList[i.policyIndex],s=angular.copy(a[n]),l=r.findIndex(s,_defineProperty({},o,i[o]));-1!==l&&(s.splice(l,1),a[n]=s),a.consumersCount--})}):(y.consumerProps.forEach(function(e){y.selectedPolicy[e]=o[e]}),y.selectedPolicy.consumersCount-=i),e.consumersCount+=i,y.consumerProps.forEach(function(t){e[t]=r.sortBy(e[t],S.CONSUMER_ID_PROP_MAP[t])}),y.policiesList[t]=e,y.selectedConsumersCount=0,-1===y.selectedPolicyIndex&&(y.policiesToShowConsumersFrom=angular.copy(y.policiesList)),n(e).then(function(){return v.success("notifications.saved")}).then(function(){return y.deselectSelectedConsumers()})};y.onDropComplete=function(e,t,n,i){if(y.dragStarted=!1,y.dragStartCoords={},e){if(y.selectedConsumersCount<2){var o=e.item;return o.policyIndex===i?a.when(!0):(o.dropped=!0,o.isSelected=!0,x(n,i,function(t){return _.addConsumerToPolicy(t.id,r.extend({},o,{type:"hosts"===e.prop?"host":"segment"})).then(function(){o.isSelected=!1})}))}return r.forEach(y.selectedConsumers,function(e){e.isSelected=!0}),x(n,i,function(e){return _.savePolicyConsumers(e.id,e)})}},y.selectedConsumers={},y.toggleConsumerSelectedState=o(function(e,t,n){if(!e.isBeingDragged){var i=n.target,a=i.classList.contains("policy-consumers-list__consumer")?i:i.closest(".".concat("policy-consumers-list__consumer")),o=e[S.CONSUMER_ID_PROP_MAP[t.prop]];e.isSelected=!e.isSelected,e.isSelected?(y.selectedConsumers[o]=e,y.selectedConsumersCount++,y.selection.select(a)):(delete y.selectedConsumers[o],y.selectedConsumersCount--,y.selection.removeFromSelection(a))}},100,!0),y.showAllConsumers=function(){y.deselectSelectedConsumers(),y.selectedPolicy.isBeingRenamed&&y.cancelPolicyRename(),y.selectedPolicy.isSelected=!1,y.selectedPolicy={},y.selectedPolicyIndex=-1,y.selectedConsumersCount=0,y.policiesToShowConsumersFrom=angular.copy(y.policiesList),L(y.selectedPolicy)},y.consumerProps=Object.keys(S.CONSUMER_ID_PROP_MAP),y.itemDataByProp={segments:{label:"description",type:"segment",isSegment:!0},hosts:{label:"name",type:"device",isSegment:!1}};y.deselectSelectedConsumers=function(){y.consumerProps.forEach(function(e){y.policiesToShowConsumersFrom.forEach(function(t){t[e].forEach(D)})}),y.selection.clearSelection(),y.toPolicy=null,y.selectedConsumersCount=0,y.selectedConsumers={}},y.moveConsumers=function(){for(var e={},t=-1,n=0,i=y.policiesList.length;n<i;++n){var o=y.policiesList[n];if(o.id===y.toPolicy){e=angular.copy(o),t=n;break}}return-1===t?a.when(!1):x(e,t,function(e){return _.savePolicyConsumers(e.id,e)})},y.moveConsumersFormIsVisible=!1;var R=n.$watch("vm.selectedConsumersCount",r.debounce(function(e){isNaN(e)||(y.moveConsumersFormIsVisible=e>0)}));n.$on("$destroy",R),y.dragStarted=!1,y.dragJustCompleted=!1,y.dragStartCoords={},y.drag={_onDragStop:function(t){y.dragStarted=!1,y.dragStartCoords={},t&&r.get(t,"item.dropped")||(t&&t.item&&(t.item.isBeingDragged=!1),e(function(){y.dragJustCompleted=!1}))},onStart:function(e,t){y.dragJustCompleted=!1,y.dragStarted=!0,y.dragStartCoords={x:e.x,y:e.y},t.item.isBeingDragged=!0},onComplete:function(t,n){y.dragJustCompleted=!0,y.dragStarted=!1,y.dragStartCoords={},e(function(){n&&(n.item.isBeingDragged=!1)})},onFailed:function(t,n,i,a){if(!y.dragJustCompleted){var o=t.x,s=t.y,r=[o-y.dragStartCoords.x,s-y.dragStartCoords.y].reduce(function(e,t){return e+t*t},0);isNaN(r)||Math.sqrt(r)<6?(y.drag._onDragStop(n),y.toggleConsumerSelectedState(i,a,t)):e(function(){return y.drag._onDragStop(n)})}}},y.onPolicyClick=function(e){y.selectedPolicyIndex!==e||y.selectedPolicy.isDefaultDevicePolicy?y.selectPolicy(e):y.showPolicyNameEditor()};var M=function(e){return{interface:e.interface,isEnabled:e.isEnabled}},$=function(e,t){return!function(e,t){for(var n=0,i=e.length;n<i;++n){var a=e[n],o=t[n];if(a.interface!==o.interface||a.isEnabled!==o.isEnabled)return!1}return!0}(t.map(M),e.initialInterfacesData.interfaces.map(M))||e.isAuto!==e.initialInterfacesData.isAuto};y.selectPolicy=function(t){if(y.selectedPolicyIndex===t)return a.when(!1);y.selectedPolicy.isBeingRenamed&&(y.selectedPolicy.isSaved?O():y.unsavedNewPolicyIsBeingRenamed&&(y.policiesList.splice(y.policiesList.length-2,1),y.unsavedNewPolicyIsBeingRenamed=!1)),y.ui.lock(),y.selectedConsumersCount>0&&y.deselectSelectedConsumers(),r.isEmpty(y.selectedPolicy)||(y.selectedPolicy.isModified=$(y.selectedPolicy,y.interfacesList)),y.selectedPolicy.interfaces=angular.copy(y.interfacesList),-1!==y.selectedPolicyIndex&&(y.selectedPolicy[y.selectedPolicyIndex]=angular.copy(y.selectedPolicy)),y.policiesList.forEach(function(e){e.isSelected=!1}),y.otherModifiedPoliciesCount=y.policiesList.filter(function(e){return e.isModified}).length,y.selectedPolicy=y.policiesList[t],y.selectedPolicy.isModified&&y.otherModifiedPoliciesCount--,y.selectedPolicy.descriptionOnSelect=y.selectedPolicy.description,y.selectedPolicy.isSelected=!0,y.policiesToShowConsumersFrom=[y.selectedPolicy],y.selectedPolicyIndex=t,y.interfacesList=angular.copy(y.selectedPolicy.interfaces),L(y.selectedPolicy);var n=a.defer();return e(function(){y.resetInterfacesOrderForm(),y.setAutoCheckboxFormPristine(),y.ui.unlock().then(n.resolve)}),n.promise},n.$on("inputModified.formChanged",function(){y.ui.isLocked||y.mode!==y.PAGE_TAB.INTERFACE_PRIORITIES||-1===y.selectedPolicyIndex||(y.selectedPolicy.isModified=$(y.selectedPolicy,y.interfacesList),y.policiesList[y.selectedPolicyIndex]&&(y.policiesList[y.selectedPolicyIndex].isModified=y.selectedPolicy.isModified))});var F=function(){y.policyNames=r.map(y.policiesList,"description").filter(angular.identity),y.selectedPolicy.isSaved&&(y.policyNames=y.policyNames.filter(function(e){return e!==y.selectedPolicy.description}))};y.addNewPolicy=function(){y.policyIsBeingRenamed=!0,y.unsavedNewPolicyIsBeingRenamed=!0,y.selectedPolicy.isSelected=!1,y.selectedPolicy.isBeingRenamed=!1;var e=_.getFreePolicyName(y.policiesList.map(function(e){return e.id})),t=r.extend(_.getNewPolicyData("",angular.copy(y.globalInterfaces)),{isBeingRenamed:!1,isSelected:!1,isSaved:!1,isModified:!1},{id:e,isBeingRenamed:!0,isSaved:!1,isSelected:!0});t.initialInterfacesData={interfaces:angular.copy(t.interfaces),isAuto:!1};var n=y.policiesList.length-1;return y.policiesList.splice(n,0,t),y.selectPolicy(n).then(F)},y.showPolicyNameEditor=function(e){e&&e.preventDefault(),y.policyIsBeingRenamed=!0,y.selectedPolicy.isBeingRenamed=!0,F()},y.interfacePriorityTable={columns:{isEnabled:{title:"policies.interface-priorities.interface",width:22,directive:{name:"ndm-checkbox",options:{label:"","ng-attr-disabled":"row.isDisabled",name:"iface-{{row.index}}-is-enabled"}}},interface:{title:" ",modify:function(e,t){var n,i=t.kind===_.constants.ISP,a="IPoE"===t.type,o=m.isDslInterfaceId(e)||t.via&&m.isDslInterfaceId(t.via),s=i&&(a||t.via&&!m.isDslInterfaceId(t.via)),c=r.get(y.l10n.connTypes,E[t.type],t.type);n=o?y.l10n.connTypes.UsbDsl:s?y.l10n.connTypes.wired:e===l.INTERNAL_LTE_ID?y.l10n.connTypes["internal-lte"]:c,t.via&&(n+=" / ".concat(t.type));var p=r.get(t,"id","");return-1!==p.indexOf(d.MASTER_IFACE_PREFIX)&&(n+=" "+y.l10n.wispRange[r.includes(p,l.MASTER_5G)?"5":"2"]),u.escapeHtml(y.interfaceIdToDescriptionMap[p]||u.getInterfaceL10n(t))+'<div class="help-text">'+(i?y.l10n.ispType:t.kind)+(i?" ("+n+")":"")+"</div>"}}},data:[],onDragStart:function(){y.tableDragStarted=!0},onDragEnd:function(e){e.source.index!==e.dest.index&&(y.selectedPolicy.isModified=$(y.selectedPolicy,y.interfacesList),y.policiesList[y.selectedPolicyIndex]&&(y.policiesList[y.selectedPolicyIndex].isModified=y.selectedPolicy.isModified)),y.tableDragStarted=!1}},y.isPolicyNameUnique=function(e){if(-1!==y.policyNames.indexOf(e))return u.getTranslation("policies.error.policy-name-must-be-unique")},y.renamePolicy=function(){if(y.selectedPolicy.description&&!r.get(y,"policyRenameForm.$invalid")){var e=y.selectedPolicy.isSaved;return _.renamePolicy(y.selectedPolicy.id,y.selectedPolicy.description).then(function(){y.selectedPolicy.isSaved||(y.unsavedNewPolicyIsBeingRenamed=!1),y.selectedPolicy.isBeingRenamed=!1,y.selectedPolicy.descriptionOnSelect=y.selectedPolicy.description,y.selectedPolicy.isSaved=!0,y.policyIsBeingRenamed=!1}).then(function(){return _.doesPolicyExist(y.selectedPolicy.id)}).then(function(t){t?e||(y.selectedPolicyInitialData=angular.copy(y.selectedPolicy)):(y.policiesList.splice(y.selectedPolicyIndex,1),y.selectPolicy(0))})}},y.cancelPolicyRename=function(){var e=y.ui.lock();return y.selectedPolicy.isSaved?e.then(function(){return O()}):e.then(function(){return N()}),a.when(e).finally(function(){y.policyIsBeingRenamed=!1,y.ui.unlock()})},y.removeSelectedPolicy=function(){if(!y.selectedPolicy.isDefaultDevicePolicy){if(!y.selectedPolicy.isSaved)return N();var e=y.selectedPolicyIndex;return g.confirm(u.getTranslation("policies.confirm.delete-policy",null,{profile:y.selectedPolicy.description})).then(function(){return _.removePolicy(y.selectedPolicy.id)}).then(function(){return y.selectedPolicy.hosts.forEach(function(e){e.isSelected=!0}),y.selectedPolicy.segments.forEach(function(e){e.isSelected=!0}),y.toPolicy=S.DEFAULT_PERMIT_POLICY,y.moveConsumers()}).then(function(){y.policiesList.splice(e,1),y.selectPolicy(0)})}},y.setAutoCheckboxFormPristine=function(){return r.get(y,"autoCheckboxForm.$setPristine",angular.noop)()},y.resetAutoCheckboxForm=function(){return r.get(y,"autoCheckboxForm.reset",angular.noop)()},y.resetInterfacesOrderForm=function(){var e=y.interfacesOrderForm;e&&(e.reset(),e.modifiedModels.forEach(function(e){return e.reset()}),e.modifiedCount=0,e.modifiedModels=[],e.modified=!1,e.$pristine=!0)},y.saveAllModifiedPolicies=function(){if(!y.ui.isLocked){y.ui.lock();var e={};return y.policiesList.forEach(function(t,n){if(!t.isModified){if(t.id!==y.selectedPolicy.id)return;if(!r.get(y,"interfacesOrderForm.modified")&&y.selectedPolicy.isAuto===y.selectedPolicy.initialInterfacesData.isAuto)return}var i,a=[];y.selectedPolicyIndex===n?(a=A(y.interfacesList),i=y.selectedPolicy.isAuto):(a=A(t.interfaces),i=t.isAuto),e[t.id]={isAuto:i,interfaces:a,description:t.description}}),_.savePoliciesConfigurations(e).then(function(){-1!==y.selectedPolicyIndex&&(y.selectedPolicy.interfaces=A(y.interfacesList).map(function(e){return e.isEnabled=angular.isDefined(e.order),e}),y.policiesList[y.selectedPolicyIndex]=angular.copy(y.selectedPolicy))}).then(_.getInterfacesOrderObject).then(function(e){y.policiesList=y.policiesList.map(function(t){var n=new Array(t.interfaces.length).fill(null);return e[t.id]?t.interfaces.forEach(function(i){n[e[t.id][i.name]]=angular.copy(i)}):n=angular.copy(t.interfaces),t.interfaces=n,t.initialInterfacesData={interfaces:angular.copy(n),isAuto:t.isAuto},t.isModified=!1,t}),-1!==y.selectedPolicyIndex&&(y.selectedPolicy=angular.copy(y.policiesList[y.selectedPolicyIndex])),y.interfacesList=angular.copy(y.selectedPolicy.interfaces),y.selectedPolicy.isModified=!1,y.otherModifiedPoliciesCount=0,r.get(y,"interfacesOrderForm.$setPristine",angular.noop)(),y.setAutoCheckboxFormPristine(),v.success("notifications.saved")}).finally(y.ui.unlock)}},y.resetAllModifiedPolicies=function(){if(!y.ui.isLocked)return y.ui.lock(),y.policiesList=y.policiesList.map(function(e){return e.interfaces=angular.copy(e.initialInterfacesData.interfaces),e.isAuto=e.initialInterfacesData.isAuto,e.isModified=!1,e}),y.interfacesList=angular.copy(y.selectedPolicy.interfaces),y.selectedPolicy.isModified=!1,y.otherModifiedPoliciesCount=0,y.resetInterfacesOrderForm(),y.setAutoCheckboxFormPristine(),y.ui.unlock()};_.getInitialData().then(function(e){y.interfacesData=e.raw.interface,y.interfaceAliases=e.ifaceAliases,y.globalInterfaces=e.globalInterfaces,y.interfaceIdToDescriptionMap=e.interfaceIdToDescriptionMap,y.policiesList=e.policiesList.map(function(e){return e.segments=e.segments.map(D),e.hosts=e.hosts.map(D),e.interfaces=e.interfaces.map(function(t){return t.isDisabled=e.isDefaultDevicePolicy,t}),e.initialInterfacesData={interfaces:angular.copy(e.interfaces),isAuto:e.isAuto},r.extend(e,{isBeingRenamed:!1,isSelected:!1,isSaved:!1,isModified:!1},{isSaved:!0})});var t=e.policiesCount-1;return y.rawRciData=e.raw,y.policiesList[0].description="policies.permit-policy",y.policiesList[t].description="policies.deny-policy",y.segments=e.segments,y.hosts=e.hosts,h.getAclConfiguration(e.raw.interface).then(function(e){y.segmentsAcl=e.segments,y.noAclConfigured=e.noAclConfigured,y.selectPolicy(0),y.progress=100})})}e.$inject=["$timeout","$window","$scope","$rootScope","$q","debounce","Selection","_","NDM","CONSTANT","wifiOptions","browserCheck","utils","interfaces","keyboard","modal","notification","wirelessAcl","pppConstants","policies"],angular.module("keenetic").controller("PoliciesController",e)}(),function(){function e(e,t,n,i){var a=e.some([n.pptp,n.l2tp,n.pppoe,n.openvpn,n.sstp]),o=Boolean(n.wireguard),s=Boolean(n.ipsec),r=Boolean(n.ip6),l=i.createRequester();l.setPollInterval(2e3);var c=function(){return e.filter([a,s,r,o]).length},d=c(),p=e.noop,u={};return{ANY_PPP_INSTALLED:a,IPSEC_INSTALLED:s,IPV6_INSTALLED:r,WIREGUARD_INSTALLED:o,EMPTY_VAL_HTML:"&mdash;",requester:l,setOnReadyCallback:function(e){p=e},resetServiceState:function(){l.clearCallbacks(),l.stopPolling(),d=c()},setSectionReady:function(){0==--d&&(l.startPolling(),p())},getSharedData:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return u[e]||t},setSharedData:function(e,t){u[e]=t},formatBytesColumn:function(e){return isNaN(Number(e))?"&mdash;":t.format.size(Number(e))}}}e.$inject=["_","utils","components","requesterFactory"],angular.module("keenetic").factory("otherConnectionsService",e)}(),function(){function e(e,t){var n=this,i=t.ANY_PPP_INSTALLED,a=t.IPSEC_INSTALLED,o=t.IPV6_INSTALLED,s=t.WIREGUARD_INSTALLED;n.progress=0,n.WIREGUARD_INSTALLED=s,n.ANY_PPP_INSTALLED=i,n.IPSEC_INSTALLED=a,n.IPV6_INSTALLED=o,t.setOnReadyCallback(function(){n.progress=100}),e.$on("$destroy",function(){return t.resetServiceState()})}e.$inject=["$scope","otherConnectionsService"],angular.module("keenetic").controller("OtherConnectionsController",e)}(),function(){function e(e,t,n,i,a,o,s,r,l,c,d){var p=Boolean(a.pingcheck),u={no:!0},m=c.NETWORK_TYPE,f=function(){return s.toRciQueryList(["show.interface","show.rc.interface",p?"show.rc.ping-check":{}])},g=function(){var e=f();return i.cached(e).then(function(e){return{showInterface:n.get(e,"[0]",{}),showRcInterface:n.get(e,"[1]",{}),showRcPingcheck:n.get(e,"[2]",{})}})},v=function(e){return n.get(e,"ip.global.order",-1)},h=function(e){return g().then(function(t){var i=t.showInterface,a=t.showRcInterface,o=t.showRcPingcheck,s=a[e]||{},r=i[e]||{},l=!n.isEmpty(o)&&o;return[_defineProperty({},e,s),_defineProperty({},e,r),l]})},b=function(t,a,o){var s=[a];return(p?i.get("interface"):e.when({})).then(function(e){return p&&(s=s.concat(d.getSavingQueries(o.pingcheck,t,!0,e))),n.get(a,["interface",t,"no"])&&(s=s.slice(1)).push(a),i.postAndSave(s)})};return{loadData:function(){return g().then(function(e){var t=e.showInterface;return[n.pickBy(t,function(e){var t=e.type;return n.includes(o.USB_MODEM_IFACE_TYPES,t)}),t]})},loadUsbmodemData:function(e){return h(e).then(function(t){var i=t[0][e],a=t[1],o=t[2]||{},s={};s.savedSchedule=n.get(i,"schedule",""),s.schedule=s.savedSchedule,s.global=Boolean(a.global),s.order=n.get(i,"ip.global.order",-1),s.state=Boolean(n.get(i,"connect.enabled")),s.isUp=Boolean(i.up),s.description=i.description||e||"";var r=i&&i.usb&&i.usb.apn,l=i.authentication,c=i.modem;if(s.apn=r&&r.apn||"",s.comment=r&&r.comment||"",s.identity=l&&l.identity||"",s.password=l&&l.password||"",s.phone=c&&c.connect&&c.connect.phone||"",s.at=!1,s.at1="",s.at2="",s.at3="",angular.isArray(n.get(i,"modem.init"))){s.at=!0;for(var p=0;p<i.modem.init.length;++p)s["at"+(p+1)]=i.modem.init[p].string}return s.pingcheck=d.getFormDataFromRawData(i,o.profile||{}),s})},saveUsbmodemData:function(e,t){var n=[u];if(t.at)for(var i=1;i<=3;++i)t["at"+i]&&n.push({string:t["at"+i]});var a={no:!1,description:t.description||t.preset||"",schedule:t.schedule||u,modem:{init:n,connect:{no:!t.phone,phone:t.phone}},usb:{apn:{apn:t.apn||"",comment:t.country+"."+t.preset||""}},authentication:{chap:!0,identity:t.identity||u,password:t.identity&&t.password?t.password:u,no:!t.identity},connect:{no:!t.state}};-1!==t.order&&(a.ip={global:{enabled:!0,order:t.order}});var o={interface:{}};return o.interface[e]=a,b(e,o,t)},saveCommonData:function(e,t){var n={interface:{}};return n.interface[e]={no:!1,schedule:t.schedule||u,description:t.description},~t.order&&(n.interface[e].ip={global:{enabled:!0,order:t.order}}),b(e,n,t)},loadCommonData:function(e){return g().then(function(t){var i=n.get(t,["showRcInterface",e],{}),a=t.showRcPingcheck,o={},s=n.get(i,"schedule","");return o.isUp=Boolean(i.up),o.description=i.description||e||"",o.order=v(i),o.schedule=s,o.savedSchedule=s,o.pingcheck=d.getFormDataFromRawData(i,a.profile||{}),o})},loadUsblteData:function(e){return h(e).then(function(t){var i=t[0][e],a=t[1],o=t[2]||{},s=i.authentication||{},r=i.usb&&i.usb.apn,l=n.get(i,"usb.acq",m.AUTO),c=i.connect||{},p="none";s.pap&&(p="pap"),s.chap&&(p="chap");var u=d.getFormDataFromRawData(i,o.profile||{}),f=i.description||e||"",g=v(i),h=n.get(i,"schedule","");return{apn:n.get(r,"apn",""),networkType:l,password:n.get(s,"password",""),identity:n.get(s,"identity",""),isUp:Boolean(i.up),global:Boolean(a.global),state:Boolean(c.enabled),savedSchedule:h,schedule:h,order:g,description:f,authType:p,pingcheck:u}})},saveUsblteData:function(e,t){var n={interface:{}},i={no:!1,description:t.description||"",usb:{apn:t.apn||u,acq:t.networkType===m.AUTO?u:t.networkType},schedule:t.schedule||u,authentication:{chap:"chap"===t.authType||u,pap:"pap"===t.authType||u,identity:t.identity||u,password:t.password||u,no:!t.identity||!t.authType||"none"===t.authType}};return-1!==t.order&&(i.ip={global:{enabled:!0,order:t.order}}),n.interface[e]=i,b(e,n,t)},setState:r.toggleState,deleteIface:function(e){return b(e,n.set({},["interface",e],u),{pingcheck:!1})},getModemsData:g,getGeneralModemQueries:f,PRESET_COUNTRY_SEPARATOR:".",OTHER_OPTION:"other",USBMODEM_DEFAULT_PRESET:{apn:"internet",identity:"",password:"",phone:"*99#"},USBQMI_TAB_ACTIVE:"USBQMI_TAB_ACTIVE",EXTERNAL_MODEM_TAB_ACTIVE:"EXTERNAL_MODEM_TAB_ACTIVE",CONNECTION_REMOVED:"CONNECTION_REMOVED",START_TABS_SYNC:"START_TABS_SYNC",STOP_TABS_SYNC:"STOP_TABS_SYNC",LOCK_UI:"LOCK_UI",UNLOCK_UI:"UNLOCK_UI"}}e.$inject=["$q","$timeout","_","router","components","CONSTANT","utils","interfaces","constants","modemsCommon","pingcheckModel"],angular.module("keenetic").factory("modems",e)}(),function(){function e(e,t,n,i,a,o,s,r,l,c,d,p,u,m,f,g,v,h,b,_,y){var S=this,w=i.current.name,C=_.OTHER_OPTION,E=angular.copy(_.USBMODEM_DEFAULT_PRESET),I=h.SHOW_INTERFACE_OPERATORS_SCANNING,T=h.SHOW_INTERFACE_OPERATORS_OPERATOR,k=h.SCAN_STATUS;S.progress=50,S.pingcheckInstalled=u.pingcheck,S.ui={isLocked:!1,lock:function(){return S.ui.isLocked=!0,o.$broadcast(_.LOCK_UI),e.when(!0)},unlock:function(){return S.ui.isLocked=!1,o.$broadcast(_.UNLOCK_UI),e.when(!0)}};var P=function(e){return s.startsWith(s.get(e,"id"),h.USB_QMI_INTERFACE_TYPE)};c.flushCache();var A=a.onStart({from:w},function(t){return t.to().name!==w&&s.includes(["sref","url"],t.options().source)?D(S.activeId):e.when(!0)});n.$on("$destroy",function(){return c.flushCache()}),n.$on("$destroy",A);var D=function(t){return S.isUsbQmiTabActive?e.when(S.onSwitchFromUsbQmiTab()):function(t){x();return s.get(S,["modems",t,"form","modified"])?l.confirmLeave(function(){return s.invoke(S,["modems",t,"form","reset"])}).then(function(e){return e||R(),e}):(R(),e.when(!0))}(t)},O=[o.$on(_.CONNECTION_REMOVED,function(){return R()}),o.$on(_.START_TABS_SYNC,function(){return R()}),o.$on(_.STOP_TABS_SYNC,function(){return x()})];n.$on("$destroy",function(){O.forEach(function(e){return e()})});var N,L=function(e){var t={label:"modems.preset-other",id:C};if(e===C)return[t];var n=S.mobileOperatorsByCountry[e],i=s.map(n,function(e,t){return{id:t,label:e.localName}});return[t].concat(_toConsumableArray(i))};function x(){t.cancel(N),c.reset()}function R(){return t.cancel(N),_.loadData().then(function(e){var n=e[0];S.allInterfaces=e[1],S.shSchedules=e[2],function(e){for(var t in S.modems)e[t]||(delete S.modems[t],t===S.activeId&&S.tabSelect(!1));for(var n in e)S.modems[n]?S.modems[n].iface=e[n]:(S.modems[n]={iface:e[n],id:n},V(S.modems[n])),S.modems[n].ifaceDataUpdated()}(n),S.tabs=s.chain(S.modems).map(function(e,t){var n=s.find(S.tabs,function(e){return e.id===t}),i=e.iface?d.getInterfaceL10n(e.iface):e.data.description||e.iface.description||e.id;return n?Object.assign({},n,{title:i}):Object.assign({},e,{title:i})}).sortBy(function(e){var t=e.id.replace(/\d/g,"");return t===h.USB_QMI_INTERFACE_TYPE?0:1}).value(),S.activeId||S.isUsbQmiTabActive||S.activeId&&S.modems[S.activeId]||!S.tabs.length||S.tabSelect(S.tabs[0]),N=t(R,1e3)})}S.mobileOperatorsByCountry={},S.modems={},S.tabs=[],S.activeId=void 0,S.allInterfaces=[],g.getAll().then(function(e){var t;S.mobileOperatorsByCountry=e,t=o.$on(r.events.TABS_TAB_CHANGED,function(e,t){var i=t.currentActiveTab,a=P(i)?_.USBQMI_TAB_ACTIVE:_.EXTERNAL_MODEM_TAB_ACTIVE;n.$broadcast(a)}),n.$on("$destroy",t),R().then(function(){S.progress=100})}),n.$on("$destroy",function(){x(),S.tabSelect(!1)}),S.onTabSelect=function(e,t){return S.tabSelect(t)},S.canSwitchTab=function(e,t,n,i){return S.ui.lock(),D(i.id).finally(S.ui.unlock)},S.tabSelect=function(e){if(S.isUsbQmiTabActive=P(e),S.isUsbQmiTabActive)v.setState({interfaceId:e.id,pinAttemptsLeft:0,simState:h.SIM_CARD_STATE.UNKNOWN});else if((!e.id||S.activeId!==e.id)&&(S.activeId&&S.modems[S.activeId]&&(S.modems[S.activeId].active=!1),S.activeId=void 0,s.isObject(e))){S.activeId=e.id;var t=S.modems[S.activeId];s.get(t,"form.modified")?t.active=!0:t.init().then(function(){t.active=!0}),$(S.modems[S.activeId])}};var M=function(){return s.get(i,"params.interfaceId","")};S.airScanPopup={isVisible:!1,open:function(){var e=M();e?(v.setState({operators:null}),b.scanRequester.registerCallback(b.getScanQuery(e),function(e){var t=_slicedToArray(e,1)[0],n=s.get(t,I),i=s.get(t,T,{});v.setState({scanStatus:n}),i.length&&n===k.COMPLETE&&v.setState({operators:i})}),b.getScanResults(e).then(function(t){if(s.get(t,I,null)!==k.PROGRESS)return b.toggleScan(e,!0)}).then(function(){S.airScanPopup.isVisible=!0,b.scanRequester.startPolling(),b.requester.stopPolling()})):S.airScanPopup.close()},close:function(){var e=M();e&&b.getScanResults(e).then(function(t){s.get(t,I,null)===k.PROGRESS&&b.toggleScan(e,!1)}),S.airScanPopup.isVisible=!1,b.scanRequester.stopPolling(),b.scanRequester.clearCallbacks(),b.requester.startPolling(),t(function(){return i.go("controlPanel.modems")})}};var $=function(e){return s.get(e,"form.$setPristine",s.noop)()},F={};function V(e){e.tpl=!1,e.active=!1,e.loading=!1,e.isInitialized=!1,e.form={},e.data={},e.options={},e.init=function(){},e.submit=function(){},e.ifaceDataUpdated=function(){e.updateStatus()},e.state=!1,e.status={text:"...",color:"gray"},e.stateSwitching=!1,e.updateStatus=function(){if(!e.stateSwitching){var t=e.data.up&&e.data.savedSchedule&&S.shSchedules?S.shSchedules[e.data.savedSchedule]:{};e.status=m.determineInterfaceState(e.iface,t),e.state="up"===e.iface.state}},e.onToggle=function(){return e.switchToggle()},e.switchToggle=function(){return e.stateSwitching=!0,e.status={text:"...",color:"gray"},_.setState(e.id,!e.data.isUp).then(function(){t(function(){e.stateSwitching=!1},500)})},e.delete=function(){if(!S.ui.isLocked){x(),S.ui.lock();var n=function(){return R().finally(S.ui.unlock)};l.confirm("modems.editor.delete-confirm").then(function(){return _.deleteIface(e.id).then(function(e){c.containsAnyNdmErrors(e)?t(function(){p.error("modems.editor.failed-to-delete-modem")}):t(function(){p.success("modems.editor.deleted")})}).then(n)},function(){R(),S.ui.unlock()})}},angular.isFunction(F[e.iface.type])?F[e.iface.type](e):F.common(e)}function U(){t(function(){p.success("modems.editor.saved")})}F.UsbModem=function(e){function t(t,n){["apn","identity","password","phone"].forEach(function(i){n&&e.data[i]||(e.data[i]=angular.isDefined(t[i])?t[i]:E[i])})}e.tpl="usbmodem",e.init=function(){e.loading=!0;var n=[];return s.forEach(S.mobileOperatorsByCountry,function(e,t){n.push({id:t,label:d.getTranslation("country."+t)})}),n.sort(function(e,t){return e.label<t.label?-1:1}),n.unshift({id:C,label:d.getTranslation("country.other")}),e.options.countries=n,_.loadUsbmodemData(e.id).then(function(n){e.data=n;var i=e.data.comment.split(_.PRESET_COUNTRY_SEPARATOR);i.length>1?(e.data.preset=i[1],e.data.country=i[0]):(e.data.preset=C,e.data.country=C),e.options.presetsSelect=L(e.data.country);var a=e.options.presetsSelect.map(function(e){return e.id});s.includes(a,e.data.preset)||(e.data.preset=C,e.countrySelected(C)),e.data.comment||e.data.apn||t(E),e.loading=!1,e.isInitialized=!0,$(e)})},e.submit=function(){e.loading=!0,e.data.country!==C&&e.data.preset!==C&&t(S.mobileOperatorsByCountry[e.data.country][e.data.preset],!0),e.data.state=e.state,e.data.global=e.state,_.saveUsbmodemData(e.id,e.data).then(function(){return U(),e.init()})},e.presetSelected=function(n){e.data.country!==C&&n!==C&&t(S.mobileOperatorsByCountry[e.data.country][n])},e.countrySelected=function(n){if(e.options.presetsSelect=L(n),n!==C&&e.data.preset!==C){var i=Object.keys(S.mobileOperatorsByCountry[n]).sort();-1===i.indexOf(e.data.preset)&&(e.data.preset=i[0],t(S.mobileOperatorsByCountry[n][e.data.preset]))}else e.data.preset=C,t(E)},e.atCheckboxClick=function(){e.form.at.$viewValue&&[1,2,3].forEach(function(t){e.form["at"+t]&&e.form["at"+t].reset()})}},F.UsbLte=function(e){e.tpl="usblte",e.init=function(){return e.loading=!0,e.options.authTypeSelect=y.getAuthTypeOptions(),e.options.networkType=y.getNetworkTypeOptions(),_.loadUsblteData(e.id).then(function(t){e.data=t,e.data.authType||(e.data.authType="none"),e.loading=!1,e.isInitialized=!0,$(e)})},e.submit=function(){e.loading=!0,e.data.state=e.state,e.data.global=e.state,_.saveUsblteData(e.id,e.data).then(function(){e.init(),U()})}},F.common=function(e){e.tpl=!1,e.init=function(){return e.loading=!0,_.loadCommonData(e.id).then(function(t){e.data=t,$(e),e.loading=!1,e.isInitialized=!0})},e.submit=function(){e.loading=!0,S.ui.lock(),e.data.state=e.state,e.data.global=e.state,_.saveCommonData(e.id,e.data).then(function(){return U(),e.init()}).finally(S.ui.unlock)}}}e.$inject=["$q","$timeout","$scope","$state","$transitions","$rootScope","_","CONSTANT","modal","router","utils","notification","components","interfaces","schedules","mobileOperatorsDb","usbQmiSharedState","usbQmiConstants","usbQmi","modems","modemsCommon"],angular.module("keenetic").controller("ModemsController",e)}(),function(){function e(e,t){var n,i={STANDARD_2G_GPRS:"2G GPRS",STANDARD_2G_EDGE:"2G EDGE",STANDARD_3G_WCDMA:"3G WCDMA",STANDARD_3G_HSPA:"3G HSPA",STANDARD_3G_HSPA_PLUS:"3G HSPA+",STANDARD_4G:"4G",STANDARD_4G_PLUS:"4G+",STANDARD_UNKNOWN:""},a={RSSI:"rssi",CINR:"cinr",ECIO:"ecio"},o=(_defineProperty(n={},a.RSSI,t.UNIT.DBM),_defineProperty(n,a.CINR,t.UNIT.DB),_defineProperty(n,a.ECIO,t.UNIT.DB),n),s={AUTO:"auto",GSM:"gsm",UMTS:"umts",LTE:"lte"},r={NONE:"none",PAP:"pap",CHAP:"chap"},l=function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return e.get(t,"mobile",n||i.STANDARD_UNKNOWN)},c=function(e){return[i.STANDARD_4G,i.STANDARD_4G_PLUS].includes(e)},d=function(e){return[i.STANDARD_3G_WCDMA,i.STANDARD_3G_HSPA,i.STANDARD_3G_HSPA_PLUS].includes(e)},p=function(t){var n=l(t);if(!d(n)&&!c(n))return"";var i=e.get(t,"signal-level",0);return'<i class="icon icon--mobile-signal-'.concat(i,'"></i>')};return{CELLULAR_STANDARDS:i,SIGNAL_STRENGTH_PROPS:a,SIGNAL_STRENGTH_UNITS:o,NETWORK_TYPE:s,AUTH_TYPE:r,getCurrentStandard:l,is4gStandard:c,is3gStandard:d,getSignalLevelMeterHtml:p,getSignalLevelValue:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=Object.assign({l10nData:{},noValueStr:"",forceCinrRssi:!1},n),s=e.get(i,"l10nData.units",{}),r=l(t),d=c(r)||i.forceCinrRssi,u=d?[a.CINR,a.RSSI]:[a.ECIO,a.RSSI],m=d?"cinr-rssi":"ecio-rssi",f=e.chain(u).map(function(e){return t[e]?"".concat(t[e]," ").concat(s[o[e]]):n.noValueStr}).join(" / ").value(),g=p(t);return{l10nKey:m,value:"".concat(f," ").concat(g),hasIcon:Boolean(g)}},getNetworkTypeOptions:function(){return[{id:s.AUTO,label:"modems.editor.usblte.acq-option.auto"},{id:s.GSM,label:"modems.editor.usblte.acq-option.gsm"},{id:s.UMTS,label:"modems.editor.usblte.acq-option.umts"},{id:s.LTE,label:"modems.editor.usblte.acq-option.lte"}]},getAuthTypeOptions:function(){return[{id:r.NONE,label:"modems.editor.usblte.auth-type-no"},{id:r.CHAP,label:"CHAP"},{id:r.PAP,label:"PAP"}]}}}e.$inject=["_","CONSTANT"],angular.module("keenetic").factory("modemsCommon",e)}(),function(){function e(e,t,n){var i=n.LAN;return{get:function(){return e.get("interface/"+i).then(function(e){var n=e.ip,i=n.address;return{mode:i.dhcp?"auto":"static",ip:i.address||"",mask:i.mask||"",gateway:n.gateway||"",dns:(n["name-server"]||[]).map(t.nameServerObjToAddress)}})},set:function(n){var a,o={interface:{}};return a="auto"===n.mode?[{no:!0},{dhcp:!0}]:[{dhcp:{no:!0}},{address:n.ip,mask:n.mask}],o.interface[i]={ip:{address:a,gateway:n.gateway,"name-server":[{no:!0}].concat((n.dns||[]).filter(angular.identity).map(t.addressToNameServerObj))}},e.postAndSave(o)}}}e.$inject=["router","ifaceIpModel","NDM"],angular.module("keenetic").factory("ipService",e)}(),function(){function e(e,t,n,i){var a=this;a.progress=0,a.form={},a.formName="ipSettings",a.data={mode:"auto"},a.ipModes=[{id:"auto",label:i.getTranslation("ip.modes.auto")},{id:"static",label:i.getTranslation("ip.modes.static")}],a.maskOptions=i.idsToOptions(n.getMasksArray(),angular.identity);var o=function(){t.get().then(function(t){a.data=t,a.progress=100,e.get(a,"form.$setPristine",angular.noop)()})};a.save=function(){t.set(a.data).then(o)},o()}e.$inject=["_","ipService","ipV4Service","utils"],angular.module("keenetic").controller("SpecialModeIpController",e)}(),function(){function e(e,t,n,i,a,o,s,r,l,c,d,p,u){var m=Boolean(a.pingcheck),f=u.PORT_ROLE,g=u.ROLE,v=u.DSL_MODE,h=u.SNR_MARGIN,b=u.ROLE_ORDER,_={no:!0},y=function(e){return n.chain(e).map(function(e,t){var n=e.caption.replace("AUTO",i.getTranslation("auto"));return{id:t,label:n,name:n}}).sort().value()},S={adsl:v.ADSL,vdsl:v.VDSL,auto:v.AUTO},w=function(e){return 0!==e.length&&(e[0].bridge||e[0].interfaceId)},C=function(e){return s.get("interface/ipvc?parent=".concat(e)).then(function(i){var a=[e],o={},s={},r={},l={};return n.forEach(t.PORTS_MAP,function(e,n){o[n]=e.name===t.DSL?f.INET:f.FREE}),b.forEach(function(e){l[e]=[],s[e]=[],r[e]={},Object.keys(t.PORTS_MAP).forEach(function(t){r[e][t]=!1})}),s[f.INET]=[t.DSL],n.forEach(i,function(e,i){var r=e.role;e.interfaceId=i,a.push(i),r||(r=g.INET,e.role=r),e.encapsulation||(e.encapsulation=u.ENCAPSULATION.LLC),e.bridge&&a.push(e.bridge),e.vlanOverPvc=e["pvc-vlan"],e.adslVlan=e.vlanOverPvc?e.vlan:"",l[r].push(n.omit(e,["pvc-vlan"])),(e.port||"").split(",").filter(angular.identity).forEach(function(e){o[t.PORTS_IDS[e]]=r,s[r].push(e)})}),[f.IPTV,f.VOIP].forEach(function(e){s[e].forEach(function(n){r[e][t.PORTS_IDS[n]]=!0})}),a=n.uniq(a),{ipvcByRole:l,portmap:o,assignedPortRoles:s,portsWithRole:r,interfacesList:a}})},E=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],a=n.chain(e).pickBy(function(e,i){return!n.includes(t,i)}).mapValues(function(e){return e.ipoe}).pickBy().value();return n.reduce(a,function(e,t,a){var o,s;return(o=t,s=a,n.chain(u.BUSY_PORT_ROLES).map(function(e){return i.splitToNumbers(o[e+"-port"]).map(String).map(function(t){return{port:t,role:e,forInterface:s}})}).flatMap().value()).reduce(function(e,t){return Object.assign({},e,_defineProperty({},t.port,t))},e)},{})},I=function(a){var _={};return _.interface=[{},n.set({},"dsl.capabilities.name",a)],n.set(_,"rc.interface",{}),n.set(_,"rc.schedule",{}),m&&n.set(_,"rc.ping-check",{}),e.all([s.post({show:_}),C(a)]).spread(function(e,s){var m,_,C,I,T=e.show,k=n.get(T,"interface.0.interface",{}),P=n.get(T,"interface.1.dsl.capabilities",{}),A=T.rc.interface,D=function(e){var t={};return n.forEach(e,function(e,i){var a=e.category,o=S[a]||v.AUTO;t[o]||(t[o]={}),delete e.category;var s={id:i,label:e.caption,olr:[],annex:[],carrier:[],profile:[]};n.forEach(e,function(e,t){s[t]=n.isString(e)?e:y(e)}),t[o][i]=s}),t}(P),O=A[a]||{},N=n.map(D[v.ADSL],function(e){return{id:e.id,name:e.label}}),L=w(s.ipvcByRole[g.INET]),x=A[L],R=n.get(x,"rename",L),M=p.getPrototype(),$=[];b.forEach(function(e){s.ipvcByRole[e].length>0&&(M[e].ipvcArray=s.ipvcByRole[e],M[e].ipvcArray.forEach(function(e){$.push(e.interfaceId,e.bridge)})),M[e].ipvcArrayOnLoad=angular.copy(M[e].ipvcArray)}),M.portsWithRole=s.portsWithRole,M.assignedPortRoles=s.assignedPortRoles,M.line=(m=O,_=d.opmodeToCapabilityId(n.get(m,"operating-mode.mode",v.AUTO)),C=p.getPrototype().line,I=v.AUTO,_!==v.AUTO&&(I=n.includes(_,"vdsl")?v.VDSL:v.ADSL),C.dslMode=I,C.dslMode!==v.AUTO&&(C.operatingMode=_),C.annex=n.get(m,"operating-mode.annex",C.annex),C.profile=n.get(m,"vdsl.profile",C.profile),C.carrier=n.get(m,"vdsl.carrier",C.carrier),C.olr=(m.olr||[]).map(function(e){return Object.keys(e)[0]}),C.snrMarginOffset={adsl:n.get(m,"adsl.snr-margin-offset",h.ADSL.DEFAULT),vdsl:n.get(m,"vdsl.snr-margin",h.VDSL.DEFAULT)},C),M.inet.ip=x?r.getFormDataFromRawData(x,!1):M.inet.ip,M.inet.ppp=x?l.getFormDataFromRawDataByVia(L,A):M.inet.ppp,M.inet.pppIdOnLoad=M.inet.ppp.id,$.push(M.inet.ppp.id);var F=M.inet.ppp.id||L;M.inet.pingcheck=c.getFormDataFromRawData(A[F],n.get(T,"rc.ping-check",{}).profile||{});var V=M.inet.ppp.id||L,U=A[V];if(O.id=a,U.id=V,M.general=function(e,t,a){var o=t&&t.description?t:e,s=n.get(t,"ip.global.order");return n.isUndefined(s)&&(s=n.get(e,"ip.global.order")),n.isUndefined(s)&&(s=n.get(a,"ip.global.order")),{order:s,state:Boolean(e.up)&&Boolean(t.up),schedule:t.schedule||e.schedule||"",description:i.getInterfaceL10n(o)}}(O,U,M.inet.ppp.id?A[M.inet.ppp.id]:{}),[f.IPTV,f.VOIP].forEach(function(e){var t=w(s.ipvcByRole[e]),n=A[t];M[e].ip=n?r.getFormDataFromRawData(n,!1):M[e].ip}),isNaN(parseInt(n.get(M,"general.order"),10))){var B=o.countGlobalIfaces(A);M.general.order=x.ip?-1:B}var W=E(A,s.interfacesList);u.IS_DSL_DEVICE&&(W[t.DSL]={role:f.INET,forInterface:a}),n.forEach(s.portmap,function(e,t){M.portmap[t].role=e}),n.forEach(W,function(e,n){var i=t.PORTS_IDS[n],a=M.portmap[i];a.role=e.role,a.isBusy=!0,a.forInterface=e.forInterface}),b.forEach(function(e){M[e].ipvcArrayOnLoad=angular.copy(M[e].ipvcArray)}),M.portmapOnLoad=angular.copy(M.portmap),$=$.filter(angular.identity);var H=n.chain(o.getAllUsedSubnets(k,A)).filter(function(e){return!n.includes($,e.ifaceId)}).value();return{model:M,ipvcData:s,capabilities:D,adslModes:N,busyPorts:W,showInterfaceData:k,busyIps:H,statePollerData:{phy:a,main:w(s.ipvcByRole[g.INET]),alias:R,ppp:n.get(M,"inet.ppp.id"),schedule:n.get(M,"general.schedule"),pingcheckProfile:n.get(M,"inet.pingcheck.profileName")},raw:{interfaceData:A,showInterfaceData:k,dslCapabilities:P,pingcheckData:n.get(T,"rc.ping-check",{})}}})},T=function(e,t){return n.set({},["interface",t],e)},k=function(e,t){var i,a=t.line.dslMode,o={},r=(_defineProperty(i={},f.IPTV,[]),_defineProperty(i,f.VOIP,[]),i),l=function(e,t){var i=t.line,a={description:n.get(t,"general.description",""),schedule:_},o={mode:d.capabilityIdToOpmode(i.dslMode===v.AUTO?i.dslMode:i.operatingMode)};i.dslMode===v.ADSL?o.annex=i.annex:i.dslMode===v.VDSL&&(a.vdsl={carrier:i.carrier.length?i.carrier:_,profile:i.allProfileOptions.map(function(e){return{profile:e,no:!n.includes(i.profile,e)}})}),a["operating-mode"]=o;var s=i.olr;return a.olr=i.olr.length>0?i.allOlrOptions.map(function(e){var t;return _defineProperty(t={},e,!0),_defineProperty(t,"no",!n.includes(s,e)),t}):_,[a,n.set({},"adsl.snr-margin-offset",i.snrMarginOffset.adsl),n.set({},"vdsl.snr-margin",i.snrMarginOffset.vdsl)].map(function(t){return T(t,e)})}(e,t);return n.forEach(t.portmap,function(e){r[e.role]&&!e.isBusy&&r[e.role].push(e.port)}),n.forEach(r,function(e,n){var i=e.join(",");t[n].ipvcArray.forEach(function(e){e.port=i})}),b.forEach(function(e){t[e].ipvcArrayOnLoad=t[e].ipvcArrayOnLoad.filter(function(e){return e.interfaceId}),t[e].ipvcArrayOnLoad.forEach(function(e){o[e.interfaceId]=!0})}),b.forEach(function(i){var s=angular.copy(t[i].ipvcArray);angular.copy(t[i].ipvcArrayOnLoad).reverse().forEach(function(e){var t=i===g.INET?0:n.findIndex(s,function(t){return t.interfaceId===e.interfaceId});-1===t?(l.splice(1,0,p.getDeleteIpvcQuery(e.interfaceId)),delete o[e.interfaceId]):(l.push(p.getSaveIpvcQuery(e.interfaceId,s[t],a)),s.splice(t,1))}),s.forEach(function(t){var n=function(e,t){for(var n=0,i=function(){var i=e+n;if(!t.some(function(e){return e.startsWith(i)}))return{v:i};n++};;){var a=i();if("object"===_typeof(a))return a.v}}("".concat(e,"/Pvc"),Object.keys(o));o[n]=!0,l.push(p.getSaveIpvcQuery(n,t,a))})}),s.postToRciRoot(l)},P=function(e,t){return n.set({},["interface",e],{role:t})},A=function(t,i){var a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return k(t,i).then(function(){return e.all([C(t),(i={},n.set(i,"rc.interface",{}),m&&n.set(i,"rc.ping-check",{}),s.post({show:i}).then(function(e){var t=e.show;return{interfaceData:n.get(t,"rc.interface",{}),pingcheckData:n.get(t,"rc.ping-check",{})}}))]);var i}).spread(function(e,d){var p=[],u=[],m=d.interfaceData,v=w(e.ipvcByRole[g.INET]),h=i.inet.ppp,b=h.type!==l.PPP_TYPE.NONE,y=b?l.findIfaceIdToSave(h,m):v;u.push(v,y);var S={mainIfaceName:v,tunnelName:b?y:""},C=n.get(i,"general.order"),E=[o.getIpGlobalQuery(y,C)];v!==y&&E.push(o.getIpGlobalQuery(v,-1)),p=p.concat(l.getSavingQueriesArr(v,i.inet.ppp,m),r.getSavingQuery(i.inet.ip,v),E,c.getSavingQueries(i.inet.pingcheck,y,!0,m)),b&&p.push(P(l.findIfaceIdToSave(h,m),g.INET)),[f.IPTV,f.VOIP].forEach(function(t){var n=w(e.ipvcByRole[t]);n&&(u.push(n),(p=p.concat(r.getSavingQuery(i[t].ip,n))).push(P(n,t)))});var I=n.chain(u).filter(function(e){return r.isInterfaceIpConfigurationStatic(m[e])}).uniq().value().map(function(e){return r.getResetIpSettingsQuery(e)});p=[].concat(_toConsumableArray(I),_toConsumableArray(p));var k=n.get(i,"general.schedule")||_;return p.push(T({schedule:k},t)),a&&p.push(s.saveQueryStr().data),s.postToRciRoot(p).then(function(){return S})})},D=function(e){return n.map(e,function(e,t){return Object.assign({},e,{interfaceId:t})})};return{PINGCHECK_INSTALLED:m,format:{toDslSpeed:function(e){return parseInt((e||"").split(" ")[0],10)||0},toDslLevel:function(e){return"NA"!==e&&e?e.split(" ")[0]:"-"},withUnit:function(e,t){return"".concat(e," ").concat(t)},pairOfValues:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:angular.identity;return"".concat(i(e)," / ").concat(i(t)).concat(n?" "+n:"")}},applyDslIspPreset:function(t,i){var a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return I(t).then(function(i){return e.all([function(e){return s.postToRciRoot(n.set({},"show.interface.dsl.capabilities",{name:e})).then(function(e){return n.get(e,"show.interface.dsl.capabilities")})}(t),e.when(i)])}).then(function(o){var s=_slicedToArray(o,2),r=s[0],l=s[1],c=p.createFromIspPreset(i,r),d=l.model;return b.forEach(function(e){c[e].ipvcArrayOnLoad=n.cloneDeep(d[e].ipvcArrayOnLoad)}),e.all([A(t,c,!a),e.when(l)])}).then(function(e){var i=_slicedToArray(e,2),a=i[0],o=i[1];return I(t).then(function(e){var t=o.model;b.forEach(function(i){t[i].ipvcArrayOnLoad=n.cloneDeep(e.model[i].ipvcArrayOnLoad)})}).then(function(){return{lastConfigurationInfo:a,previousConfiguration:o}})})},getDescription:function(e,t){return e&&e[t]?i.getInterfaceL10n(e[t]):t},getNdmConfiguration:I,saveNdmConfiguration:A,getCapabilityPropertyOptionsList:y,isAdslOpmode:function(e){return"adsl"===e.toLowerCase().substr(0,4)},loadNdmIpvcList:C,processInterfaceIpvcObject:D,getDslInetInterfaceId:function(e){if(n.isArray(e)){var t=n.find(e,{role:g.INET});return t.bridge||t.interfaceId}var i=n.findKey(e,{role:g.INET});return e[i].bridge||i},processShowRcInterfaceIpvcData:function(e,t){var i=n.get(e,["interface",0,"interface"]),a=t?n.get(e,["interface",1,"ipvc"]):{};return{ifaces:i,ipvcList:D(a)}},getParentDslInterfaceId:function(){return!(!a.usbdsl&&!u.IS_DSL_DEVICE)&&(u.IS_DSL_DEVICE?t.DSL:d.USBDSL_IFACE)}}}e.$inject=["$q","NDM","_","utils","components","interfaces","router","ifaceIpModel","ifacePppModel","pingcheckModel","usbdslConsts","dslModel","dslConstants"],angular.module("keenetic").factory("dslService",e)}(),function(){function e(e,t,n,i,a,o){var s=o.DSL_MODE,r=o.PORT_ROLE,l=o.ROLE,c=n.IP_CONFIG_MODE,d={no:!0},p=function(e,t){return{portMapKey:t,name:e.name,port:e.port,role:r.FREE,isAssigned:!1,isSelected:!1,isBusy:!1,forInterface:""}},u=function(){var l,c,d={general:{state:!1,order:0,schedule:"",description:""},line:{dslMode:s.ADSL,operatingMode:o.DSL_ADSL_AUTO_OPMODE,olr:[],profile:[],carrier:o.VDSL_AUTO_CARRIER,annex:o.DSL_ADSL_AUTO_OPMODE,allProfileOptions:[],allOlrOptions:[]},portmap:e.mapValues(t.PORTS_MAP,p),assignedPortRoles:(l={},_defineProperty(l,r.IPTV,0),_defineProperty(l,r.VOIP,0),l),portsWithRole:(c={},_defineProperty(c,r.IPTV,{}),_defineProperty(c,r.VOIP,{}),c),inet:{ipvcArray:[],ipvcArrayOnLoad:[],ip:n.getFormDataPrototype(),ppp:i.getFormDataPrototype(),pppIdOnLoad:"",pingcheck:a.getFormDataPrototype()},iptv:{ipvcArray:[],ipvcArrayOnLoad:[],ip:n.getFormDataPrototype()},voip:{ipvcArray:[],ipvcArrayOnLoad:[],ip:n.getFormDataPrototype()}};return e.forEach(o.MODEL_ROLE_LIMITS,function(e,t){d[t].canRemoveIpvc=e.canRemoveIpvc,d[t].maxIpvcCount=e.maxIpvcCount}),d},m=function(e){var t=e.encapsulation,n=e.vlan,i=e.vlanOverPvc?n:"";return Object.assign({},e,{adslVlan:i,encapsulation:"LLC"===t?o.ENCAPSULATION.LLC:o.ENCAPSULATION.VC})},f=function(e,t){var i=e[t].ip,a=n.getFormDataPrototype();if(i===c.AUTO)return a;if(i===c.NONE)return a.mode=c.NONE,a;var o=_slicedToArray(i.split("/"),2),s=o[0],r=o[1];return a.address=s,a.mask=r,a.mode=c.STATIC,a};return{ANY_ISP_PRESET_NAME:"Any ISP",DEFAULT_ISP_DESCRIPTION:"DSL ISP",getSaveIpvcQuery:function(t,n,i){var a,o=n.role,r=n.vpi,c=n.vci,d=n.vlan,p=n.encapsulation,u=n.vlanOverPvc,m=n.port;i===s.VDSL&&(r="",c="",p="");var f=!1;i===s.VDSL?a=d:(o===l.INET&&(f=i===s.ADSL?Boolean(n.adslVlan):u),a=i===s.ADSL?n.adslVlan:d);var g={role:o,vpi:r,vci:c,encapsulation:p,port:m,vlan:a,"pvc-vlan":f};return e.set({},["interface",t,"ipvc"],g)},getDeleteIpvcQuery:function(t){return e.set({},["interface",t,"ipvc"],d)},createEmptyIpvcObject:function(e){return function(e,t,n,i){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:o.ENCAPSULATION.LLC,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[],r=arguments.length>6&&void 0!==arguments[6]&&arguments[6];return{role:e,port:s.join(","),vpi:t,vci:n,encapsulation:a,vlan:i,vlanOverPvc:r}}(e,"","","")},createFromIspPreset:function(t,a){var r=u();return r.general.description="Any ISP"===t.name?"DSL ISP":t.name,r.general.state=!0,r.line=function(t,n){var i,a=u().line,r=t.mode!==s.VDSL,l=t.mode!==s.ADSL;a.dslMode=t.mode,i=t.mode===s.AUTO?s.AUTO:r?o.DSL_ADSL_AUTO_OPMODE:o.VDSL_OPMODE,a.operatingMode=i;var c=n[i];return l&&(a.olr=e.keys(c.olr),a.profile=e.keys(c.profile),a.carrier=e.keys(c.carrier)[0]),r&&(a.annex=o.ADSL_AUTO_ANNEX,a.carrier=e.keys(c.carrier)[0]),a.snrMarginOffset={adsl:o.SNR_MARGIN.ADSL.DEFAULT,vdsl:o.SNR_MARGIN.VDSL.DEFAULT},a}(t,a),r.inet.ipvcArray=t.inet.ipvc.map(m),r.iptv.ipvcArray=t.iptv.ipvc.map(m),r.voip.ipvcArray=t.voip.ipvc.map(m),r.inet.ip=n.getFormDataPrototype(),t.hasPppoeTunnel&&(r.inet.ip.mode=c.NONE,r.inet.ppp.type=i.PPP_TYPE.PPPOE,r.inet.ppp.identity=t.login,r.inet.ppp.password=t.password),r.iptv.ip=f(t,l.IPTV),r.voip.ip=f(t,l.VOIP),r},getPrototype:u}}e.$inject=["_","NDM","ifaceIpModel","ifacePppModel","pingcheckModel","dslConstants"],angular.module("keenetic").factory("dslModel",e)}(),function(){function e(e,t,n,i,a,o,s,r,l,c,d,p,u,m,f,g,v,h,b,_,y,S,w,C){var E,I=this,T=d.DSL,k=C.PORT_ROLE,P=C.VPI,A=C.VCI,D={inet:"inet.ip",ppp:"inet.ppp.ip",iptv:"iptv.ip",voip:"voip.ip"},O=["inet.ipvcArray[0]","voip.ipvcArray[0]","iptv.ipvcArray[0]","iptv.ipvcArray[1]","iptv.ipvcArray[2]"];I.PORT_FIELD_PREFIX="dsl-port__",I.PINGCHECK_INSTALLED=w.PINGCHECK_INSTALLED,I.DSL_MODE=C.DSL_MODE,I.ROLE=C.ROLE,I.PORT_ROLE=k,I.VPI=P,I.VCI=A;var N=function(e){l.get(I,"model.portmap")&&l.forEach(I.model.portmap,function(t){t.isAssigned=t.role&&t.role!==k.FREE&&t.role!==e,t.isSelected=t.role===e})};I.tabs={currentTab:"",list:C.getTabs(),onTabChange:function(e,t){I.tabs.currentTab=t.id,N(I.tabs.currentTab)}},I.l10n={};var L=function(){I.labelByIfaceId=g.getInterfaceIdToDescriptionMap(I.showInterfaceData),I.getIforL10n=g.getPortIforL10nFunction(I.labelByIfaceId)},x=function(e){return Object.assign({},e,{label:I.labelByIfaceId[e.ifaceId]})},R=function(){var e=I.validation,t=e.busyIps,n=e.usedSubnetsForDslIsp,i=e.usedIpAddresses;I.validation.busyIps=t.map(x),I.validation.usedSubnetsForDslIsp=n.map(x),I.validation.usedIpAddresses=l.mapValues(i,x)},M=function(){I.l10n={connectedViaAdsl:u.getTranslation("dsl.connection-status.connected-via-adsl"),connectedViaVdsl:u.getTranslation("dsl.connection-status.connected-via-vdsl"),vlanIsUsed:u.getTranslation("errors.vlan-used"),vlanIsRequired:u.getTranslation("errors.required-field"),pvcIsUsedError:u.getTranslation("dsl.error-pvc-busy"),invalidSubformWarning:u.getTranslation("dsl.invalid-subform-warning"),dslModeDescription:u.getTranslation("dsl.form.dsl-mode.comment",null,{autoModeName:u.getTranslation("dsl.mode.auto")})},L(),R(),F()};a.$on("$destroy",s.$on("$translateChangeSuccess",function(){return t(M)})),I.userInfo={current:{},lastKnown:{},update:function(){var e=I.userInfo;return f.getCurrentUserInfo().then(function(t){e.current=angular.copy(t),e.lastKnown=angular.copy(t)},function(){e.current={disconnected:!0}})}},I.invalidFields="",I.ui={lineSettingsAreVisible:!1,scheduleSelectIsVisible:!1,isReady:!1,isFooterReady:!1,isLocked:!1,isLongAgoUnlocked:!0,afterUnlockTimer:!1,lock:function(){return I.ui.isLocked=!0,I.ui.isLongAgoUnlocked=!1,e.when(!0)},unlock:function(){return I.ui.isLocked=!1,I.ui.afterUnlockTimer=t(function(){I.ui.isLongAgoUnlocked=!0,I.ui.afterUnlockTimer=null},3e3),e.when(!0)},showScheduleSelect:function(){I.ui.scheduleSelectIsVisible=!0},goToInitialSetupWizard:function(){var t=e.when(!0);return l.get(I,"form.modified")&&(t=m.confirmLeave()),t.then(function(e){e&&(n.location=u.getUrlForInitialSetupWizard())})},onVlanOverPvcToggle:function(e){var t=I.model.inet.ipvcArray[0];t.adslVlan=e?t.vlan:""}};var $=function(){return l.invoke(I,"form.$setPristine")};I.getModifiedModels=function(){return function e(t){var n=t.modifiedModels.slice();return t.modifiedChildForms.forEach(function(t){n=n.concat(e(t))}),n}(I.form)},I.options={portmap:angular.copy(d.PORTS_MAP),dslMode:C.getModeOptions(),encapsulation:C.getEncapsulationOptions(),portRole:C.getPortRoleOptions(),annex:[],adslModes:[],profile:[],carrier:[],olr:[]},I.snrMarginOffset={};var F=function(){I.snrMarginOffset={adsl:C.getSnrMarginData(C.SNR_MARGIN.ADSL),vdsl:C.getSnrMarginData(C.SNR_MARGIN.VDSL)}};I.capabilities={},I.labelByIfaceId={},I.getIforL10n=l.noop;var V=function(){return O.map(function(e){var t=l.get(I.model,e);return t&&(t.path=e),t}).filter(angular.identity)},U=r(function(){var e=I.model;if(e.line.dslMode!==I.DSL_MODE.VDSL){var t=[];V().forEach(function(n){var i=parseInt(n.vpi,10),a=parseInt(n.vci,10);if(!isNaN(i)&&!isNaN(a)&&a>=32&&a<=65535&&i>=0&&i<=255){for(var o=!1,s=0;s<t.length;s++){var r=t[s];if(r[0]===i&&r[1]===a){o=r[2];break}}o?((l.get(e,o)||{}).pvcError=I.l10n.pvcIsUsedError,n.pvcError=I.l10n.pvcIsUsedError):(n.pvcError="",t.push([i,a,n.path]))}})}}),B=function(){var e=I.model.inet.ipvcArray[0];e.adslVlan=e.vlanOverPvc?e.vlan:""},W=r(function(){if(I.model.line.dslMode!==I.DSL_MODE.ADSL){var e=V(),t=!1;l.forEach(l.groupBy(e,"vlan"),function(e,n){e.length>1?e.forEach(function(e){e.vlanError=n?I.l10n.vlanIsUsed:I.l10n.vlanIsRequired}):e[0].vlanError="",t=""===n}),I.validation.emptyVlanIsBusy=t}}),H=function(e){return!(e.mode&&e.mode!==h.IP_CONFIG_MODE.STATIC||!y.ip(e.ip)||!y.ip(e.mask))&&{ip:e.ip,mask:e.mask}},q=function(e){return l.chain(I.validation.subnets).omitBy(function(t,n){return n===e}).mapValues(function(e){return H(e)}).pickBy().map(function(e,t){return Object.assign({},e,{ipvcKey:t})}).value()},j=function(){var e=q("inet").filter(function(e){return"ppp"!==e.ipvcKey});I.validation.usedSubnetsForDslIsp=[].concat(_toConsumableArray(angular.copy(I.validation.busyIps)),_toConsumableArray(e))};I.validation={busyPorts:{},usedSubnetsForDslIsp:[],busyIps:[],usedIpAddresses:{inet:[],ppp:[],iptv:[],voip:[]},subnets:{inet:!1,ppp:!1,iptv:!1,voip:!1},recalculateUsedNets:function(e,t){var n=I.validation.subnets;n[e]=H(t),Object.keys(n).filter(function(t){return t!==e}).forEach(function(e){var t=angular.copy(I.validation.busyIps);I.validation.usedIpAddresses[e]=[].concat(_toConsumableArray(t),_toConsumableArray(q(e)))}),j()},onInetIpChange:function(e){return t(I.validation.recalculateUsedNets("inet",e))},onPppIpChange:function(e){return t(I.validation.recalculateUsedNets("ppp",e))},onIptvIpChange:function(e){return t(I.validation.recalculateUsedNets("iptv",e))},onVoipIpChange:function(e){return t(I.validation.recalculateUsedNets("voip",e))},assignedPortRoles:(E={},_defineProperty(E,k.IPTV,[]),_defineProperty(E,k.VOIP,[]),E),onPvcChange:function(){return t(U)},onVlanChange:function(){t(function(){W(),B()})},onPortRoleChanged:function(n,i){var o=i.replace(I.PORT_FIELD_PREFIX,""),s=l.get(d.PORTS_MAP,[o,"port"]);if(s){var r=I.tabs.currentTab===I.ROLE.IPTV?k.IPTV:k.VOIP,p=e.defer(),u=I.userInfo.current;u.disconnected||u.type!==c.USER_CONNECTION_TYPE.ETHERNET||s!==u.port?p.resolve(!0):t(function(){n?m.confirm("switchport-is-used-to-connect-to-the-device","confirm-using-switchport").then(function(){p.resolve(!0)},function(){I.model.portmap[o].isSelected=!1,I.model.portmap[o].role=k.FREE,p.resolve(!1)}):p.resolve(!0)}),p.promise.then(function(e){e&&t(function(){var e=I.validation.assignedPortRoles;I.model.portmap[o].role=n?r:k.FREE,n?(e[r].push(s),I.validation.recalculateUsedNets(r,{mode:h.IP_CONFIG_MODE.AUTO})):e[r]=e[r].filter(function(e){return e!==s}),"$apply"!==a.$root.$$phase&&"$digest"!==a.$root.$$phase&&a.$apply()})})}},isVpiOrVciRequired:function(e,t){var n=t===P?A:P;return e.vlan||e[n]||I.validation.assignedPortRoles[e.role].length>0||I.validation.emptyVlanIsBusy}},I.toggle={state:{},stateText:"",stateDescription:"",stateIsOk:!1,polling:function(){if(I.statePollerData&&!I.ui.isLocked){var e=I.statePollerData,t={main:e.main,ppp:e.ppp,alias:e.alias,phy:e.phy},n={schedule:e.schedule,pingcheck:e.pingcheckProfile};return g.getIspConnectionState(t,n).then(function(e){var t=-1!==l.get(e,"raw.show.phy.opmode","").toLowerCase().indexOf("adsl"),n=e.connection.name===g.constants.ISP_STATE.ERROR||e.connection.color===g.constants.STATE_CATEGORY.ERROR;e.connection.name===g.constants.ISP_STATE.CONNECTED&&(e.connection.text=t?I.l10n.connectedViaAdsl:I.l10n.connectedViaVdsl),I.toggle.state=e,n?(I.toggle.stateColor=g.constants.STATE_CATEGORY.ERROR,I.toggle.stateDescription=e.reasonText):(I.toggle.stateColor=e.connection.color,I.toggle.stateDescription="");var i=e.connection.text;I.toggle.stateDescription&&(i+=": ".concat(I.toggle.stateDescription)),I.toggle.stateText=i})}},onToggle:function(e){return g.toggleState(T,e)}},I.addNewIpvc=function(e){I.model[e].ipvcArray.push(S.createEmptyIpvcObject(e)),W()},I.removeIpvc=function(e,t){I.model[e].ipvcArray.splice(t,1),W(),U()};var K=function(e,t){I.options[t]=e[t].map(function(e){return e.checked=-1!==I.model.line[t].indexOf(e.id),e}),I.model.line["all".concat(l.capitalize(t),"Options")]=I.options[t].map(function(e){return e.id})};I.onAdslModeChange=function(e){var t=I.capabilities[I.DSL_MODE.ADSL][e];if(t){I.options.olr=t.olr.map(function(e){return e.checked=-1!==I.model.line.olr.indexOf(e.id),e}),I.options.annex=angular.copy(t.annex);var n=I.options.annex.map(function(e){return e.id});-1===n.indexOf(l.get(I,"model.line.annex"))&&l.set(I,"model.line.annex",n[0])}};var G=function(){t(function(){W(),U(),B()})};I.onLineModeChange=function(e){if(e===I.DSL_MODE.AUTO){var t=l.values(I.capabilities[e])[0];return K(t,"olr"),void G()}var n=Object.keys(I.capabilities[e]),i=I.model.line.operatingMode,a=l.includes(n,i)?i:n[0],o=I.capabilities[e][a];I.options.olr=o.olr.map(function(e){return e.checked=-1!==I.model.line.olr.indexOf(e.id),e}),["annex","carrier"].forEach(function(e){I.options[e]=angular.copy(o[e])}),["profile","olr"].forEach(function(e){return K(o,e)}),I.model.line.operatingMode=a,e===I.DSL_MODE.ADSL&&I.onAdslModeChange(I.model.line.operatingMode),G()};var Y=function(){return w.getNdmConfiguration(T).then(function(e){var t=e.showInterfaceData,n=e.model;I.model=angular.copy(n),I.showInterfaceData=t,L(),C.ROLE_ORDER.forEach(function(e){var t=I.model[e];t.addNewIpvc=function(){return t.ipvcArray.push(S.createEmptyIpvcObject(e))},t.removeIpvc=function(e){return t.ipvcArray.splice(e,1)}});var i=I.validation;i.busyPorts=e.busyPorts,i.busyIps=e.busyIps,Object.keys(i.subnets).forEach(function(e){i.usedIpAddresses[e]=angular.copy(i.busyIps),i.subnets[e]=H(l.get(I.model,D[e],{}))}),R(),j(),F(),Object.keys(i.subnets).forEach(function(e){i.recalculateUsedNets(e,l.get(I.model,D[e],{}))}),I.statePollerData=e.statePollerData,I.ndmData=e.raw,i.assignedPortRoles=angular.copy(e.model.assignedPortRoles),I.capabilities=e.capabilities,I.options.adslMode=e.adslModes,I.onLineModeChange(I.model.line.dslMode),N(I.tabs.currentTab)})};I.save=function(){if(!I.form.$invalid&&!I.ui.isLocked)return I.ui.lock(),w.saveNdmConfiguration(T,I.model).then(Y).then($).finally(function(){t(function(){return I.ui.unlock()})})},I.reset=function(){I.ui.isLocked||(I.form&&(I.form.reset(),I.form.modifiedModels.forEach(function(e){return e.reset()}),I.form.modifiedChildForms.forEach(function(e){return e.reset()})),I.validation.assignedPortRoles=angular.copy(I.model.assignedPortRoles),I.model.portmap=angular.copy(I.model.portmapOnLoad),C.ROLE_ORDER.forEach(function(e){I.model[e].ipvcArray=angular.copy(I.model[e].ipvcArrayOnLoad)}),N(I.tabs.currentTab))},I.isSaveDisabled=function(){return l.get(I,"form.general.$invalid")||l.some(C.ROLE_ORDER,function(e){return l.get(I,"form.".concat(e,".$invalid"))})||I.ui.isLocked},M(),Y().then(function(){I.progress=100,I.ui.scheduleSelectIsVisible=Boolean(I.model.general.schedule),I.ui.isReady=!0,t($),t(function(){l.forEach(I.ROLE,function(e){var t=l.find(I.tabs.list,{id:e});t&&a.$watch("vm.form.".concat(e,".$invalid"),function(e){t.isInvalid=I.ui.isLongAgoUnlocked&&e})}),I.ui.isFooterReady=!0},2e3)})}e.$inject=["$q","$timeout","$window","$document","$scope","$state","$rootScope","debounce","_","CONSTANT","NDM","components","utils","modal","usersService","interfaces","router","ifaceIpModel","ifacePppModel","pingcheckModel","ValidatorManager","dslModel","dslService","dslConstants"],angular.module("keenetic").controller("DslController",e)}(),function(){function e(e,t,n,i,a,o){var s,r={},l=i.INTERFACE_ROLE,c=[l.INET,l.IPTV,l.VOIP],d=(_defineProperty(s={},l.INET,{maxIpvcCount:1,canRemoveIpvc:!1}),_defineProperty(s,l.IPTV,{maxIpvcCount:3,canRemoveIpvc:!0}),_defineProperty(s,l.VOIP,{maxIpvcCount:1,canRemoveIpvc:!0}),s),p=function(){r={autoMode:o.getTranslation("dsl.mode.auto"),role:{}},c.forEach(function(e){r.role[e]=o.getTranslation("role.".concat(e))})};p(),e.$on("$translateChangeSuccess",function(){return t(p)});var u=Boolean(a.find(n.PORTS_MAP,{port:n.DSL})),m={LLC:"aal5snap",VC:"aal5mux"},f={ADSL:"adsl",VDSL:"vdsl",AUTO:"auto"},g=i.PORT_ROLE,v=a.values(i.PORT_ROLE).filter(function(e){return e!==g.FREE});return{VPI:"vpi",VCI:"vci",IS_DSL_DEVICE:u,ROLE:l,ROLE_ORDER:c,MODEL_ROLE_LIMITS:d,PORT_ROLE:g,BUSY_PORT_ROLES:v,ENCAPSULATION:m,DSL_MODE:f,DSL_IN_AUTOMODE_SUFFIX:"DSL",DSL_BAD_LINE_STATUSES:["idle","down"],DSL_ADSL_AUTO_OPMODE:"adsl-auto",ADSL_AUTO_ANNEX:"auto",VDSL_OPMODE:"vdsl2-cpe",VDSL_AUTO_CARRIER:"auto",VDSL_ALL_PROFILES:"all",SNR_MARGIN:{ADSL:{MIN:-10,MAX:10,DEFAULT:0},VDSL:{MIN:0,MAX:30,DEFAULT:8}},getSnrMarginData:function(e){var t=a.range(e.MIN,e.MAX+1).sort(),n=o.getTranslation(i.UNIT.DB),s=e.DEFAULT,r=o.getTranslation("dsl.form.snr-margin.default-value");return{options:t.map(function(e){var t=e===s?" (".concat(r,")"):"";return{id:e,label:"".concat(e," ").concat(n).concat(t)}}),defaultValue:s}},getPortRoleOptions:function(){return[{id:g.FREE,label:"default",icon:"free-line"},{id:g.IPTV,label:"port-role.iptv",icon:"iptv"},{id:g.VOIP,label:"port-role.voip",icon:"voip"}]},getEncapsulationOptions:function(){return[{id:m.LLC,label:"LLC"},{id:m.VC,label:"VC"}]},getModeOptions:function(){return[{id:f.ADSL,label:f.ADSL.toUpperCase()},{id:f.VDSL,label:f.VDSL.toUpperCase()},{id:f.AUTO,label:r.autoMode}]},getTabs:function(){return c.map(function(e){return{id:e,icon:e,label:r.role[e]}})}}}e.$inject=["$rootScope","$timeout","NDM","CONSTANT","_","utils"],angular.module("keenetic").factory("dslConstants",e)}(),function(){function e(e,t,n,i,a,o,s,r){var l=r.FW_SHUTDOWN_TIME+r.FW_BOOT_TIME,c=.6*l,d={checkDevice:!0,startCheckingDeviceAt:50,initialProgress:0};return{progressCtor:function(t,n,r,l){var p=angular.extend({},d,l||{}),u=s.restrictNumber(Math.floor(p.initialProgress),0,100),m=-1,f=!1;p.checkDevice&&(m=s.restrictNumber(Math.floor(p.startCheckingDeviceAt),p.initialProgress,100));var g,v=u,h=function(){n(100),g&&a.cancel(g),i(r)};g=a(function(){var t,a;!f&&(p.checkDevice&&v>=m||v>=100)&&(f=!0,(t=e.defer(),a=Date.now(),function e(){return o.get({url:"show/version",silent:!0,noRetry:!0,timeout:5e3}).then(function(){return t.resolve()}).catch(function(n){200===n.status&&Date.now()-a>c?t.resolve():i(function(){return e()},2500)})}(),t.promise).then(h)),v<=100&&n(v++)},t)},processShowVersionData:function(e){return{release:e.release,model:s.getDeviceModel(e)}},goToDashboard:function(){n.location="/"},goToMyKeeneticNet:function(){n.location="http://my.keenetic.net"},rebootDevice:function(){return o.disableLogoutAlert(),o.post("system/reboot")},constant:{REBOOT_TIME:l,REBOOT_TICK:l/100}}}e.$inject=["$q","$translate","$window","$timeout","$interval","router","utils","NDM"],angular.module("keenetic").factory("system",e)}(),function(){function e(e,t,n,i,a,o,s,r,l,c,d,p,u){var m=this,f=u.profile.features;m.reload=function(){return i.reload()},m.goToDashboard=function(){d.location="/"},m.cloudcontrolInstalled=Boolean(p.cloudcontrol),m.canAutoUpdateFirmware=Boolean(f.dual_image),m.usbIsConfigurable=Boolean(p.usb)&&Boolean(f.usb_3),m.popupIsVisible=!1,m.ui={isLocked:!1,lock:function(){return m.ui.isLocked=!0,e.when(!0)},unlock:function(){return m.ui.isLocked=!1,e.when(!1)}};var g=e.defer();m.showComponentsPopup=function(){g.promise.then(function(){m.subcontroller.get("FW_AND_COMPONENTS").popup.open()})},m.showSysModePopup=function(){g.promise.then(function(){m.subcontroller.get("SYSMODE").popup.open()})};var v=c.createRequester(),h=v.stopPolling;v.stopPolling=function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],n=e.when(!0);return t&&(n=l.resetComponentsListQuery().then(function(){return s.reset()})),n.then(function(){return h()})},n.$on("$destroy",v.stopPolling),m.getRequester=function(){return v},m.onAllSubcontrollersLoaded=function(){v.startPolling(),v.setOnPollCallback(function(){m.progress=100}),n.$watch("::system.form",function(){return m.form.$setPristine()}),g.resolve()},m.progress=0,m.ndmData={},m.initialData={},m.requestInProgress=!1,m.ndmDataPromises=[];var b,_,y,S=function(){return o.get(m,"form.$setPristine",angular.noop)()},w=function(){return o.get(m,"form.reset",angular.noop)()};m.subcontroller=(b=m.onAllSubcontrollersLoaded,_={FW_AND_COMPONENTS:!0,SYSTEM_FILES:!0,CLOUDCONTROL:Boolean(p.cloudcontrol),SYSTEM_SETTINGS:!0,BUTTONS_AND_LEDS:!0,SWITCHPORTS:!0,USBPORTS:m.usbIsConfigurable,REBOOT:!0,SYSMODE:!0,DIAGNOSTIC_REPORTS:!0,CREDITS:!0},(y={_controllers:{},_list:{},_count:{},init:function(){y._list=angular.copy(_),y._count=o.filter(y._list,angular.identity).length},register:function(t,n){y._controllers[n]=t,t.requester=m.getRequester(),t.setMainFormPristine=S,t.resetMainForm=w,t.parentController=m,t.reload=m.reload,t.goToDashboard=m.goToDashboard,t.isMainCtrlLocked=function(){return m.ui.isLocked},t.onPopupOpen=function(){m.popupIsVisible=!0},t.onPopupClose=function(){m.popupIsVisible=!1},e.when((t.onLoad||angular.noop)()).then(function(){angular.isUndefined(y._list[n])?console.warn('Unknown subcontroller ID "'.concat(n,'"')):(y._list[n]=!1,y._count--,0===o.filter(y._list,angular.identity).length&&(b||angular.noop)())})},get:function(e){return y._controllers[e]},callInEvery:function(t){for(var n=arguments.length,i=new Array(n>1?n-1:0),a=1;a<n;a++)i[a-1]=arguments[a];var s=[];return o.forEach(y._controllers,function(n){angular.isFunction(n[t])&&s.push(e.when(n[t].apply(n[t],i)))}),0===s.length?e.when(!0):e.all(s)}}).init(),y),m.save=function(){return m.ui.isLocked?e.when(!0):m.ui.lock().then(function(){return m.subcontroller.callInEvery("save")}).then(S).finally(m.ui.unlock)},m.reset=function(){return m.ui.isLocked?e.when(!0):m.ui.lock().then(function(){return w()}).then(function(){return m.subcontroller.callInEvery("reset")}).then(S).finally(m.ui.unlock)}}e.$inject=["$q","$timeout","$scope","$state","$transitions","_","router","utils","componentsService","requesterFactory","$window","components","NDM"],angular.module("keenetic").controller("SystemController",e)}(),function(){function e(e,t,n,i,a){var o="opt",s={diskNotSelected:"-1",tag:o},r=function(e){var t=e.name,n=e.uuid;return{id:n,label:t?t+" ("+n+")":n,diskLabel:t}},l="show.rc.".concat("opkg");return{getUsbDiskOptions:function(){return n.getUsbDrives().then(function(e){var t=e.filter(function(e){return!e.isSwap}).map(r);return t.unshift({id:"-1",label:"opkg.form.disk.disk-not-selected-option"}),t})},getData:function(){var a=i.toRciQueryList([e.set({},"ls",{type:n.NDM_LS_TYPE.FILE_SYSTEM}),"show.rc.user",l]);return t.postToRciRoot(a).then(function(t){var i=e.get(t,"[0].ls",{}),a=e.get(t,"[1].".concat("show.rc.user"),{}),s=e.get(t,"[2].".concat(l),{}),c=(s.disk||"").replace(":/",""),d=n.getUsbDrivesListFromLsResponse(i).map(r),p=e.mapValues(a,function(t){var n=t.tag||[],i=e.includes(n,o);return{tags:n,access:i,noTag:!i}}),u=e.find(d,function(e){return e.id===c||e.diskLabel===c||c.split(":")[0]===e.id.split(":")[0]}),m=e.get(u,"id","");return d.unshift({id:"-1",label:"opkg.form.disk.disk-not-selected-option"}),{opkg:{disk:m||c||"-1",diskIsNotConnected:m!==c,diskOptions:d,initrc:e.get(s,"initrc.path","")},users:p}})},setData:function(n,i){var r={},l=[],c=e.find(n.diskOptions,{id:n.disk})||{diskLabel:n.disk},d=n.disk===s.diskNotSelected;return r.opkg={disk:{disk:(c.diskLabel||c.id)+(d?"":":/"),no:d},initrc:{path:n.initrc,no:n.disk===s.diskNotSelected||!n.initrc}},e.forEach(i,function(e,t){var n=e.tags.indexOf(o);e.access?-1===n&&l.push(a.getAddTagQuery(t,o)):n>-1&&l.push(a.getRemoveTagQuery(t,o))}),l.push(r),t.postAndSave(l)},const:s,constant:{DISK_NOT_SELECTED_OPTION_ID:"-1",TAG:o}}}e.$inject=["_","router","storage","utils","usersService"],angular.module("keenetic").factory("opkg",e)}(),function(){function e(e,t,n,i,a,o,s,r,l){var c=this;c.progress=0,c.model={},c.l10n={diskNotSelected:"",pageDescription:""},c.ui={isLocked:!1,lock:function(){return c.ui.isLocked=!0,e.when(!0)},unlock:function(){return c.ui.isLocked=!1,e.when(!1)}};var d=function(){c.l10n={diskNotSelected:r.getTranslation("opkg.form.disk.disk-not-selected-option"),pageDescription:r.getTranslation("opkg.page-description",null,{forumLink:r.generateExternalLinkHtml("forum.keenetic.net","https://forum.keenetic.net/")})}};t.$on("$destroy",i.$on("$translateChangeSuccess",function(){return n(d)}));var p=function(){return l.getData().then(function(e){return d(),c.model=angular.extend(c.model,e.opkg),c.users=e.users,c.pollUsbDevices().then(function(){c.isReady=!0,c.progress=100,n(function(){return c.form&&c.form.$setPristine()})})})};p(),c.pollUsbDevices=function(){return l.getUsbDiskOptions().then(function(e){var t=e.slice(),n=e.map(function(e){return e.id});c.model.diskOptions=t,c.model.diskIsNotConnected=-1===n.indexOf(c.model.disk)})},c.isVisible=!0,c.addUser=function(e){return s.addTag(e,l.constant.TAG).then(function(){c.users[e]={access:!0,tags:[l.constant.TAG],noTag:!1}})},c.save=function(){c.ui.isLocked||c.ui.lock().then(function(){return l.setData(c.model,c.users)}).then(p).finally(c.ui.unlock)},c.cancel=function(){c.ui.isLocked||a.get(c,"form.reset",angular.noop)()}}e.$inject=["$q","$scope","$timeout","$rootScope","_","router","usersService","utils","opkg"],angular.module("keenetic").controller("OpkgController",e)}(),function(){function e(e){return function(t){var n=t.split(/\s+/);return n[0]=e.instant("month."+n[0]),n.join(" ")}}e.$inject=["$translate"],angular.module("keenetic").filter("timestampTranslate",e)}(),function(){function e(e){return function(t){return e.format.size(t,!1)}}e.$inject=["utils"],angular.module("keenetic").filter("sizeFormat",e)}(),function(){function e(e,t,n,i){var a={list:[],lastId:-1},o=null;return{exportLog:function(){n.location.assign(i.constants.CI_URL+"/log.txt")},logServer:function(e,n){var a=t.defer();switch(e){case"getAddress":i.get("system/log/server").then(function(e){var t=e&&e[0]&&e[0].address||"",n={address:t,isSendToServer:Boolean(t)};a.resolve(n)});break;case"setAddress":i.post({url:"system",data:{log:{server:[{address:n}]},configuration:{save:!0}}}).then(a.resolve);break;case"off":i.post({url:"system",data:{log:{server:{no:!0}},configuration:{save:!0}}}).then(a.resolve);break;default:a.resolve("unknown type of command, check controller")}return a.promise},clearLog:function(){var e=t.defer();return i.post("system/log/clear").then(e.resolve),e.promise},logLoopStart:function(){if(o)return t.when(!0);var n=!0,s=t.defer();return o=i.post("show/log?max-lines=300").spread(null,null,function(t){n&&(a.list=[],a.lastId=-1,n=!1);var i=a.lastId,o=e.reduce(t.log,function(e,t,n){if((n=parseInt(n,10))>a.lastId){var o=t.ident,s=t.timestamp,r=t.message;e.push(Object.assign({id:n,ident:o,timestamp:s},r)),i=n}return e},[]);a.list=a.list.concat(o),a.lastId=i,s.resolve()}),s.promise},logLoopStop:function(){o&&(o.cancel(),o=null)},logData:a}}e.$inject=["_","$q","$window","router"],angular.module("keenetic").factory("LogManager",e)}(),function(){function e(e,t){return{startTool:function(n,i){return i=angular.copy(i),"traceroute"===n?(i.count&&delete i.count,i.packetsize&&(i["packet-size"]=i.packetsize,delete i.packetsize)):i["max-ttl"]&&delete i["max-ttl"],i=e.pickBy(i),t.post({url:"tools "+n,data:i})},stopTool:function(e){return t.del("tools/"+e)}}}e.$inject=["_","router"],angular.module("keenetic").factory("diagnosticsTools",e)}(),function(){function e(e,t,n,i){var a={state:!1,pending:!1,alarm:!1,started:"",loading:!0},o=0;function s(){return r(),t.get("show/system/debug").then(function(e){var t=a.state;a.state="on"===e.state,a.alarm="on"===e.alarm,a.started=a.state&&e.started||"",t===a.state||a.loading||n.info("diagnostics.debugger."+(a.state?"start":"stop")+"-notification",2e3),a.loading=!1,a.pending=!1,o=i(s,1e3)})}function r(){o&&(i.cancel(o),o=!1)}return{toggleDebugger:function(){if(!a.pending){r(),a.pending=!0;var n=!a.state;return t.post({url:"system",data:{debug:{no:!n}}}).then(function(){s(),n||e.location.assign(t.constants.CI_URL+"/self-test.txt")})}},getStatusAndStartLoop:s,stopStatusLoop:r,status:a}}e.$inject=["$window","router","notification","$timeout"],angular.module("keenetic").factory("diagnosticsDebugger",e)}(),function(){function e(e,t,n,i,a){var o=n.saveQueryStr().data,s={no:!0},r=["adsl","switch","wifimaster","port","fastethernet"],l={data:{},count:0,loaded:!1},c={},d=!1,p={memLimit:16384},u=[],m=function e(){return d?n.get("show/monitor/capture/interface/status").then(function(e){var n=t.get(e,"monitor.capture.interface",{}),i={},a=0;t.forEach(n,function(e,o){var s=e.statistics||{},r={};i[o]=r,r.id=o,r.interfaceId=o,r.name=c[o].name,r.description=c[o].description,r.title=t.find(u,{id:o}).label,r.connectionName=t.get(c,[o,"interface-name"],o),r.framesCaptured=s["frames-captured"]||0,r.framesDropped=s["frames-dropped"]||0,r.framesLost=s["frames-lost"]||0,r.bytesTotal=s["bytes-captured"]||0,r.bytesCaptured=s["bytes-captured"]||0,r.started=s.started||!1,r.startedAt=s.started_at||"",r.duration=s["capture-duration"]||"0:00:00",r.file=s.file||"",r.captureFile=n[o]["capture-file"]||"",a++}),l.data=i,l.count=a,l.interfaces=u,l.loaded=!0}):(o=a.AP,s=a.AP_5G,n.post({url:"",data:{show:{interface:{},system:{},rc:{interface:{}}}}}).then(function(e){var n=e.show,a=n.rc,l=t.get(n,"system.memtotal"),m=n.interface,f=a.interface;t.forEach(m,function(e,n){e.type&&!t.includes(r,e.type.toLowerCase())&&(e.port&&e.port[1]&&e.port[2]||(e.ap=t.includes(o,n)||t.includes(s,n),e.ssid=e.ap&&f[n].ssid||"",e.name=n,c[e.id]=e))}),u=i.getInterfaceOptions(c),d=!0,p.memLimit=l?Math.round(l/16):p.memLimit})).then(e);var o,s};return{options:p,list:l,reload:m,load:function e(i){return l.loaded?n.get("monitor/capture/interface/"+c[i].name).then(function(e){return{id:i,interfaceId:i,direction:e.direction||"in-out",promiscMode:e["promisc-mode"]||!1,timeout:t.get(e,"timeout.timeout-ms",0),bufferSize:t.get(e,"buffer-size.size-kb",0),maxFrameSize:t.get(e,"max-frame-size.size",0),captureSize:t.get(e,"capture-size.size-kb",p.memLimit),outputDirectory:t.get(e,"output-directory.directory",""),storage:t.get(e,"output-directory.directory")?"usb":"flash",filter:t.get(e,"filter.bpf-program",""),interfaces:u}}):m().then(function(){return e(i)})},save:function(e){var i={},a=c[e.interfaceId].name;return e.id&&e.id!==e.interfaceId&&(i[a]=s),i[a]={timeout:{"timeout-ms":e.timeout},direction:e.direction,"promisc-mode":Boolean(e.promiscMode),"buffer-size":{"size-kb":e.bufferSize},"max-frame-size":{size:e.maxFrameSize},"capture-size":"usb"===e.storage?s:{"size-kb":e.captureSize},filter:e.filter?{"bpf-program":e.filter}:s,"output-directory":"usb"===e.storage?{directory:e.outputDirectory}:s},n.postAndSave(t.set({},"monitor.capture.interface",i))},flush:function e(){if(!l.loaded)return m().then(e);var i={};return t.forEach(l.data,function(e,t){i[c[t].name]=s}),n.post({url:"",data:[t.set({},"monitor.capture.interface",i),o]}).then(m)},delete:function(e){var i={};return i[c[e].name]=s,n.post({url:"",data:[t.set({},"monitor.capture.interface",i),o]}).then(m)},toggle:function(e){var t=!l.data[e].started;return n.post({url:"monitor/capture/interface/"+e,data:{enable:t}})},reset:function(e){return n.post({url:"monitor/capture/interface/"+e,data:{enable:!1,reset:!0}})},download:function(t){var i=l.data[t].captureFile,a="";a=0===i.indexOf("temp")?(n.constants.CI_URL+"/"+i).replace(/\/\//,"/"):(n.constants.STORAGE_URL+"/"+i.replace(":","/")).replace(/\/\//,"/"),e.location.assign(a)}}}e.$inject=["$window","_","router","interfaces","NDM"],angular.module("keenetic").factory("diagnosticsCapture",e)}(),function(){function e(e,t,n,i){var a=i.USBDSL_IFACE,o=["CANCELLED","TIMED_OUT","INTERRUPTED","FAILED"],s={};return{getStatus:function(){return n.get("show/interface/dsl/dumpsoc?name="+a).then(function(e){var n;return t.includes(o,e.state)&&(n=e.state.toLowerCase()),s={plugged:"READY"===e.device,running:"RUNNING"===e.state,done:"DONE"===e.state,duration:e.duration,file:e.file,left:e.left,leftFormatted:function(e){if(!e)return"";var t=e/60|0,n=e%60;return(t<10?"0":"")+t+":"+(n<10?"0":"")+n}(e.left),exitCode:Number(e["exit-code"]),error:n},angular.copy(s)})},toggleDiagnostics:function(e){return n.post({url:"interface/"+a+"/dsl/dumpsoc",data:e?{}:{no:!0}})},downloadDump:function(){e.location.assign(n.constants.CI_URL+"/"+s.file)}}}e.$inject=["$window","_","router","usbdslConsts"],angular.module("keenetic").factory("diagnosticsUsbdslDumpsoc",e)}(),function(){function e(e,t,n,i,a,o){var s=i.USBDSL_IFACE;return{getData:function(){var i=n.format.getSpeedUnit(o.UNIT_SCALE.KILO),r=n.getTranslation(o.UNIT.DB),l=n.getTranslation(o.UNIT.DBM),c=a.format.toDslSpeed,d=a.format.toDslLevel,p=a.format.withUnit;return t.get("show/interface/".concat(s)).then(function(t){var n=a.isAdslOpmode(e.get(t,"opmode",""))?"ADSL":"VDSL",o={};return o.standard={label:"diagnostics.usbdsl-statistics.standard",info:n},t.annex&&(o.annex={label:"ANNEX",info:t.annex}),(c(t.ds_intd_rate)||c(t.us_intd_rate))&&(o.speed={label:"diagnostics.usbdsl-statistics.speed",info:a.format.pairOfValues(c(t.ds_intd_rate)||c(t.ds_fast_rate),c(t.us_intd_rate)||c(t.us_fast_rate),i)}),(t.ds_noise||t.us_noise)&&(o.noise={label:"diagnostics.usbdsl-statistics.noise",info:a.format.pairOfValues(t.ds_noise,t.us_noise,r,d)}),t.us_power&&(o.power={label:"diagnostics.usbdsl-statistics.power",info:p(d(t.us_power),l)}),(t.ds_atten||t.us_atten)&&(o.atten={label:"diagnostics.usbdsl-statistics.atten",info:a.format.pairOfValues(t.ds_atten,t.us_atten,r,d)}),{standard:n,iprops:o}})},getSnr:function(){return t.post({url:"show/interface/dsl/snr",data:{name:s}})},getBits:function(){return t.post({url:"show/interface/dsl/bits",data:{name:s}})}}}e.$inject=["_","router","utils","usbdslConsts","dslService","CONSTANT"],angular.module("keenetic").factory("diagnosticsUsbDslStatistics",e)}(),function(){function e(e,t,n,i,a,o,s,r,l,c){var d=n.get(o,"PORTS_MAP.DSL.iface"),p=["rxbytes","txbytes"],u=["rxpackets","txpackets"],m={},f=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return r.generateIconHtml((e?"tx":"rx")+"bytes-arrow")},g=function(e,t){return"".concat(f(!1)," ").concat(e,"&nbsp;&nbsp;\n            ").concat(f(!0)," ").concat(t)},v=function(e){var t=l.format.withUnit,i=r.getTranslation("packets"),a=e.id;(e.vpi||e.vci)&&(a+=" ".concat(e.vpi,"/").concat(e.vci," "));var o,d=n.filter(s.INTERFACE_ROLE,function(t){return c.hasRole(e,t)}).join(", ");return d&&(a+=" (".concat(d,")")),{label:a,info:[(o=e.bytes,g(r.format.size(o[0]),r.format.size(o[1]))),g(t(e.packets[0],i),t(e.packets[1],i))].join("<br>")}};return{getData:function(){var e,t=r.format.getSpeedUnit(s.UNIT_SCALE.KILO),a=r.getTranslation(s.UNIT.DB),o=r.getTranslation(s.UNIT.DBM),c=l.format.toDslSpeed,f=l.format.toDslLevel,h=l.format.withUnit;return(e={},i.post({url:"",data:n.set({},"show.interface",{})}).then(function(t){return e.ifaces=t.show.interface,m=n.filter(e.ifaces,function(e){return n.startsWith(e.id,d)}),i.post({url:"",data:m.map(function(e){return n.set({},"show.interface.stat",{name:e.id})})}).then(function(t){return n.forEach(t,function(e,t){var i=n.get(e,"show.interface.stat");m[t].bytes=p.map(function(e){return i[e]}),m[t].packets=u.map(function(e){return i[e]})}),e})})).then(function(e){var i=n.find(e.ifaces,{id:d}),s={},r={};return s.standard={label:"diagnostics.dsl.standard",info:i.standard},i.line&&(s.line={label:"diagnostics.dsl.training-status",info:i.line}),i.opmode&&(s.opmode={label:"diagnostics.dsl.mode",info:i.opmode}),i.profile&&(s.profile={label:"diagnostics.dsl.vdsl-profile",info:i.profile}),i.annex&&(s.annex={label:"ANNEX",info:i.annex}),n.some(["ds_intd_rate","ds_fast_rate","us_intd_rate","us_fast_rate"],function(e){return c(i[e])})&&(s.speed={label:"diagnostics.dsl.conn-speed",info:g(h(c(i.ds_intd_rate)||c(i.ds_fast_rate),t),h(c(i.us_intd_rate)||c(i.us_fast_rate),t))}),(i.ds_attain||i.us_attain)&&(s.maxSpeed={label:"diagnostics.dsl.attainable-speed",info:g(h(c(i.ds_attain),t),h(c(i.us_attain),t))}),(i.ds_noise||i.us_noise)&&(s.noise={label:"diagnostics.dsl.noise",info:g(h(f(i.ds_noise),a),h(f(i.us_noise),a))}),i.us_power&&(s.power={label:"diagnostics.dsl.power",info:g(h(f(i.ds_power),o),h(f(i.us_power),o))}),(i.ds_atten||i.us_atten)&&(s.atten={label:"diagnostics.dsl.atten",info:g(h(f(i.ds_atten),a),h(f(i.us_atten),a))}),n.forEach(m,function(e){r[e.id]=v(e)}),{iprops:s,traffic:!n.isEmpty(r)&&r}})}}}e.$inject=["$window","$timeout","_","router","notification","NDM","CONSTANT","utils","dslService","interfaces"],angular.module("keenetic").factory("diagnosticsDsl",e)}(),function(){function e(e,t,n,i,a,o,s,r,l,c,d,p,u,m,f,g,v,h,b,_,y,S,w,C){var E=this;E.pageName="diagnostics",E.progress=0,E.inRouterMode=d.sysmode===p.SYSMODE.ROUTER,E.monitorComponentIsInstalled=l.monitor,E.storageComponentIsInstalled=l.storage,E.isDslDevice=d.DSL_ALWAYS_PRESENT||o.has(l,"dsl"),E.tabs={array:[{id:"main",label:s.getTranslation("diagnostics.tabs.main")}],current:"main"},E.isDslDevice&&E.inRouterMode&&E.tabs.array.push({id:"dsl",label:s.getTranslation("diagnostics.tabs.dsl")}),E.diagnosticsDsl={poll:function(){return C.getData().then(function(e){E.diagnosticsDsl.data=e})},data:!1};var I=function(){E.l10n={captureFilterHelpText:s.getTranslation("diagnostics.capture.edit.filter-help",null,{wiresharkLink:s.generateExternalLinkHtml("Wireshark","https://wiki.wireshark.org/CaptureFilters/"),wiresharkExample:"host ".concat("192.168.1.33"," and port 53"),wiresharkExampleIp:"192.168.1.33"})}};I(),t.$on("$destroy",i.$on("$translateChangeSuccess",function(){return n(I)}));var T=function(){E.progress+=20};E.monitorComponentIsInstalled||T(),E.tools={isBusy:!1,list:["ping","traceroute","ping6"].map(function(e){return{id:e,name:s.getTranslation("diagnostics.tools.".concat(e))}}),typeOptions:["icmp","tcp","udp"].map(function(e){return{id:e,name:s.getTranslation("diagnostics.tools.".concat(e))}}),advancedSettings:{isVisible:!1},tool:"ping",data:{host:"google.com",type:"icmp",count:5,packetsize:84,"max-ttl":30},output:[],request:null,packetSizeFixed:!1,checkPacketSize:function(e){"tcp"===e&&"traceroute"===E.tools.tool?(E.tools.packetSizeFixed=!0,E.tools.data.packetsize=52):E.tools.packetSizeFixed=!1}},l.ip6||E.tools.list.pop(),E.tools.getButtonText=function(){return"diagnostics.tools.".concat(E.tools.isBusy?"stop":"start","-tool")},E.tools.advancedSettings.showHide=function(){E.tools.advancedSettings.isVisible=!E.tools.advancedSettings.isVisible},E.tools.advancedSettings.getLabelText=function(){return"diagnostics.tools.".concat(E.tools.advancedSettings.isVisible?"hide":"show","-advanced-settings")},E.tools.startStopTool=function(){E.tools.isBusy?(E.tools.request&&E.tools.request.cancel(),h.stopTool(E.tools.tool).then(function(e){var t=e.message;t&&t.length&&(E.tools.output=E.tools.output.concat(t))}).finally(function(){E.tools.isBusy=!1})):(E.tools.output=[],E.tools.isBusy=!0,E.tools.request=h.startTool(E.tools.tool,E.tools.data).spread(function(){E.tools.isBusy=!1},null,function(e){var t=e.message;t&&t.length&&(E.tools.output=E.tools.output.concat(t))}))},l.usbdsl&&E.inRouterMode?(E.usbdslDumpsoc={status:{},toggleDiagnostics:function(){E.usbdslDumpsoc.status.pending=Date.now(),m.toggleDiagnostics(!E.usbdslDumpsoc.status.running).then(function(){E.usbdslDumpsoc.status.running=!E.usbdslDumpsoc.status.running,n(function(){E.usbdslDumpsoc.status.pending=!1},2e3-Date.now()+E.usbdslDumpsoc.status.pending)})},downloadDump:m.downloadDump,updateStatus:function(){if(!E.usbdslDumpsoc.status.pending)return m.getStatus().then(function(e){E.usbdslDumpsoc.status=angular.merge(E.usbdslDumpsoc.status,e)})}},E.usbdslDumpsoc.updateStatus().then(T)):T(),function(){if(l.usbdsl&&E.inRouterMode){E.usbdslStatistics={standard:"",_snrData:[],snrData:[],_bitsData:[],bitsData:[],isButtonDisabled:!0,isBitsLoaded:!1,isSnrLoaded:!1,getData:angular.noop,isPopupShown:!1};var e=E.usbdslStatistics;e.showPopup=function(){e.getData(),e.isPopupShown=!0},e.hidePopup=function(){e.isPopupShown=!1};var t=function(e,t,n,i){var a=[];if(t instanceof Array)for(var o=function(n){var o=t[n],s=void 0,r=Number(o.mult),l=[];o[i].split(",").forEach(function(e){s?(l.push({x:s,y:Number(e)}),s+=r):s=Number(o.from),l.push({x:s,y:Number(e)})}),a.push({color:"upstream"===e?"blue":"pink",data:l})},s=0;s<t.length;s++)o(s);else{var r,l=Number(t.mult),c=[];t[i].split(",").forEach(function(e){r?(c.push({x:r,y:Number(e)}),r+=l):r=Number(t.from),c.push({x:r,y:Number(e)})}),a.push({color:"upstream"===e?"blue":"pink",data:c})}var d="_".concat(n,"Data"),p=E.usbdslStatistics[d];E.usbdslStatistics[d]=p.concat(a)},n=function(e){for(var n in e)"continued"!==n&&(n.match("DS")&&t("downstream",e[n],"bits",n),n.match("US")&&t("upstream",e[n],"bits",n))},i=function(e){var n=e.US,i=e.DS;n&&t("upstream",n,"snr","US"),i&&t("downstream",i,"snr","DS")};e.getData=function(){return e.snrData=[],e._snrData=[],e.bitsData=[],e._bitsData=[],e.infoObj={},e.isSnrLoaded=!1,e.isBitsLoaded=!1,f.getData().then(function(t){e.standard=t.standard,e.infoObj=t.iprops}).then(function(){e.isButtonDisabled=!0,f.getSnr().then(function(t){i(t),e.isSnrLoaded=!0,e.snrData=e._snrData,e.isBitsLoaded&&(e.isButtonDisabled=!1)},null,i),f.getBits().then(function(t){n(t),e.isBitsLoaded=!0,e.bitsData=e._bitsData,e.isSnrLoaded&&(e.isButtonDisabled=!1)},null,n)})},f.getData().then(function(t){e.standard=t.standard,T()})}else T()}(),E.downloadSelfTest=function(){_.downloadFile({name:"self-test"})},E.debugger={toggleBtnClick:g.toggleDebugger,status:g.status},g.getStatusAndStartLoop().then(T),t.$on("$destroy",g.stopStatusLoop),E.monitorComponentIsInstalled&&function(){var i=s.translatePrefixCtor("diagnostics.capture.edit");E.capture={},E.capture.list=v.list,E.capture.listPendingIds={};var a=function(){return v.reload().then(function(){n(a,1500)})};t.$on("$destroy",function(){a=angular.noop}),a().then(T),E.capture.editor={ndmErrors:{filter:""},visible:!1,data:{},form:!1,vars:{interfaceSelect:[],directionSelect:[],storageSelect:!1}};var o=function(e){E.capture.editor.deleteOnCancel=!1,E.capture.editor.vars.memLimit=v.options.memLimit,E.capture.editor.vars.interfaceSelect=v.list.interfaces,!e.id&&E.capture.editor.vars.interfaceSelect.length&&(e.interfaceId=E.capture.editor.vars.interfaceSelect[0].id),e.bufferSize=e.bufferSize||512,E.capture.editor.vars.directionSelect=[{id:"in-out",name:i("direction-options.in-out")},{id:"in",name:i("direction-options.in")},{id:"out",name:i("direction-options.out")}],(E.storageComponentIsInstalled||"usb"===e.storage)&&(E.capture.editor.vars.storageSelect=[{id:"flash",name:i("storage-options.flash")},{id:"usb",name:i("storage-options.usb")}]),E.capture.editor.data=e,E.capture.editor.visible=!0,E.capture.editor.resetNdmErrors()};E.capture.editor.edit=function(e){if(!e.started)return v.load(e.id).then(o)},E.capture.editor.resetNdmErrors=function(){E.capture.editor.ndmErrors={}},E.capture.editor.save=function(){v.save(E.capture.editor.data).then(function(e){S.containsNdmErrorCode(e,p.NDM_ERROR_CODE.INVALID_CAPTURE_FILTER_SYNTAX)?(E.capture.editor.deleteOnCancel=!E.capture.editor.data.id&&E.capture.editor.data.interfaceId,E.capture.editor.ndmErrors.filter=i("invalid-filter-syntax")):(E.capture.editor.deleteOnCancel=!1,E.capture.editor.ndmErrors={},E.capture.editor.cancel(),v.reload(),n(function(){return c.success("diagnostics.capture.saved-notification",2e3)}))})},E.capture.editor.delete=function(){return r.confirm("diagnostics.capture.delete-confirm").then(function(){return v.delete(E.capture.editor.data.id).then(function(){E.capture.editor.cancel(),n(function(){return c.info("diagnostics.capture.deleted-notification",2e3)})})})},E.capture.editor.add=function(){o({id:void 0,interfaceId:void 0,maxFrameSize:1518,captureSize:v.options.memLimit,timeout:1e3,direction:"in-out",storage:"flash"})},E.capture.editor.cancel=function(){var t=e.when(!0);return E.capture.editor.deleteOnCancel&&(t=v.delete(E.capture.editor.deleteOnCancel)),t.then(function(){E.capture.editor.visible=!1,E.capture.editor.data={}})},E.capture.toggle=function(e){E.capture.listPendingIds[e]=!0,v.toggle(e).then(function(){return v.reload().then(function(){E.capture.listPendingIds[e]=!1})})},E.capture.reset=function(e){return v.reset(e)},E.capture.flush=function(){return r.confirm("diagnostics.capture.flush-confirm").then(function(){return v.flush().then(function(){return c.info("diagnostics.capture.flush-notification",2e3)})})},E.capture.download=function(e){return v.download(e)}}(),E.initLog=function(){E.log={},E.log.serverAddressIsValid=!0,E.log.logList=[],E.log.logPopupShow=!1,E.log.isLiveUpdate=!0,E.log.liveUpdateCheckbox=!1,E.log.clearLogButton=!0,E.log.showPageControll=!1,E.log.isGetData=!1,E.log.isFocus=!1,E.log.errorMessage="",E.log.showNotificationMassage=2500,E.log.serverAddress="",E.log.logData=y.logData,y.logServer("getAddress").then(function(e){E.log.serverAddress=e.address,E.log.isSendToServer=e.isSendToServer,E.log.isGetData=!0,E.log.serverAddressIsValid=!0,o.get(E,"log.diagnosticsForm.$setPristine",angular.noop)()}).then(T),E.log.checkSendToServerModified=function(){if(E.log.isSaveDisabled=!1,!E.log.diagnosticsForm.isSendToServer.modified)return E.log.showControlPanel=!0,!1;E.log.showControlPanel=!1},E.log.broadcastLogToogle=function(t){return e.when(t?y.logLoopStart():y.logLoopStop())},E.log.clearLog=function(){E.log.clearLogButton=!1,y.logLoopStop(),y.clearLog().then(function(){y.logData.list=[],y.logData.lastId=-1,E.log.isLiveUpdate&&y.logLoopStart(),E.log.clearLogButton=!0})},E.log.exportLog=function(){return y.exportLog()},E.log.setAddressSaveServer=function(){y.logServer("off").then(function(){if(!E.log.isSendToServer)return E.log.diagnosticsForm.$setPristine(),c.success("diagnostics.log.notification.disable-send-to-server",E.log.showNotificationMassage),E.log.showControlPanel=!1,!1;y.logServer("setAddress",E.log.serverAddress).then(function(){E.log.diagnosticsForm.$setPristine(),c.success("diagnostics.log.notification.save-address",E.log.showNotificationMassage),E.log.showControlPanel=!1})})},E.log.resetAddressLogServer=function(){o.invoke(E.log,"diagnosticsForm.reset")},E.log.toggleLogPopup=function(){E.log.logPopupShow?(E.log.logPopupShow=!1,y.logLoopStop()):(E.log.logPopupShow=!0,E.log.isLiveUpdate&&y.logLoopStart())},E.log.closeLogPopup=function(){E.log.logPopupShow=!1,y.logLoopStop()}},function(){if(E.inRouterMode){var e=function(e){return"diagnostics.connections.".concat(e)},t={noData:!1,srcMap:{},dstMap:{},sort:{name:"src",reverse:!0},sortBy:function(e){t.sort.name===e?t.sort.reverse=!t.sort.reverse:t.sort.name=e},sortFn:function(e,n){var i,a=t.sort.name,o=t.sort.reverse?-1:1,s=e.value,r=n.value;switch(a){case"src":i=s.ipNum&&r.ipNum?"ipNum":"sport";break;case"dst":i=s.dstIpNum&&r.dstIpNum?s.dstIpNum===r.dstIpNum?"dstIpNum":"dport":"dst";break;case"service":i=s.dport&&r.dport?s.protocol===r.protocol?"dport":"protocol":"service"}return o*(s[i]<r[i]?-1:1)},connRows:{},hostRows:{},hostData:[],table:{sourceColumns:{src:{title:e("source"),width:150,modify:function(e){var n=o.get(t,["srcMap",e],{});return n.host?"".concat(n.host,'<br/><span class="help-text">').concat(n.ip,"</span>"):e}},dst:{title:e("destination"),width:130},service:{title:e("service"),width:80}},connColumns:{sport:{title:e("source"),width:250,modify:function(e){return'<span class="source__port">:'.concat(e,"</span>")}},dst:{title:e("destination"),width:250,modify:function(e){var n=o.get(t,["dstMap",e],{});return n.host?"".concat(n.host,'<br/><span class="help-text">').concat(n.ip,"</span>"):e}},service:{title:e("service"),width:80}}},polling:function(){return b.getConnectionsData().then(function(e){t.dstMap=e.dstMap,t.srcMap=e.srcMap,t.hostRows={};var n=e.rows;n.length&&(o.forEach(t.connRows,function(e){e.rows=[]}),n.forEach(function(e){var n=e.src;t.connRows[n]||(t.connRows[n]={rows:[],tableIsVisible:!1}),t.hostRows[n]||(t.hostRows[n]={src:n,dst:" ",service:" "}),t.connRows[n].rows.push(angular.copy(e)),t.hostRows[n].hostname=t.srcMap[n].host,t.hostRows[n].ip=t.srcMap[n].ip}),t.hostData=[],o.forEach(t.hostRows,function(e,n){e.host=n,e.ipNum=u.ip2num(e.ip),t.hostData.push(e)}),t.noData=0===Object.keys(t.connRows).length)})}};E.connections=t}}(),t.$on("$destroy",y.logLoopStop),E.initLog()}e.$inject=["$q","$scope","$timeout","$rootScope","$state","_","utils","modal","components","notification","NDM","CONSTANT","ipV4Service","diagnosticsUsbdslDumpsoc","diagnosticsUsbDslStatistics","diagnosticsDebugger","diagnosticsCapture","diagnosticsTools","diagnosticsConnections","systemFilesService","LogManager","router","$interval","diagnosticsDsl"],angular.module("keenetic").controller("DiagnosticsController",e)}(),function(){function e(e,t,n,i,a,o,s){var r=2e4,l=o.sysmode===s.SYSMODE.ROUTER,c="show.interface",d="show.system",p="show.ip.hotspot",u="show.ip.hotspot.host",m="show.ip.dhcp.bindings",f="show.ip.dhcp.bindings.lease",g="show.rc.ip.dhcp.host",v=["sport","dport","packets","src-out","dport-out","packets-out"],h=function(e,t){var n=t.interfacesData,i=t.hotspotHosts,o=t.dhcpHosts,s=t.dhcpLeases,r=t.keeneticHostname,l=_(e,n);if(l)return"".concat(r," (").concat(l,")");var c=a.find(i,function(t){return t.ip===e}),d=a.get(c,"name")||a.get(c,"hostname");if(d)return d;var p=a.find(o,function(t){return t.ip===e}),u=a.get(p,"mac")||a.get(c,"mac");if(!u)return"";var m=a.find(s,function(e){return e.mac===u});return m?m.hostname||m.name:""},b=function(e,t){var n=h(e.src,t),i=h(e.dst,t);return e.srcHostname=n||"",e.srcIp=e.src,e.src=n?"".concat(e.src," / ").concat(n):e.src,e.dstHostname=i||"",e.dstIp=e.dst,e.dst=i?"".concat(e.dst," / ").concat(i):e.dst,e=v.reduce(function(e,t){return Object.assign({},e,_defineProperty({},t,Number(e[t])))},e)},_=function(e,t){var n=a.find(t,function(t){return e&&t.address&&t.address===e});return a.get(n,"label")},y=function(){return t.get("show/ip/nat").then(function(e){return angular.isArray(e)||(e=[]),e})};function S(o){var l=S;return l.data=l.data||{interfacesData:{},keeneticHostname:"",hotspotHosts:[],dhcpBindings:[],dhcpHosts:[],updated:0},function(){var o=e.defer();!l.data.updated||Date.now()-l.data.updated>r?(v=n.toRciQueryList([c,d,a.set({},p,{details:s.HOTSPOT_DETAILS.NONE}),m,g]),t.postToRciRoot(v).then(function(e){var t=a.get(e,"[0].".concat(c),{}),n=a.get(e,"[1].".concat(d),{}),o=i.getInterfaceOptions(t),s=a.mapValues(t,function(e){var t=a.find(o,function(t){return t.id===e.id}),n=a.get(t,"label");return Object.assign({},e,{label:n})}),r=a.get(n,"hostname",""),p=a.get(e,"[2].".concat(u),[]),m=a.get(e,"[3].".concat(f),[]),v=a.get(e,"[4].".concat(g),{});l.data={interfacesData:s,keeneticHostname:r,hotspotHosts:p,dhcpBindings:m,dhcpHosts:v,updated:Date.now()}})).then(o.resolve):o.resolve();var v;return o.promise}().then(function(){return o.map(function(e){return b(e,l.data)})})}function w(e){var t={bySrc:{},byIp:{},byHostname:{}},n={byDst:{},byIp:{},byHostname:{}};return e.forEach(function(e){e.service=function(e,t){var n=e+"/"+t,i=a.find(s.deviceProtocol,function(e){return e.name===n});i&&(n=i.description);return n}(e.protocol,e.dport),t[e.src]={ip:e.srcIp,host:e.srcHostname},n[e.dst]={ip:e.dstIp,host:e.dstHostname}}),{rows:e,srcMap:t,dstMap:n}}return{getConnectionsData:function(){return l?y().then(S).then(w):e.when({})}}}e.$inject=["$q","router","utils","interfaces","_","NDM","CONSTANT"],angular.module("keenetic").factory("diagnosticsConnections",e)}(),function(){function e(e,t,n,i){return{getPackagesList:function(){return i.get("show/credits").then(function(e){return t.get(e,"package",{})}).then(function(e){return t.map(e,function(e,t){return Object.assign({},e,{id:t})})})},getPackageLicenses:function(e){return i.get("show/credits?package=".concat(e)).then(function(e){return t.get(e,"copying")}).then(function(e){return t.toArray(e)})}}}e.$inject=["$q","_","utils","router"],angular.module("keenetic").factory("credits",e)}(),function(){function e(e,t,n,i,a){var o=this;o.progress=0;o.showPackageLicense=function(t){return e.when(t.licenses||a.getPackageLicenses(t.id)).then(function(e){t.licenses||(t.licenses=e),t.hasNoLicenses=0===e.length,t.licenseText=e.join("<br/>"),t.licenseIsVisible=e.length>0})},o.hidePackageLicense=function(e){e.licenseIsVisible=!1},o.togglePackageLicense=function(e){e.licenseIsVisible?o.hidePackageLicense(e):o.showPackageLicense(e)},a.getPackagesList().then(function(e){o.packages=e,o.progress=100})}e.$inject=["$q","$timeout","$rootScope","CONSTANT","credits"],angular.module("keenetic").controller("CreditsController",e)}(),function(){function e(e,t,n,i,a,o,s,r,l,c){var d,p=["cli","http","readonly","cifs","printers","ftp","sftp","webdav","vpn-dlna","afp","torrent","vpn","sstp","ipsec-l2tp","ipsec-xauth","http-proxy","opt"],u={PRIVATE:"restrict",PUBLIC:"http",PUBLIC_SSL:"https"},m={HTTP:"http",TELNET:"telnet",SSH:"ssh"},f=(_defineProperty(d={},m.HTTP,80),_defineProperty(d,m.TELNET,23),_defineProperty(d,m.SSH,22),d),g=Boolean(o.ssh),v=function(){return g?[m.HTTP,m.TELNET,m.SSH]:[m.HTTP,m.TELNET]},h=function(i,a){return s.postAndSave({user:_defineProperty({},String(i),{password:a})}).then(c.logout).then(function(){var o=e.defer(),r=0,l=function(){r>=10?o.reject():(r++,d())},d=function(){return n(function(){t({url:s.constants.RCI_URL+"/",method:"POST",data:{probe:"whoami"}}).then(function(){return l()},function(e){401===e.status?c.getAuthObj().then(function(){return c.authenticate(i,a)}).then(o.resolve):l()})},500)};return d(),o.promise})};var b=function(e){var t=e.tag||[];return i.includes(t,"cli")||i.includes(t,"http")},_=function(e){return i.includes(e.tag||[],"readonly")};return{SERVICE:m,DEFAULT_USER:"admin",DEFAULT_PORT:f,HTTP_PORTS:[80,81,280,777,5080,8080,8090,65080],SSH_COMPONENT_INSTALLED:g,READONLY_TAG:"readonly",WEB_ACCESS_LEVELS:u,getUsersAndTags:function(){var e=s.arrayToQueryData(["show.tags","show.rc.user","whoami"]);return s.postToRciRoot(e).then(function(e){var t=i.get(e,"show.tags.tag",[]);t.sort(function(e,t){return p.indexOf(e)-p.indexOf(t)});var n=i.get(e,"whoami.user",{}),a=i.get(e,"show.rc.user",{});return{tags:t,users:i.mapValues(a,function(e){var t=i.get(e,"tag",[]).reduce(function(e,t){return Object.assign({},e,_defineProperty({},t,!0))},{}),n=!l.isUserPasswordEmpty(e),a=_(e);return{tagsObj:t,isAdmin:b(e),isReadonly:a,hasPassword:n}}),currentUser:n}})},saveUserData:function(t,n){n=n||t.login;var a={};a.tag=i.map(t.tags||[],function(e){return{tag:e.tag,no:!e.isEnabled}});var o={user:_defineProperty({},String(n),a)};if(t.currentUser)return s.postAndSave(o).then(function(){return t.passwordChanged?h(n,t.password):e.when(!0)});var r=[o];return t.passwordChanged&&r.push(l.setPasswordQueryObj(n,t.password)),s.postAndSave(r)},setPasswordAndRelogin:h,getUsedPorts:function(){var e=s.arrayToQueryData(["show.rc.ip","show.interface"]);return s.postToRciRoot(e).then(function(e){var t=i.get(e,"show.rc.ip",{}),n=i.get(e,"show.interface",{}),a=i.pickBy(n,function(e){return"public"===e["security-level"]||"protected"!==e["security-level"]}),o=i.uniq(i.map(a,function(e){return e.address}).filter(i.identity)),s=i.uniq(i.flatMap(a,function(e,t){return[e.id,t]})),l={};return i.forEach(t,function(e,t){if(e.port&&(l[t]=Number(e.port)),"ftp"===t&&(l[t]=Number(e.port||r.DEFAULT_CONFIG.FTP.port)),angular.isArray(e)){var n=e.filter(function(e){return e.port&&"tcp"===e.protocol&&!e.address&&(e["to-address"]&&!i.includes(o,e["to-address"])||e["to-interface"]&&!i.includes(s,e["to-interface"])||e["to-host"]||e["to-port"]&&e["to-port"]!==e.port)});l=i.reduce(n,function(e,n,i){return Object.assign({},e,_defineProperty({},"".concat(t,"_").concat(i),Number(n.port)))},l)}}),l})},getWebaccessServicesList:v,loadWebaccessConfig:function(){var e=v(),t=s.arrayToQueryData(e.map(function(e){return"".concat("show.rc.ip",".").concat(e)}));return s.postToRciRoot(t).then(function(t){var n=i.get(t,"".concat("show.rc.ip",".http.security-level"),{}),a=u.PRIVATE;return n.public&&n.ssl?a=u.PUBLIC_SSL:n.public&&(a=u.PUBLIC),i.reduce(e,function(e,n){var a,o,s=i.get(t,"".concat("show.rc.ip",".").concat(n)),r=(o=f[n],{port:(a=s).port||o,enabled:Boolean(i.get(a,["security-level","public"]))});return Object.assign({},e,_defineProperty({},n,r))},{webAccessLevel:a})})},saveWebaccessConfig:function(e){e[m.HTTP].enabled=[u.PUBLIC,u.PUBLIC_SSL].indexOf(e.webAccessLevel)>-1,e[m.HTTP].ssl=e.webAccessLevel===u.PUBLIC_SSL;var t=v().filter(function(t){return e[t]}).map(function(t){return i.set({},["ip",t],(n=e[t],a=n.port,o=n.enabled,s=n.ssl,r=void 0===s?void 0:s,l={port:a,"security-level":{public:o,private:!o}},i.isBoolean(r)&&(l["security-level"].ssl=r),l));var n,a,o,s,r,l});return s.postAndSave(t)},isUserAdmin:b,isReadonlyUser:_}}e.$inject=["$q","$http","$timeout","_","CONSTANT","components","router","privateCloudService","usersService","authenticationService"],angular.module("keenetic").factory("administrator",e)}(),function(){function e(e,t,n,i,a,o,s,r,l,c,d,p,u,m,f){var g=this,v=f.WEB_ACCESS_LEVELS,h=f.DEFAULT_PORT,b=f.SERVICE,_=f.HTTP_PORTS,y=f.SSH_COMPONENT_INSTALLED,S=f.DEFAULT_USER,w={NOT_ADMIN:"no",ADMIN_WITH_PASSWORD:"yes",ADMIN_READONLY:"read-only",ADMIN_WITHOUT_PASSWORD:"no-password"};g.SSH_COMPONENT_INSTALLED=y,g.DEFAULT_PORT=h,g.SERVICE=b,g.DEFAULT_USER=S,g.setDefaultServicePort=function(e){g.config.data[e].port=h[e]};var C=!1,E=function(){g.l10n={portIsUsed:r.getTranslation("administrator.port-used"),httpPortChangedAlert:r.getTranslation("administrator.webaccess.http-port-changed-alert"),defaultHttpPort:r.getTranslation("by-default-value",null,{value:h[b.HTTP]}),rights:{}},o.forEach(w,function(e){g.l10n.rights[e]=r.getTranslation("administrator.list.rights.".concat(e))}),g.config.options.webAccessLevels=o.map(v,function(e){return{id:e,label:r.getTranslation("administrator.webaccess.security-levels.".concat(e))}})};t.$on("$destroy",a.$on("$translateChangeSuccess",function(){return i(E)})),g.pageName="administrator",g.isSpecialMode=c.sysmode!==d.SYSMODE.ROUTER,g.isAllAdminsHavePassword=!1,g.webaccessServicesList=f.getWebaccessServicesList(),g.portError=o.reduce(g.webaccessServicesList,function(e,t){return Object.assign({},e,_defineProperty({},t,""))},{}),g.progress=25;var I=function(){g.progress+=25};i(function(){g.polling().then(I).then(g.config.loadPorts).then(I).then(g.config.loadData).then(I)}),g.polling=function(){return g.editor.loading?e.when(!0):f.getUsersAndTags().then(function(e){g.list.data=e.users,g.list.table.data=o.map(e.users,function(e,t){return Object.assign({},e,{login:t})}),g.currentUser=e.currentUser,g.editor.tagsList=e.tags.map(function(e){return{tag:e,isEnabled:!1,name:"administrator.editor.tags.".concat(e),description:"administrator.editor.tags-description.".concat(e)}}),g.isAllAdminsHavePassword=0===o.filter(e.users,function(e){return e.isAdmin&&!e.hasPassword}).length})};g.list={data:{},table:{data:[],columns:{},order:"login",desc:!1},addClick:function(){g.editor.edit()},rowClick:function(e){g.editor.edit(e.login)}},g.list.table.columns={login:{title:"administrator.list.login-header",width:300},tag:{title:"administrator.list.rights-header",modify:function(e,t){var n,i,a,o,s=(i=(n=t).isReadOnly,a=n.isAdmin,o=n.hasPassword,a?o?i?w.ADMIN_READONLY:w.ADMIN_WITH_PASSWORD:w.ADMIN_WITHOUT_PASSWORD:w.NOT_ADMIN),r=s===w.ADMIN_WITHOUT_PASSWORD;return s=g.l10n.rights[s],r&&(s='<span class="help-text--warning">'.concat(s,"</span>")),s}},editHint:{title:" ",width:20,directive:"ndm-icon",modify:function(){return"pencil"}}},g.config={data:{password:void 0,password2:void 0,telnet:{port:void 0,enabled:void 0},http:{port:void 0,enabled:void 0},webAccessLevel:v.PRIVATE},form:void 0,usedPorts:{},isDefaultHttpPortUsed:!1,options:{httpPort:void 0,webAccessLevels:[]}},g.revalidatePassword=function(){var e,t=g.editor.data;e=t.password===t.password2?t.password||g.editor.passwordIsNotEmpty?"":"errors.required-field":"passwords-do-not-match",g.editor.error={password:e,password2:e}};var T=function(){return o.get(g,"config.form.$setPristine",o.noop)()};g.config.loadData=function(){return f.loadWebaccessConfig().then(function(e){g.config.data=e,T(),g.config.loading=!1})};var k=function(e){return o.get(g,"config.data.".concat(e,".port"))};g.revalidatePorts=function(){g.webaccessServicesList.forEach(function(e){g.portError[e]="";var t=Number(k(e));o.some(g.config.portsUsedForOtherServices,function(e){return e===t})&&(g.portError[e]=g.l10n.portIsUsed)});var e=g.webaccessServicesList.map(function(e){return{service:e,port:k(e)}});o.forEach(o.groupBy(e,"port"),function(e){1!==e.length&&e.forEach(function(e){var t=e.service;g.portError[t]=g.l10n.portIsUsed})})},g.config.loadPorts=function(){return f.getUsedPorts().then(function(e){g.config.usedPorts=e,g.config.portsUsedForOtherServices=o.pickBy(g.config.usedPorts,function(e,t){return!o.includes(g.webaccessServicesList,t)}),g.config.options.httpPort=o.difference(_,o.values(g.config.portsUsedForOtherServices)).map(function(e){return{id:e,label:String(e)}}),g.config.isDefaultHttpPortUsed=!o.find(g.config.options.httpPort,{id:h[b.HTTP]});var i=null;t.$watch("vm.config.data.http.port",function(e,t){var a,o,s,r;angular.isUndefined(t)?i=e:("http"!==n.protocol()||C||Number(e)===Number(t)||Number(e)===Number(i)||(a=g.config.data.http.port,o=n.protocol()+"://"+n.host(),s=a===h[b.HTTP]?"":":"+a,r="".concat(g.l10n.httpPortChangedAlert," <b>").concat(o).concat(s,"/</b>"),l.confirm(r)).then(function(){C=!0}).catch(function(){g.config.data.http.port=i}),g.revalidatePorts())})})},g.config.submit=function(){var e=Boolean(o.get(g,"config.form.password.modified"));f.saveWebaccessConfig(g.config.data).then(function(){return!e||l.alert("administrator.admin-account.password-changed-alert")}).then(g.polling).then(g.config.loadData).then(function(){g.config.form.$setSubmitted(),T(),s.success("administrator.webaccess.saved-success",2500)})},g.editor={id:void 0,visible:!1,loading:!1,footerIsVisible:!1,data:{},ndmErrors:{},tags:void 0,tagsList:[],form:void 0,error:{password:"",password2:""},setFormSubmitted:function(){return o.get(g,"editor.form.$setSubmitted",angular.noop)()},close:function(){var e=g.editor;e.tags=g.editor.tagsList.slice(),e.visible=!1,e.footerIsVisible=!1,e.id=void 0,e.ndmErrors={}}};var P=function(e){return Boolean(o.get(g,"editor.form.".concat(e,"__isEnabled.$pristine")))},A=function(e,t){var n=o.find(g.editor.tags||[],{tag:e});n&&(n.isEnabled=Boolean(t))},D=function(e){A(e,Boolean(o.get(g,"editor.form.".concat(e,"__isEnabled.masterValue"))))};function O(e){return g.polling().then(function(){g.editor.footerIsVisible=!1,g.editor.loading=!1,g.editor.close(),i(function(){s.success(e,2e3)},100)})}g.editor.onTagStateChange=function(e,t){"printers"===e&&o.some(g.editor.tags,{tag:"cifs"})?t?A("cifs",!0):P("cifs")&&D("cifs"):"cifs"===e&&(t?P("printers")&&D("printers"):A("printers",!1))},g.editor.edit=function(e){if(!g.editor.loading){n(!0),e&&!0!==e?g.editor.id=e:(g.editor.id=!1,g.editor.data={},g.editor.passwordIsNotEmpty=!1),g.editor.id&&(g.editor.data=g.list.data[g.editor.id],g.editor.passwordIsNotEmpty=g.editor.data.hasPassword);var t=o.get(g,"editor.data.tagsObj",{});n(!1),g.editor.tags=o.map(g.editor.tagsList,function(e){return Object.assign({},e,{isEnabled:Boolean(t[e.tag])})})}function n(e){g.editor.visible=!e,i(function(){if(g.editor.loading=Boolean(e),!e){if(g.editor.id){var t=o.get(g,"editor.form");angular.isObject(t)&&(t.$setPristine(),t.modified=!1,t.modifiedCount=0,t.modifiedModels=[])}else o.get(g,"editor.form.userLogin.revalidate",angular.noop)();g.editor.footerIsVisible=!e}})}},g.editor.submit=function(){var e=g.editor;e.loading=!0,e.data.tags={};var t=e.data,n=t.login||e.id,i={login:n,currentUser:g.currentUser===n,password:t.password,passwordChanged:!o.get(g,"editor.form.password1.$pristine"),tags:e.tags};e.setFormSubmitted(),f.saveUserData(i,e.id).then(function(t){e.loading=!1,m.containsNdmErrorCode(t,d.NDM_ERROR_CODE.NAME_IS_RESERVERD)?e.ndmErrors.login=r.getTranslation("administrator.editor.reserved-user-name"):(e.ndmErrors={},O("administrator.user-saved"))})},g.editor.delete=function(){l.confirm("administrator.user-delete-confirm").then(function(){g.editor.setFormSubmitted(),g.editor.loading=!0,u.deleteUser(g.editor.id).then(function(){return O("administrator.user-deleted")})})},g.editorLoginUniqValidation=function(e){var t=Object.keys(g.list.data);return!o.includes(t,e.toLowerCase())||{message:"administrator.editor.user-exists"}},E()}e.$inject=["$q","$scope","$location","$timeout","$rootScope","_","notification","utils","modal","NDM","CONSTANT","ValidatorManager","usersService","router","administrator"],angular.module("keenetic").controller("AdministratorController",e)}(),function(){function e(e,t,n,i){var a=this;a.ready=!1,a.appName="vpn-sstp-stat",a.rows=[];var o=i.createRequester("show.sstp-server",function(e){a.rows=i.processVpnStatData(e),a.ready=!0});a.popup={name:a.appName,opened:!1,open:function(){a.popup.opened=!0},close:function(){e.$parent.AC.popup.close()},ready:function(){return a.progress>=100},getState:function(){var t=e.$parent.AC.currentPopup===a.appName;return t&&!a.popup.opened&&o.startPolling(),!t&&a.popup.opened&&o.stopPolling(),a.popup.opened=t,a.popup.opened}}}e.$inject=["$scope","$location","_","vpnStatisticsService"],angular.module("keenetic").controller("VpnSstpStatAppsController",e)}(),function(){function e(e,t,n,i){var a=i.getApps(!0)["vpn-sstp"].tag;return{getConfiguration:function(){return e.post({show:{"sstp-server":{},rc:{ip:{nat:{}},interface:{},"sstp-server":{},user:{}}}}).then(function(e){var i=e.show,o=i.rc,s=o["sstp-server"],r=o.user||{},l={};return t.getSegments(o.interface).then(function(e){var t=n.map(e,function(e){return{id:e.name,label:e.description}});return s.isNatEnabled=Boolean(n.find(n.get(o,"ip.nat",{}),{sstp:!0})),s["static-ip"]=s["static-ip"]||{},s.interface=s.interface||t[0].id,n.forEach(r,function(e,t){var n=(e.tag||[]).slice(),i=-1!==n.indexOf(a);l[t]={access:i,address:"",tags:n,noAddress:!0,noTag:!i,error:""}}),n.forEach(s["static-ip"],function(e,t){l[t].address=e.address,l[t].noAddress=!1}),{segments:t,model:s,status:i["sstp-server"],users:l}})})},saveConfiguration:function(t,i){var o=t.isNatEnabled,s=[],r={};return delete t.isNatEnabled,n.forEach(i,function(e,n){e.access&&e.noTag?r[n]={tag:a}:e.access||e.noTag||(r[n]={tag:{tag:a,no:!0}}),e.address?t["static-ip"][n]={address:e.address}:e.address||e.noAddress||(t["static-ip"][n]={no:!0})}),n.isEmpty(t["static-ip"])&&delete t["static-ip"],s.push({"sstp-server":t}),s.push(n.set({},"ip.nat.sstp",{no:!o})),n.isEmpty(r)||s.push({user:r}),e.postAndSave(s)},APP_NAME:"vpn-sstp"}}e.$inject=["router","interfaces","_","appsPresets"],angular.module("keenetic").factory("vpnSstpService",e)}(),function(){function e(e,t,n,i,a,o,s,r,l){var c=this,d=e.$parent.AC;c.appName=r.APP_NAME,c.progress=0,c.model={},c.ready=!1,c.users={},c.usersListModified=!1,c.segments=[];var p=function(){c.l10n={noIpPlaceholder:o.getTranslation("apps.users-table.no-ip-placeholder"),ipIsNotUnique:o.getTranslation("apps.validation.user-ip-is-not-unique")}};p(),e.$on("destroy",n.$on("$translateChangeSuccess",function(){return i(p)}));var u=function(){return a.get(c,"form.$setPristine",angular.noop)()};c.revalidateIpAddresses=function(){var e=a.transform(c.users,function(e,t,n){e[t.address]=e[t.address]||[],e[t.address].push(n)});a.forEach(e,function(e,t){t&&1!==e.length?a.every(e,function(e){return c.users[e].error})&&(c.users[e[0]].error=""):e.forEach(function(e){c.users[e].error=""})})},d.sstpUserIpIsUnique=function(e,t){if(e){var n=a.filter(c.users,function(e,n){return n!==t&&e.address}).map(function(e){return e.address});c.users[t].error=a.includes(n,e)?c.l10n.ipIsNotUnique:"",c.revalidateIpAddresses()}else c.revalidateIpAddresses()},c.addUser=function(e){l.getUser(e).then(function(){c.users[e]={access:!1,address:"",tags:[],noTag:!0,noAddress:!0,error:""}})},c.popup={name:c.appName,opened:!1,open:function(){c.popup.opened=!0},close:function(){return d.popup.close()},save:function(){var e=angular.copy(c.model),t=angular.copy(c.users);return u(),c.popup.close(),r.saveConfiguration(e,t).then(function(){i(function(){s.success("notifications.saved",1500)})})},ready:function(){return c.progress>=100},getState:function(){var e=d.currentPopup===c.appName;return e&&!c.popup.opened&&r.getConfiguration().then(function(e){c.segments=e.segments,c.model=e.model,c.users=e.users,u(),c.progress=100}),!e&&c.popup.opened&&i(u),c.popup.opened=e,c.popup.opened}}}e.$inject=["$scope","$location","$rootScope","$timeout","_","utils","notification","vpnSstpService","usersService"],angular.module("keenetic").controller("VpnSstpAppsController",e)}(),function(){function e(e,t,n,i,a,o){var s=a.cryptoMapName,r=n.APPS,l=n.getApps(!0),c=l[r.VPN_IPSEC_VIRTUAL_IP].cryptoMapName,d=l[r.VPN_IKEV2].cryptoMapName,p=function(e){var n=e.showCryptoMap,a=e.cryptoMapName,s=e.clientsArrayProp,r=e.clientUsernameProp,l=o.get(n,"crypto_map.".concat(a,".status.").concat(s),[]);return o.map(l,function(e){var n=o.get(e,r,"-"),a=o.get(e,"statistic",{});return{username:n,clientaddress:o.get(e,"tunnel-address","-"),uptime:e["connect-time"]?i.getSplittedTime(e["connect-time"]):i.getTranslation("apps.vpn-user-is-not-connected"),bytes:t.formatStatData(a)}})};return{createRequester:function(t,n){var i=e.createRequester();return i.registerCallback(t,function(e){var i=o.get(e,"[0].".concat(t),{});return n(i)}),i.setPollInterval(3e3),i},processVpnStatData:function(e){var n=o.get(e,"tunnel",[]);return o.map(n,function(e){var n=o.get(e,"statistic",{}),a=e.clientaddress;return{username:e.username,clientaddress:a,uptime:e.uptime?i.getSplittedTime(e.uptime):i.getTranslation("apps.vpn-user-is-not-connected"),bytes:t.formatStatData(n)}})},processVpnL2tpStatData:function(e){return p({showCryptoMap:e,cryptoMapName:s,clientsArrayProp:"l2tp_clients",clientUsernameProp:"username"})},processVirtualIpStatData:function(e){return p({showCryptoMap:e,cryptoMapName:c,clientsArrayProp:"virtual_ip_clients",clientUsernameProp:"xauth-id"})},processVpnIkeV2StatData:function(e){return p({showCryptoMap:e,cryptoMapName:d,clientsArrayProp:"virtual_ip_clients",clientUsernameProp:"xauth-id"})}}}e.$inject=["requesterFactory","appsService","appsPresets","utils","VpnL2tpService","_"],angular.module("keenetic").factory("vpnStatisticsService",e)}(),function(){function e(e,t,n,i){var a=this;a.appName="vpn-server-stat",a.ready=!1;var o=i.createRequester("show.vpn-server",function(e){a.rows=i.processVpnStatData(e),a.ready=!0});a.popup={name:a.appName,opened:!1,open:function(){a.popup.opened=!0},close:function(){e.$parent.AC.popup.close()},ready:function(){return a.progress>=100},getState:function(){var t=e.$parent.AC.currentPopup===a.appName;return t&&!a.popup.opened&&o.startPolling(),!t&&a.popup.opened&&o.stopPolling(),a.popup.opened=t,a.popup.opened}}}e.$inject=["$scope","$location","_","vpnStatisticsService"],angular.module("keenetic").controller("VpnStatAppsController",e)}(),function(){function e(e,t,n,i){return{getNewUserObj:function(){return{access:!1,address:"",tags:[],noAddress:!0,noTag:!0,error:""}},getConfiguration:function(){return n.post(t.set({},"show.rc",{user:{},interface:{},"vpn-server":{},ip:{nat:{}}})).then(function(e){var n=t.get(e,"show.rc",{});return i.getSegments(n.interface).then(function(e){var i=t.map(e,function(e){return{id:e.name,label:e.description}}),a=n["vpn-server"],o=t.get(n,"ip.nat",{});a.isNatEnabled=Boolean(t.find(o,{vpn:!0})),a.mppeRequired=!a["mppe-optional"],a.interface=a.interface||i[0].id,a["static-ip"]=a["static-ip"]||{};var s={};return t.forEach(n.user||{},function(e,t){var n=(e.tag||[]).slice(),i=-1!==n.indexOf("vpn");s[t]={access:e.tag&&e.tag.indexOf("vpn")>-1,address:"",tags:n,noAddress:!0,noTag:!i,error:""}}),t.forEach(a["static-ip"]||{},function(e,t){s[t].address=e.address,s[t].noAddress=!1}),{model:a,segmentOptions:i,users:s}})})},setConfiguration:function(e,i){var a=[],o={},s=e.isNatEnabled;return delete e.isNatEnabled,e["mppe-optional"]=!e.mppeRequired,delete e.mppeRequired,t.forEach(i,function(t,n){t.access&&t.noTag?o[n]={tag:"vpn"}:t.access||t.noTag||(o[n]={tag:{tag:"vpn",no:!0}}),t.address?e["static-ip"][n]={address:t.address}:t.address||t.noAddress||(e["static-ip"][n]={no:!0})}),t.isEmpty(e["static-ip"])&&delete e["static-ip"],a.push(t.set({},"ip.nat.vpn",{no:!s})),a.push(t.set({},"vpn-server",e)),t.isEmpty(o)||a.push({user:o}),n.postAndSave(a)}}}e.$inject=["$q","_","router","interfaces"],angular.module("keenetic").factory("vpnService",e)}(),function(){function e(e,t,n,i,a,o,s,r,l){var c=this;c.appName="vpn-server",c.l10n={};var d=function(){c.l10n={dynamicIp:r.getTranslation("apps.vpn.dynamic-ip"),ipIsNotUnique:r.getTranslation("apps.validation.user-ip-is-not-unique")}};d(),t.$on("destroy",n.$on("$translateChangeSuccess",function(){return e(d)}));var p=function(){var e=a.transform(c.users,function(e,t,n){e[t.address]=e[t.address]||[],e[t.address].push(n)});a.forEach(e,function(e,t){t&&1!==e.length?a.every(e,function(e){return c.users[e].error})&&(c.users[e[0]].error=""):e.forEach(function(e){c.users[e].error=""})})};t.$parent.AC.pptpUserIpIsUnique=function(e,t){if(!e)return c.users[t].error="",void p();var n=a.filter(c.model["static-ip"],function(e,n){return n!==t&&e.address}).map(function(e){return e.address});c.users[t].error=a.includes(n,e)?c.l10n.ipIsNotUnique:"",p()};var u=function(){return a.get(c,"form.$setPristine",angular.noop)()};c.actions={addUser:function(e){o.getUser(e).then(function(){c.users[e]=l.getNewUserObj()})}},c.popup={name:c.appName,opened:!1,open:function(){c.popup.opened=!0},close:function(){return t.$parent.AC.popup.close()},save:function(){var t=angular.copy(c.model),n=angular.copy(c.users);return u(),c.popup.close(),l.setConfiguration(t,n).then(function(){e(function(){return s.success("apps.notification.save",1500)})})},ready:function(){return c.progress>=100},getState:function(){var n=t.$parent.AC.currentPopup===c.appName;return n&&!c.popup.opened&&l.getConfiguration().then(function(t){c.model=t.model,c.users=t.users,c.segments=t.segmentOptions,c.progress=100,e(u)}),c.popup.opened=n,c.popup.opened}}}e.$inject=["$timeout","$scope","$rootScope","$location","_","usersService","notification","utils","vpnService"],angular.module("keenetic").controller("VpnAppsController",e)}(),function(){function e(e,t,n,i,a){var o=this,s=!1;o.appName="vpn-l2tp-stat",o.ready=!1,o.rows=[];var r=a.createRequester("show.crypto.map",function(e){o.rows=a.processVpnL2tpStatData(e),o.ready=!0});o.popup={name:o.appName,opened:!1,open:function(){o.popup.opened=!0},close:function(){e.$parent.AC.popup.close(),s&&r.stopPolling(),s=!1,o.rows=[]},getState:function(){var t=e.$parent.AC.currentPopup===o.appName;return t&&!o.popup.opened&&(s=!0,r.startPolling()),o.popup.opened=t,o.popup.opened}}}e.$inject=["$scope","$location","$parse","_","vpnStatisticsService"],angular.module("keenetic").controller("VpnL2tpStatAppsController",e)}(),function(){function e(e,t,n,i,a,o,s){var r="ipsec-l2tp",l=s.getApps(!0)["vpn-l2tp"].cryptoMapName;return{getData:function(){return n.get("crypto").then(function(n){return e.all([e.when(n),a.getSegments().then(function(e){return t.map(e,function(e){return{id:e.name,label:e.description}})}),o.getAllUsers().then(function(e){return t.forEach(e,function(t,n){var i=(t.tag||[]).slice();e[n]={access:t.tag&&t.tag.indexOf(r)>-1,address:"",tags:i,noAddress:!0,noTag:-1===i.indexOf(r)}}),t.forEach(t.get(n,["map",l,"l2tp-server","static-ip"],{}),function(t,n){e[n].address=t.address,e[n].noAddress=!1}),e})])})},setData:function(e,i){var a={},o={};t.forEach(i,function(e,t){var n=e.tags.indexOf(r);e.access&&-1===n?a[t]={tag:r}:!e.access&&n>-1&&(a[t]={tag:{tag:r,no:!0}}),e.address?o[t]={name:l,address:e.address}:e.address||e.noAddress||(o[t]={name:l,no:!0})});var s=[{crypto:{map:{name:l,"l2tp-server":{"multi-login":e["multi-login"],interface:e.interface}}}}];return s.push({crypto:{"l2tp-server":e}}),t.isEmpty(a)||s.push({user:a}),t.isEmpty(o)||s.push({crypto:{map:{name:l,"l2tp-server":{"static-ip":o}}}}),s.push(n.saveQueryStr().data),n.post({url:"",data:s})},tag:r,cryptoMapName:l}}e.$inject=["$q","_","router","utils","interfaces","usersService","appsPresets"],angular.module("keenetic").factory("VpnL2tpService",e)}(),function(){function e(e,t,n,i,a,o,s,r,l,c){var d=this;d.appName="vpn-l2tp",d.model={},d.ready=!1,d.virtualIpInstalled=Boolean(r.ipsec),d.l10n={noIpPlaceholder:o.getTranslation("apps.users-table.no-ip-placeholder"),pskDescriptionChange:o.getTranslation("apps.vpn-l2tp.form.psk.link-change"),pskDescriptionCancel:o.getTranslation("apps.vpn-l2tp.form.psk.link-cancel-change"),ipIsNotUnique:o.getTranslation("apps.validation.user-ip-is-not-unique")},d.psk={defined:!1,readonly:!1,description:"",initialValue:"",toggleState:function(){var e=n[0].querySelectorAll('.psk-input input[name="ipsecPsk"][type=text]'),t=n[0].querySelectorAll(".psk-input .ndm-input__password-icon")[0];d.psk.readonly?(e.length&&i(function(){t.click()}),d.psk.readonly=!1,d.psk.description=d.l10n.pskDescriptionCancel):(d.psk.readonly=!0,d.psk.description=d.l10n.pskDescriptionChange,d.psk.initialValue&&(d.model.psk=d.psk.initialValue))}},d.revalidateIpAddresses=function(e,t){(d.users[e].address||t)&&a.forEach(d.users,function(t,n){e!==n&&t.address&&t.address===d.users[n].address&&(d.users[n].error="")})},e.$parent.AC.userIpIsUnique=function(e,t){if(e){var n=[];a.forEach(d.users,function(e,i){t!==i&&e.address&&n.push(e.address)}),n.indexOf(e)>-1?d.users[t].error=d.l10n.ipIsNotUnique:d.users[t].error="",d.revalidateIpAddresses(t)}else d.revalidateIpAddresses(t,!0)};d.addUser=function(e){l.addTag(e,c.tag).then(function(){d.users[e]={access:!0,address:"",tags:[c.tag],noTag:!1,noAddress:!0}})},d.popup={name:d.appName,opened:!1,open:function(){d.popup.opened=!0},close:function(){e.$parent.AC.popup.close(),d.ready=!1},save:function(){var e=angular.copy(d.model),t=angular.copy(d.users);c.setData(e,t).then(function(){d.popup.close(),i(function(){s.success("apps.notification.save",1500)})})},getState:function(){var t=e.$parent.AC.currentPopup===d.appName;return t&&!d.popup.opened&&c.getData().spread(function(e,t,n){d.segments=t,d.model=e["l2tp-server"],d.model.interface=d.model.interface||t[0].id,d.psk.defined=d.virtualIpInstalled&&Boolean(d.model.psk),d.psk.readonly=d.psk.defined,d.psk.initialValue=String(d.model.psk),d.psk.defined?d.psk.description=d.l10n.pskDescriptionChange:d.psk.description="",d.users=n,d.ready=!0}).then(d.popup.open),!t&&d.popup.opened&&(d.ready=!1),d.popup.opened=t,d.popup.opened}}}e.$inject=["$scope","$location","$document","$timeout","_","utils","notification","components","usersService","VpnL2tpService"],angular.module("keenetic").controller("VpnL2tpAppsController",e)}(),function(){function e(e,t,n,i){var a=this;a.appName="vpn-ikev2-stat",a.ready=!1,a.isPollingStarted=!1;var o=i.createRequester("show.crypto.map",function(e){a.rows=i.processVpnIkeV2StatData(e),a.ready=!0});a.popup={name:a.appName,opened:!1,open:function(){a.popup.opened=!0},close:function(){e.$parent.AC.popup.close(),a.isPollingStarted&&o.stopPolling(),a.isPollingStarted=!1},ready:function(){return a.progress>=100},getState:function(){var t=e.$parent.AC.currentPopup===a.appName;return t&&!a.popup.opened&&(a.isPollingStarted=!0,o.startPolling()),a.popup.opened=t,a.popup.opened=t,a.popup.opened}}}e.$inject=["$scope","$location","utils","vpnStatisticsService"],angular.module("keenetic").controller("VpnIkeV2StatAppsController",e)}(),function(){function e(e,t,n,i,a){var o=a.getApps(!0),s=e.get(o,a.APPS.VPN_IKEV2,{}),r=s.cryptoMapName,l=s.tag,c=function(t,n,i){var a=Object.assign({},e.set({},t,n),{name:i});return e.set({},"crypto.map",a)};return{TAG:l,getConfiguration:function(){var i=t.toRciQueryList(["show.rc.crypto.virtual-ip-server-ikev2","show.rc.crypto.map","show.rc.user"]);return n.postToRciRoot(i).then(function(t){var n=e.get(t,"[0].".concat("show.rc.crypto.virtual-ip-server-ikev2"),{}),i=e.get(t,"[1].".concat("show.rc.crypto.map",".").concat(r),{}),a=e.get(i,"virtual-ip.static-ip",{}),o=e.get(t,"[2].".concat("show.rc.user"),{}),s=e.mapValues(o,function(t,n){var i=e.get(t,"tag",[]).includes(l),o=e.get(a,[n,"address"],"");return{error:"",hasAccessSaved:i,hasAccess:i,ipAddress:o,addressIsSaved:Boolean(o)}});return{model:{isEnabled:e.get(i,"enable",!1),isMultiLoginEnabled:e.get(i,"virtual-ip.multi-login.enable",!1),isNatEnabled:e.get(n,"nat",!1),poolStart:e.get(n,"pool-start",""),poolSize:e.get(n,"pool-size",""),dnsServer:e.get(n,"dns-server","")},users:s}})},saveConfiguration:function(t,a){var o,s=(_defineProperty(o={},"enable",t.isEnabled),_defineProperty(o,"nat",t.isNatEnabled),_defineProperty(o,"pool-start",t.poolStart),_defineProperty(o,"pool-size",t.poolSize),_defineProperty(o,"dns-server",t.dnsServer),o),d=e.set({},"crypto.virtual-ip-server-ikev2",s),p=e.chain(a).map(function(e,t){return Object.assign({},e,{name:t})}).filter(function(e){return e.ipAddress||!e.ipAddress&&e.addressIsSaved}).sortBy(function(e){return e.ipAddress?1:0}).map(function(e){var t=e.ipAddress?{name:r,address:e.ipAddress}:{name:r,no:!0};return _defineProperty({},e.name,t)}).value().map(function(e){return c("virtual-ip.static-ip",e,r)}),u=c("virtual-ip.multi-login",t.isMultiLoginEnabled,r),m=e.map(a,function(e,t){return e.hasAccess?i.getAddTagQuery(t,l):i.getRemoveTagQuery(t,l)}),f=[d].concat(_toConsumableArray(p),[u],_toConsumableArray(m));return n.postAndSave(f)}}}e.$inject=["_","utils","router","usersService","appsPresets"],angular.module("keenetic").factory("vpnIkeV2Server",e)}(),function(){function e(e,t,n,i,a,o,s){var r=this;r.appName="vpn-ikev2",r.isReady=!1,r.l10n={ipIsNotUnique:i.getTranslation("apps.validation.user-ip-is-not-unique")},r.model={},r.users={};var l=function(){r.users=n.mapValues(r.users,function(e){return e.ipAddress?e:Object.assign({},e,{error:""})});var e=n.chain(r.users).pickBy(function(e){return e.ipAddress}).map(function(e,t){return Object.assign({},e,{name:t})}).groupBy("ipAddress").value(),t=_slicedToArray(n.chain(e).partition(function(e){return e.length<2}).map(function(e){return n.flatMap(e,function(e){return n.map(e,"name")})}).value(),2),i=t[0],a=t[1];r.users=n.mapValues(r.users,function(e,t){return i.includes(t)?Object.assign({},e,{error:""}):a.includes(t)?Object.assign({},e,{error:r.l10n.ipIsNotUnique}):e})};r.isUserIpUnique=function(){l()};r.addUser=function(e){return o.addTag(e,s.TAG).then(function(){r.users[e]={error:"",hasAccessSaved:!0,hasAccess:!0,ipAddress:"",addressIsSaved:!1}})},r.onUserAccessChange=function(){l()},r.popup={name:r.appName,isOpened:!1,open:function(){r.popup.isOpened=!0},close:function(){e.$parent.AC.popup.close(),r.isReady=!1},save:function(){s.saveConfiguration(r.model,r.users).then(function(){r.popup.close(),t(function(){return a.success("apps.notification.save")})})},getState:function(){var t=e.$parent.AC.currentPopup===r.appName;return t&&!r.popup.isOpened&&s.getConfiguration().then(function(e){var t=e.model,i=e.users;r.model=t,r.users=i,n.invoke(r,"form.$setPristine"),r.isReady=!0}).then(r.popup.open),!t&&r.popup.isOpened&&(r.isReady=!1),r.popup.isOpened=t,r.popup.isOpened}}}e.$inject=["$scope","$timeout","_","utils","notification","usersService","vpnIkeV2Server"],angular.module("keenetic").controller("VpnIkeV2AppsController",e)}(),function(){function e(e,t,n,i){var a=this;a.isPollingStarted=!1,a.appName="virtualIP-stat",a.ready=!1;var o=i.createRequester("show.crypto.map",function(e){a.rows=i.processVirtualIpStatData(e),a.ready=!0});a.popup={name:a.appName,opened:!1,open:function(){a.popup.opened=!0},close:function(){e.$parent.AC.popup.close(),a.isPollingStarted&&o.stopPolling(),a.isPollingStarted=!1},ready:function(){return a.progress>=100},getState:function(){var t=e.$parent.AC.currentPopup===a.appName;return t&&!a.popup.opened&&(a.isPollingStarted=!0,o.startPolling()),a.popup.opened=t,a.popup.opened=t,a.popup.opened}}}e.$inject=["$scope","$location","utils","vpnStatisticsService"],angular.module("keenetic").controller("VirtualIPStatAppsController",e)}(),function(){function e(e,t,n,i,a,o){var s=o.getApps(!0),r=t.get(s,o.APPS.VPN_IPSEC_VIRTUAL_IP,{}),l=r.tag,c=r.cryptoMapName,d=function(e,n,i){var a=Object.assign({},t.set({},e,n),{name:i});return t.set({},"crypto.map",a)};return{TAG:l,getConfiguration:function(){var e=i.toRciQueryList(["show.rc.crypto.virtual-ip-server","show.rc.crypto.map","show.rc.user"]);return n.postToRciRoot(e).then(function(e){var n=t.get(e,"[0].".concat("show.rc.crypto.virtual-ip-server"),{}),i=t.get(e,"[1].".concat("show.rc.crypto.map",".").concat(c),{}),a=t.get(i,"virtual-ip.static-ip",{}),o=t.get(e,"[2].".concat("show.rc.user"),{}),s=t.mapValues(o,function(e,n){var i=t.get(e,"tag",[]).includes(l),o=t.get(a,[n,"address"],"");return{error:"",hasAccessSaved:i,hasAccess:i,ipAddress:o,addressIsSaved:Boolean(o)}});return{model:{isEnabled:t.get(i,"enable",!1),isMultiLoginEnabled:t.get(i,"virtual-ip.multi-login.enable",!1),isNatEnabled:t.get(n,"nat",!1),poolStart:t.get(n,"pool-start",""),poolSize:t.get(n,"pool-size",""),dnsServer:t.get(n,"dns-server",""),psk:t.get(n,"psk","")},users:s}})},saveConfiguration:function(e,i){var o,s=(_defineProperty(o={},"enable",e.isEnabled),_defineProperty(o,"nat",e.isNatEnabled),_defineProperty(o,"pool-start",e.poolStart),_defineProperty(o,"pool-size",e.poolSize),_defineProperty(o,"dns-server",e.dnsServer),_defineProperty(o,"psk",e.psk),o),r=t.set({},"crypto.virtual-ip-server",s),p=t.chain(i).map(function(e,t){return Object.assign({},e,{name:t})}).filter(function(e){return e.ipAddress||!e.ipAddress&&e.addressIsSaved}).sortBy(function(e){return e.ipAddress?1:0}).map(function(e){var t=e.ipAddress?{name:c,address:e.ipAddress}:{name:c,no:!0};return _defineProperty({},e.name,t)}).value().map(function(e){return d("virtual-ip.static-ip",e,c)}),u=d("virtual-ip.multi-login",e.isMultiLoginEnabled,c),m=t.map(i,function(e,t){return e.hasAccess?a.getAddTagQuery(t,l):a.getRemoveTagQuery(t,l)}),f=[r].concat(_toConsumableArray(p),[u],_toConsumableArray(m));return n.postAndSave(f)}}}e.$inject=["$q","_","router","utils","usersService","appsPresets"],angular.module("keenetic").factory("virtualIPService",e)}(),function(){function e(e,t,n,i,a,o,s,r,l,c){var d=this;d.appName="virtualIP",d.users={},d.vpnserverL2tpInstalled=Boolean(l["vpnserver-l2tp"]),d.l10n={pskDescriptionChange:r.getTranslation("apps.virtualIP.psk.link-change"),pskDescriptionCancel:r.getTranslation("apps.virtualIP.psk.link-cancel-change"),ipIsNotUnique:r.getTranslation("apps.validation.user-ip-is-not-unique")},d.psk={defined:!1,readonly:!1,description:"",initialValue:"",toggleState:function(){var e=a[0].querySelectorAll('.psk-input input[name="virtualIpPsk"][type=text]'),n=a[0].querySelectorAll(".psk-input .ndm-input__password-icon")[0];d.psk.readonly?(e.length&&t(function(){n.click()}),d.psk.readonly=!1,d.psk.description=d.l10n.pskDescriptionCancel):(d.psk.readonly=!0,d.psk.description=d.l10n.pskDescriptionChange,d.psk.initialValue&&(d.model.psk=d.psk.initialValue))}};var p=function(){d.users=e.mapValues(d.users,function(e){return e.ipAddress?e:Object.assign({},e,{error:""})});var t=e.chain(d.users).pickBy(function(e){return e.ipAddress}).map(function(e,t){return Object.assign({},e,{name:t})}).groupBy("ipAddress").value(),n=_slicedToArray(e.chain(t).partition(function(e){return e.length<2}).map(function(t){return e.flatMap(t,function(t){return e.map(t,"name")})}).value(),2),i=n[0],a=n[1];d.users=e.mapValues(d.users,function(e,t){return i.includes(t)?Object.assign({},e,{error:""}):a.includes(t)?Object.assign({},e,{error:d.l10n.ipIsNotUnique}):e})};d.isUserIpUnique=function(){p()};d.onUserAccessChange=function(){p()},d.addUser=function(e){return o.addTag(e,c.TAG).then(function(){d.users[e]={error:"",hasAccessSaved:!0,hasAccess:!0,ipAddress:"",addressIsSaved:!1}})},d.popup={name:d.appName,isOpened:!1,open:function(){d.popup.isOpened=!0},close:function(){n.$parent.AC.popup.close(),d.isReady=!1},save:function(){c.saveConfiguration(d.model,d.users).then(function(){d.popup.close(),t(function(){return s.success("apps.notification.save")})})},getState:function(){var t=n.$parent.AC.currentPopup===d.appName;return t&&!d.popup.isOpened&&c.getConfiguration().then(function(t){var n=t.model,i=t.users;d.model=n,d.users=i,d.psk.defined=d.vpnserverL2tpInstalled&&Boolean(d.model.psk),d.psk.readonly=d.psk.defined,d.psk.initialValue=String(d.model.psk),d.psk.defined?d.psk.description=d.l10n.pskDescriptionChange:d.psk.description="",e.invoke(d,"form.$setPristine"),d.isReady=!0}).then(d.popup.open),!t&&d.popup.isOpened&&(d.isReady=!1),d.popup.isOpened=t,d.popup.isOpened}}}e.$inject=["_","$timeout","$scope","$location","$document","usersService","notification","utils","components","virtualIPService"],angular.module("keenetic").controller("VirtualIPAppsController",e)}(),function(){function e(e,t,n){return function(){function i(){_classCallCheck(this,i),this.devices=[]}return _createClass(i,[{key:"sumPropertyFromPartitions",value:function(t,n){return e.chain(t).filter(n).sumBy(n).value()}},{key:"setRawData",value:function(t){var n=e.get(t,"show.media",{});return this.devices=[],n&&(this.getDevicesAndPartitionsFromLsData(n),this.generateAppsListsForPartitions(t)),this}},{key:"getDevicesAndPartitionsFromLsData",value:function(n){var i=this,a=e.chain(n).pickBy("partition").map(function(e,t){var n=e.partition;return i.reformatPartitions(n),{type:"storage",id:t,partitions:n}}).value();this.devices=a.map(function(a){var o=e.get(n,"".concat(a.id,".usb"),"");return a.title=a.partitions.map(function(e){return e.name}).join(", "),a.mounted=e.some(a.partitions,function(e){return e.mounted}),a.dirty=e.some(a.partitions,function(e){return e.dirty}),a.total=i.sumPropertyFromPartitions(a.partitions,"total"),a.free=i.sumPropertyFromPartitions(a.partitions,"free"),a.unmount=i.unmountDevice.bind(i,a),a.mount=i.mountDevice.bind(i,a),a.hasMultiplPartitions=a.partitions.length>1,a.mountSinglePartition=i.mountSinglePartition,a.unmountSinglePartition=i.unmountSinglePartition,a.fstype=e.chain(a.partitions).map(function(e){return e.fstype}).uniq().value().join(", ").toUpperCase(),t.extendDeviceWithUsbPortAndVersion(a,o)})}},{key:"mountDevice",value:function(n){return t.togglePartitionsMountedState(e.map(e.filter(n.partitions,function(e){return!e.mounted&&!e.dirty}),function(e){return e.uuid}),!0)}},{key:"unmountDevice",value:function(n){return t.togglePartitionsMountedState(e.map(e.filter(n.partitions,{mounted:!0}),function(e){return e.uuid}),!1)}},{key:"mountSinglePartition",value:function(e){return t.togglePartitionsMountedState([e.uuid],!0)}},{key:"unmountSinglePartition",value:function(e){return t.togglePartitionsMountedState([e.uuid],!1)}},{key:"reformatPartitions",value:function(t){e.forEach(t,function(e){e.dirty="DIRTY"===e.state,e.mounted="MOUNTED"===e.state,e.isSwap="swap"===e.fstype,e.total=Number(e.total),e.free=Number(e.free),e.name=e.isSwap?"SWAP":e.label||e.uuid})}},{key:"generateAppsListsForPartitions",value:function(t){var i=this,a=t.show||{},o=a.rc||{},s={cifs:a.cifs||!1,afp:a.afp||!1,entry:e.get(t,"ls.entry",!1),dlna:o.dlna||!1,ftp:e.get(o,"ip.ftp",{}),sftp:e.get(o,"ip.ssh.sftp",{}),webdav:e.get(o,"ip.http.webdav",{}),users:o.user,torrent:o.torrent||!1,opkg:o.opkg||!1};this.devices=this.devices.map(function(t){return t.partitions=e.chain(t.partitions).map(function(e){return e.apps=i.getStoragePartitionsApps(e,s).map(function(e){return n.getTranslation(e)}),e}).value(),t.apps=e.chain(t.partitions).map("apps").flatMap().uniq().value(),t})}},{key:"getStoragePartitionsApps",value:function(t,n){if(t.isSwap)return["SWAP"];var i=t.uuid,a=t.label,o={},s=function(t){return e.isString(t)&&(0===t.indexOf(i+":")||0===t.indexOf(a+":"))};for(var r in n.dlna.directory||[])s(n.dlna.directory[r].directory||n.dlna.directory[r])&&(o["apps.dlna.card-title"]=1);return s(e.get(n.dlna["db-directory"],"directory",""))&&(o["apps.dlna.card-title"]=1),s(e.get(n.torrent,"directory",""))&&(o["apps.torrent.card-title"]=1),s(e.get(n.opkg,"disk",""))&&(o.OPKG=1),e.forEach(["ftp","sftp","webdav"],function(t){var i,a="apps.private-cloud.protocols.".concat(t),r=(i=t,e.pickBy(n.users,function(t){return e.includes(t.tag,i)}));s(e.get(n[t],"root.directory",""))&&(o[a]=1),o=e.reduce(r,function(t,n,i){return s(e.get(r[i],"home.directory",""))&&(t[a]=1),t},o)}),(n.cifs.share||[]).forEach(function(t){s(e.get(t,"mount",""))&&(o["apps.cifs.card-title"]=1),s(e.get(t,"label",""))&&(o["apps.cifs.card-title"]=1)}),(n.afp.share||[]).forEach(function(t){s(e.get(t,"mount",""))&&(o["apps.afp.card-title"]=1)}),Object.keys(o)}}]),i}()}e.$inject=["_","usbDeviceListService","utils"],angular.module("keenetic").factory("UsbStoragesModel",e)}(),function(){function e(e,t,n){return function(){function i(){_classCallCheck(this,i),this.devices=[]}return _createClass(i,[{key:"setRawData",value:function(t){var n=t.show||{};return this.getPrinterDevicesListFromRawData(e.get(n,"usb",{}),e.get(n,"printers",{})),this}},{key:"getPrinterDevicesListFromRawData",value:function(i,a){this.devices=e.map(a.printer,function(a,o){var s=Object.assign({},a,{},e.get(i,["device",o],{}));return s.id=o,s.protocol=s.type.toUpperCase(),s.type="printer",s.status=n.getPrinterStatus(a),t.extendDeviceWithUsbPortAndVersion(s,e.get(i,["device",o]))})}}]),i}()}e.$inject=["_","usbDeviceListService","PrinterPopupService"],angular.module("keenetic").factory("UsbPrintersModel",e)}(),function(){function e(e,t,n,i,a){return{getData:function(){var o=[];if(n.usb&&n.storage&&o.push("ls"),i.USB_PORTS_NUMBER>0&&n.usb&&n.storage&&o.push("show.media"),n.usb&&o.push("show.usb"),(n.cifs||n.tsmb)&&o.push("show.printers"),(n.cifs||n.tsmb)&&o.push("show.cifs"),n.afp&&o.push("show.afp"),n.dlna&&o.push("show.rc.dlna"),n.ftp&&o.push("show.rc.ip.ftp"),n.sftp&&o.push("show.rc.ip.ssh.sftp"),n.webdav&&o.push("show.rc.ip.http.webdav"),(n.webdav||n.sftp||n.ftp)&&o.push("show.rc.user"),n.transmission&&o.push("show.rc.torrent"),n.opkg&&o.push("show.rc.opkg"),e.isEmpty(o))return a.when({});var s={};return e.forEach(o,function(t){return e.set(s,t,{})}),t.post({url:"",data:s})},togglePartitionsMountedState:function(n,i){if(e.isEmpty(n))return a.when(!0);var o=e.map(n,function(t){return e.set({},"system.mount",{filesystem:t+":",no:!i})});return t.post({url:"",data:o})},extendDeviceWithUsbPortAndVersion:function(t,n){if(n){t.port=e.get(n,"port","");var i=e.get(n,"usb-version","")||e.get(n,"version","");i.length>0&&(i="1"===i[0]?"1.1":"".concat(i[0],".0")),t.usbVersion=i}return t},removePrinter:function(e){return t.post({url:"",data:{printer:{id:e,no:!0}}})},safeEject:function(n){var i=e.set({},"system.eject",{name:n});return t.postToRciRoot(i)}}}e.$inject=["_","router","components","NDM","$q"],angular.module("keenetic").factory("usbDeviceListService",e)}(),function(){t.$inject=["_","components","usbDeviceListService","UsbStoragesModel","UsbPrintersModel","utils","NDM","$state","$timeout","$scope","$rootScope"];var e="app/page/controlPanel/apps/usbDeviceList/";function t(t,n,i,a,o,s,r,l,c,d,p){var u=this;if(u.COMPONENT_ROOT=e,n.usb&&(n.cifs||n.tsmb||n.storage)){var m=s.translatePrefixCtor("usb-device-list"),f=function(e){return"".concat("usb-device-list",".").concat(e)},g=function(){function e(){var t=this;_classCallCheck(this,e),this.device={type:"internal",total:0,free:0,name:m("internal-storage"),uuid:"storage",id:"internalStorage",updateName:function(){t.device.name=m("internal-storage")}}}return _createClass(e,[{key:"setRawData",value:function(e){var n=t.get(e,"ls.entry.storage:",{});return this.device.total=Number(n.total||0),this.device.free=Number(n.free||0),this}}]),e}(),v=new a,h=new o,b=new g,_=function(e){l.go("controlPanel.apps.storage",{uuid:e})},y=new(function(){function e(){_classCallCheck(this,e),this.CONSTS={CLASSES:{PARTITION_NAME:"usb-device-list__partition-name",EXPAND_LINK:"usb-device-list__expand-link",TOGGLE_MOUNT_BTN:"usb-device-list__toggle-mount-btn",FORGET_BTN:"usb-device-list__forget-btn",NO_HR_TR:"usb-device-list__table-tr-no-hr",LINK_TR:"usb-device-list__table-tr-link",NO_HOVER_TR:"usb-device-list__table-tr-not-clickable",UNMOUNTED_TR:"usb-device-list__table-tr-unmounted",LOCKED_TR:"usb-device-list__table-tr-locked",ERROR_TR:"usb-device-list__table-tr-error",FREE_SPACE_LABEL:"usb-device-list__table-free-space-label"},CLASSES_FN_MAP:{EXPAND_LINK:this.onExpandLinkClicked.bind(this),TOGGLE_MOUNT_BTN:this.onToggleMountButtonClicked.bind(this),FORGET_BTN:this.onForgetButtonClicked.bind(this)}},this.list={},this.storages=[],this.printers=[],this.expandedDevices={},this.list={items:[],sortName:"device",locked:!1,loaded:!1,clickOnCell:this.onCellClicked.bind(this),onRowClick:this.onRowClicked.bind(this)},this.list.columns={expandCollapse:{title:" ",width:1,directive:{name:"ndm-icon",options:{"class-name":"usb-device-list__expand-link"}},clickable:!0},icon:{title:" ",width:30,directive:{name:"ndm-icon",options:{"class-name":"usb-device-list__expand-link"}},clickable:!0},title:{title:f("table.device")},fileSystem:{title:f("table.file-system")},apps:{title:f("table.apps")},usbPortAndVersion:{title:f("table.usb-port-and-version")},status:{title:f("table.status")},button:{title:" ",width:180,clickable:!0}},this.list.expandColumns=Object.keys(this.list.columns).slice(0,2)}return _createClass(e,[{key:"onCellClicked",value:function(e,n,i,a){if(!a.device||!a.device.locked)if(t.includes(this.list.expandColumns,i))this.onExpandLinkClicked(a);else{var o=this.CONSTS.CLASSES_FN_MAP;for(var s in o)if(e.target.classList.contains(this.CONSTS.CLASSES[s]))return void o[s](a);this.onRowClicked(a)}}},{key:"onForgetButtonClicked",value:function(e){"printer"===e.device.type&&(e.device.locked=!0,this.lock(),this.redrawTable(),i.removePrinter(e.device.id).then(this.unlock.bind(this)))}},{key:"lock",value:function(){this.list.locked++}},{key:"unlock",value:function(){this.list.locked--,this.list.locked||u.polling()}},{key:"onToggleMountButtonClicked",value:function(e){var t=this;if("storage"===e.device.type){e.device.locked=!0,this.lock(),this.redrawTable();var n=e.device;e.isSinglePartition?(e.isMounted?n.unmountSinglePartition:n.mountSinglePartition)(e.partition).finally(function(){return t.unlock()}):(e.isMounted?n.unmount:n.mount)().then(function(){return t.unlock()})}}},{key:"onExpandLinkClicked",value:function(e){var n=t.get(e,"device.id");n&&(this.expandedDevices[n]=!this.expandedDevices[n],this.redrawTable())}},{key:"onRowClicked",value:function(e){var t,n,i;e.device&&!e.device.locked&&("storage"!==e.device.type?("internal"===e.device.type&&_("internal"),"printer"===e.device.type&&(this.redrawTable(),i=e.device.id,l.go("controlPanel.apps.printer",{id:i}))):e.isDevice?(t=e.device.id,n=e.device.partitions,l.go("controlPanel.apps.device",{mediaId:t,mediaData:{partitions:n}})):e.isSinglePartition&&!e.partition.isSwap&&e.partition.mounted&&_(e.uuid))}},{key:"setDevices",value:function(e,t,n){this.storages=e,this.printers=t,this.internal=n,this.redrawTable()}},{key:"redrawTable",value:function(){var e=this,n=[];t.forEach(this.storages,function(t){return e.pushStorageRows(t,n)}),this.internal.updateName(),this.pushInternalStorageRow(this.internal,n),t.forEach(this.printers,function(t){return e.pushPrinterRow(t,n)}),u.list.items=n,u.list.loaded=!0}},{key:"pushInternalStorageRow",value:function(e,t){var n={};if(n.$$hashKey="internal_"+e.id,n.device=e,n.icon="usbDrive",n.title=e.name,e.total){var i=e.total,a=e.free,o=(i-a)/i*100;n.title+=this.generateMeterHtml(o,!1)+this.generateFreeSpaceLabelHtml(a,i)}t.push(n)}},{key:"pushPrinterRow",value:function(e,t){var n={};n.$$hashKey="printer_"+e.id,n.icon="printer",n.title='<div class="usb-device-list__printer-name">'.concat(e.name,"</div>"),n.status=e.status,n.apps=s.getTranslation("apps.printer-settings-popup.connection-type.".concat(e.protocol.toLowerCase())),n.usbPortAndVersion=this.generatePortAndUsbVersionHtml(e),n.device=e,e.port||(n.button=this.generateButtonHtml("forget",this.CONSTS.CLASSES.FORGET_BTN,e.locked)),t.push(n)}},{key:"pushStorageRows",value:function(e,n){var i=Boolean(this.expandedDevices[e.id])||e.partitions.length<2,a=e.partitions.length,o=0,s=0;t.forEach(e.partitions,function(e){e.dirty||o++,e.mounted||e.dirty||s++});for(var r=!i&&s===o,l=0;l<(i?a:1);l++){var c={},d=e.partitions[l];c.$$hashKey="storage_"+e.id+"_"+d.uuid,c.uuid=d.uuid,c.partition=d,c.device=e;var p="";0===l&&a>1&&(p=i?"arrow-down":"arrow-right"),c.expandCollapse=p,c.icon=0===l?"usbDrive":"",c.trClass=a>1?this.CONSTS.CLASSES.NO_HR_TR:"",d.isSwap&&(c.trClass+=" "+this.CONSTS.CLASSES.NO_HOVER_TR),e.locked&&(c.trClass+=" "+this.CONSTS.CLASSES.LOCKED_TR),c.apps=(i?d:e).apps.join(", ")||"&mdash;";var u=i?d:e,f=u.total,g=u.free,v=(f-g)/f*100,h=i?d.dirty:e.dirty,b=i?d.name:e.partitions.map(function(e){return e.name}).join(", ");c.title=this.generatePartitionNameHtml(b)+this.generateMeterHtml(v,h)+this.generateFreeSpaceLabelHtml(g,f),c.fileSystem=i?d.fstype.toUpperCase():e.fstype,c.usbPortAndVersion=0===l?this.generatePortAndUsbVersionHtml(e):"";var _=i?d:e,y=_.dirty,S=_.mounted,w=void 0;w=y?"dirty":S?"mounted":"disconnected",c.status=m("storage-status."+w),c.isMounted=S,(!i&&r||!S&&!y)&&(c.trClass+=" "+this.CONSTS.CLASSES.UNMOUNTED_TR),h&&i||(c.button=this.generateButtonHtml((c.isMounted?"unmount":"mount")+(i?"":"-all"),this.CONSTS.CLASSES.TOGGLE_MOUNT_BTN,e.locked)),"dirty"===w&&(c.trClass+=" "+this.CONSTS.CLASSES.ERROR_TR),c.isDevice=1===a||!i,c.isSinglePartition=a>1&&i,n.push(c)}}},{key:"generatePartitionNameHtml",value:function(e){return'<span\n                    title="'.concat(e,'"\n                    class="').concat(this.CONSTS.CLASSES.PARTITION_NAME,'"\n                    >\n                    ').concat(e,"\n                </span>")}},{key:"generateFreeSpaceLabelHtml",value:function(e,t){return'<div class="'+this.CONSTS.CLASSES.FREE_SPACE_LABEL+'">'+s.format.size(t-e,!0)+" / "+s.format.size(t,!0)}},{key:"generateMeterHtml",value:function(e){return'<div class="meter meter--rounded'+(arguments.length>1&&void 0!==arguments[1]&&arguments[1]?" meter--error":"")+'"><span style="width: '+e+'%" class="meter__level"></span></div>'}},{key:"generatePortAndUsbVersionHtml",value:function(e){var t=r.USB_PORTS_NUMBER>1?"".concat(s.getTranslation("system.switchports.port-title")," ").concat(e.port,", "):"",n="USB ".concat(e.usbVersion);return e.port&&e.usbVersion?"".concat(t).concat(n):"&mdash;"}},{key:"generateButtonHtml",value:function(e,t){return'<button type="button" class="btn btn--default '+(arguments.length>2&&void 0!==arguments[2]&&arguments[2]?"btn--loading":t)+'">'+m("buttons."+e)+"</button>"}}]),e}()),S=function(){y.redrawTable()};d.$on("destroy",p.$on("$translateChangeSuccess",function(){return c(S)})),u.polling=function(){return"controlPanel.apps"===t.get(l,"current.name")&&(!y.list.locked&&i.getData().then(function(e){if(y.list.locked)return!1;y.setDevices(v.setRawData(e).devices,h.setRawData(e).devices,b.setRawData(e).device)}))},u.list=y.list}}angular.module("keenetic").component("ndmUsbDeviceList",{templateUrl:e+"usbDeviceList.html",bindings:{},replace:!0,controller:t,controllerAs:"vm"})}(),function(){function e(e,t,n,i){var a={timeout:5,port:4022,renewInterval:0};return{getConfiguration:function(){return n.post({url:"",data:{show:{interface:{},rc:{udpxy:{}}}}}).then(function(n){var o,s=n.show,r=s.rc,l=angular.extend({},a,r.udpxy),c=i.getInterfaceOptions(s.interface).filter(function(e){return angular.isDefined(e.global)});return l.renewInterval=r.udpxy["renew-interval"]||a.renewInterval,l.interface?((o=e.find(c,{name:l.interface}))?o=o.id:(o=e.find(c,{id:l.interface}))&&(o=l.interface),o||(o="")):o="",l.interface=o,c.unshift({id:"",label:t.getTranslation("apps.udpxy.form.connect-via-auto-option")}),{defaults:a,model:l,interfaceOptions:c}})},setConfiguration:function(e){var t=e;return t["renew-interval"]=t.renewInterval||a.renewInterval,delete t.renewInterval,""===e.interface&&(t.interface={no:!0}),n.post({url:"",data:[{udpxy:t},n.saveQueryStr().data]})},const:{APP_NAME:"udpxy",HASH:"udpxy"}}}e.$inject=["_","utils","router","interfaces"],angular.module("keenetic").factory("udpxyService",e)}(),function(){function e(e,t,n,i,a,o,s){var r=this;r.appName=s.const.APP_NAME,r.progress=0;r.setDefault=function(e){angular.isDefined(r.defaults[e])&&(r.model[e]=r.defaults[e])},r.popup={name:r.appName,isOpened:!1,open:function(){r.popup.isOpened=!0,n(function(){e.get(r,"form.$setPristine",angular.noop)()})},close:function(){t.$parent.AC.popup.close()},save:function(){e.get(r,"form.$setPristine",angular.noop)(),r.popup.close(),s.setConfiguration(angular.copy(r.model)).then(function(){n(function(){o.success("notifications.saved",1500)})})},isReady:function(){return r.progress>=100},getState:function(){var e=t.$parent.AC.currentPopup===r.appName;return e&&!r.popup.isOpened&&s.getConfiguration().then(function(e){r.interfaceOptions=e.interfaceOptions,r.model=e.model,r.defaults=e.defaults,r.l10n={defaultPort:a.getTranslation("default")+": "+r.defaults.port},r.progress=100}),r.popup.isOpened=e,r.popup.isOpened}}}e.$inject=["_","$scope","$timeout","$location","utils","notification","udpxyService"],angular.module("keenetic").controller("UdpxyAppsController",e)}(),function(){function e(e,t,n,i,a){var o="torrent",s={rpcPort:8090},r={no:!0},l=function(e){var n=t.get(e,"tag",[]);return{tags:n,access:t.includes(n,o)}},c=function(e){return{showRcUser:t.get(e,"[0].".concat("show.rc.user"),{}),showRcTorrent:t.get(e,"[1].".concat("show.rc.torrent"),{})}},d=function(e){var n=e.showRcUser,i=e.showRcTorrent,a=t.get(i,"peer-port.port"),o=t.get(i,"rpc-port.port",s.rpcPort),r=t.get(i,"rpc-port.public"),c=t.get(i,"directory","");return{users:t.mapValues(n,l),torrent:{peerPort:a,rpcPort:o,rpcIsPublic:r,directory:c}}};return{saveConfiguration:function(e,n){var s=t.map(n,function(e,t){return e.access?i.getAddTagQuery(t,o):i.getRemoveTagQuery(t,o)}),l=t.chain({}).set("directory",e.directory||r).set("peer-port.port",e.peerPort).set("rpc-port.port",e.rpcPort).set("rpc-port.public",e.rpcIsPublic).value(),c=[t.set({},"torrent",l)].concat(_toConsumableArray(s));return a.postAndSave(c)},getConfiguration:function(){var e=n.toRciQueryList(["show.rc.user","show.rc.torrent"]);return a.postToRciRoot(e).then(c).then(d)},resetSettingsJson:function(){return a.post(["torrent/reset"])},APP_NAME:"torrent",DEFAULTS:s}}e.$inject=["$q","_","utils","usersService","router"],angular.module("keenetic").factory("torrentService",e)}(),function(){function e(e,t,n,i,a,o,s,r,l){var c=this,d=t.$parent.AC;c.appName=l.APP_NAME,c.defaults=l.DEFAULTS,c.users={},c.model={},c.l10n={};c.setDefault=function(e){i.has(c.defaults,e)&&i.set(c.model,e,i.get(c.defaults,e))};c.actions={addUser:function(e){c.users[e]={tag:[],access:!1}},restoreSettings:function(){return r.confirm("apps.torrent.restore-settings-confirm").then(function(){return l.resetSettingsJson().then(function(){o.info("apps.torrent.restore-settings-success",2e3)})})}},c.popup={name:c.appName,opened:!1,open:function(){c.popup.opened=!0},close:function(){d.popup.close()},save:function(){return l.saveConfiguration(c.model,c.users).then(function(){e(function(){o.success("notifications.saved",1500)}),c.popup.close(),i.invoke(c,"torrentForm.$setPristine")})},ready:function(){return c.progress>=100},getState:function(){var e=d.currentPopup===c.appName;return e&&!c.popup.opened&&l.getConfiguration().then(function(e){var t=e.users,n=e.torrent;c.model=n,c.users=t,c.l10n={defaultRpcPort:"".concat(s.getTranslation("default"),": ").concat(c.defaults.rpcPort)},c.progress=100}),c.popup.opened=e,c.popup.opened}}}e.$inject=["$timeout","$scope","$location","_","usersService","notification","utils","modal","torrentService"],angular.module("keenetic").controller("TorrentAppsController",e)}(),function(){function e(e,t,n,i,a){var o={no:!0},s={FTP:"ftp",SFTP:"sftp",WEBDAV:"webdav"},r={FTP:{port:21,permissive:!1,user:{}},SFTP:{port:22,permissive:!1,user:{}},WEBDAV:{port:443,permissive:!1,user:{}}},l={},c="".concat("show.rc.ip.ssh",".sftp"),d=function(t,n){return e.set({},"service.".concat(t),{no:!n})},p={checkStorage:!1,checkIsEnabled:!1};return{getConfiguration:function(){var o=n.toRciQueryList(["show.rc.user","show.rc.service",a[s.FTP]?"show.rc.ip.ftp":{},a[s.SFTP]?"show.rc.ip.ssh":{},a[s.WEBDAV]?"show.rc.ip.http.webdav":{}]);return i.postToRciRoot(o).then(function(n){var i=Object.assign({},r.FTP,{},e.get(n,"[2].".concat("show.rc.ip.ftp"),{})),a=Object.assign({},r.SFTP,{},e.get(n,"[3].".concat(c),{}),{},e.get(n,"[3].".concat("show.rc.ip.ssh"),{})),o=Object.assign({},r.WEBDAV,{},e.get(n,"[4].".concat("show.rc.ip.http.webdav"),{}));l=e.get(n,"[1].".concat("show.rc.service"),{});var d={ftp:{port:Number(i.port),enabled:Boolean(l.ftp),internetAccess:Boolean(e.get(i,"security-level.public")),anonymousAccess:Boolean(i.permissive),anonymousRootDir:e.get(i,"root.directory","")},sftp:{port:Number(a.port),enabled:Boolean(a.enable&&l.ssh),internetAccess:Boolean(e.get(a,"security-level.public")),ignoreNdmAcl:Boolean(a.permissive),anonymousRootDir:e.get(a,"root.directory","")},webdav:{port:Number(o.port),enabled:Boolean(o.enable),internetAccess:Boolean(e.get(o,"security-level.public")),ignoreNdmAcl:Boolean(o.permissive),anonymousRootDir:e.get(o,"root.directory","")}},p=e.get(n,"[0].".concat("show.rc.user"),{});return{data:d,users:e.mapValues(p,function(n){var i=n.tag||[];return{tag:i,rootDirectory:e.get(n,"home.directory",""),hasPassword:!t.isUserPasswordEmpty(n),ftp:{access:e.includes(i,s.FTP)},sftp:{access:e.includes(i,s.SFTP)},webdav:{access:e.includes(i,s.WEBDAV)}}})}})},saveConfiguration:function(n,r){var c=e.map(r,function(e,n){return t.getHomeDirectoryQuery(n,e.rootDirectory)}),p=[a[s.FTP]?d(s.FTP,e.get(n,"ftp.enabled")):{},a.ssh&&!l.ssh?d("ssh",e.get(n,"sftp.enabled")):{}],u=e.flatMap(r,function(n,i){return e.map(s,function(o){var s="".concat(o,".access"),r=e.get(n,s)?t.getAddTagQuery(i,o):t.getRemoveTagQuery(i,o);return a[o]?r:{}})}),m=[].concat(_toConsumableArray(u),_toConsumableArray(c),[a[s.FTP]?e.set({},"ip.ftp",function(t){return{port:Number(e.get(t,"ftp.port")),permissive:{no:!e.get(t,"ftp.anonymousAccess")},"security-level":_defineProperty({},e.get(t,"ftp.internetAccess")?"public":"private",!0),root:e.get(t,"ftp.anonymousRootDir")?{directory:e.get(t,"ftp.anonymousRootDir")}:o}}(n)):{},a[s.SFTP]?e.set({},"ip.ssh.sftp",function(t){return{enable:{no:!e.get(t,"sftp.enabled")},permissive:{no:!e.get(t,"sftp.ignoreNdmAcl")},root:e.get(t,"sftp.anonymousRootDir")?{directory:e.get(t,"sftp.anonymousRootDir")}:o}}(n)):{},a.ssh?e.set({},"ip.ssh",function(t){return{port:Number(e.get(t,"sftp.port")),"security-level":_defineProperty({},e.get(t,"sftp.internetAccess")?"public":"private",!0)}}(n)):{},a[s.WEBDAV]?e.set({},"ip.http.webdav",function(t){return{enable:{no:!e.get(t,"webdav.enabled")},permissive:{no:!e.get(t,"webdav.ignoreNdmAcl")},"security-level":_defineProperty({},e.get(t,"webdav.internetAccess")?"public":"private",!0),root:e.get(t,"webdav.anonymousRootDir")?{directory:e.get(t,"webdav.anonymousRootDir")}:o}}(n)):{}],p).filter(function(t){return!e.isEmpty(t)});return i.postAndSave(m)},getNewUserData:function(){return{tag:[],rootDirectory:"",hasPassword:!1,ftp:{access:!1},sftp:{access:!1},webdav:{access:!1}}},enableUserTags:function(e,n){var a=n.map(function(n){return t.getAddTagQuery(e,n)});return i.postAndSave(a)},toggleState:function(t){return i.postAndSave(function(t){var n=[];return a.sftp&&(n.push(e.set({},"ip.ssh.sftp",{enable:t})),t&&n.push(e.set({},"service.ssh",{enabled:!0}))),a.ftp&&n.push(e.set({},"service.ftp",t?{enabled:!0}:o)),a.webdav&&n.push(e.set({},"ip.http.webdav",{enable:t})),n}(t))},getPrivateCloudServiceStatus:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=t.name,a=t.users,o=t.anonAccess,r=Object.assign({},p,{},n),l=r.checkStorage,c=r.checkIsEnabled;return l&&t.noStorage?"apps.no-usb-storage":c&&!t.enable?"apps.disabled":i!==s.WEBDAV&&o?"apps.anon-access-granted":i===s.WEBDAV&&e.isArray(a)&&a.every(function(e){return!e.hasPassword})?"apps.private-cloud.webdav.all-users-without-password":a?"apps.access-granted":"apps.access-restricted"},getPrivateCloudDescription:function(t,i){var a,o=e.filter(t,function(e){return[e.component,e.isInstalled].includes(!0)}),s={1:"".concat(i,".private-cloud-description-one"),2:"".concat(i,".private-cloud-description-two"),3:"".concat(i,".private-cloud-description-three")}[o.length],r=function(t,n){return{webdav:"apps.private-cloud.protocols.webdav",sftp:"apps.private-cloud.protocols.sftp",ftp:"apps.private-cloud.protocols.ftp"}[e.get(t,n)]};return n.getTranslation(s,null,(a=o,{protocolOne:n.getTranslation(r(a,"[0].name")),protocolTwo:n.getTranslation(r(a,"[1].name")),protocolThree:n.getTranslation(r(a,"[2].name"))}))},APP_NAME:"private-cloud",DEFAULT_CONFIG:r,TAGS:s,INTERNET_ACCESS_ENABLED_PROP:"security-level.public"}}e.$inject=["_","usersService","utils","router","components"],angular.module("keenetic").factory("privateCloudService",e)}(),function(){function e(e,t,n,i,a,o,s,r,l,c,d,p){var u=this;u.WEBDAV_PORT=443,u.ACL_COMPONENT_INSTALLED=a.has(c,"acl"),u.appName=l.APP_NAME,u.form={},u.progress=0,u.keendnsStatusPoller=null,u.webdavWarning={isVisible:!1,show:function(){u.webdavWarning.isVisible=!0},hide:function(){u.webdavWarning.isVisible=!1}},u.model={internetAccess:{sftp:!1,ftp:!1,webdav:!1}},u.model.keenDnsLink="",u.model.hasKeenDns=!1,u.users={};var m=!1;u.protocolsList=[{name:"webdav",isInstalled:a.has(c,"webdav")},{name:"sftp",isInstalled:a.has(c,"sftp")},{name:"ftp",isInstalled:a.has(c,"ftp")}],u.description=l.getPrivateCloudDescription(u.protocolsList,"apps.private-cloud.popup"),u.protocols=u.protocolsList.reduce(function(e,t){return Object.assign({},e,_defineProperty({},t.name,t.isInstalled))},{});u.refreshForm=function(){a.forEach(u.users,function(e,t){var n=!0;m=!1;var i=!1;a.forEach(u.protocols,function(e,a){var o=u.users[t][a];if(e){var s=Boolean(u.model[a].anonymousAccess);n=n&&s,m=m||s,s&&!o.isAnonymous?(o.__accessOrig=o.access,o.access=!0,o.isAnonymous=!0):!s&&o.isAnonymous?(o.access=Boolean(o.__accessOrig),o.isAnonymous=!1):s||(o.__accessOrig=o.access),i=i||o.access&&!s}else o.access=!1}),e.usingAnonymousFolder=n})};var f=function(){a.set(u.model,"ftp.error",""),a.set(u.model,"sftp.error",""),a.set(u.model,"webdav.error","")};u.comparePortValues=function(){f(),e(function(){var e=a.chain(u.protocols).keys().groupBy(function(e){return u.model[e].port}).pickBy(function(e){return e.length>1}).values().flatten().value();a.forEach(e,function(e){u.model[e].error="apps.private-cloud.port-error"})})},u.showSftpWarning=function(e){var t=s.getTranslation("apps.private-cloud.sftp-warning");e&&!u.sshInternetAccess&&d.confirm(t).then(a.noop,function(){u.model.internetAccess.sftp=!1})};var g=function(e){var t=function(e){var t=!a.get(e,"noComponent",!1);if(!t)return{isKeenDnsInstalled:t,keenDnsAvailable:!1,keenDnsLink:""};if(e.noNdssAccess)return{isKeenDnsInstalled:t,keenDnsAvailable:!1,keenDnsLink:"apps.private-cloud.webdav-no-ndss-access"};var n=e.name,i=e.domain,o=n&&i;return{isKeenDnsInstalled:t,keenDnsAvailable:o,keenDnsLink:o?"https://".concat(n,".").concat(i,"/webdav/"):s.getTranslation("apps.private-cloud.webdav-keendns-page-link",null,s.l10n.getLinkChunks("ref",{"ui-sref":"controlPanel.remoteAccess({tab: 'KeenDNS'})",class:"ref-link"}))}}(e),n=t.isKeenDnsInstalled,i=t.keenDnsLink,o=t.keenDnsAvailable;u.model.isKeenDnsInstalled=n,u.model.keenDnsLink=i,u.model.keenDnsAvailable=o},v=function(){return i.all([l.getConfiguration(),p.getConfiguration()]).then(function(e){var n=_slicedToArray(e,2),i=n[0],o=n[1],s=i.users,r=i.data;u.model=r,u.users=Object.assign({},s),u.model.internetAccess={sftp:!1,ftp:!1,webdav:!1},g(o),a.forEach(u.protocols,function(e,t){u.model.internetAccess[t]=r[t].internetAccess||!e}),u.sshInternetAccess=u.model.internetAccess.sftp,u.keendnsStatusPoller=t(function(){return p.getConfiguration().then(g)},5e3),f(),u.refreshForm(),a.invoke(u,"form.$setPristine")})};u.actions={addUser:function(e,t){if(u.users[e]=l.getNewUserData(),u.users[e].hasPassword=Boolean(t),m){var n=a.chain(u.protocols).pickBy(function(e,t){return e&&u.model[t].anonymousAccess}).keys().value();l.enableUserTags(e,n)}u.refreshForm()},changeFolder:function(e){r({selectedPath:u.users[e].rootDirectory||"",folderSelect:!0,removableOnly:!0}).then(function(t){u.users[e].rootDirectory=t})},resetFolder:function(e){u.users[e].rootDirectory=""}},u.popup={name:u.appName,opened:!1,open:function(){u.popup.opened=!0},close:function(){u.popup.opened=!1,t.cancel(u.keendnsStatusPoller),n.$parent.AC.popup.close()},ready:function(){return u.progress>=100},save:function(){var t,n;(t=a.cloneDeep(u.users),n={},a.forEach(u.protocols,function(e,t){e&&(n[t]=u.model[t],n[t].internetAccess=u.model.internetAccess[t])}),l.saveConfiguration(n,t)).then(function(){e(function(){return o.success("notifications.saved",1500)}),u.popup.close()})},getState:function(){var e=n.$parent.AC.currentPopup===u.appName;return e&&!u.popup.opened&&(u.progress=0,v().then(function(){u.progress=100})),u.popup.opened=e,u.popup.opened}}}e.$inject=["$timeout","$interval","$scope","$q","_","notification","utils","fsBrowser","privateCloudService","components","modal","keendnsService"],angular.module("keenetic").controller("PrivateCloudController",e)}(),function(){function e(e,t,n,i,a){var o=a.getApps().kabinet.service,s=["1","2"],r=["lan","internet"],l={no:!0},c={password:"",serverAddress:"",setAccessLevel:!1,accessLevel:r[1],protocolVersion:s[1],interface:"any"};return{getConfiguration:function(){var a={interface:{},rc:_defineProperty({},o,{})};return n.post({url:"",data:{show:a}}).then(function(n){var a,s=n.show,r=s.rc[o]||{},l=i.getInterfaceOptions(s.interface).filter(function(e){return e.global});l.unshift({id:"any",label:t.getTranslation("apps.kabinet.form.connect-via-any")}),r.interface&&((a=e.find(l,{name:r.interface}))?a=a.id:(a=e.find(l,{id:r.interface}))&&(a=r.interface));var d=e.get(r,"access-level.level"),p={password:r.password,serverAddress:e.get(r,"server.address"),setAccessLevel:Boolean(d),accessLevel:d,protocolVersion:e.get(r,"protocol-version.version"),interface:a};return e.forEach(c,function(e,t){angular.isUndefined(p[t])&&(p[t]=e)}),{data:p,interfaceOptions:l}})},setConfiguration:function(t){var i={password:t.password||l};return t.serverAddress&&(i.server={address:t.serverAddress}),e.set(i,"access-level",t.setAccessLevel?{level:t.accessLevel}:l),e.set(i,"protocol-version.version",t.protocolVersion),i.interface="any"===t.interface?l:t.interface,n.post({url:"",data:[_defineProperty({},o,i),n.saveQueryStr().data]})},const:{APP_NAME:"kabinet",HASH:"kabinet",SERVICE_NAME:o,PROTOCOL_VERSIONS:s,ACCESS_LEVELS:r}}}e.$inject=["_","utils","router","interfaces","appsPresets"],angular.module("keenetic").factory("kabinet",e)}(),function(){function e(e,t,n,i,a,o,s){var r=this;r.appName=s.const.APP_NAME,r.isReady=!1,r.uiIsLocked=!1,r.options={protocolVersion:a.idsToOptions(s.const.PROTOCOL_VERSIONS,angular.identity),accessLevel:a.idsToOptions(s.const.ACCESS_LEVELS,a.translatePrefixCtor("apps.kabinet.access-level"))};var l=function(){return i.get(r,"form.$setPristine",angular.noop)()};r.popup={name:r.appName,isOpened:!1,open:function(){r.popup.isOpened=!0},close:function(){return n.$parent.AC.popup.close()},save:function(){return r.popup.close(),s.setConfiguration(angular.copy(r.data)).then(function(){e(function(){return o.success("notifications.saved",1500)})})},getState:function(){var t=n.$parent.AC.currentPopup===r.appName;return t&&!r.popup.isOpened&&(e(l),r.uiIsLocked=!0,s.getConfiguration().then(function(e){r.options.interface=e.interfaceOptions,r.data=e.data,l(),r.isReady=!0}).finally(function(){e(function(){r.uiIsLocked=!1})})),r.popup.isOpened=t,r.popup.isOpened}}}e.$inject=["$timeout","$location","$scope","_","utils","notification","kabinet"],angular.module("keenetic").controller("KabinetAppsController",e)}(),function(){function e(e,t,n,i,a,o,s,r,l){var c={no:!0},d={ANY:"any",AUDIO:"audio",VIDEO:"video",IMAGES:"images"},p=l.createRequester();p.setQueryOptions({noRetry:!0}),p.setPollInterval(2e3);var u=function(t,n){var i=!t.mounted||!t.found;return{path:n,mediaType:e.get(t,"media-type",d.ANY),doesNotExist:i}},m=function(e){return{directory:e.path,"media-type":e.mediaType===d.ANY?"":e.mediaType}},f=function(t){var n=e.get(t,"directory",{}),i=e.map(n,u),a=e.get(t,"db",{}),o=a.name;return{directoryList:i,dbDirectory:{path:o,doesNotExist:u(a,o).doesNotExist}}},g=function(t){var n=t.directoryList.length>0?t.directoryList.map(m):c,i=t.dbDirectory.path?{directory:t.dbDirectory.path}:c;return[e.set({},"directory",n),e.set({},"db-directory",i)].map(function(t){return e.set({},"dlna",t)})};return{MEDIA_TYPE:d,SHOW_DLNA:"show.dlna",requester:p,getConfiguration:function(){var n=o.toRciQueryList(["show.version","show.dlna","show.rc.dlna","show.rc.interface"]);return r.postToRciRoot(n).then(function(n){var i=e.get(n,"[0].".concat("show.version"),{}),o=e.get(n,"[1].".concat("show.dlna"),{}),s=e.get(n,"[2].".concat("show.rc.dlna"),{}),r=e.get(n,"[3].".concat("show.rc.interface"),{}),l="".concat(i.vendor," ").concat(i.device),c=e.get(s,"display-name",l),d=e.get(s,"port",8200),p=e.get(s,"interface",[]),u=e.chain(p).map(function(t){return e.has(r,t)?t:e.findKey(r,function(e){return e.rename===t})}).filter().value(),m=f(o),g=m.directoryList,v={displayName:c,port:d,selectedSegments:u,dbDirectory:m.dbDirectory,directoryList:g},h={port:8200,displayName:l};return t.all([t.when(v),t.when(h),a.getSegments(r)])}).then(function(t){var n=_slicedToArray(t,3),i=n[0],a=n[1],o=n[2],s=e.chain(o).map(function(t,n){return{id:n,label:t.description,checked:e.includes(i.selectedSegments,n)}}).value();return{dlnaConfiguraton:i,defaults:a,segmentOptions:s}})},getDlnaStatusQueries:function(){return o.toRciQueryList(["show.dlna"])},getDirectoriesConfiguration:f,updateDirectories:function(e){var t=g(e);return r.postAndSave(t)},saveConfiguration:function(t,n,i){var a=n.filter(function(n){return!e.includes(t.selectedSegments,n)}),o=t.selectedSegments,s=a.map(function(e){return{interface:e,no:!0}}),l=o.map(function(e){return{interface:e}}),d=[].concat(_toConsumableArray(s),_toConsumableArray(l)),p=[e.set({},"directory",c),e.set({},"port",t.port),e.set({},"display-name",t.displayName),e.set({},"interface",d)],u=g(t),m=p.map(function(t){return e.set({},"dlna",t)}),f=i?e.set({},"service.dlna",{no:!1}):{},v=[].concat(_toConsumableArray(m),_toConsumableArray(u),[f]);return r.postAndSave(v)},rescanDb:function(){return r.post(e.set({},"dlna.rescan",{full:""}))}}}e.$inject=["_","$q","$http","$timeout","interfaces","utils","appsService","router","requesterFactory"],angular.module("keenetic").factory("dlnaService",e)}(),function(){function e(e,t,n,i,a,o,s,r,l,c,d){var p=this,u=d.MEDIA_TYPE,m=d.SHOW_DLNA,f=n.$parent.AC;p.appName="dlna",p.rescanStatus="",p.rescanInProgress=!1;var g=function(){p.l10n={defaultValue:e.mapValues(p.defaults,function(e){return r.getTranslation("default-value",null,{value:e})}),scanning:r.getTranslation("apps.dlna.scanning")}},v=function(){return e.invoke(p,"dlnaForm.$setPristine")},h=function(){e.invoke(p,"dlnaForm.$setDirty"),p.dlnaForm.modified=!0};n.$on("destroy",i.$on("$translateChangeSuccess",function(){return t(g)})),p.contentTypes=[u.ANY,u.AUDIO,u.VIDEO,u.IMAGES].map(function(e){return{id:e,name:"apps.dlna.content-types.".concat(e)}}),p.setDefault=function(t){e.has(p.defaults,t)&&e.set(p.model,t,e.get(p.defaults,t))};p.actions={rescanAll:function(){d.rescanDb().then(function(){p.rescanInProgress=!0,d.requester.poll()})},addNewFolder:function(){l({folderSelect:!0,removableOnly:!0}).then(function(e){p.model.directoryList.push({path:e,mediaType:u.ANY}),p.model.dbDirectory.path||(p.model.dbDirectory.path=e),h(),d.updateDirectories(p.model).then(function(){return d.requester.poll()})})},changeDbDirectory:function(){l({selectedPath:p.model.dbDirectory.path,folderSelect:!0,removableOnly:!0}).then(function(e){p.model.dbDirectory.path=e,d.updateDirectories(p.model).then(function(){return d.requester.poll()})})},dropDir:function(e){p.model.directoryList.splice(e,1),h(),d.updateDirectories(p.model)}},p.popup={name:p.appName,isOpened:!1,open:function(){p.popup.isOpened=!0},close:function(){p.progress=0,d.requester.stopPolling(),d.requester.clearCallbacks(),f.popup.close()},cancel:function(){d.updateDirectories(p.modelOnLoad).then(function(){return p.popup.close()})},save:function(){var e=f.apps[p.appName].notConfigured;d.saveConfiguration(p.model,p.segmentsSelectedOnLoad,e).then(function(){t(function(){s.success("notifications.saved",1500)}),v(),p.dlnaForm.modified=!1,f.popup.close()})},ready:function(){return p.progress>=100},getState:function(){var n=f.currentPopup===p.appName;return n&&!p.popup.isOpened&&d.getConfiguration().then(function(n){p.model=n.dlnaConfiguraton,p.modelOnLoad=angular.copy(p.model),p.defaults=n.defaults,p.segmentOptions=n.segmentOptions,p.segmentsSelectedOnLoad=angular.copy(p.model.selectedSegments),g(),d.requester.registerCallback(d.getDlnaStatusQueries(),function(t){var n=e.get(t,"[0].".concat(m),{});n.scanning?(p.rescanInProgress=!0,p.rescanStatus=p.l10n.scanning+": "+n.scanning):(p.rescanInProgress=!1,p.rescanStatus="");var i=d.getDirectoriesConfiguration(n),a=i.directoryList,o=i.dbDirectory;p.model.dbDirectory.doesNotExist=o.doesNotExist,p.model.directoryList=p.model.directoryList.map(function(t){var n=e.find(a,function(e){return e.path===t.path});if(!n)return t;var i=n.doesNotExist;return Object.assign({},t,{doesNotExist:i})})}),d.requester.startPolling(),v(),t(function(){p.progress=100})}),!n&&p.popup.isOpened&&(d.requester.stopPolling(),d.requester.clearCallbacks()),p.popup.isOpened=n,p.popup.isOpened}}}e.$inject=["_","$timeout","$scope","$rootScope","$location","usersService","notification","utils","fsBrowser","appsService","dlnaService"],angular.module("keenetic").controller("DlnaAppsController",e)}(),function(){function e(e,t,n,i,a,o){var s=o.getApps().cifs,r=s.tag,l=s.printersTag,c=function(e,t,n,i){return e[n]?a.getAddTagQuery(t,i):a.getRemoveTagQuery(t,i)};return{constants:{APP_NAME:"cifs",TAG:r,PRINTERS_TAG:l},getDefaultUserModel:function(){return{access:!1,printersAccess:!1,tags:[],accessNotSaved:!0,printersAccessNotSaved:!0}},getConfiguration:function(){var t={};return e.set(t,"show.cifs",{}),e.set(t,"show.rc.system",{}),e.set(t,"show.rc.user",{}),e.set(t,"show.rc.service",{}),n.post({url:"",data:t}).then(function(t){var a=e.get(t,"show.cifs",{}),o=e.get(t,"show.rc.system",{}),c=Boolean(e.get(t,"show.rc.service",{})[s.service]),d=e.mapValues(e.get(t,"show.rc.user",{}),function(t){var n=(t.tag||[]).slice(),i=e.includes(n,r),a=e.includes(n,l);return{access:i,printersAccess:a,tags:n,accessNotSaved:!i,printersAccessNotSaved:!a}}),p=Boolean(i.tsmb),u=o.hostname,m=o.domainname,f=Object.assign({},{share:[],permissive:!1,automount:!1},{},a,{isEnabled:c,hostname:u,domainname:m,timemachineFlagIsAvailable:p});return f.share=f.share.map(function(e){var t=a.enabled&&!e.active;return Object.assign({},e,{notFound:t})}),f.enabled?{users:d,model:f}:n.post({url:"ls",silent:!0,data:f.share.map(function(e){return{directory:e.mount}})}).then(function(t){return f.share=f.share.map(function(n,i){var a="error"===e.get(t,[i,"status",0,"status"]);return Object.assign({},n,{notFound:a})}),{users:d,model:f}})})},saveConfiguration:function(t,i){var a=e.pickBy(i,function(e){return e.access===e.accessNotSaved}),o=e.pickBy(i,function(e){return e.printersAccess===e.printersAccessNotSaved}),s=e.map(a,function(e,t){return c(e,t,"access",r)}),d=e.map(o,function(e,t){return c(e,t,"printersAccess",l)}),p=e.set({},"cifs.share",{no:!0}),u=t.domainname,m=t.hostname,f=e.set({},"system",{domainname:u,hostname:m}),g=t.share.map(function(e){var n=e.label,i=e.mount,a=e.timemachine;return t.timemachineFlagIsAvailable?{label:n,mount:i,timemachine:a}:{label:n,mount:i}}),v={cifs:{permissive:{no:!t.permissive},automount:{no:!t.automount},share:g}};return n.postAndSave([].concat(_toConsumableArray(s),_toConsumableArray(d),[p,f,v]))}}}e.$inject=["_","utils","router","components","usersService","appsPresets"],angular.module("keenetic").factory("cifsService",e)}(),function(){function e(e,t,n,i,a,o,s,r,l){var c=this;c.appName=l.constants.APP_NAME,c.model={},c.users={};var d=function(){i.get(c,"form.$setDirty",angular.noop)(),c.form&&(c.form.modified=!0)},p=function(){i.get(c,"form.$setPristine",angular.noop)(),i.set(c,"form.modified",!1)};c.isShareLabelUnique=function(){i.forEach(i.groupBy(c.model.share,"label"),function(e){e.forEach(function(t){t.error=e.length>1?"apps.share-label-should-be-unique":""})})};var u=function(e){return Object.assign({},l.getDefaultUserModel(),{},e)};c.actions={addUser:function(e){return a.getUser(e).then(function(t){c.users[e]=u(t)})},addNewShare:function(){r({folderSelect:!0,removableOnly:!0}).then(function(e){if(i.find(c.model.share,{mount:e}))o.error("apps.share-mount-should-be-unique",1500);else{var t,n=e.split("/");if(0===n.length)t=e.split(":")[0];else{var a=n.length-1;""===n[a]&&a--,t=n[a]}c.model.share.push({mount:e,label:t.replace(":","")}),d()}})},dropShare:function(e){c.model.share.splice(e,1),d()},onClickPrinterAccess:function(e){var t=c.users[e];t.printersAccess?t.access=!0:i.get(c,"form.cifs-access__".concat(e,".$pristine"))&&t.accessNotSaved&&(t.access=!1)}},c.popup={name:c.appName,opened:!1,isLocked:!1,open:function(){c.popup.opened=!0},close:function(){return t.$parent.AC.popup.close()},save:function(){var t=c.popup;if(!t.isLocked){var n=angular.copy(c.model),i=angular.copy(c.users);t.isLocked=!0,l.saveConfiguration(n,i).then(function(){p(),c.popup.close(),e(function(){t.isLocked=!1,o.success("notifications.saved",1500)})})}},ready:function(){return c.progress>=100},getState:function(){var n=t.$parent.AC.currentPopup===c.appName;return n&&!c.popup.opened&&l.getConfiguration().then(function(t){c.model=t.model,c.users=i.mapValues(t.users,u),c.progress=100,e(function(){p(),c.popup.isLocked=!1})}).then(p),c.popup.opened=n,c.popup.opened}}}e.$inject=["$timeout","$scope","$location","_","usersService","notification","utils","fsBrowser","cifsService"],angular.module("keenetic").controller("CifsAppsController",e)}(),function(){function e(e,t,n,i,a,o){var s=o.getApps().afp.tag,r=function(t){var n=e.get(t,"tag",[]);return{access:e.includes(n,s),tags:n}};return{APP_NAME:"afp",prepareUserModel:r,getConfiguration:function(){var i=n.toRciQueryList(["ls","show.afp","show.rc.user","show.rc.system"]);return t.postToRciRoot(i).then(function(t){var n=e.get(t,"[0].".concat("ls"),{}),i=e.get(t,"[1].".concat("show.afp"),{}),o=e.get(t,"[2].".concat("show.rc.user"),{}),s=e.get(t,"[3].".concat("show.rc.system"),{}).hostname,l=Object.assign({},{share:[],permissive:!1,automount:!1},{},i,{hostname:s}),c=e.mapValues(o,r);return l.share=l.share.map(function(e){var t=a.getVolumeName(e.mount),i=a.isVolumeMounted(t,n);return Object.assign({},e,{exists:i})}),{model:l,users:c}})},saveConfiguration:function(n,a){var o=e.map(a,function(e,t){return e.access?i.getAddTagQuery(t,s):i.getRemoveTagQuery(t,s)}),r=e.set({},"afp.share",{no:!0}),l=e.set({},"system.hostname",n.hostname),c={afp:{permissive:{no:!n.permissive},automount:{no:!n.automount},share:n.share}};return t.postAndSave([].concat(_toConsumableArray(o),[r,l,c]))}}}e.$inject=["_","router","utils","usersService","appsService","appsPresets"],angular.module("keenetic").factory("afpService",e)}(),function(){function e(e,t,n,i,a,o,s,r,l){var c=this,d=t.$parent.AC;c.appName=l.APP_NAME,c.users={};var p=function(){i.invoke(c,"form.$setDirty"),c.form&&(c.form.modified=!0)},u=function(){i.invoke(c,"form.$setPristine"),c.form&&(c.form.modified=!1)};c.isShareLabelUnique=function(){i.forEach(i.groupBy(c.model.share,"label"),function(e){e.forEach(function(t){t.error=e.length>1?"apps.share-label-should-be-unique":""})})},c.actions={addUser:function(e){o.getUser(e).then(function(t){c.users[e]=l.prepareUserModel(t)})},addNewShare:function(){r({folderSelect:!0,removableOnly:!0}).then(function(e){if(i.find(c.model.share,{mount:e}))s.error("apps.share-mount-should-be-unique",1500);else{var t=e.split("/").slice(-1)[0],n=e.split(":")[0],a=(t||n).replace(":","");c.model.share.push({mount:e,label:a,exists:!0}),p()}})},dropShare:function(e){c.model.share.splice(e,1),p()}},c.popup={name:c.appName,opened:!1,isLocked:!1,open:function(){c.popup.opened=!0},close:function(){d.popup.close()},save:function(){var t=c.popup;t.isLocked||(t.isLocked=!0,l.saveConfiguration(c.model,c.users).then(function(){t.close(),u(),e(function(){s.success("notifications.saved",1500),t.isLocked=!1})}))},ready:function(){return c.progress>=100},getState:function(){var e=d.currentPopup===c.appName;return e&&!c.popup.opened&&l.getConfiguration().then(function(e){var t=e.model,n=e.users;c.model=t,c.users=n,c.progress=100,u()}),c.popup.opened=e,c.popup.opened}}}e.$inject=["$timeout","$scope","$location","_","appsService","usersService","notification","fsBrowser","afpService"],angular.module("keenetic").controller("AfpAppsController",e)}(),function(){function e(e,t,n,i,a,o,s,r,l,c,d,p,u,m,f,g){var v,h,b=a.PORTS_MAP[a.ETHER_WAN_PORT],_=i.get(a,"profile.features.dsl"),y=a.DSL,S=f.getEncapsulationSelectOptions().map(function(e){return e.id}),w=f.USBDSL_ADSL_OPMODE,C=f.DSL_ADSL_AUTO_OPMODE,E=f.VDSL_CLIENT_OPMODE,I=f.DSL_BAD_LINE_STATUSES,T={ethernet:a.WAN,usbdsl:f.USBDSL_IFACE,yotaOne:"YotaOne0",yota:"Yota0",pptp:"PPTP0",pppoe:"PPPoE0",l2tp:"L2TP0"},k={ethernet:"Broadband connection","3g":"Wireless modem","dsl-isp":_?"Broadband connection":"DSL connection"},P=o.USB_MODEM_IFACE_TYPES,A={no:!1},D={no:!0},O=l.saveQueryStr().data,N=function(t){var n=e.defer();return l.post({url:"interface/ipoe",data:t,noRetry:!0}).then(function(e){e.ndmErrors?n.reject(e.ndmErrors):n.resolve(e["next-name"])},n.reject),n.promise},L=(v="Pvc",function(){return l.get("interface").then(function(e){var t=[];return i.forEach(e,function(e,n){-1!==n.indexOf(v)&&(e.id=n,t.push(e))}),t})}),x=function(e){return{interface:{name:e,igmp:{upstream:!0,downstream:!1}}}},R=function(){return l.get("interface").then(function(e){var t;if(i.forEach(e,function(e,n){i.get(e,"igmp.upstream")&&(t=n)}),t)return l.post({url:"",data:{interface:{igmp:{name:t,upstream:!1}}}})})},M=function(e,t,n){var i={interface:{}};return e=n?angular.merge(e,{description:n}):e,i.interface[t]=e,i},$=function(e){return M(D,e)},F=function(e,t){return{description:t||e.description||"",ip:{global:{order:0}}}},V=function(e){if(!e.ip)return{};var t=e.ip.mode||"auto",n={address:function(e,t){switch(e){case"none":return[D,{dhcp:!1}];case"auto":return[D,{dhcp:!0}];default:return[{dhcp:D},{address:t.ip.address,mask:t.ip.mask}]}}(t,e)};return n["name-server"]=!!e.ip.dns&&[e.ip.dns],"static"===t&&e.ip.gateway&&(n.gateway=e.ip.gateway),{ip:n}},U=function(e,t,n,a,s){var r=[];return e.tunnel?(t.ip.global=D,r.push(M(t,n,s)),r.push(M(function(e,t){var n=i.get(e,"tunnel.settings",{}),a=e.tunnel.type,s={description:e.description||"",ip:{global:{order:0},tcp:{"adjust-mss":{pmtu:!0}},address:D},role:[o.INTERFACE_ROLE.INET],connect:{via:t},authentication:{identity:n.login,password:n.password},up:!0};if("pppoe"===a){var r=n.pppoe;delete s.ip.address.dhcp,r.service&&(s.pppoe={service:r.service}),r.acname&&(s.peer=r.acname)}else s.peer=n.server,"pptp"===a&&(s.encryption={mppe:{no:!n.mppe}});return s}(e,n),a,s))):r.push(M(t,n,s)),r},B=[],W={hasUpdates:"hasUpdates",hasNoUpdates:"hasNoUpdates",notRecommendedComponents:"notRecommendedComponents",connectionError:"connectionError"},H=function(){return{status:W.connectionError,recommended:null,error:null}};return{constants:{DEFAULT_IFACE_NAMES:T,IS_DSL_DEVICE:_,INTERNAL_DSL_IFACE_ID:y,DSL_ENCAPSULATION_OPTIONS:S,VDSL_CLIENT_OPMODE:E,DSL_ADSL_AUTO_OPMODE:C,USBDSL_ADSL_OPMODE:w,DEFAULT_DESCRIPTIONS:k},getBusyVlans:function(){return l.get("interface").then(function(e){var t=[a.LAN_VID];return i.forEach(e,function(e){if(e.rename===a.LAN){var n=i.get(e,"iseg.busy-vlan","").split(",").filter(angular.identity).map(Number);t=t.concat(n)}}),t})},getIfaceConfig:function(e){return l.get("interface?name="+e).then(function(t){return t[e]})},getAllPvcIfaces:L,getDslCapabilities:function(e){return l.get("show/interface/dsl/capabilities?name="+e).then(function(e){var t={};return i.forEach(e,function(e,n){t[e.category]||(t[e.category]=[]),e.id=n,t[e.category].push(e)}),{data:e,byCategory:t}})},initEzconfig:function(){return l.postAndSave({easyconfig:{check:{period:15,"max-fails":{count:4}}}})},disableEasyconfig:function(){return l.postAndSave(i.set({},"easyconfig.disable",A))},phyCheck:function(){var e={ethernet:!1},t={},n=function(t,n){r[t]&&(angular.isArray(n)?n.forEach(function(t){e[t]=!1}):e[t]=!1)};["adsl","vdsl","dsl"].forEach(n),r.usbmodem&&(n("usbmodem",["3g"]),n("usblte",["lte"]),n("usbnet",["yota","yotaOne","cdcEthernet"]),n("usbdsl"));var o=_;return l.get("show/interface").spread(function(n){return i.forEach(n,function(n,i){o=o||i===a.WAN,a.HAS_TWO_SWITCHES?i===a.WAN&&(e.ethernet="up"===n.port.link,t.ethernet=i):i===a.LAN_SWITCH&&(e.ethernet="up"===n.port[b.port].link,t.ethernet=_?a.PORTS_MAP[a.ETHER_WAN_PORT].port:a.WAN),a.BUILT_IN_LTE&&i===a.LTE_DEVICE&&(e.lteBuiltIn=1,t.lteBuiltIn=i);var s=function(n,i,a,o){a.type===n&&angular.isDefined(e[i])&&(e[i]="yes"===a.plugged,t[i]=o)};e.yotaOne||e.yota||e.cdcEthernet||e.lte||(s("UsbModem","3g",n,i),s("Yota","yota",n,i),s("YotaOne","yota",n,i),s("CdcEthernet","cdcEthernet",n,i),s("UsbLte","lte",n,i)),r.usbdsl&&i===T.usbdsl&&(e.usbdsl="yes"===n.plugged,t.usbdsl=i)}),_&&(e.dsl=!0,t.dsl=y),{phys:e,ifaces:t,ndmWanExists:o}})},username:String("admin"),setPassword:function(e){return u.setPasswordAndRelogin("admin",e)},isAdminPasswordSet:function(){return m.getUser("admin").then(function(e){return!m.isUserPasswordEmpty(e)})},getClientInfo:function(){var e,t={whoami:{},show:{identification:{},interface:{name:a.LAN_SWITCH,mac:{}}}};return"router"===a.sysmode?(t.show.ip={hotspot:{}},e="show.ip.hotspot.host"):(t.show.associations={},e="show.associations.station"),l.post({url:"",noRetry:!0,data:t}).then(function(t){var n=i.get(t,e,[]),a=i.get(t,"show.interface.mac.mactable",[]),o=i.get(t,"show.identification"),s=t.whoami,r={deviceWanMac:o.mac||"",deviceServicetag:o.servicetag||"",ifaceId:s.where,host:s.host},l=i.find(n,{mac:s.mac})||{};return i.isEmpty(l)?r.type="remote":l.ap?(r.type="wifi",r.ap=l.ap):(r.type="ethernet",r.port=(i.find(a,{mac:s.mac})||{}).port),r})},getVersionInfo:function(){var e=s.toRciQueryList(["show.version","show.system.mode"]);return l.postToRciRoot(e).then(function(e){var t=i.get(e,"[0].".concat("show.version"),{}),n=i.get(e,"[1].".concat("show.system.mode"),{});return Object.assign({},t,{canSwitchMode:!n.hw_controlled})})},isDefaultConfig:function(){var t=e.defer();return l.get("show/last-change").then(function(e){return t.resolve(e.agent&&"default"===e.agent)},t.reject),t.promise},isPortOccupied:function(t){var n=Object.keys(a.PORTS_IDS).map(function(e){return e-0}),o=e.defer();return i.includes(n,t)?l.get("show/interface?name="+t).then(function(e){return"up"===e.link?o.resolve(e.link):o.reject(e.link)},o.reject):o.reject("Invalid port: "+t),o.promise},wifi:{get:function(){return l.get("interface/"+a.AP[0]).then(function(e){return{ssid:e.ssid,psk:i.get(e,"authentication.wpa-psk.psk","")}})},set:function(e,t){var n=(i.get(a,"profile.features.wifi5ghz")?[a.AP[0],a.AP_5G[0]]:[a.AP[0]]).map(function(n){return i.set({},["interface",n],function(e,t){return{encryption:{enable:A,wpa:D,wpa2:A},authentication:{"wpa-psk":{psk:t,no:!1}},"hide-ssid":D,schedule:D,ssid:{ssid:e},up:A}}(e,t))});return n.push(O),l.post({url:"",data:n})}},internetFilter:{getFilters:function(){var t={show:{}},n=[r.ydns?"yandexdns":null,r.nortondns?"nortondns":null,r["adguard-dns"]?"adguard-dns":null].filter(angular.identity);return n.length?(n.forEach(function(e){t.show[e]={availability:{}}}),l.post({url:"",data:t,timeout:5e3}).then(function(e){var t=e.show;return n.filter(function(e){return i.get(t,[e,"availability","available"],!1)})})):e.when([])},setState:function(e,t){var n={};return n[e]={enable:{no:!t}},l.post({url:"",data:[n,O]})}},ensureNdmWanIface:function(){var t=e.defer();return l.get({url:"interface?name=".concat(encodeURIComponent(a.WAN)),noRetry:!0,timeout:3e3}).then(function(e){return t.resolve(e[a.WAN])},function(){return t.resolve(!1)}),t.promise},apply:function(t,n){var o,r,c,d=t.internet,u=d.kind,m=d.type,v=d.settings||{},h=e.defer(),b=[],y=[],S=t.description||"Initial Setup interface",w={};if(n=n||T[u],i.get(v,"tunnel.settings.auth")){var C=v.tunnel.settings;(w={identity:C.login,password:C.password})[C.auth]=!0,w={authentication:w},delete v.tunnel}var E,I="dsl-isp"===u;return e.all({tunnel:v.tunnel?(E=v.tunnel.type.toUpperCase(),angular.isArray(E)||(E=[E]),l.get("show/interface").then(function(e){var t={};return E.forEach(function(e){t[e]=[]}),i.forEach(e,function(e){-1!==E.indexOf(e.type)&&t[e.type].push(e.index)}),t})):e.when(!1),mainIface:I?{error:!0}:function(e){return l.get("interface").then(function(t){var n=[];return i.forEach(t,function(t,i){"ethernet"!==e||-1===i.indexOf(a.WAN_SWITCH)&&-1===i.indexOf(a.LAN_SWITCH)||!t.ipoe||(t.id=i,n.push(t)),"3g"===e&&P.some(function(e){return-1!==i.indexOf(e)})&&(t.id=i,n.push(t))}),n})}(u)}).then(function(e){c=v.tunnel?T[v.tunnel.type].replace("0",s.firstUnusedId(e.tunnel[v.tunnel.type.toUpperCase()])):null;var a=!I&&i.find(e.mainIface,function(e){return e.id===n||e.rename===n});if(I||a||(t.noEthernetIsp=!0),r=a?_defineProperty({},n,a):{error:I?"no ISP iface":"DSL device"},"yota"===m&&r[n].usb&&(r[n].usb={}),!r.error){var o=r[n];angular.equals(o.mac,{address:{factory:{wan:!0}}})&&(o.mac={address:{no:!0}}),o.ip=angular.merge(o.ip||{},{global:{enabled:!0}}),angular.isUndefined(i.get(o,["ip","name-server"]))&&(o.ip["name-server"]=!1),r[n]=o,y.push({interface:r})}}).then(function(){if("ethernet"===u){var s,m=i.get(t,"iptv.vlan","")||i.get(t,"voip.vlan","")||v.vlan,h=m?l.get("interface/ipoe?name="+n):e.when({}),C=parseInt(i.get(t,"iptv.vlan",""),10);return h.then(function(a){if(m||t.noEthernetIsp){delete a["free-port"],s=a;var o=isNaN(C);return a={name:n,"inet-port":v.port,"iptv-port":o?"":"2","voip-port":i.get(t,"voip.vlan",""),"inet-vlan":v.vlan||"","iptv-vlan":o?"":String(C),"voip-vlan":i.get(t,"voip.vlan","")},t.noEthernetIsp&&(a.name=""),N(a)}return e.when(n)}).then(function(e){(m||t.noEthernetIsp)&&y.unshift(M({ipoe:t.noEthernetIsp?D:s},e)),o=angular.merge(w,F(v),V(v),function(e){if(!e.mac)return{};var t={};switch(e.mac.mode){case"clone":t={clone:{}};break;case"default":t=i.set({},"address.factory.wan",!0);break;default:t={address:{mac:e.mac.address}}}return{mac:t}}(v)),b=U(v,o,e,c,S);var n=L().then(function(e){i.forEach(e,function(e){var t=["interface",e.id];e.ipvc&&(delete e.ipvc["free-port"],delete e.ipvc["busy-pvc"]),delete e.id,y.push(i.set({},t,e)),b.unshift(i.set({},t,{ipvc:D}))})});return isNaN(C)?b.push(x(e)):n=R(),n.then(function(){return t.ipoeName=e,v.tunnel&&y.push(i.set({},["interface",c],D)),{cmds:b,mainIfaceName:e,bridgeIfaceName:null,tunnelName:c,restore:{queries:y,ifacesToDelete:[]},iptv:{vlanId:i.get(t,"iptv.vlan",null),iptvIface:null}}})},function(e){return{error:e}})}if("3g"===u){o=angular.merge(w,F(v,S),function(e){var t={apn:e.apn};e.country&&(t.comment=e.country?e.country+p.PRESET_COUNTRY_SEPARATOR+e.operator:"");var n={};e.identity&&(n.identity=e.identity),e.password&&(n.password=e.password);var a={usb:t};return e.phone&&(a.modem={connect:{phone:e.phone,no:!1}}),i.isEmpty(n)||(a.authentication=n),a}(v),0===n.indexOf("UsbModem")?{authentication:{chap:!0},connect:A}:{});var E=[];return L().then(function(e){i.forEach(e,function(e){var t=["interface",e.id];e.ipvc&&(delete e.ipvc["free-port"],delete e.ipvc["busy-pvc"]),delete e.id,y.push(i.set({},t,e)),E.push(i.set({},t,{ipvc:D}))})}).then(function(){return E.push(M(o,n)),{cmds:E,mainIfaceName:n,bridgeIfaceName:null,tunnelName:null,restore:{ifacesToDelete:r?[n]:[],queries:y},iptv:{vlanId:null,iptvIface:null}}})}if("dsl-isp"===u){var I=_?a.DSL:f.USBDSL_IFACE;return g.applyDslIspPreset(I,d.dslIspData,!0).then(function(e){var t=e.lastConfigurationInfo,n=e.previousConfiguration,i=t.tunnelName?[t.tunnelName]:[];return{cmds:[],mainIfaceName:t.mainIfaceName,bridgeIfaceName:null,tunnelName:t.tunnelName,restore:{ifacesToDelete:i,queries:[],promises:[function(){return g.saveNdmConfiguration(I,n.model,!1)}]},iptv:{vlanId:null,iptvIface:null}}})}}).then(function(e){if(!e.error)return l.post({url:"",data:(e.cmds||[]).concat([O])}).then(function(t){e.response=t,h.resolve(e)});h.reject(e)},h.reject),h.promise},reconfigureTunnelIface:function(e,t,n){var a=["interface",e,"authentication"],o=[i.set({},a,{no:!0}),i.set({},a,{identity:t,password:n}),O];return l.post({url:"",data:o})},internetCheck:function(e,t,n){var o=e.internet.type,s={};return i.set(s,"show.easyconfig.status",{}),i.set(s,"show.interface",{}),l.post({url:"",data:s}).then(function(s){var r,l=s.show,c=l.interface,d=i.get(l,"easyconfig.status.easyconfig",{});if("adsl"===o||"vdsl"===o||"dsl"===o){var p=_?a.DSL:f.USBDSL_IFACE,u=(i.find(c,{id:p})||{}).line;if(B.push(u),B.filter(function(e){return-1!==I.indexOf(e)}).length>10)return{status:!1,source:"DSL LINK",error:"cable",link:u}}if(a.HAS_TWO_SWITCHES){var m=i.findKey(c,function(e){return e.id===b.iface});if(!m)return{status:!1,source:"not found: "+b.iface,error:"logic"};r=[m,"port","link"]}else r=[e.ipoeName||a.WAN,"link"];if(n){var g=c[n];if("up"!==i.get(g,"link"))return{status:!1,source:"tunnel",error:g.fail||"unknown"}}switch(o){case"ethernet":if("up"!==i.get(c,r))return{status:!1,source:r.join("."),error:"cable"};break;case"adsl":case"vdsl":case"dsl":if(!_&&"yes"!==i.get(c,[T.usbdsl,"plugged"]))return{status:!1,source:T.usbdsl+".plugged",error:"cable"};break;default:if("usbdsl"!==e.internet.kind&&"yes"!==i.get(c,[t,"plugged"]))return{status:!1,source:t+".plugged",error:"cable"}}var v=i.get(c,t);return v&&"up"!==v.link?{status:!1,source:t+".link",error:v.fail||"unknown"}:d.reliable&&d.internet?{status:!0}:{status:!1,source:"ezconfig",error:"inet"}})},switchIptvMode:function(e,t,n){var o=e.internet.kind,s=e.internet.type;if("ethernet"===o){var r=t.ifaceName,c=parseInt(i.get(e,"internet.settings.vlan",""),10),d={name:r||"","inet-port":i.get(e,"internet.settings.port","0"),"iptv-port":n?"":"2","voip-port":"","inet-vlan":isNaN(c)?"":String(c),"iptv-vlan":i.get(e,"iptv.vlan",""),"voip-vlan":i.get(e,"voip.vlan","")};return N(d).then(function(o){return t.ifaceName=o,n?l.post({url:"interface/igmp",data:{name:i.get(e,"iptv.vlan",!1)?a.WAN_SWITCH+"/Vlan"+i.get(e,"iptv.vlan"):o,upstream:!0,downstream:!1}}):R()}).then(function(){return l.post(O)})}if("adsl"===s){var p=t.iptv.iptvIface,u=e.iptv,m={ipvc:{role:"iptv",port:n?"":String("2"),vpi:u.vpi,vci:u.vci,encapsulation:u.encapsulation}},f=[];return n?m.igmp={upstream:!0}:f.push(i.set({},"interface.igmp",{name:p,upstream:!1})),f.push(i.set({},["interface",p],m)),f.push(O),l.post({url:"",data:f})}var g=parseInt(i.get(e,"internet.settings.vlan",""),10),v=parseInt(i.get(e,"iptv.vlan",""),10),h=e.internet.dsl.parentIfaceId,b=["interface",t.ifaceName,"ipoe"],_={"iptv-port":n?"":String("2"),"voip-port":"","inet-vlan":isNaN(g)?"":String(g),"iptv-vlan":isNaN(v)?"":String(v),"voip-vlan":""},y=b.concat(["next-name"]);return n?l.post({url:"",data:i.set({},b,_)}).then(function(e){var t=v?h+"/Vlan"+v:i.get(e,y);return t?l.post({url:"",data:[x(t),O]}):l.post(O)}):l.post({url:"",data:i.set({},b,_)}).then(function(e){var n=i.get(e,y);n&&(t.ifaceName=n)}).then(function(){return R()}).then(function(){return l.post(O)})},restoreInterfaces:function(t,n){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],o=(n||[]).concat(t.map($)).concat(O);B=[];var s=function(){return i.isEmpty(o)?e.when([]):l.post({url:"",data:o})};return i.isEmpty(a)?s():e.all(a.map(function(e){return e()})).then(s)},clearDslStatusesArray:function(){B=[]},iptvPort:2,updates:{probeFactory:function(){return angular.isDefined(h)?e.when(h):l.post({url:"",data:{probe:"factory"}}).then(function(e){return h=i.get(e,"probe.found",!1)})},possibleStatuses:W,check:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=e.defer();return d.getComponentsList("",3,!0).then(function(e){e.error&&n.resolve({status:H().status,recommended:null,error:e.error});var i,a,o=function(e){for(var t=e.component,n=Object.keys(t),i=0,a=n.length;i<a;++i){var o=t[n[i]],s=o.preset;if(!s&&o.installed)return!1;if(-1!==(s=angular.isArray(s)?s:[s]).indexOf("recommended")&&!o.installed)return!1}return!0}(e);t||o||n.resolve({status:W.notRecommendedComponents,recommended:o}),n.resolve({status:(i=e,a=i.component.base,a.version&&a.installed&&a.version!==a.installed?W.hasUpdates:W.hasNoUpdates),recommended:o})},function(){return n.resolve(H())}),n.promise},setRecommended:function(){var t=e.defer(),n=function(e){24248662===Number(i.get(e,"status.0.code",-1))?t.resolve(W.hasUpdates):t.resolve(W.hasNoUpdates)};return l.post({url:"components/preset",noRetry:!0,data:{preset:"recommended"}}).then(n,n),t.promise},update:function(){var t=e.defer();return l.post({url:"components commit",noRetry:!0,data:{reason:"wizard"}}).then(t.resolve,t.reject,t.notify),t.promise},isDeviceOnline:function(t,n){var i=e.defer(),a={url:"show/identification",noRetry:!0};return angular.isNumber(n)&&n>0&&(a.timeout=n),l.get(a).then(function(e){return t&&e.servicetag!==t?i.resolve(!1):i.resolve(!0)},function(){return i.resolve(!1)}),i.promise}}}}e.$inject=["$q","$http","$timeout","_","NDM","CONSTANT","utils","components","router","interfaces","componentsService","modems","administrator","usersService","usbdslConsts","dslService"],angular.module("keenetic").factory("initialSetupService",e)}(),function(){function e(e,t,n,i,a,o,s,r,l,c,d,p,u,m,f,g,v,h,b,_,y,S,w,C,E,I,T,k,P){try{r.uiViewClass="initial-setup-ui-view";var A=this,D=u.some(I.PORTS_MAP,"isSfp"),O=_.constants.IS_DSL_DEVICE,N=_.constants.DEFAULT_DESCRIPTIONS;A.falseFn=function(){return!1},A.trueFn=function(){return!0},A.isIE=b.isIE,A.isEdge=b.isEdge,A.constants={deviceModel:m.getModelNameWithVendor(),deviceModelForLogo:m.getModelNameForLogo(),wizardName:"initial-setup-wizard",debounceTimeout:200,notificationTimeout:3e3},A.deviceIsOffline=!1,A.devicePollerIsOn=!0,A.l10n={},A.updateDeviceStatus=function(e){A.deviceIsOffline=Boolean(e.offline)};var L=function(){A.l10n={pageTitle:m.formatPageTitle("initial-setup.page-title"),services:{internet:m.getTranslation("initial-setup.services.internet"),iptv:m.getTranslation("initial-setup.services.iptv")},rebootAlert:m.getTranslation("system.sysmode.alert.reboot.status"),errors:{vlanUsed:m.getTranslation("errors.vlan-used")},dashboardLink:m.getTranslation("initial-setup.welcome.dashboard-link",null,m.l10n.getSrefChunks("dashboard",{"ng-click":"vm.skipInitialSetup($event)"})),specialModesLink:m.getTranslation("initial-setup.conn-type.special-modes-link",null,m.l10n.getLinkChunks("modes",{"ng-click":"vm.goToStep('special-modes')"})),connSubtypeDescription:m.getTranslation("initial-setup.conn-subtype.description",null,{ipoe:m.getTranslation("initial-setup.conn-subtype.subtype.ipoe")}),inetCheckFailedSoFar:m.getTranslation("initial-setup.check-conn.inet-check-failed-so-far",null,m.l10n.getLinkChunks("changeSettings",{"ng-click":"vm.goToStep('conn-type')"})),inetCheckFailed:m.getTranslation("initial-setup.check-conn.inet-check-failed",null,u.extend({},m.l10n.getLinkChunks("changeSettings",{"ng-click":"vm.goBackToStep('conn-type')"}),m.l10n.getLinkChunks("dashboard",{"ng-click":"vm.goToDashboard()"}))),encapOptions:m.idsToOptions(_.constants.DSL_ENCAPSULATION_OPTIONS,m.translatePrefixCtor("initial-setup.dsl-type.encapsulation-type"))},r.title=A.l10n.pageTitle};L(),s.$on("destroy",r.$on("$translateChangeSuccess",function(){return l(L)})),A.phyCheckIfaces={},A.wizard=null,A.initFlags={languagesLoaded:t.defer(),wizardAttached:t.defer()},A.progress=0,A.hideProgress=!1,A.stepCtrl=null,A.currentStep=!1,A.currentStepIndex=0;var x=["welcome","password","conn-type","dsl-isp","dsl-adsl-subtype","g3-operator","services","setup-vlans","setup-mac","adsl-vpi-vci","setup-iptv-adsl-vpivci","setup-ip","conn-subtype","special-modes","logon","check-conn","check-iptv","cyber-security","wifi-settings"];A.steps={},x.forEach(function(e,t){A.steps[e]={index:t}}),A.steps.welcome.progress=1,A.stepsCount=x.length,A.stepNames=x.slice(),A.selectedServices=["internet"],A.config={internet:{settings:{}}},A.internalConfig={connectedViaWifi:!1,internetFilter:{exists:Boolean(g.ydns||g.nortondns||g["adguard-dns"]),availableFilters:[]},occupiedPort:null,usedPorts:[],ndmWanExists:!1,passwordAlreadySet:!1,busyVlans:[]},A.history={},A.isNavigatingWithBrowserBtns=!1,A.isRebooting=!1,A.reboot={isAbnormal:!1,progress:0,msg:""},A.getProgress=function(e){var t=A.steps[e];return m.round((t.progress||t.index)/A.stepsCount*100)},A.getStepTitleByNumber=function(e){var t=!1;return u.forEach(A.steps,function(n,i){e===n.index&&(t=i)}),t},M=s.$watch("WizardHandler.wizard",function(){if(A.wizard=e.wizard(A.constants.wizardName),M(),A.goToStep=function(e,n){A.transitionInProgress=!0,n=angular.extend({progress:-1,goingBack:!1,updateHistory:!0},n||{});var a=angular.isNumber(e),o=n.updateHistory,s=n.goingBack,r=n.progress;if(a&&(e=A.getStepTitleByNumber(e)),(!angular.isNumber(r)||r<0||r>100)&&(r=A.steps[e].progress||!1),!A.steps[e])return i.warn("Unknown step: "+e),void(A.transitionInProgress=!1);var c=A.steps[e].ctrl,d={from:u.get(n,"from.step")||A.currentStep},p=function(){s&&A.history[A.currentStep]&&A.currentStep===A.history[e].from.step&&(c.ready=!1),!s&&o?A.history[e]={prevStep:A.currentStep,config:angular.copy(A.config),state:A.stepCtrl}:s&&A.history[A.currentStep]&&(c=A.history[A.currentStep].state,A.config=angular.copy(A.history[A.currentStep].config)),A[m.dashesToCamelCase(e)]=c,A.stepCtrl=c;var n=c.onShow&&angular.isFunction(c.onShow)?c.onShow(d):null;return t.when(n).then(function(){return c.ready=!0,A.wizard.goTo(e),A.currentStepIndex=A.steps[e].index,l(function(){A.progress=r||A.getProgress(e),A.currentStep=e}),e}).finally(function(){A.transitionInProgress=!1})},f=Boolean(A.stepCtrl)&&angular.isFunction(A.stepCtrl.destroy)?A.stepCtrl.destroy():null;return t.when(f).then(function(){if(s)n.from&&A.history[e]&&(A.history[e].from=angular.extend(n.from,{state:A.stepCtrl,config:angular.copy(A.config)}));else if(A.isNavigatingWithBrowserBtns&&A.history[e]&&A.history[e].prevStep&&A.history[A.history[e].prevStep]&&A.history[A.history[e].prevStep].from){var i=A.history[A.history[e].prevStep].from;return p(),A.stepCtrl=i.state,A.config=angular.copy(i.config),delete A.history[A.history[e].prevStep].from,void(A.isNavigatingWithBrowserBtns=!1)}c.ready&&(c.ready=!1);var a=c.init&&angular.isFunction(c.init)&&!s?c.init(d):null;return t.when(a).then(p)})},A.getPreviousStep=function(e){return!!A.history[e]&&A.history[e].prevStep},A.goBack=function(){var e=A.currentStep,t=A.getPreviousStep(e);if(t)return A.goToStep(t,{goingBack:!0,from:{step:e}});i.warn("Can't go back from step: "+e)},A.goBackToStep=function(e){return A.goToStep(e,{updateHistory:!1})},A.skipInitialSetup=function(e){e.preventDefault(),_.isAdminPasswordSet().then(function(e){if(A.internalConfig.passwordAlreadySet=e,e)return E.post(E.saveQueryStr()).then(A.goToDashboard());A.internalConfig.skipInitialSetup=!0,A.goToStep("password")})},b.isMobile){var n=A.goBack||function(){return t.when(!0)},a=function(){p.history.pushState(null,"any",o.absUrl())};a(),p.onpopstate=function(e){if(e){var i=t.when(!0);switch(A.currentStep){case"check-conn":A.transitionInProgress||(i=A.goToStep("conn-type"));break;case"logon":i=u.get(A,"logon.onCancelClick",n)();break;default:i=n()}return i.then(a),e.preventDefault(),!1}}}A.initFlags.wizardAttached.resolve(!0)}),A.goToDashboard=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";A.devicePollerIsOn=!1;var n=function(){e&&"/"!==e?o.path(e):p.location="/"};return P.checkAcceptance().then(_.disableEasyconfig).then(function(){return(A.internalConfig.passwordAlreadySet?t.when(!0):_.setPassword(A.internalConfig.password)).then(n,function(){p.location="/"})})},t.all(u.mapValues(A.initFlags,function(e){return e.promise})).then(_.getClientInfo).then(function(e){"ethernet"===e.type?(A.internalConfig.usedPorts.push(e.port),A.internalConfig.occupiedPort=e.port):"wi-fi"===e.type&&(A.internalConfig.connectedViaWifi=!0),A.internalConfig.deviceWanMac=e.deviceWanMac,A.internalConfig.deviceServicetag=e.deviceServicetag}).then(_.getVersionInfo).then(function(e){A.versionInfo=e}).then(_.getBusyVlans).then(function(e){A.internalConfig.busyVlans=e.slice(),A.configOnInit=angular.copy(A.config),A.goToStep("welcome",{progress:1}).then(function(){A.ready=!0})}),R={_step:"welcome",languageOptions:m.getLanguageOptionsList(),init:function(){A.internalConfig.skipInitialSetup=!1,R.language=m.getCurrentLanguage()},destroy:function(){A.config.language=R.language},onLanguageChange:function(){return l(function(){return m.changeLanguage(R.language)})},proceed:function(){return A.internalConfig.skipInitialSetup=!1,_.isDefaultConfig().then(function(e){var n=t.defer();return e?P.checkAcceptance().then(function(){return n.resolve()}):P.checkAcceptance().then(function(){f.confirm("initial-setup.welcome.reset-to-default.question","initial-setup.welcome.reset-to-default.confirm-button","initial-setup.welcome.reset-to-default.skip-button").then(function(){A.isRebooting=!0,y.resetDeviceToFactorySettings().then(function(){var e=c(function(){if(A.reboot.progress>10&&!A.deviceIsOffline)return c.cancel(e),A.isRebooting=!1,void _.getBusyVlans().then(function(e){A.internalConfig.busyVlans=e.slice(),A.configOnInit=angular.copy(A.config)}).finally(function(){n.resolve()});A.reboot.progress<100&&!A.reboot.isAbnormal?A.reboot.progress++:(A.reboot.isAbnormal=!0,A.reboot.progress=100)},(I.FW_SHUTDOWN_TIME+I.FW_BOOT_TIME)/100)})},function(){return n.resolve()}).catch(function(e){console.warn(e)})}),n.promise}).then(_.isAdminPasswordSet).then(function(e){A.internalConfig.passwordAlreadySet=e,A.goToStep(e?"conn-type":"password")}).finally(function(){A.isRebooting=!1})}},A.initFlags.languagesLoaded.resolve(!0),A.steps.welcome&&(A.steps.welcome.ctrl=R),function(){var e={_step:"password",password1:"",password2:"",error:{password1:"",password2:""},init:angular.noop,username:_.username,onShow:function(t){A.internalConfig.skipInitialSetup&&P.checkAcceptance(),t.from&&"welcome"===t.from&&(delete A.config.internet.settings.tunnel,e.password1="",e.password2="",e.error={password1:"",password2:""})},comparePasswords:function(){l(function(){e.password1===e.password2?e.error={password1:"",password2:""}:(e.error.password1="passwords-do-not-match",e.error.password2="passwords-do-not-match")})},canProceed:function(){return e.form&&!e.form.$invalid&&e.password1&&e.password2&&e.password1===e.password2},proceed:function(){A.internalConfig.password=e.password1,A.internalConfig.skipInitialSetup?A.goToDashboard():A.goToStep("conn-type")}};A.steps.password&&(A.steps.password.ctrl=e)}(),function(){var e,t=m.translatePrefixCtor("initial-setup.conn-type"),n={_step:"conn-type",_phyCheckData:null,_pollDelayInMs:2e3,pollTimeout:null,ready:!1,selectedKind:!1,selectedType:!1,selectedConnOk:!1,kindOptions:[],components3gNeedConf:["3g"],components3g:["3g","cdcEthernet","yota","lte"],componentsUsbdsl:["usbdsl"],_filterComponents:function(e,t){var i=[];return e.forEach(function(e){t(n._phyCheckData.phys[e])&&i.push(e)}),i},getExistingComponents:function(e){return n._filterComponents(e,angular.isDefined)},connKindAvailable:{dsl:function(){return O},ethernet:function(){return!0},"3g":function(){return g.usb&&n.getExistingComponents(n.components3g).length>0},usbdsl:function(){return!O&&g.usb&&n.getExistingComponents(n.componentsUsbdsl).length>0},"special-modes":function(){return!g.usb&&e}},specialModesStepLinkIsVisible:g.usb&&e,setPollTimeout:function(){n.cancelPollTimeout(),n.ready&&(n.pollTimeout=l(n.poll,n._pollDelayInMs))},cancelPollTimeout:function(){l.cancel(n.pollTimeout)},setError:function(e){n.kindOptions.forEach(function(t){t.error=t.id===e})},toggleError:function(e){if(n.selectedConnOk)C.hideAll(),n.kindOptions.forEach(function(e){e.error=!1});else{var t="initial-setup.conn-type.kind."+e+".error";"ethernet"===e&&(D?t+="-sfp":O&&(t+="-no-wan")),C.warning(t,-1),n.setError(e)}},checkConnAndGetType:{dsl:function(){return{isOk:u.get(n._phyCheckData,"phys.dsl"),type:"dsl"}},ethernet:function(){return{isOk:n._phyCheckData&&n._phyCheckData.phys&&n._phyCheckData.phys.ethernet,type:"ethernet"}},"3g":function(){var e=n._filterComponents(n.components3g,angular.identity);return{isOk:e.length>0,type:e[0]}},usbdsl:function(){var e=n._filterComponents(n.componentsUsbdsl,angular.identity);return{isOk:e.length>0,type:e[0]}},"special-modes":function(){return{isOk:!0,type:"special-modes"}}},getNextStep:function(e){return"ethernet"===e?"services":"special-modes"===e?"special-modes":-1!==n.components3g.indexOf(e)?-1===n.components3gNeedConf.indexOf(e)?"check-conn":"g3-operator":"dsl-isp"},poll:function(){return _.phyCheck().then(function(e){if(n._phyCheckData=e,A.phyCheckIfaces=e.ifaces,A.internalConfig.ndmWanExists=e.ndmWanExists,n.setPollTimeout(),n.selectedKind){var t=n.selectedKind,i=n.checkConnAndGetType[t]();n.selectedConnOk=i.isOk,n.toggleError(n.selectedKind)}})},init:function(){return e=A.versionInfo.canSwitchMode,n.specialModesStepLinkIsVisible=g.usb&&e,E.reset(),n.resetState(),n.poll().then(function(){n.kindOptions=[],u.forEach(n.connKindAvailable,function(e,i){e()&&n.kindOptions.push({id:i,label:t(["kind",i,"label"].join(".")),description:t(["kind",i,"description"].join(".")),state:void 0})}),n.ready=!0})},onShow:function(){A.config=angular.copy(A.configOnInit),l.cancel(n.pollTimeout),n.ready=!0},destroy:function(){n.ready=!1,C.hideAll(),n.cancelPollTimeout(),A.config.internet=angular.extend(A.config.internet,{kind:n.selectedKind,type:n.selectedType,settings:{port:O?I.PORTS_MAP[I.ETHER_WAN_PORT].port:I.PORTS_MAP[I.WAN_PORT].port}});var e=N[n.selectedKind]||N.ethernet;A.config.description=e,A.config.isDslDevice=O,A.internalConfig.type=n.selectedType,A.internalConfig.ethernetMac=A.internalConfig.deviceWanMac||"01:22:33:44:55:66"},proceed:function(){return n.poll().then(function(){var e=n.checkConnAndGetType[n.selectedKind]();n.selectedConnOk=e.isOk,n.toggleError(n.selectedKind),n.selectedConnOk&&(n.selectedType=e.type,A.goToStep(n.getNextStep(e.type)))})},canProceed:function(){return angular.isString(n.selectedKind)&&n.selectedConnOk},resetState:function(){n.typeOptions=[],n.selectedType=!1,n.selectedKind=!1},setConnectionKind:function(e){C.hideAll(),n.selectedConnOk=!1,n.cancelPollTimeout(),n.selectedKind=e,n.poll()}};A.steps["conn-type"]&&(A.steps["conn-type"].ctrl=n)}(),function(){var e={_step:"services",servicesOptions:[],init:function(){l(function(){e.servicesOptions=[{id:"internet",label:A.l10n.services.internet,disabled:!0},{id:"iptv",label:A.l10n.services.iptv}]})},proceed:function(){var e="",t=A.config.internet.type,n=A.config.internet.kind;e="usbdsl"===n||"dsl"===n?"adsl"===t?"adsl-vpi-vci":"setup-vlans":angular.equals(A.selectedServices,["internet"])?"setup-mac":"setup-vlans",A.goToStep(e)}};A.steps.services&&(A.steps.services.ctrl=e)}(),function(){var e="special-modes",t=m.translatePrefixCtor("initial-setup.special-modes"),n={_step:e,modeOptions:[],mode:null,isRebooting:!1,rebootIsAbnormal:!1,rebooted:!1,notice:{},rebootInterval:null,rebootMsg:"",rebootProgress:0,init:angular.noop,select:function(e){n.mode=e},selected:function(e){return n.mode===e},canProceed:function(){return n.mode&&n.mode.length>0},proceed:function(){return f.confirm("system.sysmode.alert.description-"+n.mode,"yes","no").then(function(){return P.acceptEveryLicense()}).then(function(){return S.setSystemMode(n.mode)}).then(function(){return n.getSpecialModeNotice(n.mode)}).then(function(e){A.hideProgress=!0,n.isRebooting=!0,n.notice=e,c.cancel(n.rebootInterval),n.rebootInterval=c(function(){if(n.rebootProgress>10&&!A.deviceIsOffline)return c.cancel(n.rebootProgress),n.rebooted=!0,void(A.hideProgress=!1);n.rebootProgress<100&&!n.rebootIsAbnormal?n.rebootProgress++:(n.rebootIsAbnormal=!0,n.rebootProgress=100)},(I.FW_SHUTDOWN_TIME+I.FW_BOOT_TIME)/100)})},getSpecialModeNotice:function(e){var t={text:"",subText:""};return d("system.sysmode.finish-notice-alert.common").then(function(n){return t.text=n.replace(/%%NEWMODE%%/g,m.getTranslation("system.sysmode."+e)),t.subText="system.sysmode.finish-notice-alert."+e,t})},onShow:function(){return S.getSystemMode().then(function(e){n.modeOptions=e.supportedModes.filter(function(e){return"router"!==e}).map(function(e){return{id:e,title:t("modes."+e),class:"mode-icon--"+e}}),n.mode="",n.isRebooting=!1,n.notice={},n.rebootInterval=null,n.rebootIsAbnormal=!1,n.rebootProgress=0,n.rebooted=!1})},destroy:angular.noop};A.steps[e]&&(A.steps[e].ctrl=n)}(),function(){var e=m.translatePrefixCtor("initial-setup.dsl-type"),t={_step:"dsl-type",ready:!1,typeOptions:[],type:"",encapOptions:A.l10n.encapOptions.slice(),encapsulation:A.l10n.encapOptions[0].id,init:function(){return t.dslParentIfaceId=O?_.constants.INTERNAL_DSL_IFACE_ID:_.constants.DEFAULT_IFACE_NAMES.usbdsl,_.getDslCapabilities(t.dslParentIfaceId).then(function(e){A.config.dslData=e;var n=_.constants.DSL_ADSL_AUTO_OPMODE;t.adslAutoModeAvailable=!O||u.find(A.config.dslData.byCategory.adsl,{id:n}),t.resetState(),t.ready=!0})},destroy:function(){return A.config.internet.type=t.type,A.config.internet.dsl={parentIfaceId:t.dslParentIfaceId},"adsl"===t.type?(A.config.internet.settings.encapsulation=t.encapsulation,A.config.internet.dsl.opmodeData=O?u.find(A.config.dslData.byCategory.adsl,{id:_.constants.DSL_ADSL_AUTO_OPMODE}):{id:_.constants.USBDSL_ADSL_OPMODE}):A.config.internet.dsl.opmodeData=u.find(A.config.dslData.byCategory.vdsl,{id:_.constants.VDSL_CLIENT_OPMODE}),_.getIfaceConfig(t.dslParentIfaceId).then(function(e){delete e.mac,A.config.internet.dsl.initialCfg=e,A.config.internet.dsl.isInVdslMode=-1!==u.get(e,"operating-mode.mode","").indexOf("vdsl")})},proceed:function(){return A.goToStep("vdsl"===t.type||t.adslAutoModeAvailable?"services":"dsl-adsl-subtype")},select:function(e){t.type=e},selected:function(e){return t.type===e},canProceed:function(){return t.type.length>0},resetState:function(){t.type="",t.typeOptions=m.idsToOptions(Object.keys(A.config.dslData.byCategory),function(t){return e("type."+t)}),t.encapOptions=A.l10n.encapOptions.slice(),t.encapsulation=t.encapOptions[0].id}};A.steps["dsl-type"]&&(A.steps["dsl-type"].ctrl=t)}(),function(){var e={_step:"dsl-isp",ready:!1,data:{},init:function(){return t.when(!0).then(function(){e.resetState(),e.ready=!0})},destroy:function(){},manual:function(){A.goToDashboard("/controlPanel/dsl")},proceed:function(){A.config.internet.kind="dsl-isp",A.config.internet.dslIspData=u.clone(e.data),e.data.vdsl&&e.data.adsl?A.config.internet.type="dsl":A.config.internet.type=e.data.vdsl?"vdsl":"adsl",u.isEmpty(e.data)||A.goToStep("check-conn")},resetState:function(){e.data=null}};A.steps["dsl-isp"]&&(A.steps["dsl-isp"].ctrl=e)}(),function(){var e="dsl-adsl-subtype",t={_step:e,ready:!1,subtypeOptions:[],subtype:"",init:function(){t.resetState(),t.ready=!0},destroy:function(){A.config.internet.dsl.opmodeData=u.find(t.subtypesData,{id:t.subtype})},proceed:function(){return A.goToStep("services")},canProceed:function(){return Boolean(t.subtype)},resetState:function(){t.subtypesData=A.config.dslData.byCategory.adsl,t.subtype="",t.subtypeOptions=t.subtypesData.map(function(e){return{id:e.id,label:e.caption}})}};A.steps[e]&&(A.steps[e].ctrl=t)}(),function(){var e="adsl-vpi-vci",t={_step:e,ready:!1,form:null,vpiVciOpt:"",vpiVciOptions:[["0/33","0/50"],["0/34","1/34"],["0/35","8/35"]],manualInput:!1,adslData:{vpi:"",vci:""},init:function(){t.resetState(),t.ready=!0},destroy:function(){A.config.internet.settings=angular.merge(A.config.internet.settings,{vpi:t.adslData.vpi,vci:t.adslData.vci})},proceed:function(){return A.goToStep(A.selectedServices.indexOf("iptv")>-1?"setup-iptv-adsl-vpivci":"setup-ip")},canProceed:function(){return""!==t.vpiVciOpt&&(!t.form||t.form.$valid)},selectSubtype:function(e){if(t.vpiVciOpt=e,t.manualInput="manual-input"===e,!t.manualInput){var n=e.split("/");2===n.length?(t.adslData.vpi=n[0],t.adslData.vci=n[1]):i.warn("INVALID OPT:",e)}},selectedSubtype:function(e){return t.vpiVciOpt===e},resetState:function(){t.manualInput=!1,t.adslData={vpi:"",vci:""},t.form=null,t.vpiVciOpt=""}};A.steps[e]&&(A.steps[e].ctrl=t)}(),function(){var e="conn-subtype",t=function(){return n.selectedSubtype.length>0},n={_step:e,_addressRequiredFor:["l2tp","pptp"],selectedSubtype:!1,serverAddress:{l2tp:"",pptp:""},formL2tp:null,formPptp:null,watchCanceller:null,init:function(){return n.resetState()},onShow:function(e){e.from&&"logon"===e.from&&(u.get(A,"config.internet.settings.tunnel")||u.get(A,"config.internet.settings.auth"))&&(delete A.config.internet.settings.tunnel,delete A.config.internet.settings.auth),n.canProceed=t},select:function(e){n.watchCanceller&&n.watchCanceller(),n.selectedSubtype=e,"l2tp"===e?(n.canProceed=A.falseFn,n.watchCanceller=s.$watch("vm.connSubtype.formL2tp",function(e){e&&(n.canProceed=function(){return!(n.formL2tp.$invalid||n.formL2tp.$pending)},n.watchCanceller())})):"pptp"===e?(n.canProceed=A.falseFn,n.watchCanceller=s.$watch("vm.connSubtype.formPptp",function(e){e&&(n.canProceed=function(){return!(n.formPptp.$invalid||n.formPptp.$pending)},n.watchCanceller())})):n.canProceed=t},selected:function(e){return n.selectedSubtype===e},proceed:function(){return A.goToStep("ipoe"===n.selectedSubtype?"check-conn":"logon")},canProceed:function(){return n.selectedSubtype},destroy:function(){if(A.internalConfig.subtype=n.selectedSubtype,"ipoe"!==n.selectedSubtype){var e={type:n.selectedSubtype,settings:{}};u.includes(n._addressRequiredFor,n.selectedSubtype)?(A.internalConfig.serverAddress=n.serverAddress[n.selectedSubtype],e.server=n.serverAddress[n.selectedSubtype]):"pppoe"===n.selectedSubtype&&(e.settings.pppoe={}),A.config=angular.merge(A.config,{internet:{settings:{tunnel:e}}})}},resetState:function(){n.selectedSubtype=!1,n.serverAddress={l2tp:"",pptp:""}}};A.steps[e]&&(A.steps[e].ctrl=n)}(),function(){var e={_step:"setup-mac",option:!1,macAddress:"",manualInput:!1,form:null,ready:!1,init:function(){e.resetState(),e.ready=!0},resetState:function(){e.option=!1,e.macAddress="",e.manualInput=!1},select:function(t){e.option=t,e.manualInput="manual-input"===t},selected:function(t){return e.option===t},proceed:function(){return A.goToStep("setup-ip")},canProceed:function(){return angular.isString(e.option)&&(!e.manualInput||Boolean(e.form)&&e.form.$valid)},destroy:function(){var t;e.manualInput?t={address:-1===e.macAddress.indexOf(":")?(e.macAddress.match(/.{1,2}/g)||[]).join(":"):e.macAddress,mode:"manual"}:t={mode:"default"};A.config=angular.merge(A.config,{internet:{settings:{mac:t}}})}};A.steps["setup-mac"]&&(A.steps["setup-mac"].ctrl=e)}(),function(){var e=m.translatePrefixCtor("initial-setup.setup-ip"),t=["dynamic-ip","static-ip","no-ip"],n={_step:"setup-ip",ipForm:null,ipFormWatchCanceller:null,ready:!1,ipType:t[0],ipTypeOptions:[],address:"",gateway:"",maskOptions:[],mask:!1,_maskDefaultVal:"select-netmask",dns:"",init:function(){return n.resetState()},onShow:function(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};n.ipFormWatchCanceller&&(n.ipFormWatchCanceller(),n.canProceed=A.falseFn),i.from&&"logon"===i.from&&u.get(A,"config.internet.settings.tunnel")&&delete A.config.internet.settings.tunnel,n.ipFormWatchCanceller=s.$watch("vm.setupIp.ipForm",function(e){e&&(n.canProceed=function(){return n.ready&&n.ipForm.$valid&&!n.ipForm.$pending&&("static-ip"!==n.ipForm.ipType||n.maskSelected())},n.ipFormWatchCanceller())}),n.ipTypeOptions=t.map(function(t){return{id:t,label:e("ip-type."+t)}});var a=u.get(A,"config.internet.settings.ip.mode");if(delete A.internalConfig.subtype,a){switch(a){case"static":n.ipType="static-ip";break;case"none":n.ipType="no-ip";break;case"auto":default:n.ipType="dynamic-ip"}delete A.config.internet.settings.ip}else n.ipType=n.ipTypeOptions[0].id;n.ready=!0},destroy:function(){var e;e="static-ip"===n.ipType?{mode:"static",address:n.address,gateway:n.gateway,mask:n.mask,dns:n.dns}:"dynamic-ip"===n.ipType?{mode:"auto"}:{mode:"none"},A.config.internet.settings.ip=angular.extend(A.config.internet.settings.ip||{},e),n.ready=!1},proceed:function(){if("no-ip"===n.ipType){A.internalConfig.subtype="pppoe";var e={type:"pppoe",settings:{pppoe:{}}};return A.config=angular.merge(A.config,{internet:{settings:{tunnel:e}}}),A.goToStep("logon")}return A.goToStep("conn-subtype")},canProceed:A.falseFn,maskSelected:function(){return n.mask!==e(n._maskDefaultVal)},changeIpType:function(){A.internalConfig.ipType=n.ipType},resetState:function(){n.maskOptions=m.idsToOptions(T.getMasksArray(),angular.identity),n.address="",n.gateway="",n.dns="",n.ipForm=null}};A.steps["setup-ip"]&&(A.steps["setup-ip"].ctrl=n)}(),function(){var e={_step:"logon",ready:!1,form:null,login:"",password:"",acname:"",service:"",showAuthType:!1,authType:"",authTypeOptions:[{id:"eap-md5",name:"EAP-MD5"},{id:"chap",name:"EAP-TTLS/CHAP"},{id:"mschap",name:"EAP-TTLS/MS-CHAP"},{id:"mschap-v2",name:"EAP-TTLS/MS-CHAPv2"},{id:"peap",name:"EAP-PEAP/MS-CHAPv2"}],init:function(){e.resetState(),e.onShow(),e.ready=!0},onShow:function(){var t=u.get(A,"config.internet.settings.tunnel.settings",-1);-1!==t&&(e.login=t.login,e.password=t.password),e.authType=e.authTypeOptions[0].id,e.showAuthType="auth802.1x"===A.internalConfig.subtype},canProceed:function(){return e.ready&&Boolean(e.form)&&e.form.$valid},proceed:function(){A.goToStep("check-conn")},resetState:function(){e.login="",e.password=""},showPppoeSettings:function(){return e.ready&&"pppoe"===A.internalConfig.subtype&&A.internalConfig.authError},destroy:function(){var t=u.get(A,"config.internet.settings.tunnel.settings",{});t.login=e.login,t.password=e.password,"auth802.1x"===A.internalConfig.subtype&&(t.auth=e.authType),A.internalConfig.serverAddress&&A.internalConfig.serverAddress.length>0&&(t.server=A.internalConfig.serverAddress),"pppoe"===A.internalConfig.subtype&&(e.acname&&(t.pppoe.acname=e.acname),e.service&&(t.pppoe.service=e.service)),A.config=angular.merge(A.config,{internet:{settings:{tunnel:{settings:t}}}})},onCancelClick:function(){A.internalConfig.authError?(delete A.internalConfig.authError,delete A.internalConfig.reconfigureTunnelOnly,_.restoreInterfaces(A.internalConfig.restore.ifacesToDelete,A.internalConfig.restore.queries,A.internalConfig.restore.promises||[]).then(function(){return A.goBackToStep("conn-type")})):A.goBack()}};A.steps.logon&&(A.steps.logon.ctrl=e)}(),A.mobileOperatorsByCountry={},function(){var e={_step:"g3-operator",ready:!1,form:null,country:"",countryOptions:[],operator:"",operatorOptions:[],otherOperatorOption:k.OTHER_OPTION,defaultData:angular.copy(k.USBMODEM_DEFAULT_PRESET),customData:angular.copy(k.USBMODEM_DEFAULT_PRESET),isOperatorsReady:!1,init:function(){e.form=null,v.getAll().then(function(t){A.mobileOperatorsByCountry=t;var n=[],i=["RU","BY","UA","KZ"];u.forEach(A.mobileOperatorsByCountry,function(e,t){switch(A.versionInfo.region){case"RU":if(-1===i.indexOf(t))return;break;case"EU":if(-1!==i.indexOf(t))return}n.push({id:t,label:m.getTranslation("country."+t)})}),n.sort(function(e,t){return e.label<t.label?-1:1}),e.countryOptions=n,e.country="RU"===A.versionInfo.region?"RU":n[0].id,e.onCountryChange(),e.ready=!0})},onShow:function(){A.internalConfig.country&&(e.ready=!1,e.country=A.internalConfig.country,e.onCountryChange(),l(function(){A.internalConfig.operator=e.operator,e.ready=!0}))},onCountryChange:function(){e.isOperatorsReady=!1,l(function(){var t=[];u.forEach(A.mobileOperatorsByCountry[e.country]||{},function(e,n){t.push({id:n,label:e.localName})}),t.sort(function(e,t){return e.label<t.label?-1:1}),t.push({id:e.otherOperatorOption,label:m.getTranslation("modems.preset-other")}),e.operatorOptions=t,e.operator=t[0].id,e.isOperatorsReady=!0})},destroy:function(){e.ready=!1,A.internalConfig.country=e.country,A.internalConfig.operator=e.operator;var t={};e.operator===e.otherOperatorOption?t=angular.copy(e.customData):(t=A.mobileOperatorsByCountry[e.country][e.operator],["apn","identity","password","phone"].forEach(function(n){angular.isUndefined(t[n])&&(t[n]=e.defaultData[n])}),t.country=e.country,t.operator=e.operator),A.config.internet.settings=t},proceed:function(){A.goToStep("check-conn")},canProceed:function(){return e.ready&&Boolean(e.form)&&e.form.$valid},onCancelClick:function(){A.internalConfig.authError?(delete A.internalConfig.authError,delete A.internalConfig.reconfigureTunnelOnly,_.restoreInterfaces(A.internalConfig.restore.ifacesToDelete,A.internalConfig.restore.queries,A.internalConfig.restore.promises||[]).then(function(){return A.goBackToStep("conn-type")})):A.goBack()}};A.steps["g3-operator"]&&(A.steps["g3-operator"].ctrl=e)}(),function(){var e=["setup-no-vlan"],t=m.translatePrefixCtor("initial-setup.setup-vlans.options"),n={_step:"setup-vlans",autoOptions:e,option:null,form:null,manualSetup:!1,inetVlan:"",iptvVlan:"",voipVlan:"",validation:{validate:function(){var e=function(e){return!isNaN(parseInt(e,10))&&e>=0&&e<=4094},t=["iptvVlan","inetVlan"];for(var i in u.forEach(n.validation.errors,function(e,t){n.validation.errors[t]=!1}),n.validation.errors)for(var a in n.validation.errors)if(!(i===a||u.includes(t,i)&&u.includes(t,a))){var o=n[i],s=n[a];n.validation.errors[i]=n.validation.errors[i]||e(o)&&e(s)&&Number(o)===Number(s)&&A.l10n.errors.vlanUsed}return!0},errors:{voipVlan:!1,iptvVlan:!1,inetVlan:!1},init:function(){s.$on("$destroy",s.$watch("vm.setupVlans.voipVlan",n.validation.validate)),s.$on("$destroy",s.$watch("vm.setupVlans.iptvVlan",n.validation.validate)),s.$on("$destroy",s.$watch("vm.setupVlans.inetVlan",n.validation.validate))}},init:function(){return n.resetState()},vlanIsNotReserved:function(e){if(e&&!isNaN(Number(e)))return-1===A.internalConfig.busyVlans.indexOf(Number(e))?"":A.l10n.errors.vlanUsed},onShow:function(){A.internalConfig.voipAvailable=g.usb&&g.nvox,n.validation.init()},resetState:function(){n.autoOptions=e.map(function(e){return{id:e,label:t(e+".label"),description:t(e+".description")}}),n.option=null,n.form=null,n.manualSetup=!1,n.inetVlan="",n.iptvVlan="",n.voipVlan=""},select:function(e){n.option=e,n.manualSetup="setup-vlan"===e,A.internalConfig.skipIptv="skip"===e},selected:function(e){return n.option===e},canProceed:function(){return angular.isString(n.option)&&(!n.manualSetup||![n.inetVlan,n.iptvVlan,n.voipVlan].every(function(e){return 0===e.length}))&&(!n.form||n.form.$valid)},proceed:function(){return A.goToStep(-1===A.config.internet.kind.indexOf("dsl")?"setup-mac":"setup-ip")},destroy:function(){"setup-no-vlan"===n.option&&(A.internalConfig.noVlan=!0,A.config.iptv={}),n.manualSetup&&(n.inetVlan.length>0&&(A.config.internet.settings.vlan=n.inetVlan),n.iptvVlan.length>0&&(A.config.iptv={vlan:n.iptvVlan}),n.voipVlan.length>0&&(A.config.voip={vlan:n.voipVlan}))}};A.steps["setup-vlans"]&&(A.steps["setup-vlans"].ctrl=n)}(),function(){var e="setup-iptv-adsl-vpivci",t={_step:e,ready:!1,vpi:"",vci:"",vpiVciPairUsed:"",form:null,init:function(){t.vpi="",t.vci="",t.inetVpi=u.get(A,"config.internet.settings.vpi"),t.inetVci=u.get(A,"config.internet.settings.vci"),t.ready=!0},destroy:function(){A.internalConfig.skipIptv=t.formIsEmpty(),t.formIsEmpty()||(A.config.iptv=angular.merge(A.config.iptv||{},{vpi:t.vpi,vci:t.vci,encapsulation:A.config.internet.settings.encapsulation}))},checkVpiVciPair:function(){l(function(){t.vpi===t.inetVpi&&t.vci===t.inetVci?t.vpiVciPairUsed="initial-setup.setup-iptv-adsl-vpivci.error-same-vpi-vci-pair":t.vpiVciPairUsed=""})},formIsEmpty:function(){return!t.vpi&&!t.vci},canProceed:function(){return!t.form||t.form.$valid},proceed:function(){return A.goToStep("setup-ip")}};A.steps[e]&&(A.steps[e].ctrl=t)}(),function(){var e="initial-setup.check-iptv",n=m.translatePrefixCtor(e),i={_step:"check-iptv",ready:!1,state:null,success:!1,message:"",finished:!1,finishedMessage:"",stepList:[],iptvIsInBridgeMode:null,stage:0,errorCount:0,stepCounts:[5,2],init:angular.noop,getHeader:function(){return 0===i.stage?e+".header":i.finished&&!i.success?e+".header-fail":e+"."+(i.iptvIsInBridgeMode?"header-bridge":"header-proxy")},onShow:function(){i.stage=0,i.errorCount=0,i.stepList=i._getList(i.stage),i.finished=!1,i.message=n("messages.start");var e=A.config.internet.kind,t=A.config.internet.type;i.iptvIsInBridgeMode=("dsl"===e||"usbdsl"===e)&&"adsl"===t||Boolean(u.get(A,"config.iptv.vlan",!1))},_getList:function(e){for(var t=[],a=0;a<i.stepCounts[e];++a)t.push(n(["list-items",e,a].join(".")));return t},onBtnClick:function(e){i.state=e,("ok"===i.state?t.when(!0):_.isPortOccupied(_.iptvPort)).then(function(){C.hideAll(),i.nextStage()},function(){C.warning("initial-setup.check-iptv.error-check-port",3*A.constants.notificationTimeout)})},nextStage:function(){"ok"===i.state?(i.success=!0,i.finished=!0,i.finishedMessage=n(i.iptvIsInBridgeMode?"messages.success-bridge":"messages.success-proxy")):(i.errorCount++,1===i.errorCount?_.switchIptvMode(A.config,A.internalConfig,i.iptvIsInBridgeMode).then(function(){i.stage=1,i.stepList=i._getList(i.stage),i.iptvIsInBridgeMode=!i.iptvIsInBridgeMode}):(i.finished=!0,i.iptvIsInBridgeMode&&(_.switchIptvMode(A.config,A.internalConfig,!0),i.iptvIsInBridgeMode=!1),i.message=n("messages.fail")))},proceed:function(){return A.goToStep(A.internalConfig.internetFilter.availableFilters.length>0?"cyber-security":"wifi-settings")},destroy:angular.noop};A.steps["check-iptv"]&&(A.steps["check-iptv"].ctrl=i)}(),function(){var e=m.translatePrefixCtor("initial-setup.check-conn"),n={_step:"check-conn",_canProceed:!1,stage:"inet",error:"",status:"",progress:0,pollTimeout:null,lastPollError:"",askForRetry:!1,retrying:!1,askForRetryProgress:60,checkUpdatesCallCounter:0,checkUpdatesMaxCallNumber:3,updatesFinished:!1,inetCheckFailed:!1,connectionCheckFinished:!1,passedStages:[],maxTicks:0,curTick:0,createdIfaces:[],restoreQueries:[],restorePromises:[],deleteCreatedIfaces:!0,waitWhileUpdatingFirmware:function(e){var t=1e3*(e||I.MAX_FW_SIZE),i=I.FW_FLASHING_SPEED,a=I.FW_UPDATE_TIME+I.FW_SHUTDOWN_TIME,o=50,s={progress:null,reboot:null},r={onSuccess:1e3,updateProgress:((t/i||a)+I.FW_BOOT_TIME)/250,checkIfDeviceIsOnline:1500,checkIfDeviceIsOnlineFirstTime:1e4};n.rebootIsAbnormal=!1;!function e(){n.rebootIsAbnormal||(o+=.2,n.progress=m.round(o,1)),n.progress>=100?n.rebootIsAbnormal=!0:(s.progress&&l.cancel(s.progress),s.progress=l(e,r.updateProgress))}();s.reboot=l(function e(){var t=function(){s.reboot&&l.cancel(s.reboot),s.reboot=l(e,r.checkIfDeviceIsOnline)};_.updates.isDeviceOnline(A.internalConfig.deviceServicetag).then(function(e){e?(n.progress=100,n.stage="updates-finished",n.updatesFinished=!0,n.rebootIsAbnormal=!1,u.forEach(s,function(e){e&&l.cancel(e)}),l(n.finishUpdateProcess,r.onSuccess)):t()},t)},r.checkIfDeviceIsOnlineFirstTime)},onCheckUpdatesError:function(){n.error="can-not-check-updates",n.finishUpdateProcess()},onUpdateError:function(){return f.confirm(e("retry-updates-check"),"yes","no").then(function(){n.stage="updates-checking",n.checkUpdates()},n.finishUpdateProcess)},applyUpdates:function(){return n.progress=1,_.updates.update().then(function(e){n.stage="updates-applying",n.progress=50,n.status="system.system-files.upload-alert.install",n.waitWhileUpdatingFirmware(e.file_size)},n.checkUpdates,function(e){n.stage="updates-downloading",n.status="system.system-files.upload-alert.load-file",n.progress=angular.isDefined(e.progress)?Math.floor(e.progress["Components::Manager"]/2):0})},checkUpdates:function(){if(n.checkUpdatesCallCounter++,!(n.checkUpdatesCallCounter>n.checkUpdatesMaxCallNumber)){n.cancelPollingInternet(),n.error="",n.stage="updates-checking",n.status="system.components.status.connecting",n.progress=-1,n.isUpdating=!0;var e=_.updates.probeFactory(),t=_.updates.possibleStatuses;return e.then(function(e){return _.updates.check(!0).then(function(i){n.progress=0;var a,o=i.status;return o===t.connectionError?n.checkUpdates():(e||o===t.hasUpdates?a=n.applyUpdates():(n.stage="updates-not-needed",n.progress=100,a=n.finishUpdateProcess()),a)},n.checkUpdates)})}n.onCheckUpdatesError()},getProgress:function(){n.progress=m.round(++n.curTick/n.maxTicks*100)},cancelPollingInternet:function(){l.cancel(n.pollTimeout)},pollInternet:function(){return n._canProceed=!1,n.stage="polling-internet",_.internetCheck(A.config,A.internalConfig.ifaceName,A.internalConfig.tunnelName).then(function(t){if(t.status)return C.hideAll(),n.progress=100,n.connectionCheckFinished=!0,n.cancelPollingInternet(),n.passedStages.push({name:"inet",success:!0}),n.checkUpdates();if(t.error&&n.lastPollError!==t.error&&(C.hideAll(),n.lastPollError=t.error),n.progress>n.askForRetryProgress&&!n.retrying)return C.hideAll(),C.warning("initial-setup.check-conn.notifications.inet-error",-1),n.cancelPollingInternet(),n.askForRetry=!0,n.error="inet",void(n._canProceed=!0);if("cable"===t.error&&--n.skipCableErrors<0)if(-1!==u.get(A,"config.internet.kind","").indexOf("dsl")&&"idle"!==t.link&&n.msgId)C.hideAll(),n.msgId=null,_.clearDslStatusesArray(),n.error="wait-for-dsl";else{var i=O?"dsl":"usbdsl",a="dsl-isp"===A.config.internet.kind?i:A.config.internet.kind;n.error="cable",n.msgId=C.warning("initial-setup.check-conn.cable-error."+a,-1)}return"auth"===t.error?(n.cancelPollingInternet(),A.internalConfig.authError=!0,void("cdcEthernet"===A.config.internet.type?A.goToStep("g3-operator"):"3g"!==A.config.internet.kind&&"ipoe"!==A.internalConfig.subtype&&(n.deleteCreatedIfaces=!1,A.internalConfig.reconfigureTunnelOnly=!0,A.goToStep("logon")))):n.progress>100?(n.askForRetry=!1,n.retrying=!1,h.getIspConnectionState({main:A.internalConfig.ifaceName,ppp:A.internalConfig.tunnelName}).then(function(t){var i;n.connectionCheckFinished=!0,n.inetCheckFailed=!0,n.error="inet",i="3g"===A.config.internet.kind?m.generateHtmlTag("h3",e("3g-inet-check-failed-header"))+m.generateHtmlTag("div",e("3g-inet-check-failed-body")):e("interface-status")+": "+u.get(t,A.internalConfig.tunnelName?"ppp.text":"main.text"),n.passedStages.push({name:"inet",success:!1,additionalInfo:i})})):("cable"===t.error?(n.progress=-1,n.curTick=0):n.getProgress(),void(n.pollTimeout=l(n.pollInternet,1e3)))})},onShow:function(){P.acceptEveryLicense().then(function(){return n.__onShow()})},__onShow:function(){A.internalConfig.connectionCheckFinished=!1,A.internalConfig.authError&&delete A.internalConfig.authError;var i=A.config.internet.type,a=A.phyCheckIfaces[i];switch(n.skipCableErrors=0,A.config.internet.kind){case"dsl-isp":case"dsl":case"usbdsl":n.maxTicks=200;break;case"3g":n.maxTicks=60,n.skipCableErrors="lte"===i?30:10;break;default:n.maxTicks=100}n.passedStages=[],n.inetCheckFailed=!1,n.askForRetry=!1,n.retrying=!1,n.curTick=0,n.progress=0,n.checkUpdatesCallCounter=0,n.stage="init",n.error="",n.updatesFinished=!1,n._canProceed=!1,n.deleteCreatedIfaces=!0,n.createdIfaces=[],n.restoreQueries=[],n.restorePromises=[],n.afterApplyTimeoutId=null,n.connKindIsDsl=-1!==A.config.internet.kind.indexOf("dsl"),A.config.roles=angular.copy(A.selectedServices),l(function(){(A.internalConfig.ndmWanExists&&!O?_.ensureNdmWanIface():t.when({})).then(function(){if(A.internalConfig.reconfigureTunnelOnly){var t=u.get(A.config,"internet.settings.tunnel.settings",{});_.reconfigureTunnelIface(A.internalConfig.tunnelName,t.login,t.password).then(function(){n.stage="settings-applied",n.createdIfaces=A.internalConfig.restore.ifacesToDelete,n.restoreQueries=A.internalConfig.restore.queries,n.restorePromises=A.internalConfig.restore.promises,n.afterApplyTimeoutId=l(n.pollInternet,3e3)})}else{!function t(){n.cancelDisabled=!0,_.initEzconfig().then(function(){return _.apply(A.config,a).then(function(e){e.tunnelName&&u.set(A.config,"internet.settings.tunnel.name",e.tunnelName),A.internalConfig.ifaceName=e.mainIfaceName,A.internalConfig.bridgeName=e.bridgeIfaceName,A.internalConfig.tunnelName=e.tunnelName,A.internalConfig.restore=e.restore,A.internalConfig.iptv=angular.merge(A.config.iptv||{},e.iptv),n.stage="settings-applied",n.cancelDisabled=!1,n.createdIfaces=e.restore.ifacesToDelete,n.restoreQueries=e.restore.queries,n.restorePromises=e.restore.promises,n.afterApplyTimeoutId=l(n.pollInternet,3e3)},function(t){return h.getIspConnectionState({main:t.mainIfaceName,ppp:t.tunnelName}).then(function(i){n.connectionCheckFinished=!0,n.inetCheckFailed=!0,n.error="inet",n.passedStages.push({name:"inet",success:!1,additionalInfo:e("interface-status")+": "+u.get(i,t.tunnelName?"ppp.text":"main.text")})})})},function(){l(function(){return t()},1e3)})}()}})},300)},init:angular.noop,canProceed:function(){return n._canProceed},finishUpdateProcess:function(){var e={name:"updates-not-needed"===n.stage?"updates-not-needed":"updates",success:!0};if(n.passedStages.length<2?n.passedStages.push(e):n.passedStages[1]=e,"updates-not-needed"===n.stage)return n.inetConnectionIsOk=!0,n.updatesFinished=!0,n.askForRetry=!1,n.isUpdating=!1,n.inetRecheckInProcess=!1,void(n._canProceed=!0);n.stage="inet-recheck",n.progress=0,n.askForRetry=!1,n.inetRecheckInProcess=!0,n.status="",n.skipCableErrors="lte"===A.config.internet.type?30:10;var i=t.defer(),a=function(e){var t={name:"inet-recheck",success:!0};if(e.status)C.hideAll(),n.progress=100,n.passedStages.length<3?n.passedStages.push(t):n.passedStages[2]=t,i.resolve(!0);else{if("cable"===e.error&&--n.skipCableErrors<0)if(-1!==u.get(A,"config.internet.kind","").indexOf("dsl")&&"idle"!==e.link&&n.msgId)C.hideAll(),n.msgId=null,_.clearDslStatusesArray(),n.error="wait-for-dsl";else{var a="dsl-isp"===A.config.internet.kind?"dsl":A.config.internet.kind;n.error="cable",n.msgId=C.warning("initial-setup.check-conn.cable-error."+a,-1)}n.progress>100?(t.success=!1,n.passedStages.length<3?n.passedStages.push(t):n.passedStages[2]=t,i.resolve(!1)):(n.progress++,l(o,1e3))}},o=function(){_.internetCheck(A.config,A.internalConfig.ifaceName,A.internalConfig.tunnelName).then(a,a)};return o(),i.promise.then(function(e){n.inetConnectionIsOk=e,n.updatesFinished=!0,n.isUpdating=!1,n.inetRecheckInProcess=!1,n._canProceed=!0})},proceed:function(){if(n.askForRetry)return C.hideAll(),n.retrying=!0,n.passedStages=[],void n.pollInternet();n.deleteCreatedIfaces=!1;var e=function(){var e;e=A.internalConfig.skipIptv||"3g"===A.config.internet.kind||-1===A.selectedServices.indexOf("iptv")?n.inetConnectionIsOk&&A.internalConfig.internetFilter.availableFilters.length>0?"cyber-security":"wifi-settings":"check-iptv",A.goToStep(e)};(A.internalConfig.internetFilter.exists?_.internetFilter.getFilters():t.when([])).then(function(t){A.internalConfig.internetFilter.availableFilters=t,e()},e)},destroy:function(){if(l.cancel(n.afterApplyTimeoutId),C.hideAll(),n.askForRetry=!1,A.internalConfig.connectionCheckFinished=!0,n.cancelPollingInternet(),n.deleteCreatedIfaces)return delete A.internalConfig.type,delete A.internalConfig.ipType,delete A.internalConfig.serverAddress,delete A.internalConfig.subtype,_.restoreInterfaces(n.createdIfaces,n.restoreQueries,n.restorePromises)}};A.steps["check-conn"]&&(A.steps["check-conn"].ctrl=n)}(),function(){var e="cyber-security",t=m.translatePrefixCtor("initial-setup.cyber-security.internet-filter"),n={_step:e,init:function(){var e=A.internalConfig.internetFilter.availableFilters;e.unshift("none"),e=e.map(function(e){return{id:e,label:t(e)}}),n.internetFilter="none",n.internetFilterOptions=e},destroy:angular.noop,internetFilterOptions:[],proceed:function(){if("none"!==n.internetFilter)return _.internetFilter.setState(n.internetFilter,!0).then(n.goNextStep);n.goNextStep()},goNextStep:function(){return A.goToStep("wifi-settings")}};A.steps[e]&&(A.steps[e].ctrl=n)}(),function(){var e="wifi-settings",t={_step:e,ssid:"",psk:"",valuesOnInit:{ssid:"",psk:""},valuesOnEditStart:{ssid:"",psk:""},valuesChanged:!1,editMode:!1,finishing:!1,form:null,init:function(){return _.wifi.get().then(function(e){t.ssid=e.ssid,t.psk=e.psk,t.valuesOnInit={ssid:e.ssid,psk:e.psk},t.valuesOnEditStart=angular.copy(t.valuesOnInit)})},onShow:function(){return t.init()},destroy:function(){t.finishing=!1,t.editMode=!1},canProceed:function(){return Boolean(t.form)&&t.form.$valid},startEditing:function(){t.valuesOnEditStart.ssid=t.ssid,t.valuesOnEditStart.psk=t.psk,t.editMode=!0},cancelEditing:function(e){e.stopPropagation(),t.ssid=t.valuesOnEditStart.ssid,t.psk=t.valuesOnEditStart.psk,t.editMode=!1},saveSettings:function(e){e.stopPropagation(),t.editMode=t.form.$invalid||t.form.$pending,t.editMode||(t.form.$setPristine(),t.finish())},goToDashboard:function(){t.finishing=!0,A.goToDashboard().finally(function(){t.finishing=!1})},finish:m.debounce(function(){t.finishing=!0,l(function(){t.valuesChanged=t.valuesOnInit.ssid!==t.ssid||t.valuesOnInit.psk!==t.psk;var e=function(){A.internalConfig.connectedViaWifi&&t.valuesChanged&&(C.hideAll(),C.success("initial-setup.wifi-settings.notification.reconnected",A.constants.notificationTimeout)),t.editMode=!1,t.finishing=!1},n=e,i=0;A.internalConfig.connectedViaWifi&&(t.valuesChanged&&C.success("initial-setup.wifi-settings.notification.warning-settings-changed",-1),n=function(){_.updates.isDeviceOnline(A.internalConfig.deviceServicetag).then(function(t){t?i<4?(i++,l(n,2e3)):e():l(n,2e3)})}),_.wifi.set(t.ssid,t.psk).then(n)},A.constants.debounceTimeout)},A.constants.debounceTimeout)};A.steps[e]&&(A.steps[e].ctrl=t)}()}catch(e){alert(e)}var R,M}e.$inject=["WizardHandler","$q","$sce","$log","$state","$location","$scope","$rootScope","$timeout","$interval","$translate","$window","_","utils","modal","components","mobileOperatorsDb","interfaces","browserCheck","initialSetupService","rebootService","sysmode","system","notification","router","NDM","ipV4Service","modems","licensesService"],angular.module("keenetic").controller("InitialSetupController",e)}(),function(){function e(e,t,n,i,a,o){var s=this,r="OK",l="FAIL",c="UNLOCKED";s.ready=!1;var d=function(e){var t=e.show,n=t["last-change"]||{},a=t.identification,d=t.version,p=o.get(e,"factory.defaults",{}),u=p.country,m=p.wlanssid,f=p.wlanssid,g=a.mac;if(e.factory){var v=e.factory.mac||{},h=o.map(v,function(e,t){return"".concat(t,": ").concat(e,"<br/>")}).join("");g="<pre>".concat(h,"</pre>")}var b,_=[];switch(p.product&&_.push({label:"Product",data:p.product}),_=_.concat([{label:"Hardware ID",data:p.ndmhwid},{label:"FW version",data:d.release},{label:"MAC address",data:g},{label:"Wi-Fi country code",data:u||"undefined"},{label:"SSID 2.4 Ghz",data:m}]),i.profile.features.wifi5ghz&&_.push({label:"SSID 5 Ghz",data:f}),_=_.concat([{label:"WPA2 PSK",data:p.wlankey},{label:"WPS PIN",data:p.wlanwps},{label:"Serial No",data:a.serial},{label:"Service tag",data:a.servicetag},{label:"Checksum",data:p.ctrlsum},{label:"Locked",data:p.locked?'<span class="help-text--success">YES</span>':'<span class="help-text--warning">NO</span>'}]),b=p.locked?"ok"===p.integrity?r:l:c){case l:b='<span class="help-text--warning">FAIL</span>';break;case r:b='<span class="help-text--success">OK</span>'}_.push({label:"Integrity",data:b}),_.push({label:"Configuration is default",data:"default"===o.get(n,"agent","")&&Boolean(n["eula-status"])?'<span class="help-text--success">YES</span>':'<span class="help-text--warning">NO</span>'}),s.data=_,s.ready=!0};a.updates.probeFactory().then(function(t){if(!t)return e.go("dashboard");return n.postToRciRoot({show:{identification:{},version:{},defaults:{},"last-change":{}},factory:{mac:{},defaults:{}}}).then(d)})}e.$inject=["$state","utils","router","NDM","initialSetupService","_"],angular.module("keenetic").controller("QcController",e)}(),function(){function e(e,t,n,i,a,o,s,r,l,c,d,p,u,m,f,g,v,h,b,_,y,S,w,C,E){var I=this,T=g.TRACE_LOCAL_STORAGE_KEY,k={REST:"rest",PARSE:"parse",SELFTEST:"self-test"};w.checkAcceptance(),s.title="Web cli",s.uiViewClass="cli-ui-view",I.MODE=k,I.REQUEST_METHOD=y.REQUEST_METHOD,I.getInternetStatus=function(){return y.getInternetStatus().then(function(e){I.internetIsOk=e.internet&&e.reliable})},I.internetIsOk=!0,I.localSandbox="",I.mode=null,I.tabs=[{id:k.PARSE,label:"Parse"},{id:k.REST,label:"REST"},{id:k.SELFTEST,label:"Self-test reader"}],I.fileInputEl=null;var P={current:function(){var e,t,n,i=P;switch(I.mode){case k.PARSE:e=I.mode,t=function(){return{cmd:I.parse.cmd}},n=function(e){I.parse.cmd=e.cmd,I.rest.requestTime=null};break;case k.REST:e="".concat(I.mode,"_").concat(I.rest.method),t=function(){var e=I.rest;return{url:e.url,data:e.data}},n=function(e){var t=e.url,n=e.data;I.rest.url=t,I.rest.data=n,I.rest.requestTime=null,"{}"===I.rest.data&&(I.rest.data="{\n\n}")}}return i.getInstance(e,t,n)},getInstance:function(e,t,n){var i=P;return i.instances[e]||(i.instances[e]=new E(e,t,n,i.emptyDataRecord)),i.instances[e]},emptyDataRecord:{url:"",cmd:"",data:"{\n\n}"},instances:{}};I.history=P.current,I.onModeChange=function(e,n){I.mode=n.id,I.fileInputEl&&(I.fileInputEl.off("change",I.selfTest.onFileSelect),I.fileInputEl=null),i(function(){switch(I.mode){case k.SELFTEST:I.fileInputEl=t[0].getElementById(I.selfTest.inputId),I.fileInputEl&&(I.fileInputEl=angular.element(I.fileInputEl),I.fileInputEl.on("change",I.selfTest.onFileSelect));break;case k.PARSE:l.get(I,"parse.inputApi.setFocus",angular.noop)()}})};var A=function(e){return JSON.stringify(e,null,4)};I.parse={cmd:"",prompt:S.DEFAULT_CONTEXT,autocompleteOptions:[],response:"",responseIsNotEmpty:!1,expandDepth:99,queryIsInProgress:!1,inputIsInvalid:!1,sendRequest:function(){if(!I.parse.queryIsInProgress){var e=I.parse,t=Date.now();return e.errorMsg="",e.responseIsNotEmpty=!1,e.response="",e.queryIsInProgress=!0,y.parse(e.cmd).then(function(t){I.history().addItem(),e.response=t.parse,e.response.prompt&&(e.prompt=e.response.prompt,e.cmd="",i(e.inputApi.setFocus)),e.responseJson=l.trim(A(t.parse)),e.responseIsNotEmpty=!l.isEmpty(e.response)},function(t){e.response={},e.responseJson="",e.errorMsg="ERROR: "+A(t)}).finally(function(){e.queryIsInProgress=!1,e.requestTime=Date.now()-t})}},clearRequest:function(){I.parse.cmd="",l.forEach(t.find("input"),function(e){"cmd"===e.name&&e.focus()})},clearResponse:function(){I.parse.responseIsNotEmpty=!1,I.parse.response={},I.parse.responseJson="",I.parse.errorMsg=""},bgAutocompleteIsInProgress:!1,hintText:"",inputApi:null,inputFlags:{blurOnOptionChoice:!1,highlightMatch:!1,useRegexpToMatch:!1,showOptionsOnChange:!1,showOptionsOnFocus:!1,translateOptions:!1},autocomplete:{isInProgress:!1,dataCache:{},get:function(t){var n=I.parse,i=n.autocomplete,a="".concat(n.prompt,"__").concat(t);return i.dataCache[a]?e.when(i.dataCache[a]):(i.isInProgress=!0,S.getAutocompleteData(t).then(function(e){return i.set(t,e),e}).finally(function(){i.isInProgress=!1}))},set:function(e,t){var n=I.parse,i="".concat(n.prompt,"__").concat(e);n.autocomplete.dataCache[i]=t},doBackgroundAutocomplete:l.debounce(function(e){var t=I.parse,n=t.autocomplete;n.isInProgress||t.queryIsInProgress||n.get(e)},200),clearDataCache:function(){I.parse.autocomplete.dataCache={}},getEmptyStringAutocomplete:function(){I.parse.autocomplete.doBackgroundAutocomplete("")}},onInputInit:function(e,t){I.parse.inputApi=t},onInputChange:function(e){I.parse.hintText="",I.parse.autocomplete.doBackgroundAutocomplete(e)},onKey:function(e,t){var n=I.parse,a=I.parse.inputApi,o=a.getMatchingOptionsCount(),s=a.isDropdownExpanded();if(n.inputIsInvalid=!1,0===o||!s){if(d.isDownArrow(e))return I.history().goDown(),!1;if(d.isUpArrow(e))return I.history().goUp(),!1;if(t&&t.length>0&&d.isEnter(e))return n.queryIsInProgress||(n.cmd=t,n.sendRequest()),!1}if(d.isTab(e))return n.autocomplete.get(t).then(function(e){var t=e.options;n.cmd=e.cmd,n.inputIsInvalid=e.cmdIsInvalid,n.autocompleteOptions=t,n.hintText=e.hint,1!==t.length||!s&&n.cmd!==t[0].id?a.showOptions():(n.cmd=t[0].id,a.hideOptions())}),!1;if(d.isBackspace(e)&&t.length>1){var r=t.substr(0,t.length-2);i(n.inputApi.hideOptions),n.autocomplete.doBackgroundAutocomplete(r)}return d.isEnter(e)&&s&&-1===n.inputApi.getOptionInFocusIndex()?(n.queryIsInProgress||(n.cmd=t,n.sendRequest()),!1):void 0},copyResponseToClipboard:function(){return p.copyToClipboard(I.parse.responseJson)}},i(function(){return I.parse.autocomplete.getEmptyStringAutocomplete()},500);var D=a(function(){I.parse.autocomplete.clearDataCache(),I.parse.autocomplete.getEmptyStringAutocomplete()},5e3);o.$on("$destroy",function(){a.cancel(D)});var O=function(e){return"JSON parse error: "+e};I.rest={isTraceEnabled:!1,method:y.REQUEST_METHOD.POST,methodOptions:y.REQUEST_METHOD_OPTIONS,response:"",responseIsNotEmpty:!1,expandDepth:99,url:"",data:"{\n\n}",dataIsInvalid:!1,dataIsVisible:!0,requestEverMade:!1,requestTime:null,formatJson:function(e){return JSON.stringify(e,null,4)},clearRequest:function(){I.rest.url="",l.forEach(t.find("input"),function(e){"url"===e.name&&e.focus()})},onMethodChange:function(e){var t=I.rest;"POST"===e?(t.dataIsVisible=!0,t.validateData()):(t.dataIsInvalid=!1,t.dataIsVisible=!1),t.errorMsg=""},onTextareaCreate:function(e,t){t.on("keyup",I.rest.validateData),y.addTabSupportToTextarea(t[0].querySelector("textarea"))},onTextareaDestroy:function(e,t){t.off("keyup",I.rest.validateData)},clearResponse:function(){var e=I.rest;e.errorMsg="",e.responseIsNotEmpty=!1},resetDataInput:function(){I.rest.data="{\n\n}"},reformatDataInput:function(){var e=I.rest;if(e.data)try{var t=v.parse(e.data);e.errorMsg="",e.dataIsInvalid=!1,e.data=e.formatJson(t),"{}"===e.data&&(e.data="{\n\n}")}catch(t){e.responseIsNotEmpty=!1,e.errorMsg=O(t),e.dataIsInvalid=!0}},validateData:u(function(){var e=I.rest;if(e.data){e.errorMsg="",e.dataIsInvalid=!1;var t=function(t){e.responseIsNotEmpty=!1,e.errorMsg=O(t),e.dataIsInvalid=!0};try{var n=v.parse(e.data);l.isObject(n)||t("Only object allowed!")}catch(e){t(e)}}},400),sendRequest:function(){var e=I.rest;e.queryIsInProgress||i(function(){var t=e.method===y.REQUEST_METHOD.POST,n=Date.now();try{var i=t&&e.data?v.parse(e.data):"";return t&&!l.isObject(i)?(e.response=O("Only object allowed!"),e.dataIsInvalid=!0,void(e.responseIsNotEmpty=!1)):(e.dataIsInvalid=!1,e.responseIsNotEmpty=!1,e.response="",e.responseJson="",e.queryIsInProgress=!0,y.query(e.url,e.method,i).then(function(t){e.responseIsNotEmpty=""!==t,e.response=t,e.responseJson=l.trim(e.formatJson(t)),e.errorMsg="",I.history().addItem()},function(t){t.config&&delete t.config,t.continuedRequestData&&delete t.continuedRequestData,delete t.ndmErrors,e.responseIsNotEmpty=!0,e.errorMsg=e.formatJson(t)}).finally(function(){e.queryIsInProgress=!1,e.requestEverMade=!0,e.requestTime=Date.now()-n}))}catch(t){e.response=O(t),e.responseJson=e.response,e.validateData(),e.queryIsInProgress=!1}})},copyResponseToClipboard:function(){return p.copyToClipboard(I.rest.responseJson)},onIsTraceEnabledToggle:function(e){C.setItem(T,e),f.isTraceEnabled=e}};var N=C.getItem(T),L=!!N&&JSON.parse(N);I.rest.onIsTraceEnabledToggle(L),I.rest.isTraceEnabled=L;I.alert={isVisible:!1,title:"",closeButtonIsHidden:!0,text:"",count:0,progressBarIsVisible:!1,loadStatus:""};var x=function(e,t,n){e.forEach(function(e){e[t]=n})};I.selfTest={inputId:"self-test-file-input",showVersionTextareaIsVisible:!1,closeAlert:function(){I.alert.isVisible=!1},uiIsLocked:!1,lockUi:function(){return I.selfTest.uiIsLocked=!0,e.when(!0)},unlockUi:function(){return I.selfTest.uiIsLocked=!1,e.when(!0)},sandbox:"",sandboxOptions:p.idsToOptions(y.SANDBOXES_LIST,angular.identity),componentsToHide:["angular-ndw","base"],error:"",file:"",fileObj:null,fileData:{},replaceConfig:!1,replaceConfigDescription:"",showVersionData:"",componentsToInstall:[],componentsToRemove:[],deviceComponentsList:[],externalComponentsList:[],updateSandboxDescription:function(){I.selfTest.sandboxDescription=I.localSandbox?"Current sandbox is: ".concat(I.localSandbox):""},reset:function(){var e=I.selfTest;e.error="",e.file="",e.fileObj=null,e.fileData={},e.replaceConfig=!1,e.replaceConfigDescription="",e.sandbox=I.localSandbox||void 0,e.showVersionData="",e.componentsToInstall=[],e.componentsToRemove=[],I.alert={isVisible:!1,title:"",closeButtonIsHidden:!0,text:"",count:0,progressBarIsVisible:!1,loadStatus:""},e.updateSandboxDescription()},applyChanges:function(){return I.selfTest.lockUi().then(function(){if(!I.selfTest.replaceConfig)return e.when(!1);var t=I.selfTest.fileData,n={name:"startup-config",uploadUrl:"flash:startup-config",url:"flash:startup-config",file:new File([t.config],"startup-config.txt",{type:"text/plain",lastModified:new Date})},i=e.defer();return b.uploadFile(n).then(function(){return i.resolve(!0)},function(){return i.resolve(!1)}),i.promise}).then(function(e){var t=function(e){return e.filter(function(e){return e.isSelected}).map(function(e){return e.name})},n=t(I.selfTest.componentsToInstall),o=t(I.selfTest.componentsToRemove);if(I.internetIsOk&&(n.length>0||o.length>0||I.selfTest.sandbox&&I.selfTest.sandbox!==I.localSandbox)){var d=I.alert;return function e(){return d.isVisible=!0,d.progressBarIsVisible=!0,d.text="",d.title="Updating device components...",d.count=0,y.changeComponents(n,o,I.selfTest.sandbox).then(function(t){if(t.ndmErrors)return d.isVisible=!1,c.confirm(_.processNdssError(t.ndmErrors),"retry","cancel").then(e,I.unlockUi);var n=1e3*(t.file_size||f.MAX_FW_SIZE);if(n){d.count=50,d.loadStatus="Flashing firmware";var o=(Math.round(n/f.FW_FLASHING_SPEED)+f.FW_SHUTDOWN_TIME+f.FW_BOOT_TIME)/50,l=!1;i(function e(){l||y.checkIfDeviceConnectionRestored().then(function(){l=!0},function(){return i(e,5e3)})},1e4);var p=a(function(){d.count++,(d.count>=100||l)&&(d.count=100,d.isVisible=!1,a.cancel(p),I.selfTest.reset(),s.$broadcast("ndm:factory-reset"),i(function(){return r.reload()}))},o)}},null,function(e){d.isVisible=!0,d.progressBarIsVisible=!0,d.loadStatus="Connecting to the NDSS server";var t=l.get(e,"progress.Components::Manager",-1);t>0&&(d.count=Math.round(t/2),d.loadStatus="Downloading firmware")})}()}return e?h.rebootDevice().then(function(){var e=0,t=(f.FW_SHUTDOWN_TIME+f.FW_BOOT_TIME)/100,n=I.alert;n.progressBarIsVisible=!0,n.isVisible=!0,n.text="",n.count=0,n.title="Rebooting the device",n.loadStatus="Rebooting the deivce";var o=!1;i(function e(){o||y.checkIfDeviceConnectionRestored().then(function(){o=!0},function(){return i(e,5e3)})},1e4);var s=a(function(){(e>=100||o)&&(a.cancel(s),n.progressBarIsVisible=!1,n.isVisible=!1,I.selfTest.reset(),I.selfTest.unlockUi()),n.count=e++},t)}):(c.alert("Nothing to do"),I.selfTest.unlockUi())},I.selfTest.unlockUi)},reprocessLists:function(){I.selfTest.processComponentsLists(angular.copy(I.selfTest.deviceComponentsList),angular.copy(I.selfTest.externalComponentsList))},processComponentsLists:function(e,t){var n={},i={},a=[];t.forEach(function(e){n[e]=!0}),e.forEach(function(e){i[e]=!0}),t.forEach(function(e){i[e]?delete i[e]:a.push(e)});var o=Object.keys(i),s=I.selfTest,r=function(e){return{name:e,isSelected:!0}},c=function(e){return!l.includes(s.componentsToHide,e.name)};s.componentsToInstall=a.map(r).filter(c),s.componentsToRemove=o.map(r).filter(c)},onShowVersionDataPaste:function(e){var t=I.selfTest;t.error="",t.file="",t.fileObj=null,t.fileData={},t.replaceConfig=!1,t.replaceConfigDescription="",t.sandbox=I.localSandbox||void 0;var n="";y.getDeviceComponentsList().then(function(i){t.deviceComponentsList=i;try{var a=JSON.parse(e);n=l.get(a,"ndw.components","").split(",").sort(),t.externalComponentsList=n}catch(n){if(-1===e.indexOf("components:"))return void(t.error="ERROR: onShowVersionDataPaste: "+n);if(-1===(e=e.split("components:")[1]).indexOf("manufacturer:"))return void(t.error="ERROR: onShowVersionDataPaste: "+n);e=e.split("manufacturer:")[0],t.externalComponentsList=e.split(",").map(function(e){return l.trim(e)})}t.reprocessLists()})},viewConfig:function(){var e=I.selfTest,t=I.alert;t.text=e.fileData.config,t.isVisible=!0,t.title="Config",t.closeButtonIsHidden=!1},onFileSelect:function(e){I.selfTest.reset();try{var t=(e.srcElement||e.target).files[0],n=I.selfTest;if(!t)return;n.fileObj=t,n.file=t.name,I.selfTest.processSelfTestFile()}catch(e){I.selfTest.error="ERROR: onFileSelect: "+e}},processSelfTestFile:function(){if(I.selfTest.fileObj){var t=I.selfTest;return y.readSelfTestFile(I.selfTest.fileObj).then(function(n){return e.all([y.getDeviceComponentsList(),y.processSelfTest(n)]).spread(function(e,n){n.error?t.error=String(n.error):(t.fileData=n,t.sandbox=n.sandbox,t.updateSandboxDescription(),n.hwid!==I.hwid&&(t.replaceConfigDescription="LOADED SELF-TEST IS FROM ANOTHER MODEL!"),I.selfTest.deviceComponentsList=e,I.selfTest.externalComponentsList=n.components,I.selfTest.reprocessLists())})})}},selectAllToInstallComponents:function(){return x(I.selfTest.componentsToInstall,"isSelected",!0)},deselectAllToInstallComponents:function(){return x(I.selfTest.componentsToInstall,"isSelected",!1)},selectAllToRemoveComponents:function(){return x(I.selfTest.componentsToRemove,"isSelected",!0)},deselectAllToRemoveComponents:function(){return x(I.selfTest.componentsToRemove,"isSelected",!1)}},y.getVersionData().then(function(e){I.versionData=e,I.hwid=e.hw_id}),_.getComponentsList(null,10).then(function(e){I.localSandbox=l.get(e,"local.sandbox"),I.selfTest.updateSandboxDescription(),I.selfTest.sandbox=I.localSandbox||void 0})}e.$inject=["$q","$document","$window","$timeout","$interval","$scope","$rootScope","$state","_","modal","keyboard","utils","debounce","router","NDM","CONSTANT","relaxedJson","system","systemFilesService","componentsService","cli","cliAutocomplete","licensesService","localStorage","CliHistory"],angular.module("keenetic").controller("CliController",e)}(),function(){function e(e,t,n,i,a,o,s,r,l,c){var d=this,p=r.constant.DECT_RESTART_TIMEOUT;d.handsets=[],d.lines=[],d.dectStatus="",d.dataLoaded=!1,d.dectIsOn=!1,d.dectIsOff=!0,d.dectIsUnplugged=!0,d.dectIsRestarting=!1;var u=function(){d.l10n={noLines:a.getTranslation("".concat("dashboard.card_dect",".no-registered-lines"),null,a.l10n.getSrefChunks("controlPanel.dectLines",{},"ref")),noHandsets:a.getTranslation("".concat("dashboard.card_dect",".no-registered-handsets"),null,a.l10n.getSrefChunks("controlPanel.dectBase",{},"ref")),enableService:a.getTranslation("".concat("dashboard.card_dect",".dect-service-disabled"),null,a.l10n.getLinkChunks("action",{href:"#",class:a.LINK_CLASS,"ng-click":"vm.enableDectService($event)"}))}};e.$on("$destroy",t.$on("$translateChangeSuccess",function(){return n(u)})),u();var m=function(e,t){return t?("outgoing"===t.type||"internal"===t.type?"call-outgoing":"call-incoming")+(i.includes(t.type,"internal")?"--internal":""):"HUNG"},f=function(e,t){if(!t){var n=a.getTranslation("dashboard.card_dect.handset-status."+e.status),i="help-text";return"online"===e.status?i+="--success":"offline"===e.status&&(i+="--warning"),"<span class='"+i+"'>"+n+"</span>"}var o="";return o=t.duration?"<br/><span class='help-text'>"+("hold"===t.status||"on_hold"===t.status?'<span class="dect-handsets__paused"></span> ':"")+a.getSplittedTime(t.duration)+"</span>":"alerting"===t.status||"dialing"===t.status?"<br/><span class='help-text'>"+a.getTranslation("dashboard.card_dect.handset-status.alerting")+"</span>":"","<span class='phone-number'>"+t.number+"</span>"+o};c.registerCallback(["show.nvox.active-calls","show.nvox.sip-lines","show.nvox.info","show.nvox.handsets","show.nvox.status","show.rc.nvox","show.rc.service.nvox"],function(t,n,r,c,p,u,g){d.dectIsRestarting||(d.dectStatus=p&&o.DECT_STATUS[p.state]||o.DECT_STATUS_UNKNOWN);var v=i.get(c,"handset",[]),h=i.get(t,"active_calls.call",[]),b=s.createLineModels(r,n,u),_=i.get(u,"dect.handset",[]),y=u.sip||{};!function(e,t){for(var n=[],o=i.filter(t,function(e){return"initial"!==e.status&&!("call-incoming"!==e.status&&!e.number)}),s=0,r=o.length;s<r;s++){var l=o[s];"internal"===l.type&&o.push({line:l.line,number:l.hs,status:l.status,type:"incoming-internal",duration:l.duration,hs:l.number,startTime:l.start_time})}e.unshift({name:""}),e.forEach(function(e){var t=i.filter(o,{hs:e.name}).sort(function(e){return e.startTime>e.stopTime?-1:1});t.length?t.forEach(function(t,i){return n.push({name:e.name,callNum:i,line:"internal"===t.type||"incoming-internal"===t.type?a.getTranslation("dashboard.card_dect.internal-call"):t.line,startTime:t.startTime||0,status:f(e,t),icon:m(0,t),trackHash:["call",e.name,t.number,t.type,t.startTime].join("_")})}):e.name&&n.push({status:f(e,!1),icon:m(0,!1),line:"",name:e.name,trackHash:"idle__"+e.name,callNum:0})}),d.handsets=n}(l.createHSAndLinesModels(angular.isArray(v)?v:[],angular.isArray(_)?_:[],y).handsets.map(function(e){return e.sips.filter(function(e){return e.incoming||e.outgoing})||(e.status="unreachable"),e}),h),d.dectIsOff=!g,d.dectIsUnplugged=!r.plugged,d.lines=b.map(function(e){var t=i.find(d.lines,{id:e.id});return t&&(e.isEnabled=t.isEnabled),e.status=d.dectIsRestarting&&t?t.status:s.getLineStatus(e.status,d.dectStatus),e.status=s.colorizeLineStatus(e.status),e}),d.dataLoaded||(d.showCardContent=1,d.dataLoaded=!0,e.$parent.Dashboard.cardLoaded("dect"))}),d.toggleLineState=function(e,t){var i=t.split("--"),a=i[1];return s.toggleLineState(a,e).then(function(){e||(d.lines[i[2]].status=s.colorizeLineStatus(s.getDisabledLineStatus())),d.dectIsRestarting=!0,n(function(){d.dectIsRestarting=!1},p)})},d.enableDectService=function(e){"A"===e.target.tagName&&(d.dectIsOff=!1,l.toggleBaseState(!0))}}e.$inject=["$scope","$rootScope","$timeout","_","utils","dectCheck","dectLines","dectService","dectBaseService","dashboardDataService"],angular.module("keenetic").controller("DashboardCardDectController",e)}(),function(){function e(e){var t,n,i,a,o,s,r,l,c=(t=/,|\*|#/g,n=/^\d+(-\d+)?$/,i=function(e,t,n,i){i=i||0;var a=e.indexOf(t,i),o=e.indexOf(n,i);return a>-1?o>-1?Math.min(a,o):a:o>-1?o:-1},a=function(e,t,n){t=t.split(""),n=n||0;for(var i,a=t.length,o=e.length,s=o,r=0;r<a;++r)-1!==(i=e.indexOf(t[r],n))&&s>i&&(s=i);return s===o?-1:s},o=function(e,t,n,a){if(""===e)return!1;for(var o=a||e.indexOf(t),s=1;s>0;){if(-1===(o=i(e,t,n,o+1)))return!1;e[o]===t?++s:--s}return o},s=function(e){for(var i=e.split(t),a=0,o=i.length;a<o;++a){var s=i[a];if(s&&!n.test(s))return!1}return!0},r=function(e){for(var t,n="PT.x#1234567890>*+".split(""),i=0,a=e.length;i<a;++i)if(!(n.indexOf(e[i])>-1)){if("["!==e[i])return!1;if(!1===(t=o(e,"[","]",i))||!s(e.substr(i+1,t-i-1)))return!1;i=t}return!0},{isDigitmapValid:l=function(e){for(var t="PT.x#1234567890>*+()[]|-".split(""),n=0,i=e.length;n<i;++n)if(-1===t.indexOf(e[n]))return!1;var s=function e(t){for(var n,i,s=[],r=t.length,l=0;l<r;++l){if(-1===(n=a(t,"()|",l))){s.push(t.substr(l));break}if(n===r-1)break;if("|"===(i=t[n]))n>l&&s.push(t.substr(l,n-l)),l=n;else{if(")"===i)return!1;if(n>l&&s.push(t.substr(l,n-l)),!(l=o(t,"(",")",n)))return!1;var c=e(t.substr(n+1,l-n-1));if(!c)return!1;s=s.concat(c)}}return s}(e);if(!s)return!1;for(var l=0,c=s.length;l<c;++l)if(!r(s[l]))return!1;return!0},isValidSubstitution:function(t){return e.every(t.split("|"),function(e){return l(e)&&-1!==e.indexOf(">")})}});return{INVALID_DIGITMAP_L10N:"errors.invalid-digitmap",INVALID_SUBSTITUTION_L10N:"errors.invalid-prefix-substitution-rule",pin:function(e){if(e&&!function(e){return/^\d{4}$/.test(e)}(e))return"errors.invalid-pin"},digitmap:function(e){if(e&&!c.isDigitmapValid(e))return"errors.invalid-digitmap"},substitute:function(e){if(e&&!c.isValidSubstitution(e))return"errors.invalid-prefix-substitution-rule"},phoneNumber:function(e){if(e&&!function(e){var t,n=!1,i=e.length,a="*#+1234567890".split("");"+"===e[0]&&(e=e.substr(1,i-1),n=!0);for(var o=0,s=e.length;o<s;++o){if(t=e[o],-1===a.indexOf(t))return!1;if("+"===t){if(o<2||n)return!1;n=!0}}return!0}(e))return"errors.dect-invalid-phone-number"},parallelSequence:function(e){if(e&&!function(e){return/^[R\*\#]{1}[\*\#\d]{0,2}$/.test(e)}(e))return"errors.invalid-dect-parallel-sequence"}}}e.$inject=["_"],angular.module("keenetic").factory("dectValidators",e)}(),function(){function e(e,t){var n=function(){return e.post({url:"",data:t.set({},"show.rc",{nvox:{},service:_defineProperty({},"nvox",{})})})},i=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return function(i){return t.mapValues(e,function(e){return t.get(i,(n||"")+e.path,e.default)})}};return{constant:{SERVICE_NAME:"nvox",DECT_RESTART_TIMEOUT:6e3},ndmDataToModelCtor:i,modelToNdmDataCtor:function(e){var n={},i={};return t.forEach(e,function(e,t){n[e.path]=t,e.deleteExplicitly&&(i[e.path]=!0)}),function(e){var a={};return t.forEach(n,function(n,o){if(e[n])t.set(a,o,e[n]);else if(i[o]){var s=o.split(".");s.length>1&&s.pop(),t.set(a,s,{no:!0})}}),a}},getData:n,setData:function(t){return e.postAndSave(t)},getDataByMap:function(e,t){return n().then(i(e,t))},getObj2SetByMap:function(e,n){var i={};return t.forEach(e,function(e,a){t.set(i,e.path,t.isUndefined(n[a])?e.default:n[a])}),i}}}e.$inject=["router","_"],angular.module("keenetic").factory("dectService",e)}(),function(){function e(e,t,n,i,a,o,s,r,l,c,d,p){var u="UNMOUNTED",m="NOT_FOUND",f="UNDEFINED_DIR",g="".concat("ip.ssh",".sftp"),v="".concat("ip.http",".webdav"),h=s,b=h.getApps(),_=h.appsOrder,y=n.isEmpty(n.filter(angular.copy(b),"component")),S=l.createRequester();S.setPollInterval(3e3);var w=function(e,t,i){var o=e.rc||{},s=o.service,r=o.crypto||!1,l=e.dlna||!1,p=o.dlna||!1,u=o.torrent||!1,m=n.get(e,"torrent.status",{}),f=e.usb||!1,h=o.user,_=f.device||[],y=angular.copy(b),S=!0,w=e["sstp-server"]||!1,C=function(t,i,o){var s=n.get(e,"acme",{}),r=n.get(e,"ndns",{}),l=s["ndns-domain"],c=s["ndns-domain-acme"];if(i.error="",i.requirements={"keendns-name":l,"keendns-with-ssl":!l||c},"vpn-ikev2"===t&&(i.requirements["keendns-direct-mode"]=n.get(r,"ttp.direct",!1)),l&&!o&&(i.error="apps.".concat(t,".status.no-ssl-certificate")),i.actionRequired=!1,n.forEach(i.requirements,function(e,n){e||(i.actionRequired=!0),i.requirements[n]={text:a.getTranslation("apps.".concat(t,".requirements.")+n,null,a.l10n.getLinkChunks("req",{"ui-sref":"controlPanel.remoteAccess({tab: 'KeenDNS'})",class:"ref-link"})),fullfilled:e}}),i.requirements["keendns-name"]){var d="https://".concat(l);i.address=l,i.addressMsg=a.getTranslation("apps.".concat(t,".card-address-warning"),null,{ndnsName:a.generateLinkHtml(l,d,{target:"_blank",class:"ref-link"})})}};for(var E in _)if("media"===_[E].subsystem){S=!1;break}if((y=n.mapValues(y,function(f,g){var v={},b=f.tag||g,_=r[f.crypto];for(var E in s)f.service===E&&(f.enable=!0);if("dlna"===g&&p){f.directory=p["db-directory"]&&p["db-directory"].directory,f.notConfigured=!f.directory,f.scanning=!!l.scanning&&l.scanning;var I=n.get(l,"db",{});f.dirNotExists=!(f.notConfigured||I.mounted&&I.found),f.users=!0}if("udpxy"===g&&(f.enable=Boolean(s.udpxy)),"kabinet"===g&&(f.notConfigured=!n.get(o,"kabinet.server.address"),f.enable=Boolean(s.kabinet)),"torrent"===g&&u){f.dirNotExists="storage unplugged"===n.get(m,"state");var T=n.get(h,"".concat(t.user,".tag"),[]),k=f.enable&&!f.dirNotExists&&T.includes("torrent");f.directory=u.directory,f.notConfigured=!u.directory,f.transmissionPort=n.get(u,"rpc-port.port"),f.transmissionPortIsOpened=n.get(u,"rpc-port.public"),f.link={href:"/app/transmission/web?lang=".concat(a.getCurrentLanguage()),name:"apps.torrent.torrents-management",visible:k}}if("virtualIP"===g&&_&&(f.enable=_.enable&&s.ipsec,f.notConfigured=!_.psk),"vpn-l2tp"===g&&_&&(f.enable=_.enable&&s.ipsec,f.notConfigured=!_.psk),"vpn-ikev2"===g&&_&&f.component){var P=n.get(e,"acme.ndns-domain",""),A=n.find(i,{domain:P});C("vpn-ikev2",f,A),f.enable=_.enable&&s.ipsec&&!f.error}return"vpn-sstp"===g&&w&&f.component&&(C("vpn-sstp",f,w["has-ndns-certificate"]),f.enable=Boolean(w.enabled)&&!f.error),"storage"===f.dependency&&(f.noStorage=S),"dlna"!==g&&"udpxy"!==g&&"kabinet"!==g&&(n.forEach(h,function(e,t){var i=e.tag||[],a=i.indexOf(b)>-1;"private-cloud"===g&&n.forEach(y[g].toggles,function(a){n.includes(i,a.name)&&(a.users||(a.users=[]),a.name===c.TAGS.WEBDAV?a.users.push({name:t,hasPassword:!d.isUserPasswordEmpty(e)}):a.users.push(t))}),a&&(v[t]=angular.copy(e))}),f.users=!n.isEmpty(v)&&v),f}))["private-cloud"]){var I=n.get(o,v,{}),T=n.get(o,"ip.ftp",{}),k={ftp:T,sftp:Object.assign({},n.get(o,g,{}),{},n.get(o,"ip.ssh",{})),webdav:I};T&&(T.enable=s.ftp),y["private-cloud"].enable=n.get(k,"webdav.enable",!1)||n.get(k,"sftp.enable",!1)||n.get(k,"ftp.enable",!1),y["private-cloud"].toggles=n.map(y["private-cloud"].toggles,function(e){var t,i=k[e.name],a=n.get(i,c.INTERNET_ACCESS_ENABLED_PROP,!1),o=e.name===c.TAGS.WEBDAV?"ignoreNdmAcl":"anonAccess",s=n.get(e,"users",[]).some(function(e){return e.hasPassword});return Object.assign({users:!1,anonAccess:!1,ignoreNdmAcl:!1},e,(_defineProperty(t={noStorage:y["private-cloud"].noStorage,enable:n.get(i,"enable",!1),someUserHasPassword:s},o,n.get(i,"permissive",!1)),_defineProperty(t,"internetAccess",a),t))})}return y.cifs.anonAccess=n.get(o,"cifs.permissive"),y.afp.anonAccess=n.get(e,"afp.permissive"),y},C=function(){var e=p.sysmode,t=b.virtualIP,i=b["vpn-sstp"],a=i&&i.component&&i.sysMode===e,s=b["vpn-l2tp"],r={show:{rc:{service:{},user:{}}}},l=r.show,c=l.rc,d=b["vpn-ikev2"],u=d&&d.component&&d.sysMode===e;return y?o.usb&&(r=n.set(r,"show.usb",{})):((t&&t.component||s&&s.component)&&(t&&t.sysMode===e||s&&s.sysMode===e)&&(c.crypto={}),o.ftp&&n.set(c,"ip.ftp",{}),(o.webdav||a)&&n.set(c,"ip.http",{}),o.sftp&&n.set(c,"ip.ssh",{}),n.get(b,"dlna.component")&&(l.dlna={},c.dlna={}),n.get(b,"torrent.component")&&(c.torrent={},r.whoami={},l.torrent={status:{}},n.set(r,"show.rc.user",{}),o.cloudcontrol&&(l.ndns={}),l.interface={name:p.LAN_SWITCH,mac:{}}),n.get(b,"cifs.component")&&(c.cifs={}),n.get(b,"afp.component")&&(l.afp={}),n.get(b,"kabinet.component")&&(c.kabinet={}),(a||u)&&(c.ip||(c.ip={}),l.ndns={},l.acme={}),u&&n.set(r,"ip.http.ssl.acme.list",{}),a&&(l["sstp-server"]={}),o.usb&&(l.usb={})),r},E=function(){return i.post(C()).then(function(e){return w(e.show,e.whoami,n.get(e,"".concat("ip.http.ssl.acme.list",".certificate"),[]))})},I=function(){return S.startPolling()},T=function(e){return n.chain(e).split(":").get(0).replace(/\/$/,"").replace(/:$/,"").value()},k=function(e){return e?n.set({},"ls.directory",e):{}},P=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:u;return n.isEmpty(e)?{error:t}:n.has(e,"ls.status")?{error:m}:e.ls},A=function(e,t){return n.chain(t).get("entry",{}).some(function(t){return"V"===t.type&&n.includes([t.label,t.uuid],e)}).value()},D=function(e){var t=e.map(T);return i.get({url:"ls",noRetry:!0}).then(function(e){return t.map(function(t){return A(t,e)})})},O=function(e,t){var a=[];return"sftp"===e?(a.push(n.set({},g,{enable:t})),t&&a.push(n.set({},"service.ssh",{enabled:!0}))):"webdav"===e?a.push(n.set({},v,{enable:t})):a.push(n.set({},["service",e],{no:!t})),i.postAndSave(a)};return{appsOrder:_.slice(),formatStatData:function(e){return e.txbytes&&e.rxbytes?[a.format.size(Number(e.txbytes)),"/",a.format.size(Number(e.rxbytes))].join(" "):"-"},toggleService:O,getApps:E,getAppsStates:w,toggleApp:function(e,t,a){var o=b[e],s=O;return o.toggleIpsec&&(s=function(e,t){return function(e,t,a,o){return r.getAllIpsecEntities().then(function(s){var r,l=s.crypto[t];return l.enable=o,o?r=!0:o||(r=n.filter(s.enabled,function(t){return t!==e}).length>0),i.postAndSave([n.set({},["service",a],{no:!r}),n.set({},["crypto",t],l)])})}(o.cryptoMapName,o.crypto,o.service,t)}),o.customToggleFn&&(s=t.customToggleFn),s(t.service,a)},initApplicationsPolling:function(e){S.registerCallback(C(),function(){return E().then(function(t){return e&&e(t),t})}),I()},stopPolling:function(){return S.stopPolling()},startPolling:I,resetPolling:function(){return S.clearCallbacks()},getVolumeName:T,isVolumeMounted:A,checkIfArrayOfDirsMounted:D,getDirectoriesInfo:function(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(0===t.length)return e.when([]);var a={noRetry:!0,silent:!0};if(!n){var o=t.map(k);return i.postToRciRoot(o,a).then(function(e){return e.map(function(e){return P(e,f)})})}return D(t).then(function(e){var n=t.map(function(t,n){return e[n]?k(t):{}});return i.postToRciRoot(n,a)}).then(function(e){return e.map(P)})},getLsQuery:k}}e.$inject=["$q","$parse","_","router","utils","components","appsPresets","ipsecConnectionsService","requesterFactory","privateCloudService","usersService","NDM"],angular.module("keenetic").factory("appsService",e)}(),function(){function e(e,t,n,i,a,o){var s,r={PRIVATE_CLOUD:"private-cloud",TORRENT:"torrent",CIFS:"cifs",DLNA:"dlna",AFP:"afp",UDPXY:"udpxy",KABINET:"kabinet",VPN_PPTP:"vpn-server",VPN_L2TP_OVER_IPSEC:"vpn-l2tp",VPN_IPSEC_VIRTUAL_IP:"virtualIP",VPN_SSTP:"vpn-sstp",VPN_IKEV2:"vpn-ikev2",VPN_PPTP_STAT:"vpn-server-stat",VPN_L2TP_OVER_IPSEC_STAT:"vpn-l2tp-stat",VPN_IPSEC_VIRTUAL_IP_STAT:"virtualIP-stat",VPN_SSTP_STAT:"vpn-sstp-stat",VPN_IKEV2_STAT:"vpn-ikev2-stat"},l=[r.PRIVATE_CLOUD,r.TORRENT,r.CIFS,r.DLNA,r.AFP,r.VPN_PPTP,r.VPN_L2TP_OVER_IPSEC,r.VPN_IPSEC_VIRTUAL_IP,r.VPN_SSTP,r.VPN_IKEV2,r.UDPXY,r.KABINET],c=(_defineProperty(s={},r.PRIVATE_CLOUD,{component:i.ftp||i.sftp||i.webdav,title:"apps.private-cloud.card-title",dependency:"storage",customToggleFn:function(e,t){return o.toggleState(t)},toggles:[{name:"webdav",title:"apps.private-cloud.webdav-server",component:i.webdav},{name:"sftp",title:"apps.private-cloud.sftp-server",component:i.sftp},{name:"ftp",title:"apps.private-cloud.ftp-server",component:i.ftp}]}),_defineProperty(s,r.KABINET,{component:Boolean(i.kabinet),service:"kabinet",title:"apps.kabinet.card-title",sysMode:"router"}),_defineProperty(s,r.UDPXY,{component:Boolean(i.udpxy),service:"udpxy",title:"apps.udpxy.card-title",sysMode:"router"}),_defineProperty(s,r.TORRENT,{component:Boolean(i.transmission),service:"torrent",title:"apps.torrent.card-title",dependency:"storage"}),_defineProperty(s,r.DLNA,{component:Boolean(i.dlna),service:"dlna",title:"apps.dlna.card-title",dependency:"storage"}),_defineProperty(s,r.VPN_PPTP,{component:Boolean(i.vpnserver),service:"vpn-server",title:"apps.vpn.card-title",tag:"vpn",sysMode:"router"}),_defineProperty(s,r.CIFS,{component:Boolean(i.cifs)||Boolean(i.tsmb),service:"cifs",title:"apps.cifs.card-title",dependency:"storage",tag:"cifs",printersTag:"printers"}),_defineProperty(s,r.AFP,{component:Boolean(i.afp),service:"afp",title:"apps.afp.card-title",dependency:"storage",tag:"afp"}),_defineProperty(s,r.VPN_SSTP,{component:Boolean(i["sstp-server"])&&Boolean(i.cloudcontrol),title:"apps.vpn-sstp.card-title",service:"sstp-server",tag:"sstp",sysMode:"router",customToggleFn:function(t,i){return n.get("ip/http/ssl").then(function(a){var o=[e.set({},["service",t],{no:!i})];return Boolean(i)&&!a.enable&&o.push(e.set({},"ip.http.ssl.enable",!0)),o.push(n.saveQueryStr().data),n.post({url:"",data:o})})}}),_defineProperty(s,r.VPN_IKEV2,{component:Boolean(i.ipsec)&&Boolean(i.cloudcontrol),service:"ipsec",cryptoMapName:"VirtualIPServerIKE2",title:"apps.vpn-ikev2.card-title",dependency:"ipsec",tag:"ipsec-xauth",crypto:"virtual-ip-server-ikev2",toggleIpsec:"ikev2",sysMode:"router"}),_defineProperty(s,r.VPN_L2TP_OVER_IPSEC,{component:Boolean(i["vpnserver-l2tp"]),service:"ipsec",cryptoMapName:"VPNL2TPServer",dependency:"ipsec",title:"apps.vpn-l2tp.card-title",tag:"ipsec-l2tp",crypto:"l2tp-server",toggleIpsec:"virtualIP",sysMode:"router"}),_defineProperty(s,r.VPN_IPSEC_VIRTUAL_IP,{component:Boolean(i.ipsec),service:"ipsec",cryptoMapName:"VirtualIPServer",title:"apps.virtualIP.card-title",dependency:"ipsec",tag:"ipsec-xauth",crypto:"virtual-ip-server",toggleIpsec:"vpn-l2tp",sysMode:"router"}),_defineProperty(s,r.VPN_L2TP_OVER_IPSEC_STAT,{title:"apps.vpn-l2tp-stat.card-title",sysMode:"router"}),_defineProperty(s,r.VPN_SSTP_STAT,{title:"apps.vpn-sstp-stat.card-title"}),_defineProperty(s,r.VPN_PPTP_STAT,{title:"apps.vpn-stat.card-title",sysMode:"router"}),_defineProperty(s,r.VPN_IPSEC_VIRTUAL_IP_STAT,{title:"apps.virtualIP-stat.card-title",sysMode:"router"}),_defineProperty(s,r.VPN_IKEV2_STAT,{title:"apps.vpn-ikev2-stat.card-title",sysMode:"router"}),s);return{APPS:r,getApps:function(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?angular.copy(c):e.pickBy(angular.copy(c),function(e){return!e.sysMode||e.sysMode===a.sysmode})},appsOrder:l}}e.$inject=["_","utils","router","components","NDM","privateCloudService"],angular.module("keenetic").factory("appsPresets",e)}(),function(){function e(e,t,n,i,a,o,s,r,l,c,d,p,u,m,f,g,v){var h=this;h.l10n={},h.progress=30,h.getPrivateCloudServiceStatus=v.getPrivateCloudServiceStatus,h.appsUpdate=function(e){return e?(d.forEach(e,function(e,t){h.apps[t].toggleUpdated?h.apps[t].toggleUpdated=!1:("dlna"===t&&(e.scanningText=e.scanning?h.translates.scanning+": "+e.scanning:""),angular.extend(h.apps[t],e))}),e):m.getApps().then(function(e){h.apps=angular.copy(e),h.appNamesInOrder=m.appsOrder;var t=d.pickBy(e,function(e){return e.component}),n=0;h.appNamesInOrder.forEach(function(e){e&&t[e]&&(h.apps[e].left=n%2==0,n++)}),h.appNamesInOrder=h.appNamesInOrder.slice().filter(Boolean)})},h.actions={dlnaRescan:function(){h.apps.dlna.toggleUpdated=!0,f.rescanDb(),h.apps.dlna.scanning=""}},h.toggles={service:function(e,t){var n=t.replace("apps_",""),i=h.apps[n];if(!i.notConfigured)return i.toggleUpdated=!0,m.toggleApp(n,i,e);h.apps[n].enable=!1,h.popup.open(!0,n)},subservice:function(e,t){var n=_slicedToArray(t.replace("apps_","").split("_"),2),i=n[0],a=n[1];return d.find(h.apps[i].toggles,{name:a}).enable=e,m.toggleService(a,e)}},h.onKeydown=function(e,t){if(!u.isEnter(e))return!0;e.preventDefault(),i.go("controlPanel.apps.".concat(t)),m.stopPolling()},h.currentPopup="",h.showPopup={},d.forEach(m.appsOrder.concat(["vpn-server-stat","vpn-l2tp-stat","virtualIP-stat","vpn-sstp-stat","vpn-ikev2-stat"]),function(e){h.showPopup[e]=function(){h.currentPopup=e,m.stopPolling()}}),h.popup={open:function(e,t){!0!==e&&d.includes(["LABEL","INPUT"],e.target.tagName)||i.go("controlPanel.apps."+t)},close:function(){h.currentPopup&&(h.currentPopup="",m.startPolling())}},h.openPrinterPopup=function(e){t(function(){return o.$broadcast("apps-open-printer-popup",e)})},h.openStoragePopup=function(e){var t="internal"===e.uuid;m.stopPolling();var n={removableOnly:!t};"all"!==e.uuid&&(n.volume=(t?"storage":e.uuid)+":"),g(n).then(function(){m.startPolling()})},h.openAllPartitionsPopup=function(e){var t=e.mediaId,n=e.mediaData;m.stopPolling();var i=d.get(n,"partitions",[]);g({removableOnly:!0,mediaId:t,partitions:i}).then(function(){m.startPolling()})},h.translates={scanning:r.getTranslation("apps.dlna.scanning"),partitionsPrefix:r.getTranslation("apps.partitions-prefix"),partitions:r.getTranslation("apps.partitions")},h.appsUpdate().then(function(){"controlPanel.apps"!==i.current.name&&t(m.stopPolling)}).then(function(){h.progress=100,h.initialized=!0;var e=angular.copy(h.apps);h.noAppsInSysmode=!d.isEmpty(e)&&d.isEmpty(d.filter(e,"component")),h.l10n.noAppsInSysmode=r.getTranslation("apps.no-apps-in-sysmode",null,{sysmode:r.getTranslation("dashboard.card_system."+p.sysmode)}),h.loading=!1,m.initApplicationsPolling(h.appsUpdate)}),h.loading=!0,a.$on("$destroy",function(){return m.resetPolling()})}e.$inject=["$q","$timeout","$location","$state","$scope","$rootScope","notification","utils","router","components","_","NDM","keyboard","appsService","dlnaService","fsBrowser","privateCloudService"],angular.module("keenetic").controller("AppsController",e)}(),function(){function e(e,t,n){return{templateUrl:"app/components/ndm-schedule/ndm-schedule-thumb/ndm-schedule-thumb.html",transclude:!1,replace:!1,link:function(i,a){var o=function(i,a){var o={length:1440,height:126,width:240,top:17,firstDay:isNaN(a-0)?1:(Math.round(a-0)%7+7)%7,left:22,bottom:5,right:22,row:18,scale:240/1440},s="ndm-schedule-thumb--svg-container--",r={setData:function(e){if(!angular.isArray(e)||!e.length)return;for(var t=angular.copy(e),i=0;i<t.length;i++)t[i][2]=((t[i][2]-o.firstDay)%7+7)%7;c?n(function(){d(t)},100):d(t);c=!1}},l=[],c=!0;function d(e){angular.isArray(e)||(e=[]),l.forEach(function(e,t){e.remove(),delete l[t]}),l=[],function(e){e=e.length&&e||[];var t={0:[],1:[],2:[],3:[],4:[],5:[],6:[]},n=[];for(var i in e.forEach(function(e){t[Number(e[2])]&&t[Number(e[2])].push([e[0],e[1]])}),t)a(t[i]).forEach(function(e){Math.abs(e[0]-e[1])>0&&n.push([Number(e[0]),Number(e[1]),Number(i)])});function a(e){for(var t=0;t<e.length;t++)for(var n=0;n<e.length;n++)if(t!==n&&e[t][0]<=e[n][0]&&e[t][1]>=e[n][0]){var i=[[e[t][0]<e[n][0]?e[t][0]:e[n][0],e[t][1]>e[n][1]?e[t][1]:e[n][1]]];return e.forEach(function(e,a){Number(a)!==Number(t)&&Number(a)!==Number(n)&&i.push(e)}),a(i)}return e}return n}(e).forEach(function(e){var t,n,i,a,r;t=e[0],n=e[1],i=e[2],a=p("rect",{class:s+"pattern",height:o.row,width:Math.round(n-t)*o.scale,x:t*o.scale+o.left,y:o.row*i+o.top}),r={remove:function(){a.remove()}},l.push(r)})}function p(t,n){var a=e[0].createElementNS("http://www.w3.org/2000/svg",t);function o(e,t){a.setAttributeNS(null,t,e)}angular.forEach(n,o),i.appendChild(a);var s={attr:function(e,t){return o(t,e),s},element:a,remove:function(){a.remove()}};return s}return o.row=Math.round(o.height/7),o.scale=o.width/o.length,u=o.height+o.top+o.bottom,m=o.width+o.left+o.right,i.setAttribute("width",m),i.setAttribute("height",u),i.setAttribute("viewBox","0 0 "+m+" "+u),n(function(){p("rect",{x:o.left,y:o.right,width:o.width,height:o.height,class:s+"background"});for(var e=0;e<7;e++)(e+1)%2||p("rect",{x:o.left,y:e*o.row+o.top,height:o.row,width:o.width,class:s+"grid-odd-day"});for(var n=1;n<24;n++){var i=o.left+Math.round(60*n*o.scale);p("line",{x1:i,x2:i,y1:o.top,y2:o.height+o.top,class:s+(n%3?"grid-line-1-hour":"grid-line-3-hours")})}p("rect",{x:o.left,y:o.top,width:o.width,height:o.height,class:s+"grid-borders"});for(var a=0;a<=24;a++)if(!(a%3)){var r=p("text",{x:0,y:10,class:s+"grid-label"});r.element.textContent=a;var l=0;try{l=Math.round(r.element.getBBox().width/2)}catch(e){}r.attr("x",o.left+60*a*o.scale-l)}for(var c=0;c<7;c++){var d=p("text",{x:0,y:o.top+o.row*c+Math.round(o.row/2)+4,class:s+"grid-label"});d.element.textContent=t.getTranslation("weekday-short."+(c+o.firstDay)%7)}for(var u=0;u<7;u++){var m=p("text",{x:o.left+o.width+5,y:o.top+o.row*u+Math.round(o.row/2)+4,class:s+"grid-label"});m.element.textContent=t.getTranslation("weekday-short."+(u+o.firstDay)%7)}},100),r;var u,m}(a[0].querySelector("svg.ndm-schedule-thumb--svg-container"),i.firstDay);i.$watch("data",function(e){angular.isArray(e)&&o.setData(e)})},restrict:"E",scope:{data:"=",firstDay:"="}}}e.$inject=["$document","utils","$timeout"],angular.module("keenetic").directive("ndmScheduleThumb",e)}(),function(){function e(e,t,n,i,a,o,s){return r.$inject=["$scope","$element","$attrs"],{templateUrl:"app/components/ndm-schedule/ndm-schedule-select/ndm-schedule-select.html",transclude:!1,replace:!0,link:r,restrict:"E",scope:{model:"=",name:"@",title:"@label",isDisabled:"<",initialData:"<",noSelectedThumb:"@",noScheduleLabel:"@?"}};function r(t,r,l){t.vm={};var c=t.vm;c.onChange=function(e){t.model!==c.NEW_OPT&&(c.lastValue=t.model),e===c.NEW_OPT&&c.edit(!0),v(e)};var d=function(){t.title=l.title?t.title:g("default-title")};d(),c.loaded=!1,c.opened=!1,c.thumb=!1,c.thumbData=[],c.NEW_OPT=n.ADD_SCHEDULE_OPTION_ID,c.NO_SCHEDULE_OPT="",c.editId=!1,t.model=t.model||"",c.lastValue=t.model;var p={};function u(e){p=e,function(e){c.options=s.sortBy(s.map(e,function(e){var t=e.description,n=e.id;return{id:n,label:t||n}}),"label"),c.options.unshift({id:c.NO_SCHEDULE_OPT,label:h()}),c.options.push({id:c.NEW_OPT,label:g("options.add")}),c.loaded=!0,e[t.model]||(t.model="")}(e),c.onChange(t.model)}function m(){return n.getSchedules().then(u)}t.$on("$destroy",t.$on("NDM-SCHEDULES-SAVED",m)),c.edit=function(e){c.editId=e},c.editorClosed=function(){t.model===c.NEW_OPT&&(t.model=c.lastValue,c.onChange(c.lastValue)),c.editId=!1},c.editorSaved=function(e){t.model=e.id},t.$watch("model",v),c.onFocusChange=v;var f=function(){return o.initInternalTimer()};function g(e){return a.getTranslation("schedules.select."+e)}function v(e){c.thumb=!1,e&&p[e]&&p[e].action&&(c.thumbData=i.actionsToPatterns(p[e].action),c.thumb=!0)}function h(){return t.noScheduleLabel||g("options.none")}t.initialData?(u(n.processSchedules(t.initialData)),f()):m().then(f),c.onHover=function(e){!1===e?(c.hovering=!1,v(t.model)):(c.hovering=!0,v(e))};var b=function(){c.options=s.map(c.options,function(e){var t=e.id;return s.includes([c.NEW_OPT,c.NO_SCHEDULE_OPT],t)?t===c.NO_SCHEDULE_OPT?{id:t,label:h()}:{id:t,label:g("options.add")}:e})};b(),t.$on("destroy",e.$on("$translateChangeSuccess",function(){b(),d()}))}}e.$inject=["$rootScope","$timeout","schedules","schedulesTimeCoder","utils","keeneticTime","_"],angular.module("keenetic").directive("ndmScheduleSelect",e)}(),function(){function e(e,t,n,i,a,o,s,r,l,c,d,p,u){return m.$inject=["$scope"],{templateUrl:"app/components/ndm-schedule/ndm-schedule-editor/ndm-schedule-editor.html",transclude:!1,replace:!0,link:m,restrict:"E",scope:{scheduleId:"=",onSave:"=",onClose:"="}};function m(r){r.vm={};var c=r.vm;c.id=!1,c.visible=!1,c.form={},c.currentDate=null,c.currentTime="",c.ntpServiceLink=d.getTranslation("schedules.editor.enable-auto-time-sync",null,d.l10n.getLinkChunks("ref",{class:"ref-link","ng-click":"vm.onNtpLinkClick($event)"})),c.onNtpLinkClick=function(){var e=d.getTranslation("system.system-settings.set-time-automatically"),i=n.$on(u.events.PAGE_LOADED,function(){d.dom.highlightFirstMatchedElement([e]),i()});t.go("controlPanel.system")},c.data={description:"",draw:[]},r.$on("$destroy",r.$watch("scheduleId",function(t){var n,i=t&&angular.isString(t)||!0===t;i&&!c.visible?(n=t,c.id=!(!0===n||!n)&&n,(c.id?m(n):e.when(!0)).then(function(){return p.initInternalTimer()}).then(function(){return p.isNtpServiceEnabled()}).then(function(e){c.currentDate=p.getInternalTimerValue(),c.isNtpEnabled=e,f(),c.visible=!0})):!i&&c.visible&&g()})),c.close=function(){o(g)},c.save=function(){var e={id:c.id,description:c.data.description,action:a.patternsToActions(c.data.draw)};i.save(e).then(function(e){angular.isFunction(r.onSave)&&o(function(){return r.onSave(e)}),g()})},c.delete=function(){s.confirm("schedules.editor.delete-confirm").then(function(){i.del(c.id).then(g)})};var m=function(e){return i.getSchedule(e).then(function(e){c.data.draw=a.actionsToPatterns(e.action),c.data.description=e.description})},f=function(){var e=l.invoke(c.currentDate,"toTimeString")||"";c.currentTime=e.split(" ")[0]};function g(){c.visible=!1,c.id=!1,angular.isFunction(r.onClose)&&o(function(){return r.onClose()}),r.scheduleId=!1}var v=p.subscribeToInternalTimer(function(e){c.currentDate=e,f()});r.$on("$destroy",function(){return p.unsubscribeFromInternalTimer(v)})}}e.$inject=["$q","$state","$rootScope","schedules","schedulesTimeCoder","$timeout","modal","systemSettingsService","_","router","utils","keeneticTime","CONSTANT"],angular.module("keenetic").directive("ndmScheduleEditor",e)}(),function(){function e(e,t,n,i){return a.$inject=["scope","element","attr","ngModel"],{require:"^ngModel",templateUrl:"app/components/ndm-schedule/ndm-schedule-draw/ndm-schedule-draw.html",transclude:!1,replace:!1,link:a,restrict:"E",scope:{ngModel:"=",firstDay:"="}};function a(a,o,s,r){var l=function(a,o){var s={length:1440,quantize:30,height:210,width:720,top:30,firstDay:isNaN(o-0)?0:(Math.round(o-0)%7+7)%7,left:28,bottom:40,right:28,row:30,scale:.5},r=[],l=[],c=!0,d="ndm-schedule-draw--svg-container--",p={setData:function(e){if(!angular.isArray(e)||!e.length)return;for(var t=angular.copy(e),n=0;n<t.length;n++)t[n][2]=((t[n][2]-s.firstDay)%7+7)%7;c?i(function(){E(t)},100):E(t);c=!1},getData:u,onChange:function(e){l.push(e)}};function u(){for(var e=I(),t=0;t<e.length;t++)e[t][2]=(e[t][2]+s.firstDay)%7;return e.sort(function(e,t){return e[0]-t[0]}),e}function m(){var e=u();l.forEach(function(t){angular.isFunction(t)&&t(e)})}s.row=Math.round(s.height/7),s.scale=s.width/s.length,f=s.height+s.top+s.bottom,g=s.width+s.left+s.right,a.setAttribute("width",g),a.setAttribute("height",f),a.setAttribute("viewBox","0 0 "+g+" "+f),i(function(){T("rect",{x:s.left,y:s.right,width:s.width,height:s.height,class:d+"background"});for(var e=0;e<7;e++)(e+1)%2||T("rect",{x:s.left,y:e*s.row+s.top,height:s.row,width:s.width,class:d+"grid-odd-day"});for(var t=.5;t<24;t+=.5){var i=s.left+Math.round(60*t*s.scale),a=void 0;a=t%3?t%1?"30-min":"1-hour":"3-hours",T("line",{x1:i,x2:i,y1:s.top,y2:s.height+s.top,class:d+"grid-line-"+a})}T("rect",{x:s.left,y:s.top,width:s.width,height:s.height,class:d+"grid-borders"});for(var o=0;o<=24;o++){var r=T("text",{x:0,y:20,class:d+"grid-label"});r.element.textContent=o;var l=0;try{l=Math.round(r.element.getBBox().width/2)}catch(e){}r.attr("x",s.left+60*o*s.scale-l)}for(var c=0;c<7;c++){var p=(c+s.firstDay)%7,u=T("text",{x:0,y:s.top+s.row*c+Math.round(s.row/2)+6,class:d+"grid-label"});u.element.textContent=n.getTranslation("weekday-short."+p)}},100);var f,g;var v=(y=T("rect",{visibilyty:"hidden",class:d+"overlay__add"}),S={setStyle:function(e){return y.attr("class",d+"overlay__"+(e?"add":"del")),S},show:function(){return y.show(),S},hide:function(){return y.hide(),S},visible:function(e){return e?y.show():y.hide(),S},setRect:function(e,t,n,i){y.attr("x",e+s.left).attr("y",t+s.top).attr("width",n-e).attr("height",i-t)},element:y},S),h=function(e){return function(){a.style.cursor=e}},b={common:h("default"),default:h("default"),resize:h("ew-resize"),pointer:h("pointer"),add:h("cell"),del:h("crosshair")},_={keyDown:!1,button:-1,over:!1,x:0,y:0,x0:0,y0:0,position:{pattern:!1,place:!1},onOver:function(){_.over=!0},onOut:function(){_.over=!1},onKeyDown:function(e){_.keyDown||(_.x0=_.x,_.y0=_.y,_.button=e,_.keyDown=!0,_.position.pattern&&_.position.place?(_.position.pattern.element.up(),_.position.pattern.hover(!0)):(_.position.pattern&&!_.position.place||!_.position.pattern)&&(w(),v.setStyle(!_.position.pattern).element.up().show()))},onKeyUp:function(e){_.keyDown&&e===_.button&&(_.keyDown=!1,_.button=-1,_.position.pattern&&_.position.place?(_.position.pattern.hover(!1),E(I()),m()):(_.position.pattern&&!_.position.place||!_.position.pattern)&&(v.hide(),function(e){var t=function(){var e=C(),t=Math.round(e.x1/s.scale),n=Math.round(e.x2/s.scale),i=Math.ceil(e.y1/s.row),a=Math.round(e.y2/s.row)-1,o=[];i>a&&(i=a);for(var r=i;r<=a;r++)o.push([t,n,r]);return o}(),n=I();e?n=function(e,t){var n={0:[],1:[],2:[],3:[],4:[],5:[],6:[]},i={0:[],1:[],2:[],3:[],4:[],5:[],6:[]},a=[];e.forEach(function(e){n[e[2]]&&n[e[2]].push([e[0],e[1]])}),t.forEach(function(e){i[e[2]]&&i[e[2]].push([e[0],e[1]])});var o=function(e){i[e].forEach(function(t){n[e]=function(e,t){var n=[];for(var i in e){var a=e[i];a[0]>=t[0]&&a[1]<=t[1]||(a[0]<t[0]&&a[1]>t[1]?(n.push([a[0],t[0]]),n.push([t[1],a[1]])):a[0]<t[0]&&a[1]<=t[1]&&a[1]>=t[0]?n.push([a[0],t[0]]):a[0]>=t[0]&&t[1]<a[1]&&a[0]<=t[1]?n.push([t[1],a[1]]):n.push(a))}return n}(n[e],t)})};for(var s in n)o(s);var r=function(e){n[e].forEach(function(t){a.push([t[0],t[1],e].map(Number))})};for(var l in n)r(l);return a}(n,t):t.forEach(function(e){n.push(e)});E(n)}(Boolean(_.position.pattern)),m()))},onMove:function(e,t){function n(e){return Math.round(e/s.quantize)*s.quantize}_.x=e,_.y=t,_.keyDown?!1!==_.position.pattern&&0!==_.position.place?_.position.pattern.setPosition(-1===_.position.place?n(_.x/s.scale):_.position.fixedPatternStart,1===_.position.place?n(_.x/s.scale):_.position.fixedPatternStop):(_.position.pattern&&!_.position.place||!_.position.pattern)&&w():(_.position=function(e,t){for(var n=!1,i=!1,a=0;a<r.length;a++){var o=r[a],s=o.position;if(s.y1<=t&&s.y2>=t&&s.x1-2<=e&&s.x2+2>=e){n=o;break}}n&&(i=0);return{pattern:n,place:i,fixedPatternStart:n&&n.position.start,fixedPatternStop:n&&n.position.stop}}(e,t),_.position.pattern?_.position.place?b.resize():b.del():b.add())}};var y,S;function w(){var e=C();v.setRect(e.x1,e.y1,e.x2,e.y2)}function C(){var e,t,n,i,a=s.quantize*s.scale;return _.x0<_.x?(e=_.x0,t=_.x):(e=_.x,t=_.x0),_.y0<_.y?(n=_.y0,i=_.y):(n=_.y,i=_.y0),{x1:Math.floor(e/a)*a,y1:Math.floor(n/s.row)*s.row,x2:Math.ceil(t/a)*a,y2:Math.ceil(i/s.row)*s.row}}function E(t){for(var n in r)r[n].remove(),delete r[n];r=[],function(t){var n={0:[],1:[],2:[],3:[],4:[],5:[],6:[]},i=[];return(t=t.length&&t||[]).forEach(function(e){var t=Number(e[2]);n[t]&&n[t].push([e[0],e[1]])}),e.forEach(n,function(e,t){(function e(t){for(var n=0;n<t.length;n++)for(var i=0;i<t.length;i++)if(n!==i&&t[n][0]<=t[i][0]&&t[n][1]>=t[i][0]){for(var a=[[t[n][0]<t[i][0]?t[n][0]:t[i][0],t[n][1]>t[i][1]?t[n][1]:t[i][1]]],o=0;o<t.length;o++)Number(o)!==Number(n)&&Number(o)!==Number(i)&&a.push(t[o]);return e(a)}return t})(e).forEach(function(e){Math.abs(e[0]-e[1])>0&&i.push([e[0],e[1],t].map(Number))})}),i}(t).forEach(function(e){!function(e,t,n){var i=T("rect",{height:s.row,class:d+"pattern"}),a={},o={x1:0,x2:0,y1:0,y2:0,X1:0,X2:0,Y1:0,Y2:0,height:s.row,width:0,stop:0,start:0,day:0},l=T("text",{class:d+"time-label"}),c=T("text",{class:d+"time-label"});function p(e,t,n){if(o.start===Number(e)&&o.stop===Number(t)&&o.day===Number(n))return a;if(e>t){var r=t;t=e,e=r}return n<0&&(n=0),n>6&&(n=6),t<0&&(t=0),e<0&&(e=0),t>s.length&&(t=s.length),e>s.length&&(e=s.length),o.x1=Math.round(e*s.scale),o.X1=o.x1+s.left,o.x2=Math.round(t*s.scale),o.X2=o.x2+s.left,o.start=Number(e),o.stop=Number(t),o.width=Math.abs(o.X2-o.X1),i.attr("x",o.X1).attr("width",o.width),angular.isDefined(n)&&(o.y1=n*s.row,o.Y1=o.y1+s.top,o.y2=o.y1+s.row,o.Y2=o.Y1+s.row,o.day=n,i.attr("y",o.Y1)),l.element.textContent=u(o.start)+" - "+u(o.stop),o.stop-o.start>=120?l.element.getBBox().width<o.width-5?(l.attr("x",o.X1+2),l.attr("y",o.Y1+s.row/2+5),l.up(),c.show(),c.hide()):(l.element.textContent=u(o.start),l.attr("x",o.X1+o.width/2-l.element.getBBox().width/2),l.attr("y",o.Y1+s.row/2-2),c.element.textContent=u(o.stop),c.attr("x",o.X1+o.width/2-c.element.getBBox().width/2),c.attr("y",o.Y1+s.row/2+11),l.up(),c.up(),c.show()):(l.hide(),c.hide()),a}function u(e){var t=Math.floor(e/60),n=e-60*t;return(t<10?"0"+t:t)+":"+(n<10?"0"+n:n)}p(e,t,n),i.show(),a={setPosition:p,position:o,remove:function(){i.remove(),l.remove(),c.remove()},element:i,hover:function(e){return i.attr("class",d+(e?"pattern__hover":"pattern")),l.up(),c.up(),a}},r.push(a)}(e[0],e[1],e[2])})}function I(){return r.map(function(e){var t=e.position;return[t.start,t.stop,t.day]})}function T(e,n){var i=t[0].createElementNS("http://www.w3.org/2000/svg",e);angular.forEach(n,s),a.appendChild(i);var o={};function s(e,t){"style"===t&&angular.isObject(e)?r(e):i.setAttributeNS(null,t,e)}function r(e){angular.forEach(e,function(e,t){i.style[t]=e})}function l(e){return s(e?"inherit":"hidden","visibility"),o}return o={attr:function(e,t){return s(t,e),o},style:r,visible:l,element:i,remove:function(){i.parentNode.removeChild(i)},show:function(){return l(!0)},hide:function(){return l(!1)},up:function(){return a.appendChild(i),o}}}return function(){a.onmousemove=i,a.ontouchmove=function(e){e.preventDefault(),i(e.touches[0])},a.ontouchstart=function(e){e.preventDefault(),i(e.touches[0]),_.onKeyDown(0)},a.ontouchend=function(){_.onKeyUp(0)},a.onmouseout=function(){_.onOut()},a.onmouseover=function(){_.onOver()},a.onmousedown=function(e){return i(e),_.onKeyDown(e.button),!1},t[0].onmouseup=function(e){_.onKeyUp(e.button)},a.onmouseup=function(e){return i(e),_.onKeyUp(e.button),!1},a.oncontextmenu=function(t){return e.get(t,"stopPropagation",e.noop)(),t.cancelBubble=!0,!1};var n=a.createSVGPoint();function i(e){if(angular.isDefined(e.clientX))n.x=e.clientX,n.y=e.clientY;else{var i=t[0].body.getBoundingClientRect(),o=a.getBoundingClientRect(),r=o.top-i.top,l=o.left-i.left;n.x=e.pageX-l,n.y=e.pageY-r}var c=n.matrixTransform(a.getScreenCTM().inverse()),d=c.x-s.left,p=c.y-s.right;return _.onMove(d<0?0:Math.min(d,s.width),p<0?0:Math.min(p,s.height)),!1}}(),p}(o[0].querySelector("svg.ndm-schedule-draw--svg-container"),a.firstDay),c=!1;a.$watch("ngModel",function(e){!c&&angular.isArray(e)&&l.setData(e)}),a.isOverflow=!1,r.$validators.ndmScheduleFullOrEmpty=function(){var e=r.$viewValue;a.isOverflow=!1;var t=angular.isArray(e)&&e.length>0;return t&&7===e.length&&(t=!1,e.forEach(function(e){0===Number(e[0])&&1440===Number(e[1])||(t=!0)})),t&&e.length>128&&(a.isOverflow=!0,t=!1),t};l.onChange(function(e){c=!0,a.ngModel=e,i(function(){c=!1})})}}e.$inject=["_","$document","utils","$timeout"],angular.module("keenetic").directive("ndmScheduleDraw",e)}(),function(){function e(e,t,n,i,a){var o=this;o.tree={name:"ROOT",children:[],expanded:!0,loaded:!1,isDir:!0,isRoot:!0,isStorage:!0,isUsb:!0,isFile:!1,isFolder:!1,path:"",parent:{}},o.selected={},o.singleVolume=(o.singleVolume||"").split("/")[0];var s=!0;o.singleVolume&&!o.selectedPath&&(o.selectedPath=o.singleVolume),o.selectedPath=m(o.selectedPath),o.partitionsData=[],o.poll=function(){if(s){s=!1;var t=n.get(o,"mediaPartitions",[]);return(o.mediaId&&0===t.length?e.getDevicePartitionsData(o.mediaId):a.when(t)).then(function(e){return o.partitionsData=e,o.selectedPath?function(e){var t=e.split("/"),n="";return t.unshift(""),t.reverse(),function e(){var i=t.pop();if((p(n+=(n?"/":"")+i)||{}).isDir)return l([n]).then(function(){if(""===i)return e();var a=p(n);return a&&a.isDir&&(c(n,t.length>0),r.scrollToNode(n),t.length>0)?e():void 0});d(n)}()}(o.selectedPath):l([""])})}return l([""])};var r=new(function(){function e(){_classCallCheck(this,e),this.CONTAINER_CLASS="ndm-fs-tree",this.targetScrollTop=-1,this.sourceScrollTop=-1,this.animationTimer=!1}return _createClass(e,[{key:"scrollToNode",value:function(e){var a=this;e&&i(function(){var i=n.find(t.find("*"),function(t){return t.getAttribute("data-path")===e});i&&a.calculateRecommendedTopScroll(i)})}},{key:"checkAndScroll",value:function(){o.selected.path&&this.scrollToNode(o.selected.path)}},{key:"calculateRecommendedTopScroll",value:function(e){this.element=this.element||t[0].getElementsByClassName(this.CONTAINER_CLASS)[0];var n=this.element.scrollTop,i=this.element.getBoundingClientRect().height;if(this.targetScrollTop=-1,e){var a=this.element.scrollHeight,o=e.offsetTop;if(o+31/3<n)this.targetScrollTop=o-31;else{if(!(o+31*.9-n>i))return;this.targetScrollTop=o+62-i}this.targetScrollTop<0?this.targetScrollTop=0:this.targetScrollTop-i>a&&(this.targetScrollTop=Math.max(0,a-i)),this.sourceScrollTop=n,this.timeLeft=0,clearTimeout(this.animationTimer),this.scrollCorrectIteration()}}},{key:"scrollCorrectIteration",value:function(){var t=this,n=this.element.scrollTop,i=this.targetScrollTop;if(!(-1===i||Math.abs(i-n)<3)){if(this.timeLeft>300)this.element.scrollTop=i;else{var a=e.easeInOutQuad(this.timeLeft,this.sourceScrollTop,i-this.sourceScrollTop,300);if(Math.abs(i-a)>Math.abs(i-n))this.element.scrollTop=i;else{this.element.scrollTop=a,this.timeLeft+=40;var o=setTimeout;this.animationTimer=o(function(){return t.scrollCorrectIteration()},40)}}}}}],[{key:"easeInOutQuad",value:function(e,t,n,i){return(e/=i/2)<1?n/2*e*e+t:-n/2*(--e*(e-2)-1)+t}}]),e}());function l(i){var a={removableOnly:Boolean(o.removableOnly),foldersOnly:o.foldersOnly};return o.mediaId&&(a.uuids=o.partitionsData.map(function(e){return e.uuid})),e.ls(i,a).then(function(a){i.forEach(function(i,s){!function(i,a){var s=m(i),r=p(s);if(!r)return;if(r.loaded=!0,n.has(a,"error"))return void(r.isLocked=!0);r.children.forEach(function(e,t){if(!~u(a,e.name)){var n=0===(o.selectedPath+"/").indexOf(e.path+"/"),i=e.path.split("/").length<2;n&&d(!1),i&&o.singleVolume===e.name&&angular.isFunction(o.onActiveVolumeDisconnect)&&o.onActiveVolumeDisconnect(),r.children.splice(t,1)}});var c=[],f=0,g=0;a.forEach(function(t){t.path=s?s+"/"+t.name:t.name,t.loaded=!1,t.children=[],t.isDir=t.type===e.NODE_TYPE_FOLDER||t.type===e.NODE_TYPE_VOLUME,t.isFile=!t.isDir,t.isVolume=t.type===e.NODE_TYPE_VOLUME,t.pending=!1,t.isRoot=!1,t.isUsb=t.usb,t.isStorage=!t.usb,t.isFolder=t.isDir&&!(t.isVolume&&t.isUsb),t.parent=r,t.isVolume&&o.singleVolume&&o.singleVolume.replace(/\:$/,"")!==t.name.replace(/\:$/,"")&&o.singleVolume!==t.uuid||o.hideRootFiles&&t.isFile&&t.path.split("/").length<2||(g+=t.isDir?0:1,f+=t.isDir?1:0,r.expanded&&t.isDir&&!t.loaded&&(t.mounted||"storage:"===t.name)&&c.push(t.path),-1===u(r.children,t.name)&&r.children.push(t))}),r.filesCount=g,r.foldersCount=f,r.totalCount=g+f,r.children=n.sortBy(r.children,["isFile","name"]),c.length&&l(c);t.attr("tree-buffer-link")&&(o.treeBufferLink=o.tree)}(i,a[s])}),o.noUsbDrives=0===o.tree.children.length})}function c(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=p(e);if(n&&(n.expanded=!n.expanded,t||d(e),n.expanded)){var i=n.children.filter(function(e){return e.isDir&&!e.loaded}).map(function(e){return e.path});i.length>0&&l(i)}}function d(e){e&&(o.selected=p(e)||o.selected),angular.isFunction(o.onSelect)&&o.onSelect(e,!!e&&p(e),o.tree),o.selectedPath=e||"",e&&r.checkAndScroll()}function p(e){for(var t=(e=m(e||""))?e.split("/"):[],n=o.tree,i=0;i<t.length;i++){var a=u(n.children,t[i]);if(-1===a)return!1;n=n.children[a]}return n}function u(e,t){return n.findIndex(e,function(e){return e.name===t||e.uuid===t})}function m(e){return String(e||"").replace(/\/\//,"/").replace(/\/$/,"")}o.api=n.isObject(o.api)?o.api:{},o.api.reloadNode=function(e){return l([e])},o.api.selectNode=d,o.api.expandNode=c,o.api.highlightNode=function(e){var t=p(e);t&&(t.highlight=!0,i(function(){delete t.highlight},4e3))},o.api.markNodeAsLoaded=function(e){var t=p(e);t&&(t.loaded=!0)},o.api.showNode=function(e){r.scrollToNode(e)},o.api.tree=o.tree,o.onNodeClick=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=t.clientX-(t.target||t.srcElement).getBoundingClientRect().left<=21;t.stopPropagation(),e.isLocked||(i||n?c(e.path):d(e.path))}}e.$inject=["storage","$element","_","$timeout","$q"],angular.module("keenetic").component("ndmFsTree",{templateUrl:"app/components/ndm-fs/ndm-fs-tree/ndm-fs-tree.html",restrict:"E",replace:!0,transclude:!1,bindings:{foldersOnly:"<",removableOnly:"<",selectedPath:"<?",hideRootFiles:"<?",singleVolume:"<",mediaId:"<",mediaPartitions:"<",onActiveVolumeDisconnect:"&?",onSelect:"=?",api:"=?apiLink"},controller:e,controllerAs:"vm"})}(),function(){function e(e,t){e.$watch("vm.buttons",function(e){t.forEach(e,function(e,n){e.icon=e.icon||n,e.onClick=t.isFunction(e.onClick)?e.onClick:t.noop,e.key=n,e.disabled=Boolean(e.disabled),e.hidden=Boolean(e.hidden),e.active=Boolean(e.active),e.title=e.title||"fs-toolbar."+n})})}e.$inject=["$scope","_"],angular.module("keenetic").component("ndmFsToolbar",{templateUrl:"app/components/ndm-fs/ndm-fs-toolbar/ndm-fs-toolbar.html",bindings:{buttons:"<"},replace:!0,controller:e,controllerAs:"vm"})}(),function(){function e(e,t){var n,i=this;i.fileSelect?(i.fileSelect=!0,i.folderSelect=!1):(i.fileSelect=!1,i.folderSelect=!0),i.btnLabel=i.btnLabel||"fs-select.btn-select-".concat(i.folderSelect?"folder":"file"),i.initNgModelValidation=function(){i.ngModel.$validators.__ndmFsSelect=function(e){var t=!i.required||Boolean(e);return i.error=t?"":"errors.required",t},t(i.ngModel.$validate)},i.value=i.value?(n=i.value,String(n||"").replace(/\/\//,"/").replace(/\/$/,"")):"";var a=i.value;i.edit=function(){return e({folderSelect:i.folderSelect,fileSelect:!i.folderSelect&&i.fileSelect,selectedPath:i.value,removableOnly:i.removableOnly,title:i.header,description:i.description}).then(function(e){return i.value=e,i.value===a&&i.ngModel.$setPristine(),i.value})},i.clear=function(){i.value="",a||i.ngModel.$setPristine()}}e.$inject=["fsBrowser","$timeout"],angular.module("keenetic").component("ndmFsSelect",{templateUrl:"app/components/ndm-fs/ndm-fs-select/ndm-fs-select.html",restrict:"E",replace:!0,transclude:!1,require:{ngModel:"^ngModel"},bindings:{disabled:"<?",value:"=ngModel",removableOnly:"<?",name:"@?",label:"@?",description:"@?",header:"@?",required:"@?",fileSelect:"@?",btnLabel:"@?",placeholder:"@?"},controller:e,controllerAs:"vm"})}(),function(){function e(e,t){return{modal:function(n,i){var a=t.defer();return e.showModal({templateUrl:"app/components/ndm-fs/ndm-fs-select/ndm-fs-select-modal.html",controller:"NdmFsSelectModalController",controllerAs:"vm",inputs:{__value:n,__options:i||{}}}).then(function(e){e.close.then(function(e){!1===e?a.reject(!1):a.resolve(e)})}),a.promise}}}e.$inject=["_modal","$q"],angular.module("keenetic").factory("fsSelect",e),e.$inject=["modal","$q"]}(),function(){function e(e,t,n){var i=this;i.options=t,i.node={},i.file={},i.cancel=n.bind(null,!1),i.selectedPath=e,i.onFileSelected=function(e){i.file=i.file===e?{}:e},i.onFolderSelect=function(e,t){!1===e&&(i.node={},i.file={}),i.node!==t&&(i.file={}),i.node=t},i.onApplyButtonClick=function(){var e=i.options.selectFolder?i.node.path:i.file.path;n(e||!1)}}e.$inject=["__value","__options","close"],angular.module("keenetic").controller("NdmFsSelectModalController",e)}(),function(){function e(e,t,n,i,a,o,s){var r=this,l=n.translatePrefixCtor("fs-permissions");r.onAccessChanged=function(){t(d)},r.loading=!1,r.noAclComponent=!i.acl,r.api=s.isObject(r.api)?r.api:{},r.api.path=r.api.path?r.api.path:"",r.api.save=function(){var t=[];for(var n in c){var i=n.split("/").length<2,a=i?"":g(n),o=!!a&&f(a);for(var s in c[n]){var r=c[n][s];r.modified&&r.assigned!==r.modified&&"forbidden"!==o&&"write"!==o&&r.exists&&(t.push({access:{directory:n,user:s,mode:r.modified}}),r.assigned=r.modified,r.effective=r.modified)}}t.length&&e.postAndSave(t).then(d)},r.api.cancel=function(){s.forEach(c,function(e){s.forEach(e,function(e){e.modified=e.assigned})}),r.modified=!1,r.path&&v()},r.api.modified=!1,o.$watch("vm.api.path",function(e){r.path=e}),o.$watch("vm.path",function(e){u(e)}),o.$watch("vm.modified",function(e){r.api.modified=e});var c={};function d(){return r.modified=s.some(c,function(e){return s.some(e,function(e){return e.modified&&e.modified!==e.assigned})}),r.modified}function p(e,t){var n=[],i="";return["inherited","read","write","read/write","forbidden"].forEach(function(a){"inherited"===a&&t?i=l("forbidden"):(i=l(a),"inherited"===a&&e&&("inherited"===e&&(e="forbidden"),i+=" ("+l(e)+")")),n.push({id:a,name:i,hide:"write"===a||"inherited"===a&&t})}),n}function u(e){i.acl&&"storage:"!==(e||"").split("/")[0]&&(e?(r.path!==e&&(r.lostUser.cancel(),r.data=[]),r.path=e,r.loading=!0,m(e).then(function(){var t=e.split("/").length<2?"":g(e);Boolean(c[t])?(r.loading=!1,v()):m(t).then(function(){r.loading=!1,v()})})):(r.data=[],r.lostUser.cancel(),r.path=!1))}function m(t){return e.get("show/user/access?directory="+encodeURIComponent(t)).then(function(e){angular.merge(c[t]||(c[t]={}),e.user||{})})}function f(e){for(var t=e.split("/"),n={},i=c[e],a={},o=0,s="";o<t.length;o++)s+=(s?"/":"")+t[o],c[s]&&(n[s]=c[s]);for(var r in i)for(var l in a[r]="",n){var d=n[l][r];d&&("forbidden"!==a[r]&&"write"!==a[r]&&(d.modified&&"inherited"!==d.modified?a[r]=d.modified:a[r]||(a[r]=d.effective)))}return a}r.lostUser={getDescriptionHtml:function(){return l("when-user-not-exists")},onDescriptionClicked:function(e,t){var n=e.target;"A"===n.tagName&&(angular.element(n.parentNode).find("a")[0]===n?r.lostUser.add(t):r.lostUser.del(t))},add:function(e){r.lostUser.cancel(),r.lostUser.uid=e},save:function(){r.loading=!0,a.saveUser(r.lostUser.uid,r.lostUser.password).then(function(){u(r.path)}),r.lostUser.cancel()},del:function(t){!function(t,n){e.postAndSave({access:{directory:n,user:t,no:!0}})}(t,r.path),delete c[r.path][t],v(),r.lostUser.cancel()},cancel:function(){r.lostUser.uid=!1,r.lostUser.password=""},uid:!1,password:""},r.modified=!1,r.optionsListByUsers={},r.path="",r.data=[];var g=function(e){return e.split("/").slice(0,-1).join("/")};function v(){var e=r.path,t=c[e],n=f(e),i=e.split("/").length<2,a=i?"":g(e),o=!!a&&f(a);for(var s in r.data=[],t){var l=t[s],d=n[s];l.modified=l.modified||l.assigned,l.uid=s,l.exists=l.exists?1:0,l.forbidden=!i&&("forbidden"===o[s]||"write"===o[s]),r.optionsListByUsers[s]=p(d,i),r.data.push(l)}}}e.$inject=["router","$timeout","utils","components","usersService","$scope","_"],angular.module("keenetic").component("ndmFsPermissions",{templateUrl:"app/components/ndm-fs/ndm-fs-permissions/ndm-fs-permissions.html",bindings:{path:"<",api:"=?apiLink"},replace:!0,controller:e,controllerAs:"vm"})}(),function(){function e(e,t,n,i,a){return{downloadFile:function(e,t){var i;i="/"+(t?"ci":"download")+"/"+e.replace(":/","/"),n.open(encodeURI(i),i)},uploadFiles:function(n,i){var o=[];return e.reduce(n,function(n,s){return n.then(function(){return function(n,i){var o=t.defer();return a.getUploadPort("put",{filename:i+"/"+n.name}).then(function(t){e.get(t,"port.port")?a.uploadFile(t,n).then(function(e){return o.resolve({success:e})},function(e){return o.resolve({error:e,stage:"fui"})}):o.resolve({error:t,stage:"port"})},function(e){return o.resolve({error:e,stage:"port"})}),o.promise}(s,i)}).then(function(e){o.push(e)})},t.resolve()).then(function(){return o})},eraseFile:function(e){return a.post({url:"erase",data:{filename:String(e)}})},eraseDirectory:function(e){return a.post({url:"erase",data:function e(t,n){var i=[];return n.forEach(function(n){n.isFile?i.push({filename:t+"/"+n.name}):i=i.concat(e(n.path,n.children))}),i.push({filename:t}),i}(e.path,e.children)})},createDirectory:function(e,t){return a.post({url:"",data:{mkdir:{directory:t+"/"+e}}})}}}e.$inject=["_","$q","$window","notification","router"],angular.module("keenetic").factory("fsBrowserService",e)}(),function(){t.$inject=["modal","$q"],angular.module("keenetic").factory("fsBrowser",t);var e=!1;function t(t,n){return function(i){var a=n.defer();return e?n.reject(!1):(e=!0,t.showModal({templateUrl:"app/components/ndm-fs/ndm-fs-browser/fsBrowser.html",controller:"FsBrowserController",controllerAs:"vm",inputs:{options:i}}).then(function(t){t.close.then(function(t){e=!1,t?a.resolve(t):a.reject(!1)})}),a.promise)}}t.$inject=["modal","$q"]}(),function(){function e(e,t,n,i,a,o,s,r,l,c,d,p){var u=this,m=a.acl;u.UPLOAD_ELEMENT_ID="fsBrowserUploadInput",u.mode={permissions:!1,twoColumns:!1,folderSelect:!1,fileSelect:!1,volume:"",removableOnly:!0,title:""},u.mode.volume=n.get(e,"volume",""),u.mode.mediaId=n.get(e,"mediaId",""),u.mode.mediaPartitions=n.get(e,"partitions",[]),u.mode.folderSelect=Boolean(n.get(e,"folderSelect",!1)),u.mode.fileSelect=!u.mode.folderSelect&&Boolean(n.get(e,"fileSelect",!1)),u.mode.selectedPath=n.get(e,"selectedPath",""),u.mode.removableOnly=Boolean(n.get(e,"removableOnly",!1)),u.mode.title=n.get(e,"title",""),u.permissions={save:n.noop,cancel:n.noop,modified:!1,path:""},u.tree={reloadNode:n.noop,tree:{},showNode:n.noop},i(u.redraw),u.node={path:""},u.onNodeSelect=function(e,t){u.node=e?t:{path:""},u.redraw()},u.uploadInput=null;var f=function e(t){return n.get(t,"parent.isRoot")||!n.get(t,"parent.path")?t:e(t.parent)};u.redraw=function(){var e=f(u.node).isStorage;u.mode.twoColumns=u.mode.permissions,u.toolbar.permissions.active=m&&u.mode.permissions,u.toolbar.permissions.disabled=!m||!u.node.path||u.node.isFile&&!u.node.parent.path&&!u.toolbar.permissions.active||e,u.toolbar.trash.disabled=!u.node.path||!u.node.parent.path,u.toolbar.download.disabled=!u.node.path||!u.node.isFile,u.toolbar.upload.disabled=!u.node.path||u.node.isFile&&!u.node.parent.path,u.toolbar.mkdir.disabled=!u.mkdir.getParentForMkdir().path,u.node.path&&u.mode.permissions&&!e&&(u.permissions.path=u.node.isDir||u.node.isVolume?u.node.path:u.node.parent.path||"")},u.close=function(e){u.mkdir.close();var n=!1!==e&&e;t(!u.mode.folderSelect&&!u.mode.fileSelect||n)},u.selectFolder=function(){(u.mode.folderSelect||u.mode.fileSelect)&&u.node.path&&u.close(u.node.path)},u.mkdir={isLocked:!1,visible:!1,name:"",path:"",form:{},childrenNames:[],parentNode:{},error:"",getParentForMkdir:function(){return u.node.isFile?u.node.parent:u.node},validate:function(e){n.isString(e)&&e.length&&(u.mkdir.error=n.get(p.validators.folderName(e),"message")||u.mkdir.isUniqueName(e)||!1)},open:function(){u.mkdir.parentNode=u.mkdir.getParentForMkdir(),u.mkdir.childrenNames=u.mkdir.parentNode.children.map(function(e){return e.name}),u.mkdir.visible=!0,u.mkdir.name="",u.mkdir.path=u.node.path},close:function(){u.mkdir.childrenNames=[],u.mkdir.visible=!1},ok:function(){return u.mkdir.validate(u.mkdir.name),u.mkdir.error||!n.isString(u.mkdir.name)||!u.mkdir.name.length||u.mkdir.isLocked?l.when(!1):(u.mkdir.isLocked=!0,c.createDirectory(u.mkdir.name,u.mkdir.parentNode.path).then(function(){return u.tree.reloadNode(u.mkdir.parentNode.path)}).then(u.mkdir.close).then(function(){i(function(){var e=u.mkdir.parentNode.path+"/"+u.mkdir.name;u.tree.markNodeAsLoaded(e),u.tree.showNode(e),u.tree.highlightNode(e),u.mkdir.parentNode.expanded||u.tree.expandNode(u.mkdir.parentNode.path)})}).finally(function(){u.mkdir.isLocked=!1}))},isUniqueName:function(e){return n.includes(u.mkdir.childrenNames,e)?"fs-browser.error.name-exists":""}};var g=function(){function e(t,n){_classCallCheck(this,e),this.arr=t,this.pointer=-1,this.callback=n,this.deferred=l.defer(),this.iterate()}return _createClass(e,[{key:"iterate",value:function(){++this.pointer>=this.arr.length?this.deferred.resolve():this.callback(this.arr[this.pointer]).then(this.iterate.bind(this))}}]),e}(),v=function(e){var t,i,a=u.node.isFile?u.node.parent:u.node,o=[];(t=e,i=function(e){if(n.find(u.node.children,{name:e.name})){var t=l.defer();return s.confirm(r.getTranslation("fs-browser.confirm-file-upload-overwrite",null,{name:e.name})).then(function(){o.push(e),t.resolve()}).catch(t.resolve),t.promise}return o.push(e),l.when(!0)},new g(t,i).deferred.promise).then(function(){return o.length?c.uploadFiles(o,a.path).then(function(){return u.tree.reloadNode(a.path)}).then(function(){a.expanded||u.tree.expandNode(a.path),n.forEach(n.sortBy(o,"name"),function(e,t){var n=a.path+"/"+e.name;u.tree.highlightNode(n),t||u.tree.showNode(n)})}):l.when(!0)})};u.observeFileUploadInput=function(){i(function(){angular.element(d[0].querySelector("#"+u.UPLOAD_ELEMENT_ID)).bind("change",function(e){v(_toConsumableArray(n.get(e,"target.files",[])))})})},u.toolbar={mkdir:{disabled:!0,onClick:function(){u.mkdir.open()}},download:{disabled:!0,onClick:function(){if(u.node.isFile){var e=f(u.node).isStorage,t=u.node.path;if(!e){for(var n=u.node.path.split("/").slice(1),i=null,a=u.node.parent;a.path;a=a.parent)i=a.uuid;n.unshift(i),t=n.join("/")}c.downloadFile(t,e)}}},upload:{disabled:!0,labelFor:u.UPLOAD_ELEMENT_ID},permissions:{active:!1,disabled:!0,balloonHint:m?"":"fs-permissions.no-acl-warning",onClick:function(){m&&(u.mode.permissions=!u.mode.permissions,u.redraw())}},trash:{disabled:!0,onClick:function(){var e=r.getTranslation("fs-browser.confirm-".concat(u.node.isFile?"file":"folder","-delete"),null,{name:u.node.name});s.confirm(e).then(function(){(u.node.isFile?c.eraseFile(u.node.path):c.eraseDirectory(u.node)).then(function(){u.tree.reloadNode(u.node.parent.path),u.tree.selectNode(u.node.parent.path)})})}}}}e.$inject=["options","close","_","$timeout","components","$document","modal","utils","$q","fsBrowserService","$element","ValidatorManager"],angular.module("keenetic").controller("FsBrowserController",e)}(),function(){function e(e,t,n,i,a,o){var s,r="CON,PRN,AUX,NUL,COM1,COM2,COM3,COM4,COM5,COM6,COM7,COM8,COM9,LPT1,LPT2,LPT3,LPT4,LPT5,LPT6,LPT7,LPT8,LPT9,$Mft,$MftMirr,$LogFile,$Volume,$AttrDef,$Bitmap,$Boot,$BadClus,$Secure,$Upcase,$Extend,$Quota,$ObjId,$Reparse".split(","),l=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return{message:"".concat(n.getTranslation(e)).concat(t)}},c={ascii:/^[\x20-\x7E]+$/,asciiWithoutSpace:/^[\x21-\x7E]+$/,hex:/^[\da-f]+$/i,base64:/^[A-Za-z0-9+/=]+$/,ip:i.IPV4_REGEX,mac:/^[0-9a-f]{1}[02468ace]{1}(?:[\:\- ]?[0-9a-f]{2}){5}$/i,time:/^([0-9]|0[0-9]|1[0-9]|2[0-3]):[0-5][0-9]:[0-5][0-9]$/,date:/^(?:(?:31(\/|-|\.)(?:0?[13578]|1[02]))\1|(?:(?:29|30)(\/|-|\.)(?:0?[1,3-9]|1[0-2])\2))(?:(?:1[6-9]|[2-9]\d)?\d{2})$|^(?:29(\/|-|\.)0?2\3(?:(?:(?:1[6-9]|[2-9]\d)?(?:0[48]|[2468][048]|[13579][26])|(?:(?:16|[2468][048]|[3579][26])00))))$|^(?:0?[1-9]|1\d|2[0-8])(\/|-|\.)(?:(?:0?[1-9])|(?:1[0-2]))\4(?:(?:1[6-9]|[2-9]\d)?\d{2})$/,phone:/^[\d\*#\(),\-+wpdt\s]+$/,email:/^[-a-z0-9~!$%^&*_=+}{\'?]+(\.[-a-z0-9~!$%^&*_=+}{\'?]+)*@([a-z0-9_][-a-z0-9_]*(\.[-a-z0-9_]+)*\.([a-z]{2}[a-z0-9-]*)|([0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}))(:[0-9]{1,5})?$/i,domain:/^[a-z0-9\-]+(\.[a-z0-9\-]+)*$/i,keendnsTransferCode:/^[a-z0-9]{4}[: ]{1,3}[a-z0-9]{4}[: ]{1,3}[a-z0-9]{4}[: ]{1,3}[a-z0-9]{4}$/,keendnsDomain:/^[a-z0-9\-]+$/i,ipV6:a.REGEX.ipV6,ipV6Prefix:a.REGEX.ipV6Prefix,windowsFolderNameInvalidChars:/[\x00-\x1F]|[<>\:"\/\\|\?\*]/,endsWithDotOrSpace:/(\.|\x20)$/,dotsOnly:/^\.+$/,domainAndPort:/^([a-z0-9\-]+(\.[a-z0-9\-]+)*|(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])(\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])){3})(:[\d]{1,5})?$/i,sipId:/^[A-Za-z0-9$\-_.+!*'(),]+$/i,sipUri:/^([a-z0-9\-]+(\.[a-z0-9\-]+)*|(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])(\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])){3})(:[\d]{1,5})?(\/([\w\-_@\.+!,]|(\%[\da-f]{2}))+)*\/?(\?([\w$\-_@\.&+!*\(\),=]|\%[\da-z]{2})*)?(#([\w$\-_@\.&+!*\(\)\/,=]|\%[\da-z]{2})*)?$/i},d=function(e){return c.ascii.test(e)},p=function(e){return c.hex.test(e)},u=function(e,n,i){return t.every([e,n,i],t.isNumber)&&t.inRange(e,n,i+1)},m=function(e){return u(Number(e),1,65535)},f=function(e,t){return(6===(t=t?Number(t):4)?c.ipV6:c.ip).test(e)},g=function(e){return function(t){if(t){var i=t.length;return i<e?l(n.getTranslation("errors.min-length",null,{length:e})):d(t)?i>64?l(n.getTranslation("errors.max-length",null,{length:64})):void 0:l("errors.ascii-only")}}},v=function(e,t){return function(n){if(n&&!e.test(n))return l(t)}},h=function(e){var t=e.split(":"),n=Number(t[1]),i="",a=t[0];return!isNaN(n)&&m(n)||(i=l("errors.ports.not-number")),{newValue:a,error:i}},b={domainAndPort:v(c.domainAndPort,"errors.invalid-domain-and-port"),domain:v(c.domain,"errors.invalid-domain-name"),ascii:v(c.ascii,"errors.ascii-only"),base64:v(c.base64,"errors.base64-only"),sipId:v(c.sipId,"errors.invalid-sip-id"),sipUri:v(c.sipUri,"errors.invalid-domain-and-port"),time:v(c.time,"errors.system.time"),phone:v(c.phone,"errors.invalid-phone"),mac:v(c.mac,"errors.mac-address-invalid"),email:v(c.email,"errors.invalid-email"),asciiWithoutSpace:v(c.asciiWithoutSpace,"errors.invalid-characters"),password:v(c.asciiWithoutSpace,"errors.password-format"),login:v(/^[\w+()_=@.\/-]+$/,"errors.login-format"),keendnsDomain:v(c.keendnsDomain,"errors.keendns-domain-name"),keendnsTransferCode:v(c.keendnsTransferCode,"errors.transfercode-format"),dyndnsUrl:v(/^https?:\/\/.{4,}/,"errors.dydns-url-format"),date:function(e,t){if(e){if(!c.date.test(e))return l("errors.system.date");if(!1===isNaN(parseInt(t,10))){var n=e.split("-")[2];if(Number(n)<Number(t))return l("errors.system.date-min-year"," "+t)}}},range:function(e,t){if(e){e=Number(e);var n=(t||"").split(".."),i=parseInt(n[0],10),a=parseInt(n[1],10);return isNaN(e)||!u(e,i,a)?l("errors.not-in-range"," "+i+".."+a):void 0}},portNumber:function(e){if(e)return e=Number(e),isNaN(e)||!m(e)?l("errors.ports.not-number"):void 0},length:function(e,t){if(!e||!angular.isString(e))return!0;var n=t.split(".."),i=parseInt(n[0],10),a=parseInt(n[1],10),o=e.length;return!!(!o||isNaN(i)&&isNaN(a))||(isNaN(i)?o>a?l("errors.invalid-length"," < "+(a+1)):null:isNaN(a)?o<i?l("errors.invalid-length"," > "+(i-1)):null:u(o,i,a)?void 0:l("errors.invalid-length"," "+i+".."+a))},maxLengthInBytes:function(e,i,a){if(e){var o=parseInt(i,10),s=n.getLengthInBytes(e);return u(s,0,o)?void 0:l(t.get(a||{},"errorMessage",n.getTranslation("errors.too-long")))}},ip:function(e,n,a){if(e){if(Boolean(t.get(a,"allowPort"))&&t.includes(e,":")){var o=h(e),s=o.newValue,r=o.error;if(e=s,r)return r}return f(e)?i.ip2num(e)<16777217?l("errors.zero-ip"):null:l("errors.invalid-ip")}},ipOrZero:function(e,t,n){return e===o.ZERO_IP_ADDRESS||b.ip(e,t,n)},ipIsInPool:function(e,t,n){if(e){if(n.poolStart&&n.poolSize&&c.ip.test(n.poolStart)&&!isNaN(parseInt(n.poolSize,10))){var a=i.ip2num(e),o=i.ip2num(n.poolStart),s=o+(Number(n.poolSize)-1);return a<o||a>s?l("errors.ip-not-in-range"):void 0}console.warn("validationManager.ipIsInPool: invalid validation data: ".concat(JSON.stringify(n)))}},ipOrDomain:function(e,n,i){if(e){var a=Boolean(t.get(i,"allowPort"));if(!(a?c.domainAndPort.test(e):c.domain.test(e))){if(a&&t.includes(e,":")){var o=h(e),s=o.newValue,r=o.error;if(e=s,r)return r}return f(e,n)?void 0:l(a?"errors.invalid-domain-and-port":"errors.ip-or-domain-required")}}},ipV6:function(e){if(e)return c.ipV6.test(e)||f(e)?void 0:l("errors.ipv6")},ipV6Prefix:function(e){if(e)return a.isValidPrefix(e)?void 0:l("errors.ipv6-prefix")},numeric:function(e){if(e)return isNaN(Number(e))?l("errors.numeric"):void 0},validationOnSpeedRange:function(e,t){if(""===e||angular.isUndefined(e))return!1;var i=Number(e);return isNaN(i)?l("errors.numeric"):t===n.getDimensionName("kb")?l(u(i,64,1e6)?"":"errors.ports.notInKbRange"):l(u(i,1,976)?"":"errors.ports.notInMbRange")},required:function(e){if(angular.isUndefined(e)||""===e||null===e)return l("errors.required-field")},wepKey:function(e){if(e){var t=e.length;switch(t){case 5:case 13:if(!d(e))return l("errors.ascii-only");break;case 10:case 26:if(64!==t&&!p(e))return l("errors.hex-only");break;default:return l("errors.wep-key-error")}}},wpaPsk:(s=8,function(e){if(e){var t=e.length;if(t<s)return l(n.getTranslation("errors.min-length",null,{length:s}));if(!d(e))return l("errors.ascii-only");if(t>63){if(!p(e)&&t<65)return l(n.getTranslation("errors.less-chars-or-only-hex",null,{maxLength:64}));if(t>64)return l(n.getTranslation("errors.max-length",null,{length:64}))}}}),l2tpIpsecPsk:g(3),ipsecPsk:g(6),isHost:function(e,t){if(e)return i.isNet(e,t)?l("errors.is-host"):void 0},isNet:function(e,t){if(e)return i.isNet(e,t)?void 0:l("errors.is-net")},inNet:function(e,t){if(!e||!t)return!0;var n=t.split(";");return i.isIpInNet(e,n[0],n[1])?void 0:l("errors.in-net")},inNets:function(e,t){if(!e||e===o.ZERO_IP_ADDRESS)return!0;if("[]"===t)return l("errors.in-nets");var n=/((\[\{.+?\}\])|(\{.+\}+))/.exec(t);try{if(n.length<2)return l("errors.in-nets");t=angular.fromJson(n[1])}catch(e){return l("errors.in-nets")}for(var a=0,s=t.length;a<s;++a){var r=t[a];if(i.isIpInNet(e,r.ip,r.mask))return!0}return l("errors.in-nets")},notInNets:function(e,t,a){if(e){var o,s=a&&a.mask||t.split(";")[0],r=angular.fromJson(/((\[\{.+?\}\])|(\{.+\}+))/.exec(t)),c=a&&a.nets||r&&r[1];if(s&&c){o=i.ip2num(e),s=i.ip2num(s);for(var d=0,p=c.length;d<p;++d){var u=c[d],m=i.ip2num(u.ip),f=i.ip2num(u.mask);if((o&f)==(m&f)||(o&s)==(m&s))return u.label?l(n.getTranslation("errors.not-in-nets-named",null,{connection:u.label})):l("errors.not-in-nets")}}}},notInArray:function(e,n){if(e)return t.includes(angular.fromJson(n),e)?l("errors.not-in-array"):void 0},username:function(e){if(e)return/^[A-Za-z0-9_]+$/.test(e)?{root:!0,nobody:!0}[e.toLowerCase()]?l("errors.reserved-user-name"):void 0:l("errors.login-format")},intRange:function(t,i){if(!t)return!0;if(!i)return!0;t=Number(t);var a=i.split(",");(2!==a.length||isNaN(a[0])||isNaN(a[1]))&&e.warn("INVALID RANGE SPECIFIED: ",i,"(two comma separated integers expected");var o=Number(a[0]),s=Number(a[1]);if(isNaN(t)||!u(t,o,s)){var r=n.getTranslation("errors.ports.port-range",null,{from:o,to:s});return l(r)}},folderName:function(e){if(e)return e.match(c.windowsFolderNameInvalidChars)||c.endsWithDotOrSpace.test(e)||c.dotsOnly.test(e)||t.includes(r,e.toUpperCase())?l("errors.foldername-format"):void 0},ipAndCidr:function(e){if(e)return i.splitAddressAndCidr(e)?void 0:l("errors.invalid-subnet")},isNetInline:function(e){if(e){var t=i.splitAddressAndCidr(e);return t&&i.isNet(t.address,t.mask)?void 0:l("errors.invalid-subnet")}},notInNetsInline:function(e,a,o){var s=o.subnets;if(e&&t.isArray(s)){var r=i.splitAddressAndCidr(e);if(r){var c=i.findConflictingSubnet(r.address,r.mask,s);if(c)return c.label?l(n.getTranslation("errors.not-in-nets-named",null,{connection:c.label})):l("errors.not-in-nets")}}}};return{maxLengthValidatorConstructor:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return function(i){if(i){var a=e,o=n.getLengthInBytes(i);return u(o,0,a)?void 0:t||"".concat(n.getTranslation("errors.invalid-length")," < ").concat(a+1)}}},isValueInRange:u,isNumberKey:function(e){var t=e.which||e.keyCode;return u(Number(t),48,57)||8===t},ip:f,isPortNumber:m,validators:b,regexes:c}}e.$inject=["$log","_","utils","ipV4Service","ipV6Service","CONSTANT"],angular.module("keenetic").factory("ValidatorManager",e)}(),function(e,t){if(!/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)){var n=function(n){var a=this;for(this.target=n,this.mainContentScroll=~n.className.indexOf("ndm-page")||~n.className.indexOf("d-dashboard"),this.bar='<div class="ss-scroll">',this.wrapper=t.createElement("div"),this.wrapper.setAttribute("class","ss-wrapper"),this.el=t.createElement("div"),this.el.setAttribute("class","ss-content"),this.el.style.width="calc(100% + "+function(){var e=t.createElement("div");e.style.visibility="hidden",e.style.width="100px",e.style.msOverflowStyle="scrollbar",t.body.appendChild(e);var n=e.offsetWidth;e.style.overflow="scroll";var i=t.createElement("div");i.style.width="100%",e.appendChild(i);var a=i.offsetWidth;return e.parentNode.removeChild(e),n-a}()+"px)",this.wrapper.appendChild(this.el);this.target.firstChild;)this.el.appendChild(this.target.firstChild);this.target.appendChild(this.wrapper),this.target.insertAdjacentHTML("beforeend",this.bar),this.bar=this.target.lastChild,function(e,n,a){var o;function s(e){var t=e.pageY-o;o=e.pageY,i(function(){n.el.scrollTop+=t/n.scrollRatio})}function r(){a.classList.remove("ss-wrapper--ss-scroll-grabbed"),e.classList.remove("ss-grabbed"),t.body.classList.remove("ss-grabbed"),t.removeEventListener("mousemove",s),t.removeEventListener("mouseup",r)}e.addEventListener("mousedown",function(n){return o=n.pageY,a.classList.add("ss-wrapper--ss-scroll-grabbed"),e.classList.add("ss-grabbed"),t.body.classList.add("ss-grabbed"),t.addEventListener("mousemove",s),t.addEventListener("mouseup",r),!1})}(this.bar,this,this.wrapper),this.moveBar(),this.el.addEventListener("scroll",this.moveBar.bind(this)),this.el.addEventListener("mouseenter",this.moveBar.bind(this)),this.barContainer=t.createElement("div"),this.barContainer.classList.add("ss-scroll-container"),this.wrapper.appendChild(this.barContainer),this.barContainer.addEventListener("click",function(e){var t;try{t=Number(getComputedStyle(a.bar).height.replace("px",""))}catch(e){t=0}a.bar.classList.add("ss-scroll--animated-top"),a.el.scrollTop=(e.clientY-t/2)/a.el.clientHeight*a.el.scrollHeight,a.moveBar(),setTimeout(function(){a.bar.classList.remove("ss-scroll--animated-top")},100)}),this.bar.addEventListener("mouseenter",function(){a.wrapper.classList.add("ss-wrapper--scroll-hover")}),this.bar.addEventListener("mouseleave",function(){a.wrapper.classList.remove("ss-wrapper--scroll-hover")}),this.target.classList.add("ss-container");var o=e.getComputedStyle(n);"0px"===o.height&&"0px"!==o["max-height"]&&(n.style.height=o["max-height"])},i=e.requestAnimationFrame||e.setImmediate;n.prototype={moveBar:function(){var t=this.el.scrollHeight,n=this.el.clientHeight,a=this,o=e.document.getElementById("crowdin-translation-badge");this.scrollRatio=n/t,e.onMoveBar&&e.onMoveBar(this.el.scrollTop),this.mainContentScroll&&(e.scrollElement=this.el,e.scrollTop=this.el.scrollTop,e.scrollTopPercent=(e.scrollTop+n)/t*100),i(function(){if(e.dispatchEvent(new Event("ss-scroll")),1===a.scrollRatio)a.bar.classList.add("ss-hidden");else{a.bar.classList.remove("ss-hidden");var n="";n+="height:"+100*a.scrollRatio+"%; ",n+="top:"+a.el.scrollTop/t*100+"%;",o&&o.style.setProperty("margin","-"+a.el.scrollTop+"px 0px 0px 0px","important"),a.bar.style.cssText=n}})}},n.initEl=function(e){if(!e.hasOwnProperty("data-simple-scrollbar")){var t=new SimpleScrollbar(e);return Object.defineProperty(e,"data-simple-scrollbar",t),t}},e.SimpleScrollbar=n}}(window,document),function(){function e(e){return function(){var t=e[0].createElement("div");t.style.visibility="hidden",t.style.width="100px",t.style.msOverflowStyle="scrollbar",e[0].body.appendChild(t);var n=t.offsetWidth;t.style.overflow="scroll";var i=e[0].createElement("div");i.style.width="100%",t.appendChild(i);var a=i.offsetWidth;return t.parentNode.removeChild(t),n-a}}e.$inject=["$document"],angular.module("keenetic").factory("scrollBarWidth",e)}(),function(){t.$inject=["browserCheck","$rootScope","CONSTANT","$timeout"],angular.module("keenetic").directive("initScroll",t).directive("initSimpleScroll",function(){return{link:angular.noop}});var e=500;function t(t,n,i,a){return{link:function(o,s,r){if(t.isPc&&!r.noscroll){var l=SimpleScrollbar.initEl(s[0]);o.$on("$destroy",n.$on(i.events.PAGE_REDRAW,function(){return a(l.moveBar.bind(l),e)}))}}}}}(),function(){function e(e,t,n,i,a){var o=this,s="app/page/not-supported-browser/icons",r=function(){e.title=a.formatPageTitle("not-supported-browser.page-title")};r(),n.$on("destroy",e.$on("$translateChangeSuccess",function(){return t(r)})),o.alternativeBrowsers=[{title:"Google Chrome",icon:"".concat(s,"/chrome.svg"),link:"https://www.google.com/chrome/browser/desktop/"},{title:"Mozilla Firefox",icon:"".concat(s,"/firefox.svg"),link:"http://www.mozilla.org/firefox/new/"},{title:"Microsoft Edge",icon:"".concat(s,"/edge.svg"),link:"https://www.microsoft.com/edge"}],o.languages={current:a.getCurrentLanguage(),list:a.getLanguageOptionsList(!0),change:function(){t(function(){return a.changeLanguage(o.languages.current)})}}}e.$inject=["$rootScope","$timeout","$scope","NDM","utils"],angular.module("keenetic").controller("NotSupportedBrowserController",e)}(),function(){function e(e,t,n,i,a,o,s,r,l,c,d,p,u,m,f,g,v,h){var b={ua:"https://keenetic.ua/uk",tr:"https://keenetic.com.tr/tr",en:"https://keenetic.com/global",ru:"https://keenetic.ru/ru"},_=function(){var e=decodeURIComponent(u.parseLocationHash().goto||"/dashboard"),n=h.search().redirectUrl,i=h.search().token;m.checkRedirectUrl(n,i)?t.location.href=decodeURIComponent(n):(h.search(""),h.hash(""),h.path(e))},y=function(e){return e.replace("login","").toLowerCase()};f.reset(),s.isLoginPage=!0;var S=this,w=u.localeFactory({loginFieldName:"".concat("login.form",".login"),passwordFieldName:"".concat("login.form",".password"),loginContainsInvalidSymbols:"".concat("login.form",".login-contains-invalid-symbols"),passwordContainsInvalidSymbols:"".concat("login.form",".password-contains-invalid-symbols"),authFailed:"".concat("login.form",".auth-failed")}),C=function(){S.l10n=w(),S.policyLink="".concat(b[u.getCurrentLanguage()],"/terms#policy"),s.title=u.formatPageTitle("menu.login")};S.isRebooting=!1,S.isPopupVisible=!1,S.timer=null,S.error={login:"",password:""},S.inFocus={login:!1,password:!1},S.onFocusToggle=function(e,t){var n=y(t);S.inFocus[n]=e},S.onValidationEnd=function(e,t){var n=y(t),i="".concat(n,"ContainsInvalidSymbols");S.error[n]=e?"":S.l10n[i]},S.constants={deviceModel:u.getModelNameWithVendor(),deviceModelForLogo:u.getModelNameForLogo(),isNewGenerationDevices:u.getIsNewGeneration()},S.data={login:"",password:""},S.languages={current:u.getCurrentLanguage(),list:u.getLanguageOptionsList(!0),change:function(){n(function(){return u.changeLanguage(S.languages.current)})}},S.help={getLabel:function(){return u.getTranslation("login.help.".concat(S.help.isVisible?"hide":"show"))},isVisible:!1},S.close=function(){S.isRebooting=!1},S.startLogin=function(){S.startLogin.isLocked||(S.startLogin.isLocked=!0,m.getAuthObj().then(function(){return m.authenticate(S.data.login,S.data.password)}).then(function(e){e.isAuthOK?(m.user=S.data.login,v.updateMenu(),_()):401===e.status&&(S.error.password=S.l10n.authFailed)}).then(function(){S.startLogin.isLocked=!1}))},C(),a.$on("destroy",s.$on("$translateChangeSuccess",function(){return n(C)})),m.getAuthObj().then(function(e){e&&_()})}e.$inject=["$q","$window","$timeout","$document","$scope","$state","$rootScope","$interval","$http","_","CONSTANT","NDM","utils","authenticationService","router","redirectChecker","menuService","$location"],angular.module("keenetic").controller("LoginController",e)}(),function(){function e(e,t,n,i,a,o,s,r,l){var c=i.get(l,"profile.features.dual_image",!1),d=a.saveQueryStr().data,p=[],u={},m=!1,f={timer:null,isPaused:!1,pending:!1};e.onStart({from:"dashboard"},function(){m=!0,f.pending=!1,f.stop()});var g=function e(){f.pending=!0,f.stop();var n=l.sysmode,o=n===r.SYSMODE.ROUTER,d={show:{clock:{date:{}},schedule:{},internet:{status:{}},version:{},system:{},interface:{},ip:{"name-server":{},route:{}},rc:{interface:{},service:{},user:{}}},ls:{},whoami:{}},g=d.show,v=g.rc;c&&i.set(v,"components.auto-update.disable",{}),s.cloudcontrol&&(g.ndns={},g.acme={},d.ip={http:{ssl:{acme:{list:{}}}}}),s.ddns&&(g.dyndns={});var h=s.pingcheck&&o;h&&(g["ping-check"]={}),o?g.ip.hotspot={details:r.HOTSPOT_DETAILS.WIRELESS}:n!==r.SYSMODE.AP&&n!==r.SYSMODE.REPEATER&&n!==r.SYSMODE.EXTENDER||(g.associations={}),(s.cifs||s.tsmb)&&(g.cifs={},g.printers={}),o&&s.kabinet&&(g.rc.kabinet={}),s.nvox&&(g.nvox={"active-calls":{},"sip-lines":{},handsets:{},info:{},status:{}},g.rc.nvox={}),s.ip6&&(g.ipv6={addresses:{},prefixes:{},routes:{}});var b=s["sstp-server"]&&o;b&&(v.ip||(v.ip={}),v.ip.http||(v.ip.http={}),i.set(d,"ip.http.ssl.acme.list",{}),g["sstp-server"]={},g.ndns={},g.acme={}),s.ipsec&&o&&(v.crypto={}),!v.ip&&(s.ftp||s.webdav||s.sftp)&&(v.ip={}),s.ftp&&(v.ip.ftp={}),s.webdav&&(v.ip.http||(v.ip.http={})),s.sftp&&(v.ip.ssh={}),s.dlna&&(g.dlna={},v.dlna={}),s.transmission&&(v.torrent={},g.torrent={status:{}}),s.usb&&(g.usb={},l.USB_PORTS_NUMBER>0&&s.storage&&(g.media={})),l.DEVICE_IS_MWS_MEMBER&&(g.mws={controller:{}}),a.post({url:"",silent:h,data:d}).then(function(e){b&&(e.show.acmeList=e.ip||{}),u=angular.extend(u,e),p=i.reduce(p,function(t,n){var a=n.path,o=n.callback;return angular.isString(a)?o(i.get(e,a)):o.apply(null,a.map(function(t){return i.get(e,t)})),n.isOnce||t.push(n),t},[]),m&&f.stop()}).finally(function(){m||(f.pending=!1,f.timer=t(e,3e3))})};f.start=function(){f.timer||f.pending?(f.stop(),f.timer=t(g,3e3)):g()},f.stop=function(){f.timer&&t.cancel(f.timer),f.timer=null};return{getUserApId:function(e,t){var n=e.mac,a=i.find(t,function(e){return e.mac===n});return!(!a||!a.ap)&&a.ap},getData:g,getInterfaceStatistics:function(e){angular.isString(e)&&(e=[e]);var t=i.get(u,"show.interface",{}),n=[],o={show:{interface:{stat:[]}}},s=o.show.interface.stat;return e.forEach(function(e){s.push({name:e}),n.push(t[e]||i.find(t,function(t){return t.id===e||t["interface-name"]===e}))}),a.post(o).then(function(e){return[n,e]})},getInterfaceRrd:function(e){return a.post({show:{interface:{rrd:[{name:e,attribute:"rxspeed",detail:0},{name:e,attribute:"txspeed",detail:0}]}}})},wps:{start:function(e){var t={interface:{}};return t.interface[e]={wps:{button:{direction:"send"}}},a.post({url:"",data:t})},getStatus:function(e){angular.isString(e)&&(e=[e]);var t={show:{interface:{}}},n=t.show.interface;return e.forEach(function(e){n[e]={wps:{status:{}}}}),a.poll({url:"",method:"post",data:t},1)}},setWifiState:function(e,t){var n={interface:{}};return n.interface[e.ap]={up:{no:!t}},a.post({url:"",data:[n,d]})},registerCallback:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=o.getUniqueId();return p.push({path:e,callback:t,isOnce:n,uid:i}),i},deregisterCallback:function(e){var t=0;return p=i.reduce(p,function(n,i){return i.uid===e?t++:n.push(i),n},[]),t>0},reset:function(){u={},p=[],f.stop()},getPolling:function(){return f}}}e.$inject=["$transitions","$timeout","$parse","_","router","utils","components","CONSTANT","NDM"],angular.module("keenetic").factory("dashboardDataService",e)}(),function(){function e(e,t,n){var i="app/page/dashboard/",a={},o=function(e,t){a[e]={template:i+"card_"+e+".html",column:t}};["internet","usb","apps"].forEach(function(e){return o(e,1)}),["wifi","segments","switchports","dect","system"].forEach(function(e){return o(e,2)}),a.dect.template=i+"card_dect/card_dect.html";return{getCards:function(){var e=t.sysmode,i=angular.copy(a);return delete i.wifi,"client"===e&&delete i.segments,n.usb&&(n.storage||n.nvox||n.cifs||n.tsmb)||(delete i.usb,i.system.column=1),n.nvox||delete i.dect,i},getDeviceName:function(){return e.get("show/version").then(function(e){return e.device})}}}e.$inject=["router","NDM","components"],angular.module("keenetic").factory("dashboardService",e)}(),function(){function e(e,t,n,i,a,o,s,r,l,c,d,p,u,m,f,g,v,h,b,_,y,S){var w=this,C=function(){a.title=p.formatPageTitle("menu.dashboard");var e=p.getCurrentLanguage();w.appleStoreLogo="assets/img/apple/".concat(e,".svg"),w.googlePlayLogo="assets/img/google/".concat(e,".svg")};C(),o.$on("$destroy",a.$on("$translateChangeSuccess",function(){return r(C)})),a.uiViewClass="",w.sysMode=d.sysmode,w.cards={},w.marketingFeaturesAreReady=!1,w.unloadedCardAmount=-1,w.init=function(){w.cards=angular.copy(b.getCards()),w.unloadedCardAmount=Object.keys(w.cards).length,y.checkAcceptance(),b.getDeviceName().then(function(e){w.deviceName=e,w.helloModelText="dashboard.welcome",w.showContent=!0,w.sysMode=d.sysmode,m.startPeriodicNotifications(!0),_.getPolling().start()})},w.init(),w.cardLoaded=function(t){if(w.unloadedCardAmount&&a.$broadcast(c.events.PAGE_REDRAW),0==--w.unloadedCardAmount){S.getCompletionState().then(function(t){w.marketingFeatures=e.map(e.pickBy(t,function(e){return!e.isWizardCompleted}),function(e,t){return Object.assign({},e,{name:t})}),w.marketingFeaturesAreReady=!0}),w.allCardsLoaded=!0;var n=i[0].querySelector("#d-page-top");n&&n.focus();var o=i[0].querySelectorAll(".d-main");angular.element(o).removeClass("d-main--loading"),r(function(){a.$broadcast(c.events.DASHBOARD_LOADED)})}w.cards[t].loaded=!0},o.$on("$destroy",function(){u.reset(),_.reset()}),w.appLinkArgs="",_.registerCallback(["show.version"],function(e){var t=e.region,n=e.release;w.appLinkArgs="&region=".concat(encodeURIComponent(t),"&version=").concat(encodeURIComponent(n))}),w.mwsMemberMacs=[],w.getMwsData=function(){return h.getMwsMembers().then(function(e){w.mwsMemberMacs=e.serviceIsEnabled?e.members.map(function(e){return e.mac}):[]})},w.qrCodePrint=function(){n.print()}}e.$inject=["_","$q","$window","$document","$rootScope","$scope","$location","$timeout","$state","CONSTANT","NDM","utils","router","securityNotification","redirectChecker","authenticationService","components","MWSService","dashboardService","dashboardDataService","licensesService","noticeService"],angular.module("keenetic").controller("DashboardController",e)}(),function(){function e(e,t,n,i,a,o,s,r,l,c,d,p,u){var m=this,f=function(){m.l10n={range:p.getAllBandsL10n()}};t.$on("destroy",n.$on("$translateChangeSuccess",function(){return e(f)})),f(),m.accessPoints={wifi2:{},wifi5:{}},m.wifi2exists=!0,m.wifi5exists=!0,m.wifiTurnOff=!1,m.userApId=!1,m.dataLoaded=!1,m.mode={toggle:function(e){e!==m.mode.current&&(m.mode.current="password"===m.mode.current?"WPS":"password",o.forEach(m.accessPoints.wifi2,function(e){return m.checkStateWPS(e,1)}),o.forEach(m.accessPoints.wifi5,function(e){return m.checkStateWPS(e,1)}))},text:"show WPS",current:"password"},m.onKeydown=function(e,t){if(d.isSpace(e))return e.preventDefault(),e.stopPropagation(),m.mode.toggle(t),!0};var g=function(e){for(var t=Object.keys(m.accessPoints),n=0,i=t.length;n<i;++n)for(var a=m.accessPoints[t[n]],o=Object.keys(a),s=0,r=o.length;s<r;++s){var l=a[o[s]];if(l.ap===e)return l}return null},v=function(e,t){return u.setWifiState({ap:e},t).then(function(){if(t){var n=g(e);n&&(n.wpsProgress=void 0,m.checkStateWPS(n))}}).finally(function(){delete m.toggledApIfaces[e]})};m.toggledApIfaces={},m.toggleApState=function(e,t){return m.toggledApIfaces[t]={state:e},t!==m.userApId||e?v(t,e):c.confirm("access-point-is-used to connect-to-the-device","continue-anyway").then(function(){return v(t,e)},function(){var n=g(t);n&&(n.up=!e),delete m.toggledApIfaces[t]})},m.togglePassword=function(e){e.passwordShown=!e.passwordShown},m.checkStateWPS=function(t){function n(e,t){var n=i[0].getElementById("wpsButton-"+e.rename),a=(120-Number(t))/120*100;n&&a&&(n.style.transitionDuration="1s",n.style.width=a+1+"%",a>=99.9?(n.style.transitionDuration="0s",n.style.width="0%"):e.wpsProgress=a)}!m.mode.password&&t.password&&(t.polling?t.polling.start():(t.polling=l.poll("show/interface/wps/status?name="+t.name,1),t.polling.then(function(i){Number(i.wps.left)>0?n(t,i.wps.left):!i.wps.left&&t.wpsProgress>0?(t.wpsProgress=100,e(function(){t.wpsProgress=void 0,n(t,0)},2e3)):(t.wpsProgress=void 0,t.polling.stop())})))},m.startWPS=function(e){if(!angular.isDefined(e.wpsProgress)){return{}[e.name]={wps:{button:{direction:"send"}}},m.startWPS.stateOnStart=!0===e.wps||e.wps&&e.wps.enabled||!1,u.wps.start(e.name).then(function(){m.checkStateWPS(e)})}},m.saveWifiState=function(e){return e.state=e.up?"point.on":"point.off",e.saving=!0,u.setWifiState(e,!e.up).then(function(){e.saving=!1,e.up&&(e.wpsProgress=void 0,m.checkStateWPS(e))})};var h=!0;u.registerCallback(["show","whoami"],function(e,n){h&&(m.showCardContent=!0,t.$parent.Dashboard.cardLoaded("wifi"),h=!1),function(e,t){m.dataLoaded=!0;var n=e.rc.interface,i=e.interface;m.userApId=u.getUserApId(t,o.get(e,"associations.station",[])),o.forEach(n,function(e,t){if((e=n[t]).name=t,angular.isDefined(m.toggledApIfaces[t])?e.up=m.toggledApIfaces[t].state:e.up=Boolean(e.up),e.rename=e.rename||e.name,!e.switchport&&(!e.inherit||e.ipoe)){for(var r in i)if(i[r]["interface-name"]===e.rename){e.state=e.up?"point.on":"point.off",e.hwstate=i[r].hwstate;break}if(e.name===s.MASTER&&(m.wifiTurnOff="off"===e.hwstate),e.ssid&&!m.wifiTurnOff){var l=s.AP.indexOf(e.name)>=0,c=s.AP_5G.indexOf(e.name)>=0;if(l||c){e.encryption&&e.encryption.enable?e.encryption.wpa2&&e.encryption.wpa?e.encryptionMethod="mixed":e.encryption.wpa2?e.encryptionMethod="WPA2":e.encryption.wpa?e.encryptionMethod="WPA":e.encryption.key&&(e.encryptionMethod="WEP"):e.encryptionMethod="disabled",e.hidden=e["hide-ssid"]||!1,e.wpsEnabled=Boolean(a("wps.enabled")(e)),e.password=a('authentication["wpa-psk"].psk')(e)||"";var d=s.profile.features.wifi5ghz&&o.startsWith(t,s.MASTER_5G);e.range=m.l10n.range[d?"5":"2"],e.ap=t,e.name=e.rename||t,l&&(m.accessPoints.wifi2[e.name]||(m.accessPoints.wifi2[e.name]={}),m.accessPoints.wifi2[e.name].saving&&(e.up=m.accessPoints.wifi2[e.name].up),angular.extend(m.accessPoints.wifi2[e.name],e)),c&&(m.accessPoints.wifi5[e.name]||(m.accessPoints.wifi5[e.name]={}),m.accessPoints.wifi5[e.name].saving&&(e.up=m.accessPoints.wifi5[e.name].up),angular.extend(m.accessPoints.wifi5[e.name],e))}}}}),m.accessPoints.wifi2&&!Object.keys(m.accessPoints.wifi2).length&&(m.wifi2exists=!1),m.accessPoints.wifi5&&!Object.keys(m.accessPoints.wifi5).length&&(m.wifi5exists=!1)}(e,n)})}e.$inject=["$timeout","$scope","$rootScope","$document","$parse","_","NDM","utils","router","modal","keyboard","wifiOptions","dashboardDataService"],angular.module("keenetic").controller("DashboardCardWifiController",e)}(),function(){function e(e,t,n,i,a,o,s,r,l,c,d,p,u){var m=this;m.usb=[],m.showCard=n.usb,m.partitions={},m.ejectList=[],m.storageState={__toggle:function(e){m.storageState[e]=!m.storageState[e]}};var f=new s,g=!0,v=function(e){var t=e.total,n=e.free;return a.format.size(t-n,!0)+" / "+a.format.size(t,!0)};m.onKeydown=function(e,t){if(i.isSpace(e))return e.preventDefault(),e.stopPropagation(),m.storageState.__toggle(t),!0},m.goToPrinter=function(e){u.go("controlPanel.apps.printer",{id:e})};m.safeEject=function(e){var n=e.fullName,i=a.getTranslation("dashboard.card_usb.usb-media-eject-confirm",null,{id:n}),o=e.id;return d.confirm(i).then(function(){return m.ejectList.push(o),r.safeEject(o)}).then(function(){return new Promise(function(e){var n=p(function(i){t.find(m.storages,{id:o})||(e("success"),p.cancel(n)),i>30&&(e("error"),p.cancel(n))},1e3)})}).then(function(e){var t=a.getTranslation("dashboard.card_usb.safe-eject-".concat(e),null,{deviceName:n});m.ejectList=m.ejectList.filter(function(e){return e!==o}),function(e,t){c[t]({message:e,timeout:1e3})}(t,e)})};var h=["ls","show.usb","show.media"];(n.cifs||n.tsmb)&&h.push("show.printers"),o.registerCallback(h,function(n,i,a,o){g&&(g=!1,e.$parent.Dashboard.cardLoaded("usb"));var s=t.chain(i.device).map(function(e,t){return{id:t,DEVICE:e.DEVICE,fullName:"".concat(e.manufacturer," ").concat(e.product)}}).groupBy("fullName").map(function(e){return t.map(e,function(e,t){return e.index=t>0?" "+t:"",e})}).flatten().value();m.storages=[],m.usbPrinters=t.chain(o).get("printer",{}).map(function(e,t){var n=l.getPrinterStatus(e),i=e.name;return Object.assign({},e,{id:t,status:n,title:i,icon:"usbPrinter",link:"apps"})}).filter("attached").value();var r=t.set({},"show.media",a);f.setRawData(r).devices.forEach(function(e){if(e.mounted){var n=t.find(s,{id:e.id});e.link="apps",e.subsystem="usb",e.fullName=n.fullName,e.index=n.index,e.isSwap||(e.goToBrowser=function(){return u.go("controlPanel.apps.device",{mediaId:e.id,mediaData:{partitions:e.partitions}})}),e.sizeData=v(e),e.partitions.forEach(function(e){e.sizeData=v(e)}),m.storages.push(e)}}),m.showCardContent=1,m.storageDevicesAmount=Object.keys(m.storages).length})}e.$inject=["$scope","_","components","keyboard","utils","dashboardDataService","UsbStoragesModel","usbDeviceListService","PrinterPopupService","notification","modal","$interval","$state"],angular.module("keenetic").controller("DashboardCardUSBController",e)}(),function(){function e(e,t,n,i,a,o,s,r,l,c,d,p){var u=this;u.canAutoUpdateFw=Boolean(i.get(o,"profile.features.dual_image")),u.systemMode=o.sysmode,u.updateAvailable=!1,u.lastTimeSync=0;var m=function(){u.l10n={mb:l.format.getSizeUnit(s.UNIT_SCALE.MEGA)}};m(),e.$on("$destroy",t.$on("$translateChangeSuccess",function(){return n(m)}));var f=function e(t,i){u.upTime=l.getSplittedTime(t);var a=c.getCurrentTime(i),o=a.currentTime,s=a.dateObj;u.currentTime=o,e.to=n(function(){e(++t,new Date(s.valueOf()+1e3))},1e3)},g={};i.set(g,"show.version",{}),i.set(g,"show.identification",{}),i.set(g,"show.system",{}),i.set(g,"show.clock.date",{}),r.post({url:"",data:g}).then(function(t){var n=i.get(t,"show.version",{}),a=i.get(t,"show.identification",{}),o=i.get(t,"show.system",{}),s=i.get(t,"show.clock.date",{}),r=i.get(a,"servicetag",""),c=i.toArray(r.match(/.{1,3}/g));u.model=l.getDeviceModel(n),u.serviceTag=c.join("-"),u.osVersion=l.getFirmwareVersionTitle(n),u.showCardContent=1,e.$parent.Dashboard.deviceWanMac=a.mac,e.$parent.Dashboard.cardLoaded("system"),f(Number(o.uptime),s)});var v=["show.system","show.clock.date"];u.canAutoUpdateFw&&v.push("show.rc.components.auto-update");var h=!0;p.registerCallback(v,function(e,t,a){u.fwAutoUpdateIsEnabled=!a.disable,u.cpuLoad=e.cpuload+"%";var o=Number(e.memory.split("/")[0]),s=Number(e.memtotal);u.memLoad=l.round(o/s*100,0)+"% ("+l.round(o/1024,0)+"/"+l.round(s/1024,0)+" "+u.l10n.mb+")",Date.now()-u.lastTimeSync>1e4&&(n.cancel(f.to),u.lastTimeSync=new Date,f(Number(e.uptime),t)),h&&(h=!1,d.getComponentsList("",3).then(function(e){var t=i.get(e,"component.base",{}),n=t.version;n&&t.installed&&n!==t.installed&&(u.updateAvailable=!0,u.updateVersionTitle=d.getFirmwareUpdateTitle(e),u.updateVersion=n,u.l10n.newVersion=l.getTranslation("dashboard.card_system.newVersion",null,{version:u.updateVersionTitle}))}))})}e.$inject=["$scope","$rootScope","$timeout","_","browserCheck","NDM","CONSTANT","router","utils","keeneticTime","componentsService","dashboardDataService"],angular.module("keenetic").controller("DashboardCardSystemController",e)}(),function(){function e(e,t,n,i,a,o){var s=this,r=i.PORT_ROLE,l=[r.INET,r.IPTV,r.VOIP],c=!0;s.switchports=a.getSwitchportsList();var d=function(e){return e.id===n.DSL},p=function(e){return"showtime"===t.get(e,"line")};o.registerCallback(["show.interface","show.rc.interface"],function(i,o){s.showCardContent=!0;var u=Object.assign({},function(e){var n=t.chain(e).pickBy("ipoe").mapValues("ipoe").value();return l.reduce(function(e,i){var a="".concat(i,"-port"),o=t.chain(n).map(a).split(",").flatten().filter().value(),s=t.zipObject(o,o.map(function(){return i}));return Object.assign({},e,{},s)},{})}(o),{},function(e){var i=t.chain(e).pickBy("ipvc").mapValues("ipvc").value(),a={};return t.has(n.PORTS_MAP,"DSL")&&(a[t.get(n.PORTS_MAP,["DSL","port"])]=r.INET),t.reduce(i,function(e,n){var i=n.role,a=t.chain(n.port).split(",").filter().value(),o=t.zipObject(a,a.map(function(){return i}));return Object.assign({},e,{},o)},a)}(o));s.switchports=a.getSwitchportsList().map(function(e){var n=t.find(i,{id:e.interfaceId})||i[e.port];if(!n)return console.warn("Port interface status is missing for ".concat(e.port)),e;var a="external"===t.get(n,"transceiver")&&t.has(n,"sfp"),s=t.has(o,[e.interfaceId,"up"]),r=function(e){var n=Number(t.get(e,"speed"));if(isNaN(n))return"";if(n<1e3)return"".concat(n," M");var i=(n/1e3).toFixed(1);return"".concat(i," G")}(n),l=function(e){if(d(e)&&p(e))return t.get(e,"opmode","").toLowerCase().includes("vdsl")?"VDSL":"ADSL";var n=t.get(e,"duplex");return n?n.substr(0,1).toUpperCase()+"DX":"-"}(n),c=function(e,t,n,i){return d(t)&&!p(t)?"disabled":n?i[e]||"":"disabled"}(e.port,n,s,u);return Object.assign({},e,{isSfpActive:a,speed:r,duplex:l,icon:c})}),c&&(c=!1,e.$parent.Dashboard.cardLoaded("switchports"))})}e.$inject=["$scope","_","NDM","CONSTANT","utils","dashboardDataService"],angular.module("keenetic").controller("DashboardCardSwitchportsController",e)}(),function(){function e(e,t,n,i,a,o,s,r,l,c,d,p,u,m,f,g,v,h,b,_,y){var S=this,w=!0,C={},E=!1,I=!1,T={},k=e.$parent.Dashboard,P=c.DEFAULT_HOME_SEGMENT_ID,A=c.DEFAULT_GUEST_SEGMENT_ID,D=["yellow","blue"],O={color:"",hosts:{wifi:{total:0,unreg:0},wired:{total:0,unreg:0}},wifi:{mode:{current:""},isTurnedOff:!1,isHeaderHidden:!1}};S.customLogo={isUpload:!1,isEnabled:void 0!==o.FileReader,_getCanvas:function(){return a[0].querySelector("#customLogo")},_getContext:function(){var e=S.customLogo._getCanvas();return!!e&&e.getContext("2d")},change:function(e){var t=new FileReader;t.onload=function(e){var t=S.customLogo._getCanvas(),n=S.customLogo._getContext(),i=new Image;i.onload=function(){var e=1;i.width>t.width&&(e=t.width/i.width),i.height*e>t.height&&(e=t.height/i.height);var a=Math.round(i.width*e),o=Math.round(i.height*e),s=Math.round((t.width-a)/2),r=Math.round((t.height-o)/2);S.customLogo.clear(),n.drawImage(i,s,r,a,o),S.customLogo.isUpload=!0},i.src=e.target.result},t.readAsDataURL(e.file)},clear:function(){var e=S.customLogo._getCanvas(),t=S.customLogo._getContext();t&&t.clearRect(0,0,e.width,e.height),S.customLogo.isUpload=!1}};var N=function(){S.l10n={wifiDisabledWarning:_.master.getWifiDisabledWarning(),ghz:m.getTranslation(c.UNIT.GHZ),addLogoBtn:m.getTranslation("dashboard.card_segments.wifi.connection-info.add-logo-for-print"),channel:m.getTranslation("dashboard.card_segments.channel"),radar:m.getTranslation("dashboard.card_segments.radar"),range:b.getAllBandsL10n(),title:m.getTranslation(l.sysmode===c.SYSMODE.ROUTER?"dashboard.card_segments.hosts.title":"dashboard.card_segments.hosts.title_special_mode")}},L=function(){g.isEmpty(C)||g.forEach(S.segments,function(e,t){e.title=C[t]?m.getInterfaceL10n(C[t]):t})},x=function(){s(N),L()};N(),e.$on("destroy",n.$on("$translateChangeSuccess",x)),S.showCardContent=!1,S.cardExpanded=!1,S.userApId=!1,S.hostsDataLoaded=!1,S.wifiIsAvailable=Boolean(d.corewireless),S.toggledApIfaces={};var R=function(e,t,n){return v.toggleState(t,n).finally(function(){delete S.toggledApIfaces[t]})};S.wifi={toggleApState:function(e,t,n){return S.toggledApIfaces[t]={state:n},t!==S.userApId||n?R(0,t,n):u.confirm("access-point-is-used to connect-to-the-device","continue-anyway").then(function(){return R(0,t,n)},function(){((function(e,t){var n=S.segments[e].accessPoints.filter(function(e){return e.ap===t});return n.length>0?n[0]:null})(e,t)).up=!n,delete S.toggledApIfaces[t]})}},S.connectionInfoAlert={isVisible:!1,model:null,qrContainer:null,title:"",copyPskToClipboard:function(){m.copyToClipboard(S.connectionInfoAlert.model.passkey)},wps:{isInProgress:!1,requestIsInProgress:!1,disabledMsg:"",progress:0,timeStr:"00:00",toggleState:function(){var e=S.connectionInfoAlert;if(!e.wps.requestIsInProgress)return e.wps.requestIsInProgress=!0,_.ap.toggleWpsSession(e.model.id,!e.wps.isInProgress).then(function(){e.wps.progress=100,e.wps.isInProgress=!e.wps.isInProgress}).finally(function(){e.wps.requestIsInProgress=!1})},checkStatus:function(){var e=S.connectionInfoAlert;return p.get("show/interface/wps/status?name="+e.model.id).then(function(t){var n=t.wps||{};if(n.duration&&n.left){var i=n.left,a=Math.floor(i/60),o=i%60;e.wps.progress=m.round(100*i/n.duration,1),e.wps.timeStr=g.padStart(a,2,"0")+":"+g.padStart(o,2,"0"),e.wps.isInProgress=!0}else e.wps.progress=0,e.wps.timeStr="00:00",e.wps.isInProgress=!1})}},show:function(e){var n=S.connectionInfoAlert;if(n.model=e,n.title=m.getTranslation("dashboard.card_segments.wifi.connection-info.alert-title",null,{ssid:n.model.ssid,range:"".concat(n.model.range,"&nbsp;").concat(S.l10n.ghz)}),n.isVisible=!0,n.qrContainer){var i;i="WEP"===e.security?"WEP":"disabled"===e.security?"nopass":"WPA";var a=function(e){return e.split("\\").map(function(e){return e.replace(/[",;:]/g,"\\$&")}).join("\\\\")},o="WIFI:T:".concat(i,";S:").concat(a(e.ssid),";P:").concat(a(e.passkey),";"),s=r.QrSegment.makeSegments(o);r.QrCode.encodeSegments(s,r.QrCode.Ecc.LOW,1,40,-1,!1).drawCanvas(8,4,n.qrContainer)}var l,c=S.segments[n.model.segmentName],d=c?m.l10n.getLinkChunks("segment",{"ng-href":t.href("controlPanel.segments.WiFi",{tab:c.title,band:n.model.band}),class:"ref-link"}):{};n.model.wpsDisabled?(l=n.model.isWpa3?"dashboard.card_segments.wifi.wps-disabled-wpa3":"dashboard.card_segments.wifi.wps-disabled",l=m.getTranslation(l,null,d)):l="",n.wps.disabledMsg=l},hide:function(){S.customLogo.clear(),S.connectionInfoAlert.isVisible=!1}};T[P]=angular.copy(O),T[P].color="purple",S.segments=angular.copy(T);var M={},$=function(){w=!1,S.showCardContent=!0,k.cardLoaded("segments"),s(function(){S.connectionInfoAlert.qrContainer=a[0].querySelector("#access-point_qr")})},F=function(e){var t=S.wifiIsAvailable&&e[l.MASTER]||{},n=l.MASTER_5G&&e[l.MASTER_5G]||{};return"off"===t.hwstate||"off"===n.hwstate},V=function(){E&&y.deregisterCallback(E),T[A]=angular.copy(O),T[A].color="green",I||(I=y.registerCallback(["show.rc.interface","show.schedule","show.interface"],function(e,t,n){var i={},a=angular.copy(T),o=0;g.forEach(e,function(s,r){var l=s.iseg;if(l){i[r]=l,a[r]||(a[r]=angular.copy(O)),C[r]=s,a[r].color||(a[r].color=D[++o%2]),s=angular.extend(s,angular.copy(a[r]));var c=l.include&&l.include.split(",")||[];c=(c=c.filter(function(t){return v.isAccessPointInterfaceId(t)&&e[t]&&e[t].ssid})).map(function(i){var a=e[i];if(!a)return{};a.id=i;var o=_.ap.ifaceToModel(a),s={id:o.masterId};o.segmentId=r,o.segmentName=r,o.encryptionMethod=o.security,o.wpsDisabled=!o.wps||b.isWpa3Psk(o.security),o.isWpa3=b.isWpa3Psk(o.security),angular.isDefined(S.toggledApIfaces[i])?o.up=S.toggledApIfaces[i].state:o.up=Boolean(o.isEnabled),o.range=S.l10n.range[o.band],o.ap=i,o.name=a.rename||i,o.isDisabledOnSchedule=o.up&&a.schedule&&!h.isActive(t[a.schedule]);var l=g.find(n,s)||{};o.channelL10n=l.channel?"\n".concat(S.l10n.channel," ").concat(l.channel):"",o.channel=l.channel,o.isDFSChannel=_.master.checkIfChannelIsDfs(l.channel)&&l.dfs;var c=g.get(l,"dfs.cac",null),d=c?m.getSplittedTimeInMS(c):null;return o.radarStatus=c?"".concat(S.l10n.radar," ").concat(d):"",o}),s.wifi.isHeaderHidden=c.filter(function(e){return!e.password}).length===c.length,s.accessPoints=c,M[r]=s}})})),l.sysmode===c.SYSMODE.ROUTER?E=y.registerCallback(["show.ip.hotspot","show.interface","whoami","show.schedule"],function(e,t,n,i){e=e&&e.host?e.host:[],S.hostsDataLoaded=!0,S.userApId=y.getUserApId(n,e),S.wifi.isTurnedOff=F(t),g.forEach(M,function(e,t){if(e.hosts=angular.copy(O.hosts),e.wifi.mode.current=S.wifi.isTurnedOff?"off":"password",S.segments[t]){var n=g.get(angular.copy(S.segments[t]),"wifi.mode.current");n&&!S.wifi.isTurnedOff&&"off"!==n&&(e.wifi.mode.current=n),S.segments[t].accessPoints&&(e.accessPoints.forEach(function(e,n){S.segments[t].accessPoints[n].up=e.up,S.segments[t].accessPoints[n].channel=e.channel,S.segments[t].accessPoints[n].isDFSChannel=e.isDFSChannel,S.segments[t].accessPoints[n].radarStatus=e.radarStatus,S.segments[t].accessPoints[n].channelL10n=e.channelL10n,S.segments[t].accessPoints[n].isDisabledOnSchedule=e.up&&e.schedule&&!h.isActive(i[e.schedule])}),delete e.accessPoints)}}),g.forEach(e,function(e){if(e.active){var t={},n=g.get(e,"interface.id","");if(M[n]&&!g.includes(k.mwsMemberMacs||[],e.mac)){var i=M[n].hosts;t=e.ap||e.mws?i.wifi:i.wired,e.registered||t.unreg++,t.total++}}}),angular.merge(S.segments,angular.copy(M)),L(),w&&$(),S.hostsDataLoaded=!0}):l.sysmode!==c.SYSMODE.AP&&l.sysmode!==c.SYSMODE.REPEATER&&l.sysmode!==c.SYSMODE.EXTENDER||(E=y.registerCallback(["whoami","show.interface","show.associations"],function(e,t,n){S.wifi.isTurnedOff=F(t),S.userApId=y.getUserApId(e,g.get(n,"station",[])),S.hostsDataLoaded=!0,g.forEach(M,function(e){e.hosts=angular.copy(O.hosts),delete e.hosts.wired,e.accessPoints.forEach(function(t){e.hosts.wifi.total+=function(e,t){return(e.station||[]).slice().filter(function(e){return e.ap===t})}(n||{},t.ap).length})}),angular.merge(S.segments,angular.copy(M)),L(),w&&$()}))};V(),e.$on("destroy",n.$on(c.events.SYSMODE_CHANGED,function(){x(),V()}))}e.$inject=["$scope","$state","$rootScope","$parse","$document","$window","$timeout","qrcodegen","NDM","CONSTANT","components","router","modal","utils","keyboard","_","interfaces","schedules","wifiOptions","wifiSettingsService","dashboardDataService"],angular.module("keenetic").controller("DashboardCardSegmentsController",e)}(),function(){function e(e,t,n,i,a,o,s,r,l,c,d,p,u,m,f){var g=c.LINK_LOCAL_PREFIX,v=l.DSL_IFACE_PREFIXES,h=l.USBDSL_IFACE,b=o.UNIT,_=m.SIM_CARD_STATE,y=m.USB_QMI_INTERFACE_TYPE,S={WIRED:"wired",DSL:"UsbDsl",MODEM:"modem",USBQMI:"usbqmi",WISP:"wisp",IPSEC_VPN:"IPsec",VPN:"_NOT_AN_ISP_"},w=["OpenVPN","PPTP","L2TP","IPsec","SSTP",f.IKE_INTERFACE_TYPE],C=[S.WIRED,S.WISP,S.MODEM,S.USBQMI,"IPIP","EoIP","GRE","PPPoE","Wireguard",S.DSL].concat(w),E=["temperature","vcc","tx-bias","tx-power","rx-power"],I=function(e,i,a){var o=t.findIndex(e,function(e){return"status"===(e.name||e)});if(-1===o||!i.someFilterInstalled)return e;var s,r,l,c,d=i.enabled?"--success":"--warning",p="help-text".concat(d),u=n.getTranslation("netFilter.filters.".concat(i.enabled)),m="dashboard.card_internet.inet-filter-".concat(i.enabled?"enabled":"disabled"),f=n.getTranslation(m,null,{service:u}),g='<span class="'.concat(p,'">').concat(f,"</span>");return s=e,r=o+1,l={name:"internetFilterState",l10nKey:"inet-filter",val:g,linkAfterText:function(e){return{text:"dashboard.card_internet.setup-inet-filter",callback:e.goToInternetFilterPage,isDisabled:!1}}(a)},(c=t.clone(s)).splice(r,0,l),c};return{linkCallbackConstructor:function(t,n){return function(a,o){if(!o.isDisabled){var r=t(a),l=n(a);s.confirm(r).then(function(){o.isDisabled=!0,i.postToRciRoot(l).finally(function(){e(function(){o.isDisabled=!1},2e3)})})}}},roundMaxVelocity:function(e){var t,i=Math.log(e)/Math.log(n.format.MULTIPLIER_SPEED)|0,a=Math.pow(n.format.MULTIPLIER_SPEED,i),o=parseInt(e/a,10);return i<2?t=100:(o>=1&&o<50&&(t=5),o>=50&&o<100&&(t=10),o>=100&&o<500&&(t=50),o>=500&&o<1e3&&(t=100)),Math.ceil(o/t)*t*Math.pow(n.format.MULTIPLIER_SPEED,i)},getIfacePropsFn:function(e,i,a,s){return function(l){var c=l.type,u=[];if(l.status=function(e){if(!angular.isObject(e.status))return e.status;var n=t.get(e,"status.color"),i="help-text".concat({red:"--warning",green:"--success"}[n]||"");return'<span class="'.concat(i,'">').concat(e.status.text,"</span>")}(l),[S.MODEM,S.USBQMI].includes(c)){var m=c===S.MODEM?function(e){return{text:"dashboard.card_internet.restart-modem.link",callback:e.restartModem,isDisabled:!1}}(s):function(e){return{text:"dashboard.card_internet.restart-usbqmi-modem.link",callback:e.restartInternalModem,isDisabled:!1}}(s);u.push({name:"product",val:l.product,linkAfterText:!!l.isPlugged&&m}),u.push("status")}else u.push("product","status"),l.canBeRestarted&&(u[1]={name:"status",ifaceHasProp:l.status,val:l.status,linkAfterText:{text:"dashboard.card_internet.restart-iface.link",callback:s.restartIface,isDisabled:!1}});if(l.pppType&&[S.WIRED,S.DSL].includes(c)&&u.push({name:"pppType",val:l.pppType,l10nText:n.getTranslation("dashboard.card_internet.isp-ppp-type")}),u=I(u,a,s),[S.WISP,S.MODEM].includes(c)){if(u=u.concat(["fw","uiccid","operator","cgi",{name:"rssi",ifaceHasProp:c===S.WISP,val:{directive:{name:"ndm-meter",options:{class:"meter",level:n.rssiToQuality(Number(l.rssi))}}}},{name:"uptime",ifaceHasProp:l.uptime,val:n.getSplittedTime(l.uptime)}]),c!==S.WISP&&(l.cinr||l.ecio||l.rssi)){var f=l.id.startsWith(y),v=p.getSignalLevelValue(l,{l10nData:e,noValueStr:"&mdash;",forceCinrRssi:!f}),C=v.value,T=v.l10nKey,k=v.hasIcon;u.push({name:T,val:C,hasIcon:k})}u=u.concat([{name:"freq",ifaceHasProp:l.freq>0,val:"".concat(l.freq/1e3," ").concat(e.units[b.MHZ])},{name:"mobile",l10nKey:"modem-network-type",ifaceHasProp:Boolean(l.mobile),val:p.getCurrentStandard(l,"&mdash;")},{name:"bssid",l10nKey:"modem-bssid",ifaceHasProp:c===S.MODEM&&l.bssid,val:l.bssid}])}if(c===S.USBQMI){var P,A=t.get(l,"sim",_.UNKNOWN),D=A===_.UNKNOWN?"&mdash;":n.getTranslation("usbqmi.sim-state.".concat(A)),O=p.getCurrentStandard(l,"&mdash;"),N=[{name:"simCardStatus",l10nKey:"sim-card-status",val:D},{name:"networkType",l10nKey:"modem-network-type",val:O},"operator"];if(p.is3gStandard(O)||p.is4gStandard(O)){var L=p.getSignalLevelValue(l,{l10nData:e,noValueStr:"&mdash;"}),x=L.value,R=L.l10nKey,M=L.hasIcon;N.push({name:"signal-level",l10nText:n.getTranslation("dashboard.card_internet.".concat(R)),val:x,hasIcon:M})}N.push({name:"uptime",ifaceHasProp:l.uptime,val:n.getSplittedTime(l.uptime)}),(P=u).push.apply(P,N)}var $=u.length;l.hasVia&&l.viaAddress?(u.push({name:"address",ifaceHasProp:l.viaAddress,val:l.viaAddress}),u.push({name:"pppAddress",l10nText:n.getTranslation("dashboard.card_internet.ppp-address",null,{type:l.pppType}),ifaceHasProp:l.address,val:l.address})):u.push({name:"address",ifaceHasProp:l.address,val:l.address}),l.canRenewAddress&&(u[$].linkAfterText={text:"dashboard.card_internet.renew-address.link",callback:s.renewAddress,isDisabled:!1}),u=u.concat(["gateway","mask"]),[S.MODEM,S.USBQMI].includes(c)&&u.push({name:"imei",ifaceHasProp:l.imei,val:l.imei}),(w.includes(c)||w.includes(l.pppType))&&u.push({name:"serverAddress",ifaceHasProp:l.peer,val:l.peer},{name:"uptime",ifaceHasProp:l.uptime,val:n.getSplittedTime(l.uptime)});var F,V=l.ipv6Addresses,U=l.ipv6Prefixes,B=l.ipv6Routes;V&&V.length&&(F=V,V=t.filter(F,function(e){return 0!==e.address.indexOf(g)}));var W=function(e,t,n,i){1===e.length?u.push({name:"ipv6.".concat(n),val:e[0][t]}):u.push({name:"ipv6.".concat(i),val:e.map(function(e){return e[t]})})};if(V&&V.length&&W(V,"address","address","addresses"),U&&U.length){var H=U.filter(function(e){return"0"!==e["preferred-lifetime"]});H.length>0&&W(H,"prefix","prefix","prefixes")}if(B&&B.length&&W(B,"gateway","route","routes"),l.dslInfo){var q=l.dslInfo,j=l.parentDslIface===h,K=q.opmode&&d.isAdslOpmode(q.opmode),G=d.format.toDslSpeed,Y=d.format.toDslLevel;u=u.concat([{name:"dsl.standard",l10nText:n.getTranslation("diagnostics.dsl.standard"),ifaceHasProp:q.standard,val:q.standard+(K||!q.profile?"":", ".concat(q.profile))},{name:"dsl.mode",l10nKey:"usbdsl.mode",ifaceHasProp:j&&!K,val:q.opmode&&"CO"===q.opmode.substring(q.opmode.length-2)?e.dslInfo&&e.dslInfo.server:e.dslInfo&&e.dslInfo.client},{name:"dsl.speed",l10nKey:"usbdsl.speed",ifaceHasProp:t.some(["ds_intd_rate","ds_fast_rate","us_intd_rate","us_fast_rate"],function(e){return G(q[e])}),val:d.format.pairOfValues(G(q.ds_intd_rate)||G(q.ds_fast_rate),G(q.us_intd_rate)||G(q.us_fast_rate),e.speed[o.UNIT_SCALE.KILO])},{name:"dsl.noise-level",l10nKey:"usbdsl.noise-level",ifaceHasProp:q.ds_noise||q.us_noise,val:d.format.pairOfValues(q.ds_noise,q.us_noise,e.units[b.DB],Y)},{name:"dsl.signal-power",l10nKey:"usbdsl.signal-power",ifaceHasProp:q.us_power,val:d.format.withUnit(G(q.us_power),e.units[b.DBM])},{name:"dsl.atten",l10nKey:"usbdsl.atten",ifaceHasProp:q.ds_atten||q.us_atten,val:d.format.pairOfValues(q.ds_atten,q.us_atten,e.units[b.DB],Y)}])}if(c===S.WISP&&(u=u.concat(["ssid","ap"]),l.ap&&(u=u.concat(["bw","rate","mode"]))),[S.MODEM,S.USBQMI].includes(c)||u.push({name:"mac",val:l.macAddress}),i&&i.name&&l.isDefaultGw&&t.get(l,"state.name")===r.constants.ISP_STATE.CONNECTED){var z=i.name+"."+i.domain,Q=i.acme,X=i.certificates,Z=!1,J=!1;z===Q["ndns-domain"]&&Q["ndns-domain-acme"]&&(Z=!0),z&&Z&&(J=t.some(X,{domain:z})),u.push({name:"keendns",hasIcon:Z,val:Z?z+n.generateIconHtml(J?"https":"wait4https"):z})}l.dyndns&&(u=u.concat([{name:"ddns-name",ifaceHasProp:l.dyndns.domain,val:l.dyndns.domain},{name:"ddns-state",ifaceHasProp:l.dyndns.message,val:l.dyndns.message}]));var ee=l.via?[l.viaShowInterface,l.viaSwitchShowInterface]:[l,l.viaSwitchShowInterface],te=t.find(ee,function(e){return t.get(e,"port.sfp")&&"external"===t.get(e,"port.transceiver")});return te&&(u.push({name:"sfp.status",val:e.sfp.status.active}),E.forEach(function(e){var n=t.get(te,"port.sfp."+e);n&&u.push({name:"sfp."+e,val:n})})),l.stat&&(u=u.concat([{name:"receive",val:n.format.speed(l.stat.rxspeed)},{name:"transfer",val:n.format.speed(l.stat.txspeed)},{name:"received",val:l.stat.rxbytes},{name:"transferred",val:l.stat.txbytes}])),l.via&&![S.WIRED,S.DSL].includes(c)&&u.push({name:"via",val:(l.viaLabel||l.via)+(l.viaAddress?" ("+l.viaAddress+")":"")}),u.map(function(t){var n;if(angular.isString(t)&&l[t])n={name:t,l10nKey:e&&e.ifaceProp(t),val:l[t]};else if(angular.isObject(t)&&(!("ifaceHasProp"in t)||t.ifaceHasProp)){var i={};i=t.val?angular.isObject(t.val)&&!angular.isArray(t.val)?t.val:{val:t.val}:{val:l[t.name]},n=angular.extend({},{name:t.name,l10nKey:e&&e.ifaceProp(t.l10nKey||t.name),linkAfterText:t.linkAfterText||!1,hasIcon:t.hasIcon||!1},i)}return n&&t.l10nText&&(n.l10nKey=t.l10nText),n}).filter(angular.identity)}},getTimes:function(e){return e=e||18e4,{current:new Date,deltaAgo:new Date(new Date-e)}},fmt:{formatTime:function(e){return"".concat(t.padStart(e.getHours(),2,"0"),":").concat(t.padStart(e.getMinutes(),2,"0"))},formatBandwidth:function(e,t){return"".concat(e||0," ").concat(t.units[b.MHZ])},formatRate:function(e,t){return"".concat(Number(e)||0," ").concat(t.speed[o.UNIT_SCALE.MEGA])}},constant:{ISP_TYPE:S,PPP_TYPES:w,CONN_TYPES:C,UNIT:b,USBDSL_IFACE:h,USBDSL_MODES:["client","server"],IPV6_PROPS:["addresses","address","prefixes","prefix","routes","route"],DSL_IFACE_PREFIXES:v,LINK_RELEASE_TIMEOUT:2e3,IKEV1:f.PPP_TYPE.IKEV1,IKEV2:f.PPP_TYPE.IKEV2,IKE_TYPE:f.IKE_INTERFACE_TYPE}}}e.$inject=["$timeout","_","utils","router","NDM","CONSTANT","modal","interfaces","usbdslConsts","ipV6Service","dslService","modemsCommon","usbQmi","usbQmiConstants","pppConstants"],angular.module("keenetic").factory("cardInternetService",e)}(),function(){function e(e,t,n,i,a,o,s,r,l,c,d,p,u,m,f,g,v,h,b,_,y,S){var w=this,C=y.constant,E=y.fmt,I="dashboard.card_internet",T=s.translatePrefixCtor(I),k=Boolean(d.pingcheck),P=C.DSL_IFACE_PREFIXES,A=C.ISP_TYPE,D=C.IKE_TYPE,O=C.IKEV1,N=C.IKEV2,L=[u.SYSMODE.REPEATER,u.SYSMODE.CLIENT,u.SYSMODE.EXTENDER],x=function(e){return r.includes([A.WISP,A.WIRED,A.DSL],e.type)},R=function(e){return e.id===b.INTERFACE_ID};w.ISP_TYPE=A;var M=o.sysmode===u.SYSMODE.ROUTER,$={},F=function(e){return e.title=$[e.id]||s.getInterfaceL10n(e),e.type===A.DSL&&(e.title=s.getInterfaceL10n(e)),e.type===A.WISP&&(e.title=e.description||e.ssid),e.title===o.WAN_DESCRIPTION&&e.viaRename===o.WAN&&(e.title=s.getTranslation("interface-translations."+o.WAN)),e.title===o.WAN_DESCRIPTION&&0===(e.viaRename||"").indexOf(o.DSL)&&(e.title=s.getTranslation("interface-translations.DSL-ISP")),e},V=function(){w.l10n={wispRange:f.getAllBandsL10n(),noConnections:T("no-connections"),homeSegment:s.getTranslation("interface-translations."+o.LAN),title:T("title".concat(M?"":"_special_mode")),units:{},speed:{},rate:s.getTranslation("rate"),types:{},dslInfo:{},ipv6:{},dns:{server:T("dns-server"),servers:T("dns-servers")},sfp:{status:{active:T("sfp.status-active")}},_ifaceProps_:{},ifaceProp:function(e){return w.l10n._ifaceProps_[e]||(w.l10n._ifaceProps_[e]=T(e)),w.l10n._ifaceProps_[e]},titlePppConfig:function(e){return s.getTranslation("wired.title-ppp-config",null,{pppType:" (".concat(e.pppType,")")})}},r.forEach(C.UNIT,function(e){w.l10n.units[e]=s.getTranslation(e)}),r.union(C.CONN_TYPES,[O,N]).forEach(function(e){w.l10n.types[e]=T("types."+e)}),s.format.PREFIX_ORDER.forEach(function(e){w.l10n.speed[e]=s.format.getSpeedUnit(e)}),C.USBDSL_MODES.forEach(function(e){w.l10n.dslInfo[e]=T("usbdsl.modes."+e)}),C.IPV6_PROPS.forEach(function(e){w.l10n.ipv6[e]=T("ipv6."+e)}),(w.ifaces||[]).forEach(function(e){if(e=F(e),angular.isObject(e.state)){var t=s.getTranslation(e.stateTextL10nPrefix+"."+e.state.name);e.state.text=t,e.type===A.WIRED?e.status=s.getTranslation(e.detailedStateL10nId):e.status=t}e.accordionProps=w.getIfaceProps(e)}),w.lang=s.getCurrentLanguage()};V(),e.$on("destroy",a.$on("$translateChangeSuccess",function(){return n(V)})),w.accordion={data:{},toggle:function(e){w.accordion.data[e]=!w.accordion.data[e]},state:function(e){return Boolean(w.accordion.data[e])},text:function(e){return"".concat(I,".").concat(w.accordion.data[e]?"close":"show","-info")}};var U=function(e){return u.USB_MODEM_IFACE_TYPES.indexOf(e)>-1},B=function(e){return r.includes(u.ISP_PPP_IFACE_TYPES,e)},W=function(e){return e===o.STA||e===o.STA_5G};w.processSref=function(e,n){return t.href(e,n||{})},w.getIfaceSetupPageByType=function(e){var t="controlPanel.",n=e?e.type:A.WIRED;switch(U(n)&&(n=R(e)?A.USBQMI:A.MODEM),n){case A.DSL:t+=e.parentDslIfaceId===C.USBDSL_IFACE?"usbdsl":"dsl";break;case A.WIRED:t+="wired";break;case A.USBQMI:case A.MODEM:t+="modems";break;case A.WISP:t+="wifiClient";break;default:t+="otherConnections"}return t},w.goToDnsSettings=function(e){var n=w.getIfaceSetupPageByType(e),i=["wired","dsl","usbdsl"].some(function(e){return n.endsWith(e)}),o=i?n:"controlPanel.netFilter",r=i?["DNS 1","iface-ip.show-additional-settings"]:["netFilter.static-dns.header"],l=a.$on(u.events.PAGE_LOADED,function(){s.dom.highlightFirstMatchedElement(r.map(function(e){return s.getTranslation(e)})),l()});t.go(o)},w.getIfaceKindByType=function(e){var t,n="";e.type&&((t=U(e.type)?R(e)?A.USBQMI:A.MODEM:e.type)===D&&(t=_.getIkeType(e)),t===A.VPN&&(t=e.pppType),n=w.l10n&&w.l10n.types[t],t===A.WISP&&(n+=e.range?" "+e.range:""));return n},w.chart={anchorLeft:"",anchorRight:""},w.dnsFilterServicesData={someFilterInstalled:r.some(g.getInstalledServices(),angular.identity)},M&&w.dnsFilterServicesData.someFilterInstalled&&g.getServicesInitData().then(function(e){w.dnsFilterServicesData=Object.assign({},w.dnsFilterServicesData,{},e)});var H={restartModem:y.linkCallbackConstructor(function(e){return s.getTranslation("".concat(I,".restart-modem.confirm"),null,{modem:e.title})},function(e){var t=e.type===A.DSL&&r.startsWith(e.id,C.USBDSL_IFACE)?C.USBDSL_IFACE:e.id;return r.set({},["interface",t,"usb","power-cycle"],{pause:C.LINK_RELEASE_TIMEOUT})}),restartInternalModem:y.linkCallbackConstructor(function(e){return s.getTranslation("".concat(I,".restart-usbqmi-modem.confirm"),null,{modem:e.title})},function(e){return r.set({},["interface",e.id,"usb","power-cycle"],{pause:C.LINK_RELEASE_TIMEOUT})}),restartIface:y.linkCallbackConstructor(function(e){return s.getTranslation("".concat(I,".restart-iface.confirm"),null,{iface:e.title})},function(e){var t=["interface",e.id,"up"];return[r.set({},t,{no:!0}),r.set({},t,{no:!1})]}),renewAddress:y.linkCallbackConstructor(function(e){return s.getTranslation("".concat(I,".renew-address.confirm"),null,{connection:e.title})},function(e){var t=["interface",e.viaIfaceId||e.id,"ip","address","dhcp"];return[r.set({},t,{no:!0}),r.set({},t,{no:!1})]}),goToInternetFilterPage:function(){return t.go("controlPanel.netFilter")}},q=[{station:o.STA,master:o.MASTER}];o.profile.features.wifi5ghz&&q.push({station:o.STA_5G,master:o.MASTER_5G});var j=!0,K=S.getPolling();S.registerCallback(["show","ip"],function(t,i){var a=t.rc,l=r.get(t,"internet.status",{}),c=a.interface,d=t.interface,g=p.getInterfaceOptions(d),_=t.ip,I=t.ipv6,D=_["name-server"],O=_.route,N=t.ndns,V=r.get(t,"dyndns[0]",{}),G=r.get(i||{},"http.ssl.acme.list.certificate",[]);$=p.getInterfaceIdToDescriptionMap(d),M=o.sysmode===u.SYSMODE.ROUTER;var Y=[],z=!!k&&r.get(t,"ping-check.pingcheck",[]);N&&N.name&&(N.acme=t.acme,N.certificates=G),w.getIfaceProps=y.getIfacePropsFn(w.l10n,N,w.dnsFilterServicesData,H),w.maxPriority=0,w.dnsServers=r.chain(D).get("server",[]).filter(function(e){return!e.domain}).reduce(function(e,t){var n=String(t.global),i=r.get(e,n,[]);return Object.assign({},e,_defineProperty({},n,[].concat(_toConsumableArray(i),[t.address])))},{}).value();var Q=w.dnsServers[0]||[],X=Q.length>0,Z=[],J=function(e,t,n){var i=angular.copy(c[e]),a=r.get(i,"operating-mode.mode","").toLowerCase().indexOf("adsl")>-1;return n.type=A.DSL,n.parentDslIfaceId=e,n.dslInfo=r.extend(i,r.find(d,{id:e})||{}),n.isPlugged="yes"===r.get(d[e],"plugged"),n.description=n.description||v.getDescription(c,e),(a&&r.get(n,"ipvc.role","")===u.INTERFACE_ROLE.INET||!a&&t.indexOf(e+"/Vlan")>-1&&(p.hasRole(n,u.INTERFACE_ROLE.INET)||!n.role))&&Z.push(e),r.get(n,"ip.global")||Z.push(t),n};r.forEach(c,function(e,t){if(!e.switchport&&!p.isAccessPointInterfaceId(t)&&!p.isAccessPointInterfaceId(e.rename||"")){var n=r.get(e,"ip.global.priority");if((o.sysmode!==u.SYSMODE.ROUTER||!angular.isUndefined(n))&&e.up){e.id=t,e.priority=n,w.maxPriority=Math.max(w.maxPriority,n);var i,a=d[t]||r.find(d,function(n){return n.id===t||n["interface-name"]===e.rename});if(a){if(!(a.global&&"no"!==a.plugged||U(a.type)||a["interface-name"]===C.USBDSL_IFACE||R(e)))return;(B(a.type)||(i=a.type,-1!==C.PPP_TYPES.indexOf(i)))&&(e.pppType=a.type);var l=a.via;if(l){var m=r.find(g,{id:l})||{},f=r.find(d,function(e){return e.id===l||e["interface-name"]===l})||{};e.viaLabel=m.ifaceDescription||m.label,e.viaId=l,e.viaAddress=f.address}W(t)&&(e.bw=E.formatBandwidth(a.bw,w.l10n),e.rssi=s.rssiToQuality(Number(a.rssi)),e.rate=E.formatRate(a.rate,w.l10n)),"L2TP"===a.type&&e.ipsec&&(e.type=A.IPSEC_VPN);var v=l?e.viaId:e.id,h=r.find(d,function(e){return[e.id,e["interface-name"]].includes(v)});e=angular.extend(r.chain(e).cloneDeep().omit(["mobile"]).value(),a,{macAddress:h.mac})}e.usb&&t!==C.USBDSL_IFACE&&!R(e)&&(e.modemType=e.type,e.type=A.MODEM,e.isPlugged="yes"===r.get(a,"plugged")),R(e)&&(e.type=A.USBQMI,e.isPlugged=!0),0!==e.id.indexOf("GigabitEthernet")&&0!==e.id.indexOf("FastEthernet")&&"Bridge"!==e.type||(e.type=A.WIRED),P.forEach(function(n){(0===t.indexOf(n)||M&&r.some(p.getBridgedIfaces(a),function(e){return r.startsWith(e,n)}))&&(e=J(n,t,e))}),W(t)&&(e.type=A.WISP,e.range="".concat(w.l10n.wispRange[t===o.STA_5G?"5":"2"]," ").concat(w.l10n.rate));var b,_,y,S=e.viaId||e.via||r.get(e,"connect.via");if(S){e.hasVia=!0;var T=d[S]||r.find(d,function(e){return e.id===S||e["interface-name"]===S}),k=r.find(P,function(e){return 0===r.get(T,"id","").indexOf(e)})||(b=T,_=r.get(b,"bridge.interface",[]).map(function(e){return e.interface}).filter(function(e){return P.some(function(t){return r.startsWith(e,t)})}),!!(y=_.length>0?_[0]:"")&&y.split("/")[0])||!1;if(T&&T.port||p.hasRole(e,u.INTERFACE_ROLE.INET)?(e.pppType=a.type,e.type=k?A.DSL:A.WIRED):T&&T.channel?e.type=A.WISP:-1===C.CONN_TYPES.indexOf(e.type)&&(e.type=A.MODEM),T){e.viaOption=r.find(g,{id:T.id}),e.viaRename=T["interface-name"],e.viaState=s.getInterfaceStatus(T),e.viaIface=c[T.id]||r.find(c,{id:T.id}),e.viaShowInterface=T;var D=String(T.id).includes("Vlan")?T.id.split("/")[0]:T.id;e.viaSwitchShowInterface=d[D]||r.find(d,{id:D}),e.viaIfaceType=T.type,e.viaIfaceId=T.id,e.viaAddress=T.address,k?(e.type=A.DSL,e.dslInfo=c[k],e=J(k,t,e),Object.keys(c).forEach(function(e){0===e.indexOf(k)&&Z.push(e)})):e.global&&p.hasRole(e,u.INTERFACE_ROLE.INET)&&Z.push(e.viaIfaceId)}}if(a&&a.defaultgw){for(var N="",L=O.length-1;L>=0;--L){var x=O[L];x.interface!==e.rename&&x.interface!==t||x.gateway===u.ZERO_IP_ADDRESS||(N=x.gateway)}e.gateway=N}if(a&&I){var $=function(e,t){return r.filter(e,function(e){return e.interface===t["interface-name"]||e.interface===t.id})};e.ipv6Addresses=$(r.get(I,"addresses.address",[]),a),e.ipv6Prefixes=$(r.get(I,"prefixes.prefix",[]),a),e.ipv6Routes=$(r.get(I,"routes.route_",[]),a)}angular.isDefined(a.priority)&&(w.dnsServers[a.priority]||X)&&(e.dnsServers=w.dnsServers[a.priority||n]||[],M&&(e.dnsServers=e.dnsServers.concat(Q))),V.interface&&(r.includes(V.interface,e.rename)||r.includes(V.interface,e.id))&&(e.dyndns=V),a&&(e.isDefaultGw=Number(a.defaultgw),e.sortOrder=e.isDefaultGw?1e6:0+e.priority,e.canRenewAddress=r.get(e,"ip.address.dhcp")&&e.ipoe||e.type===A.WIRED&&e.viaIface&&r.get(e.viaIface,"ip.address.dhcp")&&e.viaIface.ipoe,e.canBeRestarted=B(e.pppType),angular.isDefined(a.global)&&("Bridge"===e.type&&(e.type=""),e=F(e),Y.push(angular.copy(e))))}}});var ee=(Y=Y.filter(function(e){return-1===Z.indexOf(e.id)}).map(function(n){if(!x(n)||function(e){return o.sysmode===u.SYSMODE.ROUTER&&e.rename===o.LAN}(n))return n;if(n.pppType&&!p.hasRole(n,u.INTERFACE_ROLE.INET)){var i=s.getInterfaceStatus(d[n.id]||r.find(d,{id:n.id}));return n.type=n.ipsec?A.IPSEC_VPN:A.VPN,n.state=i,n.detailedState=i,n.detailedStateL10nId="ppp-interface-state."+i.name,n}var a=n.viaId||n.id,m=c[a]||r.find(c,{rename:a})||{},f=m.ipoe||{},g=n.type===A.DSL?r.get(n,"dslInfo.id",!1):r.get(f,"inet-port",!1);"0"!==g&&g!==n.parentDslIfaceId||n.mac||(n.mac=e.$parent.Dashboard.deviceWanMac);var v,h,b=d[a]||r.find(d,{id:a})||{},_=m.schedule||!1,y={},S={main:b},w={main:m};if(n.via){var C=c[n.id];_=C.schedule||_,S.ppp=r.find(d,{id:n.id})||{},w.ppp=C}if(g&&(S.phy=r.find(d,function(e,t){return[t,e.id,e["interface-name"]].includes(g)})||{},w.phy=r.find(c,function(e,t){return[t,e.id,e.rename].includes(g)})||{}),_&&(y=r.get(t,["schedule",_,"action"],[])),z){v=r.get(n.via?w.ppp:w.main,"ping-check.profile",!1);var E=z.filter(function(e){return e.profile===v});0===E.length?h=!1:(h=r.get(E,"0.interface"),h=n.via?h[n.id]:h[a]||h[m.rename])}h&&!r.isEmpty(h)||(h=!1,v=!1);var I=p.determineIspConnectionState({main:a,ppp:n.via?n.id:null,phy:g,schedule:_,pingcheck:v},{show:S,config:w,schedule:y||[],pingcheck:h||{},internetStatus:l});return n.state=I.connection,n.internetIsOk=I.internetIsOk,n.detailedState=n.viaId?I.ppp:I.main,n.detailedStateL10nId=n.via?"ppp-interface-state."+I.ppp.name:"interface-state."+I.main.name,n})).map(function(e){return e.id});K.stop();var te=!1;return S.getInterfaceStatistics(ee).spread(function(i,a){i=i||[],a=r.get(a,"show.interface.stat",[]);var c="";if(i.forEach(function(e,n){var i=r.find(Y,{id:ee[n]});if(i){var u=e["interface-name"],g=a[n];i.bw=E.formatBandwidth(e.bw,w.l10n),i.rate=E.formatRate(e.rate,w.l10n),g.txbytes=s.format.size(Number(g.txbytes)),g.rxbytes=s.format.size(Number(g.rxbytes)),g.rxspeed=Number(g.rxspeed),g.txspeed=Number(g.txspeed),i.stat=angular.extend(i.stat||{},g);var v,_=x(i),C=r.get(t,["schedule",i.schedule],{}),I=(v=M&&_?i.state:e.type===m.INTERFACE_TYPE?m.getConnectionState(e,C,l):R(e)?h.getConnectionStateObject(e,C,l):p.determineInterfaceState(e,C,l)).name===p.constants.INTERFACE_STATE.CONNECTED||R(e)&&v.name===b.NDM_CONNECTION_STATE.CONNECTED;if(angular.extend(i,{uptimeText:I&&e.uptime?s.getSplittedTime(e.uptime):"",state:v,stateTextL10nPrefix:_?"connection-status":"interface-state",status:_?i.detailedState:v}),i.accordionProps=w.getIfaceProps(i),M||i.accordionProps.forEach(function(e){-1!==["keendns","ddns-name","ddns-state"].indexOf(e.name)&&(i[e.name]=e.val)}),!M&&I){var k=l.internet&&l.reliable,P=r.includes(L,o.sysmode);if(o.DEVICE_IS_MWS_MEMBER){var A=r.get(t,"mws.controller",{});P=r.get(A,"backhaul.uplink","").startsWith(f.MASTER_IFACE_PREFIX)}if(i.internetStatus=T("special-modes.internet-access-".concat(k?"ok":"fail")),P&&(i.primaryProps=[].concat(_toConsumableArray(o.DEVICE_IS_MWS_MEMBER?[]:["ssid"]),["rssi","channelRate","mode","channelWidth"]),i.additionalProps=["bssid","channel"],"client"===o.sysmode&&(i.additionalProps=i.additionalProps.filter(function(e){return"channel"!==e})),q.forEach(function(e,t){var n=d[e.station]||{};if("yes"===n.connected&&(!i.isConnectedToAp||i.connectedStaId===e.station)){i.isConnectedToAp=!0,i.connectedStaId=e.station;var a=d[e.master]||{};i.connectedStaId===e.station&&(i=angular.extend(i,{range:0===t?"2":"5",state:s.getInterfaceStatus(n),bssid:n.ap,mac:n.mac,ssid:n.ssid,channel:a.channel,rssi:s.generateIconHtml("indicator-wifi_pwr-".concat(s.rssiToLevel(Number(n.rssi)))),channelWidth:E.formatBandwidth(n.bw,w.l10n),channelRate:E.formatRate(n.rate,w.l10n),mode:n.mode}))}})),o.DEVICE_IS_MWS_MEMBER&&!P){var D=r.get(t,"mws.controller.backhaul.speed");i.speed=E.formatRate(D,w.l10n)}}return i.isDefaultGw?(c=i.id,te=!0,S.getInterfaceRrd(u).then(function(e){var t=(e=r.get(e,"show.interface.rrd",[]))[0].data||[],n=e[1].data||[],a=function(e,t){return e.t-t.t};t.sort(a),n.sort(a);var o=function(e){for(var t=[],n=Math.max(0,60-e.length),i=0;i<n;i++)t.push({x:i,y:0});return e.forEach(function(e,i){return t.push({x:i+n,y:e.v})}),t},l=o(t),c=o(n),d=Math.max(r.maxBy(l,"y").y,r.maxBy(c,"y").y),p=y.roundMaxVelocity(d);i.chart={rx:{color:"blue",data:l},tx:{color:"pink",data:c},label:s.format.speed(Number(p),0),maxY:p},K.start()})):void 0}}),c){var u=r.find(w.ifaces,{id:c});if(u){var g=r.findIndex(Y,{id:c});-1!==g&&(Y[g].chart=angular.copy(u.chart))}}w.ifaces=Y,w.activeIface=r.maxBy(w.ifaces,function(e){return e.sortOrder?Number(e.sortOrder):-1});var v=y.getTimes();w.chart.anchorRight=E.formatTime(v.current),w.chart.anchorLeft=E.formatTime(v.deltaAgo),j&&(e.$parent.Dashboard.cardLoaded("internet"),w.showCardContent=!0,n(function(){w.showDNSContent=!0}),j=!1)}).then(function(){te||K.start()})})}e.$inject=["$scope","$state","$timeout","$parse","$rootScope","NDM","utils","_","router","modal","components","interfaces","CONSTANT","wireguard","wifiOptions","netFilter","dslService","usbQmi","usbQmiConstants","pppConnectionsService","cardInternetService","dashboardDataService"],angular.module("keenetic").controller("DashboardCardInternetController",e)}(),function(){function e(e,t,n,i,a,o,s,r,l,c){var d=this,p=s.APPS,u=["directory","link","error"];d.apps=s.getApps(),d.appsOrder=s.appsOrder,d.appsExists=!a.isEmpty(d.apps);var m={"private-cloud":"dashboard.card_apps.private-cloud",dlna:"dashboard.card_apps.dlna","vpn-server":"dashboard.card_apps.vpn-pptp","vpn-l2tp":"dashboard.card_apps.vpn-l2tp","vpn-sstp":"dashboard.card_apps.vpn-sstp","vpn-ikev2":"dashboard.card_apps.vpn-ikev2",virtualIP:"dashboard.card_apps.vpn-ipsec",torrent:"dashboard.card_apps.transmission",cifs:"dashboard.card_apps.cifs",afp:"dashboard.card_apps.afp",udpxy:"dashboard.card_apps.udpxy",kabinet:"dashboard.card_apps.kabinet"},f=a.mapValues(m,function(e,t){return t===p.PRIVATE_CLOUD?c.getPrivateCloudDescription(d.apps[p.PRIVATE_CLOUD].toggles,"dashboard.card_apps"):"".concat(e,"-description")}),g=angular.copy(d.apps);d.noAppsInSysmode=!a.isEmpty(g)&&a.isEmpty(a.filter(g,"component")),d.apps=a.mapValues(d.apps,function(e,t){return Object.assign({},e,{title:m[t],description:f[t]})});var v=!0,h=0,b=function(){v&&(d.showCardContent=1,e.$parent.Dashboard.cardLoaded("apps"),v=!1)},_=function(e,t,n){if(n.enable&&([p.DLNA,p.TORRENT].includes(e)?t.state=n.dirNotExists?{text:"apps.dlna.dir-not-exists",color:"red"}:"dashboard.card_apps.working":t.state="dashboard.card_apps.working"),!1!==n.users||n.anonAccess||(t.state="dashboard.card_apps.no-access"),n.noStorage&&(t.state={text:"dashboard.card_apps.no-disk",color:"red"}),n.enable||(t.state="dashboard.card_apps.disabled"),e===p.VPN_SSTP||e===p.VPN_IKEV2){var i=n.error||n.actionRequired,o=function(e){var t=e.requirements||{},n=a.chain(t).keys().filter(function(e){return!t[e].fullfilled}).value();if(e.error)return e.error;if(!e.actionRequired)return e.enable?!1===e.users?"dashboard.card_apps.no-access":"dashboard.card_apps.working":"dashboard.card_apps.disabled";if(1===n.length){if("keendns-direct-mode"===n[0])return"dashboard.card_apps.keendns-direct";if("keendns-name"===n[0])return"dashboard.card_apps.keendns-required"}return"dashboard.card_apps.not-configured"}(n);t.disabled=i,t.state={text:o,color:i&&t.enabled?"red":""}}return n.notConfigured&&(t.notConfigured=!0,t.state="dashboard.card_apps.not-configured"),t};d.noAppsInSysmode?b():l.registerCallback(["show","whoami","ip"],function(e,t,n){if(h)h--;else{var i=a.get(n,"http.ssl.acme.list.certificate",[]),s=o.getAppsStates(e,t,i);d.apps=a.mapValues(d.apps,function(e,t){var n=s[t];if(!e)return e;var i=Object.assign({enabled:n.enable},e,{},a.pick(n,u));return t!==p.PRIVATE_CLOUD?_(t,i,n):function(e,t){return e.toggles=a.map(e.toggles,function(e,n){var i=a.get(t,["toggles",n],{}),s=Object.assign({enabled:i.enable},e,{},a.pick(i,u),{onToggle:function(t){return h=2,o.toggleService(e.name,t).then(function(){s.state=t?"...":"dashboard.card_apps.disabled"})}});return _(e.name,s,i)}),e}(i,n)}),b()}}),d.openAppsPageWithPopup=function(e,n){var i=e.target;if(!0===e||!a.includes(["LABEL","INPUT"],i.tagName)){for(;i&&("DIV"!==i.tagName||!i.classList.contains("apps-list__row"));)i=i.parentNode;i&&"DIV"===i.tagName&&t.go("controlPanel.apps."+n,{})}},d.toggleApp=function(e,t){var n=t.replace("apps_",""),i=d.apps[n];return h=3,o.toggleApp(n,i,e)}}e.$inject=["$scope","$state","$timeout","$rootScope","_","appsService","appsPresets","dlnaService","dashboardDataService","privateCloudService"],angular.module("keenetic").controller("DashboardCardAppsController",e)}(),function(){function e(e,t){this.deviceModel=t.model.replace(/^Keenetic\s*/,""),e.bodyPageClass="cp-body",e.uiViewClass=""}e.$inject=["$rootScope","NDM"],angular.module("keenetic").controller("ControlPanelController",e)}(),function(){function e(e,t,n,i){var a={},o=function(i,o){var s=function(e,t){return"".concat(e,"|").concat(t)}(i,o);if(a[s]){var r=e.defer();return a[s].push(r),r.promise}return a[s]=[],n.post({url:"webhelp/release-notes",noRetry:!0,data:{version:i,locale:o}}).then(function(e){var n=t.get(e,"webhelp.".concat(o,".0"),{});return a[s].forEach(function(e){e.resolve(n)}),delete a[s],n})};return{getReleaseNotes:o,getNotesLink:function(e){var t=i.getRealLanguage();return o(e,t).then(function(e){return e.href||!1})}}}e.$inject=["$q","_","router","language"],angular.module("keenetic").factory("webHelpReleaseNotesService",e)}(),function(){function e(e,t,n,i,a){var o,s=this;s.loading=!1;var r=function(){s.loading=!0,a.getNotesLink(o).then(function(e){s.link=e||!1,s.loading=!1}).catch(function(){s.link=!1,s.loading=!1})};t.$watch("vm.ndmVersion",function(e){e&&(o=e.split("-").slice(0,2).join("-"),r())});var l=i.$on("$translateChangeSuccess",function(){return n(r)});s.$onDestroy=function(){l()}}e.$inject=["_","$scope","$timeout","$rootScope","webHelpReleaseNotesService"],angular.module("keenetic").component("ndmWebhelpReleaseNotes",{templateUrl:"app/components/ndm-webhelp-release-notes/ndm-webhelp-release-notes.html",restrict:"E",replace:!0,transclude:!1,bindings:{ndmVersion:"<",wrapInBrackets:"<"},controller:e,controllerAs:"vm"})}(),function(){function e(e,t,n,i){var a=this;a.user="",a.pass="",a.formIsVisible=!1,a.users||e.getAllUsers().then(function(e){a.users=e}),a.translates={login:n.getTranslation("login-placeholder"),password:n.getTranslation("password")},a.onKeydown=function(e,t){if("Space"!==e.code)return!0;e.preventDefault(),t()},a.actions={passwordInvalid:function(){if(a.pass&&t.validators.password(a.pass))return!0},userInvalid:function(){if(!a.user)return"errors.required-field";var e=t.validators.username(a.user);return e?e.message:!!a.users[a.user]&&"errors.name-exists"},addUser:function(){a.actions.passwordInvalid()||a.actions.userInvalid()||e.saveUser(a.user,a.pass).then(function(){a.formIsVisible=!1,i.invoke(a,"saveCallback",{name:a.user,password:a.pass}),a.user="",a.pass=""})},resetState:function(){a.user="",a.pass="",a.formIsVisible=!1},showForm:function(){a.actions.resetState(),a.formIsVisible=!0},closeForm:function(){a.actions.resetState()}}}e.$inject=["usersService","ValidatorManager","utils","_"],angular.module("keenetic").component("ndmUserAddTable",{templateUrl:"app/components/ndm-user-add-table/ndm-user-add-table.html",bindings:{users:"=",saveCallback:"&"},controller:e})}(),function(){function e(e,t,n,i){var a=i.UNIT_SCALE,o={no:!0},s={hasSchedule:!0,checkIsEnabled:!0},r=function(e){if(!e)return{limit:"",scale:a.KILO};var n=e%t.format.MULTIPLIER_SPEED==0;return{limit:n?String(e/t.format.MULTIPLIER_SPEED):String(e),scale:n?a.MEGA:a.KILO}},l=function(e){var n=e.limit,i=e.scale===a.MEGA?t.format.MULTIPLIER_SPEED:1;return n?n*i:o},c=function(e){var n=e.limit,i=e.scale;if(!n)return 0;var o=i===a.MEGA?t.format.MULTIPLIER_SPEED:1,s=Number(n)*o*t.format.MULTIPLIER_SPEED;return t.format.speed(s)};return{DEFAULT_MODEL_TO_RCI_FLAGS:s,getDefaultModel:function(){return{isEnabled:!1,isAsymmetric:!1,download:{limit:"",scale:a.KILO},upload:{limit:"",scale:a.KILO},schedule:""}},getModelFromRciData:function(t){var n=e.has(t,"rate"),i=e.has(t,"upstream-rate"),a=e.get(t,"rate",0),o=e.get(t,"upstream-rate",0);return{isEnabled:n,isAsymmetric:i,download:r(a),upload:r(o),schedule:e.get(t,"schedule","")}},getUnitOptions:function(){return[a.KILO,a.MEGA].map(function(e){return{id:e,label:t.format.getSpeedUnit(e)}})},getRciQueryObjectFromModel:function(e,t){var n=Object.assign({},s,{},t),i=n.hasSchedule,a=n.checkIsEnabled;if(!e||!e.download.limit||a&&!e.isEnabled)return o;var r=l(e.download),c=l(e.upload),d=_defineProperty({},"rate",r);return e.isAsymmetric&&e.upload.limit&&r!==c&&(d["upstream-rate"]=c),i&&e.schedule&&(d.schedule=e.schedule),d},getModelViewValue:function(e){if(!e.isEnabled)return"-";var t=c(e.download),n=c(e.upload);return e.isAsymmetric?"<div>".concat(t," ").concat('<i class="icon icon--rxbytes-arrow"></i>'," /</div><div>").concat(n," ").concat('<i class="icon icon--txbytes-arrow"></i>',"</div>"):t}}}e.$inject=["_","utils","router","CONSTANT"],angular.module("keenetic").factory("trafficShaperModel",e)}(),function(){function e(e,t,n,i,a,o,s,r){var l=this,c=function(){l.unitOptions=o.getUnitOptions()};c();var d=n.$on("$translateChangeSuccess",function(){return i(c)});l.l10nPrefix="";var p=[8].concat(_toConsumableArray(e.range(37,41)),[46],_toConsumableArray(e.range(48,58)),_toConsumableArray(e.range(96,106)),[9]);l.inputFilter=function(e){var t=Number(e.which||e.keyCode);return p.includes(t)||e.ctrlKey||e.metaKey},l.limitValidation=function(e,t){if(""===e||angular.isUndefined(e))return"";var n=Number(e);return isNaN(n)?"errors.numeric":t===r.UNIT_SCALE.KILO?s.isValueInRange(n,64,1e6)?"":"errors.ports.notInKbRange":s.isValueInRange(n,1,1e3)?"":"errors.ports.notInMbRange"},l.$postLink=function(){l.namePrefix=l.namePrefix||"ndmTrafficShaper"},l.$onChanges=function(t){e.has(t,"showIsEnabledCheckbox")&&(l.l10nPrefix=e.get(t,"showIsEnabledCheckbox.currentValue")?"ndm-traffic-shaper.":"ndm-traffic-shaper.always-enabled-mode.")},l.onIsEnabledChanged=function(t){t&&i(function(){var t=a[0].querySelector('input[type="text"]');e.invoke(t,"focus")})},l.$onDestroy=function(){d()}}e.$inject=["_","$scope","$rootScope","$timeout","$element","trafficShaperModel","ValidatorManager","CONSTANT"],angular.module("keenetic").component("ndmTrafficShaper",{templateUrl:"app/components/ndm-traffic-shaper/ndm-traffic-shaper.html",transclude:!0,bindings:{model:"<",hasSchedule:"<",namePrefix:"@",showIsEnabledCheckbox:"<",isDisabled:"<"},controller:e,controllerAs:"vm"})}(),function(){function e(e,t,n,i,a,o,s,r,l){var c=this,d=s.SIDES,p=s.DEFAULT_DIRECTION,u=function(e){if(!e)return p;var t=s.getWindowSize(),n=e.getBoundingClientRect(),i=s.getDistances(n,t),a=l.min(l.values(i));return a>100?{direction:p,proximity:!1}:{direction:function(e){switch(e){case d.ABOVE:return d.BELOW;case d.BELOW:return d.ABOVE;case d.LEFT:return d.RIGHT;case d.RIGHT:return d.LEFT;default:return p}}(l.findKey(i,function(e){return e===a})),proximity:!0}},m=function(){var e=u(c.element),n=e.direction,i=e.proximity;(c.direction!==p||i)&&(c.floatDirection=n),t(function(){c.element.style.opacity=1})},f=r(m,200);c.floatDirection=p,c.isReady=!1,c.$postLink=function(){t(function(){c.element=n[0].querySelector(".ndm-tooltip-old__content"),m(),c.isReady=!0})},a(m,e),e.$watch(function(){return i.scrollTop},function(e,t){e!==t&&f()})}e.$inject=["$scope","$timeout","$element","$window","windowResizeWatcher","browserCheck","ndmTooltipService","debounce","_"],angular.module("keenetic").component("ndmTooltipOld",{templateUrl:"app/components/ndm-tooltip-old/ndm-tooltip-old.html",transclude:!0,bindings:{preferredSide:"<"},controller:e})}(),function(){function e(e,t,n,i,a,o,s,r,l){var c=this,d=r.SIDES,p=r.PREFERRED_SIDES_ORDER,u=function(){var e=t[0].getBoundingClientRect(),n=r.getWindowSize(),a=r.getDistances(e,n);i(function(){var o,s=t[0].querySelector(".ndm-tooltip__content").getBoundingClientRect(),r=(_defineProperty(o={},d.BELOW,Math.max(0,s.height+15-a.below)),_defineProperty(o,d.ABOVE,Math.max(0,s.height+15-a.above)),_defineProperty(o,d.LEFT,Math.max(0,s.width+15-a.left)),_defineProperty(o,d.RIGHT,Math.max(0,s.width+15-a.right)),o),u={x:0,y:0},m=l.find(p,function(e){return 0===r[e]})||l(r).map(function(e,t){return{v:e,k:t}}).sortBy("v").get("0.k");switch(m){case d.BELOW:u.top=e.top+15,u.left=e.left-s.width/2;break;case d.ABOVE:u.top=e.top-15-s.height,u.left=e.left-s.width/2;break;case d.LEFT:u.top=e.top-s.height/2,u.left=e.left-s.width-15;break;default:case d.RIGHT:u.top=e.top-s.height/2,u.left=e.left+15}m!==d.ABOVE&&m!==d.BELOW||(s.width>n.width?u.left=(s.width-n.width)/2:u.left<0?u.left=0:u.left+s.width>n.width&&(u.left=n.width-s.width)),m!==d.LEFT&&m!==d.RIGHT||(s.height>n.height?u.top=(s.height-n.height)/2:u.top<0?u.top=0:u.top+s.height>n.height&&(u.top=n.height-s.height)),c.element.style.top=u.top+"px",c.element.style.left=u.left+"px",i(function(){c.element.style.opacity=1})},100)},m=a(u,200);c.isReady=!1,c.$postLink=function(){i(function(){c.element=t[0].querySelector(".ndm-tooltip__content"),u(),c.isReady=!0})},o(u,e),e.$watch(function(){return n.scrollTop},function(e,t){e!==t&&m()})}e.$inject=["$scope","$element","$window","$timeout","debounce","windowResizeWatcher","browserCheck","ndmTooltipService","_"],angular.module("keenetic").component("ndmTooltip",{templateUrl:"app/components/ndm-tooltip/ndm-tooltip.html",transclude:!0,controller:e})}(),function(){function e(e,t,n,i,a){return{templateUrl:"app/components/ndm-toggle/ndm-toggle.html",replace:!0,scope:{model:"=",name:"@",label:"@",labelOn:"@",labelOff:"@",onChange:"&",disabled:"<",callOnChange:"<",description:"<"},link:function(o){o.labelOn=o.labelOn||"point.on",o.labelOff=o.labelOff||"point.off",o.locked=!1,o.lastUnlockedState=o.model,o.$on("$destroy",e.$on(a.events.DEVICE_IS_OFFLINE,function(){o.deviceIsOffline=!0})),o.$on("$destroy",e.$on(a.events.DEVICE_IS_ONLINE,function(){o.deviceIsOffline=!1})),o._onKeydown=function(e){if(!i.isSpace(e))return!0;e.preventDefault(),o._click(e)},o._click=function(e){var i;(e.stopPropagation(),o.locked||o.disabled||o.deviceIsOffline)||(o.locked=!0,o.model=!o.model,o.lastUnlockedState=o.model,t.all([!angular.isFunction(o.callOnChange)||o.callOnChange(o.model,o.name),o.onChange(),(i=t.defer(),n(i.resolve,400),i.promise)]).catch(function(){o.model=!o.model}).finally(function(){n(function(){o.locked=!1,o.lastUnlockedState=o.model},100)}))}}}}e.$inject=["$rootScope","$q","$timeout","keyboard","router"],angular.module("keenetic").directive("ndmToggle",e)}(),function(){function e(e,t,n){var i=this,a={cols:50,rows:10},o=function(e){return!isNaN(e)&&e>0};i.errorIsVisible=!1,i.errorText="";var s=function(t){var a=t.keyCode;if(33===a||34===a){var o=33===a,s=n.find("textarea").val(),r=i.textareaEl.selectionStart,l=i.textareaEl.selectionEnd,c=function(t,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(arguments.length>4&&void 0!==arguments[4]&&arguments[4]?e.findLastIndex:e.findIndex)(t,function(e){return e===n&&0==--i},a)}(s,"\n",i.rows,r,o);-1===c&&(c=o?0:s.length),t.preventDefault(),t.target.setCaretPosition(c),t.target.setSelectionRange(c,t.shiftKey?l:c),i.textareaEl.blur(),i.textareaEl.focus()}};i.$onInit=function(){["cols","rows"].forEach(function(e){i[e]=o(i[e])?i[e]:a[e]}),i.minLength&&!o(i.minLength)&&(i.minLength=void 0),i.maxLength&&!o(i.maxLength)&&(i.maxLength=void 0),i.onChange=angular.isFunction(i.onChange)?i.onChange:angular.noop},i.$postLink=function(){i.textareaEl=n[0].querySelector("textarea"),i.ngModel=angular.element(i.textareaEl).controller("ngModel"),(t.isChrome||t.isOpera)&&n.on("keydown",s),angular.isFunction(i.onCreate)&&i.onCreate(i,n)},i.$onDestroy=function(){angular.isFunction(i.onDestroy)&&i.onDestroy(i,n),(t.isChrome||t.isOpera)&&n.off("keydown",s)}}e.$inject=["_","browserCheck","$element"],angular.module("keenetic").component("ndmTextarea",{templateUrl:"app/components/ndm-textarea/ndm-textarea.html",bindings:{model:"=",title:"@label",hint:"@",rows:"@",cols:"@",onChange:"<",onCreate:"<",onDestroy:"<",isDisabled:"<",isRequired:"<",minLength:"<",maxLength:"<"},controller:e})}(),function(){angular.module("keenetic").directive("ndmText",function(){return{templateUrl:"app/components/ndm-text/ndm-text.html",replace:!0,transclude:!0,scope:{text:"@"}}})}(),angular.module("keenetic").component("ndmTabs",{restrict:"E",templateUrl:"app/components/ndm-tabs/ndm-tabs.html",transclude:!0,controllerAs:"vm",bindings:{isDisabled:"<",labelProp:"@",tabs:"<",activeTab:"=?",canSelectTab:"<?",onTabChangedFn:"<",addTabBtnLabel:"@",addTabBtnIsDisabled:"<",onAddTabClick:"<",onTabRemoveFn:"<",newTabConstructorFn:"<",compareProp:"@",updateStateOnTabChange:"<",stateParam:"@"},controller:["_","$state","$q","$document","$scope","$window","$element","$transitions","$rootScope","$timeout","keyboard","CONSTANT","browserCheck","windowResizeWatcher",function(e,t,n,i,a,o,s,r,l,c,d,p,u,m){var f=this,g=t.current.name,v={TAB_CHANGE_STARTED:p.events.TAB_CHANGE_STARTED,TAB_CHANGED:p.events.TABS_TAB_CHANGED,SELECT_TAB:p.events.TABS_SELECT_TAB},h=!1,b=!1,_=[],y=function(){return u.getBrowserWidth(1024)<768?1:4},S=r.onStart({to:g,from:g},function(t){var n=t.options(),i=t.params();if(e.includes(["sref","url","unknown"],n.source)){var a=-1,o=null;(f.tabs||[]).forEach(function(e,t){e[f.labelProp]===i.tab&&(a=t,o=e)}),-1!==a&&f.onTabClick(a,o,!1)}});a.$on("$destroy",S);var w=function(){return n.when(!0)},C=angular.noop;f.viewStartIdx=0,f.activeTabIdx=0,f.tabsCount=0,f.showHiddenTabs=!1,f.toggleLinkEl=null,f.containerEl=null,f.rightBorderIsTooClose=!1;var E=function(t,n){var i=t.slice();f.tabsToShow=y(),e.find(f.visibleTabs,{index:n})||(f.viewStartIdx=Math.max(n-y()+1,0)),f.hiddenTabs=i.map(function(e,t){return e.index=t,e.isActive=t===n,e}),f.visibleTabs=f.hiddenTabs.splice(f.viewStartIdx,y())},I=function(){if(f.toggleLinkEl||(f.toggleLinkEl=i[0].querySelector(".tabs-list__dropdown-tab__toggle-link"),f.containerEl=s[0].closest(".ss-content")),f.toggleLinkEl){var e;if(f.containerEl){var t=o.getComputedStyle(f.containerEl),n=parseInt(t.paddingRight.replace("px",""),10);e=f.containerEl.getBoundingClientRect().right-(isNaN(n)?0:n)}else e=o.innerWidth;f.rightBorderIsTooClose=e-f.toggleLinkEl.getBoundingClientRect().right<200}else f.rightBorderIsTooClose=!1};m(function(){I(),E(f.tabs,f.activeTabIdx)},a);var T=function(e){for(var t,n=-1,i=0,a=f.tabs.length;i<a;++i)if((t=f.tabs[i])[f.labelProp]===e.tabName){n=i;break}-1!==n&&f.onTabClick(n,t,e.forceSelectTab)},k=function(){var e=_.length;if(0!==e)for(;e>0;){var t=_.pop();switch(t.event){case v.SELECT_TAB:T(t)}e=_.length}},P=function(){!function(t){var n=e.cloneDeep(f.activeTab),i=f.activeTabIdx;f.activeTab=f.tabs[f.activeTabIdx];var a=e.cloneDeep(f.activeTab),o=f.activeTabIdx;l.$broadcast(v.TAB_CHANGED,{currentActiveTab:a,currentActiveTabIndex:o,previousActiveTab:n,previousActiveTabIndex:i}),t||c(C),E(f.tabs,f.activeTabIdx),h=!1,b=!1,k()}(!1)};f.$onInit=function(){f.stateParamName=angular.isString(f.stateParam)?f.stateParam:"tab",f.labelProp=angular.isString(f.labelProp)?f.labelProp:"name";var i,a=t.params[f.stateParamName]||f.activeTab;if(a)if(isNaN(Number(a))){for(var o=f.tabs.slice(),s=angular.isObject(f.activeTab)?angular.equals:function(e,t){return e[f.labelProp]===t},r=0,l=o.length;r<l;++r)if(s(o[r],a)){i=r;break}}else i=Number(a)>0&&Number(a)<f.tabs.length?Number(a):0;angular.isUndefined(i)?t.go(g,_defineProperty({},"tab",null)):f.activeTabIdx=i,f.canSelectTab?angular.isFunction(f.canSelectTab)?f._canSelectTab=f.canSelectTab:angular.isDefined(f.canSelectTab)&&(f._canSelectTab=function(){return f.canSelectTab}):f._canSelectTab=w,f.onTabChangedFn=angular.isFunction(f.onTabChangedFn)?f.onTabChangedFn:angular.noop,f.removeTab=angular.noop,angular.isFunction(f.onTabRemoveFn)&&(f.removeTab=function(e){f.onTabRemoveFn(e),f.activeTabIdx>e?f.activeTabIdx-=1:f.activeTabIdx===e&&(f.activeTabIdx=Math.min(e,f.tabs.length-1))}),f.updateStateOnTabChange&&(C=function(){var n={};return n[f.stateParamName]=e.get(f.activeTab,f.labelProp,null),t.go(t.current.name,n,{notify:!1,reload:!1})}),angular.isFunction(f.onAddTabClick)?f.addTabBtnClick=f.onAddTabClick:angular.isFunction(f.newTabConstructorFn)?f.addTabBtnClick=function(){var e;return h=!0,b=!0,n.when(f.newTabConstructorFn(f.activeTabIdx,f.activeTab,f.tabs)).then(function(t){return(e=t).isNew=!0,n.when(f._canSelectTab(f.tabs.length,t,f.activeTabIdx,f.activeTab))}).then(function(t){if(!t)return n.when(C()).then(function(){h=!1});f.tabs.push(e);var i=f.activeTabIdx,a=f.activeTab;f.activeTabIdx=f.tabs.length-1,f.tabsCount=f.activeTabIdx+1,n.when(f.onTabChangedFn(f.activeTabIdx,e,i,a)).finally(P)})}:f.noAddTabBtn=!0;var c=f.tabs.length;f.visibleTabs=[],f.hiddenTabs=[],f.tabsCount=c,c>0?n.when(f.onTabChangedFn(f.activeTabIdx,f.tabs[f.activeTabIdx],-1,null)).finally(P):f.tabsToShow=y()},f.$onChanges=function(t){if(!h)if(b=!0,t.tabs&&!t.tabs.isFirstChange()){var i=t.tabs.currentValue,a=i.length,o=t.tabs.previousValue,s=o.length,r=!1;if(a>s){for(var l=0;l<a;++l)if(-1===o.indexOf(i[l])){f.activeTabIdx=l;break}}else if(i[f.activeTabIdx]!==o[f.activeTabIdx]||a<s){var c=f.compareProp||f.labelProp,d=e.findIndex(i,function(e){return e[c]===f.activeTab[c]});r=-1!==d,f.activeTabIdx=r?d:0}else f.tabs[f.activeTabIdx]||(0===a?(f.visibleTabs=[],f.hiddenTabs=[],f.tabsCount=0):f.activeTabIdx=0);f.tabsCount=a,angular.equals(i[f.activeTabIdx],f.activeTab)?(C(),E(f.tabs,f.activeTabIdx),b=!1,k()):n.when(f.onTabChangedFn(f.activeTabIdx,f.tabs[f.activeTabIdx],r?f.activeTabIdx:-1,r?f.activeTab:null)).finally(function(){P(),k()})}else b=!1,k()},f.onTabClick=function(e,t,i){if(e===f.activeTabIdx)return n.when(!0);var a=f.activeTabIdx,o=f.visibleTabs[a-f.viewStartIdx];return h=!0,b=!0,(i?n.when(!0):n.when(f._canSelectTab(e,t,a,o))).then(function(i){return i?(l.$broadcast(v.TAB_CHANGE_STARTED),f.activeTabIdx=e,f.showHiddenTabs=!1,n.when(f.onTabChangedFn(e,t,a,o)).finally(P)):n.when(C()).then(function(){h=!1})})},f.handleKeydown=function(e,t){if(!f.isDisabled&&d.isSpace(e)){e.preventDefault(),e.stopPropagation();for(var n=arguments.length,i=new Array(n>2?n-2:0),a=2;a<n;a++)i[a-2]=arguments[a];return t.apply(void 0,i),!0}},f.onAddTabKeydown=function(){return f.toggleHiddenTabsDropdown()||f.addTabBtnClick()},f.onHiddenTabClick=function(e){var t=f.getHiddenTabIndex(e),n=f.tabs[t];return f.onTabClick(t,n,!1)},f.toggleHiddenTabsDropdown=function(){(f.hiddenTabs.length>0||!f.noAddTabBtn)&&(I(),f.showHiddenTabs=!f.showHiddenTabs)},f.getHiddenTabIndex=function(e){return e<f.viewStartIdx?e:e+y()},a.$on(v.SELECT_TAB,function(e,t,n){var i={event:v.SELECT_TAB,tabName:t,forceSelectTab:n};b?_.push(i):T(i)})}]}),function(){function e(e,t){return{require:"^ngController",templateUrl:"app/components/ndm-table-deviceslist/ndm-table-deviceslist.html",replace:!0,link:function(n,i,a,o){n.clickOnRowFunc=function(){o[n.rowOnClick].apply(null,arguments)},n.rowOnClickParams=n.rowOnClickParams||"";var s=function(e,t){return e[t]||!1};n._sortFn=function(e,i){var a=n.sortObj||{},o=Boolean(a.isReverse),r=a.alwaysSortBy?a.alwaysSortBy.slice():[],l=r.slice();["firstSort","secondSort"].forEach(function(e){a[e]&&l.push(a[e])});for(var c,d,p,u=0,m=0,f=l.length;m<f;++m){var g=l[m],v=a.getter&&a.getter[l[m]]?a.getter[l[m]]:s;if(d=v(e.value,g),p=v(i.value,g),c=t.includes(r,g)?1:o?-1:1,!d&&p){u=1;break}if(!p&&d){u=-1;break}if(d!==p){angular.isString(d)&&(d=d.toLowerCase()),angular.isString(p)&&(p=p.toLowerCase()),u=(d>p?1:-1)*c;break}}return u},n.sortFunction&&(n.infoObj.sortFunction=n.sortFunction,n.sort=function(e){n.infoObj.sortFunction.apply(null,e)});n.infoObj&&n.infoObj.defaultSort&&n.infoObj.header[n.infoObj.defaultSort]&&e(function(){n.sort(n.infoObj.header[n.infoObj.defaultSort].sortArguments)})},scope:{list:"=",tableClasses:"@",noDataMessage:"@",rowOnClick:"@",rowOnClickParams:"@",infoObj:"=",sortObj:"=",sortFunction:"="}}}e.$inject=["$timeout","_"],angular.module("keenetic").directive("ndmTableDeviceslist",e)}(),function(){function e(e,t,n,i,a){var o="app/components/ndm-table",s="ndm-table";return{require:"^ngController",templateUrl:function(e,t){return o+"/"+(t.templateUrl||s)+".html"},replace:!1,transclude:{customRowSlot:"?ndmTr"},link:function(o,s,r){angular.isUndefined(o.sortable)&&(o.sortable=!0);o.trustAsHtml=function(e){return t.trustAsHtml(e)},o.cols=Object.keys(o.columns).length;var l=a.chain(o.columns).pickBy("clickable").keys().value();r.clickOnCell&&0!==l.length?o.clickOnCellHandler=function(e,t,n,i){if(a.includes(l,n))return e.stopImmediatePropagation(),o.clickOnCell()(e,t,n,i),!1}:o.clickOnCellHandler=angular.noop;!o.draggable&&o.sortable&&(r.sortName||(o.sortName=Object.keys(o.columns)[0]),o.sortReverse=o.sortReverse||!1,o.setSortCol=function(e){a.get(o,["columns",e,"unsortable"])||(o.sortName===e?o.sortReverse=!o.sortReverse:o.sortName=e)},o.compareWith&&angular.isFunction(o.compareWith)?(o._sortName=[],o._sortReverse=!1,o.sortName||(o.sortName=r.sortName),o.sort=function(e,t){return o.compareWith(e,t,o.sortName,o.sortReverse)}):(o._sortName=o.sortName,o._sortReverse=o.sortReverse,o.$watch("sortName",function(e){e&&(o._sortName=e)}),o.$watch("sortReverse",function(e){o._sortReverse=e}),o.sort=null));o.dragging=!1,o.$watch("data",function(){!o.dragging&&angular.isArray(o.data)&&(o.items=o.data)});var c=i.isMacOs?"ndm-table__row--opaque-placeholder":"ndm-table__row--placeholder";o.sortableConf={animation:350,disabled:!o.draggable,forceFallback:!i.isSafari,dragClass:"ndm-table__row--dragged",ghostClass:c,handle:".".concat("ndm-table--draggable-handle-cell"),onInit:function(e){o.sortable=e,o.sortable&&o.$watch("dragDisabled",function(e){o.sortable.option("disabled",Boolean(e))})},onStart:function(e){var t=e.oldIndex;o.dragging=!0,o._onDragStart({index:t})},onEnd:function(t){var i=t.newIndex,a=t.oldIndex;if(i!==a){var s=o.data[a];o.data.splice(a,1),o.data.splice(i,0,s),"$apply"!==o.$root.$$phase&&"$digest"!==o.$root.$$phase&&o.$apply()}n.when(o._onDragEnd({source:{index:a},dest:{index:i}})).finally(function(){e(function(){o.dragging=!1})})}},o.draggable?(o._onDragStart=Boolean(r.onDragStart)&&angular.isFunction(o.onDragStart())?o.onDragStart():angular.noop,o._onDragEnd=Boolean(r.onDragEnd)&&angular.isFunction(o.onDragEnd())?o.onDragEnd():angular.noop):o.dragOptions=!1;o.trackByProp?o.trackByFn=function(e,t){return o.trackByProp&&t[o.trackByProp]||e}:o.trackByFn=angular.identity},scope:{data:"=",columns:"=",tableClass:"@",directives:"=",sortName:"=?",sortReverse:"=?",clickOnRow:"=",clickOnCell:"&?",draggable:"=",sortable:"=?",onDragEnd:"&",onDragStart:"&",preloaderText:"@?",limitTo:"<?",trackByProp:"@",compareWith:"<?",dragDisabled:"<"}}}function t(e,t){return{name:"test",compile:function(n,i){var a=e(i.addDirective);return function(e,n,i){n.removeAttr("add-directive"),n.removeAttr("ng-bind-html");var o=a(e);if(o){var s=n,r=o;if(!angular.isString(o)){r=o.name;var l=[];angular.isDefined(o.options)?l=o.options:i.directiveAttrs&&"{"===i.directiveAttrs[0]&&(l=angular.fromJson(i.directiveAttrs),s.removeAttr("x-directive-attrs")),angular.forEach(l,function(e,t){s.attr(t,e)})}s.attr(r,n.text()),t(s)(e)}}}}}function n(e,t,n,i){var a,o,s=t.Sortable,r="Sortable:ng-sortable-js",l=["group","sort","disabled","store","handle","scroll","scrollSensitivity","scrollSpeed","bubbleScroll","draggable","swapThreshold","invertSwap","invertedSwapThreshold","removeCloneOnHide","direction","ghostClass","chosenClass","dragClass","ignore","filter","preventOnFilter","animation","easing","setData","dropBubble","dragoverBubble","dataIdAttr","delay","delayOnTouchOnly","touchStartThreshold","forceFallback","fallbackClass","fallbackOnBody","fallbackTolerance","fallbackOffset","supportPointer","emptyInsertThreshold","onInit","onStart","onEnd","onAdd","onUpdate","onRemove","onSort","onMove","onClone"];function c(e){return e.getAttribute("ng-repeat")||e.getAttribute("data-ng-repeat")||e.getAttribute("x-ng-repeat")}return{restrict:"A",scope:{ngSortable:"=?"},priority:1001,compile:function(t){var n=[].filter.call(t[0].childNodes,function(e){return e.nodeType===Node.ELEMENT_NODE&&c(e)})[0];if(n){var d=c(n).match(/^\s*([\s\S]+?)\s+in\s+([\s\S]+?)(?:\s+as\s+([\s\S]+?))?(?:\s+track\s+by\s+([\s\S]+?))?\s*$/);if(d){var p=d[2];return function(t,n){var c,d,u=e(p),m=function(){return u(t.$parent)||[]},f=n[0],g=angular.extend(t.ngSortable||{},i),v=[];function h(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n="on"+e.type.charAt(0).toUpperCase()+e.type.substr(1),i=m();g[n]&&g[n]({model:t||i[e.newIndex],models:i,oldIndex:e.oldIndex,newIndex:e.newIndex,originalEvent:e})}function b(e){var n=m();if(n){var i=e.oldIndex,l=e.newIndex;if(f===e.from)n.splice(l,0,n.splice(i,1)[0]),o.nodeType===Node.COMMENT_NODE&&e.from.insertBefore(o,e.item.nextSibling);else{var c=e.from[r]();if(a=c[i],s.active&&"clone"===s.active.lastPullMode){var p=s.utils.index(e.clone,d.options.draggable);a=angular.copy(a),c.splice(p,0,c.splice(i,1)[0]),e.from.contains(e.clone)&&e.from.removeChild(e.clone)}else c.splice(i,1);n.splice(l,0,a),e.from.insertBefore(e.item,o)}t.$apply()}}f[r]=m;var _={onStart:function(e){o=e.from===e.item.parentNode?e.item.nextSibling:e.clone.nextSibling,h(e),t.$apply()},onEnd:function(e){h(e,a),t.$apply()},onAdd:function(e){b(e),h(e,a),t.$apply()},onUpdate:function(e){b(e),h(e)},onRemove:function(e){h(e,a)},onSort:function(e){h(e)},getOriginalOptions:function(){return _}},y=Object.keys(g).reduce(function(e,t){return e[t]=e[t]||g[t],e},_);d=s.create(f,y),angular.forEach(l,function(e){v.push(t.$watch("ngSortable."+e,function(t){void 0!==t&&(g[e]=t,/^on[A-Z]/.test(e)||d.option(e,t),"onInit"===e&&t(d,g))}))}),c=t.$on("$destroy",function(){c(),angular.forEach(v,function(e){e()}),d.destroy(),f[r]=null,f=null,v=null,d=null,o=null})}}}}}}n.$inject=["$parse","$window","_","ngSortableConfig"],e.$inject=["$timeout","$sce","$q","browserCheck","_"],t.$inject=["$parse","$compile"],angular.module("keenetic").directive("addDirective",t).directive("ndmTr",function(){return{template:"<tr ng-transclude></tr>",replace:!0,transclude:!0}}).directive("ndmTd",function(){return{template:"<td ng-transclude></td>",replace:!0,transclude:!0}}).directive("ndmTable",e).constant("ngSortableConfig",{}).directive("ngSortable",n)}(),function(){function e(e,t,n,i,a,o,s,r,l,c,d,p,u){var m,f,g,v,h,b,_,y=this,S=c.events,w=S.SELECTBOX_TOGGLE_OPEN,C=S.SELECTBOX_TOGGLE_CLOSE,E=S.MENU_OPEN_TRANSITION_END,I=S.MENU_CLOSE_TRANSITION_END,T=S.SWITCHPORT_CONTAINER_OVERFLOW_STATE,k="right",P="below",A="above",D="left",O=o.requestAnimationFrame||o.setImmediate,N=angular.element(o),L=u.noop,x=u.noop,R=[];y.idProp="id",y.labelProp="label",y.isReady=!1;var M=function(e){if(y.isOpened){var t=e.target,i=y.containerEl&&!p.dom.isAncestor(y.containerEl,t),a=!y.containerEl&&!p.dom.isAncestor(n[0],t);(i||a)&&y.hideOptions()}},$=function(e){var t=u.findIndex(y.options,{id:y.optionInFocus});if(-1!==t){var n=(t+e)%y.options.length;y.optionInFocus=u.get(y.options,[n,"id"])}};y.onDownArrow=function(){y.isOpened&&($(y.options.length-1),p.forceScopeDigest(s))},y.onUpArrow=function(){y.isOpened&&($(1),p.forceScopeDigest(s))};var F=function(){return u.get(g,"clientWidth",0)-u.get(_,"clientWidth",0)},V=function(){return 32*y.options.length},U=function(){var e,t,n,i,a=F(),o=V(),s=(n=l.getWindowRect(),i=_.getBoundingClientRect(),_defineProperty(t={},P,n.bottom-i.bottom),_defineProperty(t,A,i.top-n.top),_defineProperty(t,k,n.right-i.right),_defineProperty(t,D,i.left-n.left),t),r=(_defineProperty(e={},P,s[P]-o),_defineProperty(e,A,s[A]-o),_defineProperty(e,k,s[k]-a),_defineProperty(e,D,s[D]-a),e),c=D;return r[D]>0&&r[k]<150&&(c=k),{horizontal:c,vertical:r[P]<150&&r[A]>150?A:P}},B=function(){var e=U();y.showOptionsAboveElement=e.vertical===A,y.alignOptionsToRightBorder=e.horizontal===k},W=function(){y.containerEl=g||n[0].querySelector(".ndm-switchport-select__options-container"),y.containerEl.style.opacity=.01,t.bind("keydown",y.onContainerKeydown),y.elementIsInsideScrollableParent=!1,y.elementIsInsideMainContainer=!1,b.observe(_),h.observe(_),N.on("ss-scroll",L),N.on("scroll",L),y.scrollableParent.bind("scroll",L),f=i(function(){L()},1e3),B(),a(function(){y.containerEl.style.opacity=1,t.bind("click",M),L()})},H=function(e){if(e){var t=e.style;t.removeProperty("left"),t.removeProperty("right"),t.removeProperty("top"),t.removeProperty("bottom")}},q=function e(){g?t[0].body.appendChild(g):a(e,100)},j=function e(){g&&v?v.appendChild(g):a(e,100)},K=function(e){if(g){if(!e)return a(j),u.invoke(L,"cancel"),L=function(){return B()},void H(y.containerEl);a(q),(L=function(){y.containerEl&&y.isOpened&&y._appendToBody&&O(function(){B();var e=_.getBoundingClientRect(),t=y.containerEl.style;if(l.getBrowserWidth()<400)t.left="16px",t.right="16px";else if(y.alignOptionsToRightBorder){var n=e.left-F()-0;t.left="".concat(n,"px")}else t.left="".concat(e.left+0,"px");if(y.showOptionsAboveElement){var i=e.top-V();t.top="".concat(i,"px")}else t.top="".concat(e.bottom,"px");p.forceScopeDigest(s)})})()}};y.showOptions=function(){y.isOpened||(y.isOpened=!0,y.optionInFocus=y.value,e.$broadcast(w,y.uid,y.name),W())},y.hideOptions=function(){y.isOpened&&(y.isOpened=!1,y.optionInFocus=!1,e.$broadcast(C,y.uid,y.name),t.unbind("click",M),t.unbind("keydown",y.onContainerKeydown),b.unobserve(_),h.unobserve(_),N.off("ss-scroll",L),N.off("scroll",L),y.scrollableParent.unbind("scroll",L),i.cancel(f),a(function(){y.containerEl=null}))},y.onToggleClick=function(){y.isDisabled||(y.isOpened?y.hideOptions():y.showOptions())};var G=function(e){e.preventDefault(),e.stopPropagation()},Y=function(e){var t=y._appendToBody!==Boolean(u.invoke(v,"querySelector",".ndm-switchport-select__options-container"));e===y._appendToBody&&v&&t||(g&&K(e),e||H(g))};y.isClosestToToggleOptionInFocus=function(){var e=y.showOptionsAboveElement?y.options.length-1:0;return y.optionInFocus===u.get(y,["options",e,"id"])},y.onContainerKeydown=function(e){if(!y.isDisabled)if(y.isOpened){if(d.isSpace(e))return G(e),void y.hideOptions();d.isEnter(e)&&y.optionInFocus&&y.onOptionClick(u.find(y.options,{id:y.optionInFocus})),(d.isTab(e)||d.isEscape(e))&&y.hideOptions(),d.isUpArrow(e)&&(G(e),y.onUpArrow()),d.isDownArrow(e)&&(G(e),y.onDownArrow())}else(d.isSpace(e)||d.isDownArrow(e))&&(G(e),y.showOptions())},y.onOptionHover=function(e){y.optionInFocus=e.id},y.onOptionClick=function(e){var t=y.value;y.value=e.id,y.selectedOption=e,y.hideOptions(),y.value!==t&&u.invoke(y,"onChange",y.value,t,y.name)},y.$onInit=function(){R.push(e.$on(w,function(e,t,n,i){y.dropup=i})),y.uid=p.getUniqueId(),y.onChange=y.onChange||u.noop,y.isReady=!0,m=y.value},y.$doCheck=function(){var e;angular.equals(y.value,m)||((e=u.find(y.options,{id:y.value}))?y.onOptionClick(e):y.placeholderText=y.noValueMsg,m=angular.copy(y.value))},y.$postLink=function(){g=n[0].querySelector(".ndm-switchport-select__options-container"),v=n[0].querySelector(".ndm-switchport-select__options-container-wrapper"),y.scrollableParent=angular.element(n[0].closest(y.scrollableParentSelector||".ndm-switchport-container__transclude")),h=new IntersectionObserver(function(){y.elementIsInsideMainContainer=!y.elementIsInsideMainContainer,p.forceScopeDigest(s)},{rootMargin:"-120px 0px 0px 0px",threshold:1,root:n[0].closest(".ndm-page-header")}),b=new IntersectionObserver(function(){y.elementIsInsideScrollableParent=!y.elementIsInsideScrollableParent,p.forceScopeDigest(s)},{rootMargin:"0px",threshold:.5,root:y.scrollableParent[0]}),_=n[0].querySelector(".ndm-switchport-select__toggle"),r(L,s),K(y._appendToBody),R.push(e.$on(E,L),e.$on(I,L)),x=e.$on(T,function(e,t){y._appendToBody=t,Y(t)})},y.$onChanges=function(e){if(u.has(e,"options")){var t=u.get(e,"options.currentValue");if(!u.isArray(t))return;y.options=t,y.selectedOption=u.find(y.options,function(e){return e.id===y.value})}if(u.has(e,"appendToBody")){var n=u.get(e,"appendToBody.currentValue");u.isUndefined(n)||(x(),x=u.noop,y._appendToBody=n,Y(n))}},y.$onDestroy=function(){R.forEach(function(e){return e()}),x()}}e.$inject=["$rootScope","$document","$element","$interval","$timeout","$window","$scope","windowResizeWatcher","browserCheck","CONSTANT","keyboard","utils","_"],angular.module("keenetic").component("ndmSwitchportSelect",{transclude:!1,templateUrl:"app/components/ndm-switchport-select/ndm-switchport-select.html",bindings:{isDisabled:"<",value:"=",name:"@",options:"<",onChange:"<",placeholder:"<",className:"@",optionIconDimensions:"<",appendToBody:"<",scrollableParentSelector:"<"},controller:e,controllerAs:"vm"})}(),function(){angular.module("keenetic").component("ndmSwitchportRole",{templateUrl:"app/components/ndm-switchport-role/ndm-switchport-role.html",controller:function(){},bindings:{role:"<",title:"<",roleText:"<"},controllerAs:"vm"})}(),function(){function e(e,t,n,i,a,o,s,r,l,c){var d,p,u,m=this,f=s.events,g=f.SWITCHPORT_CONTAINER_OVERFLOW_CHANGED,v=f.SWITCHPORT_CONTAINER_RECALCULATE_OVERFLOW,h=f.SWITCHPORT_CONTAINER_OVERFLOW_STATE,b="ndm-switchport".toUpperCase(),_=[],y=!1;m.SCROLL_TOLERANCE=10,m.isReady=!1,m.maxScrollLeft=0,m.isScrollVisible=!1;var S=function(e){return m.childNodesClass?e.classList.contains(m.childNodesClass):e.tagName===b},w=function(){return c.get(m,"transcludeEl.style.overflowX","")},C=function(){d&&(d.on("touchstart",m.startScrollLeft),d.on("touchend",m.stopScroll),d=null),p&&(p.on("touchstart",m.startScrollRight),p.on("touchend",m.stopScroll),p=null)},E=function t(){var o=_toConsumableArray(m.transcludeEl.children).filter(S).map(function(e){var t=i.getComputedStyle(e);return Number(c.get(t,"width","").replace("px",""))}).reduce(function(e,t){return e+t},0);if(isNaN(o)||0===o)a(t,300);else{var s=w();m.isScrollVisible=o>m.mainEl.clientWidth+16,m.isScrollVisible?m.transcludeEl.style.overflowX="scroll":m.transcludeEl.style.overflowX="",m.maxScrollLeft=Math.ceil(o-m.mainEl.clientWidth-16);var r=w();n.$broadcast(h,"scroll"===r),s!==r&&(c.invoke(m,"onOverflowChange",r),n.$broadcast(g,"scroll"===r),"scroll"===r&&function t(){var n=_toConsumableArray(e[0].querySelectorAll(".scroll-buttons__button"));if(0!==n.length){var i=e[0].querySelector(".ndm-switchport-container__overlay-down"),o=angular.element(i).scope();d=angular.element(n[0]),p=angular.element(n[1]),d.on("touchstart",m.startScrollLeft),d.on("touchend",m.stopScroll),p.on("touchstart",m.startScrollRight),p.on("touchend",m.stopScroll),o.$on("$destroy",C)}else a(t,200)}())}},I=function e(t,n){m.transcludeEl.scrollLeft+=t,y&&a(function(){return e(t+n,n)},5)},T=function(){y=!0};m.stopScroll=function(){y=!1},m.startScrollLeft=function(){T(),I(-10,-1)},m.startScrollRight=function(){T(),I(10,1)},m.isScrollLeftButtonInactive=function(){return m.transcludeEl.scrollLeft<m.SCROLL_TOLERANCE},m.isScrollRightButtonInactive=function(){return m.maxScrollLeft-m.transcludeEl.scrollLeft<m.SCROLL_TOLERANCE},m.$onInit=function(){_.push(n.$on(v,E))},m.$onDestroy=function(){_.forEach(function(e){return e()}),o.cancel(u)},m.$postLink=function(){m.transcludeEl=e[0].querySelector(".ndm-switchport-container__transclude"),m.mainEl=e[0].querySelector(".ndm-switchport-container"),t.$watch(function(){return c.get(m.mainEl,"offsetWidth",0)},E),u=o(function(){E()},1e3),E(),m.isReady=!0,m.isMacOs=l.isMacOs}}e.$inject=["$element","$scope","$rootScope","$window","$timeout","$interval","CONSTANT","windowResizeWatcher","browserCheck","_"],angular.module("keenetic").component("ndmSwitchportContainer",{transclude:!0,templateUrl:"app/components/ndm-switchport-container/ndm-switchport-container.html",controller:e,bindings:{onOverflowChange:"<",childNodesClass:"<"},controllerAs:"vm"})}(),function(){angular.module("keenetic").component("ndmSwitchport",{transclude:!0,templateUrl:"app/components/ndm-switchport/ndm-switchport.html",bindings:{isSfp:"<",isCombo:"<",isSfpActive:"<",isReversed:"<",isBlue:"<",label:"<",role:"<?"},controller:function(){var e=this,t=function(e){return e.isReversed?"socket-reverse":e.isCombo&&e.isSfpActive?"socket":e.isBlue||e.isCombo&&!e.isSfpActive?"blue-socket":"socket"};e.$onInit=function(){e.svgId=t(e)},e.$onChanges=function(){e.svgId=t(e)}},controllerAs:"vm"})}(),function(){function e(e,t){var n=this,i=function(){return e.getSvgCache().then(function(e){var i=t.get(e,["shapes",n.svgId]);i?(n._width=n.width||i.w,n._height=n.height||i.h,n.spriteUrl=t.get(e,"sprite",""),n.viewbox=t.trim(t.get(i,"viewbox","")),n.svgUrl=n.spriteUrl+"#"+n.svgId,n.isVisible=Boolean(n.svgId&&n.spriteUrl&&n.viewbox)):n.isVisible=!1})};n.$onInit=i,n.$onChanges=function(e){e.svgId&&!e.svgId.isFirstChange()&&i()}}e.$inject=["utils","_"],angular.module("keenetic").component("ndmSvgIcon",{transclude:!1,templateUrl:"app/components/ndm-svg-icon/ndm-svg-icon.html",replace:!0,restrict:"E",bindings:{width:"@",height:"@",className:"@",svgId:"@"},controller:e})}(),function(){angular.module("keenetic").directive("ndmSubForm",function(){return{templateUrl:"app/components/ndm-sub-form/ndm-sub-form.html",replace:!0,transclude:!0}})}(),function(){function e(e,t){return{restrict:"A",link:function(n,i,a){var o=a.ndmSref,s="";-1!==o.indexOf("#")&&(s=(o=o.split("#"))[1],o=o[0]);var r=o.split("@"),l=r[1]?r[1]:"";r=r[0].split(":");var c=Number(r[1]);r=t().getRoute(r[0],c,!1),i.attr("href",e.href(r,{tab:l,"#":s},{absolute:!0}))}}}e.$inject=["$state","menuSetup"],angular.module("keenetic").directive("ndmSref",e)}(),function(){function e(e,t,n,i,a,o){var s=this;s.isReady=!1,s.$onInit=function(){i(function(){var e=n[0].querySelector(".option-details");if(e){var t=Math.min(32*s.options.length,200);e.style["min-height"]="".concat(2+t,"px")}}),s.unbindSelectboxToggleListener=e.$on(a.events.SELECTBOX_TOGGLE_OPEN,function(e,t,n,i){s.dropup=i}),s.onChange=s.onChange||o.noop,s.isReady=!0},s.$onChanges=function(e){var t=o.get(e,"options.currentValue");o.isArray(t)&&(s.options=t.map(function(e){var t=e.description||o.get(e,"details.shortDescription","")||o.get(e,"details.description","");return Object.assign({},e,{description:t})}))},s.onOpen=function(){s.value&&s.showPreview(s.value)},s.showPreview=function(e){var t=o.find(s.options,{id:e})||{};s.previewValue=t.details||null,s.previewIsVisible=!0},s.hidePreview=function(){s.dropup=!1,s.previewValue=null,s.previewIsVisible=!1},s.$onDestroy=function(){s.unbindSelectboxToggleListener()}}e.$inject=["$rootScope","$document","$element","$timeout","CONSTANT","_"],angular.module("keenetic").component("ndmSelectboxWithDetails",{transclude:!0,templateUrl:"app/components/ndm-selectbox-with-details/ndm-selectbox-with-details.html",bindings:{isDisabled:"<",isRequired:"<",value:"=",label:"@",name:"@",options:"<",onChange:"<",noValueMsg:"@",emptyListMsg:"@",idProp:"@",labelProp:"@",className:"@",description:"@"},controller:e,controllerAs:"vm"})}(),function(){function e(e,t,n,i,a,o,s,r,l){var c,d=this,p="".concat(".ndm-selectbox-filter__dropdown","-container"),u={idProp:"id",labelProp:"label",noValueMsg:r.getTranslation("ndm-selectbox-filter.no-value-selected"),emptyListMsg:r.getTranslation("ndm-selectbox-filter.no-suitable-options")},m=function(){return t[0].querySelector(p)},f=function(){var e=d.totalOptionsLength;return d.groups&&d.groups.length>1&&(e+=d.groups.filter(function(e){return e[d.labelProp]}).length),e},g=function(e){var i=m(),a=t[0].querySelector(".ndm-selectbox-filter__dropdown");f()>5&&n(function(){var t=i.querySelector(e);if(t&&a){var n=a.getBoundingClientRect(),o=t.getBoundingClientRect();i.scrollTop=o.top-n.top}})},v=function(){var e=o.find(d.options,_defineProperty({},d.idProp,d.value));e?d.onOptionClick(e):d.placeholderText=d.noValueMsg},h=function(e){if(d.isOpened){var n=e.target;(d.containerEl&&!r.dom.isAncestor(d.containerEl,n)||!d.containerEl&&!r.dom.isAncestor(t[0],n))&&(v(),d.hideOptions())}},b=function(e,t){for(var n=d.groups.length||0,i=e,a=d.groups[i][d.idProp],o=d.filteredOptions[a]||[],s=o.length;0===s;)if(i+=t,a=d.groups[i%n][d.idProp],s=(o=d.filteredOptions[a]||[]).length,i===e)return-1;return i},_=function(e){if(-1!==e){var t=d.groups[e][d.idProp];d.optionInFocus=d.filteredOptions[t][0][d.idProp],d.groupInFocus=t}};d.onSpace=function(){d.isOpened||d.showOptions()},d.onEnter=function(){d.isOpened?d.onOptionClick(o.find(d.options,_defineProperty({},d.idProp,d.optionInFocus))):d.showOptions()},d.onDownArrow=function(){if(d.isOpened){var e=d.filteredOptions[d.groupInFocus]||[],t=o.findIndex(e,_defineProperty({},d.idProp,d.optionInFocus));if(-1===t&&(t=0),t>=e.length-1){var i,a=o.findIndex(d.groups,_defineProperty({},d.idProp,d.groupInFocus));if(-1===a)return;i=a===d.groups.length-1?0:a+1;var s=b(i,1);s===a?d.optionInFocus=e[0][d.idProp]:_(s)}else d.optionInFocus=e[t+1][d.idProp];return n(function(){return g(".dropdown-item--focus")}),!1}},d.onUpArrow=function(){if(d.isOpened){var e=d.filteredOptions[d.groupInFocus]||[],t=o.findIndex(e,_defineProperty({},d.idProp,d.optionInFocus));if(-1!==t){if(0===t){var i,a=o.findIndex(d.groups,_defineProperty({},d.idProp,d.groupInFocus));if(-1===a)return;i=0===a?d.groups.length-1:a-1;var s=b(i,-1);s===a?d.optionInFocus=e[e.length-1][d.idProp]:_(s)}else d.optionInFocus=e[t-1][d.idProp];return n(function(){return g(".dropdown-item--focus")}),!1}}};var y=function(e){l.isEnter(e)?n(function(){d.optionInFocus&&d.onOptionClick(o.find(d.options,_defineProperty({},d.idProp,d.optionInFocus)))}):l.isEscape(e)?d.hideOptions():(l.isUpArrow(e)||l.isDownArrow(e))&&n(function(){l.isUpArrow(e)?d.onDownArrow():l.isDownArrow(e)&&d.onUpArrow(),n(function(){return g(".dropdown-item--focus")})})},S=function(){e.unbind("click",h),t.off("keydown",y),n(function(){d.containerEl=null})},w=function(){!d.groupOptionsBy||d.groupLabels&&!o.isEmpty(d.groupLabels)||(d.groupLabels=Object.keys(o.groupBy(d.options,d.groupOptionsBy))),d.groupLabels&&(!o.isObject(d.groupLabels)||o.isEmpty(d.groupLabels)?d.groupLabels=!1:angular.isObject(d.groupLabels[0])||(d.groupLabels=r.idsToOptions(d.groupLabels,angular.identity))),v()};d.showOptions=function(){if(!d.isOpened){d.calculateTotalOptionsLength();var i=t[0].getBoundingClientRect(),l=r.dom.findParentScrollableElement(t[0]).getBoundingClientRect(),c=40*f();d.dropup=i.bottom+c>l.bottom&&i.top-c>l.top,d.isOpened=!0,a.$broadcast(s.events.SELECTBOX_TOGGLE_OPEN,d.uid,d.name),e.bind("click",h),t.on("keydown",y),n(function(){d.containerEl=m()}),n(function(){if(d.value){g(".dropdown-item--selected"),d.optionInFocus=d.value;for(var e=0,t=d.groups.length;e<t;++e){var n=d.groups[e][d.idProp];if(angular.isArray(d.filteredOptions[n])&&d.filteredOptions[n].some(function(e){return e[d.idProp]===d.value})){d.groupInFocus=n;break}}}else d.groups&&(d.groupInFocus=d.groups[0][d.idProp]),d.ungroupedOptions.length>0?d.optionInFocus=d.ungroupedOptions[0][d.idProp]:d.optionInFocus=o.get(d.filteredOptions,[d.groupInFocus,0,d.idProp])})}};d.hideOptions=function(){d.isOpened&&(d.isOpened=!1,a.$broadcast(s.events.SELECTBOX_TOGGLE_CLOSE,d.uid,d.name),d.value&&(d.valueLabel=(o.find(d.options,_defineProperty({},d.idProp,d.value))||{})[d.labelProp]),S())},d.onOptionHover=function(e,t){d.groupInFocus=t[d.idProp],d.optionInFocus=e[d.idProp]},d.calculateTotalOptionsLength=function(){var e=0;(d.groups||[]).forEach(function(t){d.filteredOptions[t[d.idProp]]&&(e+=d.filteredOptions[t[d.idProp]].length)}),d.totalOptionsLength=e},d.filterOptions=function(e){if(d.options){var t,n=[];if(e){var i=r.createMatchStrRegexp(e);n=o.map(d.options,function(t){var n=t[d.labelProp];if(!n)return!1;var a=i.exec(n);if(i.lastIndex=0,!a)return!1;var o=a.index,s=r.highlightMatch(n,i||e);return Object.assign({},t,{matchIndex:o,highlightLabel:s})}).filter(angular.identity),n=o.sortBy(n,"matchIndex")}else n=d.options.map(function(e){return o.omit(e,["matchIndex","highlightLabel"])});if(d.ungroupedOptions=n,d.ungroupedOptions.length>0&&(!d.value||-1===o.findIndex(d.ungroupedOptions,_defineProperty({},d.idProp,d.value)))&&(d.optionInFocus=d.ungroupedOptions[0][d.idProp]),d.groupLabels)d.filteredOptions=o.groupBy(n,d.groupOptionsBy),d.groups=angular.copy(d.groupLabels);else d.filteredOptions=[n],d.groups=[(t={},_defineProperty(t,d.idProp,0),_defineProperty(t,d.labelProp,""),t)];d.hideItemGroups=1===d.groups.length,d.calculateTotalOptionsLength()}},d.onContainerKeydown=function(e){!d.isOpened&&l.isDownArrow(e)&&(e.preventDefault(),e.stopPropagation(),d.showOptions())},d.onInputClick=function(){d.isOpened?d.hideOptions():(d.filterOptions(!d.value&&d.valueLabel),d.showOptions())},d.onInputChange=function(e){d.filterOptions(e),d.showOptions()},d.onOptionClick=function(e){var t=d.value;d.value=e[d.idProp],d.valueLabel=e[d.labelProp],d.placeholderText="",d.hideOptions(),d.value!==t&&angular.isFunction(d.onChange)&&d.onChange(d.value,t)},d.$onInit=function(){["idProp","labelProp","emptyListMsg","noValueMsg"].forEach(function(e){d[e]=d[e]||u[e]}),d.placeholderText="",d.totalOptionsLength=0,d.ungroupedOptions=[],d.isOpened=!1,d.uid=r.getUniqueId(),d.unbindOnToggleOpen=a.$on(s.events.SELECTBOX_TOGGLE_OPEN,function(e,t){t!==d.uid&&d.isOpened&&(d.isOpened=!1),S()}),d.groupOptionsBy&&!d.groupLabels&&(d.groupLabels=Object.keys(o.groupBy(d.options,d.groupOptionsBy))),d.options&&w(),c=d.value},d.$doCheck=function(){angular.equals(d.value,c)||(v(),c=angular.copy(d.value))},d.$onChanges=function(e){(e.options||e.groupLabels||e.groupOptionsBy)&&(w(),d.filterOptions()),e.isDisabled&&d.isDisabled&&d.hideOptions()},d.$onDestroy=function(){return d.unbindOnToggleOpen()}}e.$inject=["$document","$element","$timeout","$window","$rootScope","_","CONSTANT","utils","keyboard"],angular.module("keenetic").component("ndmSelectboxFilter",{templateUrl:"app/components/ndm-selectbox-filter/ndm-selectbox-filter.html",bindings:{isDisabled:"<",isRequired:"<",value:"=",label:"@",name:"@",options:"<",groupOptionsBy:"<",groupLabels:"<?",onChange:"<",noValueMsg:"@",emptyListMsg:"@",idProp:"@",labelProp:"@",className:"@"},controller:e})}(),function(){function e(e,t,n,i,a,o){return s.$inject=["$scope","$element","$attrs"],r.$inject=["$scope","$element","$document","$timeout","Selectbox"],{restrict:"E",templateUrl:"app/components/ndm-selectbox/ndm-selectbox.html",transclude:!0,scope:{className:"@?",options:"=",disabled:"=",value:"=",onChange:"&",onValueChange:"&",onFocusChange:"&",isUpdating:"&",onHover:"&",onOpen:"&",onClose:"&",onDescriptionClick:"&",isDescriptionDisabled:"<",name:"@",placeholder:"@",extraValidator:"=",viewAsLink:"<",emptyListMsg:"@"},replace:!0,controller:r,controllerAs:"vm",link:s,bindToController:{value:"=",isDisabled:"=",isOpened:"=",idKey:"@",title:"@label",name:"@",error:"@",placeholder:"@",description:"@",onDescriptionClick:"&",onOpen:"&",onClose:"&",bottomDescription:"@",onChange:"&",onFocusChange:"&",onHover:"&",showIconAsLabel:"<"}};function s(e,t,a){angular.isUndefined(a.isUpdating)&&(e.isUpdating=function(){return!1});var o=angular.element(t[0].querySelector("input")).controller("ngModel");o.$validators.customValidator=function(t){if(angular.isUndefined(o.$viewValue))return e.error=n.getTranslation("errors.required"),!1;if(e.error=void 0,angular.isFunction(e.extraValidator)){var i=e.extraValidator(t);if(angular.isString(i))return e.error=i,!1}return!0},e.clickableDescription=a.onDescriptionClick,e.onDescriptionKeydown=function(t){if(!i.isEnter(t)||e.disabled)return!0;if(t.preventDefault(),angular.isFunction(e.onDescriptionClick)){var n=e.onDescriptionClick();angular.isFunction(n)&&n(e.name,e.value)}}}function r(a,s,r,l,c){var d=this,p=t.events.SELECTBOX_TOGGLE_OPEN,u=t.events.SELECTBOX_TOGGLE_CLOSE,m=5,f=c.getDefaults();d.textLink=Boolean(s[0].getAttribute("on-description-click")),d.instance=c.getInstance(),d.disabled=d.isDisabled,d.active=f.active,d.focus=f.focus,d.idKey=d.idKey||f.idKey,d.labelKey=d.labelKey||f.labelKey,d.value=a.value;d._onFocusChange=angular.isFunction(a.onFocusChange())?a.onFocusChange():angular.noop,d.onKeydown=function(e){return!(!a.disabled&&!d.isDisabled)||(i.isSpace(e)&&(e.preventDefault(),e.stopPropagation(),d.toggle(e)),!0)},d.uid=n.getUniqueId(),a.$on("$destroy",o.$on(p,function(e,t){t!==d.uid&&d.active&&(d.active=!1,s[0].querySelector(".sb-container").classList.remove("sb-container--opened"),d.onClose&&d.onClose()),w()}));var g=function(){var t;d.focusableOptions=(t=d.options,e.filter(t,function(e){return!e.hide&&!e.disabled})),d.focusableOptKeys=d.focusableOptions.map(function(e){return e[d.idKey]}),d.focusableOptCount=d.focusableOptKeys.length,d.focusId=(angular.isDefined(d.focusableOptKeys[d.focus])?d.options[d.focusableOptKeys[d.focus]]:{})[d.idKey]};d.options=c.optionsConvert(a.options,d.idKey,d.labelKey),l(function(){return g()}),a.$watch("options",function(e){d.options=c.optionsConvert(e,d.idKey,d.labelKey),l(function(){return g()})}),angular.isUndefined(a.emptyListMsg)?d.showEmptyListMsg=function(){return!1}:d.showEmptyListMsg=function(){return e.isEmpty(d.options)},h(),d.formatInstance=b,d.toggle=_,d.change=function(e,t){var n=d.value;d.value=t[d.idKey]||e,d.icon=d.options[e].icon,d.onChange&&d.onChange({value:d.value,name:d.name});v(d.value,n,d.name)},d.hover=function(e,t){d.focusId=e,d.onHover&&d.onHover({value:t.id})};var v=angular.noop;function h(){d.selected=d.value,d.icon=d.options[d.value]&&d.options[d.value].icon,d.options[d.selected]&&d.options[d.selected].disabled&&(d.isDisabled=!0)}function b(){return c.formatInstance(d.instance)}function _(t){return t&&t.stopPropagation(),d.active&&o.$broadcast(u,d.uid,d.name),d.active=!d.active,d.displayed=!1,d.active&&d.onOpen?d.onOpen():!d.active&&d.onClose&&d.onClose(),l(function(){var t,i=s[0].getBoundingClientRect(),a=s[0].querySelector(".sb-dropdown"),c=s[0].querySelector(".sb-container"),u=n.dom.findParentScrollableElement(s[0]).getBoundingClientRect(),f=u.bottom,g=u.top,v=Object.keys(d.options).length,h=v*(i.bottom-i.top),b=v>m;h=a?(t=a.getBoundingClientRect()).bottom-t.top:h>200?200:h,d.dropup=i.bottom+h>f&&i.top-h>g;var _=e.get(r[0],"documentElement.clientWidth");if(d.dropleft=t&&_&&t.right>_,c.classList[d.active?"add":"remove"]("sb-container--opened"),o.$broadcast(p,d.uid,d.name,d.dropup),d.active){d.displayed=!0,r.bind("click",y),s.on("keydown",S);var C=d.focus;if(d.focusableOptKeys.forEach(function(e,t){e===d.value&&(C=t)}),d.focus=C,d.focusId=(d.focusableOptKeys[d.focus]?d.options[d.focusableOptKeys[d.focus]]:{})[d.idKey],!b)return;l(function(){var e=c.querySelector(".sb-item-active");if(e&&a){var t=a.getBoundingClientRect(),n=e.getBoundingClientRect();a.scrollTop=n.top-t.top}})}else w()}),!1}function y(e){var t=c.getId(e.target.parentNode);b()!==t&&_()}function S(e){return i.isEnter(e)?(l(function(){var t=d.focusableOptKeys[d.focus],n=t?d.options[t]:{};d.focusId=n[d.idKey],d.change(t,n),d.toggle(e)}),e.preventDefault(),void e.stopPropagation()):i.isEscape(e)?(d.toggle(e),e.preventDefault(),void e.stopPropagation()):void((i.isUpArrow(e)||i.isDownArrow(e))&&(e.preventDefault(),e.stopPropagation(),l(function(){var t=d.focusId;d.focus=c.getFocus(d.focus,0,d.focusableOptCount-1,i.isDownArrow(e)),d.focusId=(angular.isDefined(d.focusableOptKeys[d.focus])?d.options[d.focusableOptKeys[d.focus]]:{})[d.idKey],d._onFocusChange(d.focusId,t),d.focusableOptCount>m&&c.updateScrollPosition(d.focus,s[0].querySelector(".sb-dropdown"))})))}function w(){r.unbind("click",y),s.off("keydown",S)}l(function(){angular.isFunction(a.onValueChange())&&(v=a.onValueChange())}),a.$on("$destroy",w),a.$watch("vm.value",function(){h()})}}e.$inject=["_","CONSTANT","utils","keyboard","$window","$rootScope"],angular.module("keenetic").directive("ndmSelectbox",e).factory("Selectbox",function(){var e=0,t={active:!1,focus:0,idKey:"id",labelKey:"label"};return{getInstance:function(){return e+=1},getDefaults:function(){return angular.copy(t)},formatInstance:function(e){return"sb-"+e},getFocus:function(e,t,n,i){e=i?e>=n?t:e+1:e<=t?n:e-1;return e},updateScrollPosition:function(e,t){var n=(t.querySelector(".sb-item-focus")||t.querySelector(".sb-item-active")).offsetHeight*e;n>=t.offsetHeight?t.scrollTop=n:n<=t.scrollTop&&(t.scrollTop=0)},getId:function(e){if(!e||!angular.isFunction(e.getAttribute))return null;return e.getAttribute("id")},optionsConvert:function(e,t,n){var i={};function a(e,a,o){e instanceof Array?(i[e[0]]={description:e[2]},i[a||e[0]][n]=e[1]):angular.isObject(e)?(!e[n]&&e.name&&(e[n]=e.name),e.idx=o,i[a||e[t]]=e):i[a||e]=e}e instanceof Array?e.forEach(function(e,t){a(e,null,t)}):angular.isObject(e)&&Object.keys(e).forEach(function(e,t){a(e,t)});return i}}})}(),function(){function e(e){var t=1440,n=7*t;return{actionsToPatterns:function(e){if(!angular.isArray(e)||!e.length)return[];var i=[],a=[];e.forEach(function(e){var o="start"===e.action,s=60*Number(e.hour)+Number(e.min);("*"===e.dow?[0,1,2,3,4,5,6]:e.dow.split(",")).forEach(function(e){(o?i:a).push((e*t+s)%n)})}),i.sort(function(e,t){return e-t});var o=[];i.forEach(function(e){var t=!1;a.forEach(function(i){(!1===t||i>e&&i<t||i<e&&i+n<t)&&(t=i>e?i:i+n)}),o.push([e,t])});var s=[];return o.forEach(function(e){for(var n=e[0]/t|0,i=(e[1]-1)/t|0,a=n;a<=i;a++){var o=e[0]<a*t?0:e[0]%t,r=e[1]>(a+1)*t?t:e[1]%t||t;s.push([o,r,a%7])}}),s},patternsToActions:function(i){if(!angular.isArray(i)||!i.length)return[];var a=[];i.forEach(function(e){var n=e[2]*t;a.push([e[0]+n,e[1]+n])}),a.sort(function(e,t){return e[0]-t[0]});for(var o=-1;0!==o;){o=0;for(var s=function(t){var i=a[t];if(!i)return"continue";var s=e.findIndex(a,function(e){return i[1]%n==e[0]%n});if(-1===s)return"continue";a[t][1]=a[s][1],a.splice(s,1),o++},r=0;r<a.length;r++)s(r)}var l=[],c=[];a.forEach(function(n){[n[0],n[1]].forEach(function(n,i){var a=n/t|0,o=n-a*t;o===t&&(a++,o=0);var s=i?c:l,r=e.findIndex(s,function(e){return e[0]===o});-1===r?s.push([o,[a%7]]):s[r][1].push(a%7)})});var d=[];return[l,c].forEach(function(e,t){e.forEach(function(e){e[1].sort(function(e,t){return e-t}),d.push({action:t?"stop":"start",hour:e[0]/60|0,min:e[0]%60,dow:7===e[1].length?"*":e[1].join(",")})})}),d}}}e.$inject=["_"],angular.module("keenetic").factory("schedulesTimeCoder",e)}(),function(){function e(e,t,n){function i(t){return e.mapValues(t,function(e,t){return Object.assign({},e,{id:t,description:e.description||t})})}function a(){return t.cached("show.rc.schedule").then(function(e){return i(e)})}function o(e){return t.post({url:"",data:[e,{system:{configuration:{save:!0}}}]}).then(function(){n.$broadcast("NDM-SCHEDULES-SAVED")})}return{ADD_SCHEDULE_OPTION_ID:"__NEW__",isActive:function(t){return!e.isArray(t.action)||"stop"===t.action.filter(function(e){return e.next})[0].type},processSchedules:i,getSchedules:a,save:function(e){return e.id&&angular.isString(e.id)?t(e.id,e).then(function(){return e}):a().then(function(n){for(var i=0,a="schedule0";n[a];)a="schedule"+i++;return t(a,e).then(function(){return e.id=a,e})});function t(e,t){var n={schedule:{}};return t.action.unshift({no:!0}),n.schedule[e]={description:t.description||e,action:t.action},o(n)}},del:function(e){var t={schedule:{}};return t.schedule[e]={no:!0},o(t)},getSchedule:function(e){return a().then(function(t){return t[e]||{}})}}}e.$inject=["_","router","$rootScope"],angular.module("keenetic").factory("schedules",e)}(),function(){angular.module("keenetic").directive("ndmRadioButtons",function(){return e.$inject=["scope"],{templateUrl:"app/components/ndm-radio-buttons/ndm-radio-buttons.html",replace:!0,transclude:!0,link:e,scope:{model:"=",current:"<",name:"@",label:"@",onChange:"&",hint:"@",hintTitle:"@",description:"<",onChangedFn:"<",isDisabled:"="}};function e(e){e.current=e.model[0],e.onClick=function(t){e.isDisabled||e.current===t||(e.current=t,angular.isFunction(e.onChangedFn)&&e.onChangedFn(t))}}})}(),function(){function e(e){return t.$inject=["scope","element","attrs"],{templateUrl:"app/components/ndm-radio/ndm-radio.html",replace:!0,transclude:!0,link:t,scope:{model:"=",array:"=",name:"@",label:"@",onChange:"&",disabled:"=",hint:"@",hintTitle:"@",description:"<"}};function t(t,n,i){e(function(){i.onChange&&(")"===i.onChange.substr(-1)?t._onChangeHandler=t.onChange:t._onChangeHandler=t.onChange())}),t._click=function(e){t.model=e.id,(t._onChangeHandler||angular.noop)(e.value||e.id)}}}e.$inject=["$timeout"],angular.module("keenetic").directive("ndmRadio",e)}(),function(){angular.module("keenetic").directive("ndmProgressBar",function(){return{templateUrl:"app/components/ndm-progress-bar/ndm-progress-bar.html",scope:{isVisible:"=",count:"=",loadStatus:"<?",noTransition:"&",isCountHidden:"="},link:function(e,t,n){e.noTransition="noTransition"in n}}})}(),function(){function e(e,t){return n.$inject=["scope","element"],{require:"^ngController",templateUrl:"app/components/ndm-ports-range/ndm-ports-range.html",transclude:!0,replace:!0,link:n,scope:{error:"=",modelFrom:"=",modelTo:"=",mode:"=",singleTitle:"@",rangeTitle:"@",hint:"@",nameFrom:"@",nameTo:"@",extraValidator:"="}};function n(n,i){var a,o=u(0);n.errors={from:!1,to:!1,extra:!1,range:!1},n.$watch("error",r),n.$watch("mode",function(e){n.singleMode=!("1"===e||1===e||"ports"===e||!0===e)}),n.$watch("singleMode",r),n.singleTitle=n.singleTitle||m("single-title"),n.rangeTitle=n.rangeTitle||m("range-title");var s=function(){return r(),!0};function r(){d(!1),e.cancel(a),a=e(l,100)}function l(){if(p(n.modelFrom)?n.errors.from=!1:n.errors.from=m("invalid-number")+" 1..65535",n.singleMode||p(n.modelTo)?n.errors.to=!1:n.errors.to=m("invalid-number")+" 1..65535",!n.singleMode&&!n.errors.to&&!n.errors.from&&Number(n.modelFrom)>Number(n.modelTo)?n.errors.range=m("wrong-range"):n.errors.range=!1,n.error?n.errors.extra=n.error:n.errors.extra=!1,c()&&angular.isFunction(n.extraValidator)){var e=n.extraValidator(Number(n.modelFrom),n.singleMode?void 0:Number(n.modelTo));!1===e&&(e="extra error"),n.errors.extra=!0!==e&&e}d(c())}function c(){for(var e in n.errors)if(n.errors[e])return!1;return!0}function d(e){o.$setValidity("rangeValidator",e)}function p(e){var t=parseInt(e,10);return!isNaN(t)&&t>0&&t<=65535}function u(e){var t=e?"___to":"___from",n=i[0].querySelector("input."+t);return angular.element(n).controller("ngModel")}function m(e){return t.getTranslation("ports-range."+e)}o.$validators.ndmPortRange=s,u(1).$validators.ndmPortRange=s,n.numericInputFilter=function(e){var t=e.which||e.keyCode;t>=48&&t<=57||8===t||e.preventDefault()}}}e.$inject=["$timeout","utils"],angular.module("keenetic").directive("ndmPortsRange",e)}(),function(){function e(e,t,n){var i=this,a=n.events,o=a.POPUP_OPENED,s=a.POPUP_CLOSED;i.close=function(){t.invoke(i,"onClose")},i.$onChanges=function(t){if(t.isVisible&&!t.isVisible.isFirstChange()){var n=t.isVisible.currentValue?o:s;e.$broadcast(n)}}}e.$inject=["$rootScope","_","CONSTANT"],angular.module("keenetic").component("ndmPopupSmall",{templateUrl:"app/components/ndm-popup-small/ndm-popup-small.html",transclude:!0,bindings:{popupClass:"@",isVisible:"<",onClose:"<",showCloseBtn:"<"},controller:e,controllerAs:"vm"})}(),function(){function e(e){return{templateUrl:"app/components/ndm-popup-header/ndm-popup-header.html",replace:!0,transclude:!0,controllerAs:"popupHeader",scope:{title:"@label",close:"=",webhelpId:"@",hint:"@?"},link:function(t,n){t.isShadowShown=!1,e(function(){var e=n.parent()[0].querySelector(".ss-content");e&&(t.resetScrollTop=function(){e.scrollTop=0},e.addEventListener("scroll",function(){t.isShadowShown=e.scrollTop>10,"$apply"!==t.$root.$$phase&&"$digest"!==t.$root.$$phase&&t.$apply()}),t.isShadowShown=e.scrollTop>10)})}}}e.$inject=["$timeout"],angular.module("keenetic").directive("ndmPopupHeader",e)}(),function(){function e(e,t,n,i,a,o,s,r,l,c,d,p,u,m,f,g,v){return{templateUrl:"app/components/ndm-popup/ndm-popup.html",transclude:!0,replace:!0,link:function(o,r){var l=this;o.initialized=!1,t(function(){var e=n[0].getElementById("cp-main-container")||n[0].getElementById("ndm-page-view");e&&e.appendChild(r[0]),o.initialized=!0});var g=!1,h=0;o.$on("$destroy",u.onStart({},function(e){if(o.isVisible){var t=e.options();y.transitionViaLink=f.includes(["sref","url"],t.source)}return!0}));var b={isRegistered:!1,unregisterHook:function(){},register:function(){b.isRegistered||(b.isRegistered=!0,b.unregisterHook=p.register(b.onGoBack.bind(l)))},unregister:function(){b.isRegistered&&(b.isRegistered=!1,b.unregisterHook())},onGoBack:function(){b.isRegistered=!1,o.onCloseClick()}},_={},y={transitionViaLink:!1,watcherCreated:!1,unregisterWatcher:function(){},register:function(){y.watcherCreated||(y.watcherCreated=!0,y.unregisterWatcher=u.onStart({},function(e){var t=f.find(e.treeChanges().to,function(e){return e.name===_.stateName&&y.compareParams(_.stateParams,e.paramValues)});if(!t)return o.onCloseClick()}))},unregister:function(){y.watcherCreated&&(y.watcherCreated=!1,y.unregisterWatcher())},compareParams:function(e,t){var n=!1;return f.forEach(e,function(i,a){n=n||"#"!==a&&e[a]!==t[a]}),!n},leaveState:function(){if(y.unregister(),!y.transitionViaLink){var e=f.find(y.getStateTree(),function(e){return e.name===_.stateName&&y.compareParams(_.stateParams,e.params)});e&&y.goToParentState()}},goToParentState:function(){var e=v.get(),t=y.getParentState(_.stateName);f.get(e,"state.name")===t.name&&y.compareParams(e.params,t.params)?i.window.history.go(-1):a.go(t.name,t.params)},getParentState:function(e){var t=e.split(".");t.pop();var n=t.join(".");return f.find(y.getStateTree(),function(e){return e.name===n})},getStateTree:function(){for(var e=a.$current,t=[];e.name;)t.push({name:e.name,params:f.clone(a.params)}),e=e.parent;return t}};(_={stateName:"",stateParams:{},isRouted:!1,isRoutedCheckedOnce:!1,isVisible:null,checkIsRouted:function(){return _.isRoutedCheckedOnce?_.isRouted:(_.isRoutedCheckedOnce=!0,!f.isEmpty(e.ndmRoutedPopupsStack)&&(f.find(Object.keys(e.ndmRoutedPopupsStack).sort(),function(t){if(a.current.name.substring(0,t.length)+"."==t+".")return _.stateName=t,_.stateParams=e.ndmRoutedPopupsStack[t],delete e.ndmRoutedPopupsStack[t],!0}),_.isRouted=Boolean(_.stateName),_.isRouted))},onShow:function(){e.$broadcast(m.events.POPUP_OPENED),_.checkIsRouted(),_.isVisible||(_.isVisible=!0,_.isRouted?y.register():b.register())},onClose:function(){e.$broadcast(m.events.POPUP_CLOSED),_.isVisible&&(_.isRouted?(y.unregister(),y.leaveState()):b.unregister(),_.isRoutedCheckedOnce=!1,_.isVisible=!1)},initialize:function(){o.$watch("isVisible",function(e){return e?_.onShow():_.onClose()}),o.$on("$destroy",_.onClose)}}).initialize();var S=function(){angular.isFunction(o.close)&&o.close()};o.onCloseClick=function(){if(o.isVisible){if(!o.allowFormChanges){var e=o.changesCheckerFunction?o.changesCheckerFunction():d.confirmIfNodeHasUnsavedForm(r[0],"confirm-cancelling-changes");return e.then(function(){return S(),!0},function(){return _.checkIsRouted()&&b.register(),!1})}S()}};var w=function(){e.isPopupOpen=e.ndmPopupsStack.length>0;for(var t=e.ndmPopupsStack.length,n=0;n<t;++n)e.ndmPopupsStack[n].isUpperPopup=n===t-1,e.ndmPopupsStack[n].element.setAttribute("data-ndm_popup_level",n)},C=function(){t(function(){for(var t=[],n=0;n<e.ndmPopupsStack.length;++n)!e.ndmPopupsStack[n].$$destroyed&&e.ndmPopupsStack[n].isVisible&&t.push(e.ndmPopupsStack[n]);e.ndmPopupsStack=t,w()})};o.$watch("isVisible",function(n){s.isPC||(n?(h=i.scrollY,i.scrollTo(0,0),g=!0):(g&&i.scrollTo(0,h),g=!1)),n&&c.blurActiveElement(),n?(o.isVisible&&!o.$$destroyed&&e.ndmPopupsStack.push(o),w()):C(),t(function(){c.scrollTop(".ndm-popup")})}),s.isPC||o.$on("$destroy",function(){return g&&i.scrollTo(0,h)});e.ndmPopupsStack||(e.ndmPopupsStack=[]);o.isUpperPopup=!0,e.modalConfirm||(e.modalConfirm={open:!1});o.modalConfirm=e.modalConfirm,o.element=r[0],o.$on("$destroy",function(){C()})},scope:{headerTitle:"@",headerStatusClass:"@",headerStatusText:"@",close:"=",save:"=",isVisible:"=",webhelpId:"@",allowFormChanges:"<",headerHint:"@?",changesCheckerFunction:"<"}}}e.$inject=["$rootScope","$timeout","$document","$window","$state","$stateParams","browserCheck","notification","securityNotification","utils","formChangesChecker","goBackHook","$transitions","CONSTANT","_","$q","$previousState"],angular.module("keenetic").directive("ndmPopup",e)}(),function(){n.$inject=["$timeout","_"],angular.module("keenetic").directive("ndmPolling",n);var e=3e3,t=100;function n(n,i){return{restrict:"A",link:function(a,o){var s=function(e){return i.isFunction(i.get(e,"then"))},r=!1,l=!1;return function(){a.$on("$destroy",function(){l=!0,p(!1)}),n(d,(e=o.attr("ndm-timeout"),e=e?Number(e):0,isNaN(e)?0:e));var e}();function c(e){var n=e?Number(e):0;return 0|(isNaN(n)||n<t?0:Number(n))}function d(){if(!l){var e=o.attr("ndm-polling"),t=a.$eval(e);angular.isFunction(t)&&(t=t()),s(t)?t.then(p):p()}}function p(t){if(n.cancel(r),!1!==t&&!l){var i=c(t)||c(o.attr("ndm-interval"))||e;r=n(d,i)}}}}}}(),function(){function e(e,t,n,i,a,o,s,r,l){var c,d=this,p=l.constants,u=p.DEFAULT_PERMIT_POLICY,m=p.DEFAULT_DENY_POLICY,f=[u,m],g=(_defineProperty(c={},u,"policies.permit-policy"),_defineProperty(c,m,"policies.deny-policy"),c),v=function(){var t=e.when(!0);a.isEmpty(d.config)||(t=h(d.config).then(function(e){d.options=e.options,d.policyInterfaces=e.policyInterfaces})),t.then(function(){d.options[0].label=g[u],d.noDenyPolicy||(d.options[d.options.length-1].label=g[m])})};d.translateChangeSuccessHandler=i.$on("$translateChangeSuccess",function(){return t(v)}),d.unbindSelectboxToggleListener=a.noop,d.previewIsVisible=!1,d.constants=l.constants,d.label=d.label||"ndm-policy-select.label",d.config={};var h=function(t){var n=a.reverse(a.sortBy(r.getInterfaceOptions(t.showInterface).filter(function(e){return e.global}),"priority")),i={},o=[{id:f[0],label:g[f[0]]}];return i[f[0]]=n.map(function(e){return a.extend(e,{isEnabled:!0})}),a.mapValues(t.ipPolicy||{},function(e,t){o.push({id:t,label:e.description||t}),i[t]=(e.permit||[]).filter(function(e){return!e.auto}).map(function(e){var t,i=(t=e.interface,a.find(n,function(e){return e.id===t||e.name===t})||{label:e.interface});return a.extend({},i,{isEnabled:angular.isUndefined(e.enabled)||Boolean(e.enabled)})})}),d.noDenyPolicy||o.push({id:f[1],label:g[f[1]]}),e.when({config:t,options:o,policyInterfaces:i})};d.$onInit=function(){(d.initialData?h(d.initialData):l.getPoliciesSelectData().then(h)).then(function(e){d.config=e.config,d.options=e.options,d.policyInterfaces=e.policyInterfaces,d.unbindSelectboxToggleListener=i.$on(o.events.SELECTBOX_TOGGLE_OPEN,function(e,t,n,i){d.dropup=i}),d.ready=!0,t(function(){var e=n[0].querySelector(".interfaces-order-preview");e&&(e.style["min-height"]=41+Math.min(32*d.options.length,200)+"px")})})},d.onOpen=function(){d.value&&d.showPreview(d.value)},d.showPreview=function(e){d.previewValue=e,d.previewIsVisible=!0},d.hidePreview=function(){d.dropup=!1,d.previewValue=null,d.previewIsVisible=!1},d.$onDestroy=function(){d.unbindSelectboxToggleListener(),d.translateChangeSuccessHandler()}}e.$inject=["$q","$timeout","$element","$rootScope","_","CONSTANT","router","interfaces","policies"],angular.module("keenetic").component("ndmPolicySelect",{transclude:!0,templateUrl:"app/components/ndm-policy-select/ndm-policy-select.html",require:"ngModel",bindings:{isDisabled:"<",name:"@",label:"@",value:"=",noDenyPolicy:"<?",initialData:"<?"},controller:e})}(),function(){function e(e,t){var n=Boolean(t.pingcheck),i="default",a={NONE:"none",ICMP:"icmp",TCP:"connect",DEFAULT:i},o={mode:a.NONE,interval:10,fails:5,host:"",port:""},s=function(t,n){var i=[];return e.forEach(n,function(e,n){l(e)===t&&i.push(n)}),i};return{constant:{PINGCHECK_INSTALLED:n,PINGCHECK_MODE:a,DEFAULT_PROFILE_NAME:i},getFormDataPrototype:r,getFormDataFromRawData:function(t,n){var s=l(t),c=n[s]||{};return s===i?angular.extend(r(),{mode:i,profileName:i}):{host:e.get(c,["host",0],o.host),interval:e.get(c,"update-interval.seconds",o.interval),mode:c.mode||o.mode,port:c.port||o.port,fails:e.get(c,"max-fails.count",o.fails),profileName:c.mode===a.NONE?"":s}},getSavingQueries:function(t,o,s,r){if(!n)return[];var p=[],u=r[o]&&l(r[o])||!1;u===i&&(u=!1);t&&t.mode!==a.NONE||!s||p.push(d(o,!1));t&&t.mode!==a.NONE&&t.mode!==i||u&&!function(t,n,i){return e.some(n,function(e,n){return n!==i&&l(e)===t})}(u,r,o)&&p.push(c(u,{no:!0}));t.mode===i?p.push(d(o,i)):t&&t.mode!==a.NONE||!s||p.push(d(o,!1));if(!t||t.mode===a.NONE||t.mode===i)return e.uniqWith(p,e.isEqual);var m=u||"_WEBADMIN_"+o,f={host:[t.host],"update-interval":{seconds:Number(t.interval)||5},mode:t.mode,"max-fails":{count:t.fails||3}};t.mode===a.TCP&&(f.port=Number(t.port));return p.push(c(m,f)),p.push(d(o,m)),p},getClearPingcheckQueries:function(e,t){if(!t[e])return[];var n=l(t[e]),a=s(n,t),o=[d(e,!1)];return n!==i&&1===a.length&&a[0]===e&&o.push(c(n,{no:!0})),o},getIfacesUsingProfile:s};function r(){return e.extend({},o)}function l(e){return(angular.isString(e)?e:e&&e["ping-check"]&&e["ping-check"].profile)||!1}function c(t,n){return e.set({},["ping-check","profile",t],n)}function d(t,n){return i=t,a=e.set({},"ping-check.profile",n||{no:!0}),e.set({},["interface",i],a);var i,a}}e.$inject=["_","components"],angular.module("keenetic").factory("pingcheckModel",e)}(),function(){function e(e){return{restrict:"E",templateUrl:"app/components/ndm-pingcheck/ndm-pingcheck.html",transclude:!0,replace:!0,link:function(t){var n=t,i=e.constant.PINGCHECK_MODE;n.PINGCHECK_MODE=i,n.namePrefix=n.namePrefix||"pingcheck.",n.options={modes:[{id:i.NONE,name:"pingcheck.modes.none"},{id:i.ICMP,name:"pingcheck.modes.icmp"},{id:i.TCP,name:"pingcheck.modes.connect"},{id:i.DEFAULT,name:"pingcheck.modes.default"}]}},scope:{isDisabled:"<",data:"=",namePrefix:"@?",description:"@?",label:"@?"}}}e.$inject=["pingcheckModel"],angular.module("keenetic").directive("ndmPingcheck",e)}(),function(){t.$inject=["$timeout","$window"],angular.module("keenetic").directive("ndmPathOverflow",t);var e=300;function t(t,n){return{templateUrl:"app/components/ndm-path-overflow/ndm-path-overflow.html",transclude:!1,replace:!0,link:function(i,a){var o={base:!1,directory:!1,volume:!1},s={base:0,directory:0,volume:0},r=0,l=14;function c(e,t){e&&angular.element(e).css("width",!0===t?"auto":Number(t)+"px")}i.width=i.width||e,i.$watchGroup(["width","path"],function(d){r=Number(d[0])?Number(d[0])-4:e,c(a[0],r+2),i.parts=function(e){var t,n=e.replace(/\/$/,"").split(/:\//,2),i=n[n.length-1].split(/\//),a=2===n.length?n[0]:"",o=i.pop();t=i.length>0?(a?":/":"/")+i.join("/"):"";return{volume:a,base:o=(a||t?t?"/":":/":"")+o,directory:t}}(d[1]),t(function(){!function(){var e=[],t=a.find("div");l=12;for(var r=0;r<t.length;r++){e.push(t[r].offsetWidth);var c=parseInt(n.getComputedStyle(t[r]).fontSize,10);!isNaN(c)&&c&&(l=c)}o={base:!1,directory:!1,volume:!1},(s={volume:0,directory:0,base:0}).base=e[t.length-1],o.base=t[t.length-1],i.parts.directory&&(s.directory=e[i.parts.volume?1:0],o.directory=t[i.parts.volume?1:0]);i.parts.volume&&(s.volume=e[0],o.volume=t[0])}(),function(){var e=s.base+s.directory+s.volume,t=1.8*l;if(e<=r)c(o.base,!0),c(o.directory,!0),c(o.volume,!0);else{var n=r-s.volume-s.base;if(n<t&&(n=s.directory?t:0),c(o.directory,n),n<=t){var i=(r-n)/(s.volume+s.base),a=s.volume*i,d=Math.ceil(s.base*i);c(o.base,d),c(o.volume,a)}else c(o.base,!0),c(o.volume,!0)}}()})})},scope:{path:"@",width:"@"}}}}(),function(){function e(e,t){return{templateUrl:"app/components/ndm-page-header/ndm-page-header.html",link:function(n,i){var a=i.parent().parent()[0],o=[];n.isShadowVisible=!1,n.isPopupOpen=!1,n.$watch("progress",function(){n.isShadowVisible=n.progress<100,n.progress>=100&&e.$broadcast(t.events.PAGE_REDRAW)}),o.push(e.$watch("isPopupOpen",function(e){n.isPopupOpen=e})),n.$on("$destroy",function(){return o.forEach(function(e){return e()})}),a.addEventListener("scroll",function(){n.isShadowVisible=a.scrollTop>0,"$apply"!==n.$root.$$phase&&"$digest"!==n.$root.$$phase&&n.$apply()})},replace:!0,scope:{title:"@label",description:"@",webhelpId:"@?",progress:"<",webhelpText:"@?"}}}e.$inject=["$rootScope","CONSTANT"],angular.module("keenetic").directive("ndmPageHeader",e)}(),function(){function e(e,t,n,i,a,o,s,r,l,c,d){return{templateUrl:"app/components/ndm-page/ndm-page.html",transclude:!0,replace:!0,link:function(p,u){d.checkAcceptance(),p.isLoad=!0;var m=function(){t.title=s.formatPageTitle(p.title||n.current.menuTitle)};m(),p.$on("$destroy",t.$on("$translateChangeSuccess",function(){return e(m)})),t.currentScope=p.$parent,r.isPc||a.scrollTo(0,0);var f=p.$watch("progress",function(){p.progress<80?p.headerProgress=p.progress-20:p.progress>=100&&(p.headerProgress=85,p.isLoad=!1,e(function(){p.headerProgress=99.9,e(function(){p.headerProgress=100,f(),t.$broadcast(o.events.PAGE_LOADED);var e=i[0].querySelector("#page-top");e&&e.focus(),l.startPeriodicNotifications(!0)},200)},200))});p.noLeaveWatcher||p.$on("$destroy",c.watchPageLeave(u))},scope:{noScroll:"<",noLeaveWatcher:"<",title:"@label",description:"@",progress:"<",webhelpText:"@?"}}}e.$inject=["$timeout","$rootScope","$state","$document","$window","CONSTANT","utils","browserCheck","securityNotification","formChangesChecker","licensesService"],angular.module("keenetic").directive("ndmPage",e)}(),function(){function e(e,t,n,i,a,o,s){var r="ndm-notification",l=[],c=[],d={},p=function(t){var n=r+":"+t,a={timeout:3e3,autoHide:!0,message:"",header:!1};return l.push(n),function(t,o){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:i.noop;return angular.isString(t)&&(t={message:t}),angular.isDefined(o)&&(t.timeout=o),(t=angular.extend({},a,t)).autoHide=t.timeout>0,t.uid=s.getUniqueId(),t.stateName=e.current.name,t.onClose=r||i.noop,f(n,t),t.uid}},u=!1,m=[];function f(e,n){u?t.$broadcast(e,n):m.push([e,n])}t.$on("$destroy",t.$on("ndm-notifications-container-initialized",function(){u=!0,m.forEach(function(e){t.$broadcast(e[0],e[1])}),m=[]})),t.$on("$destroy",t.$on("ndm-notifications-container-destroyed",function(){u=!1}));var g,v={ERROR:"error",WARNING:"warning",INFO:"info",SUCCESS:"success",SECURITY:"security"};d.error=p(v.ERROR),d.warning=p(v.WARNING),d.info=p(v.INFO),d.success=p(v.SUCCESS),d.security=p(v.SECURITY);g=r+":hide",c.push(g),d.hide=function(e){f(g,e)};return g=r+":hideAll",c.push(g),d.hideAll=function(){f(g)},d.PREFIX=r,d.SHOW_EVENTS=l.slice(),d.HIDE_EVENTS=c.slice(),d.NOTIFICATION_TYPE=v,d._CONTAINER_CREATED_EVENT="ndm-notifications-container-initialized",d._CONTAINER_DESTROYED_EVENT="ndm-notifications-container-destroyed",d.showNotificationOncePopupIsClosed=function(e,o,s){var r=t.$on(a.events.POPUP_CLOSED,function(){r(),n(function(){i.invoke(d,e,o,s)})})},t.$on("$translateChangeSuccess",function(){return d.hideAll()}),d}e.$inject=["$state","$rootScope","$timeout","_","CONSTANT","env","utils"],angular.module("keenetic").factory("notification",e)}(),function(){function e(e,t,n,i,a,o,s,r,l,c,d){return{templateUrl:"app/components/ndm-notification/ndm-notification-container.html",replace:!0,transclude:!1,link:function(a,p,u){if(a.notifications=[],a.closeFns={},a.queue=[],a.areClosing={},"widthSameAs"in u){var m=function(){for(var t=p;t&&!t.hasClass(u.widthSameAs);)t=t.parent();t&&e(function(){return function t(n){var i=getComputedStyle(n[0]).width;-1!==i.indexOf("%")&&(i=n[0].clientWidth);0===Number(i)?e(function(){return t(n)}):p.css("width",i)}(t)})};e(m),r(m,a)}e(function(){o.$broadcast(d._CONTAINER_CREATED_EVENT)},100),a.$on("$destroy",function(){o.$broadcast(d._CONTAINER_DESTROYED_EVENT)});var f=function(e,t,n){return parseInt(e[t].replace("px"),10)||n},g=function(e){var t=parseInt(e[0].offsetHeight,10);if(e.lineCount<3)return t;var n=getComputedStyle(e[0].querySelector(".ndm-notification__body-msg--valigned")),i=f(n,"height"),a=f(n,"line-height"),o=[t,i,a*(e.lineCount+1)-2];return o.sort(),o[0]-o[1]>20?o[0]:o[1]},v=function(e,t){e&&e.css("top",t+"px")},h=function(e,t,n,i){var a,o,s=e,r=t.length-1;if(i){for(o=r;o>=n;--o)s+=g(t[o]);for(o=n-1;o>=0;--o)a=t[o],v(a,s),s+=g(a)}else for(o=r;o>=n;--o)a=t[o],v(a,s),s+=g(a)},b=angular.element(p[0].querySelector(".ndm-notifications-container__wrapper")),_="<div>{{::message}}</div>",y=t.get("app/components/ndm-notification/ndm-notification.html");y?_=angular.isArray(y)?y[1]:y:i.get("app/components/ndm-notification/ndm-notification.html",{cache:t}).then(function(e){_=e.data});var S=c.getRateLimitedFunction(function(t,i,o){var s=t,r=s.msgId,c=l.find(a.notifications,function(e){return e.msgId===r});if(c)return c.to&&e.cancel(c.to),c.to=t.autoHide&&e(a.closeFns[c.uid],t.timeout),void(t=c);var d=angular.extend(a.$new(),t,{type:i}),p=n(_)(d),u=function(t,n,i){return function(o){if(o&&o.stopImmediatePropagation(),!a.areClosing[t.uid]){var s=a.notifications.indexOf(t),r=t.uid,c=-1*g(t),d=t.type,p=t.message,u=t.onClose;a.areClosing[r]=!0,t.addClass(i),h(c,a.notifications,s+1,!0),e(function(){t.remove(),a.notifications.splice(a.notifications.indexOf(t),1),a.areClosing[r]=!1,n.$destroy(),u(p,d,r),l.invoke(a,"onNotificationClose",p,d,r),delete a.closeFns[r]},500)}}}(p,d,o);p.addClass("ndm-notification--"+i),p.uid=t.uid,p.stateName=t.stateName,p.msgId=r,p.closeFn=u,p.type=i,p.onClose=t.onClose||l.noop,p.message=t.message,p.lineCount=t.message.split(/\r\n|\r|\n/).length,d.close=u,a.closeFns[d.uid]=u,t.autoHide&&(p.to=e(u,t.timeout)),b.append(p),v(p,-100),a.notifications.push(p),e(function(){h(g(p),a.notifications.slice(0,a.notifications.length-1),0),v(p,0)})},100);d.SHOW_EVENTS.forEach(function(e){a.$on("$destroy",o.$on(e,function(t,n){var i=l.isArray(a.notificationTypesToIgnore)?a.notificationTypesToIgnore:[];if(s.current.name===n.stateName){var o=e.split(":")[1];if(!l.includes(i,o)){var r=o+"__"+n.message;S(Object.assign({},n,{type:o,msgId:r}),o,"hiding")}}}))});var w=function(){a.queue=[];for(var e=a.notifications.length-1;e>=0;--e)a.closeFns[a.notifications[e].uid]()};a.$on("$destroy",o.$on(d.PREFIX+":hideAll",w)),a.$on("$destroy",w),a.$on("$destroy",o.$on(d.PREFIX+":hide",function(e,t){t in a.closeFns&&a.closeFns[t]()})),a.getHeight=function(){var e=a.notifications.reduce(function(e,t){return e+g(t)},0);return{height:e>0?e+"px":"0"}}},scope:{notificationTypesToIgnore:"<",onNotificationClose:"<",widthSameAs:"&"}}}e.$inject=["$timeout","$templateCache","$compile","$http","$window","$rootScope","$state","windowResizeWatcher","_","utils","notification"],angular.module("keenetic").directive("ndmNotificationsContainer",e)}(),function(){n.$inject=["_"];var e="ndw-model",t=["ngModel","model","value"];function n(n){return{restrict:"A",link:function(i,a,o){if(!(o[e]||o.ngModel&&a[0].childElementCount<1)){var s=o[n.find(t,function(e){return o[e]})];if(s){var r=s.replace(/\[(.+)\]/g,function(e){return"."+i.$eval(e.substr(1,e.length-2))});a[0].setAttribute(e,r)}}}}}t.forEach(function(e){angular.module("keenetic").directive(e,n)})}(),function(){angular.module("keenetic").directive("ndmMwsAnimation",function(){return{templateUrl:"app/components/ndm-mws-animation/ndm-mws-animation.html",restrict:"E",replace:!0,transclude:!1,require:"^ngModel",isFinalStage:!1}})}(),function(){function e(e,t){return{templateUrl:"app/components/ndm-multi-input-table/ndm-multi-input-table.html",restrict:"E",replace:!0,transclude:!1,require:"^ngModel",scope:{max:"@?",extraValidator:"=?",disabled:"<?",validation:"@?",description:"@?",header:"@?",addCaption:"@?",emptyMessage:"@?",flushCaption:"@?",flushConfirm:"@?"},link:function(n,i,a,o){n.values=[],n.max=parseInt(n.max,10),(isNaN(n.max)||n.max<=0)&&(n.max=128);o.$viewValue=c(o.$viewValue),o.$setPristine(),o.$formatters.push(c),o.$render=function(){n.values=angular.copy(o.$viewValue)},n.editingKey=!1;var s="",r=!1;function l(){o.$setViewValue(angular.copy(n.values))}function c(e){return(angular.isArray(e)?angular.copy(e):[]).map(String)}n.editItem=function(e){if(n.editingKey!==e){if(!1!==n.editingKey&&!n.submitEdit())return;r=!1,n.editingKey=e,s=n.values[e]}},n.submitEdit=function(){return!1===n.editingKey||!(n.subform.$invalid||!n.values[n.editingKey])&&(l(),n.editingKey=!1,!0)},n.cancelEdit=function(){!1!==n.editingKey&&(r?n.values.splice(n.editingKey,1):n.values[n.editingKey]=s,n.editingKey=!1,l())},n.removeItem=function(e){n.editingKey===e?n.editingKey=!1:!1!==n.editingKey&&n.editingKey>e&&n.editingKey--,n.values.splice(e,1),l()},n.addItem=function(){n.submitEdit()&&(n.values.push(""),n.editItem(n.values.length-1),r=!0)},n.onFlushButtonClicked=function(){e.confirm(n.flushConfirm||"multi-input-table.flush-confirm").then(function(){n.cancelEdit(),n.values=[],l()})},n.onKeydown=function(e){if(!t.isSpace(e))return!0;e.stopPropagation(),e.preventDefault(),n.onFlushButtonClicked()}}}}e.$inject=["modal","keyboard"],angular.module("keenetic").directive("ndmMultiInputTable",e)}(),function(){function e(e,t,n,i,a,o,s,r,l,c){return new function(){var d=this;d.confirm=function(e,t,n){if(i.USER_IS_READONLY)return a.when(!0);var o=a.defer();return c.blurActiveElement(),d.showModal({currentState:r.current,templateUrl:"app/components/ndm-modal/confirm.html",controller:"ConfirmController",inputs:{text:e||"sure",confirmText:t||"confirm",cancelText:n||"cancel"}}).then(function(e){e.close.then(function(e){return e?o.resolve():o.reject()})}),o.promise},d.confirmLeave=function(e,t){var n=a.defer();return d.confirm(t||"confirm-cancelling-changes","stay-leave.leave","stay-leave.stay").then(function(){(e||angular.noop)(),s(function(){n.resolve(!0)})},function(){n.resolve(!1)}),n.promise},d.alert=function(e,t){var n=a.defer();return c.blurActiveElement(),d.showModal({templateUrl:"app/components/ndm-modal/alert.html",controller:"AlertController",inputs:{text:e||"",confirmText:t||"OK"}}).then(function(e){e.close.then(function(){n.resolve()})}),n.promise};var p=function(e,t){return e.append(t)};d.showModal=function(c){var d=angular.element(e[0].body),u=a.defer();return c.controller?(function(e,t){var n=a.defer();return e?n.resolve(e):t?o(t,!0).then(function(e){n.resolve(e)},function(e){n.reject(e)}):n.reject("No template or templateUrl has been specified."),n.promise}(c.template,c.templateUrl).then(function(e){var o=(c.scope||i).$new(),m=[l.onBefore({},function(e){return o.currentTransition=e,!0}),l.onFinish({},function(){return w(!1)}),l.onError({},function(){return w(!1)})],f=i.$on("$locationChangeSuccess",function(e){var t=r.current.name;o.currentTransition&&(t=o.currentTransition.to().name),c.currentState&&t===c.currentState.name?e.preventDefault():(m.forEach(function(e){return e()}),w(!1))}),g=a.defer(),v=a.defer(),h={$scope:o,close:function(e,t){(angular.isUndefined(t)||null===t)&&(t=0),s(function(){w(e)},t)}};i.uiViewOverlap=!0,c.inputs&&angular.extend(h,c.inputs);var b=t(e)(o);h.$element=b;var _=o[c.controllerAs],y=n(c.controller,h,!1,c.controllerAs);c.controllerAs&&_&&angular.extend(y,_),c.appendElement?p(c.appendElement,b):p(d,b);var S={controller:y,scope:o,element:b,close:g.promise,closed:v.promise};function w(e){if(g&&g.resolve)return g.resolve&&g.resolve(e),a.when(b.remove()).then(function(){v.resolve(e),o&&o.$destroy&&o.$destroy(),h&&(h.close=null),u=null,g=null,S=null,h=null,b=null,o=null}).finally(function(){i.modalConfirm&&(i.modalConfirm.open=!1),i.uiViewOverlap=!1}),m.forEach(function(e){return e()}),f&&f(),!0}u.resolve(S)}).then(null,function(e){u.reject(e)}),u.promise):(u.reject("No controller has been specified."),u.promise)}}}e.$inject=["$document","$compile","$controller","$rootScope","$q","$templateRequest","$timeout","$state","$transitions","utils"],angular.module("keenetic").factory("modal",e)}(),function(){function e(e,t,n,i){var a=this;return{showMwsModal:function(){var o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:n.noop;if(a.alreadyOpened)return e.when(!0);a.alreadyOpened=!0;var s=e.defer();return t(function(){i.showModal({templateUrl:"app/page/controlPanel/myNetwork/wifiSystem/ndm-mws-modal/ndm-mws-modal.html",controller:"NdmMwsModalController",controllerAs:"vm",inputs:{callOnClose:o}}).then(function(e){e.close.then(function(e){e?s.resolve(!0):s.reject(!1),a.alreadyOpened=!1})})}),s.promise}}}e.$inject=["$q","$timeout","_","modal"],angular.module("keenetic").factory("modalFactory",e)}(),function(){function e(e,t,n,i,a,o,s,r,l){var c=e;c.text=t,c.confirmText=n,c.cancelText=i,o.modalConfirm||(o.modalConfirm={open:!1}),o.modalConfirm.open=!0,r(function(){var e=s[0].querySelector(".action-link");e&&e.focus()}),c.closeOnSpace=function(e){return!l.isSpace(e)||(e.preventDefault(),e.stopPropagation(),a(!1))},c.close=function(e){return o.modalConfirm.open=!1,a(e)}}e.$inject=["$scope","text","confirmText","cancelText","close","$rootScope","$element","$timeout","keyboard"],angular.module("keenetic").controller("ConfirmController",e)}(),function(){function e(e,t,n,i,a,o,s){var r=e;r.text=t,r.confirmText=n,a.modalConfirm||(a.modalConfirm={open:!1}),s(function(){var e=o[0].querySelector(".btn");e&&e.focus()}),a.modalConfirm.open=!0,r.close=function(){a.modalConfirm.open=!1,i(!0,50)}}e.$inject=["$scope","text","confirmText","close","$rootScope","$element","$timeout"],angular.module("keenetic").controller("AlertController",e)}(),function(){angular.module("keenetic").directive("ndmMeter",function(){return{templateUrl:"app/components/ndm-meter/ndm-meter.html",replace:!0,transclude:!0,link:function(e,t,n){n.$observe("ndmMeter",function(t){isNaN(parseInt(t,10))||(e.level=t)}),isNaN(parseInt(e.level,10))&&(e.level=0)},scope:{level:"@"}}})}(),function(){function e(e,t,n,i,a,o,s,r,l,c,d,p,u,m,f,g,v,h,b,_){var y=this,S=o.events,w=S.REFRESH_MENU,C=S.MENU_TOGGLE,E=S.MENU_OPENED,I=S.MENU_CLOSED,T=S.MENU_OPEN_TRANSITION_END,k=S.MENU_CLOSE_TRANSITION_END,P={"controlPanel.sms":["hasNewSms","isHidden"],"controlPanel.ussd":["isHidden"]};y.isOpen=!1,y.openedGroups={},y.isOverlay=!1,y.qmiRoutesHidden=!(r.usbqmi&&Boolean(s.INTERNAL_LTE_ID)),y.newSmsAvailable=!1,e.menuIsOpen=!1,e.menuIsOpenOverlayed=!1;var A=function(){l.forEach(y.menuHierarchy,function(e){e.isActive=Boolean(l.find(e.points,{sref:a.current.name}))})},D=function(e){y.menuHierarchy={};var t={};for(var n in e)e[n].header?(y.menuHierarchy[n]=e[n],(t=e[n]).points={}):t.points[n]=e[n];x("isHidden",y.qmiRoutesHidden),x("hasNewSms",y.newSmsAvailable);var i=[],a={},p=null;l.forEach(e,function(e){if(e.isSegment){var t=l.get(e,"srefParams.tab");p||e.isHomeSegment||(p=t),t&&(a[t]=Object.assign({},e),i.push(t))}}),d.updateStateSearchData("controlPanel.segments",function(e){if(e.parametrized=i.map(function(e){var t=r.corewireless?["wifi-settings.form.psk.label","wifi-settings.form.security-protocol.label"]:[];return{texts:[e].concat(t),routeParams:{tab:e}}}),p){var t=s.sysmode===o.SYSMODE.ROUTER&&r.chilli?["title","description"].map(function(e){return"segments.chilli.".concat(e)}):[];t.push("segments.section.restrictions.header"),e.parametrized.push({texts:t,title:p,routeParams:{tab:p}})}return e});var u=function(e){return c.getTranslation("segments.wifi-popup-header",null,{band:f.getAllBandsL10n(!1)[e.band],segment:e.tab})};d.updateStateSearchData("controlPanel.segments.WiFi",function(e){return e.parametrized=l.flatMap(a,function(e,t){var n=[u],i=[];return e.isHomeSegment&&i.push("wifi-settings.form.enable-tx-burst.label","wifi-settings.form.standard","wifi-settings.form.channel","wifi-settings.form.signal-power","wifi-settings.form.country-code","channel-width"),e.wifiBands.map(function(e){var a=function(e,t){var n=e===f.WIFI_BAND_2_GHZ?c.getTranslation("wifi.header2"):c.getTranslation("wifi.header5");return t.reduce(function(e,t){var i=c.getTranslation(t),a="".concat(i," (").concat(n,")");return Object.assign({},e,_defineProperty({},a,i))},{})}(e,i);return{routeParams:{band:e,tab:t},customReadyEvent:f.events.ADVANCED_SETTINGS_POPUP_READY,texts:n,substitutes:a}})}),e}),A()};y.toggle=function(){y.isOpen?(y.isOverlay||L.set(!1),O.closeMenu()):O.openMenu()},y.toggleBySeparatorClick=function(){y.isOpen?O.closeMenu():O.openMenu(l.findKey(y.menuHierarchy,{isActive:!0})||"")},y.toggleGroup=function(e){y.isOpen?y.openedGroups.all||(y.openedGroups=_defineProperty({},e,!0)):O.openMenu(e)},y.logout=function(){return u.logout().then(function(){m.disableLogoutAlert(),m.reset(),i.location="/"})};var O=new(function(){function t(){_classCallCheck(this,t),this.previousWindowWidth=this.getWindowWidth()}return _createClass(t,[{key:"openMenu",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";y.openedGroups=t?_defineProperty({},t,!0):{all:!0},y.isOpen=!0,y.isOverlay=!y.openedGroups.all||this.getWindowWidth()<=1180,e.menuIsOpen=!0,e.menuIsOpenOverlayed=y.isOverlay,y.isOverlay||L.set(!0),e.$broadcast(E,e.menuIsOpenOverlayed)}},{key:"closeMenu",value:function(){y.openedGroups={},y.isOpen=!1,y.isOverlay=!1,e.menuIsOpen=!1,e.menuIsOpenOverlayed=!1,e.$broadcast(I)}},{key:"onWindowResize",value:function(){var e=this.getWindowWidth(),t=this.previousWindowWidth,n=e>1180&&t<=1180,i=e<=1180&&t>1180,a=e<=768&&t>768,o=t<=768&&e>768;this.previousWindowWidth=e,n&&!y.isOpen&&L.get()?this.openMenu():n&&y.isOpen&&y.isOverlay&&y.openedGroups.all?this.openMenu():a&&y.isOpen?this.closeMenu():o&&!n&&y.isOpen?this.closeMenu():i&&y.isOpen&&!y.isOverlay&&this.closeMenu()}},{key:"onInit",value:function(){this.getWindowWidth()>1180&&L.get()&&this.openMenu()}},{key:"getWindowWidth",value:function(){return i.innerWidth}},{key:"onTransition",value:function(){y.isOverlay&&this.closeMenu()}}]),t}()),N=function(){return p.getMenu().then(function(e){return D(e)})},L={LOCAL_STORAGE_ITEM_ID:"ndm-menu-state",DEFAULT_STATE:!0,set:function(e){b.setItem(L.LOCAL_STORAGE_ITEM_ID,e?"opened":"")},get:function(){var e=b.getItem(L.LOCAL_STORAGE_ITEM_ID);return l.isUndefined(e)?L.DEFAULT_STATE:Boolean(e)}};y.languages={current:c.getCurrentLanguage(),list:c.getLanguageOptionsList(),change:function(){v(function(){return c.changeLanguage(y.languages.current)})}},y.$postLink=function(){angular.element(t[0].querySelector(".ndm-menu")).on("transitionend",function(t){"width"===t.propertyName&&e.$broadcast(y.isOpen?T:k)})},n.$on("$destroy",n.$on(w,function(){return N()})),n.$on("$destroy",n.$on(C,function(){return y.toggle()})),n.$on("$destroy",h(function(){return O.onWindowResize()})),n.$on("$destroy",g.onFinish({},function(){return A()})),n.$on("$destroy",g.onStart({},function(){return O.onTransition()})),n.$on("$destroy",function(){return O.closeMenu()}),N().then(function(){return O.onInit()});var x=function(e,t){var n=l.pickBy(P,function(t){return t.includes(e)});l.forEach(n,function(n,i){var a=l.get(y.menuHierarchy,["menu.myInternet","points",i],!1);a&&(a[e]=t)})};_.addQmiInterfacesListUpdateCallback(function(e){y.qmiRoutesHidden=0===e.length,x("isHidden",y.qmiRoutesHidden)}),_.addSmsListsUpdateCallback(function(e){y.newSmsAvailable=e,x("hasNewSms",y.newSmsAvailable)})}e.$inject=["$rootScope","$element","$scope","$window","$state","CONSTANT","NDM","components","_","utils","search","menuService","authenticationService","router","wifiOptions","$transitions","$timeout","windowResizeWatcher","localStorage","smsStatus"],angular.module("keenetic").component("ndmMenu",{templateUrl:"app/components/ndm-menu/ndm-menu.html",restrict:"E",replace:!0,controller:e,controllerAs:"vm"})}(),function(){function e(e){return{require:"^ngController",templateUrl:"app/components/ndm-list/ndm-list.html",replace:!0,link:function(t,n,i){t._onClick=angular.noop,e(function(){t._onClick=i.onClick&&angular.isFunction(t.onClick())?t.onClick():angular.noop})},scope:{infoObj:"=",onClick:"&"}}}e.$inject=["$timeout"],angular.module("keenetic").directive("ndmList",e)}(),function(){function e(e,t,n){var i=this,a=function(){return i.linkElement.blur()};i.onKeydown=function(t){if(e.isSpace(t))return t.preventDefault(),t.stopPropagation(),(angular.isFunction(i.onClick)?i.onClick:angular.noop)(),i.blurOnClick&&a(),!0},i.$postLink=function(){i.linkElement=t[0].querySelector("a")},i.$onChanges=function(e){e.isDisabled&&n[0].activeElement===i.linkElement&&!e.isDisabled.isFirstChange()&&e.isDisabled.currentValue&&a()}}e.$inject=["keyboard","$element","$document"],angular.module("keenetic").component("ndmLink",{templateUrl:"app/components/ndm-link/ndm-link.html",transclude:!0,bindings:{label:"@",hrefParam:"@?",isDisabled:"<",onClick:"&",linkClass:"@",blurOnClick:"<"},controller:e})}(),function(){function e(e,t,n,i,a,o,s){var r=this,l=function(e){return r.height-e},c=function(e){return!isNaN(e)&&e>1},d="ndm-line-chart__chart-point",p="ndm-line-chart__chart-point--closest",u="ndm-line-chart__tooltip",m="ndm-line-chart__cursor-line",f=0,g=8,v=8,h=4,b={isVisible:!0,noTicks:!1,noLabels:!1,noAxisLine:!1,labelFormatFn:angular.identity,labels:[]};r.shift={xTick:s.isFirefox?-6:0,xTickY:l(-20),yTick:s.isFirefox?-5:-10,tooltipXShift:s.isFirefox?-8:0},r.yTickContainer={x:130,width:60,height:20},r.isFirefox=s.isFirefox,r.yTickLength=8,r.xTickLength=8,r.points=[],r.toSvgY=l,e.toSvgY=l;var _=function(e,t,n){if(n<2)return[e,t];for(var i=(t-e)/(n-1),a=[],s=e,r=0;r<n;++r)a.push(s),s+=i;return a.map(function(e){return o.round(e,1)})},y=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=angular.extend({controlPointModifierFn:angular.identity,curveSmoothFactor:.1,factorX:1,factorY:1},t),i=function(e,t,i){var a,o,s,r,l=arguments.length>3&&void 0!==arguments[3]&&arguments[3],c=(a=t||e,s=(o=i||e).x-a.x,r=o.y-a.y,{length:Math.sqrt(Math.pow(s,2)+Math.pow(r,2)),angle:Math.atan2(r,s)}),d=c.angle+(l?Math.PI:0),p=c.length*n.curveSmoothFactor;return n.controlPointModifierFn({x:e.x+Math.cos(d)*p,y:e.y+Math.sin(d)*p})};return e.map(function(e){return{x:e.x*n.factorX,y:e.y*n.factorY}}).reduce(function(e,t,n,a){return 0===n?"M ".concat(t.x,",").concat(t.y):"".concat(e," ").concat(function(e,t,n){var a=i(n[t-1],n[t-2],e),o=i(e,n[t-1],n[t+1],!0);return"C ".concat(a.x,",").concat(a.y," ").concat(o.x,",").concat(o.y," ").concat(e.x,",").concat(e.y)}(t,n,a))},"")},S=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=l(0),a=[],o="",s=0,r=i;return e.forEach(function(e,c){s=e.x*t,r=l(e.y*n),0===c&&(o+="".concat(s,",").concat(i," "),s<5&&(o+="-1,".concat(r," "))),o+="".concat(s,",").concat(r," "),a.push({x:s,y:r,vx:e.x,vy:e.y})}),o+=" ".concat(s,",").concat(r," ").concat(s,",").concat(i),{points:a,contour:o}},w=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=l(0),a=[],o=[{x:0,y:i}];return e.forEach(function(e){var i=e.x*t,s=l(e.y*n);o.push({x:e.x*t,y:l(e.y*n)}),a.push({x:i,y:s,vx:e.x,vy:e.y})}),o.push({x:o[o.length-1].x,y:i}),{points:a,contour:y(o,{controlPointModifierFn:function(e){return{x:e.x,y:Math.min(i,e.y)}},curveSmoothFactor:r.curveSmoothFactor})}},C=function(e,t,n){var o,s=i[0].createElementNS("http://www.w3.org/2000/svg",e),l=function(e){return a.forEach(e||{},function(e,t){s.style[t]=e}),o},c=function(e,t){"style"===t&&angular.isObject(e)?l(e):s.setAttributeNS(null,t,e)},d=function(e){return c(e?"inherit":"hidden","visibility"),o};return o={element:s,attr:function(e,t){return c(t,e),o},style:l,remove:function(){s.remove()},show:function(){return d(!0)},hide:function(){return d(!1)},bubbleUp:function(){return r.svgEl.appendChild(s),o}},angular.forEach(t,c),n.appendChild(s),o},E=function(e){var t=r.curveSmoothFactor?w:S,n=[],i=[],s=[];(angular.isArray(e)?e:[e]).forEach(function(e){var t=e.data,o=a.maxBy(t,"y").y,s=a.maxBy(t,"x").x;i.push(s),n.push(o)});var l,c,p,u=a.max(n),m=a.max(i),g=(l={min:0,max:r.height},c={min:0,max:u},p=r.yAxisOptions.tickNum,{distance:o.round((l.max-l.min)/(p-1),1),coords:_(l.min,l.max,p),labels:angular.isArray(c)?c:_(c.min,c.max,p)});r.yAxisOptions.tickCoords=g.coords.reverse(),r.yAxisOptions.labels=g.labels,r.yAxisOptions.tickDistance=g.distance,r.currMaxY=u,r.currMaxX=m,e.forEach(function(e){var n=e.data;s.push(a.extend(t(n,r.width/r.currMaxX,r.currMaxY?r.height/r.currMaxY:1),{colorId:e.colorId||f,originalData:n,name:e.name}))}),r.charts=s,r.points.forEach(function(e){e.forEach(function(e){e.remove()})}),r.points=[],r.charts.forEach(function(e){var t=[];e.points.forEach(function(n){t.push(C("circle",{cx:n.x,cy:n.y,r:r.pointRadius,class:"".concat(d," ").concat(d,"--").concat(e.colorId)},r.svgEl))}),r.points.push(t)}),r.mouseIsOver&&(r.lineEl.bubbleUp(),r.$tooltipEl.updateState(r.$tooltipEl.lastPos.x,r.$tooltipEl.lastPos.y))},I=function(e){e=angular.extend({tickNum:g},b,e||{});var t=!1;return angular.isArray(e.labels)&&c(e.labels.length)?e.tickNum=e.labels.length:t=!0,e.tickCoords=_(0,r.width,e.tickNum),t&&(e.labels=e.tickCoords.slice()),e};r.$onInit=function(){r.currMaxX=0,r.currMaxY=0,r.pointRadius=!isNaN(r.pointRadius)&&r.pointRadius>0?r.pointRadius:h,r.idPrefix=r.idPrefix||"",r.xAxisOptions=I(r.xAxisOptions),r.yAxisOptions=angular.extend({tickNum:v,noHorizontalLines:!1},b,r.yAxisOptions||{}),r.yAxisOptions.tickNum=c(r.yAxisOptions.tickNum)?r.yAxisOptions.tickNum:v,r.yAxisOptions.tickCoords=_(0,r.height,r.yAxisOptions.tickNum),r.yAxisOptions.labels=r.yAxisOptions.tickCoords.slice().reverse()},r.$postLink=function(){r.svgEl=t[0].querySelector("svg");var e=t[0].querySelector(".".concat(u));if(r.svgEl){var n=r.svgEl.createSVGPoint();r.$tooltipEl=angular.element(e),r.$tooltipEl.lastPos={x:0,y:0},r.$tooltipEl.offset={x:-200,y:0},r.$tooltipEl.closestPoints=[],r.$tooltipEl.setPos=function(e,t){var n=r.$tooltipEl;return n.css({left:a.isNumber(e)?e+n.offset.x+"px":e,top:a.isNumber(t)?t+n.offset.y+"px":t}),n},r.$tooltipEl.show=function(){var e=r.$tooltipEl;return e.css("visibility","inherit"),e},r.$tooltipEl.hide=function(){var e=r.$tooltipEl;return e.css("visibility","hidden"),e},r.$tooltipEl.updateState=function(e,t){var n=r.$tooltipEl;return n.lastPos={x:e,y:t},n.setPos(e,t),n.highlightClosestPoints(),n.updateData(),n},r.$tooltipEl.updateData=function(){var e=r.$tooltipEl;return e.empty(),e.closestPoints.forEach(function(t){e.append('<div class="ndm-line-chart__tooltip-row">\n                                <div class="ndm-line-chart__tooltip-row__line ndm-line-chart__tooltip-row__line--'.concat(t.colorId,'"></div>\n                                ').concat(t.name,'\n                                <span class="ndm-line-chart__tooltip-row__value">').concat(r.yAxisOptions.labelFormatFn(t.vy),"</span>\n                            </div>"))}),e},r.$tooltipEl.highlightClosestPoints=function(){if(r.pointLocation.x||!(r.pointLocation.x<0)){var e=r.$tooltipEl;e.dehighlightClosestPoints();var t=[];return angular.isArray(r.charts)&&r.charts.forEach(function(e){var n,i,o,s=(n=e.points,i="x",o=r.pointLocation.x,n.reduce(function(e,t,n){return e?Math.abs(t[i]-o)<Math.abs(e.v[i]-o)?{v:t,i:n}:e:{v:t,i:n}},void 0));s&&t.push(a.extend(s.v,{name:e.name,idx:s.i,colorId:e.colorId}))}),e.closestPoints=[],t.forEach(function(t,n){var i=a.get(r.points,[n,t.idx]);i&&(i.element.classList.add(p),t.el=i.element),e.closestPoints.push(t)}),e}},r.$tooltipEl.dehighlightClosestPoints=function(){var e=r.$tooltipEl;return e.closestPoints.filter(function(e){return e.el}).forEach(function(e){e.el.classList.remove(p)}),e};r.lineEl=C("line",{x1:0,y1:0,x2:0,y2:r.height,class:m},r.svgEl),r.lineEl.hide(),r.$tooltipEl.hide(),r.svgEl.addEventListener("mousemove",function(e){r.pointLocation=function(e){return n.x=e.clientX,n.y=e.clientY,n.matrixTransform(r.svgEl.getScreenCTM().inverse())}(e),r.pointLocation.x<0||r.pointLocation.y>r.height||r.pointLocation.x>r.width?(r.lineEl.hide(),r.$tooltipEl.hide()):(r.lineEl.show(),r.$tooltipEl.show(),r.lineEl.attr("x1",r.pointLocation.x),r.lineEl.attr("x2",r.pointLocation.x),r.pointLocation.vy=r.pointLocation.y/r.height*r.currMaxY,r.pointLocation.vx=r.pointLocation.x/r.width*r.currMaxX,r.$tooltipEl.updateState(e.pageX,e.pageY))},!1),r.svgEl.addEventListener("mouseenter",function(){r.mouseIsOver=!0},!1),r.svgEl.addEventListener("mouseleave",function(){r.mouseIsOver=!1,r.lineEl.hide(),r.$tooltipEl.dehighlightClosestPoints(),r.$tooltipEl.hide()},!1)}},r.$onChanges=function(e){e.model&&e.model.currentValue&&E(e.model.currentValue),e.xAxisOptions&&e.xAxisOptions.currentValue&&(r.xAxisOptions=I(e.xAxisOptions.currentValue))}}e.$inject=["$scope","$element","$timeout","$document","_","utils","browserCheck"],angular.module("keenetic").component("ndmLineChart",{templateUrl:"app/components/ndm-line-chart/ndm-line-chart.html",bindings:{header:"@",width:"=",height:"=",model:"<",maxY:"<",curveSmoothFactor:"<?",idPrefix:"@?",autoResize:"<?",pointRadius:"<?",xAxisOptions:"<?",yAxisOptions:"<?"},controller:e})}(),function(){function e(e,t,n,i,a){var o=this,s=[n.state.INITIAL_SETUP_WIZARD_STATE,n.state.LOGIN_STATE,n.state.QUALITY_CONTROL_STATE,n.state.NOT_SUPPORTED_BROWSER_STATE];o.isLayoutVisible=!1;var r=e.onFinish({},function(e){var t=e.to().name;t&&c(t)}),l=i.$watch(function(){return t.current.name},function(e){e&&(c(e),l())}),c=function(e){var n=a.find(t.get(),{name:e}),i=n&&(n.templateUrl||!a.isEmpty(n.views)),r=-1!==s.indexOf(e);o.isLayoutVisible=i&&!r};i.$on("$destroy",l),i.$on("$destroy",r)}e.$inject=["$transitions","$state","CONSTANT","$scope","_"],angular.module("keenetic").component("ndmLayout",{templateUrl:"app/components/ndm-layout/ndm-layout.html",transclude:!0,restrict:"E",replace:!0,controller:e,controllerAs:"vm"})}(),function(){n.$inject=["$document","keyboard"],t.$inject=["$document","keyboard"],angular.module("keenetic").directive("ndmKeyPress",t).directive("ndmSingleKeyBind",n);var e=["focus","blur","keydown"].join(" ");function t(t,n){return{restrict:"E",replace:!0,scope:{actionOn:"=",callFunc:"="},link:function(i){var a=function(e){for(var t=0,a=i.actionOn.length;t<a;t++)if(n.isKey(e,i.actionOn[t])&&i.callFunc[t])return i.callFunc[t](),e.preventDefault(),e.stopPropagation(),!1};i.callFunc&&t.on(e,a);i.$on("$destroy",function(){return t.off(e,a)})}}}function n(t,n){return{restrict:"E",replace:!0,scope:{key:"@",callFunc:"&"},link:function(i){var a=function(e){n.isKey(e,i.key)&&(i.callFunc(),e.preventDefault(),e.stopPropagation())};i.callFunc&&t.on(e,a);i.$on("$destroy",function(){return t.off(e,a)})}}}}(),function(){function e(e,t,n,i,a){var o=this,s=i.IP_CONFIG_MODE,r=a.PPP_TYPE;o.IP_CONFIG_MODE=s,o.PPP_TYPE=r,o.ANY_PPP_COMPONENT_INSTALLED=["pppoe","l2tp","pptp"].some(function(e){return t[e]}),o.PPPOE_INSTALLED=Boolean(t.pppoe);var l=function(e){return!(e.mode!==s.STATIC||!n.ip(e.ip)||!n.ip(e.mask))&&{ip:e.ip,mask:e.mask}},c=function(t){var n=l(e.get(o,"ipData")),i=l(e.get(o,"pppData.ip"));o.busySubnetsIp=[].concat(_toConsumableArray(t),[i]).filter(e.identity),o.busySubnetsPpp=[].concat(_toConsumableArray(t),[n]).filter(e.identity)};o.onIpDataChange=function(t,n,i){o.onIpChange(t,n,i),o.onChange({ip:t,ppp:o.pppData},n,i,"IP");var a=l(t),s=e.get(o,"usedSubnets",[]);o.busySubnetsPpp=[].concat(_toConsumableArray(s),[a]).filter(e.identity)},o.onPppDataChange=function(t,n,i){o.onPppChange(t,n,i),o.onChange({ip:o.ipData,ppp:t},n,i,"PPP");var a=l(e.get(t,"ip")),s=e.get(o,"usedSubnets",[]);o.busySubnetsIp=[].concat(_toConsumableArray(s),[a]).filter(e.identity)},o.$onChanges=function(e){e.usedSubnets&&!e.usedSubnets.isFirstChange()&&c(e.usedSubnets.currentValue)},o.$postLink=function(){o.prefix=o.prefix||"",o.formName=o.formName||"".concat(o.prefix,"IspForm"),o.onChange=e.isFunction(o.onChange)?o.onChange:e.noop,o.onIpChange=e.isFunction(o.onIpChange)?o.onIpChange:e.noop,o.onPppChange=e.isFunction(o.onPppChange)?o.onPppChange:e.noop,o.usedSubnets&&c(o.usedSubnets)}}e.$inject=["_","components","ValidatorManager","ifaceIpModel","ifacePppModel"],angular.module("keenetic").component("ndmIspIface",{templateUrl:"app/components/ndm-isp-iface/ndm-isp-iface.html",bindings:{prefix:"@?",formName:"@",onChange:"<",onIpChange:"<",onPppChange:"<",isDisabled:"<",ipData:"<",pppData:"<",usedSubnets:"<",subtitleIp:"@",subtitlePpp:"@",status:"<",showMacMode:"<"},controller:e,controllerAs:"vm"})}(),function(){function e(e){var t=this,n={toggleLabel:"ndm-isp-general-properties.toggle-label",toggleOnText:"",toggleOffText:"",descriptionLabel:"ndm-isp-general-properties.description.label",descriptionComment:"ndm-isp-general-properties.description.comment"};t.showScheduleSelect=function(){t.scheduleSelectIsVisible=!0},t.$postLink=function(){t.l10n=Object.assign({},n,{},t.l10nOverride)},t.$onChanges=function(n){n.model&&!t.scheduleSelectIsVisible&&(t.scheduleSelectIsVisible=Boolean(e.get(n,"model.currentValue.schedule")))}}e.$inject=["_"],angular.module("keenetic").component("ndmIspGeneralProperties",{transclude:!0,templateUrl:"app/components/ndm-isp-general-properties/ndm-isp-general-properties.html",bindings:{namePrefix:"@?",isDisabled:"<",model:"<",onToggle:"<",status:"<",toggleDescription:"<",initialOrderData:"<",initialScheduleData:"<",l10nOverride:"<"},controller:e,controllerAs:"vm"})}(),function(){function e(e,t,n){var i=this;i.isInFocus=!1,i.inputIsInvalid=!1,i.inputErrorText="",i.onInputFocusToggle=function(e){i.isInFocus=e},i.updateInputValidity=function(e,t,n,a){i.inputIsInvalid=!e,i.inputErrorText=a};var a=function(t,a){n(function(){var n=i.value;i.value=t?"".concat(t).concat("||").concat(a):"___NO_VALUE___",i.value!==n&&e.invoke(i,"onChange",t,a)})},o=function(){var t=i.hiddenController.reset;i.hiddenController.reset=function(){t(),n(function(){var t,n;if("___NO_VALUE___"===e.get(i.hiddenController,"$viewValue",""))t="",n="";else{var a=e.get(i.hiddenController,"$viewValue","").split("||");t=e.get(a,"[0]",""),n=e.get(a,"[1]")||e.get(i,"selectboxOptions[0].id")}i.inputValue=t,i.selectboxValue=n,i.hiddenController.$setPristine()})};var o=i.hiddenController.$setPristine;i.hiddenController.$setPristine=function(){e.invoke(i.selectboxController,"$setPristine"),e.invoke(i.inputController,"$setPristine"),o()},a(i.inputValue,i.selectboxValue),o()};i.$postLink=function(){!function a(){var o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e.noop,s=!1;if(!i.inputController){var r=t[0].querySelector(".ndm-input input");i.inputController=angular.element(r).controller("ngModel"),s=!0}if(!i.selectboxController){var l=t[0].querySelector(".ndm-selectbox input");i.selectboxController=angular.element(l).controller("ngModel"),s=!0}if(!i.hiddenController){var c=t[0].querySelector('input[type="hidden"]');i.hiddenController=angular.element(c).controller("ngModel"),s=!0}s?n(function(){return a(o)},100):o()}(o)},i.onSelectboxChange=function(t){n(function(){return e.invoke(i,"inputController.revalidate")}),a(i.inputValue,t)},i.onInputChange=function(e){a(e,i.selectboxValue)},i._validator=function(t){return e.invoke(i,"validator",t,i.selectboxValue)}}e.$inject=["_","$element","$timeout"],angular.module("keenetic").component("ndmInputSelectbox",{templateUrl:"app/components/ndm-input-selectbox/ndm-input-selectbox.html",transclude:!0,bindings:{label:"@",name:"@",isDisabled:"<",inputPlaceholder:"@",inputKeyFilter:"<",inputValidation:"<",inputValue:"=",selectboxValue:"=",selectboxOptions:"<",onChange:"<",validator:"<"},controller:e,controllerAs:"vm"})}(),function(){function e(e){var t=this;t._onChange=function(n){e.invoke(t,"onChange",n,t.name)}}e.$inject=["_"],angular.module("keenetic").component("ndmInputNew",{templateUrl:"app/components/ndm-input-new/ndm-input-new.html",transclude:!0,bindings:{className:"@",label:"@",name:"@",placeholder:"@?",isDisabled:"<",value:"<",onChange:"<",showCloseBtn:"<"},controller:e,controllerAs:"vm"})}(),function(){angular.module("keenetic").component("ndmInputFilter",{templateUrl:"app/components/ndm-input-filter/ndm-input-filter.html",transclude:!0,bindings:{value:"=",onChange:"<",isDisabled:"<",name:"@?",placeholder:"@?",className:"@?"},controller:function(){var e=this;e.reset=function(){e.value="",(e.onChange||angular.noop)(e.value)}}})}(),function(){function e(e,t,n){return{templateUrl:"app/components/ndm-input-file/ndm-input-file.html",replace:!0,transclude:!0,link:function(i,a,o){var s;i.vm.input=a.find("input"),i.vm.onReset=i.onReset,i.vm.confirmUpload=Boolean(o.confirmUpload),i.api={resetState:function(){return i.vm.resetState()}},e(function(){s=a[0].querySelector("input")}),a.bind("change",function(e){angular.isObject(i.vm.uploadFile)||(i.vm.uploadFile={}),i.vm.uploadFile.file=e.target.files[0],i.vm.uploadFile.url=i.uploadUrl;var t=n.invoke(i,"onFileSelect",i.vm.uploadFile.file);!1!==t?o.confirmUpload?(i.uploadFile=i.vm.uploadFile,"$apply"!==i.$root.$$phase&&"$digest"!==i.$root.$$phase&&i.$apply()):i.vm.doUpload():i.vm.resetState()}),i.onKeydown=function(n){(t.isSpace(n)||t.isEnter(n))&&s&&(n.preventDefault(),n.stopPropagation(),e(function(){return s.click()}))}},controller:function(){var e=this;e.isUploading=!1,angular.isObject(e.uploadFile)||(e.uploadFile={});e.uploadFile.file=!1,e.doUpload=function(t){if(e.uploadFile.file&&(t&&t.preventDefault(),e.isUploading=e.confirmUpload,e.onUploadFile&&angular.isFunction(e.onUploadFile()))){var n=e.onUploadFile()(e.uploadFile);n&&n.then?n.finally(e.resetState):e.resetState()}},e.resetState=function(){e.isUploading=!1,e.input.val(""),e.uploadFile.file=!1,n.invoke(e,"onReset")},n.invoke(e,"onInit",{resetState:e.resetState})},controllerAs:"vm",scope:{uploadFile:"=",title:"@label",btnTitle:"@",btnTitleIfFileSelected:"@",uploadUrl:"=",onUploadFile:"&",onFileSelect:"<",onReset:"<",confirmUpload:"="},bindToController:{disableOnFileSelect:"<",uploadFile:"=",onUploadFile:"&",onInit:"<"}}}e.$inject=["$timeout","keyboard","_"],angular.module("keenetic").directive("ndmInputFile",e)}(),function(){function e(e,t){return n.$inject=["$scope","$element","$document","ValidatorManager"],{require:"^ngController",templateUrl:"app/components/ndm-input-drop/ndm-input-drop.html",replace:!0,transclude:!0,link:function(n,i,a,o){var s=n.value,r=i.find("input"),l=r.controller("ngModel"),c=function(){Object.keys(l.$error).forEach(function(e){l.$setValidity(e,!0)})},d=function(){var i=function(e,i){if(!e)return c(),"";for(var a,o,s,r,d=e.match(/([^,]\w+?\[.*?\]+\]?)|([^,]\w+)/g),p=0,u=d.length;p<u;p++){if(o=d[p].match(/(\w*)\[(.*)\]|(\w*)/),a=o[2]?o[1]:o[0],s=o[2],(r=i[a](l.$viewValue,s||n.dropValue,n.validationData))&&r.message)return l.$setValidity(a,!1),t.getTranslation(r.message);l.$setValidity(a,!0)}};n.error=i(n.inputValidation,e.validators)||i(n.inputCustomValidation,o)};a.inputFuncOnChange||n.$watch("dropValue",function(e,t){e&&e!==s?(n.isDirty=!0,r[0].focus(),d()):n.isDirty=!1,n.func&&o[n.func](e,t)});n.$watch("modelVal",function(){angular.isDefined(l.$viewValue)&&d()}),n.$watch("inputHidden",function(e){e?(n.error="",c()):d()})},controller:n,controllerAs:"inputDrop",scope:{dropArray:"=",dropValue:"=",dropDisabled:"<",label:"@",placehold:"=",modelVal:"=",inputName:"@",inputDisabled:"<",inputHidden:"<",inputKeyValidation:"@",inputFuncOnChange:"=",inputCustomValidation:"@",inputValidation:"@",validationData:"<"}};function n(e,t,n,i){var a,o=this;function s(){var e=n[0].activeElement;a!==e&&(o.isInputDropFocus=!1,n.off("click",s))}o.inputName=e.inputName||"inputDrop",o.inputDisabled=e.inputDisabled,o.inputHidden=e.inputHidden,o.isInputDropFocus=!1,o.validation=function(t){var n=i[e.inputKeyValidation];if(n)return!n(t)&&t.preventDefault()},t.on("click",function(){a=t[0].querySelector(".sb-toggle"),n.on("click",s)})}}e.$inject=["ValidatorManager","utils"],angular.module("keenetic").directive("ndmInputDrop",e)}(),function(){function e(e,t,n,i,a,o,s,r){var l={blurOnOptionChoice:!1,highlightMatch:!0,useRegexpToMatch:!0,showOptionsOnChange:!0,showOptionsOnFocus:!0,translateOptions:!0,sortByMatchIndex:!0},c="".concat(".ndm-input-autocomplete__dropdown","-container"),d={idProp:"id",labelProp:"label",placeholderText:"",noMatchMessage:s.getTranslation("ndm-selectbox-filter.no-suitable-options")},p=this,u=function(){return e[0].querySelector(c)},m=function(){return p.matchingOptionsLength},f=function(t){var n=u(),i=e[0].querySelector(".ndm-input-autocomplete__dropdown");if(m()>5){var a=n.querySelector("li:nth-child(".concat(t+1,")"));if(a&&i){var o=n.getBoundingClientRect(),s=a.getBoundingClientRect(),r=0;s.bottom>o.bottom?r+=s.bottom-o.bottom+40:s.top<o.top&&(r+=s.top-o.top-40),n.scrollTop+=r}}},g=function(e){return o.findIndex(p.matchingOptions,_defineProperty({},p.labelProp,e))};p.onInputClick=function(){p.value&&p.showOptions()},p.onIconClick=function(e){e.stopPropagation(),p.value="",p.icon="",angular.isFunction(p.onInputChange)&&p.onInputChange(p.value,p.name,p.matchingOptions)};var v=function(e){if(r.isEnter(e))i(function(){var e;p.matchingOptionsLength&&p.optionInFocus&&p.onOptionClick(null,(e=p.optionInFocus,o.find(p.matchingOptions,_defineProperty({},p.labelProp,e))))});else if(r.isEscape(e))p.hideOptions();else if(r.isUpArrow(e)||r.isDownArrow(e)){e.preventDefault(),e.stopImmediatePropagation(),e.stopPropagation();var t=r.isUpArrow(e)?-1:1,n=o.findIndex(p.matchingOptions,_defineProperty({},p.labelProp,p.optionInFocus));(n+=t)<0?n=p.matchingOptionsLength+n:n%=p.matchingOptionsLength;try{p.optionInFocus=p.matchingOptions[n][p.labelProp]}catch(e){console.warn("ndm-input-autocomplete.handleKeyDown:",e),n=0,p.optionInFocus=p.matchingOptions.length>0?p.matchingOptions[0][p.labelProp]:""}f(n),"$apply"!==a.$root.$$phase&&"$digest"!==a.$root.$$phase&&a.$apply()}};p.onChange=function(e,t){p.filterOptions(t),p.flags.showOptionsOnChange&&p.showOptions(),p.icon=p.value?"cancel":"",angular.isFunction(p.onInputChange)&&p.onInputChange(p.value,p.name,p.matchingOptions)},p.onFocus=function(){p.isInFocus=!0,p.flags.showOptionsOnFocus&&p.showOptions()},p.onBlur=function(){p.isInFocus=!1,p.hideOptions()},p.filterOptions=function(e){if(p.options){var t=[];if(e){var n=p.flags.useRegexpToMatch?s.createMatchStrRegexp(e):null;t=o.map(p.options,function(t){var i,a,o=t[p.labelProp];return!!o&&(p.flags.useRegexpToMatch?(a=(i=n.exec(o))?i.index:-1,n.lastIndex=0):i=-1!==(a=o.indexOf(e))&&[e],!!i&&(p.flags.highlightMatch&&(t.highlightLabel=s.highlightMatch(o,n||e)),Object.assign({},t,{matchIndex:a})))}).filter(angular.identity),p.flags.sortByMatchIndex&&(t=o.sortBy(t,"matchIndex"))}else t=p.options.map(function(e){return o.omit(e,["matchIndex","highlightLabel"])});var i=p.flags.translateOptions?s.getTranslation:angular.identity;p.matchingOptions=t.map(function(e){var t=s.escapeHtml(e[p.labelProp]),n=i(p.value&&e.highlightLabel||t);return Object.assign({},e,{matchLabel:n})}),p.matchingOptionsLength=t.length,angular.isFunction(p.onMatchChange)&&p.onMatchChange(p.value,p.name,p.matchingOptions)}};var h=function(){var e=-1,t=g(p.value),n=g(p.optionInFocus);-1!==t&&(e=t),-1===e&&-1!==n&&(e=n),-1!==e?(f(e),p.optionInFocus=p.matchingOptions[e][p.labelProp]):p.matchingOptions.length>0&&(p.optionInFocus=p.matchingOptions[0][p.labelProp])};p.showOptions=function(){if(p.isDropdownExpanded)h();else{var t=e[0].getBoundingClientRect(),n=s.dom.findParentScrollableElement(e[0]).getBoundingClientRect(),a=32*m();p.dropup=t.bottom+a>n.bottom&&t.top-a>n.top,e.on("keydown",v),i(function(){p.containerEl=u()}),i(function(){h(),p.isDropdownExpanded=!0})}},p.hideOptions=function(){p.isDropdownExpanded&&(p.optionInFocus="",p.isDropdownExpanded=!1,e.off("keydown",v),i(function(){p.containerEl=null}))},p.onOptionClick=function(e,t){e&&(e.stopPropagation(),e.preventDefault()),t&&(p.value=t[p.labelProp],p.hideOptions(),p.flags.blurOnOptionChoice&&p.inputEl&&p.inputEl.blur())},p.onOptionHover=function(e){p.optionInFocus=e[p.labelProp]},p.flags=p.flags||angular.copy(l),p.$onInit=function(){Object.keys(d).forEach(function(e){p[e]=p[e]||d[e]}),p.icon="",p.matchingOptions=[],p.matchingOptionsLength=0,p.isInFocus=!1,p.isDropdownExpanded=!1,p.previousValue=p.value,p.filterOptions(p.value),angular.isFunction(p.onInit)&&p.onInit(p.name,{isDropdownExpanded:function(){return p.isDropdownExpanded},getOptionsCount:function(){return o.get(p,"options.length",0)},getMatchingOptionsCount:function(){return p.matchingOptionsLength},getOptions:function(){return p.options},getMatchingOptions:function(){return p.matchingOptions},setFocus:function(){return!!p.inputEl&&(p.inputEl.focus(),!0)},getOptionInFocusIndex:function(){return g(p.optionInFocus)},showOptions:p.showOptions,hideOptions:p.hideOptions,resetValue:p.resetValue})},p.$postLink=function(){p.inputEl=e[0].querySelector("input")},p.$doCheck=function(){p.value!==p.previousValue&&(p.filterOptions(p.value),p.previousValue=p.value,p.icon=p.value?"cancel":"")},p.$onChanges=function(e){if(e.flags&&(p.flags=o.extend({},l,e.flags.currentValue)),e.options&&p.filterOptions(p.value),e.isDisabled&&e.isDisabled.currentValue&&p.hideOptions(),e.onKey){var t=e.onKey.currentValue;o.isFunction(t)?p.onKeyDown=function(e){!1===t(e,p.value)&&(e.preventDefault(),e.stopPropagation())}:p.onKeyDown=angular.noop}}}e.$inject=["$element","$rootScope","$document","$timeout","$scope","_","utils","keyboard"],angular.module("keenetic").component("ndmInputAutocomplete",{templateUrl:"app/components/ndm-input-autocomplete/ndm-input-autocomplete.html",bindings:{label:"@?",name:"@",placeholderText:"@?",backgroundText:"@?",noMatchMessage:"@?",className:"@?",idProp:"@?",labelProp:"@?",isDisabled:"<",isInvalid:"<",value:"=",options:"<",onInputChange:"<",onMatchChange:"<",onInit:"<",drawAsSelectbox:"<",onKey:"<",flags:"<?"},controller:e})}(),function(){function e(e,t,n,i,a,o){return{require:["^ngController","?^^ndmExtraFormOptions"],templateUrl:"app/components/ndm-input/ndm-input.html",replace:!0,transclude:!0,link:function(s,r,l,c){var d=arguments,p=_slicedToArray(c,2),u=p[0],m=p[1],f=o.get(m,"options",{});s.titleOnTop="titleOnTop"in l,s._onValidationEnd=angular.isDefined(l.onValidationEnd)?s.onValidationEnd():angular.noop;var g=Number(s.maxLength);s.maxlength=!isNaN(g)&&g>0?g:64,s.onChange=angular.isFunction(s.onChange)?s.onChange:angular.noop;var v,h=r[0].querySelector("input"),b=angular.element(h).controller("ngModel"),_=!0;b.$formatters.push(function(e){if(angular.isDefined(e)&&"boolean"!=typeof e)return String(e).replace(/(\r|\n)*$/g,"")}),s.setFocus&&h.focus();s.$watch("focusWhen",function(e){e&&t(function(){return h.focus()})});s.autocompleteName?h.setAttribute("autocomplete",s.autocompleteName):s.password&&!s.isAutofillEnabled?(h.setAttribute("autocomplete","new-password"),s.isAntiAutoFillMode=!0):!s.password&&s.disableAutocomplete&&h.setAttribute("autocomplete","off");var y=function(){t(function(){s.l10n={hide:i.getTranslation(l.hidePasswordLabel||"hide-password"),show:i.getTranslation(l.showPasswordLabel||"show-password")}})};if(s.$on("$destroy",n.$on("$translateChangeSuccess",y)),y(),s.clickableDescription=s.password||l.descriptionClick,s.onDescriptionKeydown=function(e){if(!a.isSpace(e)||!s.clickableDescription||s.isDisabled||s.isDescriptionDisabled)return!0;e.preventDefault(),s.password?s.togglePassword():s.onDescriptionClick(s.name,s.model)},angular.isDefined(l.unitText)){s.$watch("unitText",function(){t(function(){var e=r[0].querySelector("div.ndm-input__unit-text__container");h.style["padding-right"]=e?e.offsetWidth+12+"px":"0"},2e3)})}function S(){if(Object.keys(b.$error).forEach(function(e){b.$setValidity(e,!0)}),s.errorText="",s.isDisabled)return s._onValidationEnd(!s.errorText,s.name,s.model,s.errorText),void(s.noNdmCommonValidator||b.$setValidity("ndmCommonValidator",!0));if(s.validation){var t=function(t){for(var n,a,o,r,l=t.match(/([^,]\w+?\[.*?\]+\]?)|([^,]\w+)/g),c={},d=i.isInvisible(h),p=0,m=l.length;p<m;p++)if(o=l[p].match(/(\w*)\[(.*)\]|(\w*)/),n=o[2]?o[1]:o[0],r=o[2],!f.validateInvisible&&d||h.disabled?c=!1:(a=e.validators[n]||u[n])&&(c=a(s.model,r,s.validationData)),c&&c.message){if(!c.isHint)return b.$setValidity(n,!1),c.validator=n,c;s.sideHint=c.message}else b.$setValidity(n,!0);return{}}(s.validation);s.errorText=t.message,t.message?(s.errorText=t.message,s.validationTextError&&s.validationTextError[t.validator]&&(s.errorText=s.validationTextError[t.validator])):s.errorText=void 0}else b.$setValidity("ndmCommonValidator",!0);if(!s.errorText&&s.errorFromController&&(s.errorText=s.errorFromController),!s.errorText&&s.error&&(s.errorText=s.error),!s.errorText&&angular.isFunction(s.extraValidator)){var n=s.extraValidator(s.model,s.name);!1===n&&(n="extra error"),!0!==n&&(s.errorText=n)}s.noNdmCommonValidator||b.$setValidity("ndmCommonValidator",!s.errorText),s.errorText||!l.errorFromController||s.errorFromController||(s.errorText=""),_=!1,s._onValidationEnd(!s.errorText,s.name,s.model,s.errorText)}function w(){s.noNdmCommonValidator||b.$setValidity("ndmCommonValidator",!1),v&&t.cancel(v),v=t(S,_?400:100)}h.inputValidation=S,s.onFocusToggle=o.isFunction(s.onFocusToggle)?s.onFocusToggle:o.noop,s.onBlur=function(){s.isFocused=!1,s.isMessageVisible=!1,s.onFocusToggle(s.isFocused,s.name)},s.onFocus=function(){s.isFocused=!0,s.isMessageVisible=!0,s.onFocusToggle(s.isFocused,s.name)},s.onClick=function(){s.callOnClick&&s.callOnClick.apply(s,arguments)},s.onDescriptionClick=function(){if(angular.isFunction(s.descriptionClick)){var e=s.descriptionClick(s);angular.isFunction(e)&&e(d)}},s.togglePassword=function(){s.showPassword=!s.showPassword},b.revalidate=function(){w()},s.$watch("isDisabled",w),s.$watch("validation",w),s.$watch("validationData",w),s.$watch("error",w),s.$watch("errorFromController",w),b.$validators.ndmValidationWatch=function(){return t(w),!0};var C={LEFT:37,UP:38,RIGHT:39,DOWN:40,ENTER:13,ESC:27,SPACE:32},E={LEFT:"onPressLeft",RIGHT:"onPressRight",UP:"onPressUp",DOWN:"onPressDown",ENTER:"onPressEnter",ESC:"onPressEsc",SPACE:"onPressSpace"};s.onPasswordIconKeyDown=function(e){if(a.isSpace(e))return e.preventDefault(),e.stopPropagation(),s.togglePassword(),!0},s.onKeyDown=function(e){var t=e.which,n=null;o.isFunction(s.onKey)&&(n=s.onKey(e,s.model)),!1!==n&&o.find(E,function(e,i){if(C[i]===t){var a=s[e];return o.isFunction(a)&&(n=a()),!0}}),!1===n&&(e.preventDefault(),e.stopPropagation())}},scope:{className:"@?",maxLength:"<?",errorFromController:"=",error:"<?",extraValidator:"=",isDisabled:"=disabled",isDescriptionDisabled:"<",isAutofillEnabled:"@",noNdmCommonValidator:"<",callOnClick:"=",onChange:"<",model:"=",icon:"@",unitText:"@",placeholder:"@",animatedPlaceholder:"@",componentId:"@",validation:"@",validationData:"=",validationTextError:"=",onValidationEnd:"&",setFocus:"@",onFocusToggle:"<",focusWhen:"<",title:"@label",hint:"@",name:"@",sideHint:"@",password:"@",readonly:"<",showPasswordLabel:"@",hidePasswordLabel:"@",description:"@",descriptionClick:"&?",onPressDown:"&?",onPressUp:"&?",onPressEnter:"&?",onPressLeft:"&?",onPressRight:"&?",onPressEsc:"&?",onPressSpace:"&?",disableAutocomplete:"<?",modelOptions:"<",onKey:"<?",autocompleteName:"<"}}}function t(e){return{restrict:"A",link:function(t,n){e(function(){["INPUT","BUTTON"].forEach(function(e){var t=n[0];t.tagName!==e?(t=t.querySelector(e))&&t.focus():t.focus()})})}}}t.$inject=["$timeout"],e.$inject=["ValidatorManager","$timeout","$rootScope","utils","keyboard","_"],angular.module("keenetic").directive("ndmInput",e).directive("ndmAutofocus",t).directive("ndmExtraFormOptions",function(){return{restrict:"A",controller:["$scope","$attrs",function(e,t){this.options=angular.copy(e.$eval(t.ndmExtraFormOptions))}]}})}(),function(){function e(e,t,n){return{restrict:"E",templateUrl:"app/components/ndm-iface-ppp/ndm-iface-ppp.html",transclude:!0,replace:!0,link:function(i){i.PPP_TYPE=t.PPP_TYPE,i.vm={};var a=i.vm;i.data=i.data||{},a.options={types:t.getTypesSelect(),algorithms:t.getAlgorithmsSelect(),typeNames:{}},i.$watch("data.mppe",function(e){e&&(i.data.ccp=!0)}),i.$watch("data",function(e,t){n.get(e,"id")!==n.get(t,"id")&&(i._prevType=null)}),i.$watch("allowOnlyPppoe",function(e,t){e?(i._prevType=i.data.type,i.data.type=i.PPP_TYPE.PPPOE):t&&i._prevType&&(i.data.type=i._prevType)}),i._onChange=angular.noop,i._onSelectboxChange=angular.noop,i.onChange&&(i._onSelectboxChange=function(t,n,a){e(function(){return i.onChange(i.data,t,a)})},i._onChange=function(t,n){e(function(){return i.onChange(i.data,t,n)})})},scope:{data:"=",prefix:"@?",description:"@?",label:"@?",usedIps:"<?",onChange:"<?",allowOnlyPppoe:"<",isDisabled:"<"}}}e.$inject=["$timeout","ifacePppModel","_"],angular.module("keenetic").directive("ndmIfacePpp",e)}(),function(){function e(e,t,n,i,a,o,s){var r=e.ISP_PPP_IFACE_TYPES,l={no:!0},c={NONE:"none",PPPOE:"PPPoE",PPTP:"PPTP",L2TP:"L2TP"},d=e.PPP_AUTH_ALGORITHM;return{PPP_TYPE:c,PPP_AUTH_ALGORITHM:d,getFormDataFromRawDataByVia:function(e,t){return u(s.findIspTunnel(e,t)||{})},getSavingQueriesArr:function(e,t,n){var o=[];if(t.type===c.NONE)return t.id&&o.push(m(t.id,l)),o;t.id&&t.type!==f(t.id)&&(o.push(m(t.id,l)),t.id=!1);t.id=t.id||g(t.type,n);var s,r=t.type===c.PPPOE;s=r&&!t.pppoePeer||!r&&!t.peer?l:r?t.pppoePeer:t.peer;var d={up:!0,description:t.description||"",connect:{enabled:!0,via:e},authentication:{identity:t.identity,password:t.password},encryption:{mppe:t.mppe},"security-level":{public:!0},peer:s,ccp:Boolean(t.ccp)};d.authentication=Object.assign({},d.authentication,{},i.getAuthenticationTypeQuery(t.algorithm)),r&&(d.pppoe={service:t.service||l});t.password||delete d.authentication.password;return o.push(m(t.id,d),a.getSavingQuery(t.ip,t.id,{isPpp:!0})),o},getFormDataPrototype:p,getTypesSelect:function(){var e=[{id:c.NONE,name:"iface-ppp.none"}];o.pppoe&&e.push({id:c.PPPOE,name:"PPPoE"});o.pptp&&e.push({id:c.PPTP,name:"PPTP"});o.l2tp&&e.push({id:c.L2TP,name:"L2TP"});return e},getAlgorithmsSelect:function(){return[{id:d.AUTO,name:"auto"},{id:d.PAP,name:"PAP"},{id:d.CHAP,name:"CHAP"},{id:d.MSCHAP,name:"MS-CHAP"},{id:d.MSCHAP_V2,name:"MS-CHAP v2"}]},componentExists:function(){return o.pppoe||o.pptp||o.l2tp},getFormDataFromRawData:u,findIfaceIdToSave:function(e,t){return e.type!==c.NONE&&(e.id&&e.type===f(e.id)?e.id:g(e.type,t))}};function p(){return{via:"",id:!1,type:c.NONE,description:"",address:"",identity:"",password:"",algorithm:d.AUTO,service:"",peer:"",pppoePeer:"",encryption:"",pmtu:!1,ip:angular.extend(a.getFormDataPrototype(),{tcpmss:!0})}}function u(e){var n=e&&(e.type||f(e.id))||c.NONE,o={type:n};if(!t.isEmpty(e)){var s,r=e.authentication||{},l=n===c.PPPOE?"pppoePeer":"peer";_defineProperty(s={id:e.id||!1,type:n},l,e.peer||""),_defineProperty(s,"mppe",e.encryption&&e.encryption.mppe),_defineProperty(s,"ccp",e.ccp),_defineProperty(s,"identity",r.identity||""),_defineProperty(s,"password",r.password||""),_defineProperty(s,"algorithm",i.getAuthenticationType(e)),_defineProperty(s,"service",e.pppoe&&e.pppoe.service||""),_defineProperty(s,"ip",a.getFormDataFromRawData(e,!0,!0)),o=s}return angular.extend(p(),o)}function m(e,t){var n={interface:{}};return n.interface[e]=t,n}function f(e){return t.find(r,function(n){return t.startsWith(e,n)})}function g(e,t){for(var n=0;;){var i=e+n;if(!t[i])return i;n++}}}e.$inject=["CONSTANT","_","utils","interfaces","ifaceIpModel","components","pppPurposeChecker"],angular.module("keenetic").factory("ifacePppModel",e)}(),function(){function e(e,t,n,i,a,o,s){return{templateUrl:"app/components/ndm-iface-order/ndm-iface-order.html",link:function(r,l,c,d){var p=-1,u=p,m=0,f=function(){r.options=a.map(r.options,function(e,t){var n=e.id,i=e.icon,a=e.hide,o=t?_("reserve")+" "+t:_("main");return n===p&&(o=_("undefined")),{id:n,icon:i,hide:a,label:o}}),a.find(r.options,{id:p})||r.options.push({id:p,label:_("undefined"),icon:"warning",hide:!0})};r.options=[],r.loading=!0,r.isRefreshing=!1,r.isFirstDataRequest=!0,u=y(r.value),d.$formatters.push(y);var g=d.$setPristine;d.$setPristine=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return a.invoke(r,["order","selectbox_"+r.name,"$setPristine"]),e&&(u=y(r.value),v()),g()},r.$watch("required",function(e,t){!e!=!t&&v()}),h(),~r.value||b();function v(){r.isRefreshing||(r.isRefreshing=!0,function(){if(r.isFirstDataRequest&&r.initialData)return m=s.countGlobalIfaces(r.initialData),r.isFirstDataRequest=!1,n.when(!0).then(function(){r.loading=!1});return r.isFirstDataRequest=!1,r.loading=!0,s.getGlobalInterfacesCount().then(function(e){m=e,r.loading=!1})}().then(function(){h(),b(),r.isRefreshing=!1}))}function h(){r.value=y(r.value);var n=-1===r.value&&!(!r.required&&!~u)&&m;n&&(r.value=m,t(function(){d.$setPristine(!1)})),t(function(){e.$broadcast(i.events.IFACE_ORDER_VALUE_REPAIR,d,r,n)})}function b(){for(var e=[],t=Math.max(0,u,r.value,m-(~u?1:0)),n=0;n<=t;++n)e.push({id:n,label:n?_("reserve")+" "+n:_("main")});e.push({id:p,label:_("undefined"),icon:"warning",hide:!0}),r.options=e,f()}function _(e){return o.getTranslation("iface-order."+e)}function y(e){var t=parseInt(e,10);return(isNaN(t)||t<-1)&&(t=p),t}v(),f(),r.$on("destroy",e.$on("$translateChangeSuccess",f))},restrict:"E",replace:!0,transclude:!1,require:"^ngModel",scope:{value:"=ngModel",name:"@",required:"<",isDisabled:"<",initialData:"<"}}}e.$inject=["$rootScope","$timeout","$q","CONSTANT","_","utils","interfaces"],angular.module("keenetic").directive("ndmIfaceOrder",e)}(),function(){function e(e,t,n,i,a){return{restrict:"E",templateUrl:"app/components/ndm-iface-ip/ndm-iface-ip.html",transclude:!0,replace:!0,link:function(o){var s=o;s.MAC_MODE=n.MAC_MODE,s.IP_CONFIG_MODE=n.IP_CONFIG_MODE,s.errors={},s.options={macMode:n.getMacModeOptions(),masks:n.getMasksSelectOptions(),modes:n.getModesSelectOptions(o.disableNone,o.autoWithDhcp),ipv6:Boolean(a.ip6)&&!o.noIpv6},s.singleIpMask=e.SINGLE_IP_MASK,s.showAdditionalFields=!s.noAdditionalSettings&&(s.tcpMss||s.options.ipv6||!s.noMtu),s.disableNone&&s.data&&"none"===s.data.mode&&(s.data.mode=void 0);o._onChange=angular.noop,o._onSelectboxChange=angular.noop,o.onChange&&(o._onSelectboxChange=function(e,n,i){t(function(){return o.onChange(o.data,e,i)})},o._onChange=function(e,n){t(function(){var t;t=i.chain(s.data).pick(["gateway","ip","dns"]).map(function(e,t){return"dns"===t?i.map(e,function(e,t){return{key:"dns".concat(t),value:e}}):{value:e,key:t}}).flatten().filter(function(e){return e.value}).groupBy(function(e){return e.value}).pickBy(function(e){return e.length>1}).map(function(e){return i.map(e,function(e){return e.key})}).flatten().value(),i.includes(t,"ip")&&t.length>1?s.errors=i.reduce(t,function(e,t){return i.set(e,t,"errors.unique-ip")},{}):s.errors={},o.onChange(o.data,e,n)})})},scope:{isDisabled:"<",isLocked:"<",data:"=",namePrefix:"@?",label:"@?",description:"@?",disableNone:"<?",autoWithDhcp:"<?",usedIps:"<?",detailsAlwaysShown:"<?",noAdditionalSettings:"<?",noDns:"<?",noMtu:"<?",noGateway:"<?",noIpv6:"<?",isPpp:"<",tcpMss:"<?",onChange:"<?",showMacMode:"<"}}}e.$inject=["CONSTANT","$timeout","ifaceIpModel","_","components"],angular.module("keenetic").directive("ndmIfaceIp",e)}(),function(){function e(e,t,n,i,a){var o={no:!0},s="ipcp.name-servers",r="dhcp.client.name-servers",l="dhcp.client.hostname",c={AUTO:"auto",STATIC:"static",NONE:"none"},d={DIRECT:"direct",CLONE:"clone",DEFAULT:"default"},p={isPpp:!1,noGateway:!1,noIpv6:!a.ip6,noMacMode:!0},u=function(e){var t=e.split(":");return 1===t.length?{"name-server":e}:{"name-server":t[0],port:t[1]}},m=function(e){return t.isString(e)?e:e["name-server"]+(e.port?":"+e.port:"")};return{IP_CONFIG_MODE:c,MAC_MODE:d,isInterfaceIpConfigurationStatic:function(e){return t.has(e,"ip.address.address")},getResetIpSettingsQuery:function(e){return t.set({},["interface",e,"ip","address"],[o])},getMacModeOptions:function(){return[{id:d.DIRECT,label:"iface-ip.mac-mode.direct"},{id:d.CLONE,label:"iface-ip.mac-mode.clone"},{id:d.DEFAULT,label:"iface-ip.mac-mode.default"}]},addressToNameServerObj:u,nameServerObjToAddress:m,getFormDataPrototype:function(){return{mode:c.AUTO,ip:"",remoteIp:"",mask:e.DEFAULT_NETMASK,gateway:"",dns:["","",""],mtu:"",ipv6:!1,macMode:d.DEFAULT,macAddress:"",ignoreDnsServers:!1,dhcpClientHostname:""}},getFormDataFromRawData:function(n,i){var a,o=arguments.length>2&&void 0!==arguments[2]&&arguments[2],p=(n.ipv6||{}).address||[],u=angular.isArray(p)&&p.length,f=n.ip||{},g=f.address||{},v=f.remote||{},h=f.tcp&&f.tcp["adjust-mss"]||{};a=g.dhcp||!f.address&&i?c.AUTO:g.address?c.STATIC:c.NONE;var b=t.get(n.mac,"address.mac",""),_=b?d.DIRECT:d.DEFAULT,y=t.get(f,l,""),S=o?!t.get(n,s,!0):!t.get(f,r,!0);return{mode:a,ip:g.address||"",remoteIp:v.address||"",mask:g.mask||e.DEFAULT_NETMASK,gateway:f.gateway||void 0,dns:(f["name-server"]||[]).map(m),mtu:f.mtu||"",ipv6:Boolean(u),tcpmss:h.pmtu,ignoreDnsServers:S,macMode:_,macAddress:b,dhcpClientHostname:y}},getSavingQuery:function(n,i){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},m=Object.assign({},p,{},a),g=m.isPpp,v=m.noGateway,h=m.noIpv6,b=m.noMacMode,_={address:angular.copy(o),"name-server":o,gateway:o},y=n.mode;if(n&&!n.no){g?(_.address=y===c.AUTO?o:[o,{address:n.ip,mask:e.SINGLE_IP_MASK}],_.remote="auto"!==y&&n.remoteIp?[o,{address:n.remoteIp,mask:e.SINGLE_IP_MASK}]:o):y===c.AUTO?_.address=[{no:!0},{dhcp:!0}]:y===c.NONE?_.address=[{no:!0},{dhcp:!1}]:(n.ip&&(_.address=[{dhcp:o},{address:n.ip,mask:n.mask}]),_.gateway=n.gateway),v&&delete _.gateway,_.gateway||delete _.gateway,_.mtu=n.mtu||o,g||(_=t.set(_,r,{no:n.ignoreDnsServers})),y!==c.NONE&&(_.tcp={"adjust-mss":n.tcpmss?{pmtu:!0}:o});var S=[o];n.dns.filter(angular.identity).filter(angular.identity).forEach(function(e){S.push(u(e))}),_["name-server"]=S,g||(_=t.set(_,l,n.dhcpClientHostname||o))}var w={ip:_};g&&(w=t.set(w,s,{no:n.ignoreDnsServers}));h||(w.ipv6={address:{auto:!0,no:!n.ipv6},prefix:{auto:!0,no:!n.ipv6},"name-servers":{auto:!0,no:!n.ipv6}},g&&(w.ipv6cp={no:!n.ipv6}));if(!b){var C=n.macAddress,E=n.macMode,I=C.toLowerCase().replace(/[^a-f0-9]+/g,"");I=t.toArray(I.match(/.{1,2}/g)).join(":");var T={};E===d.CLONE?T={clone:{}}:E===d.DEFAULT?T={address:o}:I&&(T={address:{mac:I.toLowerCase()}}),t.isEmpty(T)||(w.mac=T)}return f(i,w)},getSavingQueryArray:function(n,i){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},m=Object.assign({},p,{},a),g=m.isPpp,v=[].concat(_toConsumableArray(function(e,n){if(n.noMacMode)return[];var i=e.macAddress,a=e.macMode,s=i.toLowerCase().replace(/[^a-f0-9]+/g,"");s=t.toArray(s.match(/.{1,2}/g)).join(":");var r={};a===d.CLONE?r={clone:{}}:a===d.DEFAULT?r={address:o}:s&&(r={address:{mac:s.toLowerCase()}});if(t.isEmpty(r))return[];return[{mac:r}]}(n,m)),_toConsumableArray(function(n){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a={address:Object.assign({},o),"name-server":o,gateway:o};if(!n||n.no)return[{ip:a}];var s=Object.assign({},p,{},i),d=s.isPpp,m=s.noGateway,f=n.mode;d?(a.address=f===c.AUTO?o:[o,{address:n.ip,mask:e.SINGLE_IP_MASK}],a.remote=f!==c.AUTO&&n.remoteIp?[o,{address:n.remoteIp,mask:e.SINGLE_IP_MASK}]:o):f===c.AUTO?a.address=[{no:!0},{dhcp:!0}]:f===c.NONE?a.address=[{no:!0},{dhcp:!1}]:(n.ip&&(a.address=[{dhcp:o},{address:n.ip,mask:n.mask}]),a.gateway=n.gateway);!m&&a.gateway||(a=t.omit(a,["gateway"]));a.mtu=n.mtu||o,d||(a=t.set(a,r,{no:n.ignoreDnsServers}));f!==c.NONE&&(a.tcp={"adjust-mss":n.tcpmss?{pmtu:!0}:o});var g=n.dns.filter(angular.identity).map(function(e){return u(e)});a["name-server"]=[o].concat(_toConsumableArray(g)),d||(a=t.set(a,l,n.dhcpClientHostname||o));return[{ip:a}]}(n,m)),_toConsumableArray(function(e,t){var n=t.isPpp;if(t.noIpv6)return[];var i=[{ipv6:{address:{auto:!0,no:!e.ipv6},prefix:{auto:!0,no:!e.ipv6},"name-servers":{auto:!0,no:!e.ipv6}}}];n&&i.push({ipv6cp:{no:!e.ipv6}});return i}(n,m)));g&&v.push(t.set({},s,{no:n.ignoreDnsServers}));return v.map(function(e){return f(i,e)})},getModesSelectOptions:function(e,t){var n=[{id:c.AUTO,name:"iface-ip.auto"+(t?"-dhcp":"")},{id:c.STATIC,name:"iface-ip.static"}];e||n.push({id:c.NONE,name:"iface-ip.none"});return n},getMasksSelectOptions:function(){return n.idsToOptions(i.getMasksArray(),angular.identity)}};function f(e,t){var n={interface:{}};return n.interface[e]=t,n}}e.$inject=["CONSTANT","_","utils","ipV4Service","components"],angular.module("keenetic").factory("ifaceIpModel",e)}(),function(){function e(e,t){this.DOT1X_METHOD_ID=t.DOT1X_METHOD_ID,this.methodOptions=t.DOT1X_METHOD_OPTIONS}e.$inject=["_","dot1x"],angular.module("keenetic").component("ndmIfaceDot1x",{templateUrl:"app/components/ndm-iface-dot1x/ndm-iface-dot1x.html",bindings:{namePrefix:"@?",isDisabled:"<",data:"<"},controller:e,controllerAs:"vm"})}(),function(){function e(e,t){var n,i=Boolean(t.dot1x),a={NONE:"none",EAP:"eap-md5",CHAP:"chap",MSCHAP:"mschap",MSCHAP_V2:"mschap-v2",PEAP:"peap"},o="eap-ttls",s="chap",r="mschap",l="mschap-v2",c="peap",d=(_defineProperty(n={},a.EAP,["eap-md5"]),_defineProperty(n,a.CHAP,[o,s]),_defineProperty(n,a.MSCHAP,[o,r]),_defineProperty(n,a.MSCHAP_V2,[o,l]),_defineProperty(n,a.PEAP,[c,l]),n),p=function(){return{method:a.NONE,identity:"",password:""}},u=function(t){var n=t.identity,i=t.password,o=t.method;if(o===a.NONE)return e.set({},"authentication.no",!0);var s=d[o].reduce(function(e,t){return Object.assign({},e,_defineProperty({},t,!0))},{});return{authentication:Object.assign({identity:n,password:i},s)}};return{DOT1X_INSTALLED:i,DOT1X_METHOD_ID:a,DOT1X_METHOD_OPTIONS:[{id:a.NONE,label:"ndm-iface-dot1x.no-auth"},{id:a.EAP,label:"EAP-MD5"},{id:a.CHAP,label:"EAP-TTLS/CHAP"},{id:a.MSCHAP,label:"EAP-TTLS/MS-CHAP"},{id:a.MSCHAP_V2,label:"EAP-TTLS/MS-CHAPv2"},{id:a.PEAP,label:"EAP-PEAP/MS-CHAPv2"}],getDefaultDot1xConfiguration:p,getNdmQuery:function(t,n){return e.set({},["interface",n],u(t))},getDot1xConfiguration:function(t){var n=t.authentication;if(!n)return p();var i=n.identity,o=n.password,s=e.values(a).filter(function(e){return e!==a.NONE});return{method:e.chain(s).find(function(t){var i=d[t];return e.every(i,function(e){return n[e]})}).defaultTo(a.NONE).value(),identity:i,password:o}},getInterfaceAuthConfiguration:u}}e.$inject=["_","components"],angular.module("keenetic").factory("dot1x",e)}(),function(){angular.module("keenetic").directive("ndmIcon",function(){return{templateUrl:"app/components/ndm-icon/ndm-icon.html",replace:!0,transclude:!0,link:function(e){e.$watch("ndmIcon",function(t){e.icon=t,e.classObj={},e.classObj["icon--"+e.icon]=!0})},scope:{icon:"@",className:"@",ndmIcon:"@"}}})}(),angular.module("keenetic").directive("ndmHtmlCompile",["$compile",function(e){return{restrict:"A",link:function(t,n,i){t.$watch(i.ndmHtmlCompile,function(i){n.html(i),e(n.contents())(t)})}}}]),function(){function e(e,t,n,i){var a=function(n,i){var a={path:n,locale:i};return t.post({url:"webhelp/ui-notes",noRetry:!0,data:a}).then(function(n){if(t.containsAnyNdmErrors(n))return!1;var a=e.get(n,"webhelp.".concat(i),[]),o=function(e){switch(e){case"uk":return["ru","en"];case"en":return[];default:return["en"]}}(i);return{articles:a,fallbackArticles:e.chain(o).map(function(t){return e.get(n,"webhelp.".concat(t),[])}).flatMap().value()}})};return{getNotesForCurrentState:function(){var e=i.href(i.$current.name,{},{inherit:!1}).replace(/^\/|\/$/g,"");return a(e,n.getRealLanguage())},getNotesForPath:function(e){return a(e,n.getRealLanguage())}}}e.$inject=["_","router","language","$state"],angular.module("keenetic").factory("webHelpUiNotesService",e)}(),function(){function e(e,t,n,i,a,o,s,r){var l=this,c=null;l.isVisible=!1,l.isLoading=!1,l.isLongLoading=!1,l.isError=!1;var d=function(){if(l.isVisible){var e=i[0].querySelector("div.ndm-help-tooltip__container"),n=0,a=0;if(!("fixed"===(e.currentStyle?e.currentStyle.position:getComputedStyle(e,null).position))){var o=i[0].getBoundingClientRect(),s=e.getBoundingClientRect(),r=s.width,c=s.height,d=o.left,p=o.top,u=t.innerHeight,m=t.innerWidth;n=d+r>m?d+r-m:0,p-(a=p+c>u- -12?p+c-u-12:0)<10&&(a=p-10)}e.style.marginLeft=-n+"px",e.style.marginTop=-a+"px",e.style.opacity=1}},p={add:function(){n(function(){return t.addEventListener("click",p.handler)})},remove:function(){t.removeEventListener("click",p.handler)},handler:function(e){r.dom.isAncestor(i[0],e.target)||l.tooltipCtrl.close()}};e.$on("$destroy",p.remove),s(d,e);var u=function(){"$apply"!==e.$root.$$phase&&"$digest"!==e.$root.$$phase&&e.$apply()};l.tooltipCtrl={open:function(){l.isVisible||(l.isVisible=!0,p.add(),e.vm.webhelpId&&(l.isLoading=!0,l.isError=!1,l.isLongLoading=!1,n.cancel(c),c=n(function(){l.isLongLoading=!0},300),("current-state"===e.vm.webhelpId?o.getNotesForCurrentState():o.getNotesForPath(e.vm.webhelpId)).then(function(e){l.isLoading=!1,l.isLongLoading=!1,l.articles=a.get(e,"articles",[]),l.fallbackArticles=a.get(e,"fallbackArticles",[]),n.cancel(c),n(d)}).catch(function(){l.isError=!0,l.isLoading=!1,l.isLongLoading=!1,n.cancel(c)}).finally(function(){l.noArticles=0===l.articles.length&&0===l.fallbackArticles.length})),u(),n(d))},close:function(){l.isVisible&&(l.isVisible=!1,p.remove(),u())}}}e.$inject=["$scope","$window","$timeout","$element","_","webHelpUiNotesService","windowResizeWatcher","utils"],angular.module("keenetic").component("ndmHelp",{templateUrl:"app/components/ndm-help/ndm-help.html",restrict:"E",replace:!1,transclude:!0,bindings:{webhelpId:"@?",header:"@?",icon:"@?"},controller:e,controllerAs:"vm"})}(),function(){angular.module("keenetic").directive("ndmHeader",function(){return e.$inject=["$q","$rootScope","$timeout","$state","$window","$scope","$transitions","$document","CONSTANT","NDM","components","debounce","_","SimpleBar","utils","keyboard","search","convertLayout","browserCheck","router","MWSService"],{templateUrl:"app/components/ndm-header/ndm-header.html",restrict:"E",replace:!0,controller:e,controllerAs:"header"};function e(e,t,n,i,a,o,s,r,l,c,d,p,u,m,f,g,v,h,b,_,y){var S=this,w=l.events,C=w.MENU_TOGGLE,E=w.PAGE_LOADED,I=w.POPUP_OPENED,T=w.MENU_CLOSED;S.isReady=!1,S.deviceModel=f.getModelNameWithVendor(),S.deviceModelForLogo=f.getModelNameForLogo(),S.searchString="",S.internalSearchResults=[],S.kbSearchResults=[],S.kbMatched=!1,S.internalSearchMatched=!1,S.searchIsInProgress=!1,S.kbLastQuery="",S.isIE=b.isIE,S.searchRsltInFocusIdx=0,t.bodyPageClass="cp-body",t.getTranslation=f.getTranslation,t.uiViewOverlap=!1;var k={_bar:null,init:function(e){k._bar=new m(e,{autoHide:!1})},update:function(){k._bar&&k._bar.recalculate()},getScrollElement:function(){if(k._bar)return k._bar.getScrollElement()}},P=function(){if(S.l10n={noMatch:f.getTranslation("menu.search.no-match.text",null,{language:f.getTranslation("languages.".concat(f.getCurrentLanguage()))}),searchInputPlaceholder:f.getTranslation("menu.search.input-placeholder")},c.DEVICE_IS_MWS_MEMBER){var e=c.LAST_KNOWN_CONTROLLER_ADDRESS?f.l10n.getLinkChunks("controller",{class:f.EXTERNAL_LINK_CLASS,href:"http://".concat(c.LAST_KNOWN_CONTROLLER_ADDRESS),target:"_blank"}):{};S.l10n.controllerLink=f.getTranslation("wifi-system.notice.device-controlled-by-mws",null,e)}},A=function(e){if(S.searchRsltInFocusIdx=-1,S.focusIsOnKbResults=!1,!e)return S.internalSearchResults=[],void(S.kbSearchResults=[]);S.wasNoMatch=!S.internalSearchMatched&&!S.kbMatched;var t=f.getCurrentLanguage(),a=h.convert(e,t),o=u.chain(a).reduce(function(e,t){return u.union(e,[t])},[e]).uniq().value(),s=u.chain(o).reduce(function(e,t){var n=v.match(t);return u.union(e,n)},[]).groupBy("s").map(function(e){return e.length>1?u.maxBy(e,"rate"):e[0]}).groupBy(function(e){return u.get(e,"matchedValues.[1]","")||u.get(e,"matchedValues.[0]","")}).value(),r=u.flatMap(s,function(e){if(1===e.length)return e;var t=e.map(function(e){var t=e.text,n=e.title,i=n&&t!==n?" (".concat(n,")"):"";return Object.assign({},e,{text:t+i})});return u.uniqBy(t,"text")}),l=u.chain(r).map(function(e){return e.isCurrent=i.includes(e.sref),e.currentState=i.current.name,e.currentParams=i.params,e}).orderBy(["rate"],["desc"]).value(),c=l.length>10?l.filter(function(e){return e.wholeWordMatchesCount>0}):l;S.internalSearchResults=c.slice(0,15),S.internalSearchMatched=S.internalSearchResults.length>0,S.searchIsInProgress=!0;var d=v.matchKnowledgeBase(e),p=function(t){t&&t.query===e&&(S.kbSearchResults=[],S.kbMatched=!1),n(k.update)};d.request.then(function(e){if(!e)return void p({query:""});var t=e.kbMatches,i=e.query;if(i!==S.searchString)return;if(!t)return void p({query:i});S.kbSearchResults=t.map(function(e){var t=e.text.split(/\s+/g),n=t[t.length-1];return t[t.length-1]='<span class="no-wrap">'.concat(n,"</span>"),e.text=t.join(" "),e}),S.kbLastQuery=i,S.kbMatched=t.length>0,S.kbUrl=d.allResultsUrl,S.noMatch=!S.kbMatched&&0===S.internalSearchResults.length,n(k.update)},p).finally(function(){S.searchIsInProgress=!1,n(k.update)})},D=function(e){if(S.suggest){var t=".search__suggest-".concat(S.focusIsOnKbResults?"knowledge-base-matches":"internal-matches"),n=S.suggest.querySelector(t);if(n)return n.querySelector("li:nth-child(".concat(e+1,")"))}};S.getControllerAddress=function(){return y.queryControllerAddress().then(function(){P()})},S.closeSearchResults=function(){S.searchInputIsInFocus=!1,S.searchResultsAreVisible=!1,t.uiViewOverlap=!1},S.onSearchInputFocus=function(){S.searchInputIsInFocus=!0,S.searchString&&(S.searchResultsAreVisible=!0,t.uiViewOverlap=!0),k.update()},S.onSearchInputBlur=function(){S.searchInputIsInFocus=!1},o.$watch("header.searchString",function(e,n){if(e!==n){if(!e||e.length<2)return S.closeSearchResults(),void(S.internalSearchResults=[]);A(e),S.searchResultsAreVisible=!0,t.uiViewOverlap=!0}}),s.onSuccess({},function(){S.searchString=""}),S.onSearchInputKeyDown=function(e){if(!S.noMatch){var t=function(){S.focusIsOnKbResults=!S.focusIsOnKbResults&&S.kbSearchResults.length>0||0===S.internalSearchResults.length},n=function(){return S.focusIsOnKbResults?S.kbSearchResults.length:S.internalSearchResults.length};if(g.isEnter(e)&&S.searchRsltInFocusIdx>=0)if(S.focusIsOnKbResults){var i=D(S.searchRsltInFocusIdx);if(i){var a=i.querySelector("a");a&&a.click()}}else{var o=u.get(S,["internalSearchResults",S.searchRsltInFocusIdx]);if(o)return S.onSearchResultClick(e,o)}else g.isUpArrow(e)&&(e.preventDefault(),S.searchRsltInFocusIdx<=0&&(t(),S.searchRsltInFocusIdx=n()),--S.searchRsltInFocusIdx),g.isDownArrow(e)&&(e.preventDefault(),++S.searchRsltInFocusIdx,S.searchRsltInFocusIdx>=n()&&(t(),S.searchRsltInFocusIdx=0)),S.scrollToResultByIndex(S.searchRsltInFocusIdx)}},S.onSearchResultClick=function(e,n){if(!n.isCurrent||n.routeParams&&!function(e,t){for(var n=Object.keys(t),i=0,a=n.length;i<a;++i){var o=n[i];if(angular.isUndefined(e[o]))return!1;if(e[o]!==t[o])return!1}return!0}(i.params,n.routeParams)){var a=n.customReadyEvent||(n.isPopup?I:E),o=t.$on(a,function(){f.dom.highlightFirstMatchedElement(n.matchedValues),o()});i.go(n.sref,n.routeParams)}else f.dom.highlightFirstMatchedElement(n.matchedValues),S.searchString="",e.preventDefault();e.relatedTarget&&e.relatedTarget.blur(),S.closeSearchResults()},S.onSearchResultHover=function(e,t,n,i){!b.isMobile||t?(S.searchRsltInFocusIdx=e,S.focusIsOnKbResults=t,S.scrollToResultByIndex(e)):S.onSearchResultClick(n,i)},S.clearSearchString=function(){S.searchString="",S.searchResultsAreVisible=!1,t.uiViewOverlap=!1},S.scrollToResultByIndex=function(e){var t=D(e);if(t&&S.scrollEl){var n=S.suggest.getBoundingClientRect(),i=t.getBoundingClientRect();if(!S.focusIsOnKbResults&&0===e)return void(S.scrollEl.scrollTop=0);var a=0;i.bottom>n.bottom?a+=i.bottom-n.bottom+40:i.top<n.top&&(a+=i.top-n.top-40),S.scrollEl.scrollTop+=a}},S.menuToggle=function(){t.$broadcast(C)};var O=o.$watch(function(){return r[0].querySelector(".search__matches")},function(e){e&&(S.suggest=e,k.init(e),S.scrollEl=k.getScrollElement(),O())});P(),o.$on("$destroy",t.$on("$translateChangeSuccess",function(){n(function(){P(),A(S.searchString)})})),o.$on("$destroy",t.$on(T,k.update))}})}(),function(){angular.module("keenetic").directive("ndmFormTitle",function(){return{templateUrl:"app/components/ndm-form-title/ndm-form-title.html",replace:!0,transclude:!0,scope:{title:"@label",text:"<"}}})}(),function(){angular.module("keenetic").directive("ndmFormHeader",function(){return{templateUrl:"app/components/ndm-form-header/ndm-form-header.html",replace:!0,transclude:!0,scope:{hr:"@",title:"@label",subTitle:"@"}}})}(),function(){angular.module("keenetic").directive("ndmFieldset",function(){return{replace:!0,transclude:!0,templateUrl:"app/components/ndm-fieldset/ndm-fieldset.html",scope:{className:"@",isDisabled:"<"}}})}(),function(){function e(e,t,n,i,a){var o={},s=function(e){console.log("noticeService.showLearnMoreModal: ".concat(e,"; IMPLEMENT ME!"))},r=function(e){console.log("noticeService.runWizard: ".concat(e,"; IMPLEMENT ME!"))};return{FEATURE_SET_COMPLETED_EVENT:"ndm:feature-set-completed",registerFeature:function(e,t,n){var a,l=arguments.length>3&&void 0!==arguments[3]&&arguments[3],c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",d=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{},p=[];l&&p.push({label:"ndm-feature-notice.btn.run-wizard",action:function(){return r(e)}}),p.push({label:"ndm-feature-notice.btn.learn-more",action:function(){return s(e)}}),p[0].className="btn--blue",o[e]=Object.assign({title:t,description:n,buttons:p,descriptionForMobile:c,envFlag:(a=e,"".concat("NDW_").concat(i.camelCase(a)))},d)},getCompletionState:function(){return a.get("show/environment").then(function(e){return i.mapValues(o,function(t){return Object.assign({},t,{isWizardCompleted:Boolean(i.get(e,t.envFlag))})})})},setFeatureCompleted:function(t){return o[t]?(n.$emit("ndm:feature-set-completed",t),a.postAndSave({parse:"system environment set ".concat(o[t].envFlag," 1")}).then(function(){return!0},function(){return!1})):(console.warn('Unknown marketing feature: "'.concat(t,'"')),e.when(!1))}}}e.$inject=["$q","$window","$rootScope","_","router"],angular.module("keenetic").factory("noticeService",e)}(),function(){function e(e,t,n){return{registerMWSFeature:function(){var i={buttons:[{label:"ndm-feature-notice.btn.learn-more",className:"btn--blue",action:function(){return e.showMwsModal(function(){return t.setFeatureCompleted(n.MARKETING_NOTICE_NAME)})}}]};t.registerFeature(n.MARKETING_NOTICE_NAME,"wifi-system.marketing-notice.title","wifi-system.marketing-notice.description",!0,"wifi-system.marketing-notice.description-mobile",i)}}}e.$inject=["modalFactory","noticeService","MWSConstants"],angular.module("keenetic").factory("noticeFactory",e)}(),function(){function e(e,t,n,i,a,o,s,r,l){var c=this;c.activeFeatureIndex=0,c.showNextFeature=function(){c.activeFeatureIndex=(c.activeFeatureIndex+1)%c.features.length},c.onFeatureBtnClick=function(t,n){var i=e.get(t,["buttons",n],{});e.isFunction(i.action)&&i.action()};c.skipFeature=function(e){var n=e.name;t.when(l.setFeatureCompleted(n))};var d=function(){c.features=c.features.map(function(e){var t=i.innerWidth<768?"ndm-feature-notice.title-mobile":"ndm-feature-notice.title",n=s.getTranslation(t,null,{title:s.getTranslation(e.title)}).split("<br/>").map(function(e){return e.replace(/^\s+/,"")});return Object.assign({},e,{titleChunks:n})})},p=function(){d(),c.isMobile=i.innerWidth<768};r(p,n,0),c.$postLink=function(){p()},c.$onChanges=function(e){e.features&&d()},c.updateTitlesHandler=a.$on("$translateChangeSuccess",d),c.onFeatureSetCompletedHandler=a.$on(l.FEATURE_SET_COMPLETED_EVENT,function(t,i){!function(t){c.features=c.features.filter(function(e){return e.name!==t}),c.activeFeatureIndex===c.features.length&&(c.activeFeatureIndex=0),e.isEmpty(c.features)&&(c.$onDestroy(),o.remove(),n.$destroy())}(i)}),c.$onDestroy=function(){c.onFeatureSetCompletedHandler(),c.updateTitlesHandler()}}e.$inject=["_","$q","$scope","$window","$rootScope","$element","utils","windowResizeWatcher","noticeService"],angular.module("keenetic").component("ndmFeatureNotice",{templateUrl:"app/components/ndm-feature-notice/ndm-feature-notice.html",bindings:{features:"<",onAllFeaturesClosed:"<"},controller:e})}(),function(){function e(e){var t;return _defineProperty(t={},"restrict","C"),_defineProperty(t,"link",function(t,n){n[0].style.opacity=.01,n[0].setAttribute("class",(n[0].getAttribute("class")||"")+" external-link--is-directive-driven"),e(function(){var e=function e(t){for(var n=[],i=0;i<t.childNodes.length;i++)3===t.childNodes[i].nodeType&&t.childNodes[i].textContent.replace(/(?:\r\n|\r|\n)/g,"").trim()&&n.push(t.childNodes[i]),n=n.concat(e(t.childNodes[i]));return n}(n[0]);if(e.length){var i=e.pop(),a=i.data.replace(/(?:\r\n|\r|\n)/g,"").trim().split(" "),o=a.pop();i.data=a.join(" "),i.parentElement.innerHTML+=' <span class="'.concat("external-link__last-word",'">').concat(o,"</span>")}n[0].style.opacity=n.hasClass("external-link--disabled")?.4:1,t.$watch(function(){return n.hasClass("external-link--disabled")},function(e){n[0].style.opacity=e?.4:1})})}),t}e.$inject=["$timeout"],angular.module("keenetic").directive("externalLink",e)}(),function(){function e(e,t,n,i,a,o,s,r,l,c,d,p,u,m){var f=this;f.close=e,f.saving=!1,f.previewMode=Boolean(t),f.saveBtnLabel=t?"ok":"eula.agree",f.loading=!0,f.eulaHtml="",f.allowCancelling=Boolean(t)||!n;var g=function(){return u[0].querySelector(".eula-modal__agreement")};f.agree=function(){f.saving||(!t&&n?(f.saving=!0,a().then(function(){return e(!0)})):e(!0))},f.cancel=function(){e(!1)},c.dom.toggleTextSelection(!1),l.$on("$destroy",function(){return c.dom.toggleTextSelection(!0)}),f.loading=!0,i().then(function(e){f.loading=!1,f.eulaHtml=p(e),m(function(){return e=g().querySelectorAll("a[href]"),void o.forEach(e,function(e){var t=e.getAttribute("href");t&&"#"===t[0]?(e.removeAttribute("href"),e.onclick=function(){return c.dom.scrollToAnchor(g(),t.substring(1))}):t&&e.setAttribute("target","_blank")});var e})})}e.$inject=["close","isInReviewMode","shouldAcceptLicense","getLicenseText","acceptLicense","_","$document","modal","$scope","utils","licensesService","marked","$element","$timeout"],angular.module("keenetic").controller("NdmEulaModalController",e)}(),function(){function e(e,t,n,i,a,o,s){return{replace:!0,transclude:!1,templateUrl:"app/components/ndm-edit-in-place/ndm-edit-in-place.html",scope:{className:"@",subtext:"@",label:"@",placeholder:"@",name:"@",model:"=",isLocked:"<",validation:"@",validationData:"<",onPlaceholderClick:"&",onEditingStart:"&",onSubmit:"&",onCancel:"&"},link:function(r,l){var c,d,p,u=[];r.isValid=!0,r.editorIsStarting=!1,r.editorIsVisible=!1,r.editorIsLocked=!1,r.userAgentIsFf=s.isFirefox;var m=angular.isFunction(r.onEditingStart())?r.onEditingStart():angular.noop,f=angular.isFunction(r.onSubmit())?r.onSubmit():angular.noop,g=angular.isFunction(r.onCancel())?r.onCancel():angular.noop,v=angular.isFunction(r.onPlaceholderClick())?r.onPlaceholderClick():function(){return!0};r.showEditor=function(){r.editorIsVisible||(r.editorIsLocked=!1,r.editorIsVisible=!0,r.editorIsStarting=!0,c=r.model,e(function(){p[0].focus(),r.editorIsStarting=!1,m(r.model)}))},r.finishEditing=function(){r.editorIsLocked=!1,r.editorIsVisible=!1},r.acceptChanges=function(){r.editorIsVisible&&(r.editorIsLocked=!0,n.when(f(r.model,c,r.name)).finally(r.finishEditing))},r.cancelChanges=function(){r.editorIsVisible&&(r.editorIsLocked=!0,r.model=c,n.when(g(r.model,r.name)).finally(r.finishEditing))},r.onInputBlur=function(){r.editorIsVisible&&(r.ngModel.$invalid||r.acceptChanges())},r.onKeydown=function(e){if(r.isLocked||!o.isSpace(e))return!0;e.preventDefault(),r.showEditor()},r.onPlaceholderClick=function(e){if(!1===v(r.model,r.name))return e.stopPropagation(),void e.preventDefault();r.showEditor()};var h=function(e){r.editorIsVisible&&(o.isEnter(e)&&!r.ngModel.$invalid?r.acceptChanges():o.isEscape(e)&&r.cancelChanges())},b=function(e){e&&e.target&&r.editorIsVisible&&!r.editorIsStarting&&(a.dom.isAncestor(d,e.target)||r.onInputBlur())},_=function(){return"ontouchstart"in window||navigator.maxTouchPoints},y=function(){return e(b)},S=r.$watch(function(){return l[0].querySelector("input")},function(n){n&&(d=l[0].querySelector(".ndm-input"),p=angular.element(n),r.ngModel=p.controller("ngModel"),e(function(){_()&&t.on("touchstart",y),t.on("click",b),u.push(function(){t.off("click",b),_()&&t.off("touchstart",y)})}),p.on("keyup",h),u.push(function(){return p&&p.off("keyup",h)}),S())});r.$on("$destroy",function(){return u.forEach(function(e){return e()})}),r.validationData=i.extend({name:r.name},r.validationData||{})}}}e.$inject=["$timeout","$document","$q","_","utils","keyboard","browserCheck"],angular.module("keenetic").directive("ndmEditInPlace",e)}(),function(){function e(e,t,n,i,a){var o=this,s=[];o.isLoading=!0,o.isLocked=!1,o.countries=[],o.ispList=[],o.country="",o.ispId="",o.ispData=null,o.showAuth=!1,o.login="",o.password="";var r=function(e,t){var n=t?"hidden":"text",a="".concat(e?".ndm-dsl-isp-select__isp":".ndm-dsl-isp-select__country"," input[type=").concat(n,"]");return angular.element(i[0].querySelector(a))},l=function(){r(!1,!1)[0].focus(),r(!1,!0).scope().$ctrl.showOptions()},c=function(){return o.isLocked=!0,t.getCountryIspOptionsList(o.country).then(function(e){o.ispList=e,o.onIspSelected(0),1===o.ispList.length?(o.ispId=o.ispList[0].id,a(function(){return o.onIspSelected(o.ispId)})):(r(!0,!1).scope().model="",a(function(){r(!0,!1)[0].focus(),r(!0,!0).scope().$ctrl.showOptions()},100)),o.isLocked=!1})};o.onIspSelected=function(t){var n=e.find(s,{id:t});o.ispData=t?e.clone(n):{},o.showAuth=t&&o.ispData.hasPppoeTunnel};var d=function(){return o.isLocked=!0,t.getCountryOptionsList().then(function(e){o.countries=e,o.country&&o.onCountrySelected(),o.isLocked=!1})};o.onCountrySelected=function(){return a(function(){return c()})},o.$onInit=function(){return t.getAll().then(function(e){return s=e,o.isLoading=!1,d()}).then(function(){o.autoFocus&&"0"!==o.autoFocus&&a(l,500)})}}e.$inject=["_","dslIspDb","utils","$element","$timeout"],angular.module("keenetic").component("ndmDslIspSelect",{templateUrl:"app/components/ndm-dsl-isp-select/ndm-dsl-isp-select.html",restrict:"E",replace:!0,transclude:!1,bindings:{disabled:"<?",ispData:"=?",autoFocus:"@?"},controllerAs:"vm",controller:e})}(),function(){function e(e,t,n,i,a,o,s,r,l,c,d,p,u){var m=this;m.close=e,m.saving=!1,m.previewMode=Boolean(t),m.saveBtnLabel=t?"ok":"dpn.agree",m.loading=!0,m.eulaHtml="",m.isFullTextVisible=!1,m.dpnTextData={},m.allowCancelling=Boolean(t)||!n;var f=function(){return p[0].querySelector(".dpn-modal__agreement")};m.switchText=function(e){m.dpnHtml=e?m.dpnTextData.fullText:m.dpnTextData.shortText,u(function(){return e=f().querySelectorAll("a[href]"),void o.forEach(e,function(e){var t=e.getAttribute("href");t&&"#"===t[0]?(e.removeAttribute("href"),e.onclick=function(){return d.dom.scrollToAnchor(f(),t.substring(1)),m.switchText(!0),m.isFullTextVisible=!0,!1}):t&&e.setAttribute("target","_blank")});var e})},m.agree=function(){m.saving||(!t&&n?(m.saving=!0,a().then(function(){return e(!0)})):e(!0))},m.cancel=function(){e(!1)},d.dom.toggleTextSelection(!1),l.$on("$destroy",function(){return d.dom.toggleTextSelection(!0)}),m.loading=!0,i().then(function(e){var t=e.slice(0,e.indexOf("##")),n=e.replace(t,""),i=n.indexOf('<a name="F"></a>'),a=n.lastIndexOf("##",i),s=t+n.slice(0,a),r=t+n.slice(a);m.dpnTextData=o.mapValues({shortText:s,fullText:r},function(e){return c(e)}),m.switchText(!1),m.loading=!1})}e.$inject=["close","isInReviewMode","shouldAcceptLicense","getLicenseText","acceptLicense","_","$document","modal","$scope","marked","utils","$element","$timeout"],angular.module("keenetic").controller("NdmDpnModalController",e)}(),function(){t.$inject=["$rootScope","$timeout","utils","notification","NDM","_"],angular.module("keenetic").directive("ndmDisabledByMwsTooltip",t);var e={"ndm-checkbox":".checkbox","ndm-input":".ndm-input__cell"};function t(t,n,i,a,o,s){return{restrict:"A",link:function(r,l,c){var d=l.attr("title"),p=c.ndmDisabledByMwsTooltip||".form__cell",u="",m=null,f=function e(t){var i,a="@"===(i=p)?l:angular.element(l[0].querySelector(i));0===a.length?n(function(){return e(o.DEVICE_IS_MWS_MEMBER)},500):a.attr("title",t?u:d)},g=function(){u=i.getTranslation("wifi-system.notice.parameter-controlled-by-mws"),f(o.DEVICE_IS_MWS_MEMBER)};g(),r.$watch(function(){return o.DEVICE_IS_MWS_MEMBER},function(e){f(),e?h():b()});var v=function(){a.info("wifi-system.notice.parameter-controlled-by-mws")},h=function(){m||(m=function(t){if(!l[0])return l;var n=s.find(e,function(e,t){return l[0].classList.contains(t)});if(n)return angular.element(l[0].querySelector(n));if("@"!==t)return angular.element(l[0].querySelector(t));return l}(p)),m.on("click",v)},b=function(){m&&m.off("click",v)};r.$on("$destroy",t.$on("$translateChangeSuccess",function(){return n(g)})),r.$on("$destroy",b)}}}}(),function(){function e(e,t,n,i,a,o,s){var r=this,l=o.getAllBandsL10n(!1);r.l10n={header:r.header||"ndm-device-wifi-band.header",getSegmentNotice:function(e){if(!n.has(e,"uiWifiBands"))return"";var t=e.uiWifiBands.length>0?"ndm-device-wifi-band.notification.segment-has-only-band":"ndm-device-wifi-band.notification.segment-has-no-wi-fi",a=Object.assign({},i.l10n.getSrefChunks("controlPanel.segments({tab: '".concat(e.description,"'})"),{},"ref"),{band:n.get(l,e.uiWifiBands[0],"")});return i.getTranslation(t,null,a)}},r.options=s.getBandRestrictionOptions(),r.isInitialized=!1,r.$onInit=function(){n.isEmpty(r.restrictions)?(r.segmentsData&&n.every(r.segmentsData,function(e){return n.has(e,"iseg")})?t.when(r.segmentsData):a.getSegments()).then(function(e){r.restrictions=r.mac?s.getDeviceConfiguration(e,r.mac):s.getDefaultDeviceConfiguration(e),r.isInitialized=!0}):r.isInitialized=!0}}e.$inject=["$scope","$q","_","utils","interfaces","wifiOptions","deviceWifiBand"],angular.module("keenetic").component("ndmDeviceWifiBand",{templateUrl:"app/components/ndm-device-wifi-band/ndm-device-wifi-band.html",bindings:{name:"@",mac:"@",header:"@",restrictions:"=",segmentsData:"<"},controller:e,controllerAs:"vm"})}(),function(){function e(e,t,n,i,a,o){var s=o.WIFI_BAND_2_GHZ,r=o.WIFI_BAND_5_GHZ,l={ALLOW_BOTH:"ALLOW_BOTH",ALLOW_2_GHZ_ONLY:"ALLOW_2_GHZ_ONLY",ALLOW_5_GHZ_ONLY:"ALLOW_5_GHZ_ONLY"},c=function(e){return"0"===e?s:r},d=function(e,t){return 2!==t.length&&e.hasBothBands?t.includes(s)?l.ALLOW_2_GHZ_ONLY:l.ALLOW_5_GHZ_ONLY:l.ALLOW_BOTH},p=function(n){var i=n.id,o=n.description,s=a.getSegmentAccessPoints(n),r=s.some(function(e){return e.startsWith(t.MASTER)}),l=s.some(function(e){return e.startsWith(t.MASTER_5G)}),d=r&&l,p=e.filter([r?"0":"",l?"1":""]);return{id:i,description:o,hasBothBands:d,uiWifiBands:p.map(c),ndmBands:p,bandRestrictions:e.get(n,"mac.band",[])}};return{BAND_RESTRICTION:l,getDefaultDeviceConfiguration:function(t){return e.map(t,function(e){var n=p(e),i=t.ndmBands.map(c),a=d(n,i);return Object.assign({},n,{deviceBands:i,deviceBandRestriction:a,initialDeviceBandRestriction:a})})},getDeviceConfiguration:function(t,n){return e.map(t,function(e){var t=p(e),i=t.ndmBands,a=t.bandRestrictions.reduce(function(e,t){return t.mac===n?[t.band]:e},i).map(c),o=d(t,a);return Object.assign({},t,{deviceBands:a,deviceBandRestriction:o,initialDeviceBandRestriction:o})})},getBandRestrictionOptions:function(){var e=o.getAllBandsL10n(!1),t="ndm-device-wifi-band.option";return[{id:l.ALLOW_BOTH,name:n.getTranslation("".concat(t,".allow-both-bands"))},{id:l.ALLOW_2_GHZ_ONLY,name:n.getTranslation("".concat(t,".allow-band"),null,{band:e[s]})},{id:l.ALLOW_5_GHZ_ONLY,name:n.getTranslation("".concat(t,".allow-band"),null,{band:e[r]})}]},getWifiBandRestrictionQueries:function(t,n){return e.chain(t).map(function(t){if(t.initialDeviceBandRestriction===t.deviceBandRestriction)return!1;var i=["interface",t.id,"mac","band"];if(t.deviceBandRestriction===l.ALLOW_BOTH)return e.set({},i,{mac:n,no:!0});var a=t.deviceBandRestriction===l.ALLOW_2_GHZ_ONLY?"0":"1";return e.set({},i,{mac:n,band:a})}).filter().value()},updateSegmentsData:function(t,n,i){return e.mapValues(t,function(t){var a=e.find(n,function(e){return e.id===t.id});if(!a||a.initialDeviceBandRestriction===a.deviceBandRestriction)return t;var o="mac.band",s=e.get(t,o,[]).filter(function(e){return e.mac!==i});if(a.deviceBandRestriction===l.ALLOW_BOTH)return e.set(t,o,s);var r=a.deviceBandRestriction===l.ALLOW_2_GHZ_ONLY?"0":"1";return e.set(t,o,[].concat(_toConsumableArray(s),[{mac:i,band:r}]))})}}}e.$inject=["_","NDM","utils","router","interfaces","wifiOptions"],angular.module("keenetic").factory("deviceWifiBand",e)}(),function(){function e(e,t,n,i){var a=this;a.l10n={header:a.header||"ndm-device-wifi-acl.header",noAclsConfigured:n.getTranslation("ndm-device-wifi-acl.no-acls-configured",null,{ref:n.generateSrefLinkHtml(n.getTranslation("menu.wireless-acl"),"controlPanel.wirelessAcl")}),getDescription:function(e){return n.getTranslation("ndm-device-wifi-acl.acl-is-not-enabled",null,n.l10n.getSrefChunks("controlPanel.wirelessAcl({tab: '".concat(e,"'})"),{},"ref"))}},a.options=[i.ACL_TYPE_PERMIT,i.ACL_TYPE_DENY].map(function(e){return{id:e,name:n.getTranslation("ndm-device-wifi-acl.mode.".concat(e))}});var o=function(){a.permissions=a.permissions||{},a.mac||t.forEach(a.segmentsData,function(e){e.includesAccessPoints&&e.acl.type!==i.ACL_TYPE_NONE&&(a.permissions[e.id]=i.ACL_TYPE_PERMIT)}),t.forEach(a.segmentsData,function(e){e.includesAccessPoints&&!a.permissions[e.id]&&(a.permissions[e.id]=!1)}),a.segmentIds=Object.keys(a.permissions)},s=e.$watch("$ctrl.permissions",o),r=function(e){return t.every(e,["acl.type",i.ACL_TYPE_NONE])};a.$onDestroy=function(){return s},a.$onInit=function(){a.segmentsData?(a.noAcls=r(a.segmentsData),o()):i.getAclConfiguration().then(function(e){a.segmentsData=e.segments,a.noAcls=r(a.segmentsData),o()})}}e.$inject=["$scope","_","utils","wirelessAcl"],angular.module("keenetic").component("ndmDeviceWifiAcl",{templateUrl:"app/components/ndm-device-wifi-acl/ndm-device-wifi-acl.html",bindings:{name:"@",mac:"@",permissions:"=",segmentsData:"<"},controller:e})}(),function(){function e(e,t,n,i){var a,o=this;o.interval=Number(o.interval),o.requestTimeout=Number(o.requestTimeout),o.onDataUpdate=o.onDataUpdate||angular.noop,(isNaN(o.interval)||o.interval<0)&&(o.interval=5e3),(isNaN(o.requestTimeout)||o.requestTimeout<0)&&(o.requestTimeout=4e3,o.requestTimeout<o.interval&&(o.requestTimeout=o.interval)),o.$onDestroy=function(){n.get(a,"resolve",n.noop)()},o.polling=function(){var n=e.defer(),s=t(function(){a=null,n.resolve()},o.requestTimeout),r=function(){s&&t.cancel(s)};return a=n,i.get({url:"show/version",noRetry:!0,timeout:n.promise}).then(function(e){r(),o.onDataUpdate(e)},function(){r(),o.onDataUpdate({offline:!0})})}}e.$inject=["$q","$timeout","_","router"],angular.module("keenetic").component("ndmDevicePoller",{templateUrl:"app/components/ndm-device-poller/ndm-device-poller.html",bindings:{interval:"<?",requestTimeout:"<?",onDataUpdate:"<"},controller:e})}(),function(){function e(e,t,n,i){var a=this;a.onShow=a.onShow||angular.noop,a.onHide=a.onHide||angular.noop,a.showLink=!0,a.onToggle=a.onToggle||angular.noop,a.setToggleState=angular.isFunction(a.setToggleState)?a.setToggleState():angular.noop,a.linkClass=angular.isDefined(a.linkClass)?String(a.linkClass):"",a.transcludeClass=angular.isDefined(a.transcludeClass)?String(a.transcludeClass):"form--sub",(a.labelHidden||a.labelVisible)&&(a.labelFn=function(t){return t?e.getTranslation(a.labelHidden):e.getTranslation(a.labelVisible)}),angular.isUndefined(a.toggleVar)&&(a.toggleVar=!1),a.labelFn||(a.showLink=!1),a.alwaysShown&&(a.toggleVar=!0,a.showLink=!1),a.toggleFn=function(){a.toggleVar=!a.toggleVar,a.onToggle({state:a.toggleVar,el:n}),a.toggleVar?(a.onShow(n),i(function(){var e=n[0].querySelectorAll("[tabindex], input")[1];e&&e.focus()})):a.onHide(n)},a.onKeydown=function(e){if(!t.isSpace(e)||a.disabled)return!0;e.preventDefault(),a.toggleFn()}}e.$inject=["utils","keyboard","$element","$timeout"],angular.module("keenetic").component("ndmDetails",{templateUrl:"app/components/ndm-details/ndm-details.html",restrict:"E",replace:!0,transclude:!0,bindings:{toggleVar:"=?",labelHidden:"@",labelVisible:"@",labelFn:"<",description:"@",onShow:"&",onHide:"&",onToggle:"<",linkClass:"@",transcludeClass:"@",className:"@",alwaysShown:"<",disabled:"<"},controller:e})}(),function(){angular.module("keenetic").directive("ndmDectPreloader",function(){return{templateUrl:"app/components/ndm-dect-preloader/ndm-dect-preloader.html",restrict:"E"}})}(),function(){function e(e,t){var n=this,i=null;n.interval=Number(n.interval),(isNaN(n.interval)||n.interval<0)&&(n.interval=5e3),n.onDataUpdate=n.onDataUpdate||angular.noop,n.polling=function(){return t.check(!1,!n.noDectStatus).then(function(t){t.plugged||i?t.plugged&&i&&(e.hide(i),i=null):i=e.error("dect.errors.base-unplugged",-1),n.onDataUpdate(t)})}}e.$inject=["notification","dectCheck"],angular.module("keenetic").component("ndmDectChecker",{templateUrl:"app/components/ndm-dect-checker/ndm-dect-checker.html",restrict:"E",replace:!0,bindings:{noDectStatus:"<",interval:"<?",onDataUpdate:"<"},controller:e})}(),function(){function e(e,t){var n=this;n.isCopied=!1,n.copyToClipboard=function(){t.copyToClipboard(n.text),n.isCopied=!0,e(function(){n.isCopied=!1},3e3)}}e.$inject=["$timeout","utils"],angular.module("keenetic").component("ndmCopyToClipboard",{templateUrl:"app/components/ndm-copy-to-clipboard/ndm-copy-to-clipboard.html",replace:!0,transclude:!0,bindings:{text:"@",hideText:"<"},controller:e,controllerAs:"vm"})}(),function(){function e(e,t,n,i,a,o,s,r){return{restrict:"E",templateUrl:"app/components/ndm-control-footer/ndm-control-footer.html",link:function(t,i,a){t.saveLabel=t.saveLabel||"save",t.cancelLabel=t.cancelLabel||"cancel",t.swapCtrls="swapCtrls"in a,t.$on("$destroy",n.$on(s.events.DEVICE_IS_OFFLINE,function(){t.deviceIsOffline=!0})),t.$on("$destroy",n.$on(s.events.DEVICE_IS_ONLINE,function(){t.deviceIsOffline=!1})),a.isSaveVisible||(t.isSaveVisible=function(){return!0});a.isCancelVisible||(t.isCancelVisible=function(){return!0});var o;if(t.drawSaveButtonAsDisabled=Boolean(t.isSaveDisabled),t.$watch("isSaveDisabled",function(n){var i;e.cancel(o),i=angular.isNumber(t.saveDisabledTimeout)?parseInt(t.saveDisabledTimeout,10):n?500:50,o=e(function(){t.drawSaveButtonAsDisabled=Boolean(t.isSaveDisabled)},i)}),t.isPopup){for(var l=function(e){return"changesCheckerFunction"in e},c=t;c.$parent&&!l(c);)c=c.$parent;var d=c;l(d)&&t.$watch("isVisible",function(e){var t;d.popupFooterVisible=Boolean(e),"$apply"!==(t=d).$root.$$phase&&"$digest"!==t.$root.$$phase&&t.$apply()})}var p=angular.noop,u=angular.noop;e(function(){a.cancel&&t.cancel&&(p=")"===a.cancel.slice(-1)?t.cancel:t.cancel()),a.save&&t.save&&(u=")"===a.save.slice(-1)?t.save:t.save())}),t.onKeydown=function(e){r.isSpace(e)&&(e.preventDefault(),e.stopPropagation(),t.clickOnCancel())},t.clickOnSave=function(){if(!t.isSaveDisabled&&!t.deviceIsOffline){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];u.apply(u,n)}},t.clickOnCancel=function(){for(var n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];var s=t.form;s&&(s.modified=!1,s.modifiedModels.forEach(function(e){return e.reset()}),s.modifiedChildForms.forEach(function(e){return e.reset()})),a.cancel&&e(function(){return p.apply(p,i)},100)}},replace:!0,transclude:!1,scope:{saveDisabledTimeout:"<",saveLabel:"@",cancelLabel:"@",isSaveDisabled:"=",isVisible:"=",isCancelVisible:"&",isSaveVisible:"&",swapCtrls:"&",form:"=",isPopup:"<",save:"&",cancel:"&",prefix:"@"}}}e.$inject=["$timeout","$state","$rootScope","$transitions","$window","modal","router","keyboard"],angular.module("keenetic").directive("ndmControlFooter",e)}(),function(){angular.module("keenetic").directive("ndmCheckboxList",function(){return{require:"^ngController",templateUrl:"app/components/ndm-checkbox-list/ndm-checkbox-list.html",replace:!0,link:n,scope:{options:"<",model:"=",name:"@",nobr:"@",title:"@label",isDisabled:"<",onChange:"&"}}});var e=function(e){return Object.keys(e).map(function(t){return{id:t,label:e[t]}})},t=function(e){return e.map(function(e){return{id:e,label:e}})};function n(n){n.modelToArray=function(){n.model=n.options.filter(function(e){return e.checked}).map(function(e){return e.id})},!angular.isArray(n.options)&&angular.isObject(n.options)&&(n.options=e(n.options)),angular.isArray(n.options)&&!angular.isObject(n.options[0])&&(n.options=t(n.options)),n.$watch("model",function(){n.options.map(function(e){return e.checked=angular.isArray(n.model)&&n.model.indexOf(e.id)>-1,e})},!0)}}(),function(){function e(e){return{templateUrl:"app/components/ndm-checkbox/ndm-checkbox.html",replace:!0,transclude:!0,scope:{model:"=",disabled:"<",title:"@label",description:"@",name:"@",onChange:"&",onValueChange:"<",hint:"@"},link:function(t){t._onChange=angular.isFunction(t.onChange)?t.onChange:angular.noop,t._onValueChange=angular.isFunction(t.onValueChange)?t.onValueChange:angular.noop,t._onKeydown=function(n){if(!e.isSpace(n))return!0;n.preventDefault(),t._click(n)},t._click=function(e){e.stopPropagation(),e.preventDefault(),t.disabled||(t.model=!t.model,t._onChange(),t._onValueChange(t.model,t.name))}}}}e.$inject=["keyboard"],angular.module("keenetic").directive("ndmCheckbox",e)}(),function(){function e(e,t){return{require:"^ngController",templateUrl:"app/components/ndm-chart/ndm-chart.html",transclude:!1,replace:!1,link:function(n){var i=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:angular.identity,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.2,i=function(e,i,a){var o,s,r,l,c=arguments.length>3&&void 0!==arguments[3]&&arguments[3],d=i||e,p=a||e,u=(o=d,r=(s=p).x-o.x,l=s.y-o.y,{length:Math.sqrt(Math.pow(r,2)+Math.pow(l,2)),angle:Math.atan2(l,r)}),m=u.angle+(c?Math.PI:0),f=u.length*n;return t({x:e.x+Math.cos(m)*f,y:e.y+Math.sin(m)*f})};return function(e,t){return e.reduce(function(e,n,i,a){return 0===i?"M ".concat(n.x,",").concat(n.y):"".concat(e," ").concat(t(n,i,a))},"")}(e,function(e,t,n){var a=i(n[t-1],n[t-2],e),o=i(e,n[t-1],n[t+1],!0);return"C ".concat(a.x,",").concat(a.y," ").concat(o.x,",").concat(o.y," ").concat(e.x,",").concat(e.y)})};n.isFirefox=t.isFirefox,n.formatYLabel=angular.isFunction(n.formatYLabel)?n.formatYLabel:angular.identity,n._axesNumX=n.axesNumberX||20,n._axesNumY=n.axesNumberY||5,n.$watch("axesNumberX",function(e){!isNaN(parseInt(e,10))&&Number(e)>0&&(n._axesNumX=e)}),n.$watch("axesNumberY",function(e){!isNaN(parseInt(e,10))&&Number(e)>0&&(n._axesNumY=e)}),n.$watch("model",function(){n.data=[];var t=angular.copy(n.model),a=[];e.isArray(t)||(t=[t]),n.data=t.filter(function(e){return e&&e.data}).map(function(e){var t,o,s="",r=e.data;r.forEach(function(e){return a.push(e.y)}),n.maxY>0&&(t=r,o=1/n.maxY*n.height,r=t.map(function(e){return Object.assign({},e,{y:e.y*o})}));var l=0,c=0,d=n.isAxesLabelsVisibleY?n.width-20:n.width;if(n.smooth){var p=[{x:0,y:0}].concat(r).concat([{x:r.length+1,y:0}]),u=[];p.forEach(function(e){l=e.x*d/(n.maxX||p.length-1)+5,u.push({x:l,y:e.y})}),s=i(u,function(e){return{x:e.x,y:Math.max(0,e.y)}})}else{var m=!0;r.forEach(function(e){if(l=e.x*d/(n.maxX||r.length-1)+5,c=e.y,m){var t=n.isAxesLabelsVisibleY?"5":"-1";s+=l<5?t:l+",0 ",l<5&&(s+=t+","+c+" "),m=!1}s+=l+","+c+" "}),s+=l+","+c+" ",s+=l+",0"}return{color:e.color,points:s}}),n.maxY=n.maxY||1.1*Math.max.apply(null,a)})},restrict:"E",scope:{model:"<",title:"<header",height:"@",width:"@",anchorLeft:"<",anchorRight:"<",axesNumber:"<?",axesNumberX:"<?",isAxesLabelsVisibleX:"<?",isAxesLabelsVisibleY:"<?",xLabels:"<?",formatYLabel:"<?",maxY:"=?",maxX:"=?",label:"=?",isLoading:"=?",legend:"<?",smooth:"<?"}}}e.$inject=["_","browserCheck"],angular.module("keenetic").directive("ndmChart",e)}(),function(){angular.module("keenetic").component("ndmButtonNew",{templateUrl:"app/components/ndm-button-new/ndm-button-new.html",bindings:{isDisabled:"<",btnClass:"@",btnText:"@",onClick:"<"},controller:function(){},controllerAs:"vm"})}(),function(){function e(e,t){return{templateUrl:"app/components/ndm-button-list/ndm-button-list.html",replace:!0,transclude:!1,scope:{options:"=",inColumns:"&",name:"=",model:"=",title:"@label",allowMultiple:"@",onChange:"&",btnClass:"@",showStatusIcon:"@"},link:function(n,i,a){n.btnClass=angular.isString(a.btnClass)?a.btnClass:"",n.allowMultiple=!angular.isString(a.allowMultiple)&&Boolean(a.allowMultiple)||angular.isString(a.allowMultiple)&&"true"===a.allowMultiple,n.options=n.options.slice()||[],n.inColumns="inColumns"in a,n.allowMultiple&&(n.model=angular.isArray(n.model)?n.model:[]);var o=angular.noop,s={};e(function(){o=a.onChange&&angular.isFunction(n.onChange())?n.onChange():angular.noop}),angular.isString(a.btnClass)&&a.btnClass.split(" ").forEach(function(e){s[e]=!0});n.getClass=function(e){var t=angular.copy(s);return t["btn-list-element__checked"]=e.checked&&!e.error,t["btn-list-element__error"]=e.checked&&e.error,e.class&&e.class.split(" ").forEach(function(e){t[e]=!0}),t},a.options?(n.allowMultiple?n.modifyModel=function(e){var t=!1;if(n.options.forEach(function(n){n.id===e&&(n.checked=!n.checked,t=n)}),t){var i=n.model.indexOf(t.id);t.checked&&-1===i?n.model.push(t.id):t.checked||-1===i||n.model.splice(i,1)}}:n.modifyModel=function(e){n.options.forEach(function(t){t.checked=t.id===e}),n.model=e},n.$watch("[model,options]",function(){angular.isArray(n.model)&&n.options.forEach(function(e){e.checked=t.includes(n.model,e.id)})},!0)):n.modifyModel=angular.noop;n.onChangeHandler=function(e,t){if(e.stopImmediatePropagation(),t.disabled)return!1;n.modifyModel(t.id),o(t.id)}}}}e.$inject=["$timeout","_"],angular.module("keenetic").directive("ndmButtonList",e)}(),function(){function e(e,t){return{templateUrl:"app/components/ndm-button/ndm-button.html",replace:!1,transclude:!1,link:function(e,n,i){e._onClick=function(n){t.has(i,"onClick")&&t.isFunction(e.onClick())&&(n.stopImmediatePropagation(),e.onClick()())}},scope:{isDisabled:"<",label:"@",icon:"@",btnClass:"@",onClick:"&",buttonName:"@",buttonType:"@?",tabIndex:"<?"}}}e.$inject=["$timeout","_"],angular.module("keenetic").directive("ndmButton",e)}(),function(){function e(e,t,n,i){return{templateUrl:"app/components/ndm-alert/ndm-alert.html",replace:!0,transclude:!0,link:function(a,o){e(function(){var e=t[0].getElementById("cp-main-container")||t[0].getElementById("ndm-page-view");e&&e.appendChild(o[0])}),a.$watch("isVisible",function(t){n.isAlertOpen=Boolean(t),n.uiViewOverlap=n.isAlertOpen,e(function(){if(t){var e=o[0].querySelectorAll("div[ng-transclude] input, div[ng-transclude] button");e.length>0&&e[0].focus()}})}),a.onKeyDown=function(e){return!i.isSpace(e)||(e.preventDefault(),e.stopPropagation(),a.hide(!1))},a.$watch("isFullScreen",function(){n.isAlertFullScreen=a.isFullScreen}),a.$on("$destroy",function(){a.isVisible&&n.isAlertOpen&&(n.isAlertOpen=!1,n.isAlertFullScreen=!1,n.uiViewOverlap=!1)})},scope:{isVisible:"=",hide:"&",isCloseButtonHidden:"=",isFullScreen:"=",title:"@label",subTitle:"@",addToSubTitle:"@",closeOnEsc:"<",closeOnClickOutside:"<",noTopShift:"<"}}}e.$inject=["$timeout","$document","$rootScope","keyboard"],angular.module("keenetic").directive("ndmAlert",e)}(),function(){function e(e,t,n){return function(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:200,s=null,r=null,l=function(){n.cancel(r),r=null,n.cancel(s),s=null,e()},c=function(){r||(r=n(l,o)),n.cancel(s),s=n(l,a)};angular.element(t).on("resize",c);var d=function(){angular.element(t).off("resize",c)};return i&&i.$on&&i.$on("$destroy",d),d}}e.$inject=["_","$window","$timeout"],angular.module("keenetic").factory("windowResizeWatcher",e)}(),function(){function e(e,t,n,i,a,o,s,r,l,c,d,p,u){var m=function(){return d.model.replace(/^Keenetic /,"")},f=function(){return"Keenetic "+m()},g=function(e){return e>-50?5:e>-77?4:e>-84?3:e>-95?2:e>-100?1:0},v=function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=a.instant(e,n);return t&&-1===o.indexOf(t)?"":i&&o===e?"":o},h=function(){return r.getLang()},b=["en","de","fr","es","it","pl","pt","ru","sv","tr","uk"],_=function(e){switch(e=e||h()){case"dev":case"ru":case"uk":return",";case"en":default:return"."}},y="action-link",S="ref-link",w="external-link",C="accordion-link",E=function(t){return e.map(t,function(e,t){return"".concat(t,'="').concat(e.replace(/\\([\s\S])|(")/g,"\\$1$2"),'"')}).join(" ")},I=function(t){var n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return _defineProperty(n={},t+"LinkOpen","<a "+E(e.extend({class:y},i))+">"),_defineProperty(n,t+"LinkClose","</a>"),n},T=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return["<".concat(e," ")+E(n)+">",t,"</".concat(e,">")].join("")},k=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return T("a",e,Object.assign({href:t},n))},P=[{name:d.WAN,description:d.WAN_DESCRIPTION},{name:d.GUEST,description:d.GUEST_DESCRIPTION},{name:d.LAN,description:d.LAN_DESCRIPTION},{name:d.INTERNAL_LTE_ID,description:d.INTERNAL_LTE_DESCRIPTION}],A=function(t){return e.padStart(t,2,"0")},D=function(e){var t=0|e/86400,n=[(e/3600|0)%24,(e/60|0)%60,e%60].map(A).join(":");return t?[t,v("time.days"),n].join(" "):n},O=p.UNIT_SCALE,N=[O.NONE,O.KILO,O.MEGA,O.GIGA,O.TERA],L=function(t,n){var i=String(t),a=0;return t>n&&(a=Math.floor(Math.log(t)/Math.log(n)),i=String((t/Math.pow(n,a)).toPrecision(3)),e.includes(i,"e")&&(i=String(parseFloat(t/Math.pow(n,a)).toFixed(2)).replace(".00","")),i=i.replace(/\./g,_())),{numberStr:i,order:a}},x=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=v(t?"unit-speed.name-short":"unit-speed.name"),i=e===O.NONE?"":v("unit-speed.prefix.".concat(e));return"".concat(i).concat(n)},R=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=v("unit-size.name".concat(t?"-short":"")),i=e===O.NONE?"":v("unit-size.prefix.".concat(e));return"".concat(i).concat(n)},M=function(e){if(!e||"open"===e)return"";return{shared:"WEP","wpa-psk":"WPA","wpa2-psk":"WPA2","wpa3-psk":"WPA3",owe:"OWE","wpa-eap":"WPAe","wpa2-eap":"WPA2e","wpa3-eap":"WPA3e","wpa3-eap-192":"WPA3E"}[e]},$=function(e){return function(t){return{id:String(t),label:e(t)}}},F=function(e){var t=e.length;if(0===t)return 0;e.sort(function(e,t){return e>t?1:-1});var n=e[0];if(n>0)return 0;for(var i=1;i<t;++i){if(e[i]-n>1)return n+1;n=e[i]}return n+1},V=function(e){return e.offsetWidth>0&&e.offsetHeight>0},U=function(e){if(!e)return!1;for(var t=e.querySelectorAll("form, [ng-form]"),n=0,i=t.length;n<i;++n)for(var a=t[n].querySelectorAll("input"),o=0,s=a.length;o<s;++o){var r=a[o];if(V(r))return r}for(var l=e.querySelectorAll(".btn"),c=0,d=l.length;c<d;++c){var p=l[c];if(V(p))return p}for(var u=["[href]",S,y,w,C].join(", "),m=e.querySelectorAll(u),f=0,g=m.length;f<g;++f){var v=m[f];if(V(v))return v}return!1},B=function(e,t){var n=s[0],i=[];try{for(var a=n.evaluate(e,t||n,null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null),o=a.snapshotLength,r=0;r<o;++r)i.push(a.snapshotItem(r))}catch(e){return console.warn("XPath error",e),[]}return i},W=function(e){for(;e&&e.parentNode;){if(e.className.includes("ng-hide"))return!0;e=e.parentNode}return!1},H=null,q=null,j=function(t){var n={};return function(){for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];var s=JSON.stringify(a);return e.has(n,s)||(n[s]=t.apply(void 0,a)),n[s]}},K=j(function(t){return t&&e.invoke(angular.element("<pre/>").text(t),"html")||""});return{ACCORDION_LINK_CLASS:C,EXTERNAL_LINK_CLASS:w,REF_LINK_CLASS:S,LINK_CLASS:y,setFocusToNode:function(e){var t=s[0].querySelector(e);t&&t.focus()},restrictNumber:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return n?Math.min(n,Math.max(t,e)):Math.max(t,e)},copyToClipboard:function(e){var t=s[0],n=t.createElement("span");n.appendChild(t.createTextNode(e)),n.id="tempCopyToClipboard",angular.element(t.body.append(n));var i=t.createRange();i.selectNode(n),o.getSelection().removeAllRanges(),o.getSelection().addRange(i),t.execCommand("copy"),o.getSelection().removeAllRanges(),n.remove()},wifi:{formatConnectionData:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(["txrate","rssi","txss","ht"].some(function(n){return e.isUndefined(t[n])}))return"-";var i=t.mode;"2"===t.wifiRange&&"11ac"===t.mode&&(i="11n");var a=[i];t._11&&(a=a.concat(t._11));var o=n||{mbitps:x(O.MEGA),mhz:v(p.UNIT.MHZ)},s=t.security?M(t.security):"";return'<i class="wifi-pwr-icon icon icon--indicator-wifi_pwr-'.concat(g(t.rssi),'"></i>\n                    <span>').concat(t.txrate," ").concat(o.mbitps,"</span>\n                    <span>").concat(s,'</span>\n                    <div class="table__note help-text">\n                    ').concat(a.join("/"),"\n                    ").concat(t.txss,"x").concat(t.txss," ").concat(t.ht," ").concat(o.mhz,"\n                    </div>")},formatSecurity:M},getUniqueId:function(){return Date.now()+Math.floor(100*Math.random())},getModelName:m,getModelNameWithVendor:f,getModelNameForLogo:function(){return m().toUpperCase().replace(/ II+$/g,"").trim()},getIsNewGeneration:function(){return d.hw_id&&d.hw_id.search("KN-")>=0},scrollTop:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:".ndm-page",t=s[0].querySelector((e||"")+" .ss-content");(t=t||s[0].body).scrollTop=0},formatPageTitle:function(e){return f()+" – "+v(e)},getInterfaceStatus:function(t){if("down"===t.state)return{color:"grey",name:"down",text:v("interface-state.down")};var n=t.fail,i=t.address;if("No SIM"===t.lte_state)return{color:"red",name:"no_sim",text:v("interface-state.no_sim")};if(e.includes(p.USB_MODEM_IFACE_TYPES,t.type)&&"no"===t.plugged)return{color:"red",name:"modem_disconnected",text:v("interface-state.modem_disconnected")};if("down"===t.link||"idle"===t.link||"error"===t.link)switch(n){case"no":return{color:"grey",name:"not_ready",text:v("interface-state.not_ready")};case"auth":return{color:"red",name:"auth_fail",text:v("interface-state.auth_fail")};case"system":return{color:"red",name:"connect_fail",text:v("interface-state.connect_fail")};case"conflict":return{color:"red",name:"ip_conflict",text:v("interface-state.ip_conflict")};case"resolve":return{color:"red",name:"fail_resolve",text:v("interface-state.fail_resolve")};default:return{color:"red",name:"no_link",text:v("interface-state.no_link")}}return t.group||d.sysmode!==p.SYSMODE.ROUTER&&t["interface-name"]===d.LAN?{color:"green",name:"connected",text:v("interface-state.connected")}:i&&i!==p.ZERO_IP_ADDRESS?t.global&&!t.defaultgw?{color:"grey",name:"standing_by",text:v("interface-state.standing_by")}:{color:"green",name:"connected",text:v("interface-state.connected")}:"conflict"===n?{color:"red",name:"ip_conflict",text:v("interface-state.ip_conflict")}:{color:"grey",name:"no_ip",text:v("interface-state.no_ip")}},getTranslation:v,localeFactory:function(t){return function(){return e.mapValues(t,function(e){return v(e)})}},l10n:{getSrefChunks:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return I(i||t,e.extend({"ui-sref":t,class:S},n))},getLinkChunks:I},generateHtmlTag:T,generateIconHtml:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return T("i","",{class:"icon icon--".concat(e),title:t})},generateLinkHtml:k,generateSrefLinkHtml:function(e,t){return T("a",e,{class:S,"ui-sref":t})},generateExternalLinkHtml:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return k(e,t,Object.assign({},n,{class:w,target:"_blank"}))},format:{PREFIX_ORDER:N,MULTIPLIER_SPEED:1e3,speed:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=L(e,1e3),i=n.numberStr,a=n.order;return a>N.length?"&mdash;":"".concat(i," ").concat(x(N[a],t))},getSpeedUnit:x,getSpeedUnitString:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=L(e,1e3).order;return x(N[n],t)},getFormattedMaxSpeedUnit:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=L(e,1e3),a=i.numberStr,o=i.order;return a=t?parseInt(a,10):a,o>N.length?"&mdash;":"".concat(a," ").concat(n?"":x(N[o]))},MULTIPLIER_SIZE:1024,size:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=L(e,1024),i=n.numberStr,a=n.order;return"".concat(i," ").concat(R(N[a],t))},getSizeUnit:R},getDimensionName:function(t){return x(e.find(O,function(e){return e[0]===t[0]})||O.NONE,!0)},getInterfaceL10n:function(t){var n=t.rename||t["interface-name"]||t.name,i=t.description,a=e.get(d,["PORTS_MAP",d.WAN_PORT,"port"]);return t.id&&e.startsWith(t.id,a)&&(n=d.WAN),t.via&&e.startsWith(t.via,d.DSL)&&(n=d.WAN),e.some(P,function(e){return e.name===n&&e.description===i})?(n===d.WAN&&e.some([t.id,t.via],function(t){return t&&e.startsWith(t,d.DSL)})&&(n="DSL-ISP"),n===d.INTERNAL_LTE_ID&&(n="LTE-ISP"),v("interface-translations."+n)):i||n},createMatchStrRegexp:function(e){return new RegExp(e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),"gi")},highlightMatch:function(e,t){var n=[],i=e.replace(t,function(e){return n.push(e),"__".concat(n.length-1,"__")});return n.reduce(function(e,t,n){return e.replace("__".concat(n,"__"),"<b>".concat(K(t),"</b>"))},K(i))},getDate:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:" ",n=new Date(e),i=n.getFullYear(),a=A(n.getMonth()+1),o=A(n.getDate()),s=[A(n.getHours()),A(n.getMinutes()),A(n.getSeconds())].join(":");return[[o,a,i].join("."),s].join(t)},getSplittedTime:D,getSplittedTimeInMS:function(e){return D(e).slice(3,8)},changeLanguage:function(e){return u.language!==e&&(u.setItem("language",e),a.use(e),!0)},getCurrentLanguage:h,getLanguageOptionsList:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return Object.keys(d.profile.languages).sort(function(e,t){return b.indexOf(e)-b.indexOf(t)}).map(function(t){return{id:t,label:e?t.toUpperCase():"languages.".concat(t)}})},getHelpCenterLink:function(){var e=r.getRealLanguage();return"https://help.keenetic.com/hc/".concat(e)},getDecimalSeparator:_,idToOption:$,idsToOptions:function(e,t){return e.map($(t))},firstUnusedId:F,firstUnusedPositiveId:function(e){return F([].concat(_toConsumableArray(e),[0]))},round:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;t=isNaN(t)?0:t;var n=Math.pow(10,t),i=e*n;return Math.round(i)/n},isInvisible:function(e){for(;e&&e.parentNode;){var t=o.getComputedStyle(e,null),n=t.getPropertyValue("display"),i=t.getPropertyValue("visibility");if("none"===n||"hidden"===i)return!0;e=e.parentNode}return!1},blurActiveElement:function(){var e=s[0].activeElement;e&&e!==s[0].body?s[0].querySelector&&(e=s[0].querySelector(":focus")):e=null,e&&e.blur()},parseLocationHash:function(){var e={};if(o.location.hash)for(var t=o.location.hash.substr(1).split("&"),n=0;n<t.length;n++){var i=t[n].split("=");e[i[0]]=i[1]}return e},dom:{findParentScrollableElement:function(e){for(e=e.parentNode;e.parentNode&&e.parentNode.getBoundingClientRect;e=e.parentNode){var t=o.getComputedStyle(e,null),n=t.getPropertyValue("overflow-x"),i=t.getPropertyValue("overflow-y"),a=function(e){return"auto"===e||"hidden"===e};if(a(n)||a(i))break}return e},scrollToAnchor:function(e,t){var n=e.querySelector('a[name="'.concat(t,'"]'));n&&(e.scrollTop=n.offsetTop-e.getBoundingClientRect().top-10)},toggleTextSelection:function(e){s[0].querySelector("body").style.userSelect=e?"inherit":"none"},isAncestor:function(e,t){for(var n=t.parentNode;n&&n!==e;)n=n.parentNode;return n===e},getFirstFocusableElement:U,focusOnFirstFocusableElement:function(e){var t=U(e);return!!t&&(t.focus(),!0)},highlightFirstMatchedElement:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:".ndm-page",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"search-result",a=s[0],o=e.length,r=0;r<o;++r)for(var l=e[r].replace(/"/g,'\\"'),c='[contains(text(), "'.concat(l,'")]'),d='[contains(., "'.concat(l,'")]'),p=".//span".concat(c,"|div").concat(c),u=".//span".concat(d,"|div").concat(d),m=a.getElementById("cp-main-container")||a,f=[].concat(_toConsumableArray(B(p,m)),_toConsumableArray(B(u,m))).filter(function(e){return!e.className.includes("ndm-page")}).filter(function(e){return!e.className.includes("ndm-popup")}),g=f.length,v=function(e){var o=f[e];if(W(o))return"continue";o.classList.add(n);var s=a.querySelector("".concat(t," .ss-content"))||a.querySelector(".d-dashboard .ss-content")||a.body;return i(function(){s.scrollTop=o.getBoundingClientRect().top-200}),i(function(){o.classList.remove(n)},3e3),{v:!0}},h=0;h<g;++h){var b=v(h);switch(b){case"continue":continue;default:if("object"===_typeof(b))return b.v}}return!1}},translatePrefixCtor:function(e){return function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return v("".concat(e,".").concat(t),n,i)}},dashesToCamelCase:function(e){return e.replace(/-+(\w)/g,function(e,t){return t.toUpperCase()})},camelCaseToDashes:function(e){return e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()},debounce:l,rssiToLevel:g,rssiToQuality:function(e){return e>=-50?100:e>=-80?24+26*(80+e)/10:e>=-90?26*(90+e)/10:0},getUrlForNDW3:function(){var e=o.location.hostname,t=":".concat(o.location.port);return-1!==e.search("localhost")&&(t=":4200"),"".concat(o.location.protocol,"//").concat(e).concat(t)},isNdw3Available:function(){var t=Boolean(e.get(d,"profile.extras.ndw3",!1)||e.get(d,"profile.components.ndw3",!1)),n=c.isIE,i=c.isEdge;return t&&!n&&!i},getUrlForInitialSetupWizard:function(){return"/netfriend-redirect.html"},getObjectFromArray:function(t,n,i){return e.chain(i).keyBy(t).mapValues(n).value()},toRciQueryList:function(t){return t.map(function(t){return e.isString(t)?e.set({},t,{}):t})},getSvgCache:function(){return H?n.when(H):q||(q=t.get("/assets/sprite.json").then(function(t){var n=t.data||{},i=e.chain(n.shapes).map(function(e){return Object.assign({},e,{x:Math.abs(e.x)+n.padding,y:Math.abs(e.y)+n.padding})}).map(function(e){return Object.assign({},e,{viewbox:"".concat(e.x," ").concat(e.y," ").concat(e.w," ").concat(e.h," ")})}).mapKeys(function(e){return e.id}).value();return H=Object.assign({},n,{shapes:i})}))},splitToNumbers:function(t){return e.chain(t).split(",").filter().uniq().map(Number).value()},getFirmwareVersionTitle:function(e){return e.title||e.release},getDeviceModel:function(t){return t[e.startsWith(t.vendor,"Zy")?"device":"model"]},downloadAsFile:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"text/plain";if(c.isIE||c.isEdge){var i=new Blob([e],{type:"".concat(n,";charset=utf-8;")});navigator.msSaveBlob(i,t)}else{var a=new File([e],t,{type:n}),r=s[0].createElement("a"),l=(o.URL||o.webkitURL).createObjectURL(a);r.setAttribute("href",l),r.setAttribute("download",a.name),r.setAttribute("rel","noopener"),r.style.display="none",s[0].body.appendChild(r),r.click(),s[0].body.removeChild(r)}},getStringHash:function(e){var t=0;if(""===e)return t;for(var n=e.length,i=0;i<n;++i)t=(t<<5)-t+e.charCodeAt(i),t|=0;return t},forceScopeDigest:function(t){var n=e.get(t,"$root.$$phase");["$apply","$digest"].includes(n)||t.$apply()},newlineToBr:function(e){return e.replace(/\n/g,"<br/>")},getRateLimitedFunction:function(e,t){var a=[],o=null,s=function n(){var s=a.shift();s&&(s.deferred.resolve(e.apply(void 0,_toConsumableArray(s.args))),o=i(n,t)),0===a.length&&(i.cancel(o),o=null)};return function(){for(var e=n.defer(),r=arguments.length,l=new Array(r),c=0;c<r;c++)l[c]=arguments[c];return a.push({args:l,deferred:e}),o||(s(),o=i(s,t)),e.promise}},getSwitchportsList:function(){return e.map(d.PORTS_MAP,function(e,t){var n="blue"===e.color,i=e.iface,a=e.interfaceId;return Object.assign({},e,{portId:t,isBlue:n,switchId:i,interfaceId:a})})},getLengthInBytes:function(e){var t=encodeURIComponent(e).match(/%[89ABab]/g);return e.length+(t?t.length:0)},getFormModifiedModels:function t(n){return e.reduce(e.get(n,"modifiedChildForms"),function(e,n){return[].concat(_toConsumableArray(e),_toConsumableArray(t(n)))},e.get(n,"modifiedModels",[]))},memoize:j,escapeHtml:K}}e.$inject=["_","$http","$q","$timeout","$translate","$window","$document","language","debounce","browserCheck","NDM","CONSTANT","localStorage"],angular.module("keenetic").factory("utils",e)}(),function(){function e(e,t,n,i,a,o){var s=o.HOTSPOT_DETAILS,r=function(e,t){return{user:_defineProperty({},String(e),t)}},l=function(e,t){return r(e,{tag:t})},c=function(e,t){return r(e,{tag:{tag:t,no:!0}})},d=function(t,n){var i=n.mac,a=e.find(t,{mac:i});return e.get(a,"port")},p=function(t,n){var i=n.where,a=n.host,s=n.mac,r={ifaceId:i,host:a},l=e.find(t,{mac:s});return l?l.ap?(r.type=o.USER_CONNECTION_TYPE.WIFI,r.ap=l.ap):(r.type=o.USER_CONNECTION_TYPE.ETHERNET,r.port=d(t,n)):r.type=o.USER_CONNECTION_TYPE.REMOTE,r};return{getHostsQuery:function(){return a.sysmode===o.SYSMODE.ROUTER?{query:e.set({},"show.ip.hotspot",{details:[s.WIRELESS,s.INTERFACE_DESCRIPTION,s.SWITCH].join(",")}),responsePath:"show.ip.hotspot.host"}:{query:e.set({},"show.associations",{}),responsePath:"show.associations.station"}},getWhoamiQuery:function(){return{query:e.set({},"whoami",{}),responsePath:"whoami"}},getUserPort:d,combineUserData:p,getCurrentUserInfo:function(){var t=["whoami"];a.sysmode===o.SYSMODE.ROUTER?t.push("show.ip.hotspot"):t.push("show.associations");var s=n.toRciQueryList(t);return i.postToRciRoot(s,{noRetry:!0}).then(function(t){var n=a.sysmode===o.SYSMODE.ROUTER?"show.ip.hotspot.host":"show.associations.station",i=e.get(t,"[0].".concat("whoami"),{}),s=e.get(t,"[1].".concat(n),[]);return p(s,i)})},getAllUsers:function(){return i.get("user")},getUser:function(t){var n=e.set({},"show.rc.user",{name:t});return i.postToRciRoot(n).then(function(n){return e.get(n,"".concat("show.rc.user",".").concat(t),{})})},deleteUser:function(e){return i.postAndSave(r(e,{no:!0}))},saveUser:function(e,t,n){var a={};return angular.isDefined(n)&&(n=n instanceof Array?n:n.split(","),a.tag=!!n.length&&n),angular.isDefined(t)&&(a.password=t),i.postAndSave(r(e,a))},addTag:function(e,t){return i.postAndSave(l(e,t))},removeTag:function(e,t){return i.postAndSave(c(e,t))},getRemoveTagQuery:c,getAddTagQuery:l,getHomeDirectoryQuery:function(e,t){return r(e,{home:t?{directory:t}:{no:!0}})},setPasswordQueryObj:function(e,t){return r(e,{password:t})},isUserPasswordEmpty:function(t){return e.isEmpty(t.password)||Boolean(e.find(t.password,{password:""}))}}}e.$inject=["_","$q","utils","router","NDM","CONSTANT"],angular.module("keenetic").factory("usersService",e)}(),function(){function e(e,t,n,i){return{link:function(n,a){a.attr("lang",t.use()||t.preferredLanguage()),n.$on("$destroy",e.$on("$translateChangeSuccess",function(e,n){a.attr("lang",n.language||t.use()||t.preferredLanguage()),i.updateMenu()}))}}}e.$inject=["$rootScope","$translate","CONSTANT","menuService"],angular.module("keenetic").directive("updateLanguage",e)}(),function(){function e(e,t){var n=t[0].createElement("div");return function(t){return n.innerHTML=t,e.trustAsHtml(n.textContent)}}e.$inject=["$sce","$document"],angular.module("keenetic").filter("trust",e)}(),function(){function e(e,t,n,i,a){var o=["volume","folder","file"],s={FILE_SYSTEM:"V",FILE:"R",DIRECTORY:"D",ALIAS:"A"},r=function(e){return"swap"===e.fstype},l=function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return n.has(e,t)?Number(e[t]):i},c=function(e){return n.chain(e.entry).pickBy(function(e){return"V"===e.type&&"usb"===e.subsystem&&"yes"===e.mounted}).map(function(e,t){var n=e.label||e.name||t;return{id:n.replace(/:$/,""),name:n.replace(/:$/,""),sizeTotal:e.total,sizeFree:e.free,uuid:e.uuid,isSwap:r(e)}}).value()};return{NODE_TYPE_VOLUME:"volume",NODE_TYPE_FOLDER:"folder",NODE_TYPE_FILE:"file",NDM_LS_TYPE:s,ls:function(e,t){var i=n.get(t,"uuids",!1),c=i?function(e){return!e.device||n.some(i,function(t){return e.uuid===t})}:n.identity,d=n.get(t,"foldersOnly",!1),p=e.map(function(e){return function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n="/"===e?"":e;return t?{directory:n,type:n?s.DIRECTORY:s.FILE_SYSTEM}:{directory:n}}(e,d)}).map(function(e){return{ls:e}}),u=Object.assign({},t,{filterFunction:c}),m=function(e){return e.map(function(e){return function(e,t){var i=a.getNdmResponseErrors(e);if(!n.isEmpty(i)){var s=n.first(i);return{error:n.get(s,"message","")}}var c=n.get(t,"removableOnly",!1),d=n.get(t,"filterFunction",n.identity),p=n.get(e,"ls.entry",{});return n.chain(p).pickBy(function(e,t){return d(e,t)}).mapValues(function(e){var t,n=e.type,i="usb"===e.subsystem,a="yes"===e.mounted;switch(n){case"R":case"A":t="file";break;case"V":t="volume";break;case"D":t="folder"}return Object.assign({},e,{entryType:n,isUsb:i,isMounted:a,nodeType:t})}).pickBy(function(e){return!r(e)}).pickBy(function(e,t){return"volume"!==e.nodeType||e.isUsb&&e.isMounted||"storage:"===t&&!c}).pickBy(function(e){return"A"!==e.entryType||!c}).map(function(e,t){var n=l(e,"free"),i=l(e,"total"),a="volume"===e.nodeType?i-n:l(e,"size"),o=e.uuid?"".concat(e.uuid,":"):t,s=e.label,r=e.isUsb,c=e.isMounted;return{type:e.nodeType,mounted:c,usb:r,name:s?"".concat(s,":"):t,size:a,uuid:o,free:n,label:s}}).orderBy([function(e){return e.type},function(e){return e.name}],[function(e,t){return o.indexOf(e)-o.indexOf(t)},function(e,t){return e.localeCompare(t)}]).value()}(e,u)})};return a.postToRciRoot(p,{noRetry:!0}).then(m,m)},getUsbDrives:function(){return a.post({url:"ls",timeout:1e4,timeoutTime:1e3,cache:!1,data:{type:s.FILE_SYSTEM}}).then(c)},getUsbDrivesListFromLsResponse:c,getDevicePartitionsData:function(e){var t=i.toRciQueryList(["show.media"]);return a.postToRciRoot(t).then(function(t){var i=n.get(t,"[0].".concat("show.media",".").concat(e),{});return n.get(i,"partition",[]).map(function(e){return n.pick(e,["uuid","label"])})})}}}e.$inject=["$q","$timeout","_","utils","router"],angular.module("keenetic").factory("storage",e)}(),function(){function e(e){return function(t){arguments.length>1&&void 0!==arguments[1]&&arguments[1];var n=parseInt(t,10);return isNaN(n)?"":e.format.speed(n)}}e.$inject=["utils"],angular.module("keenetic").filter("speedFormat",e)}(),function(){function e(e){return function(t){arguments.length>1&&void 0!==arguments[1]&&arguments[1];var n=parseInt(t,10);return isNaN(n)?"":e.format.size(n)}}e.$inject=["utils"],angular.module("keenetic").filter("sizeFormat",e)}(),function(){function e(e,t,n,i,a,o,s,r,l){var c=null,d=!0,p=function(){t.USER_IS_READONLY&&o.security("current-user-is-readonly",-1,m)},u=function(){if(r.SHOW_NO_PASSWORD_NOTICE&&e.current.name!==s.state.INITIAL_SETUP_WIZARD_STATE){var t=l.getTranslation("current-user-has-no-password",null,Object.assign({pageTitle:l.getTranslation("menu.administrator")},l.l10n.getSrefChunks("controlPanel.administrator",{},"administrator")));return o.security(t,-1,m)}},m=function(){n.cancel(c),d||(c=n(v,5e3))},f=function(e,n){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];t.$broadcast(e),m(),i&&n()},g=function(){var e=t.currentUser;e?i.isReadonlyUser(e)?f(s.events.READONLY_USER_LOGIN,p,!0):i.isUserAdmin(e)&&a.isUserPasswordEmpty(e)&&f(s.events.USER_LOGIN_WITHOUT_PASSWORD,u,!0):m()},v=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];d=!1,e?g():m()},h=function(){n.cancel(c),d=!0};return t.$on(s.events.SECURITY_NOTIFICATIONS_DISABLED,function(){h()}),t.$on(s.events.SECURITY_NOTIFICATIONS_ENABLED,function(){v(!0)}),t.$on(s.events.LOGOUT,function(){t.USER_IS_READONLY=!1}),t.$on(s.events.LOGIN,function(){t.USER_IS_READONLY=!1}),t.$on(s.events.READONLY_USER_LOGIN,function(){t.USER_IS_READONLY=!0,p()}),t.$on(s.events.USER_LOGIN_WITHOUT_PASSWORD,function(){u()}),t.$on(s.events.POPUP_OPENED,function(){n(function(){h(),g()})}),t.$on(s.events.POPUP_CLOSED,function(){n(function(){v(!0)})}),{notifyReadonlyUser:p,notifyOnUserWithoutPassword:u,showNotifications:g,stopPeriodicNotifications:h,startPeriodicNotifications:v,resetNotificationsTimeout:m}}e.$inject=["$state","$rootScope","$timeout","administrator","usersService","notification","CONSTANT","env","utils"],angular.module("keenetic").factory("securityNotification",e)}(),function(){function e(e,t,n,i,a,o,s,r,l,c,d,p,u,m){var f={},g=[],v=l.getConst(),h=r(),b=h.isPopupRoute,_=u.getApps(),y=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return t.isFunction(e)?{title:e}:(i=i?i+".":"",n?{title:i+e,subTitle:i+n}:{title:i+e})},S=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.filter(angular.identity).reduce(function(e,t){return e.concat(t)},[])},w=function e(n,i){return n.filter(angular.identity).map(function(n){return t.isArray(n)?e(n,i):n.title?y(n.title,n.subTitle,i):i?"".concat(i,".").concat(n):n})},C=function(e,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};f[e]||(f[e]={});var o=f[e];return o.title=n,i&&(o.description=i),t.isArray(a.headers)&&(o.formHeaders=a.headers.slice().filter(angular.identity).map(function(e){return t.isArray(e)?y(e[0],e[1]):e.title?e:y(e)}),delete a.headers),t.isArray(a.texts)&&(o.texts=a.texts.slice().filter(angular.identity),delete a.texts),t.forEach(a,function(e,t){o[t]=e}),o},E=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(t.isArray(e)?o.getTranslation.apply(o.getTranslation,e):t.isFunction(e)?e(n):o.getTranslation(e)).replace(/<br(\/?)>/g," ").replace(/<[a-zA-Z\/](.*?[^?])?>/g,"").replace(/(\s|\n)+/g," ")},I=function(e){return t.mapValues(e,E)},T=function(n,i){if(i){var a=e.get(n);a&&(i.menuTitle=a.menuTitle);var o={isPopup:b(n),customReadyEvent:i.customReadyEvent},s=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";e&&g.push(angular.extend({},{s:e,sref:t},o,n?{title:n}:{},i?{customMatchedVal:i}:{}))},r=i.routeParams,l=i.title?E(i.title,r):"",c=i.menuTitle?E(i.menuTitle,r):"",d=c||l;if(c&&!c.startsWith(l)&&!l.startsWith(c)){var p=i.menuGroupTitle?"".concat(E(i.menuGroupTitle)," / "):"";s(p+c,n)}if(i.title&&s(E(i.title),n),i.description&&s(E(i.description),n,d),(i.formHeaders||[]).map(I).forEach(function(e){s(e.title,n,d),s(e.subTitle,n,d)}),(i.texts||[]).forEach(function(e){s(E(e),n,d)}),i.fields&&t.forEach(i.fields,function(e,t){var i;s("".concat(E((i={text:e,label:t}).label),": ").concat(E(i.text)),n,d,E(t))}),i.substitutes&&t.forEach(i.substitutes,function(e,t){s(E(t),n,d,E(e))}),i.parametrized){var u=t.flatMap(i.parametrized,function(e){var a=Object.assign({},i.routeParams||{},{},e.routeParams),o=b(n),s=e.title||i.title,r=E(s,a),l=e.customReadyEvent||n.customReadyEvent,c=e.texts.filter(t.identity).map(function(e){return{s:E(e,a),sref:n,title:r,isPopup:o,routeParams:a,customReadyEvent:l}}),d=t.chain(e.substitutes).map(function(e,t){var i=E(t,a),s=E(e);return{s:i,sref:n,title:r,isPopup:o,routeParams:a,customReadyEvent:l,customMatchedVal:s}}).value();return[].concat(_toConsumableArray(c),_toConsumableArray(d))});g=g.concat(u)}}},k=function(e){return t.trim(e).split(/\s+/g)},P=function(e,t,n){return e.slice(0,n).lastIndexOf(t)},A=function(e,t,n){return e.indexOf(t,n)},D=function(e,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:14,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:90,o=k(e);if(o.length<i)return e;for(var s=e.length,r=Math.min(s,a),l=n,c=n,d=k(e.slice(0,n)).length,p=0;p<i&&c-l<r-1;)l>0&&(-1===(l=P(e," ",l))?l=0:(d--,l--,p++)),c<s-1&&(-1===(c=A(e," ",c))?c=s:(c++,p++));var u="",m="";return" "!==e[l]&&l>0&&(l++,u=o[0]+" "+o[1],d>2&&l-u.length>3?u+="… ":(u="",l=0))," "!==e[c]&&c<s-1&&(c--,m="…"),u+t.trim(e.slice(l,c)," ,.")+m},O=function(e,t){return e.replace(t,function(e){return"<b>".concat(e,"</b>")})},N=[" ","-","‑"];return{match:function(e){var n=t.words(e),i=t.sum(n.map(function(e){return e.length})),a=n.map(function(e){return 1e3/i*e.length}),s=n.map(o.createMatchStrRegexp),r=function(e){var n=o.createMatchStrRegexp(e);return t.chain(g).map(function(t){var i=n.exec(t.s);if(n.lastIndex=0,!i)return!1;var a=D(t.s,i.index),o=O(a,n),s=[t.customMatchedVal,t.s].filter(Boolean),r=i.index;return Object.assign({},t,{word:e,uid:t.s+JSON.stringify(t.routeParams||{}),index:r,text:o,matchedValues:s})}).filter().value()}(e).map(function(e){return Object.assign({},e,{rate:1e3-e.index,wholeWordMatchesCount:n.length})}),l=t.flatMap(n,function(e,n){var i=s[n];return t.chain(g).map(function(t){var n=i.exec(t.s);return i.lastIndex=0,!!n&&Object.assign({},t,{word:e,matchData:n})}).filter().value()}),c=t.chain(l).map(function(e){var t=e.s+JSON.stringify(e.routeParams||{});return Object.assign({},e,{uid:t})}).differenceBy(r,"uid").uniqBy("uid").value().map(function(e){var i=e.s,o=_toConsumableArray(i),r=i.length,l=t.chain(s).map(function(e,t){var a=e.exec(i);return e.lastIndex=0,{word:n[t],regexp:e,wordMatchData:a}}).value(),c=t.chain(l).filter("wordMatchData").map("wordMatchData.index").sum().value(),d=l.map(function(e,t){if(!e.wordMatchData)return 0;var i=e.wordMatchData.index,a=i+n[t].length,s=0===i||N.includes(o[i-1]),l=a===r||N.includes(o[a]);return s&&l?1:.3}),p=t.chain(l).minBy("wordMatchData.index").get("wordMatchData.index").value(),u=t.zipWith(d,a,function(e,t){return e*t}),m=t.sum(u)-p,f=d.filter(function(e){return 1===e}).length,g=D(i,c),v=t.chain(l).filter("wordMatchData").reduce(function(e,t){return O(e,t.regexp)},g).value();return Object.assign({},e,{rate:m,index:c,text:v,matchedValues:[e.customMatchedVal,e.s].filter(Boolean),wholeWordMatchesCount:f})});return[].concat(_toConsumableArray(r),_toConsumableArray(c))},matchKnowledgeBase:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,s=i.getRealLanguage(),r="https://help.keenetic.com/hc/".concat(s,"/search?query=").concat(e,"&").concat("utm_source=webhelp&utm_medium=search_hc&utm_campaign=readmore"),l=a.post({url:"webhelp/search-hc",noRetry:!0,silent:!0,unique:!0,data:{locale:s,query:e}}).then(function(i){var a=o.createMatchStrRegexp(e);return{kbMatches:t.get(i,"webhelp.".concat(s),[]).slice(0,n).map(function(e){var t=e.title,n=a.exec(t),i=e.href;return n?{index:n.index,url:i,matchedValues:[t],text:function(e,t){return e.replace(a,"<b>".concat(t,"</b>"))}(D(t,n.index),n[0])}:{url:i,matchedValues:[t],text:D(t,0)}}),query:e}});return{query:e,request:l,allResultsUrl:r}},updateSearchData:function(e){t.isEmpty(f)&&function(){var e=n.profile.components,i=n.profile.features,a=n.sysmode,s=a===p.SYSMODE.ROUTER,r=function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return n.some(function(t){return e[t]})},u=d.getTypesSelect(),f=u.length>1?u.slice(1).map(function(e){return e.name}).join("/"):"",g=r("pptp","l2tp","pppoe"),h=r("pptp","l2tp","pppoe","sstp","openvpn","ike-client"),b=r("skydns","safedns","ydns","cloudflare-dns","adguard-dns");C("controlPanel.apps","apps.title","",{headers:[e.usb&&"usb-device-list.title","apps.applications"]});var E=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=n.description||"";return delete n.description,C("controlPanel.apps.".concat(e),"apps.".concat(e,".card-title"),i,t.merge({headers:[y("apps.".concat(e,".popup-title"),"apps.".concat(e,".popup-description"))]},n))};E("kabinet"),C("controlPanel.apps.udpxy","apps.udpxy.card-title","apps.udpxy.card-description",{headers:"apps.udpxy.popup-title"});var I=w(["base-settings","users"],"apps.popups"),T=m.getPrivateCloudDescription(_["private-cloud"].toggles,"apps.private-cloud.popup");E("private-cloud",{headers:S(["".concat("apps.private-cloud",".card-title"),T,"".concat("apps.private-cloud",".user-folder"),"".concat("apps.private-cloud",".internet-access")],e.webdav&&["".concat("apps.private-cloud",".webdav-settings")],e.sftp&&["".concat("apps.private-cloud",".sftp-settings"),"".concat("apps.private-cloud",".anonymous-access")],e.ftp&&["".concat("apps.private-cloud",".ftp-settings"),"".concat("apps.private-cloud",".anonymous-access")])}),E("torrent",{headers:I.concat(["apps.torrent.storage-folder"])}),E("dlna",{headers:["apps.popups.base-settings",y("mediateka","mediateka-description","apps.dlna"),y("mediateka-setup","mediateka-setup-description","apps.dlna")]}),E("cifs",{headers:I}),E("afp",{headers:I});var k=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return C(t||"controlPanel.".concat(e),"apps.".concat(e,".card-title"),"",{headers:["apps.".concat(e,".popup-title")]})};C("controlPanel.vpn-server","apps.vpn.card-title","",{headers:S([y("popup-title","popup-description","apps.vpn")],I)}),k("vpn-stat","controlPanel.vpn-server-stat"),E("vpn-l2tp",{headers:I}),k("vpn-l2tp-stat"),E("virtualIP",{headers:I}),k("virtualIP-stat"),E("vpn-sstp",{headers:I}),k("vpn-sstp-stat"),C("dashboard","","",{texts:["dashboard.card_system.upTime","dashboard.card_system.serviceTag"],substitutes:_defineProperty({},"".concat("dashboard.card_segments.wifi.connection-info",".qr-code-description"),"".concat("dashboard.card_segments.wifi.connection-info",".link-name")),customReadyEvent:p.events.DASHBOARD_LOADED}),C("controlPanel.administrator","administrator.title","administrator.description",{texts:["administrator.editor.description","administrator.editor.password","administrator.editor.change-password-placeholder"],headers:["administrator.list.rights-header",y("title","header-sub-title","administrator.list"),"administrator.editor.tags-header",y("header","description","administrator.webaccess"),y("ports-header","ports-description","administrator.webaccess"),"administrator.webaccess.security-level","administrator.webaccess.http-port","administrator.webaccess.telnet-port",e.ssh?"administrator.webaccess.ssh-port":"",s?"administrator.webaccess.access-by-internet":""]});var P=["ping","traceroute","ping6"].map(function(e){return"diagnostics.tools.".concat(e)});C("controlPanel.diagnostics","diagnostics.header-title","diagnostics.header-sub-title",{texts:["diagnostics.debugger.self-test-title","diagnostics.debugger.save-self-test","diagnostics.debugger.header-info","diagnostics.log.header-title","diagnostics.log.system-messages-list"].concat(_toConsumableArray(P)),headers:S(["diagnostics.tools.header","diagnostics.debugger.header-title"],e.usbdsl&&[y("header","description","diagnostics.usbdsl-dumpsoc"),y("header","description","diagnostics.usbdsl-statistics")],e.monitor&&[y("header-info","edit.header-info","diagnostics.capture"),"diagnostics.capture.header-title"]),substitutes:e.dsl||n.DSL_ALWAYS_PRESENT?{"diagnostics.dsl.header":"diagnostics.tabs.dsl","diagnostics.dsl.traffic-header":"diagnostics.tabs.dsl"}:{}}),C("controlPanel.diagnostics.log","","",{headers:S(["diagnostics.log.header-title"])}),C("controlPanel.opkg","opkg.page-header","opkg.page-description",{headers:["opkg.form-header","opkg.users-table-header"]}),C("controlPanel.system","system.title","",{texts:["system.buttons-and-leds.sub-title","system.reset-to-default.description","system.switchports.title"],headers:S(r("config-ap","config-repeater","config-extender","config-client")&&y("header","description","system.sysmode"),i.dual_image?["system.components.current-fw-version","system.components.auto-update.channel","system.components.auto-update.toggle-label"]:[],["system.system-files.header"],e.cloudcontrol&&w(["title","description","cid-label"],"system.cloudcontrol"),["system.system-settings.header","system.system-settings.set-time-automatically","system.system-settings.timezone","system.system-settings.ntp-hide",i.led_control?"system.buttons-and-leds.title-leds":"system.buttons-and-leds.title"],e.usb&&i.usb_3&&n.USB_PORTS_NUMBER>1&&["system.usb-ports.title"],["system.reboot.header"],y("header","description","system.diagnostic-reports"),y("header","eula-modal-link","system.credits")),fields:{firmware:"system.system-files.files-list.firmware"}}),C("controlPanel.credits","credits.title","credits.description");var A=t.filter(p.SYSMODE,function(t){return t===p.SYSMODE.ROUTER||e["config-".concat(t)]});C("controlPanel.system.mode","system.sysmode.header","system.sysmode.description",{texts:w(A.map(function(e){return"".concat(e,"-description")}),"system.sysmode"),headers:w(A,"system.sysmode")}),C("controlPanel.system.components","","",{headers:[y("popup.header","popup.components-form.description","system.components")]}),C("controlPanel.wired","wired.header","wired.description",{texts:["wired.portmap.description"],headers:["wired.portmap.title","wired.title-ip-config",g&&function(){return o.getTranslation("wired.title-ppp-config",null,{pppType:" (".concat(f,")")})},e.dot1x&&"ndm-iface-dot1x.title",e.pingcheck&&"pingcheck.title"],fields:{"iface-ip.mode":"iface-ip.auto-dhcp","iface-ip.mac-mode-label":"iface-ip.mac-mode.default","iface-order.label":"iface-order.reserve"},substitutes:{"iface-ip.mtu":"iface-ip.show-additional-settings","iface-ip.ignore-dns":"iface-ip.show-additional-settings","schedules.select.default-title":"ndm-isp-general-properties.set-internet-access-schedule"}}),C("controlPanel.modems","modems.header","modems.header-sub-title",{headers:S(["modems.editor.description-subform"],e.usbmodem&&y("subform-title","subform-info","modems.editor.usbmodem"),e.usblte&&y("subform-title","subform-info","modems.editor.usblte"),e.pingcheck&&["pingcheck.title"]),fields:{"iface-order.label":"iface-order.reserve"},substitutes:{"schedules.select.default-title":"ndm-isp-general-properties.set-internet-access-schedule"}}),C("controlPanel.usbdsl","dsl.page-title","dsl.page-description",{headers:["dsl.subtitle-dsltype","dsl.subtitle-adsl","dsl.subtitle-vdsl","dsl.subtitle-inet-pvc","dsl.subtitle-ip",g&&"dsl.subtitle-ppp",e.pingcheck&&"pingcheck.title","dsl.vlans-subtitle","dsl.subtitle-inet-pvc","dsl.subtitle-vlan"],fields:{"iface-ip.mode":"iface-ip.auto-dhcp","iface-order.label":"iface-order.reserve"},substitutes:{"iface-ip.ignore-dns":"iface-ip.show-additional-settings"}}),C("controlPanel.dsl","dsl.page-title","dsl.description",{headers:["dsl.form.description.label","dsl.form.vpi","dsl.form.vci","dsl.form.encapsulation","dsl.form.vlan","dsl.subtitle-ip",g&&"dsl.subtitle-ppp",e.pingcheck&&"pingcheck.title","dsl.igmp-proxy.header"],fields:{"iface-ip.mode":"iface-ip.auto-dhcp","iface-order.label":"iface-order.reserve"},substitutes:{"iface-ip.mtu":"iface-ip.show-additional-settings","iface-ip.ignore-dns":"iface-ip.show-additional-settings","schedules.select.default-title":"ndm-isp-general-properties.set-internet-access-schedule"}});var D=function(){return"wifiClient."+({client:!0,repeater:!0,extender:!0}[a]&&"-"+a||"header")},O=function(){return S(w(["title-client-params","ip-address"],"wifiClient"),y("title","description","wifiClient.site-survey-popup"))};C("controlPanel.wifiClientInModes",D(),"wifiClient.special-mode-description",{texts:["schedules.select.default-title","wifiClient.ui.wps-button","wifiClient.network-name","wifiClient.network-select"],headers:O()}),C("controlPanel.wifiClient",D(),"wifiClient.description",{texts:["wifiClient.ui.wps-button","wifiClient.network-select"],headers:S("wifiClient.network-name",O(),e.pingcheck&&"pingcheck.title"),fields:{"iface-ip.mode":"iface-ip.auto-dhcp","iface-order.label":"iface-order.reserve"},substitutes:{"schedules.select.default-title":"ndm-isp-general-properties.set-internet-access-schedule"}});var N="otherConnections.ppp.add-button";if(C("controlPanel.otherConnections","otherConnections.header","otherConnections.description",{headers:w([h&&["ppp.header"],h&&["ppp.description"],e.wireguard&&y("wireguard.header","wireguard.description"),e.ipsec&&y("ipsec.header","ipsec.notice"),e.ip6&&y("ipv6to4.header","ipv6to4.description")],"otherConnections"),substitutes:t.extend({"otherConnections.ppp.editor.mtu":N},e["ike-client"]?{"dashboard.card_internet.types.IKEv1":N,"dashboard.card_internet.types.IKEv2":N}:{},e.openvpn?{"dashboard.card_internet.types.OpenVPN":N}:{},e.ipsec&&e.l2tp?{"dashboard.card_internet.types.IPsec":N}:{},e.sstp?{"dashboard.card_internet.types.SSTP":N}:{})}),C("controlPanel.policies","policies.page-title","policies.page-description",{headers:w([y("tabs.interface-priorities","interface-priorities.description"),y("tabs.policy-consumers","policy-consumers.description")],"policies")}),C("controlPanel.sms","sms.page-title",""),C("controlPanel.devicesList","devices-list.header","devices-list.description",{texts:["ndm-device-wifi-band.header","devices-list.device-card.wake-on-lan",e.trafficcontrol||b?"devices-list.not-registered-devices.show-advanced":""],headers:w([y("header","description","not-registered-devices"),"registered-devices.header",y("header","description","locked-devices"),"device-card.default-settings","device-card.opened-ports","ports.transfering","device-card.additional-info.header",e.ntce&&"device-card.interactive-applications","ports.description"],"devices-list")}),C("controlPanel.devicesList.offlineRegistration","devices-list.offline-device-registration.header","",{}),C("controlPanel.wifi2","wifi.header2","wifi.description",{headers:["wifi-settings.ap-header"]}),C("controlPanel.wifi5","wifi.header5","wifi.description",{headers:["wifi-settings.ap-header"]}),C("controlPanel.segments","segments.title","segments.description",{headers:S(["segments.section.switchports.header"],a===p.SYSMODE.ROUTER?w([e.igmp&&["igmp-proxy.header","igmp-proxy.description"],e.pppoe&&["pppoe-pass-through.header","pppoe-pass-through.description"]],"segments.section"):[]),texts:S(e.corewireless&&["wifi-settings.form.schedule","wifi-settings.form.ssid"],e.corewireless&&v.HAS_FT&&["wifi-settings.roaming-section.header","wifi-settings.roaming-section.description","wifi-settings.form.ft-mode.label","wifi-settings.form.rrm"],e.corewireless&&v.HAS_FT&&v.HAS_WIFI_5&&!l.NO_BAND_STEERING&&["wifi-settings.form.band-steering.label"],["segments.form.dhcp-mode.label"],["segments.form.enable-nat.label"]),customReadyEvent:p.events.SEGMENT_WIFI_SECTION_READY,parametrized:[],substitutes:t.extend({},e.corewireless&&l.HAS_WPA3?_defineProperty({},"WPA3-PSK","wifi-settings.form.security-protocol.label"):{})}),C("controlPanel.segments.WiFi","",null,{parametrized:[]}),C("controlPanel.wifiSystem","wifi-system.page-title","wifi-system.page-description",{texts:["wifi-system.tab.log","wifi-system.settings.backhaul.label"]}),C("controlPanel.intelliqos","intelliqos.title","intelliqos.description",{headers:w(["title","description"],"intelliqos.connection-speed-section")}),C("controlPanel.wifiClients","wifiClients.title","wifiClients.description"),C("controlPanel.trafficMonitor","traffic-monitor.page-title","traffic-monitor.page-description",{texts:["traffic-monitor.others.multicast"]}),C("controlPanel.firewall","firewall.headers.page","firewall.description",{headers:w(["title","description"],"firewall.rule-editor-popup")}),C("controlPanel.netFilter","netFilter.title","netFilter.description",{headers:S(e.skydns&&w(["account-header","popup-title","popup-description"],"netFilter.skydns"),e.safedns&&w(["account-header","popup-title","popup-description"],"netFilter.safedns"),e.ydns&&["netFilter.filters.yandexdns"],e["cloudflare-dns"]&&["netFilter.filters.cloudflare-dns"],e["adguard-dns"]&&["netFilter.filters.adguard-dns"],["netFilter.static-dns.header","netFilter.static-dns.description"],b&&["netFilter.profiles-header"],e["dns-tls"]&&y("header","description","netFilter.dns-over-tls"),e["dns-https"]&&y("header","description","netFilter.dns-over-https"))}),C("controlPanel.portForwarding","portforwarding.page-title","portforwarding.page-description",{headers:w(["rules-table-header",e.miniupnpd&&"upnp-rules-title","editor.description-text"],"portforwarding")}),C("controlPanel.remoteAccess","remoteAccess.title","",{parametrized:[{routeParams:{tab:"KeenDNS"},title:"remoteAccess.keendns.title",texts:["remoteAccess.keendns.description"].concat(_toConsumableArray(w(["internet-center-name",["internet-center-name","name-register"],["proxy.title","proxy.description"],["register-popup.title","register-popup.description"],"register-popup.free-names",["register-popup.occupied-names","register-popup.occupied-description"]],"remoteAccess.keendns")))},{routeParams:{tab:"DDNS"},title:"remoteAccess.ddns.title",texts:["remoteAccess.ddns.description"]}]}),C("controlPanel.staticRoutes","staticRoutes.headers.page","staticRoutes.description",{headers:w(["headers.table",["headers.uploader","uploader-subform.description"],["editor-popup.title","editor-popup.description"],"routes-table.header-ipv4",e.ip6&&"routes-table.header-ipv6"],"staticRoutes")}),C("controlPanel.wirelessAcl","wireless-acl.page-title",function(){return o.getTranslation("wireless-acl.page-description",null,{blacklist:o.getTranslation("wireless-acl.acl-mode.".concat(c.ACL_TYPE_DENY)),whitelist:o.getTranslation("wireless-acl.acl-mode.".concat(c.ACL_TYPE_PERMIT))})},{}),C("controlPanel.dectBase","dect.base.title","dect.base.description",{headers:S(w(["log.title"],"dect.base.form"),w([y("title","description"),y("title","description","popup"),y("title","description","popup.table")],"dect.handsets"))}),C("controlPanel.dectLines","dect.lines.title","dect.lines.description",{headers:S(["dect.lines.form.sip.title"],w(["title","section.sip-account","section.nat-traversal",y("section.codecs-list","section.codecs-list-description"),"section.call-forwarding"],"dect.lines.editor-popup"),[y("title","description","dect.lines.call-test-popup")])}),C("controlPanel.callHistory","dect.call-history.title","dect.call-history.description"),e.easyconfig){var L=o.isNdw3Available()?"NDW3InitialSetupWizard":"initialSetupWizard";C(L,"isw.search-link.title","isw.search-link.description",{texts:w(["wizard","initial-setup"],"isw.search-link.keywords")})}}();var i=Object.keys(h.getMenu());g=[],t.forEach(e,function(e,n){if(f[n]){var a=i.indexOf(n);-1!==a&&(f[n].menuGroupTitle=t.chain(i).slice(0,a).reverse().filter(function(e){return e.startsWith("menu.")}).get("[0]","").value()),T(n,f[n])}})},updateStateSearchData:function(e,t){f[e]?(g=g.filter(function(t){return t.sref!==e}),T(e,t(f[e]))):console.warn('No search data for "'.concat(e,'" sref'))}}}e.$inject=["$state","_","NDM","language","router","utils","debounce","menuSetup","wifiOptions","wirelessAcl","ifacePppModel","CONSTANT","appsPresets","privateCloudService"],angular.module("keenetic").factory("search",e)}(),function(){function e(e,t,n,i){var a=5e3,o=200,s=1200,r=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:s;if(i.isArray(e)){var r=n.all(e.map(function(e){return l(e,t,o)}));return r.spread=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:i.noop,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:i.noop;return r.then(function(t){return e.apply(void 0,_toConsumableArray(t))},function(e){return t(e)})},r}if(!i.isObject(e)&&h.isNotRealPath(e))return n.when(e);i.isString(e)&&(e=h.repairPath(e),e=i.set({},e,{}));var c=e,d=h.objectToQueries(c);if(d.length>1)throw new Error("Multi-queries objects are deprecated!");return d.forEach(function(e){return i.extend(e,{maxCacheAge:t,trailing:o})}),d.every(function(e){return g.exists(e)})?(d.forEach(function(e){return g.resolveQuery(e)}),n.when(!0).then(function(){return h.queriesToResponseObject(d)})):(d.forEach(function(e){e.makePromised(),v.addTask(e)}),n.all(d.map(function(e){return e.deferred.promise})).then(function(){return h.queriesToResponseObject(d)}))},l=function(e){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a,l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:s,c=n.defer();return function n(){r(e,o,l).then(function(e){if(void 0===e||i.isArray(e)&&void 0===e[0])return t(n,200);c.resolve(e)},function(){return t(n,200)})}(),c.promise},c=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"repairPath",value:function(e){return e.trim().replace("/",".",-1).replace(" ",".",-1)}},{key:"isNotRealPath",value:function(e){return!e||!isNaN(parseInt(e,10))||!i.isObject(e)&&!i.isString(e)||i.isString(e)&&["false","true","null","undefined"].includes(e.toLowerCase())}},{key:"generateQueryIdString",value:function(e,t){var n=e;if(i.isObject(t)){var a={};i.keys(t).sort().forEach(function(e){a[e]=t[e]}),n+=JSON.stringify(a)}else n+=JSON.stringify(t);return n}},{key:"normalizeRouterData",value:function(e,t){var n,a="POST"===t.method,o=h.parseRciTaskUrl(t.url),s=o.path,r=o.params,l=s?i.set({},s,e):e;return n=a?s?i.set({},s,i.merge(t.data,r)):i.merge(t.data,r):i.set({},s,r),a||n.show||(n={show:{rc:n}},l={show:{rc:l}}),{request:n,response:l}}},{key:"parseRciTaskUrl",value:function(e){var t=f.constants.RCI_URL+"/",n=e.slice(e.indexOf(t)+t.length).split("#")[0].trim(),i=n.split("?",2)[0].replace(/^\/|\/$/g,"").split("/").join("."),a={};return n.indexOf("?")>-1&&n.slice(n.indexOf("?")+1).split("&").forEach(function(e){var t=_slicedToArray(e.split("=",2),2),n=t[0],i=t[1];a[n]=i}),{path:i,params:a}}},{key:"checkResponseForWritingStatuses",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if("show"===n[0])return{};var a={};return this.checkIfWritingResultObject(e)?a[n.join(".")]=e.status:(i.isObject(e)||i.isArray(e))&&i.forEach(e,function(e,o){a=i.merge(a,t.checkResponseForWritingStatuses(e,[].concat(_toConsumableArray(n),[o])))}),a}},{key:"checkIfWritingResultObject",value:function(e){return i.isObject(e)&&i.isArray(e.status)&&!i.isEmpty(e.status)}},{key:"queriesToResponseObject",value:function(e){var t={};return e.forEach(function(e){return i.set(t,e.path,i.get(e.response,e.path))}),1===e.length?i.get(t,e[0].path,{}):t}},{key:"findQueryResponse",value:function(e,t){return(i.isArray(t)?t:[t]).find(function(t){return i.get(t,e.path)})}},{key:"objectToQueries",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if(!n.length&&i.isArray(t))return i.flattenDepth(t.map(function(t){return e.objectToQueries(t)}),2);var a=[];return i.forEach(t,function(t,o){if(i.isObject(t)&&!i.isArray(t)&&(t||"0"===t)){var s=n+(n.length?".":"")+o;i.find(t,i.isObject)?a.push.apply(a,_toConsumableArray(e.objectToQueries(t,s))):a.push(new p(s,t))}}),a}}]),e}(),d=function(){function e(){_classCallCheck(this,e),this.STATUSES={IDLE:1,DEBOUNCE:2,REQUEST:3},this.status=this.STATUSES.IDLE,this.tasks={},this.trailingTimers=[],this.trailing=s,this.leading=o,this.restartTimer=null}return _createClass(e,[{key:"addTask",value:function(e){this.tasks[e.id]||(this.tasks[e.id]=[]),this.tasks[e.id].push(e),this.onTasksAdded(e)}},{key:"addThrottleTimer",value:function(){var e=this;this.status===this.STATUSES.DEBOUNCE&&this.trailingTimers.push(t(function(){e.runRequest()},this.trailing))}},{key:"runDebounceTimer",value:function(){var e=this;t.cancel(this.restartTimer),this.status!==this.STATUSES.REQUEST&&(this.status===this.STATUSES.IDLE&&(this.status=this.STATUSES.DEBOUNCE,this.addThrottleTimer()),t.cancel(this.debounceTimer),this.debounceTimer=t(function(){return e.runRequest()},this.leading))}},{key:"resetTimers",value:function(){for(;this.trailingTimers.length;)t.cancel(this.trailingTimers.pop());t.cancel(this.debounceTimer),this.trailing=s}},{key:"onTasksAdded",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];e&&e.trailing&&e.trailing>0&&e.trailing<this.trailing&&(this.trailing=e.trailing,this.addThrottleTimer()),this.runDebounceTimer()}},{key:"runRequest",value:function(){var e=this;if(this.status===this.STATUSES.DEBOUNCE){this.status=this.STATUSES.REQUEST,this.resetTimers();var t=[],n={};this.resolveWithCacheAndClearQueue()||(n=i.pickBy(this.tasks,function(e){return i.get(e,"length",0)>0}),t=i.map(n,function(e){return i.set({},e[0].path,e[0].params)}),n=i.mapValues(n,function(e){return e.map(function(e){return Object.assign({},e,{requested:!0})})})),t.length?f.post({url:"",data:t}).then(function(){return e.onRequestFinal()},function(t){e.status=e.STATUSES.IDLE,i.forEach(n,function(e){e.forEach(function(e){e.deferred.reject(i.get(t,"reason"))})})}):this.onRequestFinal()}}},{key:"onRequestFinal",value:function(){var e=this;if(this.status===this.STATUSES.REQUEST){this.status=this.STATUSES.IDLE,t.cancel(this.restartTimer);var n=i.some(this.tasks,function(e){return!i.isEmpty(e)})?0:100;this.restartTimer=t(function(){e.runDebounceTimer()},n)}}},{key:"resolveWithCacheAndClearQueue",value:function(){var e=this,t=!0;return i.forEach(this.tasks,function(n,i){e.tasks[i]=[],n.forEach(function(n){!n||n.resolved||(g.exists(n)||n.requested)&&g.resolveQuery(n)||(e.tasks[i].push(n),t=!1)})}),t}}]),e}(),p=function(){function e(t,n){_classCallCheck(this,e),this.path=t,this.params=n,this.response=void 0,this.maxCacheAge=a,this.trailing=s,this.resolved=!1,this.deferred=!1,this.requested=!1,this.id=h.generateQueryIdString(this.path,this.params)}return _createClass(e,[{key:"resolve",value:function(e){this.resolved||i.isUndefined(e)||(this.response=e,this.resolved=!0,this.deferred&&this.deferred.resolve(this.response))}},{key:"makePromised",value:function(){this.deferred||(this.deferred=n.defer(),this.resolved&&this.deferred.resolve(this.response))}}]),e}(),u=function(){function e(t){_classCallCheck(this,e),this.update(t)}return _createClass(e,[{key:"update",value:function(e){this.created=Date.now(),this.data=e.response||void 0}}]),e}(),m=function(){function e(){_classCallCheck(this,e),this.db={},this.cleanExpired()}return _createClass(e,[{key:"cleanExpired",value:function(){var e=this;i.forEach(this.db,function(t,n){Date.now()-g.created>=6e4&&delete e.db[n]}),t(function(){return e.cleanExpired()},3e4)}},{key:"flush",value:function(){this.db={}}},{key:"cleanByPaths",value:function(e){var t=this,n=[];i.forEach(e,function(e){var t=e.split(".")[0];"show"===t||n.includes(t)||n.push(t)}),n.forEach(function(e){[e,"show.rc."+e,"show."+e].forEach(function(e){i.forEach(t.db,function(n,a){i.startsWith(a,e)&&delete t.db[a]})})})}},{key:"resolveQuery",value:function(e){var t=this.getCache(e);if(!i.isUndefined(t.data))return e.resolve(t.data),!0}},{key:"exists",value:function(e){var t=this.getCache(e);return t&&Date.now()-t.created<e.maxCacheAge}},{key:"getCache",value:function(e){return this.db[e.id]||!1}},{key:"setCache",value:function(e){this.db[e.id]?(e.id,this.db[e.id].update(i.cloneDeep(e))):(e.id,this.db[e.id]=new u(i.cloneDeep(e))),this.resolveQueueDebounced()}},{key:"resolveQueueDebounced",value:function(){t.cancel(this.queueDebounceTimer),this.queueDebounceTimer=t(function(){return v.resolveWithCacheAndClearQueue()},50)}}]),e}(),f={};t(function(){return angular.element(e).injector().invoke(["router",function(e){f=e}])});var g=new m,v=new d,h=new c;return{cachedRequest:l,sniff:function e(t,n){if(i.isArray(t)&&i.isArray(n.data))i.forEach(n.data,function(i,a){return e(t[a],Object.assign({},n,{data:i}))});else{var a=h.normalizeRouterData(t,n),o=a.request,s=a.response,r=Object.keys(h.checkResponseForWritingStatuses(s));r.length?g.cleanByPaths(r):h.objectToQueries(o).forEach(function(e){e.resolve(h.findQueryResponse(e,s)),g.setCache(e)})}},flushCache:function(){return g.flush()}}}e.$inject=["$document","$timeout","$q","_"],angular.module("keenetic").factory("routerCached",e)}(),function(){function e(e,t,n,i,a,o,s,r,l,c,d,p,u,m,f,g,v){var h,b,_,y,S,w,C,E,I,T=p.rciPrefix+"ci",k=p.rciPrefix+"rci",P=p.rciPrefix+"fui",A=p.rciPrefix+"storage",D={url:"",method:"POST",data:{system:{configuration:{save:!0}}}},O={RESET:"ndm:router-service-reset",SYSMODE_HEADER_RECEIVED:"sysMode",DEVICE_IS_ONLINE:"ndm:device-is-offline",DEVICE_IS_OFFLINE:"ndm:device-is-online",DEVICE_ACQUIRED_BY_MWS:"ndm:device-acquired-by-mws",DEVICE_RELEASED_BY_MWS:"ndm:device-released-by-mws",CONFIGURATION_SAVE:"ndm:system configuration save"},N=v.state,L=N.INITIAL_SETUP_WIZARD_STATE,x=N.LOGIN_STATE,R=N.NETFRIEND_REDIRECT_TO_WIZARD_STATE,M=N.NOT_SUPPORTED_BROWSER_STATE,$=function e(t,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];if(l.isObject(t)&&(l.has(t,"status")||l.has(t,"error"))&&l.has(t,"code")){var a=l.has(t,"error")?"error":t.status;n(i.join("."),t.message,t.code,a)}else(l.isObject(t)||l.isArray(t))&&l.forEach(t,function(t,a){return e(t,n,[].concat(_toConsumableArray(i),[a]))})},F=function(e){var t,n={};return t=function(e,t,i){n[e]={message:t,code:i}},$(e,function(e,n,i,a){"error"===a&&t(e,n,i)}),n},V=function(e,t){var n={},i=l.get(n,["__trace__",0,"duration"],null);!function e(t,n,i){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];l.isObject(t)&&n(a,t)&&i(a.join("."),t),(l.isObject(t)||l.isArray(t))&&l.forEach(t,function(t,o){e(t,n,i,[].concat(_toConsumableArray(a),[o]))})}(e,function(e,t){return l.has(t,"__trace__")},function(i,a){var o=i?l.get(t,i):{},s=i?"".concat(i,".").concat("__trace__"):"__trace__";n[i]={value:a.__trace__,params:l.isEmpty(o)?void 0:o},l.unset(e,s)});var a=l.chain(n).map(function(e,t){var n=l.get(e,"value.0"),i=l.get(e,"params"),a=Object.assign({},n,{path:t});return i&&(a.params=i),a}).value();if(l.isArray(e)||!i){var o=l.chain(a).filter("duration").orderBy("start","desc").value(),s=l.get(o,[0,"start"],0),r=l.get(o,[0,"duration"],0);i=m.round(s+r,3)}return{totalTime:i,traceList:l.chain(a).filter("duration").filter("path").map(function(e){return l.omit(e,["ident","start"])}).orderBy("duration","desc").value()}},U=function e(){var t=[L,R],n=[L,R,x,M];if(!e.calledOnce){e.calledOnce=!0;var i=s.current.name,a=function(){var e=r.location.pathname;if(i!==x){var n="";l.includes(t,i)||(n=e&&"/"!==e?"#goto="+e:""),r.location="/"+x+n}};e.redirectToNotSupportedPage?s.go(M):e.alertDisabled||l.includes(n,i)?a():d.alert("session-timed-out-alert").then(a)}},B={decorate:function(e){var t=function(t){e.canceled=!0,t&&t()};e.spread=function(n,i,a){var o=e.then(function(e){return e=e instanceof Array?e:[e],n.apply(void 0,e)},i,a);return o.cancel=t,o}},defer:function(){var e=t.defer();return this.decorate(e.promise),e}},W=[],H=0,q=function e(t){n(function(){"errors.no-connection-to-device"===t?e.noConnectionWarning=u.warning(t,0):u.warning(t)})},j=0,K=function o(){var r=[];!function c(d){var m=d.tasks.shift();m.unique&&(W=W.filter(function(e){return e.url!==m.url})),m.errorCount||m.noRetry||(m.errorCount=0),d.deferred.promise.canceled||d.pathControl&&-1===(s.current.name||"").indexOf(d.path)&&(!s.get(d.path)||s.get(d.path).parentState!==s.current.name)?W.length>0&&o():n(function(){m.startedAt=Date.now(),angular.isNumber(m.timeout)?(h=t.defer(),m.timerId=n(h.resolve,m.timeout),m.timeoutNumber=m.timeout,m.timeout=h.promise):m.isContinued?(n.cancel(m.timerId),h=t.defer(),n(h.resolve,m.timeoutNumber),m.timeout=h.promise):h=m.timeout;var s=function(n){function i(e){return t.when(e).then(function(){return{data:e}})}return n.url===k+"/true"?i(!0):n.url===k+"/false"?i(!1):(p.isTraceEnabled&&n.url===k+"/"&&(n.url+="?@trace=yes"),e(n))}(m).then(function(e){var t=e.data;if(t&&(j=Date.now(),a.$broadcast(O.DEVICE_IS_ONLINE),angular.isObject(t)&&!t.error)){var n=F(t),s=V(t,m.data),b=l.get(s,"traceList.length",0);if(f.SHOW_TRACE_IN_CONSOLE&&b>0){var _=b>1?"elements":"element",y="RCI TRACE:\n\t".concat(b," ").concat(_,"\n\tTotal time: ").concat(s.totalTime);console.groupCollapsed(y),s.traceList.forEach(function(e){return console.log(e)}),console.groupEnd(y)}l.find(n,function(e){return l.includes(e,"execute denied [http/rci]")})&&(a.$broadcast(v.events.READONLY_USER_LOGIN),n=l.pickBy(n,function(e){return!l.includes(e,"execute denied [http/rci]")}),console.warn('User account which has "readonly" tag can\'t modify Keenetic configuation'),d.deferred.reject(angular.copy(n))),m.silent&&(n={}),l.isEmpty(n)||(t.ndmErrors=(m.errorSuppressorFunction||angular.identity)(n),l.forEach(t.ndmErrors,function(e,t){var n,a,o=t.split("."),s=l.get(m.data,t);isNaN(parseInt(o[o.length-1],10))||(a=Number(o[o.length]),o=o.slice(0,-1)),n=(t=o.slice(0,-1).join(".")).length?t:"TOP LEVEL",i.error("NDM ERROR"+(angular.isDefined(a)?"\n\tINDEX: ".concat(a):"")+"\n\tPATH:  ".concat(n)+(angular.isDefined(s)?"\n\tDATA:  ".concat(JSON.stringify(s)):"")+"\n\tMSG:   ".concat(e.message," [[").concat(e.code,"]]"))}))}if(g.sniff(t,m),e.headers&&(a.$broadcast(O.SYSMODE_HEADER_RECEIVED,e.headers("ndm-sysmode")),e.headers("ndm-mws-controller")&&!p.DEVICE_IS_MWS_MEMBER?a.$broadcast(O.DEVICE_ACQUIRED_BY_MWS,e.headers("ndm-mws-controller")):!e.headers("ndm-mws-controller")&&p.DEVICE_IS_MWS_MEMBER&&a.$broadcast(O.DEVICE_RELEASED_BY_MWS)),angular.isDefined(t.ndmErrors)&&m.noRetry&&0===d.tasks.length)return i.error(m),void d.deferred.reject(t);if(t&&q.noConnectionWarning&&(u.hide(q.noConnectionWarning),H=0,q.noConnectionWarning=null),t.continued)d.deferred.notify(t),m.isContinued=!0,m.method="GET",d.timeoutTime=1100,d.continuedRequestData=t,d.continuedRequestUrl=m.url,0===angular.copy(d.tasks).filter(function(e){return e.url===d.continuedRequestUrl}).length&&d.tasks.unshift(m),c(d);else{if(d.continuedRequestUrl&&d.continuedRequestUrl===m.url&&(d.continuedRequestData=t),m.fetchKey&&(t=t[m.fetchKey]),m.convert2bool&&(t=Boolean(t&&t[0])),m.convert2array&&angular.isObject(t)){var S=[];for(var w in t)t[w].name=t[w].name||w,S.push(t[w]);t=S}r.push(t),d.tasks.length>0?c(d):(h=null,1===r.length?d.deferred.resolve(r[0]):d.deferred.resolve(r),W.length>0&&o())}});m.noRetry?s.catch(function(e){-1!==e.status?401!==e.status?(!m.isContinued&&m.startedAt>j&&a.$broadcast(O.DEVICE_IS_OFFLINE),d.deferred.reject(angular.extend(e,{continuedRequestData:d.continuedRequestData||!1})),H++,!m.silent&&H>=3&&!q.noConnectionWarning&&q("errors.no-connection-to-device")):U():d.deferred.reject(angular.extend(e,{reason:"cancelled by the browser"}))}):s.catch(function(e){-1!==e.status?401!==e.status?(!m.isContinued&&m.startedAt>j&&a.$broadcast(O.DEVICE_IS_OFFLINE),d.isFileUpload?d.deferred.reject(e):(m.errorCount++,H++,!m.silent&&m.errorCount>=3&&!q.noConnectionWarning&&q("errors.no-connection-to-device"),n(function(){d.timeoutTime=1e3,d.tasks.unshift(m),c(d)},1e3))):U():d.deferred.reject(angular.extend(e,{reason:"cancelled by the browser"}))})},d.timeoutTime)}(W.shift())},G=function(e,t,n,i){var o={deferred:n=n||B.defer(),timeoutTime:e.timeoutTime||100,pathControl:!angular.isDefined(i)||i};return angular.isArray(e)||(e=[e]),o.tasks=e.map(function(e){return function(e,t){return angular.isString(e)?e={url:e}:delete e.timeoutTime,"POST"===t&&(angular.isUndefined(e.url)&&(e={data:e,url:""}),"save"===e.url?e=angular.extend(e,D):e.data=e.data||{},(angular.isArray(e.data)&&l.some(e.data,"system.configuration.save")||l.get(e.data,"system.configuration.save"))&&a.$emit(O.CONFIGURATION_SAVE)),e.method=t,"*"===e.url.substr(0,1)&&(e.convert2bool=!0,e.url=e.url.substr(1)),"#"===e.url.substr(0,1)&&(e.convert2array=!0,e.url=e.url.substr(1)),e.url=e.url.split("#"),e.fetchKey=e.url[1],e.url=e.url[0],e.timeout||(e.timeout=4e4),e.url=k+"/"+e.url.replace(/ /g,"/"),e}(e,e.method||t)}),o.path=s.current.name,W.push(o),1===W.length&&K(),n.promise},Y=function e(n){var i=G(n,"POST",!1);return i.save=function(){return i.then(function(n){return e("save").then(function(){return t.resolve(n)})})},i},z=(_={},y=function(e,t){return(t=t||{}).id=e,t.cancel=function(){C(t.id)},t.start=function(){_[e]&&(t.paused=!1,_[e].paused=!1,w(e))},t.stop=function(){_[e]&&(t.paused=!0,_[e].paused=!0)},t},S=function(e,t,n,i){var a,o=String(Date.now())+Math.random();return _[o]={queries:e,period:t||1,callback:n,method:i&&i.toUpperCase()||"GET",path:s.current.name},b||E(),n?w(o):((a=y(o)).then=function(e){return _[o].callback=e,w(o)},a)},w=function(e){_[e]&&(_[e].pending=!0);var t,n=angular.copy(_[e]);return t=G(n.queries,n.method).spread(function(){var t=1===n.queries.length?[arguments]:arguments;_[e]&&(_[e].pending=!1),n.callback&&n.callback.apply(void 0,t)}),y(e,t)},{remove:C=function(e){if(e)delete _[e];else for(var t in I(),_)delete _[t]},get:function(){var e=Array.prototype.slice.call(arguments);return e[3]="GET",S.apply(void 0,e)},post:function(){var e=Array.prototype.slice.call(arguments);return e[3]="POST",S.apply(void 0,e)},start:E=function(){!function e(){var t=parseInt((new Date).getTime()/1e3,10);for(var i in _){var a=_[i];a.paused||(a.path!==s.current.name?C(i):t%a.period==0&&a&&!a.pending&&w(i))}b=n(e,1e3)}()},stop:I=function(){clearTimeout(b)},reset:function(){_={}}});return{get:function(e,t){return G(e,"GET",!1,t)},post:Y,postAndSave:function(e){var t=angular.isArray(e)?e:[e];return t.push(D.data),Y({url:"",data:t})},postToRciRoot:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Y(Object.assign({url:"",data:e},t))},arrayToQueryData:function(e){return e.filter(l.identity).reduce(function(e,t){return l.set(e,t,{})},{})},objectToQueryData:function(e){return l.reduce(e,function(e,t,n){return l.set(e,n,t)},{})},getNdmResponseErrors:F,containsNdmErrorCode:function(e,t){var n=F(e);return l.some(n,function(e){return e.code===t})},containsAnyNdmErrors:function(e){return!l.isEmpty(F(e))},getNdmStatuses:function(e){var t={};return $(e,function(e,n,i,a){t[e]={message:n,code:i,status:a}}),t},del:function(e){var n=G(e,"DELETE",!1);return n.save=function(){return n.then(function(e){return Y("save").then(function(){return t.resolve(e)})})},n},save:function(){return Y("save")},saveQueryStr:function(){return angular.copy(D)},reset:function(){h&&h.resolve&&(h.resolve(),h=null),W=[],z.reset(),a.$broadcast(O.RESET)},polling:z,poll:z.get,cached:g.cachedRequest,flushCache:g.flushCache,getUploadPort:function(e,n){var i={url:e},a=t.defer(),o=null,s=function(e){o.cancel(),a.reject(e)},r=function(e){e.port?(o.cancel(),a.resolve(e)):s(e)};return n&&(i.data=n),o=Y(i).spread(r,s,r),a.promise},uploadFile:function(e,n){var i=t.defer(),a=new FormData;return a.append("port",e.port.port),a.append("Filedata",n),W.push({deferred:i,tasks:[{method:"POST",url:P,data:a,headers:{"Content-Type":void 0}}],path:s.current.name,isFileUpload:!0,timeoutTime:0}),1===W.length&&K(),i.promise},configurationSaveEventName:String(O.CONFIGURATION_SAVE),events:O,disableLogoutAlert:function(){U.alertDisabled=!0},redirectError401ToNotSupportedPage:function(){U.redirectToNotSupportedPage=!0},constants:{CI_URL:T,STORAGE_URL:A,FUI_URL:P,RCI_URL:k}}}e.$inject=["$http","$q","$timeout","$log","$rootScope","$translate","$state","$window","_","authenticationService","modal","NDM","notification","utils","env","routerCached","CONSTANT"],angular.module("keenetic").config(["$provide",function(e){e.decorator("$q",["$delegate",function(e){var t=e.defer;return e.defer=function(){var e=t().promise.constructor.prototype;return Object.defineProperty(e,"spread",{value:function(e,t){return this.then(function(t){return e.apply(void 0,t)},t)},writable:!0,enumerable:!1}),t()},e}])}]),angular.module("keenetic").factory("router",e)}(),function(){function e(e,t,n,i,a){var o=function(e){return n.isArray(e)||(e=[e]),e.filter(n.identity).map(function(e){return n.isString(e)?function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return n.set({},e,t)}(e):e})};return{normalizeQuery:o,createRequester:function(){var s={callbacks:[],queryOptions:{},onPollCallback:n.noop,requestInProgress:!1,waitForCallbacksExecution:!0,defer:null,timer:null,timeout:3e3,maxRequestTimeout:4e4,isActive:!1,setQueryOptions:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};s.queryOptions=e},setOnPollCallback:function(e){s.onPollCallback=e},setPollInterval:function(e){s.timeout=i.restrictNumber(e,100,1e5)},getPollInterval:function(){return s.timeout},cancelCurrentPollRequest:function(){var n=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return(s.defer?e.when(s.defer.resolve()).then(function(){return!0}):e.when(!1)).then(function(e){return s.defer=null,s.requestInProgress=!1,n?s.timer=t(s.poll,s.timeout):(t.cancel(s.timer),s.timer=null),e})},startPolling:function(){return s.timer||s.poll(),s.isActive=!0,s.isActive},stopPolling:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return s.timer&&t.cancel(s.timer),e?s.cancelCurrentPollRequest(!1):(s.defer=null,s.requestInProgress=!1),s.isActive=!1,s.isActive},_onPollEnd:function(){s.callbacks=s.callbacks.filter(function(e){return!e.runOnce}),s.timer=t(s.poll,s.timeout),s.defer=null,s.requestInProgress=!1,t.cancel(s.cancelTimer)},poll:function(){if(s.requestInProgress)return e.when(!1);t.cancel(s.timer),s.timer=null,s.callbacks=n.map(s.callbacks,function(e){var t=[],n={};if(e.queryConstructorFunction){var i=e.queryConstructorFunction();i.query?(t=o(i.query),n=i.dataForCallback):t=o(i)}else t=e.queryArray;return Object.assign({},e,{queryArray:t,dataForCallback:n})});var r=function(e){var t=n.reduce(e,function(e,t,n){var a=JSON.stringify(t),o=i.getStringHash(a);return e[o]?e[o].indices.push(n):e[o]={hash:o,query:t,indices:[n]},e},{}),a=n.sortBy(t,"hash");return t=n.reduce(a,function(e,t,n){return Object.assign({},e,_defineProperty({},t.hash,Object.assign({},t,{hashIdx:n})))},{}),{queryArray:a=a.map(function(e){return e.query}),queryMap:t}}(n.flatMap(s.callbacks,"queryArray")),l=r.queryArray,c=r.queryMap;return n.isEmpty(l)?(s._onPollEnd(),e.when(!1)):(s.requestInProgress=!0,s.defer=e.defer(),s.cancelTimer=t(s.defer.resolve,s.maxRequestTimeout),a.post(Object.assign({url:"",data:l,timeout:s.defer.promise},s.queryOptions)).then(function(i){if(!s.isActive)return s.defer=null,t.cancel(s.cancelTimer),e.when(!1);s.onPollCallback(i,l);var a=function(e,t){return n.chain(t).flatMap(function(t){var n=t.hashIdx,i=t.indices,a=e[n];return i.map(function(e){return{idx:e,response:a}})}).sortBy("idx").map("response").value()}(i,c),o=s.callbacks.reduce(function(e,t){var i=t.queryArray,o=e.startIdx,s=e.chunks,r=o+n.get(i,"length",0);return s.push(a.slice(o,r)),{startIdx:o=r,chunks:s}},{startIdx:0,chunks:[]}).chunks;return e.all(s.callbacks.map(function(t,i){var a=t.callback,r=t.queryArray,l=t.dataForCallback||{};return n.get(o[i],"length")!==n.get(r,"length")?e.when(!0):s.waitForCallbacksExecution?e.when(a(o[i],l)):(a(o[i],l),e.when(!0))}))}).finally(s._onPollEnd))},registerCallback:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(e){var a=o(e),r=i.getUniqueId();return s.callbacks.push({queryArray:a,callback:t,runOnce:n,uid:r}),r}},registerDynamicCallback:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=i.getUniqueId();return s.callbacks.push({queryConstructorFunction:e,callback:t,runOnce:n,uid:a}),a},unregisterCallback:function(e){var t=0;return s.callbacks=n.reduce(s.callbacks,function(n,i){return i.uid===e?t++:n.push(i),n},[]),t>0},clearCallbacks:function(){s.callbacks=[]}};return s}}}e.$inject=["$q","$timeout","_","utils","router"],angular.module("keenetic").factory("requesterFactory",e)}(),function(){angular.module("keenetic").factory("relaxedJson",function(){function e(e){return function(t){var n=[],i=1;for(;""!==t;){var a=function(e,t){for(var n=!1,i=0;i<e.length;i++)if(n=t(e[i],i,e))return n;return n}(e,function(e){var n=e.re.exec(t);if(n){var a=n[0];return t=t.slice(a.length),{raw:a,matched:e.f(n,i)}}});if(!a){var o=new SyntaxError("Unexpected character: "+t[0]+"; input: "+t.substr(0,100));throw o.line=i,o}a.matched.line=i,i+=a.raw.replace(/[^\n]/g,"").length,n.push(a.matched)}return n}}function t(e){var t=e[1].replace(/([^\'\\]|\\[\'bnrtf\\]|\\u[0-9a-fA-F]{4})/g,function(e){return'"'===e?'\\"':"\\'"===e?"'":e});return{type:"string",match:'"'+t+'"',value:JSON.parse('"'+t+'"')}}function n(e){return{type:"string",match:e[0],value:JSON.parse(e[0])}}function i(e){return{type:"string",value:e[0],match:'"'+e[0].replace(/./g,function(e){return"\\"===e?"\\\\":e})+'"'}}function a(e){return{type:" ",match:e[0].replace(/./g,function(e){return/\s/.test(e)?e:" "})}}function o(e){return{type:"number",match:e[0],value:parseFloat(e[0])}}function s(e){var t;switch(e[1]){case"null":t=null;break;case"true":t=!0;break;case"false":t=!1}return{type:"atom",match:e[0],value:t}}function r(e){function r(e){return function(t){return{type:e,match:t[0]}}}var l=[{re:/^\s+/,f:r(" ")},{re:/^\{/,f:r("{")},{re:/^\}/,f:r("}")},{re:/^\[/,f:r("[")},{re:/^\]/,f:r("]")},{re:/^,/,f:r(",")},{re:/^:/,f:r(":")},{re:/^(true|false|null)/,f:s},{re:/^\-?\d+(\.\d+)?([eE][+-]?\d+)?/,f:o},{re:/^"([^"\\]|\\["bnrtf\\\/]|\\u[0-9a-fA-F]{4})*"/,f:n}];return e&&(l=l.concat([{re:/^'(([^'\\]|\\['bnrtf\\\/]|\\u[0-9a-fA-F]{4})*)'/,f:t},{re:/^\/\/.*?(?:\r\n|\r|\n)/,f:a},{re:/^\/\*[\s\S]*?\*\//,f:a},{re:/^[$a-zA-Z0-9_\-+\.\*\?!\|&%\^\/#\\]+/,f:i}])),l}var l=e(r(!0)),c=e(r(!1));function d(e,t){for(;t>=0;t--)if(" "!==e[t].type)return t}function p(e){var t=[];return e.forEach(function(n,i){if("]"===n.type||"}"===n.type){var a=d(t,i-1);if(a&&","===t[a].type){var o=d(t,a-1);o&&"["!==t[o].type&&"{"!==t[o].type&&(t[a]={type:" ",match:" ",line:e[a].line})}}t.push(n)}),t}function u(e){var t=l(e);return(t=p(t)).reduce(function(e,t){return e+t.match},"")}function m(e,t){var n=e[t.pos];if(t.pos+=1,!n){var i=0!==e.length?e[e.length-1].line:1;return{type:"eof",line:i}}return n}function f(e){switch(e.type){case"atom":case"string":case"number":return e.type+" "+e.match;case"eof":return"end-of-file";default:return"'"+e.type+"'"}}function g(e,t,n){for(var i=[",",":","]","}"],a=m(e,t);;){if(n&&-1!==n.indexOf(a.type))return a;if("eof"===a.type)return a;if(-1===i.indexOf(a.type))return a;var o="Unexpected token: "+f(a)+", expected '[', '{', number, string or atom";if(!t.tolerant){var s=new SyntaxError(o);throw s.line=a.line,s}t.warnings.push({message:o,line:a.line}),a=m(e,t)}}function v(e,t,n){if(!e.tolerant){var i=new SyntaxError(n);throw i.line=t.line,i}e.warnings.push({message:n,line:t.line})}function h(e,t,n){v(e,t,"Unexpected token: "+f(t)+", expected "+n)}function b(e,t,n,i){void 0!==(i=e.reviver?e.reviver(n,i):i)&&(t[n]=i)}function _(e,t,n){var i,a,o=g(e,t,[":"]);if("string"!==o.type)switch(h(t,o,"string"),o.type){case":":o={type:"string",value:"null",line:o.line},t.pos-=1;break;case"number":case"atom":o={type:"string",value:""+o.value,line:o.line};break;case"[":case"{":return t.pos-=1,a=w(e,t),void b(t,n,"null",a)}!function(e,t,n){var i=n.value;e.duplicate&&Object.prototype.hasOwnProperty.call(t,i)&&v(e,n,"Duplicate key: "+i)}(t,n,o),i=o.value,function(e,t){var n=m(e,t);if(":"!==n.type){var i="Unexpected token: "+f(n)+", expected ':'";if(!t.tolerant){var a=new SyntaxError(i);throw a.line=n.line,a}t.warnings.push({message:i,line:n.line}),t.pos-=1}}(e,t),a=w(e,t),b(t,n,i,a)}function y(e,t,n){var i=n.length,a=w(e,t);n[i]=t.reviver?t.reviver(""+i,a):a}function S(e,t,n,i){var a=g(e,t,i.skip);switch("eof"===a.type&&(h(t,a,"'"+i.endSymbol+"' or "+i.elementName),a={type:i.endSymbol,line:a.line}),a.type){case i.endSymbol:return n;default:t.pos-=1,i.elementParser(e,t,n)}for(;;)switch((a=m(e,t)).type!==i.endSymbol&&","!==a.type&&(h(t,a,"',' or '"+i.endSymbol+"'"),a={type:"eof"===a.type?i.endSymbol:",",line:a.line},t.pos-=1),a.type){case i.endSymbol:return n;case",":i.elementParser(e,t,n)}}function w(e,t,n){var i,a=g(e,t);switch("eof"===a.type&&h(t,a,"json object"),a.type){case"{":i=function(e,t){return S(e,t,{},{skip:[":","}"],elementParser:_,elementName:"string",endSymbol:"}"})}(e,t);break;case"[":i=function(e,t){return S(e,t,[],{skip:["]"],elementParser:y,elementName:"json object",endSymbol:"]"})}(e,t);break;case"string":case"number":case"atom":i=a.value}return n&&(i=t.reviver?t.reviver("",i):i,function(e,t,n){t.pos<e.length&&v(t,e[t.pos],"Unexpected token: "+f(e[t.pos])+", expected end-of-input");if(t.tolerant&&0!==t.warnings.length){var i=1===t.warnings.length?t.warnings[0].message:t.warnings.length+" parse warnings",a=new SyntaxError(i);throw a.line=t.warnings[0].line,a.warnings=t.warnings,a.obj=n,a}}(e,t,i)),i}function C(e){switch(_typeof(e)){case"string":case"number":case"boolean":return JSON.stringify(e)}if(Array.isArray(e))return"["+e.map(C).join(",")+"]";if(new Object(e)===e){var t=Object.keys(e);return t.sort(),"{"+t.map(function(e,t){return JSON.stringify(t)+":"+C(e[t])}.bind(null,e))+"}"}return"null"}return{transform:u,parse:function(e,t){if("function"==typeof t||void 0===t)return JSON.parse(u(e),t);if(new Object(t)!==t)throw new TypeError("opts/reviver should be undefined, a function or an object");if(t.relaxed=void 0===t.relaxed||t.relaxed,t.warnings=t.warnings||t.tolerant||!1,t.tolerant=t.tolerant||!1,t.duplicate=t.duplicate||!1,!t.warnings&&!t.relaxed)return JSON.parse(e,t.reviver);var n=t.relaxed?l(e):c(e);t.relaxed&&(n=p(n));if(t.warnings){n=n.filter(function(e){return" "!==e.type});var i={pos:0,reviver:t.reviver,tolerant:t.tolerant,duplicate:t.duplicate,warnings:[]};return w(n,i,!0)}var a=n.reduce(function(e,t){return e+t.match},"");return JSON.parse(a,t.reviver)},stringify:C}})}(),function(){function e(e,t,n,i,a,o,s,r){var l=s.profile.components,c=l["config-ap"]||l["config-repeater"]||l["config-extender"]||l["config-client"],d=null,p=r.SYSMODE;return t.$on(r.events.FACTORY_RESET,function(){d=null}),t.$on(i.configurationSaveEventName,function(){d=!1}),t.$on(i.events.DEVICE_IS_OFFLINE,function(){d=null}),{check:function(){if(null!==d)return e.when(d);var a={};return l.easyconfig&&n.set(a,"show.last-change",{}),n.set(a,"whoami",{}),n.set(a,"show.rc.user",{}),c&&n.set(a,"show.system.mode",{}),i.post({data:a,url:""}).then(function(e){var i,a,r,c;i=e,a=n.get(i,"whoami",{}),r=n.get(i,"show.rc.user",{}),c=n.get(r,[a.user]),t.currentUser=c;var u=n.get(e,"show.system.mode",!1),m=n.get(e,"show.last-change",{}),f=n.get(s,"profile.extras.ndw3")||n.has(l,"ndw3");return(d=l.easyconfig&&(!u||u.active!==p.CLIENT)&&(!m.agent||"default"===m.agent||f&&m.easyconfig))||o.initInternalTimer(),d})}}}e.$inject=["$q","$rootScope","_","router","administrator","keeneticTime","NDM","CONSTANT"],angular.module("keenetic").factory("redirectChecker",e)}(),function(){function e(e,t,n){var i=null,a=null,o={},s=!1;n.onStart({},function(e){e.from().$$state()&&s&&(a=i,i={state:e.from(),params:e.params("from")},e.promise.then(function(){a=null}).catch(function(){i=a})),s=!0});var r={get:function(e){return(e?o[e]:i)||{state:{name:""},params:{}}},set:function(t,n,i){o[t]={state:e.get(n),params:i}},go:function(n,i){var a=r.get(n);return a?e.go(a.state,a.params,i):t.reject(new Error("no previous state "+(n?"for memo: "+n:"")))},memo:function(t,n,a){o[t]=i||{state:e.get(n),params:a}},forget:function(e){e?delete o[e]:i=void 0}};return r}e.$inject=["$state","$q","$transitions"],angular.module("keenetic").service("$previousState",e),e.$inject=["$state","$q","$transitions"]}(),function(){function e(e,t,n,i,a){var o=a.USBDSL_IFACE,s=function(){function s(t){_classCallCheck(this,s),this.ifaces=angular.copy(t),e.forEach(this.ifaces,function(e,t){e.id=t})}return _createClass(s,[{key:"findIspTunnel",value:function(t){var n=this;if(!this.ifaces[t])return!1;var i=this.findChildrenPppIfaces(this.ifaces[t]),a=e.filter(i,function(e){return n.isIspTunnel(e)});return a&&a[0]||!1}},{key:"findOtherConnections",value:function(){var t=this,n=e.pickBy(this.ifaces,function(e){return t.isPpp(e)||t.isOtherTunnelType(e)});return e.pickBy(n,function(e){return t.isOtherTunnelType(e)||!t.isIspTunnel(e)})}},{key:"checkIfCanBeAssignedToIsp",value:function(t){var n=this,i=this.ifaces[t];if(!i)return!1;if(!this.isPpp(i))return!1;if(this.isIspTunnel(i))return!1;if(this.hasRole("misc",i))return!1;var a=this.getParentIface(i);if(a&&this.isIspIface(a))return!(e.filter(this.findChildrenPppIfaces(a),function(e){return n.hasRole("inet",e)}).length>0)&&a;if(a)return!1;var o=e.filter(this.ifaces,function(e){return n.isIspIface(e)&&n.isGlobal(e)&&0===n.findChildrenPppIfaces(e).length});return 1===o.length&&o[0]}},{key:"isPpp",value:function(t){var i=this;return Boolean(e.find(n.ISP_PPP_IFACE_TYPES,function(e){return i.isTypeOf(t,e)}))}},{key:"isOtherTunnelType",value:function(t){var i=this;return Boolean(e.find(n.OTHER_PPP_IFACE_TYPES,function(e){return i.isTypeOf(t,e)}))}},{key:"isTypeOf",value:function(e,t){return Boolean(e.id.match("^"+t+"\\d+$"))}},{key:"isIspTunnel",value:function(e){var t=this.getParentIface(e);return!!t&&(!!this.isIspIface(t)&&(!!this.hasRole(n.INTERFACE_ROLE.INET,e)||!this.hasRole(n.INTERFACE_ROLE.MISC,e)&&(1===this.findChildrenPppIfaces(t).length&&(!!this.isPppoe(e)||!this.isGlobal(t)))))}},{key:"isGlobal",value:function(t){return Boolean(e.get(t,"ip.global.enabled"))}},{key:"isPppoe",value:function(e){return this.isTypeOf(e,"PPPoE")}},{key:"hasRole",value:function(t,n){return e.includes(e.isArray(n.role)?n.role:[],t)}},{key:"getParentIface",value:function(t){var n=e.get(t,"connect.via");if(n)return e.find(this.ifaces,function(e){return e.id===n||e.rename===n})||!1}},{key:"findChildrenPppIfaces",value:function(t){return e.filter(this.ifaces,function(n){var i=e.get(n,"connect.via");return i===t.id||t.rename&&i===t.rename})}},{key:"startsWithDslPrefix",value:function(n){return e.find([o,t.DSL],function(t){return e.startsWith(n,t)})}},{key:"findParentDslInterfaceId",value:function(t){var n=this.startsWithDslPrefix(t);if(n)return n;var i=e.findKey(this.ifaces,function(e,n){return t===n||e.rename===t});return!!i&&this.startsWithDslPrefix(i)}},{key:"isIspIface",value:function(t){var o=this;if(t.ipoe)return!0;var s=t.id,r=this.findParentDslInterfaceId(s);if(!r){var l=e.get(t,"inherit.interface",""),c=e.chain(t).get("include",[]).map(function(t){return e.get(t,"interface","")}).value(),d=[l].concat(_toConsumableArray(c)).filter(Boolean).map(function(e){return o.findParentDslInterfaceId(e)}).filter(Boolean);r=e.get(d,"[0]",!1)}if(!r)return!1;var p=this.ifaces[r],u=e.get(p,"operating-mode.mode"),m=e.includes(u,"vdsl");if(m&&u!==a.VDSL_CLIENT_OPMODE)return!1;if(m){var f=e.find(this.ifaces,function(t){return e.startsWith(t.id,r+"/Vlan")&&e.isObject(t.ip)&&(!e.isArray(t.role)||e.find(t.role,{role:n.INTERFACE_ROLE.INET}))});return t.id===(f?f.id:r)}return i.hasRole(t,n.INTERFACE_ROLE.INET)||e.get(t,"ipvc.role")===n.INTERFACE_ROLE.INET}}]),s}();return{findIspTunnel:function(e,t){return new s(t).findIspTunnel(e)},findOtherConnections:function(e){return new s(e).findOtherConnections()},checkIfCanBeAssignedToIsp:function(e,t){return new s(t).checkIfCanBeAssignedToIsp(e)}}}e.$inject=["_","NDM","CONSTANT","interfaces","usbdslConsts"],angular.module("keenetic").factory("pppPurposeChecker",e)}(),angular.module("keenetic").factory("NDM",function(){var e=window.NDM||{};return e.rciPrefix=e.rciPrefix||window.rciPrefix,e}),function(){function e(e){var t={RIGHT:"right",BELOW:"below",ABOVE:"above",LEFT:"left"};return{SIDES:t,DEFAULT_DIRECTION:t.ABOVE,PREFERRED_SIDES_ORDER:[t.RIGHT,t.BELOW,t.ABOVE,t.LEFT],getWindowSize:function(){var t=e.getWindowRect();return{height:t.bottom-t.top,width:t.right-t.left}},getDistances:function(e,n){var i;return _defineProperty(i={},t.BELOW,n.height-e.top),_defineProperty(i,t.ABOVE,e.top),_defineProperty(i,t.RIGHT,n.width-e.left),_defineProperty(i,t.LEFT,e.left),i}}}e.$inject=["browserCheck"],angular.module("keenetic").factory("ndmTooltipService",e)}(),function(){function e(e,t,n,i){var a,o=i.rciPrefix+"db/mobile-operators.json";return{getAll:function(){return e.isEmpty(a)?n({method:"GET",url:o}).then(function(e){return e.data}).then(function(e){return a=e,e}):t.when(a)}}}e.$inject=["_","$q","$http","NDM"],angular.module("keenetic").factory("mobileOperatorsDb",e)}(),function(){function e(e,t,n,i,a){var o=function(){var e=i().getMenu(),t={};return a.getSegments().then(function(n){for(var i in e)if(e[i].name=i,"controlPanel.segments"===i)for(var a in n){var o=i+"."+a,s=n[a];t[o]=angular.copy(e[i]),t[o].srefParams={tab:s.description},t[o].isSegment=!0,t[o].isHomeSegment=s.isHomeSegment,t[o].parentSref=i,t[o].menuTitle=s.description,t[o].path="/"+(i+"."+s.description).replace(/\./g,"/"),t[o].hasWifi=s.hasWifi,t[o].hasWifi2Ghz=s.hasWifi2Ghz,t[o].hasWifi5Ghz=s.hasWifi5Ghz,t[o].wifiBands=s.wifiBands}else t[i]=e[i];return t})};return{getMenu:o,getRoutes:function(){return i().getRoutes()},updateMenu:function(){e.$broadcast(t.events.REFRESH_MENU)},hasSmsSection:function(){return o().then(function(e){return"controlPanel.sms"in e})}}}e.$inject=["$rootScope","CONSTANT","_","menuSetup","interfaces"],angular.module("keenetic").factory("menuService",e)}(),function(){angular.module("keenetic").provider("localStorage",["$windowProvider",function(t){var n=t.$get().localStorage||new e;this.$get=function(){return n}}]);var e=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"getItem",value:function(e){return this[String(e)]}},{key:"setItem",value:function(e,t){this[String(e)]=String(t)}},{key:"removeItem",value:function(e){delete this[String(e)]}},{key:"clear",value:function(){var e=this;Object.keys(this).forEach(function(t){return delete e[t]})}},{key:"length",get:function(){return Object.keys(this).length}}]),e}()}(),function(){function e(e,t,n,i,a,o,s){var r,l=function(t){var n=t.rciPaths,r=t.modalTemplateUrl,l=t.modalControllerName,p=t.isAcceptedFunction,u=t.isAcceptedOnMwsCandidate,m={rciPaths:n,isModalAlreadyOpened:!1,textAvailable:!1,modal:{templateUrl:r,controllerName:l},isAccepted:function(e){return p(e)},isAcceptedOnMwsCandidate:function(e){return u(e)},showModal:function(t){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(m.isModalAlreadyOpened)return e.when(!0);m.isModalAlreadyOpened=!0;var i=m.modal;return d({templateUrl:i.templateUrl,controllerName:i.controllerName,isInReviewMode:t,shouldAcceptLicense:n,getLicenseText:m.getLicenseText,acceptLicense:m.acceptLicense,onModalClose:function(){m.isModalAlreadyOpened=!1}})},getDocumentsList:function(){var e=m.rciPaths,t=s.set({},e.GET_LIST,{});return a.postToRciRoot(t).then(function(t){return s.get(t,e.GET_LIST_GETTER,[])})},getDocumentText:function(e){var t=m.rciPaths,n=s.set({},t.GET_TEXT,e);return a.postToRciRoot(n).then(function(e){return s.get(e,t.GET_TEXT_GETTER,"")})},getLicenseText:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return m.getDocumentsList().then(function(t){var n=o.getRealLanguage(),i=c(t,n,e);return i?m.getDocumentText({format:"md",language:i}):m.getDocumentText({format:"md"})}).then(function(e){return m.textAvailable=Boolean(e),e})},acceptLicense:function(){var e=i.toRciQueryList([m.rciPaths.ACCEPT]);return a.postAndSave(e)}};return m},c=function(e,t,n){var i;return n&&(i=s.find(e,function(e){return e.version===n})),i||(i=s.chain(e).sortBy("version").last().value()),s.get(i,"document",[]).some(function(e){return e.lang===t})?t:null},d=function(i){var a=i.templateUrl,o=i.controllerName,r=i.isInReviewMode,l=i.shouldAcceptLicense,c=i.getLicenseText,d=i.acceptLicense,p=i.onModalClose,u=void 0===p?s.noop:p,m=e.defer();return t(function(){n.showModal({templateUrl:a,controller:o,controllerAs:"vm",inputs:{isInReviewMode:r,shouldAcceptLicense:l,getLicenseText:c,acceptLicense:d}}).then(function(e){e.close.then(function(e){e?m.resolve(!0):m.reject(!1),u()})})}),m.promise},p={EULA:"EULA",DPN:"DPN"},u=(_defineProperty(r={},p.EULA,l({rciPaths:{ACCEPT:"eula.accept",GET_LIST:"show.eula.list",GET_LIST_GETTER:"show.eula.list.eula",GET_TEXT:"show.eula.document",GET_TEXT_GETTER:"show.eula.document.eula-document.text"},modalTemplateUrl:"app/components/ndm-eula/eula.modal.html",modalControllerName:"NdmEulaModalController",isAcceptedFunction:function(e){return!s.get(e,"eula-status",!1)},isAcceptedOnMwsCandidate:function(e){return s.get(e,"eula-accepted",!1)}})),_defineProperty(r,p.DPN,l({rciPaths:{ACCEPT:"dpn.accept",GET_LIST:"show.dpn.list",GET_LIST_GETTER:"show.dpn.list.dpn",GET_TEXT:"show.dpn.document",GET_TEXT_GETTER:"show.dpn.document.dpn-document.text"},modalTemplateUrl:"app/components/ndm-dpn/dpn.modal.html",modalControllerName:"NdmDpnModalController",isAcceptedFunction:function(e){if(!s.has(e,"dpn-status"))return!0;var t=s.get(e,"dpn-status.version",-1);return s.get(e,"dpn-status.accepted",-1)>=t},isAcceptedOnMwsCandidate:function(e){return s.get(e,"dpn-accepted",!1)}})),r);return{LICENSE:u,LICENSE_IDS:p,checkAcceptance:function(){return a.cached("show.last-change").then(function(t){var n=s.pickBy(u,function(e){return!e.isAccepted(t)});return s.isEmpty(n)?e.when(!0):s.reduce(n,function(e,t){return e.then(function(){return t.showModal(!1)})},e.when(!0))})},acceptEveryLicense:function(){return s.reduce(u,function(e,t){return e.then(function(){return t.acceptLicense()})},e.when(!0))},previewLicense:function(e){if(u[e])return u[e].showModal(!0)},checkMwsCandidateLicenses:function(t){var n=s.pickBy(u,function(e){return!e.isAcceptedOnMwsCandidate(t)});return s.reduce(n,function(e,t){return e.then(function(){return t.getLicenseText()}).then(function(n){return n?t.showModal(!1,!1):e})},e.when(!0))}}}e.$inject=["$q","$timeout","modal","utils","router","language","_"],angular.module("keenetic").factory("licensesService",e)}(),function(){angular.module("keenetic").factory("keyboard",function(){var e={0:"\\",8:"backspace",9:"tab",12:"num",13:"enter",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"caps",27:"escape",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",44:"print",45:"insert",46:"delete",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z",91:"cmd",92:"cmd",93:"cmd",96:"num_0",97:"num_1",98:"num_2",99:"num_3",100:"num_4",101:"num_5",102:"num_6",103:"num_7",104:"num_8",105:"num_9",106:"num_multiply",107:"num_add",108:"num_enter",109:"num_subtract",110:"num_decimal",111:"num_divide",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",124:"print",144:"num",145:"scroll",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",223:"`",224:"cmd",225:"alt",57392:"ctrl",63289:"num",59:";",61:"=",173:"-"},t={esc:"Escape",escape:"Escape",enter:"Enter",up:"ArrowUp",down:"ArrowDown"},n=function(t){return t._code?t:(t._which="number"==typeof t.which?t.which:t.keyCode,t._code=function(t){if(e[t._which])return e[t._which];return String.fromCharCode(t._which).toLowerCase()}(t),t._key=t.key||t.keyCode,t)},i=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return t.map(function(t){return e[t]||String(t)})},a=function(e){for(var t=arguments.length,a=new Array(t>1?t-1:0),o=1;o<t;o++)a[o-1]=arguments[o];return function(t){return t.code===e||-1!==i(a).indexOf(n(t)._code)}};return{normalizeEvent:n,isNotKeys:function(e){var a=[],o=[];return i(e).forEach(function(e){o.push(e),t[e]&&a.push(t[e])}),function(e){var t=e.code;return(!t||-1===a.indexOf(t))&&-1===o.indexOf(n(e)._code)}},isKey:function(e,t){return e=n(e),isNaN(parseInt(t,10))?t===e._code||e.code&&t===e.code:t===e._key},isTab:a("Tab","tab"),isSpace:a("Space","space"),isEnter:a("Enter","enter"),isEscape:a("Escape","escape","esc"),isBackspace:a("Backspace","backspace"),isUpArrow:a("ArrowUp","up"),isDownArrow:a("ArrowDown","down")}})}(),function(){function e(e,t,n,i,a,o){var s=function(e){return new Date(e.year,e.month-1,e.day,e.hour,e.min,e.sec,e.msec)},r=function(){return n.get("show/clock/date").then(s)},l=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t.noop,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=Object.assign({onLag:t.noop,startDate:new Date},i),s=o.onLag,r=o.startDate.getTime(),l=Date.now()-r,c=Date.now()+e,d={timeoutHandle:null,isStarted:!1,onLag:s,onTick:n,setOnTick:function(e){d.onTick=e},getTicks:function(){return Math.floor((Date.now()-r-l)/e)},stop:function(){a.cancel(d.timeoutHandle),d.timeoutHandle=null,d.isStarted=!1},start:function(){d.isStarted||(d.isStarted=!0,d.timeoutHandle=a(p,e))},reset:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;d.stop(),r=(t||new Date).getTime(),l=Date.now()-r,c=Date.now()+e,d.start()}},p=function t(){var n=Date.now()-c,i=d.getTicks();n>e&&(d.onLag({ticks:i,dt:n,interval:e,shift:l}),c+=e*Math.floor(n/e)),d.onTick({ticks:i,dt:n,interval:e,shift:l}),c+=e,d.timeoutHandle=a(t,Math.max(0,e-n))};return d},c=0,d=l(1e3),p=[],u=function(e){d.isStarted||(e instanceof Date?(c=e.getTime(),d.reset(e),d.setOnTick(function(e){var t=e.ticks;if(0!==p.length){var n=new Date(c+1e3*t);p.forEach(function(e){return e.onTick(n)})}})):console.warn("startInternalTimer: Invalid Date object passed"))},m=function(){return d.isStarted?e.when(!0):r().then(u)};return{NTP_SERVICE_NAME:"ntp-client",createKeeneticTime:s,getKeeneticTime:r,isNtpServiceEnabled:function(){return n.get("service").then(function(e){return t.get(e,"ntp-client",!1)})},getCurrentTime:function(e){var t=e instanceof Date?e:s(e);return{dateObj:t,currentTime:[o.isMobile?t.toLocaleDateString():t.toLocaleDateString(i.getCurrentLanguage()),t.toTimeString().split(" ")[0]].join(" ")}},createAdjustingTimer:l,startInternalTimer:u,stopInternalTimer:function(){d.stop()},subscribeToInternalTimer:function(e){var t=i.getUniqueId();return p.push({uid:t,onTick:e}),t},unsubscribeFromInternalTimer:function(e){p=p.filter(function(t){return t.uid!==e})},getInternalTimerValue:function(){return d.isStarted?new Date(c+1e3*d.getTicks()):(console.warn("Internal timer is not initialized"),null)},initInternalTimer:m,resetInternalTimer:function(){return d.stop(),m()}}}e.$inject=["$q","_","router","utils","$timeout","browserCheck"],angular.module("keenetic").factory("keeneticTime",e)}(),function(){function e(e){var t="((?=.*::)(?!.*::.+::)(::)?([\\dA-F]{1,4}:(:|\\b)|){5}|([\\dA-F]{1,4}:){6})((([\\dA-F]{1,4}((?!\\3)::|:\\b|$))|(?!\\2\\3)){2}|(((2[0-4]|1\\d|[1-9])?\\d|25[0-5])\\.?\\b){4})",n={ipV6:new RegExp("^"+t+"$","i"),ipV6Prefix:new RegExp("^"+t+"(/1[0-1][0-9]$)|(/12[0-7]$)|(/[1-9][0-9]?$)","i")},i=[0,0,0,0,0,0,0,0],a=function(t){var n,a=!1;switch(_typeof(t)){case"number":a=t,n=i.slice();for(var o=0;a>16&&o<8;++o,a-=16)n[o]=65535,o<8&&(n[o]=-1<<16-a&65535);break;case"string":if(-1!==t.indexOf("/")){var s=t.split("/");a=0|s[1],t=s[0]}n=i.slice();for(var r=t.split(":"),l=0,c=r.length;l<c;++l){if(""===r[l]){var d=8;if(r[c-1].indexOf(".")>=0){var p=e.ip2num(r[--c]);n[--d]=65535&p,n[--d]=p>>16&65535}for(;""!==r[--c];)n[--d]=65535&parseInt(r[c],16);break}n[l]=65535&parseInt(r[l],16)}break;case"object":if(angular.isDefined(t.bin)&&angular.isDefined(t.bits)){var u=t.bin;a=t.bits,n=new Array(8);for(var m=0;m<8;++m)n[m]=0|u[m]}else t instanceof Array&&(n=t.slice())}return{bin:n,bits:a}};return{strToIpV6:a,ipV6ToStr:function(e){for(var t=e.bin,n=new Array(8),i=0;void 0!==t[i];++i)n[i]=(65536|t[i]).toString(16).substr(-4);return(n=n.join(":"))+(e.bits?"/"+e.bits:"")},isValidPrefix:function(e){var t,i,o=a(e),s=128,r=o.bin;for(i=8;i>0&&0===r[i-1];--i)s-=16;for(t=r[i-1];!(t%2)&&t;)t=Math.floor(t/2),--s;return n.ipV6Prefix.test(e)&&s<=o.bits},REGEX:n,LINK_LOCAL_PREFIX:"fe80"}}e.$inject=["ipV4Service"],angular.module("keenetic").factory("ipV6Service",e)}(),function(){function e(e){var t=/^(?:(?:\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(?:\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,n=function(e){return[e>>24&255,e>>16&255,e>>8&255,255&e].join(".")},i=function(e){var t=e.split(".");return 1*t[0]*(1<<24)+(t[1]<<16)+(t[2]<<8)+parseInt(t[3],10)},a=function(e){for(var t=[],n=0;n<4;n++){var i=Math.min(e,8);t.push(256-Math.pow(2,8-i)),e-=i}return t.join(".")},o=["10.0.0.0/8","172.16.0.0/12","192.168.0.0/16","100.64.0.0/10"].map(function(e){var t=_slicedToArray(e.split("/"),2),n=t[0],i=t[1];return{address:n,mask:a(Number(i))}});return{PRIVATE_NETS:o,IPV4_REGEX:t,num2ip:n,ip2num:i,ip2binary:function(e){return e.split(".").map(function(e){return("00000000"+parseInt(e,10).toString(2)).slice(-8)}).join(".")},isPrivateIP:function(n){var a=i(n);return t.test(n)&&e.some(o,function(e){var t=i(e.mask),n=i(e.address);return(a&t)==(n&t)})},isIpV4:function(e){return Boolean(t.test(e))},isNet:function(e,t){return 0==(i(e)&~i(t))},isIpInNet:function(e,t,n){var a=i(e),o=i(t),s=i(n);return(a&s)==(o&s)},isValidAddressAndCidr:function(n){var i=_slicedToArray(n.split("/"),2),a=i[0],o=i[1],s=Number(o);return t.test(a)&&o&&e.inRange(s,0,33)},isValidAddressAndPort:function(n){var i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=_slicedToArray(n.split(":"),2),o=a[0],s=a[1],r=Number(s);return t.test(o)&&(!i||s&&e.inRange(r,1,65536))},getMasksArray:function(){for(var e=[],t=-1;536870911&t;t<<=1)e.push(n(t));return e},getMaxAndMinNetworkHostIp:function(t,n){var i=function(t){return e.padStart(Number(t).toString(2),8,"0")},a=function(t){return e.map(t.match(/.{8}/g),function(e){return parseInt(e,2)}).join(".")},o=e.map(t.split("."),i),s=e.map(n.split("."),i).join("").match(/1+/gm)[0].length,r=e.padEnd(o.join("").substring(0,s),32,"0"),l=r.replace(/0$/gm,"1"),c=r.substring(0,s)+e.padStart("0",32-s,"1");return{minNetworkAddress:a(l),maxNetworkAddress:a(c),hostsNumber:Math.pow(2,32-s)-2}},invertMask:function(e){return angular.isNumber(e)&&(e=n(e)),e.split(".").map(function(e){return 255-(e-0)}).join(".")},maskToCidr:function(e){return e.split(".").map(Number).map(function(e){return(e>>>0).toString(2)}).join("").split("1").length-1},cidrToNetmask:a,splitAddressAndCidr:function(n){var i=_slicedToArray(n.split("/"),2),o=i[0],s=i[1],r=Number(s);return!(!t.test(o)||!s||isNaN(r)||!e.inRange(r,0,33))&&{address:o,mask:a(r)}},findConflictingSubnet:function(e,t,n){var a=i(e),o=i(t),s=n.filter(function(e){var t=i(e.ip),n=i(e.mask);return(a&n)==(t&n)||(a&o)==(t&o)});return s.length>0&&s[0]}}}e.$inject=["_"],angular.module("keenetic").factory("ipV4Service",e)}(),function(){function e(e,t,n,i,a,o,s,r,l,c,d,p,u,m){var f=s.PPP_AUTH_ALGORITHM,g=e.chain(f).values(f).filter(function(e){return e!==f.AUTO}).value(),v={no:!0},h="Bridge",b="USB DSL",_=Boolean(a.pingcheck),y={},S=function(t){var n={},i=m.MASTER_IFACE_PREFIX,a=m.AP_IFACE_PREFIX,s=m.WIFI_BAND_2_GHZ,l=m.WIFI_BAND_5_GHZ;return e.forEach(t,function(t,c){if(t.iseg){var d=e.get(t,"iseg.include","").split(",").filter(angular.identity).filter(function(t){var n=t.split("/");return e.startsWith(n[0],i)&&e.startsWith(n[1],a)});n[c]=t,n[c].id=c,n[c].hasWifi=d.length>0,n[c].hasWifi2Ghz=d.filter(function(t){return e.startsWith(t,o.MASTER)}).length>0,n[c].hasWifi5Ghz=d.filter(function(t){return e.startsWith(t,o.MASTER_5G)}).length>0;var p=[];n[c].hasWifi2Ghz&&p.push(s),n[c].hasWifi5Ghz&&p.push(l),n[c].wifiBands=p,n[c].isHomeSegment=t.rename===o.LAN,n[c].name=t.rename||c,n[c].description=r.getInterfaceL10n(t)}}),n},w=function(t){return e.filter(t,"ip.global.enabled").length},C=function(t,n){var i=t.role||[];if(e.isString(i))return e.includes(i,n);for(var a=0;a<i.length;a++)if(i[a]===n||i[a].role===n)return!0;return!1},E=function(e){return-1!==e.indexOf(u.USBDSL_IFACE)},I=function(e){return o.DSL&&-1!==e.indexOf(o.DSL)},T=function(e){return I(e)||E(e)},k=function(e){return-1!==e.indexOf("/Vlan")},P=function(e){return-1!==e.indexOf(m.AP_IFACE_PREFIX)},A=function(e){return" - ".concat(r.getTranslation("dsl.fields.vlan-"+e))},D=function(t,n){return t[n]||e.find(t,function(e){return e.id===n||e["interface-name"]===n})},O=function(e){var t=e.type;switch(t){case"Vlan":t=I(e.id)?"DSL":E(e.id)?"USB DSL":"IPoE";break;case"GigabitEthernet":t="IPoE";break;case"UsbDsl":t=b;break;case"Dsl":t="DSL";break;case"Pvc":t="PVC";break;case"UsbModem":case"UsbLte":case"CdcEthernet":case"YotaOne":case"Yota":t="USB 3G/4G";break;case"L2TP":t+=e["ipsec-enabled"]?"/IPsec":"";break;case"WifiStation":t="WISP"}return t},N=function(t){return e.get(t,"bridge.interface",[])},L=function(t){var n=N(t);return(e.find(n,{inherited:"yes"})||{}).interface},x=function(e){return N(e).map(function(e){return e.interface})},R=function(t,n){return T(t)||T(n.via||"")||e.includes([h,b],O(n))&&e.some(x(n),T)},M=function(t){return e.find([o.DSL,u.USBDSL_IFACE],function(n){return e.startsWith(t,n)})},$={},F=function(){$=m.getAllBandsL10n(!1)};i.$on("$translateChangeSuccess",function(){return n(F)});var V=function(e){return"VLAN ".concat(e.index)},U=function(e){var t=e.opmode||"";return t.toLowerCase()===p.DSL_MODE.AUTO?p.DSL_IN_AUTOMODE_SUFFIX:t},B=function(t){var n=function(e){return e.role||e};return!(!t.role||!e.isArray(t.role)||n(t.role[0])===s.INTERFACE_ROLE.MISC)&&n(t.role[0])},W=function(t,n,i){var a=e.find(n.role,{role:i})||{},o=a.ifor||a.for;return!!o&&D(t,o)},H=function(t,n){var i=t.id,a=t["interface-name"],l=t.priority,c=t.description,d=e.filter(n,function(e){return e.description===c&&e.id!==i}),m=O(t),f="";try{f=function(t,n,i,a){var l=t.id,c=t.description,d=R(l,t),m=n===h;if("WISP"===n){var f="WISP ".concat($[l===o.STA_5G?"5":"2"]),g=c||t.ssid;return g?"".concat(f," (").concat(g,")"):f}var v=r.getInterfaceL10n(t);if(!d&&c&&a.length>0){var b=l.split("/Vlan")[1];v+=" (".concat(n).concat(b?", VLAN "+b:"",")")}if(m&&!d&&C(t,s.INTERFACE_ROLE.INET)&&!c){var _=L(t);_&&(v=r.getInterfaceL10n(e.find(i,{id:_})))}var y,S=!d&&!t.group;if(!c&&S&&e.some([s.INTERFACE_ROLE.IPTV,s.INTERFACE_ROLE.VOIP],function(e){return C(t,e)})){var w,I=e.find([s.INTERFACE_ROLE.IPTV,s.INTERFACE_ROLE.VOIP],function(e){return C(t,e)}),P=W(i,t,I),O=!1;P&&(C(P,I)&&(P=W(i,P,I),O=!0),v=r.getInterfaceL10n(P)),w=O?" - ".concat(r.getTranslation("wired.television2")):A(I),v+=" (".concat(V(t)," ").concat(w,")")}if(d){var N,M=e.includes(s.ISP_PPP_IFACE_TYPES,n),F=l===(N=m&&e.startsWith(l,"Bridge")?L(t):E(M?t.via:l)?u.USBDSL_IFACE:o.DSL),H=D(i,N),q=U(H||{})===p.DSL_IN_AUTOMODE_SUFFIX;if(c||F||!H||(v=r.getInterfaceL10n(H)),"PVC"===n&&(v+=" (".concat("".concat((y=t).type," ").concat(y.vpi,"/").concat(y.vci))),M&&(v+=" (".concat(n)),k(l)&&(v+=" (".concat(V(t)),B(t)||(v+=A(s.INTERFACE_ROLE.INET))),m&&!q){var j=x(t),K=e.filter(j,T),G=n;if(K.length>0){var Y=E(K[0])?u.USBDSL_IFACE:o.DSL,z=D(i,Y);if(!c&&z&&(v=r.getInterfaceL10n(z)),K[0]===Y)G=z?U(z):n;else{var Q=D(i,K[0])||{id:""};-1!==Q.id.indexOf("/Pvc")?(G="",e.forEach(K,function(e){i[e].vpi&&i[e].vci&&(G+=(G?", ":"")+i[e].vpi+"/"+i[e].vci)}),G="Pvc "+G):k(Q.id)&&(G=V(Q))}}v+=" (".concat(G)}F&&(v+=" (".concat(U(t))),m&&q&&(v+=" (".concat(U(H)));var X=B(t);X&&!M&&(v+=A(X)),v+=")"}return v}(t,m,n,d);var g=function(t,n){if(T(t))return I(t)?o.DSL:u.USBDSL_IFACE;var i,a=x(n);return a.length>0&&(i=e.find(a,M)),i||L(n)}(t.id,t)||"";if(T(g)&&(m=g===o.DSL?"DSL":"USB DSL"),!T(g)&&m===h&&C(t,s.INTERFACE_ROLE.INET)){var v=L(t),b=D(n,v);m=v?O(b):m}}catch(e){f=t.description||t["interface-name"]||t.id}return y[i]=f,{id:i,label:f,ifaceDescription:r.getInterfaceL10n(t),type:m,global:t.global,priority:l,name:a}},q=function(t){return F(),e.sortBy(e.map(t,function(e){return H(e,t)}),function(e){return e.label})},j={PHY:"PHY",PPP:"PPP",PINGCHECK:"PINGCHECK",INTERNET_CHECKER:"INTERNET_CHECKER",SCHEDULE:"SCHEDULE",MAIN:"MAIN"},K={ERROR:"red",OK:"green",INFO:"gray"},G={CONNECTED:"connected",WAITING:"waiting",DOWN:"down",NOT_READY:"not_ready",NO_IP:"no_ip",STANDING_BY:"standing_by",NO_SIM:"no_sim",MODEM_DISCONNECTED:"modem_disconnected",DOWN_ON_SCHEDULE:"down-on-schedule",NO_LINK:"no_link",FAIL_IP_CONFLICT:"ip_conflict",FAIL_AUTH:"auth_fail",FAIL_CONNECT:"connect_fail",FAIL_RESOLVE:"fail_resolve",FAIL_PINGCHECK:"fail_pingcheck"},Y="no_ip",z="success",Q="fail",X="ip_conflict",Z={DOWN:"down",CONNECTED:"connected",CONNECTING:"connecting",ERROR:"error",FAIL:"fail",FAIL_IP_CONFLICT:"fail-ip-conflict",FAIL_PHY_CABLE:"fail-phy-cable",FAIL_PINGCHECK:"fail-pingcheck",DOWN_ON_SCHEDULE:"down-on-schedule",NO_INTERNET_ACCESS:"no-internet-access",READY_AS_BACKUP:"ready-as-backup",UNPLUGGED:"unplugged",NOT_CONFIGURED:"not-configured"},J={PASS:"pass",FAIL:"fail",NOT_READY:"not ready"},ee=r.translatePrefixCtor("interface-state"),te=r.translatePrefixCtor("connection-status"),ne=r.translatePrefixCtor("ppp-interface-state"),ie=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"interface-state",n=e.conflict;return r.getTranslation("".concat(t,".ip_conflict"),null,{interface:y[n.interface]||n.interface,subnet:"".concat(n.address,"/").concat(c.maskToCidr(n.mask))})},ae=function(e,t,n){return{name:e,color:t,text:(arguments.length>3&&void 0!==arguments[3]?arguments[3]:"")||ee(e),type:n.type,id:n.id}},oe=function(e){return!e||!e.enabled||e.internet&&e.reliable},se=function(t){return!e.isEmpty(t)&&!d.isActive(t)},re=function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(se(n))return ae(G.DOWN_ON_SCHEDULE,K.INFO,t);if("down"===t.state)return ae(G.DOWN,K.INFO,t);if(t.conflict)return ae(G.FAIL_IP_CONFLICT,K.ERROR,t,ie(t));if("No SIM"===t.lte_state)return ae(G.NO_SIM,K.ERROR,t);if(e.includes(s.USB_MODEM_IFACE_TYPES,t.type)&&"no"===t.plugged)return ae(G.MODEM_DISCONNECTED,K.ERROR,t);var a=t.fail,r=t.address;if(["down","idle","error"].includes(t.link)){if("no"===a)return ae(G.NOT_READY,K.INFO,t);var l=K.ERROR;switch(a){case"auth":return ae(G.FAIL_AUTH,l,t);case"system":case"connect":return ae(G.FAIL_CONNECT,l,t);case"conflict":return ae(G.FAIL_IP_CONFLICT,l,t);case"resolve":return ae(G.FAIL_RESOLVE,l,t);default:return ae(G.NO_LINK,l,t)}}return t.group||o.sysmode!==s.SYSMODE.ROUTER&&t["interface-name"]===o.LAN?ae(G.CONNECTED,K.OK,t):r&&r!==s.ZERO_IP_ADDRESS?t.global&&!t.defaultgw?ae(G.STANDING_BY,K.INFO,t):oe(i)?ae(G.CONNECTED,K.OK,t):ae(Z.NO_INTERNET_ACCESS,K.INFO,t,te(Z.NO_INTERNET_ACCESS)):"conflict"===a?ae(G.FAIL_IP_CONFLICT,K.ERROR,t):ae(G.NO_IP,K.INFO,t)},le=function(e){return e&&("Dsl"===e.type||"UsbDsl"===e.type)},ce=function(t,n,i,a){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return e.extend({connection:{color:n,name:t,text:te(t)},reason:i,main:a,ip:!1,ppp:!1,internet:!1,pingcheck:!1},o)},de=function(t,n){var i=n.show,a=n.config,s=i.main,l=i.ppp,c=i.phy,p=n.schedule,m=t.ppp,f=t.schedule;if(c&&c.id===u.USBDSL_IFACE&&"no"===c.plugged)return ce(Z.UNPLUGGED,K.ERROR,j.PHY,ae(G.NO_LINK,K.ERROR,s));if(!a.main.up||m&&!a.ppp.up)return ce(Z.DOWN,K.INFO,a.main.up?j.PPP:j.MAIN,ae(G.DOWN,K.INFO,s));var g,v,h,b,_=le(c);if(c&&(g=c,v=a.phy,h=g.type,b=Boolean(v.up),"Port"===h?"down"===g.link&&b:le(g)?e.includes(u.DSL_BAD_LINE_STATUSES,g.line)&&b:"WifiMaster"===h&&"off"===g.hwstate&&b)){if(o.HAS_TWO_SWITCHES&&-1!==c.id.indexOf(o.WAN_SWITCH)&&f&&!d.isActive({action:p}))return ce(Z.DOWN_ON_SCHEDULE,K.INFO,j.SCHEDULE,ae(G.DOWN_ON_SCHEDULE,K.INFO,s));var y=_&&Number(e.get(c,"no-carrier",0))>0,S="Port"===c.type||_&&y?Z.FAIL_PHY_CABLE:Z.FAIL;return ce(S,K.ERROR,j.PHY,ae(G.NO_LINK,K.ERROR,s))}if(a.phy&&!a.phy.up)return ce(Z.DOWN,K.INFO,j.PHY,ae(G.DOWN,K.INFO,s));var w,C,E,I,T,k=re(s),P=null,A="";if(l){var D,O,N=l.link,L=l.fail,x=!1;"resolve"===L?L=G.FAIL_RESOLVE:"connect"===L&&(L=G.FAIL_CONNECT),l.conflict&&(L=G.FAIL_IP_CONFLICT,x=ie(l,"ppp-interface-state")),e.includes([G.CONNECTED,G.STANDING_BY],k.name)||k.name===G.NO_IP&&"PPPoE"===l.type?("down"===N&&"no"===L?(D=K.INFO,O="down"===l.state?G.DOWN:G.NOT_READY):(O=L,D=K.ERROR),P="no"===O?{color:D=K.OK,name:O=G.CONNECTED,text:ne(O)}:{color:D,name:O,text:x||ne(O)}):(O="down"===s.link&&s.state===G.DOWN?G.DOWN:G.WAITING,P={color:K.INFO,name:O,text:ne(O)}),C=j.PPP,w=a.ppp.up&&O!==G.DOWN?P.color===K.ERROR?x?Z.FAIL_IP_CONFLICT:Z.ERROR:P.color===K.OK?P.name===G.STANDING_BY?Z.READY_AS_BACKUP:Z.CONNECTED:Z.CONNECTING:Z.DOWN,P.color===K.OK&&(P.address=l.address),A=P.text}else switch(C=j.MAIN,k.name){case G.DOWN:w=Z.DOWN;break;case G.WAITING:case G.NOT_READY:w=Z.CONNECTING;break;case G.FAIL_CONNECT:case G.FAIL_IP_CONFLICT:case G.NO_LINK:case G.NO_IP:w=Z.FAIL;break;case G.STANDING_BY:w=Z.READY_AS_BACKUP;break;default:w=Z.CONNECTED}if(e.get(a,"main.ip.address")?I=s.address:T=Y,T===Y)E=!1;else if(s.conflict){var R=K.ERROR;E={color:R,name:X,text:ie(s,"ip-status")};var M=ie(s);k={color:R,name:G.FAIL_IP_CONFLICT,text:M},w=Z.FAIL_IP_CONFLICT,A=M}else E={color:I?K.OK:K.ERROR,name:I?z:Q,text:I?r.getTranslation("ip-status.success",null,{address:I}):r.getTranslation("ip-status.fail")};var $=!m||Boolean(a.ppp.up),F=Boolean(a.main.up),V=(m&&P?P.name:k.name)===G.DOWN;f&&$&&F&&V&&!d.isActive({action:p})&&(w=Z.DOWN_ON_SCHEDULE,C=j.SCHEDULE,E=!1);var U,B=n.internetStatus,W=e.get(B,"gateway.interface"),H=m||s.id,q=B.internet&&B.reliable||!B.enabled||W!==H,ee=null;if(C!==j.SCHEDULE){if(w!==Z.FAIL&&t.pingcheck){var oe=e.get(n,"pingcheck.status"),se=oe===J.PASS;if(ee={name:oe,color:se?K.OK:K.ERROR,isReady:oe!==J.NOT_READY,text:r.getTranslation("pingcheck-status.".concat(oe))},!se&&ee.isReady){C=j.PINGCHECK,w=Z.FAIL_PINGCHECK,A=r.getTranslation("interface-state.".concat(G.FAIL_PINGCHECK));var de=ae(G.FAIL_PINGCHECK,K.ERROR,{});k=de,P&&(P=de)}}q||w===Z.FAIL||w===Z.FAIL_PINGCHECK||(C=j.INTERNET_CHECKER,w=Z.NO_INTERNET_ACCESS)}return U=w===Z.CONNECTED?K.OK:e.includes([Z.FAIL,Z.FAIL_PINGCHECK,Z.FAIL_IP_CONFLICT],w)?K.ERROR:K.INFO,{reason:C,ip:E,main:k,internetIsOk:q,connection:{name:w,text:te(w),color:U},pingcheck:ee,ppp:P,raw:{show:n.show},reasonText:A}},pe=function(e){return{name:e}},ue=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.main,i=e.ppp||!1,a=e.phy||!1,o=e.alias||!1,s=!!angular.isString(t.schedule)&&t.schedule,r=_&&angular.isString(t.pingcheck)&&t.pingcheck||!1,l=[n],c=[n];i&&(c.push(i),l.push(i)),a&&(c.push(a),l.push(a));var d={show:{interface:l.map(pe),rc:{interface:c.map(pe)},internet:{status:{}}}};return s&&(d.show.schedule=[{name:s}]),r&&(d.show["ping-check"]={profile:r}),{query:d,mainIfaceName:n,phyIfaceName:a,pppIfaceName:i,scheduleName:s,mainIfaceAlias:o,pingcheckProfileName:r}},me=function(t,n){var i=n.mainIfaceName,a=n.phyIfaceName,o=n.pppIfaceName,s=n.scheduleName,r=n.mainIfaceAlias,l=n.pingcheckProfileName,c=e.get(t,"show",{}),d=c.interface,p=e.get(c,"internet.status",{}),u={main:d[0]};o&&(u.ppp=d[1]),a&&(u.phy=o?d[2]:d[1]);var m=e.get(c,"rc.interface",[]).map(function(e){return e.error?{}:e.interface}),f={main:m[0][i]||{}},g=1;o&&(f.ppp=m[1][o]||{},g=2),a&&(f.phy=m[g]&&m[g][a]||{});var v=s?e.get(c,"schedule.0.schedule.".concat(s,".action"),[]):[],h=!1;l&&(h=[o,i,r].reduce(function(t,n){return t||e.get(c,["ping-check","pingcheck",0,"interface",n],!1)},!1));return{names:{main:i,ppp:o,phy:a,schedule:s,pingcheck:l},data:{show:u,config:f,schedule:v,pingcheck:h||{},internetStatus:p}}},fe=function(t){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return e.chain(t).pickBy("ip.address.address").pickBy(function(e){return!n||e.up}).map(function(t,n){return{ip:e.get(t,"ip.address.address"),mask:e.get(t,"ip.address.mask",s.SINGLE_IP_MASK),ifaceId:n,ifaceName:t.rename||n}}).value()},ge=function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return e.chain(t).pickBy("address").pickBy(function(t){return e.get(t,"address")!==s.ZERO_IP_ADDRESS}).map(function(t,n){var i=t.id,a=t["interface-name"];return{ip:e.get(t,"address"),mask:e.get(t,"mask",s.SINGLE_IP_MASK),ifaceId:i,ifaceName:a||n}}).filter(function(e){return e.ifaceId!==n}).value()};return{getIpGlobalQuery:function(t,n){var i=["interface",t,"ip","global"],a=n>-1?{enabled:!0,order:n}:v;return e.set({},i,a)},getInterfaceDescriptionQuery:function(t,n){return e.set({},["interface",t],{description:n})},getInterfaceUpQuery:function(t,n){return e.set({},["interface",t],{up:n})},getAddRoleQuery:function(t,n){return e.set({},["interface",t],{role:n})},getInterfaceScheduleQuery:function(t,n){return e.set({},["interface",t,"schedule"],n||v)},findSegments:S,constants:{PINGCHECK_STATUS:J,INTERFACE_STATE:G,ISP_STATE:Z,STATE_REASON:j,STATE_CATEGORY:K,NO_AUTO_AUTH_ALGORITHMS:g},isDslInterfaceId:T,isAccessPointInterfaceId:P,getSegmentAccessPoints:function(t){return e.get(t,"iseg.include","").split(",").filter(P)},isDslRelated:R,getBridgedIfaces:x,determineIspConnectionState:de,getIspConnectionState:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=ue(e,t),i=n.query,a=n.mainIfaceName,o=n.phyIfaceName,s=n.pppIfaceName,r=n.scheduleName,c=n.mainIfaceAlias,d=n.pingcheckProfileName;return l.post({url:"",silent:Boolean(d),data:i}).then(function(e){var t=me(e,{mainIfaceName:a,phyIfaceName:o,pppIfaceName:s,scheduleName:r,mainIfaceAlias:c,pingcheckProfileName:d}),n=t.names,i=t.data;return de(n,i)})},getIspConnectionStateQueryData:ue,processIspConnectionStateResponse:me,determineInterfaceState:re,getInterfaceConnectionState:function(e){return l.get("show/interface?name=".concat(e)).then(re)},getActiveInternetConnection:function(){return l.get("show/interface").then(function(t){var n=null;return e.forEach(t,function(e){"yes"===e.connected&&"up"===e.state&&e.address&&(!n||n.priority<e.priority)&&(n=e)}),n})},toggleState:function(t,n){var i=(t=angular.isArray(t)?t:[t]).map(function(t){return e.set({},["interface",t,"up"],{no:!n})});return l.postAndSave(i)},getSegments:function(e){return angular.isObject(e)?t.when(S(e)):l.get("interface").then(S)},getGlobalInterfaces:function(t){return e.filter(e.mapValues(t,function(e,t){return e.id=t,e}),"ip.global")},getGlobalInterfacesCount:function(){return l.cached("show.rc.interface").then(w)},countGlobalIfaces:w,updateInterfaceNamesCache:function(){return l.get("show/interface").then(q)},getInterfaceOptions:q,getIfacesTabs:function(e){return q(e).map(function(e){return{id:e.id,name:e.label}})},getInterfaceIdToLabelMap:function(e){return r.getObjectFromArray("id","label",q(e))},getInterfaceIdToDescriptionMap:function(e){return r.getObjectFromArray("id","ifaceDescription",q(e))},getPortIforL10nFunction:function(e){return function(t){return t?r.getTranslation("port-used-by-connection",null,{connection:e[t]||t}):""}},hasRole:C,isValidIspPppId:function(t){return e.some(s.ISP_PPP_IFACE_TYPES,function(n){return e.startsWith(t,n)})},getAuthenticationType:function(t){var n=e.get(t,"authentication",{});return e.chain(f).values().find(function(e){return n[e]}).defaultTo(f.AUTO).value()},getAuthenticationTypeQuery:function(e){return e===f.AUTO?g.reduce(function(e,t){return Object.assign({},e,_defineProperty({},t,v))},{}):_defineProperty({},e,!0)},getShowIfaces:function(e){return l.post({url:"show/interface",data:e.map(function(e){return{name:e}})})},assignPppToIsp:function(e,t){return l.postAndSave({interface:_defineProperty({},e,{connect:{via:t},role:[s.INTERFACE_ROLE.INET]})})},isPublic:function(t){return"public"===t["security-level"]||!0===e.get(t,"security-level.public",!1)},getInterfaceStatusObject:ae,getIpConflictErrorData:function(t){if(!l.containsNdmErrorCode(t,s.NDM_ERROR_CODE.IP_ADDRESS_CONFLICT))return!1;var n=e.chain(t.ndmErrors).filter(function(e){return e.message.includes("conflicts with interface")}).map("message").value();if(0===n.length)return console.warn("interfaces.getIpConflictErrorData: failed to parse IP conflict error message",t.ndmErrors),{interfaceName:"-",conflictingInterfaceName:"-"};var i=(n[0].match(/"[^"]+"/g)||[]).map(function(e){return e.substr(1,e.length-2)});return{interfaceName:e.get(i,"[0]",""),conflictingInterfaceName:e.get(i,"[1]","")}},isInternetAvailable:oe,isScheduleOff:se,getConnectionStateL10n:function(e){return r.getTranslation("connection-status.".concat(e))},getStaticSubnets:fe,getCurrentlyUsedSubnets:ge,getAllUsedSubnets:function(t,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return e.uniqBy([].concat(_toConsumableArray(ge(t)),_toConsumableArray(fe(n))),function(e){return"".concat(e.ifaceId).concat(e.ip)}).filter(function(e){return e.ifaceId!==i})},groupInterfaceIdsByType:function(t){return e.chain(t).groupBy("type").mapValues(function(t){return e.map(t,"id")}).value()}}}e.$inject=["_","$q","$timeout","$rootScope","components","NDM","CONSTANT","utils","router","ipV4Service","schedules","dslConstants","usbdslConsts","wifiOptions"],angular.module("keenetic").factory("interfaces",e)}(),function(){function e(e,t,n,i,a){var o=new(function(){function o(){_classCallCheck(this,o),this.hooks={},this.isInternalHistoryManipulating=!1,this.isStatePopWatcherCreated=!1,this.isTransitionLeaveControlled=!1,this.VIRTUAL_STATE_KEY="__IS_NDM_GO_BACK_HOOK",this.deferredTransitionLocker={}}return _createClass(o,[{key:"controlVirtualHistoryStep",value:function(){t.isEmpty(this.hooks)?this.isOnVirtualState()&&this.goBack():this.isOnVirtualState()||this.pushVirtualHistoryState(),this.controlGoBackWatcher(),this.controlTransitionLeave()}},{key:"controlTransitionLeave",value:function(){var t=this;this.isTransitionLeaveControlled||(this.isTransitionLeaveControlled=!0,a.onBefore({},function(){if(t.isOnVirtualState())return t.goBack(),t.deferredTransitionLocker=e.defer(),t.deferredTransitionLocker.promise}))}},{key:"goBack",value:function(){this.isInternalHistoryManipulating=!0,i.window.history.go(-1)}},{key:"onGoBack",value:function(){if(t.isEmpty(this.hooks))this.controlVirtualHistoryStep();else{var e=Object.keys(this.hooks).pop(),i=this.hooks[e];n(function(){return i()}),this.unregisterHook(e)}}},{key:"pushVirtualHistoryState",value:function(){i.window.history.pushState(_defineProperty({},this.VIRTUAL_STATE_KEY,!0),null,null)}},{key:"isOnVirtualState",value:function(){return Boolean(t.get(i,"window.history.state."+this.VIRTUAL_STATE_KEY,!1))}},{key:"controlGoBackWatcher",value:function(){var e=this;this.isStatePopWatcherCreated||(this.isStatePopWatcherCreated=!0,i.window.addEventListener("popstate",function(n){t.isFunction(e.deferredTransitionLocker.resolve)&&e.deferredTransitionLocker.resolve(!0),e.isInternalHistoryManipulating?e.isInternalHistoryManipulating=!1:n.currentTarget.location.href===i.location.href&&(e.isOnVirtualState()||e.onGoBack())}))}},{key:"registerHook",value:function(e){var t=this.generateUniqueId();this.hooks[t]=e;var n=this.unregisterHook.bind(this);return this.controlVirtualHistoryStep(),function(){return n(t)}}},{key:"unregisterHook",value:function(e){delete this.hooks[e],this.controlVirtualHistoryStep()}},{key:"generateUniqueId",value:function(){return this.lastId=(this.lastId||0)+1,this.lastId.toString()}}]),o}());return{register:o.registerHook.bind(o)}}e.$inject=["$q","_","$timeout","$window","$transitions"],angular.module("keenetic").factory("goBackHook",e)}(),function(){function e(e,t,n,i,a,o){var s=function(e){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"confirm-cancelling-changes";return function(e){for(var t=angular.element((e[0]||e).querySelectorAll("form, [ng-form]")),n=0;n<t.length;n++){var a=t[n];if("none"!==i.getComputedStyle(a).display){var o=angular.element(t[n]).controller("form");if(o&&o.modified&&!o.$submitted)return!0}}return!1}(e)?n.confirm(a,"stay-leave.leave","stay-leave.stay"):t.when(!0)};return{confirmIfNodeHasUnsavedForm:s,watchPageLeave:function(n){var i=a.current.name;return o.onStart({from:i},function(a){return a.to().name!==i&&e.includes(["sref","url"],a.options().source)?s(n).then(function(){return!0},function(){return!1}):t.when(!0)})}}}e.$inject=["_","$q","modal","$window","$state","$transitions"],angular.module("keenetic").factory("formChangesChecker",e)}(),function(){function e(e){return function(t){return e.escapeHtml(t)}}e.$inject=["utils"],angular.module("keenetic").filter("escapeHtml",e)}(),function(){function e(e,t){return{testLearnMore:function(){e.registerFeature("test","test","test",!0,"test",{buttons:[{label:"ndm-feature-notice.btn.learn-more",className:"btn--blue",action:function(){t.showMwsModal()}}]})},testMultiple:function(){e.registerFeature("1","first","text"),e.registerFeature("2","second","5"),e.registerFeature("3","third","test"),e.registerFeature("4","fourth","last")}}}e.$inject=["noticeService","modalFactory"],angular.module("keenetic").factory("e2eTest",e)}(),function(){function e(e,t,n,i,a){var o=i.rciPrefix+"db/dsl-isp.json",s=[],r=function(){return e.isEmpty(s)?n({method:"GET",url:o}).then(function(e){return e.data}).then(function(e){var t=e.defaults,n=e.profiles;return s=n.map(function(e){return Object.assign({},t,{},e)})}):t.when(s)};return{getAll:r,getCountryOptionsList:function(){return r().then(function(t){return e.chain(t).map("country").uniq().map(function(e){return{id:e,label:a.getTranslation("country.".concat(e))}}).sortBy(["label"]).value()})},getCountryIspOptionsList:function(t){return r().then(function(n){return e.chain(n).filter(function(e){return e.country===t}).map(function(e){return{id:e.id,label:e.name}}).sortBy("label").value()})}}}e.$inject=["_","$q","$http","NDM","utils"],angular.module("keenetic").factory("dslIspDb",e)}(),function(){function e(e,t){var n={"DECT service is running":"running","DECT service is disabled":"disabled","DECT service is starting":"starting","DECT service is stopping":"stopping","DECT service is not configured":"not-configured","DECT dongle is not plugged":"unplugged","DECT dongle is rebooting":"rebooting","DECT dongle firmware update in progress":"fw-update"},i=function t(n){return e.mapValues(n,function(e){return angular.isArray(e)&&angular.isString(e[0])&&1===e.length?e[0]:angular.isArray(e)?e.map(t):angular.isObject(e)&&!angular.isArray(e)?t(e):e})};return{convertNvoxFormatToNormal:i,check:function(){var a=arguments.length>0&&void 0!==arguments[0]&&arguments[0],o={show:{nvox:{info:{},handsets:{}}}};return(!(arguments.length>1&&void 0!==arguments[1])||arguments[1])&&e.set(o,"show.nvox.status",{}),a&&e.set(o,"show.nvox.sip-lines",{}),t.post({url:"",data:o}).then(function(t){t=i(t);var a=e.get(t,"show.nvox",{}),o=a.info,s=e.get(a,"handsets.handset",[]);return{plugged:o.plugged,isInRegistration:"active"===o.handset_registration,handsetCount:s.length,paging:o.paging,status:n[e.get(a,"status.state")]||"unknown",lineStatuses:e.get(a,"sip-lines.lines.line",{})}})},DECT_STATUS:n,DECT_STATUS_UNKNOWN:"unknown"}}e.$inject=["_","router"],angular.module("keenetic").factory("dectCheck",e)}(),function(){function e(e){var t={header:null,separator:",",sortByColumnName:!1},n=e.includes(navigator.platform.toLowerCase(),"win")?"\r\n":"\n",i=function(t,i,a){var o='"'.concat(function(t){return e.isString(t)?t.replace(/"/g,'""'):t}(t),'"'),s=i?n:a;return"".concat(o).concat(s)},a=function(t,n,a){var o=e.size(t),s=Object.keys(t);return a&&s.sort(),s.reduce(function(e,a,s){var r=t[a]||(0===t[a]?0:"");return e+i(r,s===o-1,n)},"")};return{CSV_SPECIAL_CHARS:["\t",",",";",".",'"',"'","`","´"," "],DEFAULT_TO_CSV_OPTIONS:t,toCsv:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=Object.assign({},t,{},n),o=i.header,s=i.separator,r=i.sortByColumnName;return(o?a(o,s,r):"")+e.map(function(e){return a(e,s,r)}).join("")}}}e.$inject=["_"],angular.module("keenetic").factory("csv",e)}(),function(){function e(e,t){var n=e.toEn,i=e.fromEn,a=/^[^.,';]+$/gm;return{convert:function(e,o){var s=o.toUpperCase(),r=i[s],l=t.reduce(n,function(n,i){var a=e.toLowerCase().split("");return a.length===t.filter(a,function(e){return i[e]||!isNaN(Number(e))}).length&&n.push(e.toLowerCase().replace(/./g,function(e){return i[e]||e})),n},[]);return l.length?r&&"EN"!==s?t.chain(l).map(function(e){return e.replace(/./g,function(e){return r[e]||e})}).filter(function(e){return a.test(e)}).value():t.filter(l,function(e){return a.test(e)}):null}}}e.$inject=["convertLayoutConstants","_"],angular.module("keenetic").factory("convertLayout",e)}(),function(){function e(e){var t={q:"й",w:"ц",e:"у",r:"к",t:"е",y:"н",u:"г",i:"ш",o:"щ",p:"з","[":"х","{":"Х","]":"ъ","}":"Ъ","|":"/","`":"ё","~":"Ё",a:"ф",s:"ы",d:"в",f:"а",g:"п",h:"р",j:"о",k:"л",l:"д",";":"ж",":":"Ж","'":"э",'"':"Э",z:"я",x:"ч",c:"с",v:"м",b:"и",n:"т",m:"ь",",":"б","<":"Б",".":"ю",">":"Ю","/":".","?":",","@":'"',"#":"№",$:";","^":":","&":"?"," ":" "},n={RU:t,DE:{q:"q",w:"w",e:"e",r:"r",t:"t",y:"z",u:"u",i:"i",o:"o",p:"p","[":"ü","{":"Ü","]":"+","}":"*","`":"<","~":">",a:"a",s:"s",d:"d",f:"f",g:"g",h:"h",j:"j",k:"k",l:"l",";":"ö",":":"Ö","'":"ä",'"':"Ä","\\":"#","|":"'",z:"y",x:"x",c:"c",v:"v",b:"b",n:"n",m:"m","<":";",">":":","/":"-","?":"_","§":"^","±":"°","@":'"',"#":"§","^":"&","&":"/","*":"(","(":")",")":"=","-":"ß",_:"?","=":"´","+":"`"," ":" "},ES:{q:"q",w:"w",e:"e",r:"r",t:"t",y:"y",u:"u",i:"i",o:"o",p:"p","[":"`","{":"^","]":"+","}":"*","\\":"ç","|":"Ç",a:"a",s:"s",d:"d",f:"f",g:"g",h:"h",j:"j",k:"k",l:"l",";":"ñ",":":"Ñ","'":"´",'"':"¨",z:"y",x:"x",c:"c",v:"v",b:"b",n:"n",m:"m",",":",","<":";",".":".",">":":","/":"-","?":"_","!":"!","@":'"',"#":"·",$:"$","%":"%","&":"&","*":"(","(":")",")":"=","-":"'",_:"?","=":"¡","+":"¿"," ":" "},UK:{q:"й",w:"ц",e:"у",r:"к",t:"е",y:"н",u:"г",i:"ш",o:"щ",p:"з","[":"х","{":"Х","]":"ї","}":"Ї","|":"/","`":"ё","~":"Ё",a:"ф",s:"і",d:"в",f:"а",g:"п",h:"р",j:"о",k:"л",l:"д",";":"ж",":":"Ж","'":"є",'"':"Є",z:"я",x:"ч",c:"с",v:"м",b:"и",n:"т",m:"ь",",":"б","<":"Б",".":"ю",">":"Ю","/":".","?":",","@":'"',"#":"№",$:";","^":":","&":"?"," ":" "},TR:{q:"q",w:"w",e:"e",r:"r",t:"t",y:"y",u:"u",i:"ı",o:"o",p:"p","[":"ğ","{":"Ğ","]":"ü","}":"Ü","|":";","`":'"',"~":"é",a:"a",s:"s",d:"d",f:"f",g:"g",h:"h",j:"j",k:"k",l:"l",";":"ş",":":"Ş","'":"i",'"':"İ",z:"z",x:"x",c:"c",v:"v",b:"b",n:"n",m:"m",",":"ö","<":"Ö",".":"ç",">":"Ç","/":".","?":":","@":"","#":"^",$:"+","^":"&","&":"/"," ":" "},FR:{q:"a",w:"z",e:"e",r:"r",t:"t",y:"y",u:"u",i:"i",o:"o",p:"p","[":"^","{":"¨","]":"$","}":"£","|":"µ","`":"²","~":"~",a:"q",s:"s",d:"d",f:"f",g:"g",h:"h",j:"j",k:"k",l:"l",";":"m",":":"M","'":"ù",'"':"%",z:"w",x:"x",c:"c",v:"v",b:"b",n:"n",m:",",",":";","<":".",".":":",">":"/","/":"!","?":"§","@":"2","#":"3",$:"4","^":"6","&":"7"," ":" "},IT:{q:"q",w:"w",e:"e",r:"r",t:"t",y:"y",u:"u",i:"i",o:"o",p:"p","[":"è","{":"é","]":"+","}":"*","|":"§","`":"\\","~":"|",a:"a",s:"s",d:"d",f:"f",g:"g",h:"h",j:"j",k:"k",l:"l",";":"ò",":":"ç","'":"à",'"':"°",z:"z",x:"x",c:"c",v:"v",b:"b",n:"n",m:"m",",":",","<":";",".":".",">":":","/":"-","?":"_","@":'"',"#":"£",$:"$","^":"&","&":"/"," ":" "},PL:{q:"q",w:"w",e:"e",r:"r",t:"t",y:"y",u:"u",i:"i",o:"o",p:"p","[":"[","{":"{","]":"]","}":"}","|":"|","`":"`","~":"~",a:"a",s:"s",d:"d",f:"f",g:"g",h:"h",j:"j",k:"k",l:"l",";":";",":":":","'":"",'"':'"',z:"z",x:"x",c:"c",v:"v",b:"b",n:"n",m:"m",",":",","<":";",".":".",">":">","/":"/","?":"?","@":"@","#":"#",$:"$","^":"^","&":"&"," ":" "},PT:{q:"q",w:"w",e:"e",r:"r",t:"t",y:"y",u:"u",i:"i",o:"o",p:"p","[":"+","{":"*","]":"´","}":"`","|":"^","`":"\\","~":"|",a:"a",s:"s",d:"d",f:"f",g:"g",h:"h",j:"j",k:"k",l:"l",";":"ç",":":"Ç","'":"º",'"':"ª",z:"z",x:"x",c:"c",v:"v",b:"b",n:"n",m:"m",",":",","<":";",".":".",">":":","/":"-","?":"_","@":'"',"#":"#",$:"$","^":"&","&":"/"," ":" "},SV:{q:"q",w:"w",e:"e",r:"r",t:"t",y:"y",u:"u",i:"i",o:"o",p:"p","[":"å","{":"Å","]":"¨","}":"^","|":"*","`":"§","~":"½",a:"a",s:"s",d:"d",f:"f",g:"g",h:"h",j:"j",k:"k",l:"l",";":"ö",":":"Ö","'":"ä",'"':"Ä",z:"z",x:"x",c:"c",v:"v",b:"b",n:"n",m:"m",",":",","<":";",".":".",">":":","/":"-","?":"_","@":'"',"#":"#",$:"¤","^":"&","&":"/"," ":" "},EN:e.mapKeys(t,function(t){return e.set({},t,t)})};return{fromEn:n,toEn:e.mapValues(n,e.invert)}}e.$inject=["_"],angular.module("keenetic").factory("convertLayoutConstants",e)}(),function(){function e(e){return e.CONSTANTS}e.$inject=["$window"],angular.module("keenetic").factory("constants",e)}(),function(){function e(e,t){return e.get(t,"NDM.profile.components",{})}e.$inject=["_","$window"],angular.module("keenetic").factory("components",e)}(),function(){function e(e,t,n){var i=t.navigator.userAgent,a=Boolean(t.opr)&&Boolean(opr.addons)||Boolean(t.opera)||i.indexOf(" OPR/")>=0,o="undefined"!=typeof InstallTrigger,s=/constructor/i.test(t.HTMLElement)||"[object SafariRemoteNotification]"===(!t.safari||"undefined"!=typeof safari&&safari.pushNotification).toString(),r=Boolean(n[0].documentMode),l=!r&&Boolean(t.StyleMedia)&&-1!==i.indexOf("Edge"),c=Boolean(t.chrome)&&!a&&!l,d=(c||a)&&Boolean(t.CSS),p=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(i)||void 0!==t.orientation,u=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1024;return e.get(t,"innerWidth",e.get(t,"screen.width",n))},m=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:768;return e.get(t,"innerHeight",e.get(t,"screen.height",n))};return{isFirefox:o,isChrome:c,isBlink:d,isOpera:a,isSafari:s,isIE:r,isEdge:l,isMobile:p,isPc:!p,isIos:/iPad|iPhone|iPod/i.test(i),isMacOs:e.get(t,"navigator.platform","").toLowerCase().startsWith("mac"),getBrowserWidth:u,getBrowserHeight:m,getWindowRect:function(){return{top:0,bottom:m(0)||e.get(n[0],"documentElement.clientHeight")||e.get(n[0],"body.clientHeight"),left:0,right:u(0)||e.get(n[0],"documentElement.clientWidth")||e.get(n[0],"body.clientWidth")}}}}e.$inject=["_","$window","$document"],angular.module("keenetic").factory("browserCheck",e)}(),function(){function e(e,t,n,i,a,o,s,r){n.setConfig();var l=r.rciPrefix+"auth",c=this;c.token="",c.realm="",c.user="",c.isAuthOK=!1;var d=function(){return a.get("session_id")};return{isLoggedIn:function(){return Boolean(d())&&c.isAuthOK},triedToAuthenticate:function(){return c.triedToAuthenticate},getAuthObj:function(){var n=t.defer();return c.triedToAuthenticate=!0,e.get(l,{timeout:0}).then(function(){c.isAuthOK=!0,n.resolve(!0)},function(e){401===e.status&&(c.token=e.headers("X-NDM-Challenge"),c.realm=e.headers("X-NDM-Realm")),c.isAuthOK=!1,n.resolve(!1)}),n.promise},authenticate:function(a,o){var s=t.defer(),r=n.hash(c.token+i.createHash(a+":"+c.realm+":"+o));return e.post(l,{login:a,password:r},{timeout:15e3}).then(function(e){e.isAuthOK=!0,c.isAuthOK=!0,s.resolve(e)},function(e){e.isAuthOK=!1,c.isAuthOK=!1,s.resolve(e)}),s.promise},logout:function(){var n=t.defer(),i=function(){a.remove("session_id"),c.isAuthOK=!1,o.currentUser=null,n.resolve()};return e.delete(l,{timeout:0}).then(i,i),n.promise},unsetIsAuthOk:function(){c.isAuthOK=!1},getSessionId:d,checkRedirectUrl:function(e,t){var n=d();return i.createHash(String(e)+String(n))===t}}}e.$inject=["$http","$q","$sha","md5","$cookies","$rootScope","$timeout","NDM"],angular.module("keenetic").factory("authenticationService",e)}(),angular.module("keenetic").provider("language",["$windowProvider","localStorageProvider","_",function(e,t,n){var i=e.$get(),a=!1,o=t.$get(),s=["zz"],r=Object.keys(i.NDM.profile.languages),l=function(e){return!0===n.get(i,"NDM.profile.extras.crowdin-editor")&&(i.NDM.profile.languages.zz=!0,"zz"===e)&&(t=i.document.createElement("script"),a||(console.warn("Crowdin-editor inject by language.provider.js"),i._jipt=[["project","newndw"]],i._jipt.push(["escape",function(){o.setItem("language","en"),i.location.reload()}]),t.type="text/javascript",t.src="//cdn.crowdin.com/jipt/jipt.js",i.document.getElementsByTagName("head")[0].appendChild(t),a=!0),!0);var t},c=function(){var e=o.getItem("language")||navigator.language.substr(0,2)||"en";return l(e)?e:(r.indexOf(e)<0&&(e="en"),e)},d=function(){var e=c();return n.includes(s,e)&&(e="en"),e},p=["languageLoader",{}];this.$get=function(){return{getLang:c,loadCrowdinEditorIfInstalled:l,loader:p,getRealLanguage:d}}}]),angular.module("keenetic").config(["$translateProvider","languageProvider",function(e,t){e.usePostCompiling(!0),e.useSanitizeValueStrategy("sceParameters"),e.useLoader.apply(e,_toConsumableArray(t.$get().loader)),e.preferredLanguage(t.$get().getLang()),e.fallbackLanguage("en"),e.useMissingTranslationHandler("collectMissingTranslations")}]).factory("languageLoader",["$http","$q","language",function(e,t,n){return function(i){var a=t.defer();return e({method:"GET",url:"language/locale."+i.key+".json"}).success(function(e){n.loadCrowdinEditorIfInstalled(i.key),a.resolve(e)}).error(function(){a.reject(i.key)}),a.promise}}]).factory("collectMissingTranslations",["env","_","$interval","$window","utils",function(e,t,n,i,a){if(!e.SHOW_TRACE_IN_CONSOLE)return t.noop;var o=new Set;return i.getMissingTranslations=function(){var e=Array.from(o).join("\n"),t=(new Date).toLocaleDateString("en");a.downloadAsFile(e,"".concat(t," Missing translates"))},function(e){var t;(t=e).toLowerCase()===t&&o.add(e)}}]),function(){function e(e){return e.marked?e.marked:{noLoad:!0}}function t(e){return e.SimpleBar?e.SimpleBar:{noLoad:!0}}function n(e){return e.Sortable?e.Sortable:{noLoad:!0}}function i(e){return e.qrcodegen?e.qrcodegen:{noLoad:!0}}function a(e){return e.Selection?e.Selection:{noLoad:!0}}function o(e,t,n,i,a,o,s,r,l,c,d,p,u,m,f,g,v,h,b,_,y,S,w,C,E,I,T,k,P){d.get("$previousState"),i._=t._,i.NDM=t.NDM,i.isBrowserForPC=I.isPc,i.isIE=I.isIE,i.searchDataUpdateRequired=!0,i.menuIsOpen=!1,i.isInitialSetupWizard=!1,i.isLoginPage=!1,t.CONSTANTS=u,t.components=t.NDM.profile.components,m.isTraceEnabled=JSON.parse(P.getItem(u.TRACE_LOCAL_STORAGE_KEY)||"false");var A=u.state,D=A.NOT_SUPPORTED_BROWSER_STATE,O=A.LOGIN_STATE,N=A.QUALITY_CONTROL_STATE,L=A.INITIAL_SETUP_WIZARD_STATE,x=[O];m.sysmode||(m.sysmode=m._sysmode||a.get("sysmode")||u.SYSMODE.ROUTER);var R=function(n,a){v.mws&&!m.DEVICE_IS_MWS_MEMBER&&S.registerMWSFeature();var o=p.get(m,"profile.extras.ndw3")||p.has(t.components,"ndw3");return n&&a.name!==N&&(m.sysmode===u.SYSMODE.ROUTER||o)?(t.location.replace(g.getUrlForInitialSetupWizard()),e.defer().promise):!!i.version||b.cached("show.version").then(function(e){i.version=g.getFirmwareVersionTitle(e)}).then(function(){return!0})},M=function(e){var t=e.to();if(!p.includes([L],t.name))return k.check().then(function(e){return R(e,t)});i.isInitialSetupWizard=!0},$=function(e,n){if(b.reset(),n===O)return!0;var i=[L,O],a=decodeURIComponent(function(){if(!p.includes(i,o.current.name)){var e=t.location.pathname;return e&&"/"!==e?e:""}}());return e.router.stateService.target(O,a?{"#":"goto="+a}:{})};r.onStart({},function(e){var t=e.to();return i.isLoginPage=[O].indexOf(t.name)>=0,E.isLoggedIn()?M(e):function(e){for(var t=0;t<x.length;t++)if(0===e.indexOf(x[t]))return!0;return!1}(t.name)?$(e,t.name):E.getAuthObj().then(function(n){return n?M(e):$(e,t.name)})}),r.onSuccess({},function(e){e.from().name!==e.to().name&&w.updateMenu(),e.from().name===O&&(i.isLoginPage=!1)}),i.$on(u.events.SYSTEM_REBOOT_STARTED,function(){i.deviceIsRebooting=!0}),i.$on(u.events.SYSTEM_REBOOT_FINISHED,function(){i.deviceIsRebooting=!1}),i.$on(b.events.DEVICE_ACQUIRED_BY_MWS,function(){m.DEVICE_IS_MWS_MEMBER=!0}),i.$on(b.events.DEVICE_RELEASED_BY_MWS,function(){m.DEVICE_IS_MWS_MEMBER=!1}),i.$on(b.events.SYSMODE_HEADER_RECEIVED,function(e,t){var n=m._sysmode;if((!n||t&&n!==t)&&(a.put("sysmode",t,{path:"/"}),m._sysmode=t),n&&n!==m.sysmode){var o=m.sysmode;m.sysmode=t,w.updateMenu(),i.$broadcast(u.events.SYSMODE_CHANGED,n,o)}else i.searchDataUpdateRequired&&(f.updateSearchData(s.states),i.searchDataUpdateRequired=!1)}),i.helpCenterLink=g.getHelpCenterLink(),i.$on("$translateChangeSuccess",function(){i.helpCenterLink=g.getHelpCenterLink(),f.updateSearchData(s.states)}),i.$on(u.events.SYSMODE_CHANGED,function(){m.DEVICE_IS_MWS_MEMBER=!1;var e={},t=C().getRoutes();(o.get()||[]).forEach(function(t){e[t.name]=t}),e=p.pickBy(e,function(n,i){return!(i&&!t[i])||(n.isPopup&&e[n.parentState]||s.deregister(i),!1)}),p.forEach(t,function(t,n){n&&!e[n]&&(t.resolve=t.resolve||{},angular.extend(t.resolve,{translateReady:["$translate",function(e){return e.onReady()}]}),t.name=n,s.register(t))}),f.updateSearchData(s.states),i.searchDataUpdateRequired=!1}),i.$on(b.events.DEVICE_IS_OFFLINE,function(){i.deviceIsOffline=!0}),i.$on(b.events.DEVICE_IS_ONLINE,function(){i.deviceIsOffline&&(i.deviceIsOffline=!1,k.check().then(function(e){return R(e,o.current)}))}),r.onSuccess({to:u.state.INITIAL_SETUP_WIZARD_STATE},function(){_.hideAll()}),n.on("click",function(e){for(var t=e.path||[],n=0,i=t.length-1,a=t[n];a&&"A"!==a.tagName&&n<=i;)a=t[++n];a&&a.blur()}),n.on("keydown",function(e){T.isTab(e)&&i.$broadcast(u.events.SELECTBOX_TOGGLE_OPEN,0,0,0)}),s.register({name:"notSupportedBrowser",url:"/not-supported-browser",templateUrl:"app/page/not-supported-browser/not-supported-browser.html",controller:"NotSupportedBrowserController",controllerAs:"vm"}),g.isNdw3Available()&&s.register({name:"NDW3InitialSetupWizard",onEnter:function(){return t.open(g.getUrlForInitialSetupWizard())}}),i.isIE&&(E.isLoggedIn=function(){return!0},M=function(){return!0},r.onBefore({},function(e){var t=e.to().name;return t===L||t===D}),b.redirectError401ToNotSupportedPage(),k.check().then(function(e){o.current.name!==L&&(e?o.go(L):o.go(D))}))}e.$inject=["$window"],n.$inject=["$window"],a.$inject=["$window"],t.$inject=["$window"],i.$inject=["$window"],o.$inject=["$q","$window","$document","$rootScope","$cookies","$state","$stateRegistry","$transitions","$location","$timeout","$injector","_","CONSTANT","NDM","search","utils","components","administrator","router","notification","securityNotification","noticeFactory","menuService","menuSetup","authenticationService","browserCheck","keyboard","redirectChecker","localStorage"],e.$inject=["$window"],t.$inject=["$window"],n.$inject=["$window"],i.$inject=["$window"],a.$inject=["$window"],angular.module("keenetic").constant("_",window._).run(o).factory("qrcodegen",i).factory("SimpleBar",t).factory("Selection",a).factory("Sortable",n).factory("marked",e)}(),function(){function e(e){this.$get=function(){return{addState:function(t,n){e.state(t,n)}}}}function t(e,t,n,i){n.html5Mode(!0),t.otherwise("/dashboard");var a,o=i().getRoutes();for(var s in o)(a=o[s]).resolve=a.resolve||{},angular.extend(a.resolve,{translateReady:["$translate",function(e){return e.onReady()}]}),e=e.state(s,a)}t.$inject=["$stateProvider","$urlRouterProvider","$locationProvider","menuSetup"],e.$inject=["$stateProvider"],angular.module("keenetic").provider("updateStates",e),angular.module("keenetic").config(t)}(),function(){angular.module("keenetic").constant("menuSetup",function(){var e,t=angular.injector(["ng"]),n=t.get("$window"),i=n._,a=t.get("$timeout"),o=t.get("$document"),s=n.NDM,r=function(){return s.sysmode||s._sysmode||(e="sysmode",(t=o[0].cookie.match(new RegExp("(?:^|; )"+e.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,"\\$1")+"=([^;]*)")))?decodeURIComponent(t[1]):void 0)||"router";var e,t},l={login:{url:"/login",templateUrl:"app/page/login/login.html",controller:"LoginController",controllerAs:"Login"},controlPanel:{url:"/controlPanel",templateUrl:"app/page/controlPanel/controlPanel.html",controller:"ControlPanelController",controllerAs:"ControlPanel"},"menu.dashboard":{header:"menu.main",icon:"menu-main"},dashboard:{menuTitle:"menu.dashboard",url:"/dashboard",controller:"DashboardController",controllerAs:"Dashboard",templateUrl:"app/page/dashboard/dashboard.html"},"controlPanel.trafficMonitor":{menuTitle:"menu.traffic-monitor",depends:{modes:"router"},url:"/traffic-monitor/:tab",params:{tab:{value:null,dynamic:!0}},views:{templateUrl:"app/page/controlPanel/controlPanel.html","cp-main":{templateUrl:"app/page/controlPanel/myNetwork/trafficMonitor/trafficMonitor.html",controller:"TrafficMonitorController",controllerAs:"vm"}}},initialSetupWizard:{depends:{components:"easyconfig",modes:"router"},url:"/wizard/initial-setup",controller:"InitialSetupController",controllerAs:"vm",templateUrl:"app/page/wizard/initialSetup/initialSetup.html"},qc:{url:"/qc",controller:"QcController",controllerAs:"vm",templateUrl:"app/page/tools/qc/qc.html"},cli:{url:"/a",cache:!1,controller:"CliController",controllerAs:"vm",templateUrl:"app/page/tools/cli/cli.html"},"menu.special-mode":{header:"menu."+r(),icon:"menu-myInternet",depends:{modes:"repeater,extender,client,ap"}},"controlPanel.wifiClients":{menuTitle:"menu.wifi-clients",depends:{modes:"ap,repeater,extender"},url:"/wifi-clients",views:{templateUrl:"app/page/controlPanel/controlPanel.html","cp-main":{templateUrl:"app/page/controlPanel/myNetwork/wifiClients/wifiClients.html",controller:"WifiClientsController",controllerAs:"vm"}}},"controlPanel.wifiClientInModes":{menuTitle:"menu.connection",depends:{components:"corewireless",modes:"repeater,client,extender",hideForMwsMember:!0},url:"/connection",views:{templateUrl:"app/page/controlPanel/controlPanel.html","cp-main":{templateUrl:"app/page/controlPanel/myInternet/wifiClient/wifiClient.html",controller:"WifiClientController",controllerAs:"WCC"}}},"menu.myInternet":{header:"menu.myInternet",icon:"menu-myInternet",depends:{modes:"router"}},"controlPanel.wired":{menuTitle:"menu.wired",depends:{modes:"router"},url:"/wired/:tab",params:{tab:{value:null,dynamic:!0}},views:{templateUrl:"app/page/controlPanel/controlPanel.html","cp-main":{templateUrl:"app/page/controlPanel/myInternet/wired/wired.html",controller:"WiredController",controllerAs:"vm"}}},"controlPanel.modems":{menuTitle:"menu.modems",depends:{components:"usbmodem|usblte|usbnet|usbqmi",modes:"router"},url:"/modems",views:{templateUrl:"app/page/controlPanel/controlPanel.html","cp-main":{templateUrl:"app/page/controlPanel/myInternet/modems/modems.html",controller:"ModemsController",controllerAs:"vm"}},popups:{airScan:{openFn:"airScanPopup.open",params:["interfaceId"]}}},"controlPanel.usbdsl":{menuTitle:"menu.dsl",depends:{components:"usbdsl",modes:"router"},url:"/usbdsl",views:{templateUrl:"app/page/controlPanel/controlPanel.html","cp-main":{templateUrl:"app/page/controlPanel/myInternet/usbdsl/usbdsls.html",controller:"DslsController",controllerAs:"Dsls"}}},"controlPanel.dsl":{menuTitle:"menu.dsl",depends:{components:s.DSL_ALWAYS_PRESENT?"":"dsl",modes:"router"},url:"/dsl",views:{templateUrl:"app/page/controlPanel/controlPanel.html","cp-main":{templateUrl:"app/page/controlPanel/myInternet/dsl/dsl.html",controller:"DslController",controllerAs:"vm"}}},"controlPanel.wifiClient":{menuTitle:"menu.client-Wi-Fi",depends:{components:"corewireless",modes:"router"},url:"/wifiClient/:tab",params:{tab:{value:null,dynamic:!0}},views:{templateUrl:"app/page/controlPanel/controlPanel.html","cp-main":{templateUrl:"app/page/controlPanel/myInternet/wifiClient/wifiClient.html",controller:"WifiClientController",controllerAs:"WCC"}}},"controlPanel.otherConnections":{menuTitle:"menu.otherConnections",depends:{components:"pptp|l2tp|pppoe|openvpn|sstp|ike-client|ipsec|ip6|wireguard",modes:"router"},url:"/otherConnections",views:{templateUrl:"app/page/controlPanel/controlPanel.html","cp-main":{templateUrl:"app/page/controlPanel/myInternet/otherConnections/otherConnections.html",controller:"OtherConnectionsController",controllerAs:"vm"}}},"controlPanel.policies":{menuTitle:"menu.policies",depends:{modes:"router"},url:"/policies",views:{templateUrl:"app/page/controlPanel/controlPanel.html","cp-main":{templateUrl:"app/page/controlPanel/myInternet/policies/policies.html",controller:"PoliciesController",controllerAs:"vm"}}},"controlPanel.sms":{menuTitle:"menu.sms",depends:{components:"usbqmi",modes:"router"},url:"/sms",views:{templateUrl:"app/page/controlPanel/controlPanel.html","cp-main":{templateUrl:"app/page/controlPanel/myInternet/sms/sms.html",controller:"SmsController",controllerAs:"vm"}}},"controlPanel.ussd":{menuTitle:"menu.ussd",depends:{components:"usbqmi",modes:"router"},url:"/ussd",views:{templateUrl:"app/page/controlPanel/controlPanel.html","cp-main":{templateUrl:"app/page/controlPanel/myInternet/ussd/ussd.html",controller:"UssdController",controllerAs:"vm"}}},"menu.myNetwork":{header:"menu.myNetwork",icon:"menu-myNetwork",depends:{modes:"router"}},"controlPanel.devicesList":{menuTitle:"menu.connected-devices",depends:{modes:"router"},url:"/devicesList",views:{templateUrl:"app/page/controlPanel/devicesList.html","cp-main":{templateUrl:"app/page/controlPanel/myNetwork/devicesList/devicesList.html",controller:"DevicesListController",controllerAs:"DevicesList"}},popups:{offlineRegistration:{openFn:"offlineRegistrationPopup.show"}}},"controlPanel.segments":{menuTitle:"segments.title",depends:{modes:"router,ap,repeater,extender"},url:"/segments/:tab",params:{tab:{value:null,dynamic:!0}},views:{templateUrl:"app/page/controlPanel/controlPanel.html","cp-main":{templateUrl:"app/page/controlPanel/myNetwork/segments/segments.html",controller:"SegmentsController",controllerAs:"segments"}},popups:{WiFi:{openFn:"openWiFiDialog",params:["band"]}}},"controlPanel.wifiSystem":{menuTitle:"menu.wifi-system",depends:{modes:"router",components:"mws"},url:"/wifiSystem",views:{templateUrl:"app/page/controlPanel/controlPanel.html","cp-main":{templateUrl:"app/page/controlPanel/myNetwork/wifiSystem/page.view.html",controller:"MWSController",controllerAs:"vm"}}},"controlPanel.intelliqos":{menuTitle:"menu.intelliqos",depends:{modes:"router",components:"dpi"},url:"/intelliqos",views:{templateUrl:"app/page/controlPanel/controlPanel.html","cp-main":{templateUrl:"app/page/controlPanel/myNetwork/intelliqos/intelliqos.html",controller:"IntelliQosController",controllerAs:"vm"}}},"menu.networkRules":{header:"menu.networkRules",icon:"menu-networkRules"},"controlPanel.netFilter":{menuTitle:"menu.net-filter",depends:{modes:"router"},url:"/secureInternet",views:{templateUrl:"app/page/controlPanel/controlPanel.html","cp-main":{templateUrl:"app/page/controlPanel/networkRules/netFilter/netFilter.html",controller:"NetFilterController",controllerAs:"NFC"}}},"controlPanel.firewall":{menuTitle:"menu.firewall",depends:{modes:"router"},url:"/firewall",views:{templateUrl:"app/page/controlPanel/controlPanel.html","cp-main":{templateUrl:"app/page/controlPanel/networkRules/firewall/firewall.html",controller:"FirewallController",controllerAs:"FW"}}},"controlPanel.portForwarding":{menuTitle:"menu.port-forwarding",depends:{modes:"router"},url:"/portForwarding",views:{templateUrl:"app/page/controlPanel/controlPanel.html","cp-main":{templateUrl:"app/page/controlPanel/networkRules/portForwarding/portForwarding.html",controller:"PortForwardingController",controllerAs:"vm"}}},"controlPanel.staticRoutes":{menuTitle:"menu.static-routes",url:"/staticRoutes",views:{templateUrl:"app/page/controlPanel/controlPanel.html","cp-main":{templateUrl:"app/page/controlPanel/networkRules/staticRoutes/staticRoutes.html",controller:"StaticRoutesController",controllerAs:"SRC"}}},"controlPanel.remoteAccess":{menuTitle:"menu.remote-access",url:"/remoteAccess/:tab",params:{tab:{value:null,dynamic:!0}},depends:{components:"cloudcontrol|ddns"},views:{templateUrl:"app/page/controlPanel/controlPanel.html","cp-main":{templateUrl:"app/page/controlPanel/networkRules/remoteAccess/remoteAccess.html",controller:"RemoteAccessController",controllerAs:"RA"}}},"controlPanel.remoteAccess.keendns":{url:"/remoteAccess/:tab",depends:{components:"cloudcontrol"},params:{tab:{value:"KeenDNS",dynamic:!0}},views:{templateUrl:"app/page/controlPanel/controlPanel.html","cp-main":{templateUrl:"app/page/controlPanel/networkRules/remoteAccess/remoteAccess.html",controller:"RemoteAccessController",controllerAs:"RA"}}},"controlPanel.remoteAccess.ddns":{url:"/remoteAccess/:tab",depends:{components:"ddns"},params:{tab:{value:"DDNS",dynamic:!0}},views:{templateUrl:"app/page/controlPanel/controlPanel.html","cp-main":{templateUrl:"app/page/controlPanel/networkRules/remoteAccess/remoteAccess.html",controller:"RemoteAccessController",controllerAs:"RA"}}},"controlPanel.wirelessAcl":{menuTitle:"menu.wireless-acl",depends:{components:"corewireless",modes:"router,ap,repeater,extender"},url:"/wirelessAcl/:tab",params:{tab:{value:null,dynamic:!0}},views:{templateUrl:"app/page/controlPanel/controlPanel.html","cp-main":{templateUrl:"app/page/controlPanel/networkRules/wirelessAcl/wirelessAcl.html",controller:"WirelessAclController",controllerAs:"vm"}},popups:{offlineRegistration:{openFn:"offlineRegistrationPopup.show"}}},"menu.control":{header:"menu.control",icon:"menu-controlPanel"},"controlPanel.system":{menuTitle:"menu.system",url:"/system",views:{templateUrl:"app/page/controlPanel/controlPanel.html","cp-main":{templateUrl:"app/page/controlPanel/control/system/system.html",controller:"SystemController",controllerAs:"system"}},popups:{components:{openFn:"showComponentsPopup"},mode:{openFn:"showSysModePopup"}}},"controlPanel.apps":{menuTitle:"menu.apps",url:"/apps",views:{templateUrl:"app/page/controlPanel/controlPanel.html","cp-main":{templateUrl:"app/page/controlPanel/apps/apps.html",controller:"AppsController",controllerAs:"AC"}},popups:(e={printer:{openFn:"openPrinterPopup",components:"usb,cifs|tsmb",params:["id"]},storage:{openFn:"openStoragePopup",components:"storage",params:["uuid"]},device:{openFn:"openAllPartitionsPopup",components:"storage",params:{mediaId:"",mediaData:{}}}},_defineProperty(e,"private-cloud",{openFn:"showPopup.private-cloud",components:"ftp|webdav|sftp"}),_defineProperty(e,"torrent",{openFn:"showPopup.torrent",components:"transmission"}),_defineProperty(e,"dlna",{openFn:"showPopup.dlna",components:"dlna"}),_defineProperty(e,"cifs",{openFn:"showPopup.cifs",components:"cifs|tsmb"}),_defineProperty(e,"kabinet",{openFn:"showPopup.kabinet",components:"kabinet"}),_defineProperty(e,"udpxy",{openFn:"showPopup.udpxy",components:"udpxy",modes:"router"}),_defineProperty(e,"afp",{openFn:"showPopup.afp",components:"afp"}),_defineProperty(e,"vpn-server",{openFn:"showPopup.vpn-server",components:"vpnserver",modes:"router"}),_defineProperty(e,"vpn-server-stat",{openFn:"showPopup.vpn-server-stat",components:"vpnserver",modes:"router"}),_defineProperty(e,"vpn-l2tp",{openFn:"showPopup.vpn-l2tp",components:"vpnserver-l2tp,ipsec",modes:"router"}),_defineProperty(e,"vpn-l2tp-stat",{openFn:"showPopup.vpn-l2tp-stat",components:"vpnserver-l2tp,ipsec",modes:"router"}),_defineProperty(e,"virtualIP",{openFn:"showPopup.virtualIP",components:"ipsec",modes:"router"}),_defineProperty(e,"virtualIP-stat",{openFn:"showPopup.virtualIP-stat",components:"ipsec",modes:"router"}),_defineProperty(e,"vpn-sstp",{openFn:"showPopup.vpn-sstp",components:"sstp-server",modes:"router"}),_defineProperty(e,"vpn-sstp-stat",{openFn:"showPopup.vpn-sstp-stat",components:"sstp-server",modes:"router"}),_defineProperty(e,"vpn-ikev2",{openFn:"showPopup.vpn-ikev2",components:"ipsec,cloudcontrol",modes:"router"}),_defineProperty(e,"vpn-ikev2-stat",{openFn:"showPopup.vpn-ikev2-stat",components:"ipsec,cloudcontrol",modes:"router"}),e)},"controlPanel.administrator":{menuTitle:"menu.administrator",url:"/administrator",views:{templateUrl:"app/page/controlPanel/controlPanel.html","cp-main":{templateUrl:"app/page/controlPanel/control/administrator/administrator.html",controller:"AdministratorController",controllerAs:"vm"}}},"controlPanel.diagnostics":{menuTitle:"menu.diagnostics",url:"/diagnostics",views:{templateUrl:"app/page/controlPanel/controlPanel.html","cp-main":{templateUrl:"app/page/controlPanel/control/diagnostics/diagnostics.html",controller:"DiagnosticsController",controllerAs:"diagnostics"}},popups:{log:{openFn:"log.toggleLogPopup"}}},"controlPanel.opkg":{menuTitle:"menu.opkg",url:"/opkg",depends:{components:"opkg"},views:{templateUrl:"app/page/controlPanel/controlPanel.html","cp-main":{templateUrl:"app/page/controlPanel/control/opkg/opkg.html",controller:"OpkgController",controllerAs:"vm"}}},"controlPanel.credits":{url:"/credits",views:{templateUrl:"app/page/controlPanel/controlPanel.html","cp-main":{templateUrl:"app/page/controlPanel/control/credits/credits.html",controller:"CreditsController",controllerAs:"vm"}}},"menu.dect":{header:"menu.dect",icon:"menu-dect",depends:{components:"nvox"}},"controlPanel.dectBase":{menuTitle:"menu.dect-base",url:"/dectBase",depends:{components:"nvox"},views:{templateUrl:"app/page/controlPanel/controlPanel.html","cp-main":{templateUrl:"app/page/controlPanel/telephony/base/base.html",controller:"DectBaseController",controllerAs:"vm"}}},"controlPanel.dectLines":{menuTitle:"menu.dect-lines",url:"/dectLines",depends:{components:"nvox"},views:{templateUrl:"app/page/controlPanel/controlPanel.html","cp-main":{templateUrl:"app/page/controlPanel/telephony/lines/lines.html",controller:"DectLinesController",controllerAs:"DLC"}}},"controlPanel.callHistory":{menuTitle:"menu.call-history",url:"/callHistory",depends:{components:"nvox"},views:{templateUrl:"app/page/controlPanel/controlPanel.html","cp-main":{templateUrl:"app/page/controlPanel/telephony/callHistory/callHistory.html",controller:"CallHistoryController",controllerAs:"vm"}}}},c=function(e,t,n){if(!e.depends)return!0;if(e.depends.hideForMwsMember&&s.DEVICE_IS_MWS_MEMBER)return!1;var i=e.depends.modes?e.depends.modes.split(","):[];if(0!==i.length&&-1===i.indexOf(t))return!1;for(var a=e.depends.components?e.depends.components.split(","):[],o=0,r=a.length;o<r;++o){var l=a[o].split("|");if(!l.some(n))return!1}return!0},d=function(){var e=s.profile.components,t=[];return Object.keys(e).forEach(function(n){e[n]&&t.push(n)}),t};(new(function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"createPopupRoutes",value:function(e){var t=this,n=!1,a=d(),o=function(e){return-1!==a.indexOf(e)},s=r();i.forEach(e,function(a,r){if(c(a,s,o)){var l=i.clone(a.popups||{});delete a.popups,i.forEach(l,function(o,s){var l=i.clone(a);l.depends=i.clone(o.depends),(o.components||o.modes)&&(l.depends=l.depends||{},l.depends.components=i.clone(o.components),l.depends.modes=i.clone(o.modes)),delete l.menuTitle;var c=i.isArray(o.params)?o.params:i.chain(o.params).pickBy(function(e){return i.isString(e)}).keys().value();l.url="/"+s+(i.isEmpty(c)?"":"/:"+c.join("/:")),t.addPopupFunctions(l,o,r+"."+s),l.isPopup=!0,l.parentState=r,l.params=o.params,e[r+"."+s]=l,n=n||!i.isEmpty(n.popups)})}}),n&&this.createPopupRoutes(e)}},{key:"addPopupFunctions",value:function(e,t,n){var o=function(){},s=i.find(e.views,function(e){return e.controllerAs}).controllerAs+"."+t.openFn;e.onEnter=["$state","$rootScope",function(e,t){o=t.$watch("currentScope",function(r){if(r){var l=i.get(r,s,!1);i.isFunction(l)&&(o(),t.ndmRoutedPopupsStack=t.ndmRoutedPopupsStack||{},t.ndmRoutedPopupsStack[n]=e.params,a(function(){return l.call(r,e.params)}))}})}],e.onExit=function(){o()}}}]),e}())).createPopupRoutes(l);var p=function(e){var t=d(),n={},i=function(e){return-1!==t.indexOf(e)},a=r();return Object.keys(e).forEach(function(t){var o=e[t];c(o,a,i)&&(n[t]=angular.copy(o))}),n};return{getRoutes:function(e){var t={};for(var n in l)l[n].url&&(t[n]=l[n],e&&(t[n].sref=n));return p(t)},getMenu:function(){var e,t={};return i.forEach(l,function(e,n){(e.menuTitle||e.header)&&(t[n]=e,t[n].sref=n)}),i.forEach(t,function(n,i){e&&n.header&&delete t[e],e=n.header?i:null}),p(t)},getRoute:function(e,t){l["controlPanel."+e]&&(e="controlPanel."+e);if(t>0){var n=Object.keys(l).indexOf(e);n>=0&&(e=Object.keys(l)[n+t])}return e},isPopupRoute:function(e){return l[e]&&l[e].isPopup}}})}(),function(){var e;angular.module("keenetic").constant("CONSTANT",{RCI_JSON_MAX_SIZE:786432,PPP_AUTH_ALGORITHM:{AUTO:"auto",PAP:"pap",CHAP:"chap",MSCHAP:"mschap",MSCHAP_V2:"mschap-v2"},ZERO_IP_ADDRESS:"0.0.0.0",SINGLE_IP_MASK:"255.255.255.255",DEFAULT_NETMASK:"255.255.255.0",LOCALHOST_IP:"127.0.0.1",UNIT:{HZ:"unit.hz",GHZ:"unit.ghz",MHZ:"unit.mhz",KHZ:"unit.khz",DB:"unit.db",DBM:"unit.dbm",KM:"unit.km",DEG:"unit.degree"},UNIT_SCALE:{NONE:"",KILO:"kilo",MEGA:"mega",GIGA:"giga",TERA:"tera"},ISP_PPP_IFACE_TYPES:["PPPoE","PPTP","L2TP"],OTHER_PPP_IFACE_TYPES:["OpenVPN","SSTP","IKE"],USB_MODEM_IFACE_TYPES:["UsbModem","YotaOne","Yota","UsbLte","CdcEthernet","UsbQmi"],INTERFACE_ROLE:{INET:"inet",IPTV:"iptv",VOIP:"voip",MISC:"misc"},PORT_ROLE:{FREE:"free",VLAN:"vlan",INET:"inet",IPTV:"iptv",VOIP:"voip"},SYSMODE:{ROUTER:"router",AP:"ap",REPEATER:"repeater",EXTENDER:"extender",CLIENT:"client"},PROTOCOLS_WITHOUT_PORTS:["icmp","esp","gre","ip","ipip"],USER_CONNECTION_TYPE:{ETHERNET:"ethernet",WIFI:"wifi",REMOTE:"remote"},DEFAULT_HOME_SEGMENT_ID:"Bridge0",DEFAULT_GUEST_SEGMENT_ID:"Bridge1",HOTSPOT_DETAILS:{NONE:"none",WIRELESS:"wireless",SWITCH:"switch",INTERFACE_DESCRIPTION:"interface-desc"},TRACE_LOCAL_STORAGE_KEY:"_ENABLE_TRACE_",NDM_ERROR_CODE:{NAME_IS_RESERVERD:"1507329",NDSS_NO_INTERNET:"9240615",NDSS_NO_SERVER_ACCESS:"9240579",INVALID_CAPTURE_FILTER_SYNTAX:"32768720",IP_ADDRESS_CONFLICT:"72220686"},events:{LOGOUT:"ndm:user-logout",LOGIN:"ndm:user-login",READONLY_USER_LOGIN:"ndm:current-user-is-readonly",USER_LOGIN_WITHOUT_PASSWORD:"ndm:current-user-has-no-password",SECURITY_NOTIFICATIONS_ENABLED:"ndm:security-notifications-enabled",SECURITY_NOTIFICATIONS_DISABLED:"ndm:security-notifications-disabled",SEGMENT_ADD_AP:"segments:wifi:add-access-point",SEGMENT_REMOVE_AP:"segments:wifi:remove-access-point",SEGMENT_WIFI_SECTION_READY:"segments:wifi:ready",SYSMODE_CHANGED:"sysmode-changed",SYSTEM_REBOOT_STARTED:"system-reboot-started",SYSTEM_REBOOT_FINISHED:"system-reboot-finished",FACTORY_RESET:"ndm:factory-reset",REFRESH_MENU:"refreshMenu",SELECTBOX_TOGGLE_OPEN:"ndm-selectbox-toggle-open",SELECTBOX_TOGGLE_CLOSE:"ndm-selectbox-toggle-close",TAB_CHANGE_STARTED:"ndm-tabs:tab-change-started",TABS_SELECT_TAB:"ndm-tabs:selectTab",TABS_TAB_CHANGED:"ndm-tabs:tab-changed",IFACE_ORDER_VALUE_REPAIR:"ndm-iface-order:repairValue",DASHBOARD_LOADED:"dashboard-loaded",PAGE_REDRAW:"pageRedraw",PAGE_LOADED:"pageLoaded",POPUP_OPENED:"ndm-popup:opened",POPUP_CLOSED:"ndm-popup:closed",POPUP_FOOTER_VISIBLE:"ndm-popup:footer-visible",POPUP_FOOTER_HIDDEN:"ndm-popup:footer-hidden",MENU_TOGGLE:"ndm-menu-toggle",MENU_OPENED:"ndm-menu-open",MENU_OPEN_TRANSITION_END:"ndm-menu-opened",MENU_CLOSED:"ndm-menu-close",MENU_CLOSE_TRANSITION_END:"ndm-menu-closed",SWITCHPORT_CONTAINER_RECALCULATE_OVERFLOW:"ndm-switchport-container-recalculate-overflow",SWITCHPORT_CONTAINER_OVERFLOW_CHANGED:"ndm-switchport-container-overflow-changed",SWITCHPORT_CONTAINER_OVERFLOW_STATE:"ndm-switchport-container-overflow-state"},state:{INITIAL_SETUP_WIZARD_STATE:"initialSetupWizard",LOGIN_STATE:"login",CLI_STATE:"cli",NETFRIEND_REDIRECT_TO_WIZARD_STATE:"netfriend",QUALITY_CONTROL_STATE:"qc",NOT_SUPPORTED_BROWSER_STATE:"notSupportedBrowser"},deviceProtocol:[{name:(e={TCP:"tcp",UDP:"udp",TCP_UDP:"tcpudp",ICMP:"icmp",ESP:"esp",GRE:"gre",IP:"ip",IPIP:"ipip"}).TCP},{name:e.UDP},{name:e.TCP_UDP,label:"TCP/UDP"},{name:e.ICMP},{name:e.ESP},{name:e.GRE},{name:e.IP},{name:e.IPIP},{name:"tcp/20",description:"ftp-data"},{name:"tcp/21",description:"ftp"},{name:"tcp/22",description:"ssh"},{name:"tcp/23",description:"telnet"},{name:"tcp/25",description:"smtp"},{name:"tcp/53",description:"domain"},{name:"udp/53",description:"domain"},{name:"tcp/80",description:"http"},{name:"tcp/110",description:"pop3"},{name:"tcp/123",description:"ntp"},{name:"udp/123",description:"ntp"},{name:"udp/137",description:"netbios-ns"},{name:"udp/138",description:"netbios-dgm"},{name:"tcp/139",description:"netbios-ssn"},{name:"tcp/143",description:"imap"},{name:"tcp/443",description:"https"},{name:"tcp/445",description:"microsoft-ds"},{name:"udp/500",description:"isakmp"},{name:"udp/514",description:"syslog"},{name:"tcp/515",description:"printer"},{name:"tcp/554",description:"rtsp"},{name:"udp/554",description:"rtsp"},{name:"tcp/631",description:"ipp"},{name:"tcp/853",description:"dns-over-tls"},{name:"udp/853",description:"dns-over-tls"},{name:"tcp/993",description:"imaps"},{name:"tcp/995",description:"pop3s"},{name:"udp/995",description:"pop3s"},{name:"tcp/1080",description:"socks"},{name:"udp/1080",description:"socks"},{name:"tcp/1194",description:"openvpn"},{name:"udp/1194",description:"openvpn"},{name:"udp/1701",description:"l2f"},{name:"tcp/1723",description:"pptp"},{name:"tcp/3306",description:"mysql"},{name:"tcp/3389",description:"rdp"},{name:"udp/5060",description:"sip"},{name:"tcp/5222",description:"jabber-client"},{name:"tcp/5432",description:"postgresql"},{name:"tcp/5900",description:"vnc-server"}],TCP_UDP_LABEL:"TCP/UDP",PROTOCOL:e})}(),function(){angular.module("keenetic").factory("env",function(){return{SHOW_TRACE_IN_CONSOLE:!1,SHOW_NO_PASSWORD_NOTICE:!0}})}(),angular.module("keenetic").run(["$templateCache",function(e){e.put("app/components/ndm-alert/ndm-alert.html",'<div class="ndm-alert" ng-class="{ \'ndm-alert--show\': isVisible, \'ndm-alert--no-top-shift\': noTopShift }"><div ng-if="isVisible" ng-click="closeOnClickOutside && hide()" class="ndm-alert__overlay"></div> <div init-scroll="" class="ndm-alert__body"><ndm-single-key-bind ng-if="isVisible && closeOnEsc" key="Escape" call-func="hide()"></ndm-single-key-bind><div class="ndm-alert__close-container not-printable"><a ng-hide="isCloseButtonHidden" ng-keydown="onKeyDown($event)" tabindex="0" ng-click="hide()" class="ndm-alert__close action-link">×</a></div><h3 ng-if="title" class="ndm-alert__body-title body-text not-printable" data-translate="">{{title}}</h3><p ng-if="subTitle" class="ndm-alert__body-subtitle help-text"><span data-translate="">{{subTitle}}</span> <span ng-if="addToSubTitle" data-translate="">{{addToSubTitle}}</span></p><div class="ndm-alert__transclude" ng-transclude=""></div> <button ng-if="!isCloseButtonHidden" class="ndm-alert__hidden_close_focusable_button" ng-click="hide()"></button></div></div>'),e.put("app/components/ndm-button/ndm-button.html",'<button tabindex="{{isDisabled ? \'-1\' : (tabIndex || \'0\')}}" class="btn ndm-button {{btnClass}}" ng-click="!isDisabled && _onClick($event)" ng-disabled="isDisabled" name="{{buttonName}}" type="{{buttonType || \'button\'}}" ng-class="{\'btn--disabled\': isDisabled}"><i ng-if="icon" class="icon icon--{{icon}}"></i> <span data-translate="">{{label}}</span></button>'),e.put("app/components/ndm-button-list/ndm-button-list.html",'<div class="ndm-button-list" ng-cloak=""><div class="btn-list-container {{class}}" ng-if="options.length" ng-class="{\'elements-in-columns\': inColumns}"><div ng-repeat="x in options" class="btn-list-element btn--{{x.id}}" ng-class="getClass(x)" id="{{x.id}}" name="{{x.id}}" add-directive="directive" label="{{x.label || x.id}}" ng-model="x.checked" ng-click="onChangeHandler($event, x)"><div class="btn-list-element__label">{{x.label || x.id}}</div><div ng-if="x.icon" class="btn-list-element__icon icon {{x.icon}}"></div><div ng-if="showStatusIcon" class="btn-list-element__status-icon icon"></div><div ng-if="x.status" class="btn-list-element__status">{{x.status}}</div><div ng-if="x.description" class="btn-list-element__description help-text">{{x.description}}</div></div></div></div>'),e.put("app/components/ndm-button-new/ndm-button-new.html",'<button tabindex="{{ vm.isDisabled ? \'-1\' : \'0\' }}" class="ndm-button-new {{ vm.btnClass }}" ng-disabled="vm.isDisabled" type="button" ng-click="!vm.isDisabled && vm.onClick()">{{ vm.btnText | translate }}</button>'),e.put("app/components/ndm-chart/ndm-chart.html",'<div class="ndm-chart" ng-cloak=""><div ng-if="!!title" class="ndm-chart__title" data-translate="">{{title}}</div> <div class="ndm-chart__image" ng-if="height && width"><div ng-if="!!label" class="ndm-chart__image-text help-text" data-translate="">{{label}}</div> <div class="ndm-chart__image-wrapper"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" class="ndm-chart__image-svg" ng-class="{\'ndm-chart__image-svg--with-axes-titles\': isAxesLabelsVisibleX || isAxesLabelsVisibleY}" ng-attr-height="{{height}}px" ng-attr-width="{{width}}px" ng-attr-view_box="0 0 {{width}} {{height}}" ng-attr-enable_background="new {{width}} {{height}}"><g class="ndm-chart__y-axes-group"><line ng-repeat="line in [].constructor(_axesNumY + 1) track by $index" class="ndm-chart__image-line" ng-attr-x1="{{::!isAxesLabelsVisibleY ? 0 : 5}}" ng-attr-y1="{{::$index * height / _axesNumY}}" ng-attr-x2="{{::width}}" ng-attr-y2="{{::$index * height / _axesNumY}}"></line><text ng-if="isAxesLabelsVisibleY" ng-repeat="line in [].constructor(_axesNumY + 1) track by $index" ng-attr-x="{{::isFirefox ? \'40\' : \'-7\'}}" ng-attr-y="-{{$index * height / _axesNumY}}" text-anchor="end" class="ndm-chart__image-axes-text">{{formatYLabel($index * maxY / _axesNumY)}}</text></g><g class="ndm-chart__x-axes-group"><line ng-if="isAxesLabelsVisibleX" ng-repeat="line in [].constructor(_axesNumX) track by $index" ng-attr-x1="{{($index + 1) * width / _axesNumX + 5}}" ng-attr-y1="3" ng-attr-x2="{{($index + 1) * width / _axesNumX + 5}}" ng-attr-y2="-3" ng-attr-style="stroke:#000; stroke-width: 1;"></line><text ng-if="isAxesLabelsVisibleX" ng-repeat="line in [].constructor(_axesNumX + 1) track by $index" ng-attr-x="{{$index * width / _axesNumX + (!isFirefox ? 5 : -4)}}" ng-attr-y="17" text-anchor="middle" class="ndm-chart__image-axes-text" ng-attr-style="{{\'transform-origin: \' + ($index * width / _axesNumX) + \'px 0\'}}">{{xLabels[$index] || ($index * maxX / _axesNumX)}}</text></g><g class="ndm-chart__chart-group"><polygon ng-if="!smooth" ng-repeat="item in data track by $index" class="ndm-chart__image-polygon ndm-chart__image-polygon--{{item.color}}" stroke-miterlimit="10" ng-attr-points="{{item.points}}"></polygon><path ng-if="smooth" ng-repeat="item in data track by $index" class="ndm-chart__image-path ndm-chart__image-path--{{item.color}}" ng-attr-d="{{item.points}}"></path></g></svg><div ng-if="isLoading" class="ndm-chart__preloader">{{$root.getTranslation(\'loading\')}} <i class="icon icon--load"></i></div></div><svg ng-if="legend && legend.length" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" ng-attr-width="{{width}}px" ng-attr-view_box="0 0 {{width}} {{legend.length ? legend.length * 22 : 0}}" ng-attr-enable_background="new {{width}} {{legend.length * 22}}"><g ng-repeat="legendItem in legend"><rect x="25" ng-attr-y="{{2 + $index * 20}}" width="15" height="15" class="{{\'ndm-chart__legend-rect ndm-chart__image-polygon--\' + legendItem.color}}"></rect><text x="50" ng-attr-y="{{16 + $index * 20}}">{{$root.getTranslation(legendItem.text)}}</text></g></svg><ul class="ndm-chart__image-anchor" ng-if="anchorLeft || anchorRight"><li class="ndm-chart__image-anchor-item" ng-if="anchorLeft" data-translate="">{{anchorLeft}}</li><li class="ndm-chart__image-anchor-item ndm-chart__image-anchor-item--last" ng-if="anchorRight" data-translate="">{{anchorRight}}</li></ul></div></div>'),e.put("app/components/ndm-checkbox/ndm-checkbox.html",'<div class="ndm-checkbox form__row"><div ng-if="title" class="form__cell form__cell--input-label help-text"><span data-translate="">{{title}}</span></div> <div class="form__cell form__cell--checkbox"><div class="checkbox"><input ng-disabled="disabled" tabindex="{{disabled ? -1 : 0}}" class="checkbox__input" type="checkbox" id="{{name}}" name="{{name}}" ng-model="model" ng-value="model" ng-keydown="_onKeydown($event)"> <label class="checkbox__label" for="{{name}}" ng-click="_click($event)"></label></div><div ng-if="hint" class="ndm-checkbox__hint"><ndm-help><div class="baloon__body-title body-text" data-translate="">{{title}}</div><p class="baloon__notification" data-translate="">{{hint}}</p></ndm-help></div></div><div ng-if="description" class="form__cell-note body-text description"><span data-translate="">{{description}}</span></div></div>'),e.put("app/components/ndm-checkbox-list/ndm-checkbox-list.html",'<div class="ndm-checkbox-list form__row" ng-cloak=""><div class="form__cell form__cell--input-label help-text"><span data-translate="">{{title}}</span></div><fieldset class="form__cell form__cell--checkbox" ng-disabled="isDisabled" ng-class="{\'form__cell--checkbox-row\': nobr}"><div class="checkbox-list-item" ng-class="{\'checkbox-list-item--nobr\': nobr}" ng-repeat="x in options track by $index"><input class="checkbox__input checkbox-list-item__input" type="checkbox" id="{{name + x.id}}" name="{{name + x.id}}" ng-model="x.checked" ng-change="modelToArray(); onChange();"> <label class="checkbox__label" for="{{name + x.id}}"></label> <span class="checkbox-list-item__label-text">{{x.label}}</span></div></fieldset></div>'),e.put("app/components/ndm-control-footer/ndm-control-footer.html",'<div class="ndm-control-footer ndm-control-footer--hidden" ng-class="{ \'ndm-control-footer--popup\': isPopup, \'ndm-control-footer--visible\': isVisible }"><div class="ndm-control-footer__controls"><a ng-if="isCancelVisible()" tabindex="{{!swapCtrls ? \'1\' : \'0\'}}" name="{{::((prefix ? prefix + \'-\' : \'\') + \'cancelBtn\')}}" class="ndm-control-footer__controls__cancel" ng-class="{ \'ndm-control-footer__controls__cancel--on-the-right\': !swapCtrls }" ng-click="clickOnCancel()" ng-keydown="onKeydown($event)" data-translate="">{{cancelLabel}}</a><ndm-button ng-if="isSaveVisible()" button-name="{{::((prefix ? prefix + \'-\' : \'\') + \'saveBtn\')}}" btn-class="ndm-control-footer__controls__save btn--primary" class="ndm-control-footer__controls__save-wrapper" is-disabled="drawSaveButtonAsDisabled || deviceIsOffline" on-click="clickOnSave" label="{{saveLabel}}"></ndm-button></div></div>'),e.put("app/components/ndm-copy-to-clipboard/ndm-copy-to-clipboard.html",'<div class="copy-to-clipboard"><div class="copy-to-clipboard__content"><span ng-if="!vm.hideText">{{vm.text | translate}}</span> <div class="copy-to-clipboard__icon__container" ng-class="{ \'copy-to-clipboard__icon__container--no-text\': vm.hideText }" title="{{vm.isCopied ? \'otherConnections.wireguard.editor.msg.public-key-copied\' : \'copy-to-clipboard\' | translate}}"><div class="copy-to-clipboard__icon__wrapper" ng-click="vm.copyToClipboard()"><div class="copy-to-clipboard__icon" ng-class="{ \'copy-to-clipboard__icon--copied\': vm.isCopied }"></div></div></div></div></div>'),e.put("app/components/ndm-dect-checker/ndm-dect-checker.html",'<div ndm-polling="$ctrl.polling" ndm-interval="$ctrl.interval"></div>'),e.put("app/components/ndm-dect-preloader/ndm-dect-preloader.html",'<div class="ndm-dect-preloader"><div class="circ1"></div> <div class="circ2"></div> <div class="circ3"></div></div>'),e.put("app/components/ndm-details/ndm-details.html",'<div class="ndm-details form {{$ctrl.className}}" ng-class="{\'ndm-details--hidden\': !$ctrl.toggleVar && !$ctrl.showLink}"><div ng-if="$ctrl.showLink" class="form__row"><a tabindex="0" ng-keydown="$ctrl.onKeydown($event)" ng-click="!$ctrl.disabled && $ctrl.toggleFn()" class="accordion-link ndm-details__toggle-label {{$ctrl.linkClass}}" ng-class="{ \'accordion-link--disabled\': $ctrl.disabled, \'accordion-link--expanded\': $ctrl.toggleVar }"><span ng-if="!$ctrl.toggleVar" ng-bind="$ctrl.labelFn(false)"></span> <span ng-if="$ctrl.toggleVar" ng-bind="$ctrl.labelFn(true)"></span></a></div><div ng-if="$ctrl.description"><span class="help-text" data-translate="">{{::$ctrl.description}}</span></div> <div ng-show="$ctrl.toggleVar" class="{{::$ctrl.transcludeClass}}" ng-transclude=""></div></div>'),e.put("app/components/ndm-device-poller/ndm-device-poller.html",'<div ndm-polling="$ctrl.polling" ndm-interval="$ctrl.interval"></div>'),e.put("app/components/ndm-device-wifi-acl/ndm-device-wifi-acl.html",'<div class="ndm-device-wifi-acl form"><div class="ndm-device-wifi-acl__header tretiary-title">{{$ctrl.l10n.header | translate}} <ndm-help webhelp-id="global.wifiAcl"></ndm-help></div> <div ng-if="$ctrl.noAcls" ndm-html-compile="$ctrl.l10n.noAclsConfigured"></div> <div ng-if="!$ctrl.noAcls" class="form--sub"><div ng-if="$ctrl.permissions" ng-repeat="segmentId in $ctrl.segmentIds" class="ndm-device-wifi-acl__acl-row"><ndm-radio name="{{$ctrl.name}}_{{$ctrl.mac}}_{{segmentId}}_" disabled="!$ctrl.permissions[segmentId]" label="{{$ctrl.segmentsData[segmentId].description || segmentId}}" model="$ctrl.permissions[segmentId]" array="$ctrl.options"><div class="help-text" ndm-html-compile="!$ctrl.permissions[segmentId] ? $ctrl.l10n.getDescription($ctrl.segmentsData[segmentId].description || segmentId) : \'\'"></div></ndm-radio></div></div></div>'),e.put("app/components/ndm-device-wifi-band/ndm-device-wifi-band.html",'<div class="ndm-device-wifi-band form"><div class="ndm-device-wifi-acl__header tretiary-title">{{vm.l10n.header | translate}} <ndm-help webhelp-id="global.wifiBandRestriction"></ndm-help></div> <div class="form--sub" ng-cloak="" ng-show="vm.isInitialized"><div ng-if="vm.restrictions" ng-repeat="segment in vm.restrictions"><ndm-radio ng-if="segment.hasBothBands" name="{{vm.name}}__{{vm.mac}}__{{segment.id}}_" label="{{segment.description || segment.id}}" model="segment.deviceBandRestriction" array="vm.options"></ndm-radio><div ng-if="!segment.hasBothBands" class="ndm-device-wifi-band__incomplete-segment"><span class="form__cell form__cell--input-label help-text">{{ segment.description }}</span> <span class="help-text" ndm-html-compile="vm.l10n.getSegmentNotice(segment)"></span></div></div></div></div>'),e.put("app/components/ndm-dpn/dpn.modal.html",'<div class="dpn-modal" ng-class="{ \'dpn-modal--preview\': vm.previewMode }"><div class="dpn-modal__overlap"></div><ndm-key-press ng-if="vm.previewMode" action-on="[\'escape\']" call-func="[vm.close]"></ndm-key-press><div class="dpn-modal__container"><div class="dpn-modal__main"><div class="dpn-modal__header"><div class="dpn-modal__header-top-row"><div class="dpn-modal__header-h" data-translate="">dpn.title</div><ndm-toggle label-on="dpn.full-text" label-off="dpn.short-text" class="dpn-modal__text-toggle" name="isFullDpnTextVisible" model="vm.isFullTextVisible" call-on-change="vm.switchText"></ndm-toggle></div> <div data-translate="">dpn.description</div></div> <div ng-if="!vm.loading" class="dpn-modal__agreement" ndm-html-compile="vm.dpnHtml" init-scroll=""></div> <div ng-if="vm.loading" class="dpn-modal__agreement-loading"><span class="icon icon--load"></span> {{\'loading\' | translate}}</div></div> <div class="dpn-modal__panel"><ndm-button ng-if="vm.allowCancelling" is-disabled="vm.loading || vm.saving" class="dpn-modal__cancel-btn" btn-class="dpn-modal__panel-button {{vm.saving ? \'btn--loading\' : \'\'}}" on-click="vm.cancel" label="cancel"></ndm-button><ndm-button is-disabled="vm.loading || vm.saving" btn-class="dpn-modal__panel-button btn--primary {{vm.saving ? \'btn--loading\' : \'\'}}" on-click="vm.agree" label="{{vm.saving ? \'\' : vm.saveBtnLabel}}"></ndm-button></div></div></div>'),e.put("app/components/ndm-dsl-isp-select/ndm-dsl-isp-select.html",'<div bs-modifiable="0" class="ndm-dsl-isp-select"><ndm-selectbox-filter class="ndm-dsl-isp-select__country" label="{{\'ndm-dsl-isp-select.country\'}}" options="vm.countries" value="vm.country" name="country" on-change="vm.onCountrySelected" is-disabled="vm.disabled || vm.isLoading || vm.isLocked"></ndm-selectbox-filter><ndm-selectbox-filter class="ndm-dsl-isp-select__isp" label="ndm-dsl-isp-select.provider" name="ispId" options="vm.ispList" value="vm.ispId" is-required="true" on-change="vm.onIspSelected" is-disabled="!vm.country || vm.disabled || vm.isLoading || vm.isLocked"></ndm-selectbox-filter><fieldset ng-if="vm.showAuth" class="ndm-dsl-isp-select-auth-block" ng-disabled="vm.isLocked"><ndm-input label="ndm-dsl-isp-select.login" name="login" disable-autocomplete="true" set-focus="true" validation="required,ascii,length[1..64]" model="vm.ispData.login"></ndm-input><ndm-input label="ndm-dsl-isp-select.password" name="password" password="true" validation="ascii,length[..64]" model="vm.ispData.password"></ndm-input></fieldset></div>'),e.put("app/components/ndm-edit-in-place/ndm-edit-in-place.html",'<div class="ndm-edit-in-place {{className}}" ng-class="{ \'ndm-edit-in-place--with-subtext\': subtext, \'ndm-edit-in-place--form\': editorIsVisible }"><div ng-if="label || icon" class="ndm-edit-in-place__label"><span ng-if="icon" class="icon-container {{icon}}-container"><i class="icon {{icon}}"></i></span> <span ng-if="label" data-translate="">{{label}}</span></div> <div class="ndm-edit-in-place__content"><div class="ndm-edit-in-place__placeholder" ng-class="{ \'ndm-edit-in-place__placeholder--locked\': isLocked }" ng-click="onPlaceholderClick($event)" ng-show="!editorIsVisible"><a tabindex="{{isLocked ? \'-1\' : \'0\'}}" ng-keydown="onKeydown($event)" class="ndm-edit-in-place__data" title="{{model || placeholder}}" ng-class="{\'ndm-edit-in-place__data--placeholder\': !model && placeholder}">{{model || placeholder}}</a> <i ng-show="!editorIsVisible" class="ndm-edit-in-place__edit-icon icon icon--pencil" ng-click="showEditor()"></i></div> <div ng-if="!editorIsVisible && subtext" class="ndm-edit-in-place__subtext">{{subtext}}</div><ndm-input no-ndm-common-validator="true" bs-modifiable="false" label="" placeholder="{{placeholder}}" name="name" class="ndm-edit-in-place__input {{::userAgentIsFf ? \'ndm-edit-in-place__input--ff\': \'\'}}" ng-disabled="editorIsLocked" ng-show="editorIsVisible" validation-data="validationData" validation="{{validation}}" model="model"><div class="ndm-edit-in-place__editor-controls"><div ng-disabled="ngModel.$invalid" ng-click="acceptChanges()" ng-class="{\'ndm-edit-in-place__icon-as-btn--disabled\': ngModel.$invalid}" class="ndm-edit-in-place__icon-as-btn"><i class="icon icon--check-green"></i></div> <div ng-click="cancelChanges()" class="ndm-edit-in-place__icon-as-btn"><i class="icon icon--cancel"></i></div></div></ndm-input></div></div>'),e.put("app/components/ndm-eula/eula.modal.html",'<div class="eula-modal" ng-class="{ \'eula-modal--preview\': vm.previewMode }"><div class="eula-modal__overlap"></div><ndm-key-press ng-if="vm.previewMode" action-on="[\'escape\']" call-func="[vm.close]"></ndm-key-press><div class="eula-modal__container"><div class="eula-modal__main"><div class="eula-modal__header"><div class="eula-modal__header-h" data-translate="">eula.header</div> <div data-translate="">eula.description</div></div> <div ng-if="!vm.loading" class="eula-modal__agreement" ndm-html-compile="vm.eulaHtml" init-scroll=""></div> <div ng-if="vm.loading" class="eula-modal__agreement-loading"><span class="icon icon--load"></span> {{\'loading\' | translate}}</div></div> <div class="eula-modal__panel"><ndm-button ng-if="vm.allowCancelling" is-disabled="vm.loading || vm.saving" class="eula-modal__cancel-btn" btn-class="eula-modal__panel-button {{vm.saving ? \'btn--loading\' : \'\'}}" on-click="vm.cancel" label="cancel"></ndm-button><ndm-button is-disabled="vm.loading || vm.saving" btn-class="eula-modal__panel-button btn--primary {{vm.saving ? \'btn--loading\' : \'\'}}" on-click="vm.agree" label="{{vm.saving ? \'\' : vm.saveBtnLabel}}"></ndm-button></div></div></div>'),e.put("app/components/ndm-feature-notice/ndm-feature-notice.html",'<div class="ndm-feature-notice-container" ng-class="{ \'ndm-feature-notice-container--one-more-features\': $ctrl.features.length > 1, \'ndm-feature-notice-container--multiple-features\': $ctrl.features.length > 2 }"><div class="ndm-feature-notice-container__content"><a ng-if="$ctrl.features.length > 1 && !$ctrl.isMobile" href="" title="ndm-feature-notice.title.show-next-feature-title" class="ndm-feature-notice-container__show-next" ng-click="$ctrl.showNextFeature()"><i class="icon icon--arrow-forward"></i></a> <div ng-repeat="feature in $ctrl.features track by $index" ng-show="$ctrl.activeFeatureIndex === $index" class="feature" ng-class="{ \'feature--inactive\': $ctrl.activeFeatureIndex !== $index }"><div class="feature__icon"><i class="icon icon--feature-notice"></i></div> <div class="feature__title"><span ng-if="feature.titleChunks" ng-repeat="chunk in feature.titleChunks track by $index" class="feature__title-line">{{chunk | trust}}{{$index !== feature.titleChunks.length - 1 ? \'&nbsp;\' : \'\'}}</span> <span ng-if="!feature.titleChunks">{{feature.title | translate}}</span></div> <div class="feature__description" data-translate="">{{feature.description}}</div> <div class="feature__actions" ng-class="{ \'feature__actions--single-button\': feature.buttons.length === 1 }"><ndm-button class="feature__btn" ng-repeat="button in feature.buttons track by $index" btn-class="btn--base {{button.className}}" label="{{button.label}}" ng-click="$ctrl.onFeatureBtnClick(feature, $index)"></ndm-button><a ng-if="$ctrl.features.length > 1 && $ctrl.isMobile" href="" title="ndm-feature-notice.title.show-next-feature-title" class="ndm-feature-notice-container__show-next--mobile" ng-click="$ctrl.showNextFeature()" data-translate="">ndm-feature-notice.link.show-next-feature-mobile</a></div><ndm-link ng-if="!$ctrl.isMobile" class="feature__skip-link" on-click="$ctrl.skipFeature(feature)" label="ndm-feature-notice.link.skip-feature"></ndm-link><ndm-link ng-if="$ctrl.isMobile" class="feature__skip-link--mobile" on-click="$ctrl.skipFeature(feature)"><i class="feature__skip-icon"></i></ndm-link></div></div></div>'),e.put("app/components/ndm-fieldset/ndm-fieldset.html",'<fieldset class="ndm-fieldset {{className}}" ng-class="{ \'ndm-fieldset--disabled\': isDisabled }" ng-disabled="isDisabled" ng-transclude=""></fieldset>'),e.put("app/components/ndm-form-header/ndm-form-header.html",'<div class="ndm-form-header"><hr ng-if="hr" class="{{hr}}"><div ng-if="title" class="ndm-form-header__content"><h2 class="tretiary-title" data-translate="">{{title}}</h2><div class="transcluded-content" ng-transclude=""></div></div><p ng-if="subTitle" class="body-text cp-main__comment" data-translate="">{{subTitle}}</p></div>'),e.put("app/components/ndm-form-title/ndm-form-title.html",'<div class="ndm-form-title form__row"><div class="ndm-form-title__label form__cell form__cell--input-label" data-translate="">{{title}}</div> <div class="form__cell"><div class="ndm-form-title__text cell__top" data-translate="">{{text}}</div></div> <div class="ndm-form-title__transclude" ng-transclude=""></div></div>'),e.put("app/components/ndm-header/ndm-header.html",'<div class="d-header" ng-class="{ \'d-header--mws-member\': $root.NDM.DEVICE_IS_MWS_MEMBER }"><div ng-class="{ \'d-header__lodge-bar--offset-by-menu\': !$root.menuIsOpenOverlayed && $root.menuIsOpen, \'d-header__lodge-bar--menu-opened\': $root.menuIsOpen }" class="d-header__lodge-bar"><div class="d-header__lodge-bar__left_column"><a tabindex="0" id="ndm_menu_toggle_mobile" ng-class="{\'d-header__lodge-bar__left_column__icon-menu--menu-opened\': $root.menuIsOpen}" class="d-header__lodge-bar__left_column__icon-menu" ng-click="header.menuToggle()"></a> <div class="d-header__wrapper"><a ng-class="{ \'d-header__lodge-bar__left_column__link--disabled\': $root.deviceIsRebooting }" data-ui-sref="dashboard" data-ui-sref-opts="{reload: true}" class="d-header__lodge-bar__left_column__link logo-link">KEENETIC</a> <span class="header-model"><span class="header-model__text" ng-attr-title="{{::header.deviceModel}}">{{::header.deviceModelForLogo}}</span></span></div></div><div ng-if="!$root.isAlertFullScreen" ng-hide="$root.menuIsOpenOverlayed && $root.menuIsOpen" class="d-header__search"><form class="search__form" ng-class="{ \'search__form--over-all\': header.searchResultsAreVisible }" onsubmit="return false;"><div class="search__form-field" ng-class="{ \'search__form-field--focused\': header.searchResultsAreVisible || header.searchInputIsInFocus }"><input ng-attr-placeholder="{{header.l10n.searchInputPlaceholder}}" type="search" class="search__input field" ng-class="{ \'search__input--ie\': header.isIE, \'search__input--active\': header.searchResultsAreVisible }" ng-model="header.searchString" ng-model-options="{debounce: 300}" maxlength="50" autocomplete="off" autocorrect="off" autocapitalize="off" ng-focus="header.onSearchInputFocus()" ng-blur="header.onSearchInputBlur()" ng-keydown="header.onSearchInputKeyDown($event)"> <button ng-if="header.searchString" tabindex="-1" type="button" ng-click="header.clearSearchString()" class="search__reset"><i class="icon icon--cancel"></i></button> <button tabindex="-1" type="submit" id="search-icon-btn" class="search__submit"><i class="icon icon--search-blue"></i></button></div> <div ng-show="header.searchString.length >= 2 && header.searchResultsAreVisible" class="search__results" ng-class="{ \'search__results--search-in-progress\': header.searchIsInProgress }"><div class="search__matches" ng-class="{ \'search__matches--no-match\': !header.internalSearchMatched && !header.kbMatched, \'search__matches--with-footer\': header.internalSearchMatched && header.kbMatched, \'search__matches--kb-only\': !header.internalSearchMatched && header.kbMatched, \'search__matches--internal-only\': header.internalSearchMatched && !header.kbMatched && !header.searchIsInProgress }"><div ng-if="header.internalSearchResults.length > 0" class="search__internal-matches"><div class="search__section-header" data-translate="">menu.search.internal-matches</div><ul ng-show="header.internalSearchResults.length" class="search__suggest search__suggest-internal-matches"><li class="search__suggest-item" ng-class="{ \'search__suggest-item--focused\': $index === header.searchRsltInFocusIdx && !header.focusIsOnKbResults }" ng-repeat="item in header.internalSearchResults track by $index" ng-mouseover="header.onSearchResultHover($index, false, $event, item)"><a tabindex="0" ng-click="header.onSearchResultClick($event, item)"><div class="search__suggest-item-label" ng-bind-html="item.text"></div></a></li></ul></div> <div ng-if="header.kbSearchResults.length > 0 || header.searchIsInProgress" class="search__knowledge-base-matches" ng-class="{ \'search__knowledge-base-matches--in-progress\': header.searchIsInProgress }"><div class="search__section-header" data-translate="">menu.search.knowledge-base-matches</div> <div ng-if="header.searchIsInProgress" class="search__knowledge-base-matches-placeholder"></div><ul ng-hide="header.searchIsInProgress" class="search__suggest search__suggest-knowledge-base-matches"><li class="search__suggest-item" ng-class="{ \'search__suggest-item--focused\': $index === header.searchRsltInFocusIdx && header.focusIsOnKbResults }" ng-repeat="item in header.kbSearchResults track by $index" ng-mouseover="header.onSearchResultHover($index, true, $event, item)"><a tabindex="0" class="knowledge-base-link" target="_blank" ng-attr-title="{{item.matchedVal}}" ng-attr-href="{{item.url}}"><span class="knowledge-base-link__text" ndm-html-compile="item.text"></span></a></li></ul></div></div> <div ng-if="!header.searchIsInProgress && !header.internalSearchMatched && !header.kbMatched" class="search__no-matches"><div class="no-matches__header"><i class="icon icon--warning"></i> <span class="no-matches__header-text" data-translate="">menu.search.no-match.title</span></div> <div class="no-matches__text">{{header.l10n.noMatch}}</div></div> <div ng-if="!header.searchIsInProgress && header.kbMatched" class="search__knowledge-base-footer"><a class="knowledge-base-footer__icon-link" target="_blank" href="{{header.kbUrl}}"><i class="icon icon--help-active"></i></a> <span class="knowledge-base-footer__text" data-translate="">menu.search.all-knowledge-base-results.text</span> <a class="knowledge-base-footer__link" target="_blank" href="{{header.kbUrl}}" data-translate="">menu.search.all-knowledge-base-results.link</a></div></div></form><div ng-if="header.searchResultsAreVisible" class="search__overlay" ng-click="header.closeSearchResults($event)"></div></div></div> <div ng-if="$root.NDM.DEVICE_IS_MWS_MEMBER" class="d-header__mws-member-header"><div ndm-polling="header.getControllerAddress"></div> <span ndm-html-compile="header.l10n.controllerLink"></span></div></div>'),e.put("app/components/ndm-help/ndm-help.html",'<span class="ndm-help" ng-mouseleave="vm.tooltipCtrl.close()"><div ng-if="vm.isVisible" class="ndm-help-tooltip__container" ng-cloak="" init-scroll=""><a class="ndm-help-tooltip__close-button popup-close-button" tabindex="0" ng-click="vm.tooltipCtrl.close()">×</a><div ng-if="vm.webhelpId || vm.header" class="ndm-help-tooltip__header"><div><div class="ndm-help-tooltip__icon"></div></div> <div class="ndm-help-tooltip__header-text"><div class="ndm-help-tooltip__title" data-translate="">{{vm.header || \'webhelp-ui-notes.help-dialog-title\'}}</div><a ng-click="vm.tooltipCtrl.close()" ng-if="vm.webhelpId" ng-href="{{$root.helpCenterLink}}" target="_blank" class="ndm-help-tooltip__more external-link" data-translate="">webhelp-ui-notes.help-more-articles</a></div></div> <div class="ndm-help-tooltip__text" ng-transclude=""></div> <div class="ndm-help-tooltip__error" ng-if="vm.webhelpId && !vm.isLoading && vm.noArticles">{{vm.isError ? \'webhelp-ui-notes.error-no-internet\' : \'webhelp-ui-notes.notes-not-found\' | translate}}</div> <div class="ndm-help-tooltip__loading" ng-if="vm.isLoading && vm.isLongLoading"></div> <div ng-if="!vm.isLoading && vm.articles.length" class="ndm-help-tooltip__list"><a ng-click="vm.tooltipCtrl.close()" ng-repeat="article in vm.articles" class="ndm-help-tooltip__list-item external-link" target="_blank" href="{{article.href}}">{{article.title}}</a></div><hr ng-if="vm.articles.length && vm.fallbackArticles.length" class="hr-light-blue"><div ng-if="!vm.isLoading && vm.fallbackArticles.length" class="ndm-help-tooltip__list"><a ng-click="vm.tooltipCtrl.close()" ng-repeat="article in vm.fallbackArticles" class="ndm-help-tooltip__list-item external-link" target="_blank" href="{{article.href}}">{{article.title}}</a></div></div> <span ng-click="vm.tooltipCtrl.open();$event.stopPropagation();" class="ndm-help__button" ng-class="{ \'ndm-help__button-standard\': !vm.icon, [\'icon--\' + vm.icon]: vm.icon }"></span><ndm-key-press ng-if="vm.isVisible" action-on="[\'escape\']" call-func="[vm.tooltipCtrl.close]"></ndm-key-press></span>'),e.put("app/components/ndm-icon/ndm-icon.html",'<div class="ndm-icon"><i class="{{className}} icon" ng-class="classObj"></i></div>'),e.put("app/components/ndm-iface-dot1x/ndm-iface-dot1x.html",'<div class="ndm-iface-dot1x"><ndm-form-header hr="hr-light-blue" label="ndm-iface-dot1x.title"></ndm-form-header><ndm-selectbox disabled="vm.isDisabled" label="ndm-iface-dot1x.method" name="{{::namePrefix}}dot1xMethod" options="vm.methodOptions" value="vm.data.method"></ndm-selectbox><fieldset ng-if="vm.data.method !== vm.DOT1X_METHOD_ID.NONE" ng-disabled="vm.isDisabled"><ndm-input label="ndm-iface-dot1x.identity" model="vm.data.identity" placeholder="{{\'ndm-iface-dot1x.identity-placeholder\' | translate}}" name="{{::namePrefix}}dot1xIdentity" validation="required,ascii,length[1..64]"></ndm-input><ndm-input label="ndm-iface-dot1x.password" model="vm.data.password" password="true" placeholder="{{\'ndm-iface-dot1x.password-placeholder\' | translate}}" name="{{::namePrefix}}dot1xPassword" validation="required,ascii,length[1..64]"></ndm-input></fieldset></div>'),e.put("app/components/ndm-iface-ip/ndm-iface-ip.html",'<div class="ndm-ip"><ndm-fieldset is-disabled="isDisabled"><ndm-form-header ng-if="label" class="ndm-ip__header" hr="hr-light-blue" label="{{label}}"><div ng-transclude=""></div></ndm-form-header><ndm-text ng-if="description" text="{{description}}"></ndm-text><ndm-selectbox disabled="isDisabled" ndm-disabled-by-mws-tooltip="" label="iface-ip.mode" name="{{::namePrefix}}mode" options="options.modes" on-value-change="_onSelectboxChange" value="data.mode"></ndm-selectbox><ndm-sub-form ng-if="data.mode === IP_CONFIG_MODE.STATIC" ng-form="{{::namePrefix}}staticIpSettings"><div ng-if="!isPpp"><ndm-input ndm-disabled-by-mws-tooltip="" on-change="_onChange" label="iface-ip.address" model="data.ip" name="{{::namePrefix}}ip" validation-data="{nets: usedIps, mask: data.mask}" validation="required,ip,isHost[{{data.mask}}],notInNets[mask,nets]" error="errors.ip"></ndm-input><ndm-selectbox ndm-disabled-by-mws-tooltip="" on-value-change="_onSelectboxChange" disabled="isDisabled" label="iface-ip.mask" value="data.mask" name="{{::namePrefix}}mask" options="options.masks"></ndm-selectbox><ndm-input ndm-disabled-by-mws-tooltip="" ng-if="!noGateway" on-change="_onChange" label="iface-ip.gateway" model="data.gateway" name="{{::namePrefix}}gateway" validation="ip,inNet[{{data.ip}};{{data.mask}}]" error="errors.gateway"></ndm-input></div> <div ng-if="isPpp"><ndm-input ndm-disabled-by-mws-tooltip="" label="iface-ip.address" model="data.ip" on-change="_onChange" name="{{::namePrefix}}ip" validation-data="{nets: usedIps, mask: singleIpMask}" validation="required,ip,notInNets[mask,nets]"></ndm-input><ndm-input ndm-disabled-by-mws-tooltip="" label="iface-ip.remote-address" model="data.remoteIp" on-change="_onChange" name="{{::namePrefix}}remoteIp" validation="ip"></ndm-input></div><ndm-input ng-if="data.mode === IP_CONFIG_MODE.STATIC && !noDns" ndm-disabled-by-mws-tooltip="" ng-repeat="dns in [0, 1, 2] track by $index" label="DNS {{::(dns + 1)}}" model="data.dns[dns]" on-change="_onChange" name="{{::namePrefix}}dns{{::dns}}" validation-data="{allowPort: true}" validation="ip" error="errors[\'dns\' + $index]"></ndm-input></ndm-sub-form><div ng-if="showMacMode"><ndm-selectbox disabled="isDisabled" label="iface-ip.mac-mode-label" options="options.macMode" value="data.macMode"></ndm-selectbox><ndm-sub-form ng-if="data.macMode == MAC_MODE.DIRECT"><ndm-input disabled="idDisabled" label="iface-ip.mac-address" model="data.macAddress" name="macAddress" validation="required,mac"></ndm-input></ndm-sub-form></div><ndm-details ng-if="data.mode && data.mode !== IP_CONFIG_MODE.NONE && (data.mode === IP_CONFIG_MODE.AUTO || showAdditionalFields) && !(noAdditionalSettings && noDns)" ng-form="{{::namePrefix}}additionalSettings" disabled="isDisabled" ndm-disabled-by-mws-tooltip="" always-shown="detailsAlwaysShown" label-hidden="iface-ip.hide-additional-settings" label-visible="iface-ip.show-additional-settings"><ndm-input ng-if="data.mode === IP_CONFIG_MODE.AUTO && !noDns" ng-repeat="dns in [0, 1, 2]" ndm-disabled-by-mws-tooltip="" label="DNS {{::(dns + 1)}}" model="data.dns[dns]" on-change="_onChange" name="{{::namePrefix}}dns{{::dns}}" validation-data="{allowPort: true}" validation="ip"></ndm-input><ndm-input ng-if="!isPpp && data.mode === IP_CONFIG_MODE.AUTO && !noAdditionalSettings" ndm-disabled-by-mws-tooltip="" label="iface-ip.dhcp-client-hostname" model="data.dhcpClientHostname" on-change="_onChange" name="{{::namePrefix}}dhcpClientHostname" validation="ascii,length[..32]"></ndm-input><ndm-input ng-if="!noMtu && !noAdditionalSettings" ndm-disabled-by-mws-tooltip="" label="iface-ip.mtu" model="data.mtu" on-change="_onChange" name="{{::namePrefix}}mtu" validation="range[64..1500]"></ndm-input><ndm-checkbox ng-if="options.ipv6 && !noAdditionalSettings" ndm-disabled-by-mws-tooltip="" on-value-change="_onChange" model="data.ipv6" name="{{::namePrefix}}IPv6" label="iface-ip.ipv6"></ndm-checkbox><ndm-checkbox ng-if="tcpMss && !noAdditionalSettings" ndm-disabled-by-mws-tooltip="" model="data.tcpmss" on-value-change="_onChange" name="{{::namePrefix}}tcpmss" label="iface-ip.tcpmss"></ndm-checkbox><ndm-checkbox ng-if="!noAdditionalSettings" ndm-disabled-by-mws-tooltip="" model="data.ignoreDnsServers" on-value-change="_onChange" name="{{::namePrefix}}ignoreDnsServers" label="iface-ip.ignore-dns" hint="iface-ip.ignore-dns-hint"></ndm-checkbox></ndm-details></ndm-fieldset></div>'),e.put("app/components/ndm-iface-order/ndm-iface-order.html",'<div ng-form="" class="ndm-iface-order"><ndm-selectbox label="iface-order.label" options="options" name="{{\'selectbox_\' + name}}" is-updating="loading" disabled="isDisabled" value="value"><ndm-help webhelp-id="global.priority"></ndm-help></ndm-selectbox></div>'),e.put("app/components/ndm-iface-ppp/ndm-iface-ppp.html",'<div class="ndm-ppp"><ndm-form-header ng-if="label" class="ndm-ppp__header" hr="hr-light-blue" label="{{label}}"><div ng-transclude=""></div> <ndm-help webhelp-id="global.tunnel"></ndm-help></ndm-form-header><ndm-text ng-if="description" text="{{description}}"></ndm-text><ndm-selectbox label="iface-ppp.type" name="{{::prefix}}type" options="vm.options.types" disabled="isDisabled || allowOnlyPppoe" on-value-change="_onSelectboxChange" value="data.type"></ndm-selectbox><fieldset ng-if="data.type !== PPP_TYPE.NONE" ng-form="{{::prefix}}pppSettings" ng-disabled="isDisabled"><ndm-input ng-if="data.type === PPP_TYPE.L2TP || data.type === PPP_TYPE.PPTP" label="iface-ppp.address" model="data.peer" on-change="_onChange" disabled="isDisabled" name="{{::prefix}}address" validation="required,ipOrDomain"></ndm-input><ndm-input label="iface-ppp.identity" model="data.identity" on-change="_onChange" disabled="isDisabled" name="{{::prefix}}identity" validation="required,ascii,length[1..64]" placeholder="{{\'iface-ppp.placeholders.username\' | translate}}"><ndm-help><span class="help-text" title="{{\'iface-ppp.hint-message\' | translate}}" data-translate="">{{\'iface-ppp.hint-message\' | translate}}</span></ndm-help></ndm-input><ndm-input label="iface-ppp.password" password="true" model="data.password" disabled="isDisabled" on-change="_onChange" validation="ascii,length[..64]" name="{{::prefix}}password" placeholder="{{\'iface-ppp.placeholders.password\' | translate}}"></ndm-input><ndm-details label-hidden="iface-ppp.hide-additional-settings" label-visible="iface-ppp.show-additional-settings-of-{{data.type}}"><ndm-selectbox label="iface-ppp.algorithm" name="{{::prefix}}algorithm" options="vm.options.algorithms" disabled="isDisabled" on-value-change="_onSelectboxChange" value="data.algorithm"></ndm-selectbox><ndm-input ng-if="data.type === PPP_TYPE.PPPOE" on-change="_onChange" label="iface-ppp.service" disabled="isDisabled" model="data.service" name="{{::prefix}}service"></ndm-input><ndm-input ng-if="!(data.type === PPP_TYPE.L2TP || data.type === PPP_TYPE.PPTP)" on-change="_onChange" disabled="isDisabled" label="iface-ppp.peer" model="data.pppoePeer" name="{{::prefix}}pppoePeer"></ndm-input><div ng-if="data.type === PPP_TYPE.PPTP"><ndm-checkbox on-change="_onChange()" model="data.mppe" disabled="isDisabled" name="{{::prefix}}mppe" label="iface-ppp.encryption"></ndm-checkbox><ndm-checkbox on-change="_onChange()" model="data.ccp" disabled="data.mppe || isDisabled" name="{{::prefix}}ccp" label="iface-ppp.ccp"></ndm-checkbox></div><ndm-iface-ip ng-if="data.type !== PPP_TYPE.NONE" is-disabled="isDisabled" on-change="_onChange" data="data.ip" used-ips="usedIps" tcp-mss="true" is-ppp="true" details-always-shown="true" disable-none="true" name-prefix="{{::prefix}}pppip-"></ndm-iface-ip></ndm-details></fieldset></div>'),e.put("app/components/ndm-input/ndm-input.html",'<div class="ndm-input {{className}}" ng-cloak=""><div class="ndm-input__wrapper" ng-class="{ \'ndm-input__wrapper--error\': isMessageVisible && errorText }"><div ng-if="title && !titleOnTop" class="ndm-input__title form__cell form__cell--input-label help-text"><span ng-if="icon" class="icon-container {{icon}}-container"><i class="icon {{icon}}"></i></span> <span data-translate="">{{title}}</span></div> <div class="ndm-input__cell form__cell form__cell--top"><span ng-if="title && titleOnTop" class="label-top" data-translate="">{{title}}</span><div ng-if="isAntiAutoFillMode" style="display: none"><input name="fakeLogin__{{name}}"> <input name="fakePassword__{{name}}" type="password"></div> <label class="ndm-input__unit-text" ng-class="{ \'ndm-input__unit-text--focus\': isFocused, \'ndm-input__unit-text--readonly\': readonly, \'ndm-input__unit-text--password\': password, \'ndm-input__unit-text--invalid\': errorText, \'ndm-input__unit-text--disabled\': isDisabled }"><input class="field ndm-input__field" ng-model="model" maxlength="{{maxlength}}" ng-class="{ \'field--error\': errorText, \'field--password\': password }" ng-blur="onBlur()" ng-readonly="readonly" ng-model-options="modelOptions || {debounce: 50}" ng-change="onChange(model, name, errorText)" ng-click="onClick()" ng-focus="onFocus()" ng-keydown="onKeyDown($event)" ng-trim="false" type="{{password && !showPassword ? \'password\' : \'text\'}}" placeholder="{{placeholder || \'\'}}" name="{{name || \'defaultInput\'}}" ng-disabled="isDisabled" autocorrect="off" autocapitalize="off"> <span ng-if="animatedPlaceholder" class="ndm-input__placeholder" ng-class="{ \'ndm-input__placeholder--on-top\': model, \'ndm-input__placeholder--error\': errorText }">{{animatedPlaceholder}}</span> <div ng-if="unitText" class="ndm-input__unit-text__container">{{unitText | translate}}</div> <a ng-if="password" href="" tabindex="{{isDisabled ? \'-1\' : \'0\'}}" class="ndm-input__password-icon" ng-keydown="onPasswordIconKeyDown($event)" ng-click="togglePassword()"><i title="{{(showPassword ? l10n.hide : l10n.show) | translate}}" class="icon icon--{{showPassword ? \'eye-open\' : \'eye-crossed\'}}"></i></a></label> <div ng-if="hint || sideHint" class="_after_input"><ndm-help ng-if="hint" title="{{title | translate}}"><span data-translate="">{{hint}}</span></ndm-help> <div class="_side_hint" ng-if="sideHint" data-translate="">{{sideHint}}</div></div> <label ng-show="isMessageVisible && errorText" class="field--error-text status-problem" title="{{errorText | translate}}" data-translate="">{{errorText}}</label></div><div class="form__cell form__cell--transclude" ng-transclude=""></div> <div ng-if="description" class="ndm-input__description form__cell form__cell--description ng-scope"><a class="form__cell-note form__cell-note--right" tabindex="{{(!isDescriptionDisabled && clickableDescription) ? 0 : -1}}" ng-keydown="onDescriptionKeydown($event)" ng-class="{ \'form__cell-action-link\': descriptionClick, \'form__cell-action-link--disabled\': isDescriptionDisabled }" ng-click="!isDescriptionDisabled && onDescriptionClick(name, model)" data-translate="">{{description}}</a></div></div></div>'),e.put("app/components/ndm-input-autocomplete/ndm-input-autocomplete.html",'<div class="ndm-input-autocomplete {{$ctrl.className}}" ng-class="{ \'ndm-input-autocomplete--draw-as-selectbox\': $ctrl.drawAsSelectbox }"><div ng-if="$ctrl.label" class="ndm-input-autocomplete__label"><span data-translate="">{{$ctrl.label}}</span></div> <div class="ndm-input-autocomplete__wrapper" ng-class="{ \'ndm-input-autocomplete__wrapper--focused\': $ctrl.isInFocus || $ctrl.isDropdownExpanded, \'ndm-input-autocomplete__wrapper--invalid\': $ctrl.isInvalid }"><input tabindex="{{$ctrl.isDisabled ? \'-1\' : \'0\'}}" class="ndm-input-autocomplete__input" ng-model="$ctrl.value" maxlength="{{maxlength}}" ng-model-options="{debounce: 50}" ng-blur="$ctrl.onBlur()" ng-change="$ctrl.onChange($event, $ctrl.value)" ng-click="$ctrl.onInputClick()" ng-focus="$ctrl.onFocus()" ng-keydown="$ctrl.onKeyDown($event)" ng-trim="false" placeholder="{{($ctrl.placeholderText || \'\') | translate}}" name="{{$ctrl.name}}" ng-disabled="$ctrl.isDisabled" ng-class="{ \'ndm-input-autocomplete__input--disabled\': $ctrl.isDisabled }" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"> <i ng-if="$ctrl.drawAsSelectbox" class="ndm-input-autocomplete__dropdown-icon icon icon--dropdown-arrow" ng-class="{ \'ndm-input-autocomplete__dropdown-icon--left\': !$ctrl.label, \'ndm-input-autocomplete__dropdown-icon--dropup\': $ctrl.isDropdownExpanded }" ng-click="$ctrl.onInputClick()"></i> <div ng-if="$ctrl.backgroundText" class="ndm-input-autocomplete__background-text">{{$ctrl.backgroundText}}</div> <div ng-show="$ctrl.isDropdownExpanded" class="ndm-input-autocomplete__dropdown-container" ng-class="{ \'ndm-input-autocomplete__dropdown-container--left\': !$ctrl.label, \'ndm-input-autocomplete__dropdown-container--dropup\': $ctrl.dropup, \'ndm-input-autocomplete__dropdown-container--empty\': $ctrl.matchingOptionsLength === 0 }"><ul class="ndm-input-autocomplete__dropdown"><li class="dropdown-item {{option.className}}" ng-repeat="option in $ctrl.matchingOptions track by $index" ng-class="{ \'dropdown-item--selected\': option[$ctrl.labelProp] == $ctrl.value, \'dropdown-item--with-description\': option.description, \'dropdown-item--focus\': option[$ctrl.labelProp] === $ctrl.optionInFocus }" data-ndm-option-value="{{::option[$ctrl.idProp]}}"><a href="" ng-mousedown="$ctrl.onOptionClick($event, option)" ng-mouseover="$ctrl.onOptionHover(option)" class="dropdown-item__handle" title="{{(option[$ctrl.labelProp] || option) | escapeHtml}}"><i ng-if="option.icon" class="icon icon--{{option.icon}}"></i> <span ng-bind-html="option.matchLabel"></span> <div ng-if="option.description" class="dropdown-item__description" data-translate="">{{option.description}}</div></a></li><li ng-if="$ctrl.matchingOptionsLength === 0" class="dropdown-item--no-match" data-translate="">{{($ctrl.noMatchMessage || \'\') | translate}}</li></ul></div></div> <i class="ndm-input-autocomplete__icon icon icon--{{$ctrl.icon}}" ng-class="{ \'ndm-input-autocomplete__icon--left\': !$ctrl.label, \'ndm-input-autocomplete__icon--dropup\': $ctrl.isDropdownExpanded }" ng-click="$ctrl.onIconClick($event)"></i></div>'),e.put("app/components/ndm-input-drop/ndm-input-drop.html",'<div class="ndm-input-drop form__row"><div class="form__cell form__cell--input-label help-text" data-translate="">{{label}}</div> <div class="form__cell form__cell--top"><div class="input-drop"><div class="input-drop__content-container" ng-class="{ \'input-drop--focus\': isInputDropFocus, \'field--error\': error && !inputHidden }"><input type="text" name="{{inputDrop.inputName}}" ng-keypress="inputDrop.validation($event)" class="field" ng-focus="isInputDropFocus = true" ng-blur="isInputDropFocus = false" ng-disabled="inputDisabled" ng-hide="inputHidden" placeholder="{{placehold | translate}}" ng-model="modelVal"> <div class="dropdown body-text"><ndm-selectbox disabled="dropDisabled" options="dropArray" value="dropValue" name="{{inputDrop.inputName + \'Select\'}}" on-value-change="inputFuncOnChange"></ndm-selectbox></div></div> <div class="input-drop__error-container"><label ng-show="isInputDropFocus && error" class="field--error-text status-problem">{{error}}</label></div></div></div></div>'),e.put("app/components/ndm-input-file/ndm-input-file.html",'<span class="ndm-input-file-wrap"><span ng-if="title" class="form__cell form__cell--input-label help-text ndm-input-file-wrap__title"><span data-translate="">{{title}}</span></span><label tabindex="{{ (!!vm.confirmUpload && vm.isUploading) || (vm.disableOnFileSelect && vm.uploadFile.file.name) ? \'-1\' : \'0\' }}" class="ndm-input-file btn" ng-keydown="onKeydown($event)" ng-click="!vm.isUploading && $event.stopPropagation()" ng-class="{ \'btn--disabled\': (!!vm.confirmUpload && vm.isUploading) || (vm.disableOnFileSelect && vm.uploadFile.file.name), \'btn--primary\': !!vm.confirmUpload && !!vm.uploadFile.file && !!vm.uploadFile.file.name }">{{ ( (!vm.uploadFile.file || !vm.confirmUpload || !btnTitleIfFileSelected) ? btnTitle : btnTitleIfFileSelected ) | translate }} <input class="ndm-input-file__input" ng-click="!!vm.confirmUpload && vm.doUpload($event)" value="vm.uploadFile.file" type="file"></label> <label ng-if="!!vm.uploadFile.file && !!vm.confirmUpload" class="ndm-input-file-wrap__filename"><em>{{vm.uploadFile.file.name}}</em> <span class="icon icon--cancel" ng-click="vm.resetState()"></span></label></span>'),e.put("app/components/ndm-input-filter/ndm-input-filter.html",'<div class="ndm-input-filter {{$ctrl.className}}"><i class="ndm-input-filter__icon icon icon--filter"></i> <input bs-modifiable="false" class="ndm-input-filter__input" ng-class="{ \'ndm-input-filter__input--disabled\': $ctrl.isDisabled }" name="{{$ctrl.name}}" type="search" ng-attr-placeholder="{{$ctrl.placeholder}}" ng-disabled="$ctrl.isDisabled" ng-model="$ctrl.value" ng-change="($ctrl.onChange || angular.noop)($ctrl.value)"> <button ng-if="$ctrl.value" tabindex="-1" type="button" ng-click="$ctrl.reset()" class="ndm-input-filter__reset-btn"><i class="icon icon--cancel"></i></button></div>'),e.put("app/components/ndm-input-new/ndm-input-new.html",'<div class="ndm-input-new" ng-class="{ \'ndm-input-new\': vm.isDisabled }"><label ng-if="vm.label" class="ndm-input-new__label" ng-attr-for="{{ vm.name }}">{{ vm.label }}</label> <input class="ndm-input-new__input" ng-class="{ \'ndm-input-new__input--invalud\': vm.isInvalid }" ng-change="vm._onChange(vm.value)" ng-model="vm.value" ng-attr-name="{{vm.name}}" type="text" placeholder="{{vm.placeholder}}"></div>'),e.put("app/components/ndm-input-selectbox/ndm-input-selectbox.html",'<div class="ndm-input-selectbox" ng-class="{ \'ndm-input-selectbox--tall\': vm.isInFocus && vm.inputIsInvalid }"><div class="ndm-input-selectbox__label">{{ vm.label | translate }}</div> <div class="ndm-input-selectbox__fields"><div class="ndm-input-selectbox__inputs"><div class="ndm-input-selectbox__wrapper" ng-class="{ \'ndm-input-selectbox__wrapper--focus\': vm.isInFocus, \'ndm-input-selectbox__wrapper--invalid\': vm.inputIsInvalid, \'ndm-input-selectbox__wrapper--disabled\': vm.isDisabled }"><input type="hidden" name="{{vm.name}}" ng-model="vm.value"> <div class="ndm-input-selectbox__inputs"><ndm-input bs-modifiable="false" class="ndm-input-selectbox__input" name="{{vm.name}}Input" model="vm.inputValue" placeholder="{{vm.inputPlaceholder | translate}}" on-change="vm.onInputChange" disabled="vm.isDisabled" validation="{{vm.inputValidation}}" on-key="vm.inputKeyFilter" on-focus-toggle="vm.onInputFocusToggle" on-validation-end="vm.updateInputValidity" extra-validator="vm._validator"></ndm-input><div class="ndm-input-selectbox__separator"></div><ndm-selectbox bs-modifiable="false" class="ndm-input-selectbox__selectbox" on-value-change="vm.onSelectboxChange" name="{{vm.name}}Selectbox" disabled="vm.isDisabled" options="vm.selectboxOptions" value="vm.selectboxValue"></ndm-selectbox></div></div> <div class="ndm-input-selectbox__transclude" ng-transclude=""></div></div> <div ng-show="vm.isInFocus && vm.inputIsInvalid" class="ndm-input-selectbox__error" title="{{ vm.inputErrorText | translate }}">{{ vm.inputErrorText | translate }}</div></div></div>'),e.put("app/components/ndm-isp-general-properties/ndm-isp-general-properties.html",'<div class="ndm-isp-general-properties"><ndm-toggle class="ndm-isp-general-properties__toggle ndm-isp-general-properties__toggle--state-{{vm.status.color}}" label="{{vm.l10n.toggleLabel}}" label-on="{{vm.l10n.toggleOnText || vm.status.text}}" label-off="{{vm.l10n.toggleOffText || vm.status.text}}" name="{{vm.namePrefix}}up" disabled="vm.isDisabled" description="vm.toggleDescription" model="vm.model.isUp" call-on-change="vm.onToggle"></ndm-toggle><div class="ndm-isp-general-properties__general-settings" ng-cloak=""><ndm-link ng-hide="vm.scheduleSelectIsVisible" on-click="vm.showScheduleSelect()" link-class="ndm-isp-general-properties__show-schedule-link" label="ndm-isp-general-properties.set-internet-access-schedule"></ndm-link><ndm-schedule-select ng-show="vm.scheduleSelectIsVisible" is-disabled="vm.isDisabled" class="ndm-isp-general-properties__schedule-select" name="{{vm.namePrefix}}schedule" model="vm.model.schedule" initial-data="vm.initialScheduleData" no-selected-thumb="true"></ndm-schedule-select><ndm-iface-order class="ndm-isp-general-properties__order-selectbox" is-disabled="vm.isDisabled" name="{{vm.namePrefix}}order" required="vm.model.isNew" ng-model="vm.model.order" initial-data="vm.initialOrderData"></ndm-iface-order><ndm-input class="ndm-isp-general-properties__description-input" disabled="vm.isDisabled" name="{{vm.namePrefix}}description" label="{{vm.l10n.descriptionLabel}}" description="{{vm.l10n.descriptionComment}}" model="vm.model.description"></ndm-input><div class="ndm-isp-general-properties__transclude" ng-transclude=""></div></div></div>'),e.put("app/components/ndm-isp-iface/ndm-isp-iface.html",'<div class="ndm-isp-iface" ng-form="{{vm.formName}}"><ndm-iface-ip label="{{vm.subtitleIp}}" data="vm.ipData" is-disabled="vm.isDisabled" used-ips="vm.busySubnetsIp" name-prefix="{{vm.prefix}}-ip-" on-change="vm.onIpDataChange" show-mac-mode="vm.showMacMode" auto-with-dhcp="true" disable-none="!vm.PPPOE_INSTALLED"><div class="ndm-isp-iface__ip-status"><span ng-if="vm.status && vm.status.main" class="help-text" ng-class="{ \'help-text--warning\': vm.status.main.color === \'red\', \'help-text--success\': vm.status.main.color === \'green\' }"><span ng-if="vm.ipData.mode !== vm.IP_CONFIG_MODE.NONE" data-translate="">{{ vm.status.ip.text }}</span></span></div></ndm-iface-ip><ndm-iface-ppp ng-if="vm.ANY_PPP_COMPONENT_INSTALLED" label="{{vm.subtitlePpp}}" prefix="{{vm.prefix}}-ppp-" is-disabled="vm.isDisabled" data="vm.pppData" allow-only-pppoe="vm.ipData.mode === vm.IP_CONFIG_MODE.NONE" on-change="vm.onPppDataChange" used-ips="vm.busySubnetsPpp"><div class="ndm-isp-iface__ppp-status"><span ng-if="vm.pppData.type !== vm.PPP_TYPE.NONE && vm.status.ppp" class="help-text" ng-class="{ \'help-text--warning\': vm.status.ppp.color === \'red\', \'help-text--success\': vm.status.ppp.color === \'green\' }"><div class="ppp-status__text" ng-class="{\'ppp-status__text--two-lines\': vm.status.ppp.address}"><span ng-bind-html="vm.status.ppp.text"></span> <div ng-if="vm.status.ppp.address"><span>{{ \'ip-status.success\' | translate:{address: vm.status.ppp.address} }}</span></div></div></span></div></ndm-iface-ppp></div>'),e.put("app/components/ndm-layout/ndm-layout.html",'<div class="ndm-layout"><ndm-header ng-cloak="" ng-if="vm.isLayoutVisible"></ndm-header><a id="d-page-top" href=""></a> <div class="ndm-layout__container"><div ng-cloak="" ng-if="vm.isLayoutVisible" class="ndm-layout__menu"><ndm-menu></ndm-menu><div class="ndm-layout__menu-stand"></div></div> <div class="ndm-layout__transclude" ng-class="{ \'ndm-layout__transclude--menu-overlay\': $root.menuIsOpenOverlayed, \'ndm-layout__transclude--menu-shifting\': $root.menuIsOpen && !$root.menuIsOpenOverlayed, \'ndm-layout__transclude--header-shifting\': !$root.isInitialSetupWizard && !$root.isLoginPage, \'ndm-layout__transclude--header-shifting-mws\': (!$root.isInitialSetupWizard && !$root.isLoginPage) && $root.NDM.DEVICE_IS_MWS_MEMBER, \'ndm-layout__transclude--with-menu\': vm.isLayoutVisible, \'ndm-layout__transclude--no-menu\': !vm.isLayoutVisible }" ng-transclude=""></div></div></div>'),e.put("app/components/ndm-line-chart/ndm-line-chart.html",'<div class="ndm-line-chart"><div class="ndm-line-chart__svg-wrapper" ng-style="$ctrl.autoResize ? {} : {\'height\': $ctrl.height + \'px\'}"><div class="ndm-line-chart__tooltip"></div><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" class="ndm-line-chart__svg" ng-attr-id="{{$ctrl.prefix}}__svg" ng-attr-height="{{$ctrl.height}}px" ng-attr-width="{{$ctrl.width}}px" ng-attr-view_box="0 0 {{$ctrl.width}} {{$ctrl.height}}" ng-class="{\'ndm-line-chart__svg--autosized\': $ctrl.autoResize}" ng-attr-enable_background="new {{$ctrl.width}} {{$ctrl.height}}" ng-click="$ctrl.tooltip.hide()"><g ng-if="$ctrl.yAxisOptions.isVisible"><g ng-if="!$ctrl.xAxisOptions.noHorizontalLines" class="ndm-line-chart__horizontal-lines"><line ng-repeat="ytick in $ctrl.yAxisOptions.tickCoords track by $index" class="ndm-line-chart__hr" ng-attr-x1="{{0}}" ng-attr-y1="{{ytick}}" ng-attr-x2="{{$ctrl.width}}" ng-attr-y2="{{ytick}}"></line></g><line ng-if="!$ctrl.xAxisOptions.noAxisLine" class="ndm-line-chart__axis" ng-attr-x1="0" ng-attr-y1="0" ng-attr-x2="0" ng-attr-y2="{{$ctrl.height}}"></line><g class="ndm-line-chart__ticks-y"><line ng-if="!$ctrl.yAxisOptions.noTicks" ng-repeat="ytick in $ctrl.yAxisOptions.tickCoords track by $index" class="ndm-line-chart__tick" ng-attr-x1="{{-$ctrl.yTickLength / 2}}" ng-attr-y1="{{ytick}}" ng-attr-x2="{{$ctrl.yTickLength / 2}}" ng-attr-y2="{{ytick}}"></line><svg ng-if="$ctrl.isFirefox && !$ctrl.yAxisOptions.noLabels" ng-repeat="ytick in $ctrl.yAxisOptions.tickCoords track by $index" ng-attr-x="{{-$ctrl.yTickContainer.width + $ctrl.shift.yTick}}" ng-attr-y="{{ytick - $ctrl.yTickContainer.height / 2}}" ng-attr-width="{{$ctrl.yTickContainer.width}}" ng-attr-height="{{$ctrl.yTickContainer.height}}" ng-attr-view_box="0 0 {{$ctrl.yTickContainer.width}} {{$ctrl.yTickContainer.height}}"><text ng-attr-x="{{$ctrl.yTickContainer.x - $ctrl.shift.yTick}}" ng-attr-y="{{$ctrl.yTickContainer.height / 2}}" text-anchor="end" dominant-baseline="central" class="ndm-line-chart__tick-text">{{$ctrl.yAxisOptions.labelFormatFn($ctrl.yAxisOptions.labels[$index] || ytick)}}</text></svg><text ng-if="!$ctrl.isFirefox && !$ctrl.yAxisOptions.noLabels" ng-repeat="ytick in $ctrl.yAxisOptions.tickCoords track by $index" ng-attr-y="{{ytick}}" ng-attr-x="{{$ctrl.shift.yTick}}" text-anchor="end" dominant-baseline="central" class="ndm-line-chart__tick-text">{{$ctrl.yAxisOptions.labelFormatFn($ctrl.yAxisOptions.labels[$index] || ytick)}}</text></g></g><g ng-if="$ctrl.xAxisOptions.isVisible"><line ng-if="!$ctrl.xAxisOptions.noAxisLine" class="ndm-line-chart__axis" ng-attr-x1="0" ng-attr-y1="{{toSvgY(0)}}" ng-attr-x2="{{$ctrl.width}}" ng-attr-y2="{{toSvgY(0)}}"></line><g class="ndm-line-chart__ticks-x"><line ng-if="!$ctrl.xAxisOptions.noTicks" ng-repeat="xtick in $ctrl.xAxisOptions.tickCoords track by $index" class="ndm-line-chart__tick" ng-attr-x1="{{xtick}}" ng-attr-y1="{{toSvgY(-$ctrl.xTickLength / 2)}}" ng-attr-x2="{{xtick}}" ng-attr-y2="{{toSvgY($ctrl.xTickLength / 2)}}"></line><text ng-if="!$ctrl.xAxisOptions.noLabels" ng-repeat="xtick in $ctrl.xAxisOptions.tickCoords track by $index" class="ndm-line-chart__tick-text" ng-attr-x="{{xtick + $ctrl.shift.xTick}}" ng-attr-y="{{$ctrl.shift.xTickY}}" text-anchor="middle" dominant-baseline="central">{{$ctrl.xAxisOptions.labelFormatFn($ctrl.xAxisOptions.labels[$index] || xtick)}}</text></g></g><g class="ndm-line-chart__charts"><g ng-repeat="chart in $ctrl.charts track by $index" class="ndm-line-chart__chart"><polygon ng-if="!$ctrl.curveSmoothFactor" class="ndm-line-chart__polyline ndm-line-chart__polyline--{{chart.colorId}}" ng-attr-points="{{chart.contour}}"></polygon><path ng-if="$ctrl.curveSmoothFactor" class="ndm-line-chart__smooth-curve ndm-line-chart__smooth-curve--{{chart.colorId}}" ng-attr-d="{{chart.contour}}"></path></g></g></svg></div></div>'),e.put("app/components/ndm-link/ndm-link.html",'<a class="ndm-link {{$ctrl.linkClass}}" ng-attr-tabindex="{{$ctrl.isDisabled ? \'-1\' : \'0\'}}" ng-keydown="$ctrl.onKeydown($event)" ng-click="$ctrl.onClick()" ng-href="{{$ctrl.hrefParam}}" ng-class="{ \'{{$ctrl.linkClass}}--disabled\': $ctrl.isDisabled, \'ndm-link--disabled\': $ctrl.isDisabled }"><span ng-if="$ctrl.label" data-translate="">{{$ctrl.label}}</span> <div class="ndm-link__transcluded-content" ng-transclude=""></div></a>'),e.put("app/components/ndm-list/ndm-list.html",'<div class="ndm-list form__row" ng-cloak=""><div class="form__row" ng-repeat="x in infoObj" ng-if="!(x.isHidden || !x.info)" ng-cloak=""><div class="form__cell form__cell--input-label help-text {{x.labelCss}}"><span data-translate="">{{x.label}}</span></div> <div class="form__cell {{x.infoCss}}"><span data-translate="">{{x.info}}</span></div> <div ng-if="x.directive" class="form__cell form__cell--directive" ng-click="_onClick(x, $event)"><div add-directive="x.directive"></div></div></div></div>'),e.put("app/components/ndm-menu/ndm-menu.html",'<div class="ndm-menu" ng-class="{ \'ndm-menu--opened\': vm.isOpen, \'ndm-menu--accordion\': vm.isOpen && !vm.openedGroups.all, \'ndm-menu--overlay\': vm.isOverlay, \'ndm-menu--mws-member\': $root.NDM.DEVICE_IS_MWS_MEMBER }"><div class="ndm-menu__overlap" ng-click="vm.toggle()"></div> <div class="ndm-menu__scrollable" init-scroll=""><div class="ndm-menu__content"><div ng-class="{ \'ndm-menu__group--opened\': vm.openedGroups[key] || vm.openedGroups.all, \'ndm-menu__group--active\': section.isActive }" ng-repeat="(key, section) in vm.menuHierarchy" ng-click="vm.toggleGroup(key)" class="ndm-menu__group"><div class="ndm-menu__title"><span class="ndm-menu__title-icon_container"><span ng-if="::section.icon" class="icon" ng-class="::{[\'icon--\' + section.icon]: true}"></span></span> <span class="ndm-menu__title-text" data-translate="">{{::section.header}}</span></div> <a ng-repeat="point in section.points" ng-hide="point.isHidden" tabindex="{{vm.isOpen ? 0 : -1}}" class="ndm-menu__item" data-ui-sref-active="ndm-menu__item--active" data-ui-sref="{{::point.sref}}(point.srefParams)" ng-class="::{ \'menu-link--segment\': point.isSegment, \'ndm-menu__item--new\': point.isNew, \'ndm-menu__new-sms\': point.hasNewSms }" data-translate="">{{point.menuTitle}}</a></div> <div ng-click="vm.toggleBySeparatorClick()" class="ndm-menu__separator"></div> <div ng-click="vm.logout()" class="ndm-menu__logout"><div class="ndm-menu__title"><span class="ndm-menu__title-icon_container"><span class="icon icon--menu-logout"></span></span> <span class="ndm-menu__title-text" data-translate="">menu.logout</span></div></div> <div class="ndm-menu__bottom"><div class="ndm-menu__bottom-language"><ndm-selectbox disabled="!vm.isOpen" name="language" on-change="vm.languages.change()" value="vm.languages.current" options="vm.languages.list"></ndm-selectbox></div> <div class="ndm-menu__bottom-support"><a target="_blank" ng-href="{{$root.helpCenterLink}}" ng-hide="!vm.isOpen" data-translate="">menu.support-link</a></div></div></div></div> <div class="ndm-menu__toggle"><div tabindex="{{vm.isOpen ? 0 : -1}}" ng-click="vm.toggle()" id="ndm_menu_toggle" class="ndm-menu__title"><span class="ndm-menu__title-icon_container"><span class="icon icon--menu-burger"></span></span> <span class="ndm-menu__title-text" data-translate="">menu.hide-menu</span></div></div></div>'),e.put("app/components/ndm-meter/ndm-meter.html",'<div class="ndm-meter"><div class="meter-level" style="width:{{level}}%"></div></div>'),e.put("app/components/ndm-modal/alert.html",'<div class="modal modal--popup"><ndm-key-press ng-if="true" action-on="[\'escape\']" call-func="[close]"></ndm-key-press><div class="modal__background"><div class="modal__body"><div class="modal__body-title body-text" data-translate="">{{::text}}</div> <div class="modal__body-controls"><ndm-button btn-class="btn--primary" ng-click="close(true)" label="{{::confirmText}}"></ndm-button></div></div></div></div>'),e.put("app/components/ndm-modal/confirm.html",'<div class="modal modal--popup"><ndm-key-press action-on="[\'escape\']" call-func="[close]"></ndm-key-press><div class="modal__background"><div class="modal__body"><a tabindex="0" class="modal__close" ng-keydown="closeOnSpace($event)" ng-click="close(false)">×</a> <div class="modal__body-title body-text" data-translate="">{{::text}}</div> <div class="modal__body-controls"><ndm-button tab-index="2" btn-class="btn--primary" ng-click="close(true)" label="{{::confirmText}}"></ndm-button><a ng-keydown="closeOnSpace($event)" ng-click="close(false)" tabindex="1" class="action-link" data-translate="">{{::cancelText}}</a></div></div></div></div>'),e.put("app/components/ndm-multi-input-table/ndm-multi-input-table.html",'<div class="ndm-multi-input-table"><div ng-form="subform" bs-modifiable="false"><div ng-if="!values.length" class="ndm-multi-input-table__empty-message" ng-cloak="" data-translate="">{{emptyMessage || \'multi-input-table.empty-message\'}}</div><table class="ndm-table body-text ndm-multi-input-table" ng-if="values.length" ng-cloak=""><thead><tr><th class="table__header table__col-0"><span data-translate="">{{header || \'multi-input-table.default-header\'}}</span></th><th ng-if="!disabled"></th><th ng-if="!disabled"></th></tr></thead><tbody><tr class="ndm-table__row" ng-repeat="(key, value) in values track by $index"><td ng-click="!disabled && key !== editingKey && editItem(key)"><div class="ndm-multi-input-table__input-container" ng-if="!disabled && key === editingKey"><ndm-input model="values[key]" disabled="disabled" name="key" set-focus="1" extra-validator="extraValidator" validation="{{validation}}"></ndm-input></div><div ng-if="disabled || key !== editingKey">{{value}}</div></td><td ng-if="!disabled" class="ndm-multi-input-table__table-btn-cell" ng-class="{\'ndm-multi-input-table__table-btn-cell--disabled\': subform.$invalid}" ng-click="key === editingKey ? submitEdit() : editItem(key)" data-translate="">{{key === editingKey ? \'multi-input-table.apply\' : \'multi-input-table.edit\' }}</td><td ng-if="!disabled" class="ndm-multi-input-table__table-btn-cell" ng-click="key === editingKey ? cancelEdit() : removeItem(key)" data-translate="">{{key === editingKey ? \'multi-input-table.cancel\' : \'multi-input-table.delete\' }}</td></tr></tbody></table></div> <div class="ndm-multi-input-table__button-add" ng-if="!disabled"><button type="button" class="btn" ng-click="values.length < max && !subform.$invalid && addItem()" data-translate="">{{addCaption || \'multi-input-table.add\'}}</button> <a tabindex="0" class="ndm-multi-input-table__button-flush action-link" ng-if="values.length > 0" ng-keydown="onKeydown($event)" ng-click="onFlushButtonClicked()" data-translate="">{{flushCaption || \'multi-input-table.flush\'}}</a></div></div>'),e.put("app/components/ndm-mws-animation/ndm-mws-animation.html",'<svg class="mws-animation-welcome" ng-class="{ \'mws-animation-welcome__scene1\': !isFinalStage, \'mws-animation-welcome__scene2\': isFinalStage }" viewbox="-420 -100 20 450"><g transform="scale(-1, 1)"><g transform="translate(80, -103)"><g class="radioCircles" clip-path="url(#cut-off-radio)" style="-webkit-clip-path: url(#cut-off-radio)"><g transform="translate(559, 385)"><g class="radioCircleC"><circle r="245" fill="#009cdd"></circle></g></g><g transform="translate(315.16, 170.65)"><g class="radioCircleA"><circle r="180" fill="#009cdd"></circle></g></g><g transform="translate(181.65, 389.83)"><g class="radioCircleB"><circle r="245" fill="#009cdd"></circle></g></g></g></g><image x="68.3" y="-46.1" width="753" height="396" xlink:href="/assets/img/mws-modal-house.svg"></image><g transform="translate(638.12, 280.25)"><g transform="translate(-590.12, -286.25)"><circle cx="590.12" cy="286.25" r="22.93" fill="#009cdd"></circle><use xlink:href="#iconK" x="579" y="277"></use></g><g class="radioWaves-1"><use xlink:href="#radioWave"></use></g><g class="radioWaves-2"><use xlink:href="#radioWave"></use></g></g><g data-name="Wi-Fi System" transform="translate(120, -110)"><defs><g id="radioWave"><g transform="translate(-201.65, -389.83)"><path d="M181.27,410.22a28.83,28.83,0,0,1,0-40.78" fill="none" stroke="#009cdd" stroke-miterlimit="10" stroke-width="3.5"></path><path d="M222,369.44a28.85,28.85,0,0,1,0,40.78" fill="none" stroke="#009cdd" stroke-miterlimit="10" stroke-width="3.5"></path></g></g><g id="iconK"><g transform="translate(22, 0)"><g transform="scale(-0.45, 0.45)"><path d="M 33.4,17.1 51,0.5 H 37 L 20.8,16.3 H 9.2 V 0.5 H 0 V 41.4 H 9.2 V 25.5 h 16.2 c 6.8,0 11.5,1.5 14,4.4 1.5,1.7 2.2,4 2.2,6.9 v 4.6 h 9.2 v -4.6 c 0,-5 -1.5,-9.4 -4.4,-12.8 -3.1,-3.5 -7.4,-5.9 -13,-6.9" fill="#fff"></path></g></g></g><line id="radioConnection-line" class="radioLineDashed" x1="0" y1="0" x2="200" y2="0" stroke="#4099d4" stroke-width="10" stroke-miterlimit="10"></line><g id="radioConnection-arrow"><g transform="translate(-1.5, -3)"><g transform="scale(1.5, 1.5)"><path d="M0,0 L0,12 L9,6 z" fill="#4099d4"></path></g></g></g><clippath id="cut-off-radio"><path d="M 19.776007,443.83007 V 222.85221 L 330.69297,81.10085 639.91734,223.79254 v 220.03753 z"></path></clippath></defs><g transform="translate(265.16, 171.65)"><g class="sateliteA"><g transform="translate(-265.16, -171.65)"><circle cx="265.16" cy="171.65" r="22.93" fill="#009cdd"></circle><use xlink:href="#iconK" x="253" y="162"></use><g transform="translate(265.16, 171.65)"><g class="radioWaves-1"><use xlink:href="#radioWave"></use></g><g class="radioWaves-2"><use xlink:href="#radioWave"></use></g></g></g></g></g><g transform="translate(141.65, 389.83)"><g class="sateliteB"><g transform="translate(-141.65, -389.83)"><circle cx="141.65" cy="389.83" r="22.93" fill="#009cdd"></circle><use xlink:href="#iconK" x="131" y="380"></use><g transform="translate(141.65, 389.83)"><g class="radioWaves-1"><use xlink:href="#radioWave"></use></g><g class="radioWaves-2"><use xlink:href="#radioWave"></use></g></g></g></g></g><g transform="translate(474, 345)"><g class="radioConnectionA" transform="rotate(-141)"><use y="-7" xlink:href="#radioConnection-arrow" transform="rotate(180)"></use><g class="radioConnectionA-rightArrow"><use y="-5" xlink:href="#radioConnection-arrow"></use></g><g class="radioLineA"><line class="radioLineDashed" x1="0" y1="-2" x2="200" y2="-2"></line><line class="radioLineDashed-B" x1="0" y1="4" x2="200" y2="4"></line></g></g></g><g transform="translate(456, 392)"><g class="radioConnectionB" transform="rotate(180)"><use y="-7" xlink:href="#radioConnection-arrow" transform="rotate(180)"></use><g class="radioConnectionB-rightArrow"><use y="-5" class="radioConnectionB-rightArrow" xlink:href="#radioConnection-arrow"></use></g><g class="radioLineB"><line class="radioLineDashed" x1="0" y1="-2" x2="250" y2="-2"></line><line class="radioLineDashed-B" x1="0" y1="4" x2="250" y2="4"></line></g></g></g><g transform="translate(174, 340)"><g class="radioConnectionAB" transform="rotate(-62)"><use y="-7" xlink:href="#radioConnection-arrow" transform="rotate(180)"></use><g class="radioConnectionAB-rightArrow"><use y="-5" class="radioConnectionAB-rightArrow" xlink:href="#radioConnection-arrow"></use></g><g class="radioLineAB"><line class="radioLineDashed" x1="0" y1="-2" x2="130" y2="-2"></line><line class="radioLineDashed-B" x1="0" y1="4" x2="130" y2="4"></line></g></g></g></g></g></svg>'),e.put("app/components/ndm-notification/ndm-notification-container.html",'<div class="ndm-notifications-container"><div class="ndm-notifications-container__wrapper" ng-style="getHeight()"></div></div>'),e.put("app/components/ndm-notification/ndm-notification.html",'<div class="ndm-notification ndm-notification--{{type}}" ng-class="{\'ndm-notification--visible\': visible}"><div class="ndm-notification__body"><div class="ndm-notification__body-msg"><div class="ndm-notification__body-msg--width-fix"><div class="ndm-notification__body-msg--valigned"><span class="ndm-notification__header" ng-if="header" data-translate="">{{::header}}</span> <span data-translate="">{{::message}}</span></div></div></div> <label class="ndm-notification__close"><i class="ndm-notification__close-icon ndm-notification__close-icon--white" ng-click="close($event)"></i></label></div></div>'),e.put("app/components/ndm-page/ndm-page.html",'<div class="ndm-page" ng-class="{ \'ndm-page--no-scroll\': $root.menuIsOpenOverlayed || noScroll, \'ndm-page--no-scrollbar\': noScroll, \'ndm-page--mws-member\': $root.NDM.DEVICE_IS_MWS_MEMBER, \'ndm-page--under-popup\': $root.isPopupOpen }" init-scroll=""><div class="ndm-page__inner"><ndm-page-header progress="headerProgress" label="{{title}}" webhelp-text="{{webhelpText}}"></ndm-page-header><div class="ndm-page__content ndm-page__content--loading" ng-class="{ \'ndm-page__content--loading\' : isLoad, \'ndm-page__content--nodescription\' : !description }"><p ng-if="description" class="ndm-page__description" ng-cloak="" data-translate="">{{description}}</p><div ng-transclude=""></div></div></div></div>'),e.put("app/components/ndm-page-header/ndm-page-header.html",'<div class="ndm-page-header" ng-class="{ \'ndm-page-header--mws-member\': $root.NDM.DEVICE_IS_MWS_MEMBER }" ng-cloak=""><div class="header" ng-class="{ \'header--shadow\': isShadowVisible, \'header--loading\': progress < 100 }"><span class="header__title primary-title"><span data-translate="">{{title}}</span> <ndm-help webhelp-id="current-state"><span ndm-html-compile="webhelpText"></span></ndm-help></span> <div ng-if="progress < 100" class="header__loading-bar loading-bar"><div class="loading-bar__progress"><div class="loading loading--determinate"><span class="loading__line" ng-style="{ \'width\': (progress > 0 ? progress : 0) + \'%\' }"></span></div></div></div></div><ndm-notifications-container ng-if="progress >= 100 && !isPopupOpen"></ndm-notifications-container></div>'),e.put("app/components/ndm-path-overflow/ndm-path-overflow.html",'<div class="ndm-path-overflow"><div ng-if="parts.volume">{{parts.volume}}</div><div ng-if="parts.directory">{{parts.directory}}</div><div ng-if="parts.base">{{parts.base}}</div></div>'),e.put("app/components/ndm-pingcheck/ndm-pingcheck.html",'<div class="ndm-pingcheck"><ndm-form-header hr="hr-light-blue" label="{{label || \'pingcheck.title\'}}" class="ndm-pingcheck__header"><ndm-help webhelp-id="global.pingcheck"><span data-translate="">pingcheck.hint</span></ndm-help> <div ng-transclude=""></div></ndm-form-header><ndm-text ng-if="description" text="{{description}}"></ndm-text><ndm-selectbox disabled="isDisabled" ng-init="data.mode = data.mode || PINGCHECK_MODE.NONE" label="pingcheck.mode" name="{{::namePrefix}}mode" options="options.modes" value="data.mode"></ndm-selectbox><ndm-sub-form ng-if="data.mode !== PINGCHECK_MODE.NONE && data.mode !== PINGCHECK_MODE.DEFAULT" ng-disabled="isDisabled"><ndm-input label="pingcheck.interval" model="data.interval" name="{{::namePrefix}}interval" unit-text="time.second" placeholder="3…3600" validation="required,range[3..3600]"></ndm-input><ndm-input label="pingcheck.fails" model="data.fails" name="{{::namePrefix}}fails" placeholder="1…10" validation="required,range[1..10]"></ndm-input><ndm-input label="pingcheck.host" model="data.host" name="{{::namePrefix}}host" validation="required,ipOrDomain"><ndm-help><span data-translate="">pingcheck.host-hint</span></ndm-help></ndm-input><div ng-if="data.mode === PINGCHECK_MODE.TCP" ng-form="{{::namePrefix}}portForm"><ndm-input label="pingcheck.port" model="data.port" name="{{::namePrefix}}port" placeholder="1…65534" validation="required,range[1..65534]"></ndm-input></div></ndm-sub-form></div>'),e.put("app/components/ndm-policy-select/ndm-policy-select.html",'<div class="ndm-policy-select"><div class="ndm-policy-select__selectbox-container"><ndm-selectbox ng-if="$ctrl.ready" disabled="$ctrl.isDisabled" name="{{$ctrl.name}}" value="$ctrl.value" label="{{$ctrl.label}}" on-hover="$ctrl.showPreview(value)" on-open="$ctrl.onOpen()" on-change="$ctrl.showPreview(value)" on-close="$ctrl.hidePreview()" options="$ctrl.options"><div class="ndm-policy-select__transclude-container" ng-transclude=""></div></ndm-selectbox></div><div ng-show="$ctrl.previewIsVisible && $ctrl.previewValue !== $ctrl.constants.DEFAULT_DENY_POLICY" class="interfaces-order-preview" ng-class="{\'interfaces-order-preview--dropup\': $ctrl.dropup}"><div class="interfaces-order-preview__content"><div class="interfaces-order-preview__title" data-translate="">ndm-policy-select.policy-interfaces-order</div> <div ng-repeat="iface in $ctrl.policyInterfaces[$ctrl.previewValue]" class="policy-interface"><div class="policy-interface__order"><i ng-if="!iface.isEnabled" class="icon icon--cancel"></i> <span ng-if="iface.isEnabled">{{$index + 1}}</span></div> <div class="policy-interface__description">{{iface.label}}</div></div></div></div></div>'),e.put("app/components/ndm-popup/ndm-popup.html",'<div class="ndm-popup" ng-show="initialized" ng-class="{ \'ndm-popup--behind-shadow\': isBehindShadow, \'ndm-popup--show\' : isVisible, \'ndm-popup--with-footer\' : popupFooterVisible, \'_blocked\': !isUpperPopup }" ng-cloak=""><div ng-if="isVisible && isUpperPopup" ng-click="onCloseClick()" class="ndm-popup__overlay"></div> <div class="ndm-popup__content"><ndm-notifications-container ng-if="isVisible && isUpperPopup"></ndm-notifications-container><ndm-popup-header label="{{headerTitle}}" webhelp-id="{{webhelpId}}" status-class="{{headerStatusClass}}" status-text="{{headerStatusText}}" close="onCloseClick" hint="{{headerHint}}"></ndm-popup-header><ndm-key-press ng-if="isVisible && isUpperPopup && !modalConfirm.open" action-on="[\'escape\']" call-func="[onCloseClick]"></ndm-key-press><div class="ndm-popup__transclude" init-scroll="" ng-transclude=""></div> <div ng-if="!isUpperPopup" class="_blocker"></div></div></div>'),e.put("app/components/ndm-popup-header/ndm-popup-header.html",'<div class="ndm-popup-header" data-ng-class="{ \'ndm-popup-header--shadow\': isShadowShown }"><label class="popup-close"><i class="popup-close__icon" ng-click="close()"></i></label> <div class="primary-title"><div class="cssMax1line" data-translate="">{{title}}</div> <ndm-help ng-if="webhelpId" webhelp-id="{{webhelpId}}"></ndm-help> <div ng-if="!webhelpId && hint"><ndm-help><span ndm-html-compile="hint"></span></ndm-help></div></div></div>'),e.put("app/components/ndm-popup-small/ndm-popup-small.html",'<div class="ndm-popup-small" ng-class="{ \'ndm-popup-small--invisible\': !vm.isVisible }"><div ng-if="vm.isVisible" class="ndm-popup-small__overlay"></div><div ng-if="vm.isVisible" class="ndm-popup-small__container {{ vm.popupClass }}"><button class="ndm-popup-small__close-button" ng-show="vm.showCloseBtn" ng-click="vm.close()"></button> <div ng-transclude=""></div></div></div>'),e.put("app/components/ndm-ports-range/ndm-ports-range.html",'<div class="ndm-input _ports_range"><div class="form__cell form__cell--input-label help-text"><span data-translate="">{{singleMode ? singleTitle : rangeTitle}}</span></div> <div class="form__cell form__cell--top"><div class="field__container"><input class="field ___from" ng-model="modelFrom" max-length="5" ng-class="{\'field--error\': errors.from || errors.extra || errors.range}" ng-blur="focus.isStartPortFocused = false;" ng-focus="focus.isStartPortFocused = true;" ng-keypress="numericInputFilter($event)" name="{{nameFrom}}"> <div ng-show="!singleMode" class="field--double-ports"><svg class="field--separator" width="7" height="10" viewbox="0 0 10 10"><line stroke="black" x1="0%" y1="50%" x2="100%" y2="50%" stroke-width="2"></line></svg><input class="field ___to" ng-model="modelTo" max-length="5" size="5" ng-class="{\'field--error\': errors.to || errors.extra || errors.range}" ng-blur="focus.isEndPortFocused = false;" ng-focus="focus.isEndPortFocused = true;" ng-keypress="numericInputFilter($event)" name="{{nameTo}}"></div></div> <label ng-if="(errors.from && focus.isStartPortFocused) || (errors.to && focus.isEndPortFocused) || ((errors.extra || errors.range) && (focus.isStartPortFocused || focus.isEndPortFocused))" class="field--error-text status-problem">{{(focus.isStartPortFocused ? errors.from : errors.to) || errors.range || errors.extra}}</label></div></div>'),e.put("app/components/ndm-progress-bar/ndm-progress-bar.html",'<div ng-if="isVisible" class="ndm-progress-bar"><div class="progress-bar__count-container"><div ng-if="count && !isCountHidden" class="progress-bar__count">{{count}}%</div></div> <div class="progress-bar__progress progress progress{{count > 0 ? \'--determinate\' : \'--indeterminate\'}}"><div class="progress__line" ng-style="{ \'width\' : count + \'%\' }" ng-class="{\'no-transition\': noTransition}"></div></div><p ng-if="loadStatus" class="progress-bar__status help-text" data-translate="">{{loadStatus}}</p></div>'),e.put("app/components/ndm-radio/ndm-radio.html",'<div class="ndm-radio form__row"><div ng-if="label" class="form__cell form__cell--input-label help-text"><span class="form__cell--input-label-text" data-translate="">{{label}}</span></div> <div class="form__cell form__cell--top"><input name="{{name}}" type="hidden" ng-model="model"><form bs-modifiable="0" class="form__cell radio-button"><div class="radio" ng-repeat="x in array"><input class="radiobutton__input" type="radio" name="{{name + (x.value || x.id)}}" id="{{name + (x.value || x.id)}}" value="{{x.id}}" ng-model="$parent.model" ng-disabled="disabled || x.disabled" ng-change="onChange && onChange()"> <label ng-attr-for="{{name + (x.value || x.id)}}" ng-click="_click(x)" class="radiobutton__label" data-translate="">{{x.name}}</label> <i ng-if="x.description.iconClass" class="radio-description__icon icon {{x.description.iconClass}}"></i> <span class="radio-description__text" ng-if="x.description" ng-class="{ \'help-text--warning\': x.description.color === \'red\' || x.description.status === \'warning\', \'help-text--success\': x.description.color === \'green\' || x.description.status === \'success\' }" data-translate="">{{x.description.text || x.description}}</span></div><div class="form__cell form__cell--transclude" ng-transclude=""></div> <ndm-help ng-if="hint"><div data-translate="">{{hint}}</div></ndm-help></form></div></div>'),e.put("app/components/ndm-radio-buttons/ndm-radio-buttons.html",'<div class="ndm-radio-buttons"><ul class="ndm-radio-buttons__list" ng-disabled="isDisabled || x.isDisabled" ng-class="{ \'ndm-radio-buttons__list--disabled\': isDisabled }"><li ng-repeat="(id, item) in model" ng-click="onClick(item)" ng-disabled="isDisabled" class="ndm-radio-buttons__item" ng-class="{ \'ndm-radio-buttons__item--active\': id == current.id, \'ndm-radio-buttons__item--disabled\': isDisabled }" data-translate="">{{item.label}}</li></ul></div>'),e.put("app/components/ndm-selectbox/ndm-selectbox.html",'<div class="form"><div class="directive-ndm-selectbox ndm-selectbox {{className}}" ng-class="{ \'view-as-link\': viewAsLink }"><div ng-if="vm.title" class="ndm-selectbox__title form__cell form__cell--input-label help-text"><span data-translate="">{{vm.title}}</span></div> <div class="ndm-selectbox__cell form__cell form__cell--top"><div ng-class="{ \'dropdown--disabled\': vm.isDisabled || disabled, \'dropdown--error\': (vm.error || error) && !isUpdating() }" class="dropdown" id-key="id" is-opened="vm.isOpened"><div class="sb-container" id="{{ vm.formatInstance(vm.instance) }}"><input type="hidden" ng-model="vm.value" name="{{name}}" ng-value="vm.value"> <a tabindex="{{(vm.isDisabled || disabled) ? -1 : 0}}" class="sb-toggle" ng-keydown="vm.onKeydown($event)" ng-click="!isUpdating() && vm.toggle($event)" ng-class="{ \'sb-toggle--with-icon\': vm.icon, \'sb-toggle-active\': vm.active, \'sb-toggle--disabled\': vm.isDisabled || disabled }"><div ng-if="isUpdating()" class="sb-toggle--is-updating"><i class="icon icon--load"></i></div> <div ng-if="!isUpdating()" class="sb-toggle__inner-wrapper"><i ng-if="vm.icon" class="sb-toggle__item-icon icon icon--{{vm.icon}}"></i> <span ng-if="!vm.showIconAsLabel" class="sb-value" ng-class="{ \'sb-placeholder-text\': vm.placeholder && !vm.value }"><div ng-if="vm.icon" class="sb-item--selected sb-item--icon"><i class="icon {{vm.icon}}"></i></div> <div class="sb-item--selected" ng-bind-html="( (!vm.value && vm.placeholder) ? vm.placeholder : (vm.options[vm.value][vm.labelKey] || vm.value || \'selectbox.select\') ) | escapeHtml | translate"></div></span></div></a><ul ng-if="vm.active" class="sb-dropdown" ng-class="{ \'sb-dropleft\': vm.dropleft, \'sb-dropup\': vm.dropup, \'sb-displayed\': vm.displayed }"><li class="sb-item" ng-repeat="(key, option) in vm.options" ng-hide="option.hide" ng-class="{ \'sb-item-active\': key == vm.value, \'sb-item-focus\': key + \'\' === vm.focusId + \'\' }" data-ndm-option-value="{{::key}}"><a class="sb-item-handle" ng-click="vm.change(key, option)" ng-mouseover="vm.hover(key, option)" title="{{option[vm.labelKey] || option | escapeHtml | translate}}"><i ng-if="option.icon" class="icon icon--{{option.icon}}"></i> <div class="sb-item-handle__wrapper"><span class="sb-item-handle__label" data-translate="">{{(option[vm.labelKey] || option) | escapeHtml}}</span> <div ng-if="option.labelSuffix" ndm-html-compile="option.labelSuffix"></div></div> <span ng-if="option.description" class="sb-item-description" data-translate="">{{option.description}}</span></a></li><li ng-if="vm.showEmptyListMsg()" class="sb-item sb-empty" data-translate="">{{::emptyListMsg}}</li></ul></div></div><p ng-if="vm.error" class="help-text help-text--warning ndm-selectbox__error" data-translate="">{{vm.error}}</p></div> <div ng-if="vm.description" class="form__cell ndm-selectbox__description"><a ng-keydown="clickableDescription && onDescriptionKeydown($event)" tabindex="{{(clickableDescription && !isDescriptionDisabled) ? 0 : -1}}" class="form__cell-note--right help-text _side_hint" ng-class="{ \'form__cell-note\': !onDescriptionClick, \'action-link\': vm.textLink, \'action-link--disabled\': isDescriptionDisabled }" ng-click="onDescriptionClick && onDescriptionClick()" data-translate="">{{vm.description}}</a></div> <div ng-transclude="" class="form__cell ndm-selectbox__transclude"></div></div> <div ng-if="vm.bottomDescription" class="form__row directive-ndm-selectbox__bottom-description"><div class="form__cell form__cell--input-label"></div> <div class="form__cell form__cell--top form__cell-note" data-translate="">{{vm.bottomDescription}}</div></div></div>'),e.put("app/components/ndm-selectbox-filter/ndm-selectbox-filter.html",'<div class="ndm-selectbox-filter {{$ctrl.className}}" ng-keydown="$ctrl.onContainerKeydown($event)"><div class="ndm-selectbox-filter__input"><input name="{{$ctrl.name}}" ng-required="$ctrl.isRequired" type="hidden" ng-model="$ctrl.value"><ndm-input class="ndm-selectbox-filter__ndm-input" ng-class="{ \'ndm-selectbox-filter__ndm-input--error\': $ctrl.isRequired && !$ctrl.value, \'ndm-selectbox-filter__ndm-input--opened\': $ctrl.isOpened }" bs-modifiable="false" name="{{$ctrl.name}}__label" model="$ctrl.valueLabel" label="{{$ctrl.label}}" disabled="$ctrl.isDisabled" on-key="$ctrl._onKey" on-press-enter="$ctrl.onEnter()" on-press-space="$ctrl.onSpace()" on-press-up="$ctrl.onUpArrow()" on-press-down="$ctrl.onDownArrow()" disable-autocomplete="true" on-press-esc="$ctrl.hideOptions()" placeholder="{{$ctrl.isDisabled ? \'\' : $ctrl.placeholderText}}" call-on-click="$ctrl.onInputClick" on-change="$ctrl.onInputChange"><i class="ndm-selectbox-filter__dropdown-icon icon icon--dropdown-arrow" ng-class="{ \'ndm-selectbox-filter__dropdown-icon--left\': !$ctrl.label, \'ndm-selectbox-filter__dropdown-icon--dropup\': $ctrl.isOpened }" ng-click="$ctrl.onInputClick()"></i></ndm-input></div><div ng-if="$ctrl.isOpened" class="ndm-selectbox-filter__dropdown-container" ng-class="{ \'ndm-selectbox-filter__dropdown-container--left\': !$ctrl.label, \'ndm-selectbox-filter__dropdown-container--dropup\': $ctrl.dropup, \'ndm-selectbox-filter__dropdown-container--empty\': $ctrl.totalOptionsLength === 0, }"><ul class="ndm-selectbox-filter__dropdown"><div ng-repeat="group in $ctrl.groups track by $index" ng-if="$ctrl.filteredOptions[group[$ctrl.idProp]].length > 0"><li ng-if="!$ctrl.hideItemGroups && group[$ctrl.labelProp]" class="dropdown-item dropdown-item--group" data-translate="">{{group[$ctrl.labelProp]}}</li><li class="dropdown-item {{option.className}}" ng-repeat="option in $ctrl.filteredOptions[group[$ctrl.idProp]] track by $index" ng-class="{ \'dropdown-item--ungrouped\': $ctrl.hideItemGroups, \'dropdown-item--selected\': option[$ctrl.idProp] == $ctrl.value, \'dropdown-item--with-description\': option.description, \'dropdown-item--focus\': option[$ctrl.idProp] === $ctrl.optionInFocus }" data-ndm-option-value="{{::option[$ctrl.idProp]}}"><a href="" class="dropdown-item__handle" ng-click="$ctrl.onOptionClick(option)" ng-mouseover="$ctrl.onOptionHover(option, group)" title="{{option[$ctrl.labelProp] || option | escapeHtml}}"><i ng-if="option.icon" class="icon icon--{{option.icon}}"></i> <span ng-bind-html="option.highlightLabel || (option[$ctrl.labelProp] | escapeHtml)"></span> <span ng-if="option.description" class="dropdown-item__description" data-translate="">{{option.description}}</span></a></li></div><li ng-if="$ctrl.totalOptionsLength === 0" class="dropdown-item dropdown-item--help help-text" data-translate="">{{$ctrl.emptyListMsg}}</li></ul></div></div>'),e.put("app/components/ndm-selectbox-with-details/ndm-selectbox-with-details.html",'<div class="ndm-select-with-details"><div class="ndm-select-with-details__selectbox-container"><ndm-selectbox ng-if="vm.isReady" disabled="vm.isDisabled" name="{{vm.name}}" value="vm.value" label="{{vm.label}}" on-hover="vm.showPreview(value)" on-open="vm.onOpen()" on-change="vm.showPreview(value)" on-close="vm.hidePreview()" on-value-change="vm.onChange" options="vm.options" description="{{vm.description}}"><div class="ndm-select-with-details__transclude-container" ng-transclude=""></div></ndm-selectbox></div><div ng-show="vm.previewIsVisible" class="ndm-select-with-details__details-container" ng-class="{ \'ndm-select-with-details__details-container--dropup\': vm.dropup }"><div class="option-details"><div class="option-details__title"><strong data-translate="">{{vm.previewValue.title}}</strong></div> <div class="option-details__description"><span data-translate="">{{vm.previewValue.description}}</span></div></div></div></div>'),e.put("app/components/ndm-sub-form/ndm-sub-form.html",'<div class="ndm-sub-form form"><div class="form--sub" ng-transclude=""></div></div>'),e.put("app/components/ndm-svg-icon/ndm-svg-icon.html",'<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" class="ndm-svg-icon {{$ctrl.className}}" ng-attr-width="{{$ctrl._width}}" ng-attr-height="{{$ctrl._height}}" ng-attr-view_box="{{$ctrl.viewbox}}"><use xlink:href="{{$ctrl.svgUrl}}"></use></svg>'),e.put("app/components/ndm-switchport/ndm-switchport.html",'<div class="ndm-switchport" ng-class="{ \'ndm-switchport--combo\': vm.isCombo }"><div class="ndm-switchport__wrapper" ng-class="{ \'ndm-switchport__wrapper--combo\': vm.isCombo, \'ndm-switchport__wrapper--sfp\': vm.isSfp }"><div ng-if="!vm.isSfp" class="ndm-switchport__inner" ng-class="{ \'ndm-switchport__inner--reverse-port\': vm.isReversed }"><ndm-svg-icon class="ndm-switchport__icon" svg-id="{{vm.svgId}}"></ndm-svg-icon><div class="ndm-switchport__label" data-translate="">{{vm.label}}</div></div> <div ng-if="vm.isCombo || vm.isSfp" class="ndm-switchport__sfp-icon" ng-class="{ \'ndm-switchport__sfp-icon--separate\': vm.isSfp, \'ndm-switchport__sfp-icon--active\': vm.isSfpActive }">sfp</div> <div ng-if="vm.role" class="ndm-switchport__role-icon ndm-switchport__role-icon--{{vm.role}}"><i class="icon icon--role-{{vm.role}}"></i></div></div> <div class="ndm-switchport__transclude" ng-transclude=""></div></div>'),e.put("app/components/ndm-switchport-container/ndm-switchport-container.html",'<div class="ndm-switchport-container" ng-class="{ \'ndm-switchport-container--padded\': vm.isScrollVisible }"><div class="ndm-switchport-container__overlay" ng-class="{ \'ndm-switchport-container__overlay--scrollable\': vm.isScrollVisible }"><div class="ndm-switchport-container__transclude" ng-class="{ \'ndm-switchport-container__transclude--macos\': vm.isMacOs, \'ndm-switchport-container__transclude--scrollable\': vm.isScrollVisible }" ng-transclude=""></div> <div ng-if="vm.isScrollVisible" class="ndm-switchport-container__overlay-right"></div> <div ng-if="vm.isScrollVisible" ng-show="vm.isReady" class="ndm-switchport-container__overlay-down"></div></div> <div ng-if="vm.isScrollVisible" class="scroll-buttons"><button class="scroll-buttons__button scroll-buttons__button--prev" ng-class="{ \'scroll-buttons__button--inactive\': vm.isScrollLeftButtonInactive() }" type="button" ng-mousedown="vm.startScrollLeft()" ng-mouseup="vm.stopScroll()"><span class="scroll-buttons__button-arrow"><ndm-svg-icon class="" svg-id="button-right-arrow"></ndm-svg-icon></span> <span class="scroll-buttons__button-text" data-translate="">ndm-switchport-container.scroll-left</span></button> <button class="scroll-buttons__button scroll-buttons__button--next" ng-class="{ \'scroll-buttons__button--inactive\': vm.isScrollRightButtonInactive() }" type="button" ng-mousedown="vm.startScrollRight()" ng-mouseup="vm.stopScroll()"><span class="scroll-buttons__button-text" data-translate="">ndm-switchport-container.scroll-right</span> <span class="scroll-buttons__button-arrow scroll-buttons__button-arrow--next"><ndm-svg-icon class="" svg-id="button-right-arrow"></ndm-svg-icon></span></button></div></div>'),e.put("app/components/ndm-switchport-role/ndm-switchport-role.html",'<div class="ndm-switchport-role"><i ng-if="vm.role" ng-attr-title="{{ vm.title | translate }}" class="ndm-switchport-role__icon icon icon--role-{{vm.role}}"></i> <span ng-if="!vm.role" class="ndm-switchport-role__text" ng-attr-title="{{ vm.roleText | translate }}">{{ vm.roleText | uppercase }}</span></div>'),e.put("app/components/ndm-switchport-select/ndm-switchport-select.html",'<div class="ndm-switchport-select {{vm.className}}" ng-keydown="vm.onContainerKeydown($event)" ng-class="{ \'ndm-switchport-select--disabled\': vm.isDisabled }"><a tabindex="{{vm.isDisabled ? -1 : 0}}" class="ndm-switchport-select__toggle" ng-class="{ \'ndm-switchport-select__toggle--active\': vm.isOpened, \'ndm-switchport-select__toggle--dropup\': vm.showOptionsAboveElement, \'ndm-switchport-select__toggle--no-shadow\': vm.isToggleShadowInvisible() }" ng-click="vm.onToggleClick()"><input type="hidden" ng-model="vm.value" ng-attr-name="{{vm.name}}"> <div ng-if="vm.selectedOption" class="selectbox-toggle__value" title="{{vm.selectedOption.label | translate}}"><div ng-if="vm.selectedOption.icon" class="selectbox-toggle__icon-wrapper"><i ng-init="dims = vm.selectedOption.iconDimensions" class="option__icon icon icon--{{vm.selectedOption.icon}}" ng-style="dims ? {\'width\': dims.width + \'px\', \'height\': dims.height + \'px\'} : {}"></i></div> <span ng-if="!vm.selectedOption.icon" data-translate="">{{vm.selectedOption.valueLabel || vm.selectedOption.label}}</span></div> <div ng-if="!vm.selectedOption" class="selectbox-toggle__placeholder"><i ng-if="vm.placeholder.icon" class="selectbox-toggle__value-icon icon icon--{{vm.placeholder.icon}}"></i> <span ng-if="!vm.placeholder.icon" data-translate="">{{vm.placeholder.valueLabel || vm.placeholder.label}}</span></div> <i class="ndm-switchport-select__dropdown-icon icon icon--dropdown-arrow" ng-class="{ \'ndm-switchport-select__dropdown-icon--up\': vm.isOpened }"></i></a> <div class="ndm-switchport-select__options-container-wrapper" ng-class="{ \'ndm-switchport-select__options-container-wrapper--on-top\': vm.isClosestToToggleOptionInFocus() }"><ul ng-show="vm.isOpened" id="ndmSwitchportSelectOptionsContainer__{{vm.uid}}" class="ndm-switchport-select__options-container" ng-class="{ \'ndm-switchport-select__options-container--dropup\': vm.showOptionsAboveElement, \'ndm-switchport-select__options-container--dropright\': vm.alignOptionsToRightBorder, \'ndm-switchport-select__options-container--floating\': vm._appendToBody, \'ndm-switchport-select__options-container--invisible\': !vm.elementIsInsideScrollableParent || !vm.elementIsInsideMainContainer }"><li class="switchport-select-option {{option.className}}" ng-repeat="option in vm.options track by $index" ng-class="{ \'switchport-select-option--selected\': option.id == vm.value, \'switchport-select-option--focus\': option.id === vm.optionInFocus }" data-ndm-option-value="{{::option.id}}"><a href="" class="switchport-select-option__handle" ng-click="vm.onOptionClick(option)" ng-mouseover="vm.onOptionHover(option)" title="{{option.label | translate}}"><ndm-svg-icon ng-if="option.icon" class="switchport-select-option__icon" width="{{option.iconDimensions.width || vm.optionIconDimensions.width}}" height="{{option.iconDimensions.height || vm.optionIconDimensions.height}}" svg-id="{{option.icon}}"></ndm-svg-icon><span class="switchport-select-option__label" data-translate="">{{option.label}}</span></a></li></ul></div></div>'),e.put("app/components/ndm-table/ndm-table.html",'<table class="ndm-table {{tableClass}} body-text" ng-class="{\'ndm-table--draggable\': draggable}"><thead><tr><th ng-if="items.length > 1 && draggable" class="ndm-table--draggable-handle-cell"></th><th ng-repeat="(key, value) in columns" ng-click="draggable || (sortable && setSortCol(key))" class="table__header table__col-{{$index}}" ng-attr-title="{{(!value.checkbox ? (value.title || value) : (value.checkbox.label || value.checkbox.hint || \'\')) | translate | trust}}" ng-class="{ \'sortable\': sortable && !draggable && !value.unsortable, \'table__col--checkbox\': value.checkbox }" ng-style="value.width && {\'width\': value.width + \'px\'}" ng-init="val = (value.title || value)"><div ng-if="!value.checkbox"><span data-translate="">{{value.title || value}}</span> <i class="icon icon--indicator-sortIcon" ng-if="::(!draggable && sortable)" ng-class="{reverse: sortReverse, hide: sortName !== key}"></i> <div ng-if="value.subTitle" ng-bind-html="value.subTitle"></div></div> <div ng-if="value.checkbox" ng-click="$event.preventDefault()"><ndm-checkbox bs-modifiable="false" name="checkbox__{{key}}" disabled="value.checkbox.disabled" label="{{value.checkbox.label}}" model="value.checkbox.model" on-change="value.checkbox.onChange(!value.checkbox.model)"></ndm-checkbox><i class="icon icon--indicator-sortIcon" ng-if="::(!draggable && sortable)" ng-class="{reverse: sortReverse, hide: sortName !== key}"></i></div></th></tr></thead><tbody ng-transclude="customRowSlot" class="ndm-table__custom-row"></tbody><tbody class="ndm-table__body" ng-class="{ \'ndm-table__body--dragging\': dragging }" bs-modifiable="false" data-ng-model="data" ng-sortable="sortableConf"><tr ng-if="!items || !items.length" class="ndm-table__row--no-data"><td colspan="{{cols}}" class="__no-data"><i ng-if="!items" class="icon-dashboard__item-icon icon icon--load"></i> <span ng-if="preloaderText" data-translate="">{{preloaderText}}</span></td></tr><tr ng-repeat="(k, row) in items | orderBy:_sortName:_sortReverse:sort | limitTo: limitTo track by trackByFn($id(row), row)" ng-attr-item-idx="{{$index}}" class="ndm-table__row {{row.trClass}}"><td ng-if="items.length > 1 && draggable" class="ndm-table--draggable-handle-cell" ng-class="{\'ndm-table--draggable-handle-cell--disabled\': dragDisabled}"><i class="icon icon--drag-n-drop-handle icon--table-menu"></i></td><td ng-repeat="(key, value) in (columns || row)" class="table__col-{{$index}}" ng-class="{ \'clickable\': clickOnRow || (value.clickable && clickOnCell), \'table__col--checkbox\': columns[key].checkbox }" ng-style="value.width && {\'width\': value.width + \'px\'}" ng-click="value.clickable ? clickOnCellHandler($event, row[key], key, row) : clickOnRow(row, k, $event)"><div bs-modifiable="true" class="td-content-wrapper" add-directive="columns[key].directive" x-directive-attrs="{{columns[key].directive.options ? columns[key].directive.options : false}}" model="row[key]" ng-bind-html="trustAsHtml(!columns[key].directive ? value.modify ? value.modify(row[key], row) : (row[key] || \'\') : \'\')">{{value.modify ? value.modify(row[key], row) : row[key]}}</div></td></tr></tbody></table>'),e.put("app/components/ndm-table-deviceslist/ndm-table-deviceslist.html",'<table class="ndm-table-deviceslist {{tableClasses}} body-text"><thead><tr><td class="{{x.tdClass}}" ng-repeat="x in infoObj.header" ng-click="x.sortArguments && sort(x.sortArguments)" title="{{x.label | translate}}"><span class="ndm-table-deviceslist__column-label" data-translate="">{{x.label}}</span> <i class="icon icon--indicator-sortIcon revert" ng-show="x.sortArguments && sortObj.sortFiled === x.sortArguments[1]"></i></td></tr></thead><tbody><tr ng-click="clickOnRowFunc(x, rowOnClickParams, $event)" ng-repeat="x in list | orderBy: [] : false : _sortFn track by $index"><td ng-repeat="body in infoObj.body" class="{{body.tdClass}}" ng-bind-html="body.tdData(x)"></td></tr><tr class="no-devices-label"><td data-translate="">{{noDataMessage}}</td></tr></tbody></table>'),e.put("app/components/ndm-tabs/ndm-tabs.html",'<div class="ndm-tabs"><ul class="tabs-list"><li ng-if="vm.tabsToShow > 1" ng-repeat="(idx, tab) in vm.visibleTabs" ng-attr-title="{{tab[vm.labelProp]}}" ng-attr-tabindex="{{(vm.isDisabled || idx === vm.activeTabIdx - vm.viewStartIdx) ? \'-1\' : \'0\'}}" class="tabs-list__item" ng-class="{ \'tabs-list__item--active\': idx === vm.activeTabIdx - vm.viewStartIdx, \'tabs-list__item--modified\': tab.isModified, \'tabs-list__item--new\': tab.isNew, \'tabs-list__item--disabled\': vm.isDisabled, \'tabs-list__item--removable\': tab.isRemovable, \'tabs-list__item--suffix-icon\': tab.suffixIcon, \'tabs-list__item--invalid\': tab.isInvalid }" ng-keydown="vm.handleKeydown($event, vm.onTabClick, idx + vm.viewStartIdx, tab)" ng-click="!vm.isDisabled && vm.onTabClick(idx + vm.viewStartIdx, tab)"><a class="tabs-list__link"><i ng-if="tab.icon" class="tabs-list__item-icon icon icon--{{tab.icon}}"></i> <span>{{tab[vm.labelProp]}}</span> <i ng-if="tab.suffixIcon" class="tabs-list__item-suffix-icon icon icon--{{tab.suffixIcon}}"><ndm-tooltip ng-if="tab.tooltip && !(idx === vm.activeTabIdx - vm.viewStartIdx)" class="tabs-list__item-tooltip item-tooltip">{{tab.tooltip}}</ndm-tooltip></i></a><ndm-link ng-if="tab.isRemovable" on-click="vm.removeTab(tab.index)" link-class="tabs-list__close">×</ndm-link><span ng-if="tab.isInvalid" class="tabs-list__item-is-invalid-icon" title="Has error"></span></li><li ng-if="(vm.hiddenTabs.length > 0) || vm.tabsToShow === 1" ng-class="{ \'tabs-list__dropdown-tab--active\': vm.tabsToShow === 1, \'tabs-list__dropdown-tab--many\': !vm.showHiddenTabs && vm.tabsToShow === 1 && (vm.hiddenTabs.length > 0 || !vm.noAddTabBtn) }" class="tabs-list__dropdown-tab"><a ng-attr-tabindex="{{vm.isDisabled ? \'-1\' : \'0\'}}" ng-click="vm.toggleHiddenTabsDropdown()" ng-keydown="vm.handleKeydown($event, vm.toggleHiddenTabsDropdown)" class="tabs-list__dropdown-tab__toggle-link"><div ng-if="vm.tabsToShow === 1" class="tabs-list__dropdown-tab__label">{{vm.visibleTabs[vm.activeTabIdx - vm.viewStartIdx][[vm.labelProp]]}}</div> <span ng-if="vm.hiddenTabs.length > 0 || !vm.noAddTabBtn" class="icon {{vm.showHiddenTabs ? \'icon--arrow-down\' : \'icon--arrow-up\'}}"></span> <span ng-if="vm.tabsToShow > 1">...</span> <div ng-if="vm.hiddenTabs.length > 0 && vm.tabsToShow > 1" class="tabs-list__dropdown-tab__counter"><span>{{vm.hiddenTabs.length}}</span></div></a><ul ng-if="vm.showHiddenTabs && (vm.hiddenTabs.length || (!vm.noAddTabBtn && vm.tabsToShow < 2))" class="tabs-list__dropdown-tab__dropdown" ng-class="{ \'tabs-list__dropdown-tab__dropdown--right\': vm.rightBorderIsTooClose }"><li ng-repeat="(idx, tab) in vm.hiddenTabs" ng-attr-title="{{tab[vm.labelProp]}}" ng-attr-tabindex="{{vm.isDisabled ? \'-1\' : \'0\'}}" class="tabs-list__dropdown-tab__dropdown__item" ng-class="{ \'tabs-list__dropdown-tab__dropdown__item--new\': tab.isNew }" ng-keydown="!vm.isDisabled && vm.onTabKeydown($event, false, idx)" ng-click="!vm.isDisabled && vm.onHiddenTabClick(idx)"><a class="tabs-list__dropdown-tab__dropdown__item__link"><span>{{tab[vm.labelProp]}}</span></a></li><li ng-if="!vm.noAddTabBtn && vm.tabsToShow < 2" ng-attr-tabindex="{{vm.isDisabled ? \'-1\' : \'0\'}}" class="tabs-list__dropdown-tab__dropdown__item" ng-class="{\'tabs-list__add-tab-btn--disabled\': vm.isDisabled || vm.addTabBtnIsDisabled}" title="{{vm.addTabBtnLabel | translate }}" ng-keydown="vm.handleKeydown($event, vm.onAddTabKeydown)" ng-click="!vm.isDisabled && (vm.toggleHiddenTabsDropdown() || vm.addTabBtnClick())"><a class="tabs-list__dropdown-tab__dropdown__item__link"><span class="tabs-list__add-tab-btn__plus-sign">+</span> {{vm.addTabBtnLabel | translate }}</a></li></ul></li><li ng-if="!vm.noAddTabBtn && vm.tabsToShow > 1" class="tabs-list__add-tab-btn" ng-class="{\'tabs-list__add-tab-btn--disabled\': vm.isDisabled || vm.addTabBtnIsDisabled}" title="{{vm.addTabBtnLabel | translate }}"><ndm-link link-class="tabs-list__add-tab-btn__plus-sign" is-disabled="vm.isDisabled || vm.addTabBtnIsDisabled" blur-on-click="true" on-click="vm.addTabBtnClick()">+</ndm-link></li></ul><div ng-transclude=""></div></div>'),e.put("app/components/ndm-text/ndm-text.html",'<p class="ndm-text body-text"><span data-translate="">{{text}}</span> <span ng-transclude=""></span></p>'),e.put("app/components/ndm-textarea/ndm-textarea.html",'<div class="ndm-textarea" ng-cloak=""><div class="form__cell form__cell--input-label help-text"><span data-translate="">{{$ctrl.title}}</span></div> <div class="form__cell form__cell--top"><div class="ndm-textarea__textarea-wrapper" ng-class="{ \'ndm-textarea__textarea-wrapper--error\': $ctrl.ngModel.$invalid, \'ndm-textarea__textarea-wrapper--focus\': $ctrl.isInFocus }"><textarea ng-model="$ctrl.model" ng-required="$ctrl.isRequired" ng-minlength="$ctrl.minLength" ng-maxlength="$ctrl.maxLength" ng-change="$ctrl.onChange($ctrl.model)" ng-focus="$ctrl.isInFocus = true" ng-blur="$ctrl.isInFocus = false" rows="{{$ctrl.rows}}" cols="{{$ctrl.cols}}" placeholder="{{$ctrl.placeholder || \'\'}}" ng-disabled="isDisabled" class="ndm-textarea__textarea" ng-class="{ \'ndm-textarea__textarea--error\': $ctrl.ngModel.$invalid, \'ndm-textarea__textarea--focus\': $ctrl.isInFocus }">\n            </textarea></div> <div class="form__cell--right"><ndm-help ng-if="hint"><div class="baloon__body-title body-text" data-translate="">{{$ctrl.title}}</div><p class="baloon__notification" data-translate="">{{$ctrl.hint}}</p></ndm-help></div> <label ng-show="$ctrl.isInFocus && $ctrl.ngModel.$invalid" class="field--error-text status-problem"><div ng-if="$ctrl.ngModel.$error.required" data-translate="">errors.required-field</div> <div ng-if="$ctrl.ngModel.$error.minlength"><span data-translate="">errors.invalid-length</span> > {{$ctrl.minLength - 1}}</div> <div ng-if="$ctrl.ngModel.$error.maxlength"><span data-translate="">errors.invalid-length</span> < {{$ctrl.maxLength + 1}}</div></label></div></div>'),e.put("app/components/ndm-toggle/ndm-toggle.html",'<div class="ndm-toggle form__row form__row--toggle"><div class="form__cell"><div class="toggle" ng-cloak=""><span class="toggle__text-label" ng-if="label" data-translate="">{{label}}</span> <input bs-modifiable="false" tabindex="{{(disabled || deviceIsOffline) ? -1 : 0}}" class="toggle__input" type="checkbox" id="{{name + \'toggle\'}}" ng-checked="locked ? lastUnlockedState : model" ng-class="{ \'toggle__input--disabled\': disabled || locked || deviceIsOffline }" onclick="return false;" ng-keydown="_onKeydown($event)" ng-disabled="disabled || locked || deviceIsOffline"><label class="toggle__label" ng-click="_click($event)" ng-attr-for="{{name + \'toggle\'}}"></label></div> <div class="toggle-text" ng-class="{ \'two-lines\': description }"><span data-translate="{{model ? labelOn : labelOff}}"></span><br ng-if="description"><span class="toggle-description" ng-if="description" ng-attr-title="{{ (description.text || description) | translate }}" ng-class="{ \'help-text--warning\': description.color === \'red\' || description.status === \'warning\', \'help-text--success\': description.color === \'green\' || description.status === \'success\' }" data-translate="">{{ (description.text || description) | translate }}</span></div></div></div>'),e.put("app/components/ndm-tooltip/ndm-tooltip.html",'<div class="ndm-tooltip"><div class="ndm-tooltip__wrapper" ng-class="{ \'ndm-tooltip__wrapper--hidden\': !$ctrl.isReady }"><i class="ndm-tooltip__arrow ndm-tooltip__arrow--{{$ctrl.floatDirection}}"></i> <div class="ndm-tooltip__content ndm-tooltip__content--{{$ctrl.floatDirection}}" ng-transclude=""></div></div></div>'),e.put("app/components/ndm-tooltip-old/ndm-tooltip-old.html",'<div class="ndm-tooltip-old"><div class="ndm-tooltip-old__wrapper" ng-class="{ \'ndm-tooltip-old__wrapper--hidden\': !$ctrl.isReady }"><i class="ndm-tooltip-old__arrow ndm-tooltip-old__arrow--{{$ctrl.floatDirection}}"></i> <div class="ndm-tooltip-old__content ndm-tooltip__content--{{$ctrl.floatDirection}}" ng-transclude=""></div></div></div>'),e.put("app/components/ndm-traffic-shaper/ndm-traffic-shaper.html",'<div class="ndm-traffic-shaper"><ndm-checkbox ng-if="vm.showIsEnabledCheckbox" label="ndm-traffic-shaper.enable-speed-limit" name="{{vm.namePrefix}}IsEnabled" model="vm.model.isEnabled" on-value-change="vm.onIsEnabledChanged"></ndm-checkbox><div ng-if="vm.model.isEnabled || !vm.showIsEnabledCheckbox" ng-form="{{vm.namePrefix}}Subform" ng-class="{ \'form--sub\': vm.showIsEnabledCheckbox }"><ndm-input-selectbox label="{{ vm.l10nPrefix + (vm.model.isAsymmetric ? \'download-limit\' : \'symmetric-limit\') }}" name="{{vm.namePrefix}}DownloadLimit" input-value="vm.model.download.limit" input-placeholder="ndm-traffic-shaper.no-limit-placeholder" input-key-filter="vm.inputFilter" validator="vm.limitValidation" input-validation="vm.model.isAsymmetric && vm.model.upload.limit ? \'required\' : \'\'" selectbox-options="vm.unitOptions" selectbox-value="vm.model.download.scale" is-disabled="vm.isDisabled"></ndm-input-selectbox><ndm-checkbox label="{{ vm.l10nPrefix + \'asymmetric-speed-limit\'}}" name="{{vm.namePrefix}}IsAsymmetric" model="vm.model.isAsymmetric"></ndm-checkbox><div ng-if="vm.model.isAsymmetric" ng-form="{{vm.namePrefix}}UploadSubform"><ndm-input-selectbox ng-if="vm.model.isAsymmetric" label="{{ vm.l10nPrefix + \'upload-limit\' }}" name="{{vm.namePrefix}}UploadLimit" input-placeholder="ndm-traffic-shaper.no-limit-placeholder" input-value="vm.model.upload.limit" input-key-filter="vm.inputFilter" validator="vm.limitValidation" selectbox-options="vm.unitOptions" selectbox-value="vm.model.upload.scale" is-disabled="vm.isDisabled"></ndm-input-selectbox></div><ndm-schedule-select ng-if="vm.hasSchedule" label="ndm-traffic-shaper.schedule" name="{{vm.namePrefix}}Schedule" model="vm.model.schedule"></ndm-schedule-select></div></div>'),e.put("app/components/ndm-user-add-table/ndm-user-add-table.html",'<table class="ndm-table user-add-table"><tr ng-if="!$ctrl.formIsVisible" class="no-hover"><td colspan="3"><ndm-button on-click="$ctrl.actions.showForm" label="apps.private-cloud.add-user-text"></ndm-button></td></tr><tr ng-if="$ctrl.formIsVisible" class="no-hover" ng-form="$ctrl.form" bs-modifiable=""><td><div class="ndm-input"><input bs-modifiable="false" class="field" ng-class="{\'field--error\': $ctrl.actions.userInvalid()}" ng-model="$ctrl.user" name="username" maxlength="32" autofocus="" autocomplete="off" placeholder="{{$ctrl.translates.login}}"> <label ng-if="$ctrl.actions.userInvalid()" class="field--error-text status-problem" data-translate="">{{$ctrl.actions.userInvalid()}}</label></div></td><td><div class="ndm-input"><input bs-modifiable="false" type="password" class="field" ng-class="{\'field--error\': $ctrl.actions.passwordInvalid()}" ng-model="$ctrl.pass" name="password" autocomplete="off" placeholder="{{$ctrl.translates.password}}"> <label ng-show="$ctrl.actions.passwordInvalid()" class="field--error-text status-problem" data-translate="">errors.password-format</label></div></td><td><div class="td-content-wrapper user-add-table__toolbar"><ndm-button is-disabled="$ctrl.actions.userInvalid() || $ctrl.actions.passwordInvalid()" button-name="addUserButton" btn-class="btn btn--primary" on-click="$ctrl.actions.addUser" label="apps.private-cloud.add"></ndm-button><a tabindex="0" ng-keydown="$ctrl.onKeydown($event, $ctrl.actions.closeForm)" ng-click="$ctrl.actions.closeForm()" class="action-link" data-translate="">cancel</a></div></td></tr></table>'),e.put("app/components/ndm-webhelp-release-notes/ndm-webhelp-release-notes.html",'<span class="ndm-webhelp-release-notes" ng-class="{ \'ndm-webhelp-release-notes--loading\': vm.loading }"><span ng-if="vm.link || vm.loading"><span ng-if="vm.wrapInBrackets">(</span> <a href="{{vm.link}}" target="_blank" class="external-link" ng-class="{ \'external-link--disabled\': vm.loading }" data-translate="">webhelp-release-notes.open-release-notes</a> <span ng-if="vm.wrapInBrackets">)</span></span></span>'),e.put("app/page/controlPanel/controlPanel.html",'<div class="cp-center-box"><div ui-view="cp-main" id="cp-main-container" class="ndm-page-view form-modified-checker" ng-class="{ \'cp-center-box--popup-open\' : $root.isPopupOpen, \'cp-center-box--alert-open\' : $root.isAlertOpen, \'device_pc\': $root.isBrowserForPC, \'device_handheld\': !$root.isBrowserForPC }"></div></div>'),e.put("app/page/dashboard/card_apps.html",'<div class="d-main__card" id="card_apps" ng-controller="DashboardCardAppsController as DCAC"><div class="d-main__card-header"><a class="d-main__card-title" ui-sref="controlPanel.apps" data-translate="">dashboard.card_apps.title</a></div> <div ng-show="DCAC.showCardContent" class="d-main__card-container"><div ng-if="DCAC.noAppsInSysmode || !DCAC.appsExists" class="body-text" data-translate="">dashboard.card_apps.no-apps</div> <div ng-if="DCAC.appsExists" class="apps-list"><div ng-repeat="name in ::DCAC.appsOrder track by $index" ng-if="DCAC.apps[name].component" ng-click="DCAC.openAppsPageWithPopup($event, name)" class="apps-list__row"><div ng-if="!DCAC.apps[name].toggles" class="apps-list__app-toggle"><ndm-toggle label-on="{{DCAC.apps[name].title || name}}" label-off="{{DCAC.apps[name].title || name}}" ng-if="DCAC.apps[name].notConfigured" model="" name="apps_{{name}}__fake-toggle" disabled="true" description="DCAC.apps[name].state"></ndm-toggle><ndm-toggle label-on="{{DCAC.apps[name].title || name}}" label-off="{{DCAC.apps[name].title || name}}" ng-if="!DCAC.apps[name].notConfigured" model="DCAC.apps[name].enabled" name="apps_{{name}}" disabled="DCAC.apps[name].disabled || DCAC.apps[name].error" call-on-change="DCAC.toggleApp" description="DCAC.apps[name].state"></ndm-toggle></div> <div ng-if="DCAC.apps[name].toggles" class="apps-list__app-toggle"><div ng-repeat="subservice in DCAC.apps[name].toggles" ng-if="subservice.component" class="apps-list__app-subservice-toggle"><ndm-toggle label-on="{{subservice.title}}" label-off="{{subservice.title}}" model="subservice.enabled" name="apps_{{name}}_{{subservice.name}}" disabled="subservice.disabled || subservice.error || subservice.notConfigured" call-on-change="subservice.onToggle" description="subservice.state"></ndm-toggle></div></div> <div class="apps-list__app-description"><span class="body-text" title="{{DCAC.apps[name].description | translate}}" data-translate="">{{DCAC.apps[name].description}}</span><br><a ng-if="DCAC.apps[name].link.visible" class="external-link" target="_blank" ng-class="{\'external-link--disabled\': DCAC.apps[name].link.disabled}" ng-href="{{DCAC.apps[name].link.href}}" ng-click="$event.stopPropagation();" data-translate="">{{DCAC.apps[name].link.name}}</a></div> <div class="apps-list__tooltip-description" ng-click="$event.stopPropagation()"><ndm-help><h2 data-translate="">{{DCAC.apps[name].title}}</h2><div class="help-text" data-translate="">{{DCAC.apps[name].description}}</div><br><a ng-if="DCAC.apps[name].link.visible" class="external-link" target="_blank" ng-class="{\'external-link--disabled\': DCAC.apps[name].link.disabled}" ng-href="{{DCAC.apps[name].link.href}}" ng-click="$event.stopPropagation();" data-translate="">{{DCAC.apps[name].link.name}}</a></ndm-help></div></div></div></div></div>'),e.put("app/page/dashboard/card_internet.html",'<div class="d-main__card" id="card_internet" ng-controller="DashboardCardInternetController as DCIC"><div class="d-main__card-header"><a class="d-main__card-title" ng-href="{{ { router: DCIC.processSref(DCIC.getIfaceSetupPageByType(DCIC.activeIface)), repeater: DCIC.processSref(\'controlPanel.wifiClientInModes\'), extender: DCIC.processSref(\'controlPanel.wifiClientInModes\'), client: DCIC.processSref(\'controlPanel.wifiClientInModes\'), ap: DCIC.processSref(\'controlPanel.segments\', {tab: DCIC.l10n.homeSegment}) }[NDM.sysmode] }}" data-translate="">{{DCIC.l10n.title}}</a></div> <div class="d-main__card-container" ng-show="DCIC.showCardContent"><div class="help-text card_internet__no-connections" ng-if="!DCIC.ifaces.length">{{DCIC.l10n.noConnections}}</div> <div ng-repeat="iface in DCIC.ifaces | orderBy : \'-sortOrder\' track by iface.id" class="connection-info connection-info--active"><div ng-if="NDM.sysmode === \'router\'" class="d-main__card-content-title"><div class="d-main__card-content-title-column"><span class="d-main__card-content-title--text">{{iface.title}}</span> <span class="d-main__card-content-title--status help-text" ng-class="{ \'help-text--warning\': iface.state.color === \'red\', \'help-text--success\': iface.state.color === \'green\' && iface.isDefaultGw }"><span data-translate="">{{iface.state.text}}</span> <span>{{iface.uptimeText}}</span></span></div> <div class="d-main__card-content-title-column"><span class="d-main__card-content-title--kind help-text">{{DCIC.getIfaceKindByType(iface)}} <span ng-if="iface.pppType && (iface.type === DCIC.ISP_TYPE.WIRED || iface.type === DCIC.ISP_TYPE.DSL)">/ {{iface.pppType}}</span></span> <span class="d-main__card-content-title--reserved help-text" ng-show="DCIC.maxPriority > iface.priority" data-translate="">dashboard.card_internet.connection-reserved</span></div></div> <div ng-if="NDM.sysmode === \'router\' && iface.isDefaultGw" class="connection-info--charts"><ndm-chart header="(\'dashboard.card_internet.receive\' | translate | trust) + \': \' + (iface.stat.rxspeed | speedFormat: DCIC.lang)" name="ifaceUpstream" model="iface.chart.rx" height="150" width="350" max-y="iface.chart.maxY" anchor-left="DCIC.chart.anchorLeft" anchor-right="DCIC.chart.anchorRight" label="iface.chart.label"></ndm-chart><ndm-chart header="(\'dashboard.card_internet.transfer\' | translate | trust) + \': \' + (iface.stat.txspeed | speedFormat: DCIC.lang)" name="ifaceDownstream" model="iface.chart.tx" height="150" width="350" max-y="iface.chart.maxY" anchor-left="DCIC.chart.anchorLeft" anchor-right="DCIC.chart.anchorRight" label="iface.chart.label"></ndm-chart></div><ul ng-if="NDM.sysmode !== \'router\'" class="simple-list simple-list--small-margins"><li ng-if="iface.state.name === \'connected\'" class="simple-list__row"><span class="simple-list__label" data-translate="">dashboard.card_internet.special-modes.internet-access</span> <span class="simple-list__text">{{iface.internetStatus}}</span></li><div ng-if="NDM.sysmode === \'ap\' || NDM.sysmode === \'repeater\' || NDM.sysmode === \'extender\'"><li ng-if="iface.address" class="simple-list__row"><span class="simple-list__label" data-translate="">dashboard.card_internet.address</span> <span class="simple-list__text">{{iface.address}}</span></li><li ng-if="iface.mask" class="simple-list__row"><span class="simple-list__label" data-translate="">dashboard.card_internet.mask</span> <span class="simple-list__text">{{iface.mask}}</span></li><li ng-if="iface.gateway" class="simple-list__row"><span class="simple-list__label" data-translate="">dashboard.card_internet.gateway</span> <span class="simple-list__text">{{iface.gateway}}</span></li><li ng-if="iface.mac" class="simple-list__row"><span class="simple-list__label" data-translate="">dashboard.card_internet.mac</span> <span class="simple-list__text">{{iface.mac}}</span></li><li ng-if="iface.keendns" class="simple-list__row"><span class="simple-list__label" data-translate="">dashboard.card_internet.keendns</span><span class="simple-list__text simple-list__text--with-icon" ng-bind-html="iface.keendns"></span></li><li ng-if="iface[\'ddns-name\']" class="simple-list__row"><span class="simple-list__label" data-translate="">dashboard.card_internet.ddns-name</span> <span class="simple-list__text">{{iface[\'ddns-name\']}}</span></li><li ng-if="iface[\'ddns-state\']" class="simple-list__row"><span class="simple-list__label" data-translate="">dashboard.card_internet.ddns-state</span> <span class="simple-list__text">{{iface[\'ddns-state\']}}</span></li><li ng-if="iface.dnsServers" ng-repeat="dns in iface.dnsServers track by $index" class="simple-list__row"><span class="simple-list__label">{{ ($index === 0 ? (iface.dnsServers.length > 1 ? DCIC.l10n.dns.servers : DCIC.l10n.dns.server) : \'\') }}</span> <span class="simple-list__text">{{dns}}</span></li><li ng-if="iface[\'speed\']" class="simple-list__row"><span class="simple-list__label" data-translate="">dashboard.card_internet.special-modes.repeater.speed</span> <span class="simple-list__text">{{iface[\'speed\']}}</span></li></div><li ng-if="NDM.sysmode !== \'ap\' && iface.isConnectedToAp"><div class="special-mode-iface-primary-settings"><ul class="special-mode-iface-primary-settings__list"><li ng-repeat="prop in iface.primaryProps" class="simple-list__row"><span class="simple-list__label" data-translate="{{\'dashboard.card_internet.special-modes.repeater.\' + prop}}"></span> <span class="simple-list__text station-prop" ng-bind-html="iface[prop]"></span></li></ul></div> <div class="special-mode-iface-additional-settings"><ndm-details transclude-class="" label-hidden="dashboard.card_internet.close-info" label-visible="dashboard.card_internet.show-info"><ul class="special-mode-iface-additional-settings__list"><li ng-if="iface[prop]" ng-repeat="prop in iface.additionalProps" class="simple-list__row"><span class="simple-list__label" data-translate="{{\'dashboard.card_internet.special-modes.repeater.\' + prop}}"></span> <span class="simple-list__text station-prop" ng-bind-html="iface[prop]"></span></li></ul></ndm-details></div></li></ul><ndm-details ng-if="NDM.sysmode === \'router\'" class-name="connection-info__additional-data-toggle" toggle-var="DCIC.accordion.data[iface.id]" label-visible="dashboard.card_internet.show-info" label-hidden="dashboard.card_internet.close-info"><div class="connection-info__additional-data" ng-class="{ \'connection-info__additional-data--yota\': iface.modemType === \'YotaOne\' || iface.modemType === \'Yota\' }"><ul class="simple-list simple-list--small-margins"><li ng-repeat="propData in iface.accordionProps track by $index" class="simple-list__row simple-list__row--{{propData.name}}"><span class="simple-list__label" data-translate="{{propData.l10nKey}}"></span><span ng-if="_.isArray(propData.val)" class="simple-list__text simple-list__text--array" title="{{propData.val.join(\'\\n\')}}"><span ng-repeat="item in propData.val track by $index" ng-bind-html="item"></span></span> <span class="simple-list__single-val"><span ng-if="_.isString(propData.val)" class="simple-list__text" ng-class="{ \'simple-list__text--with-link\': propData.linkAfterText, \'simple-list__text--with-icon\': propData.hasIcon }" title="{{propData.val | trust}}" ng-bind-html="propData.val"></span><span ng-if="propData.directive" class="simple-list__text" ng-class="{ \'simple-list__text--with-link\': propData.linkAfterText, \'simple-list__text--with-icon\': propData.hasIcon }"><span add-directive="propData.directive" x-directive-attrs="{{propData.directive.options ? propData.directive.options : false}}"></span></span> <span ng-if="propData.linkAfterText" class="simple-list__link-after-text"><a class="action-link" tabindex="0" ng-class="{\'action-link--disabled\': propData.linkAfterText.isDisabled}" ng-click="propData.linkAfterText.callback(iface, propData.linkAfterText)" data-translate="">{{propData.linkAfterText.text}}</a></span></span></li><li ng-if="iface.dnsServers" ng-repeat="dns in iface.dnsServers track by $index" class="simple-list__row"><span class="simple-list__label"><a href="" ng-click="DCIC.goToDnsSettings(iface)" class="ref-link">{{ ($index === 0 ? (iface.dnsServers.length > 1 ? DCIC.l10n.dns.servers : DCIC.l10n.dns.server) : \'\') }}</a></span> <span class="simple-list__text">{{dns}}</span></li></ul></div></ndm-details></div></div></div>'),e.put("app/page/dashboard/card_segments.html",'<div ng-controller="DashboardCardSegmentsController as DCSC"><div ng-if="!DCSC.showCardContent" class="d-main__card card_segment"><div class="d-main__card-header"><div class="d-main__card-title" data-translate="">dashboard.card_segments.segments</div></div></div><ndm-alert class="access-point-info-alert printable" is-visible="DCSC.connectionInfoAlert.isVisible" hide="DCSC.connectionInfoAlert.hide()" no-top-shift="true" label="{{DCSC.connectionInfoAlert.title}}" close-on-esc="true" close-on-click-outside="true"><div ng-if="DCSC.connectionInfoAlert.isVisible" ndm-polling="DCSC.connectionInfoAlert.wps.checkStatus" ndm-interval="1000"></div><canvas ng-if="DCSC.customLogo.isEnabled" ng-show="DCSC.customLogo.isUpload" id="customLogo" width="300px" height="100px"></canvas><div ng-show="DCSC.customLogo.isUpload" class="access-point-info-alert__plus-sign for-print-only"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" x="0" y="0" viewbox="0 0 40 40"><line x1="20" y1="0" x2="20" y2="40" stroke-width="1" stroke="black"></line><line x1="0" y1="20" x2="40" y2="20" stroke-width="1" stroke="black"></line></svg></div> <div class="access-point-info-alert__logo for-print-only"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" x="0" y="0" viewbox="0 0 422.6 41.8" xml:space="preserve"><style>\n                    .st0 {\n                        fill: #1d1d1b\n                    }\n                </style><path class="st0" d="M58.2.5v40.9H109v-8.7H67.4v-7.4h41.4v-8.7H67.4V9.1H109V.5zM116.2.5v40.9h50.7v-8.7h-41.6v-7.4h41.4v-8.7h-41.4V9.1h41.6V.5zM232.1.5v40.9h50.7v-8.7h-41.6v-7.4h41.4v-8.7h-41.4V9.1h41.6V.5zM289.7.5v8.6H310v32.3h9.1V9.1h20.4V.5zM346.4.5h9.2v40.9h-9.2zM215.7.5v28.9L183.3.5h-9.2v40.9h9.2V12.5l32.4 28.9h9.1V.5zM33.4 17.1L51 .5H37L20.8 16.3H9.2V.5H0v40.9h9.2V25.5h16.2c6.8 0 11.5 1.5 14 4.4 1.5 1.7 2.2 4 2.2 6.9v4.6h9.2v-4.6c0-5-1.5-9.4-4.4-12.8-3.1-3.5-7.4-5.9-13-6.9M407 27.6l-.3.3c-2.9 3.1-8.5 5.2-16.3 5.2-7.3 0-12.7-1.8-15.7-4.6l-.6-.6c-1.6-1.8-2.5-4.1-2.5-7s.8-5.2 2.5-7l.6-.6c3-2.7 8.4-4.6 15.7-4.6 7.8 0 13.4 2.1 16.3 5.2.1.1.2.2.2.3l8.4-4.1c-.6-.9-1.2-1.7-1.9-2.5-4.7-5-12.4-7.6-23-7.6s-18.3 2.6-23.1 7.7c-3.2 3.5-5 8.1-5 13.3 0 5.2 1.7 9.8 5 13.3 4.7 5.1 12.5 7.7 23.1 7.7 10.6 0 18.3-2.6 23.1-7.7.7-.8 1.3-1.6 1.9-2.5l-8.4-4.2z"></path></svg></div><ndm-text text="dashboard.card_segments.wifi.connection-info.qr-code-description"></ndm-text><canvas id="access-point_qr" class="access-point-info-alert__qr-code"></canvas><div class="access-point-info-alert__connection-info"><div class="access-point-info-alert__text-row"><span class="access-point-info-alert__text-label">{{\'wifi-settings.form.ssid\' | translate}}:&nbsp;</span> <span class="access-point-info-alert__text-bold">{{DCSC.connectionInfoAlert.model.ssid}}</span></div> <div class="access-point-info-alert__text-row"><span ng-if="DCSC.connectionInfoAlert.model.passkey" class="access-point-info-alert__text-label">{{\'wifi-settings.form.psk.label\' | translate}}:&nbsp;</span> <span class="access-point-info-alert__text-bold">{{DCSC.connectionInfoAlert.model.passkey}}</span></div> <div class="access-point-info-alert__text-row"><span ng-if="!DCSC.connectionInfoAlert.model.passkey" data-translate="">dashboard.card_segments.wifi.no-password</span></div></div> <div class="access-point-info-alert__buttons not-printable buttons-row buttons-row--stretch"><ndm-button class="buttons-row__btn-wrapper not-printable" btn-class="access-point-info-alert__btn" is-disabled="!DCSC.connectionInfoAlert.model.passkey" on-click="DCSC.connectionInfoAlert.copyPskToClipboard" label="dashboard.card_segments.wifi.connection-info.copy-psk-to-clipboard"></ndm-button><ndm-button class="buttons-row__btn-wrapper not-printable" btn-class="access-point-info-alert__btn" ng-click="Dashboard.qrCodePrint()" label="dashboard.card_segments.wifi.connection-info.alert-print"></ndm-button><ndm-input-file class="btn--file-upload not-printable" ng-if="DCSC.customLogo.isEnabled" upload-file="DCSC.customLogo.upload" on-upload-file="DCSC.customLogo.change(DCSC.customLogo.upload)" btn-title="{{DCSC.l10n.addLogoBtn}}"></ndm-input-file></div> <div class="access-point-info-alert__wps"><ndm-button class="access-point-info-alert__wps-toggle-btn-wrapper not-printable" btn-class="access-point-info-alert__wps-toggle-btn" is-disabled="!DCSC.connectionInfoAlert.model.passkey || DCSC.connectionInfoAlert.model.wpsDisabled || DCSC.connectionInfoAlert.wps.requestIsInProgress || !DCSC.connectionInfoAlert.model.up || DCSC.connectionInfoAlert.model.isDisabledOnSchedule" on-click="DCSC.connectionInfoAlert.wps.toggleState" label="{{\'dashboard.card_segments.wifi.\' + (DCSC.connectionInfoAlert.wps.isInProgress ? \'stop-wps\' : \'start-wps\')}}"></ndm-button><div ng-if="DCSC.connectionInfoAlert.model.wpsDisabled" class="access-point-info-alert__wps-disabled-msg not-printable" ndm-html-compile="DCSC.connectionInfoAlert.wps.disabledMsg"></div><div ng-if="DCSC.connectionInfoAlert.wps.isInProgress"><div class="access-point-info-alert__wps-session-time">{{DCSC.connectionInfoAlert.wps.timeStr}}</div><ndm-progress-bar is-visible="true" count="DCSC.connectionInfoAlert.wps.progress" is-count-hidden="true"></ndm-progress-bar></div></div></ndm-alert><div ng-if="NDM.sysmode !== \'client\' && DCSC.showCardContent" class="d-main__card card_segment" ng-class="{\'card_segment--expanded\': DCSC.cardExpanded}" ng-repeat="(segmentId, segment) in DCSC.segments"><div class="d-main__card-header"><div class="d-main__card-header__title-wrapper" ng-class="{\'d-main__card-header__title-wrapper--wide\': !(segment.accessPoints.length && !segment.wifi.isHeaderHidden)}"><a class="d-main__card-title segment__title" ui-sref="{{\'controlPanel.segments({tab: segment.title})\'}}" data-translate="">{{segment.title}}</a></div></div> <div class="d-main__card-container"><div class="wi-fi"><div ng-if="segment.accessPoints.length" class="d-main__card-content"><div ng-repeat="iface in segment.accessPoints track by $index" class="segment-access-point"><div class="segment-access-point__state" ng-class="{ \'segment-access-point__state--disabled-on-schedule\': iface.isDisabledOnSchedule }" ng-attr-title="{{(iface.isDisabledOnSchedule ? \'interface-state.down-on-schedule\' : \'\') | translate}}"><ndm-toggle ndm-disabled-by-mws-tooltip="" class="segment-access-point__toggle" label-on="" label-off="" model="iface.up" name="{{segmentId + \'__\' + iface.id}}" on-change="DCSC.wifi.toggleApState(segmentId, iface.id, !iface.up)" disabled="DCSC.toggledApIfaces[iface.ap] || DCSC.wifi.isTurnedOff || !DCSC.hostsDataLoaded || NDM.DEVICE_IS_MWS_MEMBER"></ndm-toggle><div class="segment-access-point__status"><div ng-attr-title="{{iface.ssid + iface.channelL10n}}" class="segment-access-point__ssid">{{iface.ssid}}</div> <div class="segment-access-point__band"><span>{{iface.range}}&nbsp;{{\'unit.ghz\' | translate}}{{iface.channel ? \',\'+iface.channelL10n : \'\'}}</span> <div ng-if="iface.isDFSChannel" class="segment-access-point__DFS"><div class="segment-access-point__DFS__badge">DFS</div> <div ng-if="iface.radarStatus" class="segment-access-point__DFS__status"><span ndm-html-compile="DCSC.l10n.wifiDisabledWarning"></span> | {{iface.radarStatus}}</div></div></div> <span ng-if="!DCSC.wifi.isTurnedOff && iface.isDisabledOnSchedule" class="help-text" data-translate="">interface-state.down-on-schedule</span></div></div><div class="segment-access-point__connection-info"><div ng-if="DCSC.wifi.isTurnedOff" class="segment-access-point__hwstate-off" data-translate="">dashboard.card_segments.wifi.wifi-disabled-by-button</div> <div ng-if="!DCSC.wifi.isTurnedOff"><ndm-button class="segment-access-point__open-info-alert-btn" ng-click="DCSC.connectionInfoAlert.show(iface)" label="dashboard.card_segments.wifi.connection-info.link-name"></ndm-button></div></div></div></div> <div ng-if="NDM.sysmode !== \'repeater\' && !segment.accessPoints.length" class="help-text" data-translate="">dashboard.card_segments.wifi.no-access-points-included</div></div> <div ng-if="NDM.sysmode !== \'ap\' || (NDM.sysmode === \'ap\' && segment.accessPoints.length)" class="segment"><div class="segment__devices-title tretiary-title" ng-if="segment.title && (NDM.sysmode === \'router\' || NDM.sysmode === \'ap\')" data-translate="">{{DCSC.l10n.title}}</div> <div class="segment__devices-type" ng-if="NDM.sysmode === \'router\'"><div class="segment__devices-type--picture segment__devices-type--picture--{{segment.color}}"><a tabindex="-1" ndm-sref="devicesList"><i class="icon">{{segment.hosts.wired.total}}</i> <i class="segment__devices-type--badge" ng-if="segment.hosts.wired.unreg">{{segment.hosts.wired.unreg}}</i></a></div> <div class="segment__devices-type--description" data-translate="">dashboard.card_segments.hosts.wired</div></div> <div class="segment__devices-type" ng-if="DCSC.wifiIsAvailable"><div class="segment__devices-type--picture segment__devices-type--picture--{{segment.color}}"><a tabindex="-1" ndm-sref="{{NDM.sysmode === \'router\' ? \'devicesList\' : \'wifiClients\'}}"><i class="icon">{{segment.hosts.wifi.total}}</i> <i class="segment__devices-type--badge" ng-if="segment.hosts.wifi.unreg">{{segment.hosts.wifi.unreg}}</i></a></div> <div class="segment__devices-type--description">Wi-Fi</div></div></div></div></div></div>'),e.put("app/page/dashboard/card_switchports.html",'<div class="d-main__card" id="card_switchports" ng-controller="DashboardCardSwitchportsController as DCSW"><div class="d-main__card-header"><a ui-sref="{{ { router: \'controlPanel.segments\', repeater: \'controlPanel.system\', extender: \'controlPanel.system\', client: \'controlPanel.system\', ap: \'controlPanel.segments\' }[NDM.sysmode] }}" class="d-main__card-title" data-translate="">dashboard.card_switchports.title</a></div> <div class="d-main__card-container" ng-show="DCSW.showCardContent"><ndm-switchport-container><ndm-switchport ng-repeat="port in DCSW.switchports track by $index" label="port.name" role="port.icon" is-combo="port.isCombo" is-sfp-active="port.isSfpActive" is-sfp="port.isSfp" is-reversed="port.isReversed" is-blue="port.isBlue"><div class="switchport-state"><div>{{port.duplex}}</div> <div>{{port.speed}}</div></div></ndm-switchport></ndm-switchport-container></div></div>'),e.put("app/page/dashboard/card_system.html",'<div class="d-main__card" id="card_system" ng-controller="DashboardCardSystemController as DCSC"><div class="d-main__card-header"><a ui-sref="controlPanel.system" class="d-main__card-title" data-translate="">dashboard.card_system.title</a></div> <div class="d-main__card-container" ng-show="DCSC.showCardContent"><ul class="simple-list"><li class="simple-list__row"><span class="simple-list__label" data-translate="dashboard.card_system.model"></span> <span class="simple-list__text">{{::DCSC.model}}</span></li><li class="simple-list__row" ng-if="DCSC.systemMode !== \'router\'"><span class="simple-list__label" data-translate="dashboard.card_system.system_mode"></span> <span class="simple-list__text" data-translate="">{{::(\'dashboard.card_system.\' + DCSC.systemMode)}}</span></li><li class="simple-list__row"><span class="simple-list__label" data-translate="dashboard.card_system.serviceTag"></span> <span class="simple-list__text">{{::DCSC.serviceTag}}</span></li><li class="simple-list__row"><span class="simple-list__label" data-translate="dashboard.card_system.osVersion"></span> <span class="simple-list__text simple-list__text--fw-info">{{::DCSC.osVersion}} <div ng-if="DCSC.updateAvailable" class="firmware-update-info"><a class="ref-link" ui-sref="controlPanel.system" title="{{DCSC.l10n.newVersion}}" data-translate="">dashboard.card_system.updateAvailable</a><ndm-webhelp-release-notes ndm-version="DCSC.updateVersion" wrap-in-brackets="true"></ndm-webhelp-release-notes></div></span></li><li ng-if="::DCSC.canAutoUpdateFw" class="simple-list__row"><span class="simple-list__label" data-translate="dashboard.card_system.auto-update.label"></span> <span class="simple-list__text" data-translate="">{{\'dashboard.card_system.auto-update.\' + (DCSC.fwAutoUpdateIsEnabled ? \'enabled\' : \'disabled\')}}</span></li><li class="simple-list__row"><span class="simple-list__label" data-translate="dashboard.card_system.upTime"></span> <span class="simple-list__text">{{DCSC.upTime}}</span></li><li ng-if="DCSC.currentTime" class="simple-list__row"><span class="simple-list__label" data-translate="dashboard.card_system.currentTime"></span> <span class="simple-list__text">{{DCSC.currentTime}}</span></li><li ng-if="DCSC.cpuLoad" class="simple-list__row"><span class="simple-list__label" data-translate="dashboard.card_system.cpuLoad"></span> <span class="simple-list__text">{{DCSC.cpuLoad}}</span></li><li ng-if="DCSC.memLoad" class="simple-list__row"><span class="simple-list__label" data-translate="dashboard.card_system.memLoad"></span> <span class="simple-list__text">{{DCSC.memLoad}}</span></li></ul></div></div>'),e.put("app/page/dashboard/card_usb.html",'<div class="d-main__card" id="card_usb" ng-controller="DashboardCardUSBController as DCUC" ng-show="DCUC.showCard"><div class="d-main__card-header"><a ui-sref="controlPanel.apps" class="d-main__card-title" data-translate="">dashboard.card_usb.title</a></div> <div class="d-main__card-container" ng-show="DCUC.showCardContent"><div ng-if="!DCUC.usbPrinters.length && !DCUC.storageDevicesAmount" class="body-text" data-translate="">dashboard.card_usb.no-devices</div> <div class="icon-dashboard icon-dashboard--inline" ng-if="DCUC.usbPrinters.length || DCUC.storageDevicesAmount"><div ng-repeat="device in DCUC.usbPrinters track by $index" class="icon-dashboard__group"><div class="icon-dashboard__item icon-dashboard__item--printer"><a tabindex="-1" class="icon-dashboard__item-link" ng-click="DCUC.goToPrinter(device.id)"><i class="icon-dashboard__item-icon icon icon--usbPrinter"></i></a> <i ng-if="!device.link" class="icon-dashboard__item-icon icon icon--usbPrinter"></i></div> <div class="icon-dashboard__desc">{{device.title}} <div ng-if="device.status" class="help-text device-status--{{device.status.status}}" data-translate="">{{device.status.text || device.status}}</div></div></div> <div ng-repeat="device in DCUC.storages track by $index" class="icon-dashboard__group"><div class="icon-dashboard__item icon-dashboard__item--storage"><a ng-click="device.goToBrowser && device.goToBrowser()"><i class="icon-dashboard__item-icon icon icon--usbDrive"></i></a></div> <div class="icon-dashboard__desc"><div class="icon-dashboard__eject-section"><div class="icon-dashboard__name"><div class="icon-dashboard__name--title">{{ device.fullName }}</div> <div ng-if="device.index" class="icon-dashboard__name--index">{{ device.index }}</div></div> <div class="icon-dashboard__eject-wrapper"><div ng-if="device.state === \'EJECTING\' || DCUC.ejectList.indexOf(device.id) >= 0" class="icon-dashboard__ejecting" title="{{\'dashboard.card_usb.safe-eject-process\' | translate}}"></div> <div class="icon-dashboard__eject-icon" ng-if="device.state !== \'EJECTING\' && DCUC.ejectList.indexOf(device.id) < 0" ng-click="DCUC.safeEject(device)" title="{{\'dashboard.card_usb.safe-eject\' | translate}}"></div></div></div> <div ng-if="$index === 0 || DCUC.storageState[device.id]" ng-repeat="partition in device.partitions | orderBy: \'dirty\' track by $index" class="icon-dashboard__item-partitions usb-device-partition"><div class="usb-device-partition__name">{{!DCUC.storageState[device.id] ? device.title : partition.name}}</div> <div class="meter meter--rounded" ng-class="{ \'meter--error\': (DCUC.storageState[device.id] && partition.dirty) || (!DCUC.storageState[device.id] && device.dirty) }"><span class="meter__level" style="width: {{100 - (DCUC.storageState[device.id] ? (partition.free / partition.total) : (device.free / device.total)) * 100}}%"></span></div> <div>{{DCUC.storageState[device.id] ? partition.sizeData : device.sizeData}}</div> <div ng-if="(DCUC.storageState[device.id] || device.length < 2) && partition.dirty" class="card-usb-storage-error" data-translate="">usb-device-list.storage-status.dirty</div></div><p ng-if="device.partitions.length > 1 && !DCUC.storageState[device.id]" class="storage-state-toggle"><a tabindex="0" class="accordion-link" ng-keydown="DCUC.onKeydown($event, device.id)" ng-click="DCUC.storageState.__toggle(device.id)" data-translate="">usb-device-list.expand</a> ({{device.partitions.length}})</p><p ng-if="device.partitions.length > 1 && DCUC.storageState[device.id]" class="storage-state-toggle"><a tabindex="0" class="accordion-link accordion-link--expanded" ng-keydown="DCUC.onKeydown($event, device.id)" ng-click="DCUC.storageState.__toggle(device.id)" data-translate="">usb-device-list.collapse</a></p></div></div></div></div></div>'),e.put("app/page/dashboard/card_wifi.html",'<div class="d-main__card" id="card_wifi" ng-controller="DashboardCardWifiController as DCWC"><div class="d-main__card-header"><a ndm-sref="controlPanel.wifi2" class="d-main__card-title" data-translate="">dashboard.card_wifi.title</a> <span class="d-main__card-header-info help-text" ng-if="DCWC.wifi2exists || DCWC.wifi5exists" ng-show="!DCWC.wifiTurnOff"><a tabindex="{{DCWC.mode.current === \'WPS\' ? 0 : -1}}" ng-keydown="DCWC.onKeydown($event, \'password\')" ng-click="DCWC.mode.toggle(\'password\')" ng-class="{\'accordion-link\': DCWC.mode.current === \'WPS\'}" data-translate="">dashboard.card_wifi.password</a> | <a tabindex="{{DCWC.mode.current === \'password\' ? 0 : -1}}" ng-keydown="DCWC.onKeydown($event, \'WPS\')" ng-click="DCWC.mode.toggle(\'WPS\')" ng-class="{\'accordion-link\': DCWC.mode.current === \'password\'}">WPS</a> <ndm-help><p data-translate="">dashboard.card_wifi.wps-hint</p></ndm-help></span></div> <div class="d-main__card-container" ng-show="DCWC.showCardContent"><div ng-if="DCWC.wifiTurnOff" class="d-main__card-content"><span class="help-text" data-translate="">dashboard.card_wifi.wifi-disabled-by-button</span></div> <div ng-if="!DCWC.wifiTurnOff" ng-repeat="(range, aPoints) in DCWC.accessPoints" class="d-main__card-content"><table class="table body-text"><tbody><tr ng-repeat="iface in aPoints"><td class="toggle-column"><ndm-toggle ndm-disabled-by-mws-tooltip="" label-on="" label-off="" model="iface.up" name="{{iface.ap}}" call-on-change="DCWC.toggleApState" disabled="DCSC.toggledApIfaces[iface.ap] || !DCWC.dataLoaded || NDM.DEVICE_IS_MWS_MEMBER" description=""></ndm-toggle></td><td class="ssid-column"><div class="toggle-text">{{::iface.ssid}}<br><span class="help-text">{{::iface.range}}</span> <span class="help-text" data-translate="">unit.ghz</span></div></td><td ng-if="DCWC.mode.current === \'password\'" class="password-column"><div ng-if="iface.passwordShown" class="password_text_container"><span>{{::iface.password}}</span> <a tabindex="0" class="accordion-link" ng-keydown="$event.keyCode === 32 && DCWC.togglePassword(iface)" ng-click="DCWC.togglePassword(iface)" data-translate="">dashboard.card_wifi.hide</a></div> <div ng-hide="!iface.password || iface.passwordShown" class="password_text_container"><a tabindex="0" class="accordion-link" ng-keydown="$event.keyCode === 32 && DCWC.togglePassword(iface)" ng-click="DCWC.togglePassword(iface)" data-translate="">dashboard.card_wifi.show-password</a></div> <div ng-hide="iface.password" class="password_text_container"><span class="help-text" data-translate="">dashboard.card_wifi.no-password</span></div></td><td ng-if="iface.up && DCWC.mode.current === \'WPS\'" class="password-column"><div ng-hide="iface.password" class="password_text_container"><span class="help-text" data-translate="">dashboard.card_wifi.no-password</span></div> <div class="wrapper" ng-if="iface.password" ng-disabled="iface.wpsProgress"><div class="password-button" ng-click="DCWC.startWPS(iface)" ng-if="!iface.wpsProgress && iface.password"><span data-translate="">dashboard.card_wifi.start-wps</span></div> <div id="wpsButton-{{::iface.rename}}" class="password-button-dynamic no-animate" ng-if="iface.up" ng-class="{ \'hidden\': !iface.up, \'in-progress\': iface.wpsProgress > 0, \'is-over\': iface.wpsProgress > 99 }"><div ng-if="iface.wpsProgress && iface.wpsProgress < 100" class="password-button-dynamic_content nopointer"><span data-translate="">dashboard.card_wifi.connection</span></div> <div ng-if="iface.wpsProgress === 100" class="password-button-dynamic_content nopointer"><span data-translate="">dashboard.card_wifi.theend</span></div></div></div></td><td ng-if="!iface.up && DCWC.mode.current === \'WPS\'" class="password-column"><div ng-hide="iface.password" class="password_text_container"><span class="help-text" data-translate="">dashboard.card_wifi.no-password</span></div> <div ng-show="iface.password" ng-disabled="!iface.up || iface.wpsProgress" class="wrapper"><div ng-if="!iface.up || !iface.wpsProgress && iface.password" ng-class="{disabled: !iface.up}" class="password-button"><span data-translate="">dashboard.card_wifi.start-wps</span></div></div></td></tr></tbody></table></div></div></div>'),e.put("app/page/dashboard/dashboard.html",'<div class="d-dashboard" ng-class="{ \'d-dashboard--mws-member\': $root.NDM.DEVICE_IS_MWS_MEMBER, \'d-dashboard--no-scroll\': $root.menuIsOpenOverlayed || $root.uiViewOverlap }" init-scroll=""><div ndm-polling="Dashboard.getMwsData"></div> <div class="d-dashboard__container"><ndm-notifications-container class="d-dashboard__notifications-container"></ndm-notifications-container><ndm-feature-notice ng-if="Dashboard.marketingFeaturesAreReady && Dashboard.marketingFeatures.length > 0" features="Dashboard.marketingFeatures"></ndm-feature-notice><div class="d-main d-main--loading"><div class="d-main__column" ng-repeat="column in [1, 2]"><div ng-repeat="(key, card) in Dashboard.cards" ng-if="card.column === column" ng-include="card.template"></div></div></div> <div class="d-footer-container"><div class="d-footer"><div class="d-footer__fast-links"><section class="d-footer__app-stores"><a href="https://keenetic.com/getapp?ios.next&from=web{{Dashboard.appLinkArgs}}" class="as" target="_blank"><img ng-src="{{Dashboard.appleStoreLogo}}" alt=""></a> <a href="https://keenetic.com/getapp?android.next&from=web{{Dashboard.appLinkArgs}}" class="pm" target="_blank"><img ng-src="{{Dashboard.googlePlayLogo}}" alt=""></a></section></div></div></div></div></div>'),e.put("app/page/login/login.html",'<section class="login-page" init-scroll=""><div class="login-page__content-wrapper"><div class="login-page__popup__container"><div class="login-page__popup" ng-if="Login.isPopupVisible && Login.isRebooting"><div class="login-page__popup__content"><div class="login-page__popup__close" ng-click="Login.close()">×</div><p class="login-page__popup__content__message">{{\'login.reboot-message\' | translate}}</p><div class="login-page__popup__content__loading__container"><div class="login-page__popup__content__loading"></div></div></div></div></div><section class="login-header"><div class="login-header__content"><div class="login-header__helpcenter"><a class="login-header__helpcenter-link" ng-href="{{$root.helpCenterLink}}" title="{{ \'login.footer.link-support\' | translate }}" target="_blank"><ndm-svg-icon class="login-header__helpcenter-svg" svg-id="help"></ndm-svg-icon></a></div> <div class="login-header__lodge-bar"><span class="login-header__logo">Keenetic</span> <span class="login-header__model"><span class-name="login-header__model-name" ng-attr-title="{{::Login.constants.deviceModel}}">{{::Login.constants.deviceModelForLogo}}</span></span></div> <div class="login-header__language-dropdown-container"><ndm-selectbox class="login-header__language-dropdown" name="language" on-change="Login.languages.change()" value="Login.languages.current" options="Login.languages.list"></ndm-selectbox></div></div></section><section class="login-content"><div class="login-content__title" data-translate="">login.title</div><form name="Login.form" class="login-form" method="POST" autocomplete="on" ng-submit="Login.startLogin()"><div class="login-form__input"><div class="login-form__input-wrapper"><div class="login-form__icon-wrapper" ng-class="{ \'login-form__icon-wrapper--focus\': Login.inFocus.login, \'login-form__icon-wrapper--error\': Login.error.login }"><ndm-svg-icon width="16" height="16" class="login-form__login-icon" svg-id="user"></ndm-svg-icon></div> <div class="login-form__input-separator">&nbsp;</div><ndm-input class="login-form__login" ng-class="{ \'login-form__login--invalid\': Login.error.login }" name="loginLogin" model="Login.data.login" set-focus="true" on-focus-toggle="Login.onFocusToggle" on-validation-end="Login.onValidationEnd" on-press-enter="Login.startLogin()" validation="login" autocomplete-name="\'username\'" model-options="{debounce: 30}" animated-placeholder="{{ Login.error.login || Login.l10n.loginFieldName }}"></ndm-input></div></div> <div class="login-form__input"><div class="login-form__input-wrapper"><div class="login-form__icon-wrapper" ng-class="{ \'login-form__icon-wrapper--focus\': Login.inFocus.password, \'login-form__icon-wrapper--error\': Login.error.password }"><ndm-svg-icon class="login-form__password-icon" width="16" height="19" svg-id="{{ Login.error.password ? \'password-invalid-icon\' : \'password-icon\' }}"></ndm-svg-icon></div> <div class="login-form__input-separator">&nbsp;</div><ndm-input name="loginPassword" class="login-form__password" ng-class="{ \'login-form__password--invalid\': Login.error.password }" model="Login.data.password" password="true" on-focus-toggle="Login.onFocusToggle" on-validation-end="Login.onValidationEnd" validation="password" is-autofill-enabled="true" autocomplete-name="\'password\'" model-options="{debounce: 30}" animated-placeholder="{{ Login.error.password || Login.l10n.passwordFieldName }}"></ndm-input></div></div><ndm-button class="login-form__button" btn-class="btn--cute" button-type="submit" label="login.form.login-button"></ndm-button></form></section><section class="login-footer"><ndm-details class="login-footer__can-not-login-link" label-fn="Login.help.getLabel" toggle-var="Login.help.isVisible"><div data-translate="">login.help.help-text</div></ndm-details><div class="login-footer__app-icons"><a class="login-footer__app-link" href="https://keenetic.com/getapp?ios.next&from=web" target="_blank"><ndm-svg-icon svg-id="apple-logo"></ndm-svg-icon></a> <a class="login-footer__app-link" href="https://keenetic.com/getapp?android.next&from=web" target="_blank"><ndm-svg-icon svg-id="android-logo"></ndm-svg-icon></a></div> <a ng-href="{{Login.policyLink}}" class="login-footer__terms-of-use" data-translate="">login.footer.terms-of-use</a></section></div></section>'),e.put("app/page/not-supported-browser/not-supported-browser.html",'<div class="not-supported-browser-wrapper"><div class="not-supported-browser"><section class="not-supported-browser-header"><div class="not-supported-browser-header__content"><div class="not-supported-browser-header__helpcenter"><a class="not-supported-browser-header__helpcenter-link" ng-href="{{$root.helpCenterLink}}" title="{{ \'login.footer.link-support\' | translate }}" target="_blank"><i class="icon icon--help"></i></a></div> <div class="not-supported-browser-header__lodge-bar"><div class="not-supported-browser-header__logo-wrapper" ng-include="\'app/page/not-supported-browser/icons/logo.svg\'"></div></div> <div class="not-supported-browser-header__language-dropdown-container"><ndm-selectbox class="not-supported-browser-header__language-dropdown" name="language" on-change="vm.languages.change()" value="vm.languages.current" options="vm.languages.list"></ndm-selectbox></div></div></section><div class="not-supported-browser__main-text"><h1 class="not-supported-browser__main-text-title" data-translate="">not-supported-browser.header</h1><div class="not-supported-browser__main-text-description" data-translate="">not-supported-browser.top-text</div></div> <div class="not-supported-browser__alternatives"><div ng-repeat="browser in vm.alternativeBrowsers track by $index" class="alternative-browser"><a href="{{browser.link}}" title="{{browser.title}}"><div class="alternative-browser__icon"><div ng-include="browser.icon"></div></div> <div class="alternative-browser__title">{{browser.title}}</div></a></div></div></div></div>'),e.put("app/components/ndm-fs/ndm-fs-browser/fsBrowser.html",'<ndm-popup class="fs-browser" is-visible="::true" header-title="{{( vm.mode.title || (vm.mode.folderSelect || vm.mode.fileSelect) ? \'fs-browser.title.\' + (vm.mode.fileSelect ? \'file\' : \'folder\') + \'-select\' : \'fs-browser.title.browser\' | translate )}}" close="::vm.close"><ndm-fs-toolbar buttons="vm.toolbar"></ndm-fs-toolbar><div ng-class="{\'fs-browser__column--fullsize\': !(vm.permissions.modified || vm.mode.folderSelect || vm.mode.fileSelect)}" class="fs-browser__column"><div class="fs-browser__column-left"><ndm-fs-tree scroll-glue="" media-id="::vm.mode.mediaId" media-partitions="::vm.mode.mediaPartitions" removable-only="vm.mode.removableOnly" hide-root-files="true" folders-only="vm.mode.folderSelect" single-volume="::vm.mode.volume" api-link="::vm.tree" selected-path="::vm.mode.selectedPath" on-active-volume-disconnect="vm.mode.volume && vm.close()" on-select="::vm.onNodeSelect"></ndm-fs-tree></div><div class="fs-browser__column-right" ng-class="{\'fs-browser__column-right--open\': vm.mode.twoColumns}"><ndm-fs-permissions api-link="::vm.permissions"></ndm-fs-permissions></div></div><ndm-alert class="fs-browser__mkdir fs-browser__mkdir-popup" is-visible="::true" ng-if="vm.mkdir.visible" hide="vm.mkdir.close()" label="fs-browser.mkdir.title" sub-title="fs-browser.mkdir.description"><form autocomplete="off" name="vm.mkdir.form" novalidate=""><ndm-input error="vm.mkdir.error" on-change="vm.mkdir.validate" on-press-enter="vm.mkdir.ok()" on-press-esc="vm.mkdir.close()" model="vm.mkdir.name" disabled="vm.mkdir.isLocked"></ndm-input></form><ndm-button btn-class="btn--primary" button-name="ok" is-disabled="vm.mkdir.error || !vm.mkdir.name.length || vm.mkdir.isLocked" on-click="vm.mkdir.ok" label="ok"></ndm-button><ndm-button button-name="cancel" on-click="vm.mkdir.close" is-disabled="vm.mkdir.isLocked" label="cancel"></ndm-button></ndm-alert><input ng-init="vm.observeFileUploadInput()" id="{{vm.UPLOAD_ELEMENT_ID}}" type="file" ng-cloak="" multiple=""><ndm-control-footer ng-if="vm.permissions.modified" prefix="fsBrowser" is-visible="vm.permissions.modified" is-popup="true" save="vm.permissions.save()" cancel="vm.permissions.cancel()"></ndm-control-footer><ndm-control-footer ng-if="!vm.permissions.modified && (vm.mode.folderSelect || vm.mode.fileSelect)" prefix="fsBrowser" is-visible="1" is-popup="true" is-save-disabled="!vm.node.path || (!!vm.mode.folderSelect !== !!vm.node.isDir)" save-label="select" cancel-label="cancel" save="vm.selectFolder()" cancel="vm.close()"></ndm-control-footer></ndm-popup>'),e.put("app/components/ndm-fs/ndm-fs-permissions/ndm-fs-permissions.html",'<div class="ndm-fs-permissions"><div class="fs-browser__header"><span class="fs-browser__header_folder" data-translate="">fs-browser.headers.rights</span></div> <div ng-repeat="row in vm.data | orderBy: [\'-exists\', \'uid\']" ng-class="{ \'ndm-fs-permissions__row\': true, \'ndm-fs-permissions__row--loading\': vm.loading, \'ndm-fs-permissions__row--lost-user\': !row.exists, \'ndm-fs-permissions__row--lost-user--editing\': !row.exists && vm.lostUser.uid === row.uid }"><div class="ndm-fs-permissions__cell-user"><div>{{row.uid}}</div></div> <div ng-if="!vm.loading" class="ndm-fs-permissions__cell-ctrl"><ndm-selectbox ng-if="::(!row.forbidden && row.exists)" bs-modifiable="0" name="user__{{::row.uid}}" view-as-link="true" value="row.modified" on-change="::vm.onAccessChanged()" options="::vm.optionsListByUsers[row.uid]"></ndm-selectbox><div ng-if="row.forbidden && row.exists" data-translate="">fs-permissions.folder-banned</div> <div ng-if="::!row.exists" class="ndm-fs-permissions__cell-ctrl__lost-user" data-translate=""><div class="ndm-fs-permissions__cell-ctrl__lost-user__description" ng-if="vm.lostUser.uid !== row.uid" ng-click="::vm.lostUser.onDescriptionClicked($event, row.uid)" ng-bind-html="::vm.lostUser.getDescriptionHtml()"></div> <div ng-if="vm.lostUser.uid && vm.lostUser.uid === row.uid"><ndm-input name="lost-user-password" placeholder="{{\'fs-permissions.lost-user-password-placeholder\' | translate}}" model="vm.lostUser.password"></ndm-input></div></div></div> <div class="ndm-fs-permissions__cell-ctrl__lost-user__cp" ng-if="vm.lostUser.uid && vm.lostUser.uid === row.uid"><ndm-button btn-name="userAdd-saveBtn" btn-class="ndm-control-footer__controls__save btn--primary" is-disabled="!vm.lostUser.password" on-click="vm.lostUser.save" label="add"></ndm-button><a tabindex="0" class="ndm-control-footer__controls__cancel action-link" name="userAdd-cancelBtn" ng-click="vm.lostUser.cancel()" data-translate="">cancel</a></div></div><form><input type="hidden" ng-model="vm.modified"></form></div>'),e.put("app/components/ndm-fs/ndm-fs-select/ndm-fs-select-modal.html",'<ndm-popup class="ndm-fs-select-popup" is-visible="true" header-title="{{ (vm.options.title || (vm.options.selectFolder ? \'fs-select.title-folder-select\' : \'fs-select.title-file-select\') ) | translate }}" close="::vm.cancel"><ndm-text text="{{vm.options.description}}"></ndm-text><div ng-show="vm.tree.foldersCount"><div class="ndm-fs-select-popup__header"><div class="ndm-fs-select-popup__header__tree" data-translate="">fs-select.header-folder</div> <div class="ndm-fs-select-popup__header__filename" data-translate="">fs-select.header-filename</div> <div class="ndm-fs-select-popup__header__filesize" data-translate="">fs-select.header-filesize</div></div><div class="ndm-fs-select-popup__struct"><div class="ndm-fs-select-popup__struct__column-tree"><ndm-fs-tree removable-only="vm.options.removableOnly" selected-path="vm.selectedPath" tree-buffer-link="vm.tree" on-select="vm.onFolderSelect"></ndm-fs-tree></div> <div class="ndm-fs-select-popup__struct__column-folder"><div ng-repeat="child in vm.node.children | orderBy: [\'name\']" id="file--{{child.path}}" ng-if="!child.isDir" ng-class="{ \'ndm-fs-select-popup__struct__column-folder__row--selectable\': !vm.options.selectFolder, \'ndm-fs-select-popup__struct__column-folder__row--selectable-selected\': vm.file === child }" ng-click="!vm.options.selectFolder && vm.onFileSelected(child)" class="ndm-fs-select-popup__struct__column-folder__row"><div class="ndm-fs-select-popup__struct__column-folder__row__cell-filename">{{child.name}}</div> <div class="ndm-fs-select-popup__struct__column-folder__row__cell-filesize">{{child.size | sizeFormat}}</div></div><div ng-if="!vm.node.filesCount || !vm.node.path" class="ndm-fs-select-popup__struct__column-folder__row-message">{{ vm.node.path ? \'fs-select.no-files-in-folder\' : \'fs-select.folder-not-selected\' | translate }}</div></div></div></div><div class="ndm-fs-select-popup__no-usb-devices-message" ng-if="!vm.tree.foldersCount && vm.tree.loaded" data-translate="">fs-select.no-usb-devices</div><ndm-control-footer prefix="ndmFsSelect" is-visible="true" is-popup="true" save="vm.onApplyButtonClick()" is-save-disabled="!( vm.options.selectFolder ? vm.node.isDir : vm.file.isFile )" save-label="{{ vm.options.selectFolder ? \'fs-select.btn-select-folder\' : \'fs-select.btn-select-file\' }}" cancel="vm.cancel()"></ndm-control-footer></ndm-popup>'),e.put("app/components/ndm-fs/ndm-fs-select/ndm-fs-select.html",'<div class="ndm-fs-select-field ng-cloak"><div ng-if="::vm.label" class="form__cell form__cell--input-label help-text">{{vm.label | translate}}</div> <div class="form__cell form__cell--top"><div class="ndm-fs-select-field__container"><div class="ndm-fs-select-field__pseudo-input-wrapper"><div class="ndm-fs-select-field__pseudo-input inline" ng-click="vm.disabled || vm.edit()" ng-class="{ \'ndm-fs-select-field__pseudo-input--error\': vm.error, \'ndm-fs-select-field__pseudo-input--placeholder\': vm.placeholder && !vm.value }"><ndm-path-overflow ng-class="{\'disabled\': vm.disabled}" width="200" path="{{vm.value || (vm.placeholder | translate)}}"></ndm-path-overflow></div> <div ng-if="vm.value" class="ndm-fs-select-field__clear-value-link" ng-click="vm.disabled || vm.clear()">×</div><label ng-if="vm.name && vm.error" ng-class="{disabled: vm.disabled}" class="field--error-text status-problem">{{vm.error | translate}}</label></div><ndm-button btn-class="selector-link btn-default" is-disabled="vm.disabled" on-click="vm.edit" label="{{vm.btnLabel}}"></ndm-button></div></div><input ng-if="::vm.name" ng-init="vm.initNgModelValidation()" name="{{::vm.name}}" ng-model="vm.value" type="hidden"></div>'),e.put("app/components/ndm-fs/ndm-fs-toolbar/ndm-fs-toolbar.html",'<div class="ndm-fs-toolbar"><label ng-repeat="(key, item) in vm.buttons" ng-if="!item.hidden" ng-attr-for="{{item.disabled ? \'\' : item.labelFor}}" ng-class="{ \'ndm-fs-toolbar__button\': true, \'ndm-fs-toolbar__button--disabled\': item.disabled, [\'ndm-fs-toolbar__button--\' + item.icon]: true, [\'ndm-fs-toolbar__button--\' + item.icon + \'--disabled\']: item.disabled, [\'ndm-fs-toolbar__button--\' + item.icon + \'--active\']: item.active }" id="fs-toolbar-button--{{key}}" ng-click="item.disabled || item.onClick()" title="{{item.balloonHint ? \'\' : (item.title | translate)}}"><div ng-if="item.balloonHint" class="baloon ndm-baloon"><i class="baloon__arrow"></i> <div class="baloon__body">{{item.balloonHint | translate}}</div></div></label></div>'),e.put("app/components/ndm-fs/ndm-fs-tree/ndm-fs-tree.html",'<div ndm-polling="vm.poll" ndm-interval="2000" class="ndm-fs-tree"><div class="fs-browser__header"><span class="fs-browser__header_folder">{{\'fs-browser.headers.folder\' | translate}}</span> <span class="fs-browser__header_filesize">{{\'fs-browser.headers.filesize\' | translate}}</span></div> <div class="ndm-fs-tree__table" ng-include="\'app/components/ndm-fs/ndm-fs-tree/ndm-fs-tree__node.html\'" ng-init="node = vm.tree"></div> <div ng-if="vm.noUsbDrives" class="ndm-fs-tree__no-drives-msg" data-translate="">{{ vm.mediaId ? \'fs-browser.unknown-device\' : \'fs-browser.no-usb-drives\'}}</div></div>'),e.put("app/components/ndm-fs/ndm-fs-tree/ndm-fs-tree__node.html",'<div class="ndm-fs-tree__node"><div ng-if="node.path" ng-click="vm.onNodeClick(node, $event, false)" ng-dblclick="vm.onNodeClick(node, $event, true)" data-path="{{node.path}}" class="ndm-fs-tree__node__item" ng-class="{ \'ndm-fs-tree__node__item--selected\': vm.selected.path === node.path, \'ndm-fs-tree__node__item--folder\': node.isDir && !(node.isVolume && node.isUsb), \'ndm-fs-tree__node__item--file\': !(node.isVolume || node.isUsb || node.isDir), \'ndm-fs-tree__node__item--volume\': node.isVolume && node.isUsb, \'ndm-fs-tree__node__item--highlight\': node.highlight, \'ndm-fs-tree__node__item--not-loaded\': node.isDir && !node.loaded, \'ndm-fs-tree__node__item--locked\': node.isDir && node.isLocked, \'ndm-fs-tree__node__item--expanded\': node.isDir && node.totalCount && node.expanded, \'ndm-fs-tree__node__item--collapsed\': node.isDir && node.totalCount && !node.expanded }"><div class="ndm-fs-tree__node__item__name">{{node.label || node.name}}</div> <div class="ndm-fs-tree__node__item__filesize">{{node.isFolder ? \'\' : node.size | sizeFormat}}</div></div> <div id="dir--{{node.path}}" ng-if="node.expanded || node.loaded" ng-repeat="child in node.children track by child.path" ng-init="__parent = node; node = child;" ng-include="\'app/components/ndm-fs/ndm-fs-tree/ndm-fs-tree__node.html\'" ng-show="__parent.expanded"></div></div>'),e.put("app/components/ndm-schedule/ndm-schedule-draw/ndm-schedule-draw.html",'<div class="ndm-schedule-draw"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" class="ndm-schedule-draw--svg-container"></svg><div ng-if="isOverflow" class="ndm-schedule-draw__overflow-error" data-translate="">schedules.editor.overflow</div></div>'),e.put("app/components/ndm-schedule/ndm-schedule-editor/ndm-schedule-editor.html",'<div class="ndm-schedule-editor"><ndm-popup is-visible="true" ng-if="vm.visible" header-title="schedules.editor.title" close="vm.close"><form name="vm.form" novalidate=""><ndm-text text="schedules.editor.description"></ndm-text><ndm-input label="schedules.editor.fields.description" model="vm.data.description" name="description" validation="required"></ndm-input><ul class="form-list ndm-schedule-editor__list"><li class="form-list__row"><span class="form-list__label">{{ \'schedules.time.currentTime\' | translate }}</span> <span class="form-list__text">{{ vm.currentTime }}</span></li></ul><div ng-if="!vm.isNtpEnabled"><span>{{ \'schedules.editor.schedules-disabled\' | translate }}</span> <div ndm-html-compile="vm.ntpServiceLink"></div></div><br><div class="ndm-schedule-editor--draw-container"><ndm-schedule-draw first-day="1" name="draw" ng-model="vm.data.draw"></ndm-schedule-draw></div><hr class="hr-light-blue" ng-if="vm.id"><button class="btn btn--long _del-btn" ng-if="vm.id" ng-click="vm.delete()" data-translate="">schedules.editor.delete-btn</button><ndm-control-footer prefix="scheduleEditor" is-visible="vm.form.modified || !vm.id" is-popup="true" is-save-disabled="vm.form.$invalid" save="vm.save()" cancel="vm.close()"></ndm-control-footer></form></ndm-popup></div>'),e.put("app/components/ndm-schedule/ndm-schedule-select/ndm-schedule-select.html",'<div class="ndm-schedule-select"><div class="ndm-schedule-select__selectbox-container"><ndm-selectbox ng-if="vm.loaded && !vm.refreshing" name="{{name || \'ndm-schedule-select\'}}" value="$parent.model" disabled="isDisabled" label="{{title}}" on-hover="vm.onHover(value)" on-open="vm.opened = true" on-change="vm.onChange(value)" on-focus-change="vm.onFocusChange" on-close="vm.onHover(false); vm.opened = false" description="{{((model && model !== vm.NEW_OPT) && !vm.opened ? \'schedules.select.edit-caption\' : \'\') | translate | trust }}" on-description-click="vm.edit($parent.model)" is-description-disabled="isDisabled" options="vm.options"></ndm-selectbox></div> <div ng-if="vm.thumb || (model && model !== vm.NEW_OPT)" class="ndm-schedule-select__thumb-container" ng-class="{ \'ndm-schedule-select__thumb-container--with-value\': vm.opened && $parent.model, \'ndm-schedule-select__thumb-container--no-value\': vm.opened && !$parent.model, \'ndm-schedule-select__thumb-container--no-selected-thumb\': noSelectedThumb, \'ng-hide\': noSelectedThumb && !vm.opened }"><ndm-schedule-thumb ng-if="vm.thumb" ng-click="vm.edit($parent.model)" data="vm.thumbData"></ndm-schedule-thumb></div><ndm-schedule-editor schedule-id="vm.editId" on-save="vm.editorSaved" on-close="vm.editorClosed" ng-if="vm.editId"></ndm-schedule-editor></div>'),e.put("app/components/ndm-schedule/ndm-schedule-thumb/ndm-schedule-thumb.html",'<div class="ndm-schedule-thumb"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" class="ndm-schedule-thumb--svg-container"></svg></div>'),e.put("app/page/controlPanel/apps/apps.html",'<ndm-page class="page-apps" label="apps.title" progress="AC.progress"><ndm-usb-device-list></ndm-usb-device-list><ndm-form-header hr1="hr-light-blue" label="apps.applications" class="page-apps--title"></ndm-form-header><div class="applications-container"><div ng-repeat="idx in ::[0, 1]" class="app__column app__column--{{idx === 0 ? \'left\' : \'right\'}}"><div ng-repeat="name in AC.appNamesInOrder track by $index"><div ng-if="AC.apps[name].component && ((idx === 0 && AC.apps[name].left) || (idx === 1 && !AC.apps[name].left))" class="app__card app__card--{{AC.apps[name].left ? \'left\' : \'right\'}} app__card--{{AC.apps[name].order}}"><div ng-if="AC.apps[name].toggles" class="app__card-multiple-toggle-section"><div class="app__card-multiple-toggle-section-header"><a tabindex="0" ng-click="AC.popup.open($event, name)" ng-keydown="AC.onKeydown($event, name)" class="app__card-multiple-toggle-section-header-title" data-translate="">{{AC.apps[name].title || name}}</a> <div ng-if="[\'private-cloud\'].indexOf(name) > -1" class="app__card-content-wrap"><div ng-if="!AC.apps[name].notConfigured" ng-repeat="toggle in AC.apps[name].toggles track by $index"><div ng-if="toggle.component"><div class="app__card-multiple-toggle-section-toggle__container"><div class="app__card-multiple-toggle-section-toggle__wrapper"><ndm-toggle disabled="AC.apps[name].toggleDisabled || AC.apps[name].actionRequired" label-on="" label-off="" model="toggle.enable" name="apps_{{name}}_{{toggle.name}}" call-on-change="AC.toggles.subservice" description="AC.getState(name)"></ndm-toggle></div> <div class="app__card-multiple-toggle-section-header-subtitle form__cell"><span>{{toggle.title | translate}}</span></div></div> <div class="app__card-content"><span data-translate="">{{ AC.getPrivateCloudServiceStatus(toggle) }}</span><ul class="app__card-users-list" ng-if="toggle.name !== \'webdav\' && toggle.users"><li ng-repeat="username in toggle.users">{{username}}</li></ul><ul class="app__card-users-list" ng-if="toggle.name === \'webdav\' && toggle.users && toggle.someUserHasPassword"><li ng-repeat="userData in toggle.users"><span ng-class="{ \'help-text--warning\': !userData.hasPassword }" title="{{ (userData.hasPassword ? userData.name : \'apps.private-cloud.webdav.user-without-password\') | translate }}">{{userData.name}}</span></li></ul></div></div></div></div> <div ng-if="AC.apps[name].notConfigured" class="app__card-content--not-configured" data-translate="">apps.not-configured</div></div></div> <div ng-if="!AC.apps[name].toggles" class="app__card-header"><div class="app__card-header-toggle"><ndm-toggle ng-if="!AC.apps[name].notConfigured" disabled="AC.apps[name].toggleDisabled || AC.apps[name].actionRequired" label-on="" label-off="" model="AC.apps[name].enable" name="apps_{{name}}" call-on-change="AC.toggles.service" description="AC.getState(name)"></ndm-toggle><div ng-if="AC.apps[name].notConfigured" class="app__card-header-toggle__not-configured"><label class="toggle__label" ng-click="AC.toggles.service(false, \'apps_\' + name)"></label></div></div> <a tabindex="0" ng-click="AC.popup.open($event, name)" ng-keydown="AC.onKeydown($event, name)" class="app__card-header-title" data-translate="">{{AC.apps[name].title || name}}</a> <div ng-if="[\'cifs\', \'afp\', \'vpn-server\', \'vpn-sstp\', \'vpn-l2tp\', \'virtualIP\', \'vpn-ikev2\'].indexOf(name) > -1" class="app__card-content-wrap"><div ng-if="name === \'vpn-sstp\' || name === \'vpn-ikev2\'" class="app__card-content"><span ng-if="AC.apps[name].error && !AC.apps[name].actionRequired" class="help-text--warning" data-translate="">{{AC.apps[name].error}}</span> <div ng-if="AC.apps[name].actionRequired"><span data-translate="">{{\'apps.\'+ name + \'.requirements.header\'}}</span><ul><li ng-repeat="(key, req) in AC.apps[name].requirements" ng-if="!req.fullfilled"><span data-translate="">{{req.text}}</span></li></ul></div> <div ng-if="!AC.apps[name].error && !AC.apps[name].actionRequired" class="app__card-content-address"><span data-translate="">{{AC.apps[name].addressMsg}}</span><ndm-copy-to-clipboard text="{{AC.apps[name].address}}" hide-text="true"></ndm-copy-to-clipboard></div></div> <div class="app__card-content"><div ng-if="AC.apps[name].notConfigured" class="app__card-content--not-configured" data-translate="">apps.not-configured</div> <span ng-if="AC.apps[name].anonAccess && !AC.apps[name].notConfigured" data-translate="">apps.anon-access-granted</span> <div ng-if="!AC.apps[name].anonAccess && !AC.apps[name].notConfigured && !(AC.apps[name].error || AC.apps[name].actionRequired)"><span ng-if="AC.apps[name].users" data-translate="">apps.access-granted</span> <span ng-if="!AC.apps[name].users" data-translate="">apps.access-restricted</span><ul class="app__card-users-list" ng-if="AC.apps[name].users"><li ng-repeat="(username, params) in AC.apps[name].users">{{username}}</li></ul></div></div></div> <div ng-if="[\'vpn-server\', \'vpn-sstp\', \'virtualIP\', \'vpn-l2tp\', \'vpn-ikev2\'].indexOf(name) > -1 && !AC.apps[name].notConfigured && AC.apps[name].users && !(AC.apps[name].error || AC.apps[name].actionRequired)" class="app__card-content"><a tabindex="0" class="action-link no-select" ng-class="{\'action-link--disabled\': !AC.apps[name].enable}" ng-click="AC.popup.open($event, name + \'-stat\')" ng-keydown="AC.onKeydown($event, name + \'-stat\')" data-translate="">apps.statistic</a></div> <div ng-if="name === \'udpxy\'" class="app__card-content-wrap"><div class="app__card-content"><span data-translate="">apps.udpxy.card-description</span></div></div> <div ng-if="name === \'kabinet\'" class="app__card-content-wrap"><div class="app__card-content"><span data-translate="">apps.kabinet.card-description</span></div></div> <div ng-if="name === \'dlna\'" class="app__card-content-wrap"><div class="app__card-content"><div ng-if="AC.apps[name].notConfigured" class="app__card-content--not-configured" data-translate="">apps.not-configured</div> <button ng-if="!AC.apps[name].notConfigured && AC.apps[name].dirNotExists === false" ng-disabled="AC.apps[name].scanning !== false" class="btn btn-default" ng-click="AC.actions.dlnaRescan()" data-translate="">apps.dlna.update-db</button> <div ng-if="AC.apps[name].scanningText" class="app__card-content">{{AC.apps[name].scanningText}}</div> <div ng-if="AC.apps[name].dirNotExists && !AC.apps[name].notConfigured" class="help-text--warning" data-translate="">apps.dlna.dir-not-exists</div></div></div> <div ng-if="name === \'torrent\'" class="app__card-content-wrap"><div><div ng-if="AC.apps[name].notConfigured" class="app__card-content app__card-content--not-configured" data-translate="">apps.not-configured</div> <div ng-if="AC.apps[name].dirNotExists && !AC.apps[name].notConfigured" class="app__card-content" data-translate="">apps.dlna.dir-not-exists</div> <div ng-if="!AC.apps[name].notConfigured" class="app__card-content"><span ng-if="AC.apps[name].users" data-translate="">apps.access-granted</span> <div ng-if="!AC.apps[name].users" data-translate="">apps.access-restricted</div><ul ng-if="AC.apps[name].users && !AC.apps[name].error"><li ng-repeat="(username, params) in AC.apps[name].users">{{username}}</li></ul><a ng-if="AC.apps[name].link.visible" class="external-link" ng-class="{\'external-link--disabled\': AC.apps[name].link.disabled}" ng-href="{{AC.apps[name].link.href}}" target="_blank" data-translate="">{{AC.apps[name].link.name}}</a></div></div></div></div></div></div></div></div> <div ng-if="AC.initialized && AC.noAppsInSysmode" class="empty-list" data-translate="">dashboard.card_apps.no-apps</div></ndm-page><div ng-repeat="(app, appData) in ::AC.apps"><div ng-include="\'app/page/controlPanel/apps/\' + app + \'/\' + app + \'.apps.html\'"></div></div>'),e.put("app/page/dashboard/card_dect/card_dect.html",'<div class="d-main__card d-main__card__dect" id="card_dect" ng-controller="DashboardCardDectController as vm"><div class="d-main__card-header"><a class="d-main__card-title" ui-sref="controlPanel.dectBase" data-translate="">dashboard.card_dect.title</a></div> <div class="d-main__card-container"><div ng-if="vm.dataLoaded && !vm.dectIsUnplugged && !vm.dectIsOff"><div ng-if="vm.lines.length" class="dect-lines"><div ng-repeat="line in vm.lines track by line.id" class="dect-lines__line"><ndm-toggle label-on="{{line.name}}" label-off="{{line.name}}" model="line.isEnabled" name="sip-line-toggle--{{line.id}}--{{$index}}" call-on-change="vm.toggleLineState" disabled="vm.dectIsRestarting" description="line.status.toggleStatus"></ndm-toggle></div></div> <div ng-if="!vm.lines.length" class="no-dect-lines-msg"><span class="help-text" ndm-html-compile="vm.l10n.noLines"></span></div> <span ng-if="vm.lines.length || vm.handsets.length" class="tretiary-title" data-translate="">dashboard.card_dect.handsets-and-calls</span> <div class="dashboard-dect__actions">{{vm.actions}}</div><table ng-if="vm.handsets.length > 0" class="dect-handsets__table"><tbody><tr ng-repeat="handset in vm.handsets track by handset.trackHash | orderBy: [\'-hs\', \'startTime\']" ng-class="{\'dect-handsets__table__row-seperated\': !+handset.callNum}" class="dect-handsets__handset"><td class="handset-icon"><i class="icon icon--{{handset.icon}}"></i></td><td class="handset-name" ng-class="{\'incoming-call-preloader\': !handset.name}"><div ng-if="handset.name" ng-bind-html="handset.name"></div><ndm-dect-preloader ng-if="!handset.name"></ndm-dect-preloader></td><td class="handset-status"><div ng-bind-html="handset.status"></div></td><td class="handset-line"><div class="help-text" ng-bind-html="handset.line"></div></td></tr></tbody></table><div ng-if="vm.lines.length && !vm.handsets.length" class="help-text" ndm-html-compile="vm.l10n.noHandsets"></div></div> <div ng-if="vm.dataLoaded && !vm.dectIsUnplugged && vm.dectIsOff"><span class="help-text" ndm-html-compile="vm.l10n.enableService"></span></div> <div ng-if="vm.dectIsUnplugged" class="help-text" data-translate="">dashboard.card_dect.dect-is-not-plugged</div></div></div>'),e.put("app/page/tools/cli/cli.html",'<div class="cli-page" ng-class="{\'cli-page--masked\': vm.alert.isVisible}" init-scroll=""><form autocomplete="off" name="vm.form" class="cli-content"><ndm-tabs class="cli-content__tabs" tabs="vm.tabs" label-prop="label" on-tab-changed-fn="vm.onModeChange" update-state-on-tab-change="false"></ndm-tabs><div class="cli-content__wrapper"><div ng-if="vm.mode === vm.MODE.PARSE" class="cli-parse"><div class="cli-parse__input-wrapper"><ndm-input-autocomplete class="cli-parse__url-input" label="Command" on-key="vm.parse.onKey" name="cmd" no-value-msg="Enter command..." value="vm.parse.cmd" is-disabled="vm.parse.queryIsInProgress" is-invalid="vm.parse.inputIsInvalid" on-init="vm.parse.onInputInit" on-input-change="vm.parse.onInputChange" background-text="{{vm.parse.inputBackgroundText}}" flags="vm.parse.inputFlags" options="vm.parse.autocompleteOptions"></ndm-input-autocomplete><div class="cli-parse__input-buttons"><ndm-button is-disabled="vm.parse.cmd.length === 0 || vm.parse.queryIsInProgress" label="Send request" btn-class="btn--primary" on-click="vm.parse.sendRequest"></ndm-button><ndm-button label="Clear" on-click="vm.parse.clearRequest"></ndm-button></div></div> <div class="cli-parse__prompt-wrapper"><div class="cli-parse__prompt">{{vm.parse.prompt}}&gt;</div> <div class="cli-parse__hint">{{vm.parse.hintText}}</div></div> <div ng-if="vm.parse.responseIsNotEmpty" class="cli-parse__timer">Request time: {{vm.parse.requestTime || \'&mdash;\'}} ms</div> <div class="cli-parse__result"><div ng-if="vm.parse.responseIsNotEmpty" class="cli-parse__result-controls"><ndm-button class="cli-parse__side-btn" label="Clear" ng-click="vm.parse.clearResponse()"></ndm-button><br><ndm-button is-disabled="vm.parse.errorMsg" class="cli-parse__side-btn" label="Copy" ng-click="vm.parse.copyResponseToClipboard()"></ndm-button></div> <div ng-if="vm.parse.errorMsg" class="cli-parse__error-msg help-text--warning"><pre>{{vm.parse.errorMsg}}</pre></div> <div class="cli-parse__json-wrapper" ng-class="{ \'cli-parse__json-wrapper--bordered\': vm.parse.responseIsNotEmpty }"><div><pre>{{vm.parse.responseJson}}</pre></div></div> <input type="hidden" name="responseJson" ng-model="vm.parse.responseJson"></div></div><div ng-if="vm.mode === vm.MODE.REST" class="cli-rest"><div class="cli-rest__url-wrapper"><ndm-radio label="Method" name="method" model="vm.rest.method" on-change="vm.rest.onMethodChange" array="vm.rest.methodOptions"><ndm-checkbox name="enableTrace" class="cli-rest__trace-checkbox" label="Trace RCI queries" model="vm.rest.isTraceEnabled" on-value-change="vm.rest.onIsTraceEnabledToggle"></ndm-checkbox></ndm-radio><ndm-input class="cli-rest__url-input" max-length="512" set-focus="true" label="URL: rci/" on-press-down="vm.history().goDown()" on-press-up="vm.history().goUp()" on-press-enter="vm.rest.sendRequest()" is-autofill-enabled="false" name="url" model="vm.rest.url"><ndm-button is-disabled="vm.rest.queryIsInProgress" label="Send" btn-class="btn--primary" on-click="vm.rest.sendRequest"></ndm-button><ndm-button label="Clear" on-click="vm.rest.clearRequest"></ndm-button></ndm-input><div ng-if="!vm.rest.queryIsInProgress && vm.rest.requestEverMade" class="cli-rest__timer">Request time: {{vm.rest.requestTime || \'&mdash;\'}} ms</div><hr class="hr-light-blue"></div> <div class="cli-rest__textareas cli-rest__textareas--{{vm.rest.method.toLowerCase()}}"><div ng-if="vm.rest.method === vm.REQUEST_METHOD.POST" class="cli-rest__post-data-wrapper"><div class="cli-rest__post-data-tools buttons-row"><div class="tretiary-title">Data</div><ndm-button class="buttons-row__item cli-rest__reformat-btn" label="Reformat" ng-click="vm.rest.reformatDataInput()"></ndm-button><ndm-button class="buttons-row__item cli-rest__reset-btn" label="Reset" ng-click="vm.rest.resetDataInput()"></ndm-button></div><ndm-textarea class="cli-rest__data" name="restData" ng-class="{\'cli-rest__data--invalid\': vm.rest.dataIsInvalid}" on-change="vm.rest.validateData" on-create="vm.rest.onTextareaCreate" on-destroy="vm.rest.onTextareaDestroy" label="" cols="80" rows="10" model="vm.rest.data"></ndm-textarea></div> <div ng-if="vm.rest.responseIsNotEmpty" class="cli-rest__result"><div class="buttons-row cli-rest__result-controls"><div class="tretiary-title">Result</div><ndm-button class="buttons-row__item cli-rest__side-btn" label="Clear" ng-click="vm.rest.clearResponse()"></ndm-button><ndm-button class="buttons-row__item cli-rest__side-btn" label="Copy" ng-click="!vm.rest.errorMsg && vm.rest.copyResponseToClipboard()"></ndm-button></div> <div class="cli-rest__json-wrapper" ng-class="{ \'cli-rest__json-wrapper--short\': vm.rest.dataIsVisible, \'cli-rest__json-wrapper--bordered\': vm.rest.responseIsNotEmpty }"><div><pre>{{vm.rest.responseJson}}</pre></div> <div ng-if="vm.rest.errorMsg" class="cli-rest__error-msg help-text--warning"><pre>{{vm.rest.errorMsg}}</pre></div></div></div></div></div><div ng-if="vm.mode === vm.MODE.SELFTEST" class="cli-self-test-parser" ndm-polling="vm.getInternetStatus"><div class="self-test-selector"><label class="self-test-selector__label btn btn--primary" ng-class="{\'self-test-selector__label--disabled\': vm.selfTest.uiIsLocked}" for="{{vm.selfTest.inputId}}"><span>Select a self-test file</span> <input class="self-test-selector__input" type="file" value="vm.selfTest.file" id="{{vm.selfTest.inputId}}"></label><ndm-button is-disabled="vm.selfTest.uiIsLocked || (!vm.selfTest.file && !vm.selfTest.showVersionData)" label="Reset" on-click="vm.selfTest.reset"></ndm-button><ndm-button is-disabled="!vm.internetIsOk || vm.selfTest.uiIsLocked || !vm.selfTest.file && !vm.selfTest.showVersionData" label="Process again" ng-click="vm.selfTest.reprocessLists()"></ndm-button><div class="internet-status">Internet connection: <span ng-if="vm.internetIsOk" class="help-text--success">OK</span> <span ng-if="!vm.internetIsOk" class="help-text--warning">NO<br><span class="help-text">Internet connection is required to change the device firmware.<br>But you still can modify the device configuration</span></span></div> <div ng-if="vm.selfTest.file" class="self-test-selector__filename">Selected file: <span class="help-text--success">{{vm.selfTest.file}}</span></div> <div ng-if="vm.selfTest.error" class="self-test-selector__error"><span class="help-text--warning">{{vm.selfTest.error}}</span></div></div><ndm-details disabled="!vm.internetIsOk" class="cli-self-test-parser__show-version-input-wrapper" toggle-var="vm.selfTest.showVersionTextareaIsVisible" label-visible="Show the textarea to past \'show version\' output to" label-hidden="Hide the textarea"><ndm-textarea label="Paste \'show version\' output here" cols="80" rows="10" on-change="vm.selfTest.onShowVersionDataPaste" model="vm.selfTest.showVersionData"></ndm-textarea></ndm-details><ndm-selectbox class="cli-self-test-parser__sandbox-selectbox" disabled="!vm.internetIsOk" label="Sandbox" value="vm.selfTest.sandbox" description="{{vm.selfTest.sandboxDescription}}" options="vm.selfTest.sandboxOptions"></ndm-selectbox><div ng-if="vm.selfTest.file && !vm.selfTest.error" class="cli-self-test-parser__config-ctrls"><ndm-checkbox class="cli-self-test-parser__replace-config" disabled="vm.selfTest.uiIsLocked || !vm.selfTest.file" label="Replace config" name="replaceConfig" model="vm.selfTest.replaceConfig" description="{{vm.selfTest.replaceConfigDescription}}"></ndm-checkbox><ndm-button class="cli-self-test-parser__view-config" label="View config" is-disabled="!vm.selfTest.fileData.config" on-click="vm.selfTest.viewConfig"></ndm-button></div> <div ng-if="!vm.selfTest.error && vm.internetIsOk && vm.selfTest.componentsToInstall.length === 0 && vm.selfTest.componentsToRemove.length === 0" class="cli-self-test-parser__components-lists-equal-msg"><h2 ng-if="vm.selfTest.file" class="tretiary-title">Components list in the selected self-test file is identical to the device components list</h2><h2 ng-if="vm.selfTest.showVersionData" class="tretiary-title">Components list in the \'show version\' input is identical to the device components list</h2></div> <div ng-if="vm.internetIsOk && (vm.selfTest.componentsToInstall.length !== 0 || vm.selfTest.componentsToRemove.length !== 0)" class="cli-self-test-parser__changes"><div class="page-cli-components-list"><div class="page-cli-components-list__title"><span class="page-cli-components-list__title-text">Will be installed:</span><ndm-button label="Select all" on-click="vm.selfTest.selectAllToInstallComponents"></ndm-button><ndm-button label="Deselect all" on-click="vm.selfTest.deselectAllToInstallComponents"></ndm-button></div> <div ng-if="vm.selfTest.componentsToInstall.length > 0" class="page-cli-components-list__contents" ng-class="{\'page-cli-components-list__contents--short\': vm.selfTest.showVersionTextareaIsVisible}"><div ng-repeat="toInstall in vm.selfTest.componentsToInstall track by $index" class="page-cli-components-list__component"><ndm-checkbox name="to_install__{{toInstall.name}}" label="" description="{{toInstall.name}}" model="toInstall.isSelected"></ndm-checkbox></div></div></div> <div class="page-cli-components-list"><div class="page-cli-components-list__title"><span class="page-cli-components-list__title-text">Will be removed:</span><ndm-button label="Select all" on-click="vm.selfTest.selectAllToRemoveComponents"></ndm-button><ndm-button label="Deselect all" on-click="vm.selfTest.deselectAllToRemoveComponents"></ndm-button></div> <div ng-if="vm.selfTest.componentsToRemove.length > 0" class="page-cli-components-list__contents" ng-class="{\'page-cli-components-list__contents--short\': vm.selfTest.showVersionTextareaIsVisible}"><div ng-repeat="toRemove in vm.selfTest.componentsToRemove track by $index" class="page-cli-components-list__component"><ndm-checkbox name="to_install__{{toRemove.name}}" label="" description="{{toRemove.name}}" model="toRemove.isSelected"></ndm-checkbox></div></div></div></div><ndm-button ng-if="(vm.selfTest.file || vm.selfTest.showVersionData)" is-disabled="vm.selfTest.error || vm.selfTest.uiIsLocked || ( (!vm.internetIsOk || (vm.selfTest.componentsToInstall.length === 0 && vm.selfTest.componentsToRemove.length === 0)) && !vm.selfTest.replaceConfig )" label="{{ vm.internetIsOk && !(vm.selfTest.componentsToInstall.length === 0 && vm.selfTest.componentsToRemove.length === 0) ? (\'Modify device components\' + (vm.selfTest.replaceConfig ? \' & replace config\' : \'\')) : \'Replace device config\' }}" btn-class="cli-self-test-parser__apply-btn btn--primary btn--long" on-click="vm.selfTest.applyChanges"></ndm-button></div></div></form></div><ndm-alert ng-if="vm.alert.isVisible" is-visible="true" is-close-button-hidden="vm.selfTest.alert.closeButtonIsHidden" label="{{vm.alert.title}}" hide="vm.selfTest.closeAlert()" class="alert page-cli-alert"><ndm-single-key-bind ng-if="!vm.alert.progressBarIsVisible" key="27" call-func="vm.selfTest.closeAlert()"></ndm-single-key-bind><ndm-textarea ng-if="vm.alert.text" label="" class="page-cli-alert__config-editor" cols="75" rows="40" model="vm.alert.text"></ndm-textarea><ndm-progress-bar is-visible="vm.alert.progressBarIsVisible" count="vm.alert.count" load-status="vm.alert.loadStatus"></ndm-progress-bar></ndm-alert>'),e.put("app/page/tools/qc/qc.html",'<section class="qc-page"><ndm-header></ndm-header><section class="qc-content"><h2 class="tretiary-title">Quality Check Report</h2><div ng-if="!vm.ready" class="qc-content__spinner-wrapper"><i class="icon-dashboard__item-icon icon icon--load"></i></div> <div ng-if="vm.ready" ng-repeat="item in vm.data" class="qc-content__data-container"><div class="qc-content__label"><span>{{item.label}}</span></div> <div class="qc-content__data"><span ng-bind-html="item.data"></span></div></div></section></section>'),e.put("app/page/wizard/initialSetup/initialSetup.html",'<div class="initial-setup"><div class="initial-setup-header"><div class="initial-setup-header__logo-and-model logo-and-model" ng-class="{ \'initial-setup-header__logo-and-model--ie\': vm.isIE }"><div ng-if="vm.isIE" class="logotype__wrapper"><i class="icon logotype logotype--ie"></i></div><ndm-svg-icon ng-if="!vm.isIE" height="20" width="182" class-name="logo-and-model__logotype" svg-id="logo_keenetic"></ndm-svg-icon><span class="header-model"><span class="header-model__model-text" ng-attr-title="{{::vm.constants.deviceModel}}">{{::vm.constants.deviceModelForLogo}}</span></span></div></div><ndm-device-poller ng-if="vm.devicePollerIsOn" on-data-update="vm.updateDeviceStatus"></ndm-device-poller><div class="page-initial-setup"><div class="modal__background" ng-if="vm.isRebooting"><ndm-alert ng-cloak="" is-visible="true" ng-if="vm.isRebooting" is-close-button-hidden="true" label="{{\'system.reboot.alert.title\' | translate}}" class="alert"><ndm-progress-bar is-visible="true" is-count-visible="!vm.reboot.isAbnormal" count="vm.reboot.progress" load-status="vm.reboot.msg"></ndm-progress-bar></ndm-alert></div><div class="initial-setup-main-card"><ndm-notifications-container ng-hide="vm.checkConn.isUpdating || vm.isRebooting || vm.specialModes.isRebooting"></ndm-notifications-container><div class="initial-setup-content {{vm.isIE ? \'initial-setup-content--ie\' : \'\'}}"><wizard class="initial-setup-wizard" name="{{vm.constants.wizardName}}" indicators-position="bottom"><wz-step wz-title="welcome" class="step welcome"><div ng-if="vm.ready"><div class="primary-title" data-translate="">initial-setup.welcome.header</div> <div class="help-text" data-translate="">initial-setup.welcome.header-subtext</div> <div class="welcome__form"><div class="language-selectbox-wrapper"><span data-translate="">initial-setup.welcome.select-language</span><br><ndm-selectbox name="language" class="language-selectbox" options="vm.welcome.languageOptions" value="vm.welcome.language" on-change="vm.welcome.onLanguageChange()"></ndm-selectbox></div> <div class="start-setup-btn-wrapper"><button ndm-autofocus="" type="submit" class="start-setup-btn btn btn--long btn--primary" ng-click="vm.welcome.proceed()" data-translate="">initial-setup.welcome.quick-setup-btn</button></div></div><div class="welcome__footer help-text" ndm-html-compile="vm.l10n.dashboardLink"></div></div></wz-step><wz-step wz-title="password" class="step password"><div class="primary-title" data-translate="">initial-setup.password.header</div> <div class="step-content-wrapper"><div class="help-text" data-translate="">initial-setup.password.description</div><form class="{{vm.isIE ? \'form--ie\' : \'\'}}" ng-if="vm.password.ready" name="vm.password.form" novalidate=""><ndm-input label="initial-setup.password.username" model="vm.password.username" disabled="true" name="username"></ndm-input><ndm-input label="administrator.editor.set-password" model="vm.password.password1" password="true" max-length="32" validation="required,password" error-from-controller="vm.password.error.password1" on-change="vm.password.comparePasswords" name="password1"></ndm-input><ndm-input label="administrator.editor.repeat-password" model="vm.password.password2" password="true" max-length="32" validation="required,password" error-from-controller="vm.password.error.password2" on-change="vm.password.comparePasswords" name="password2"></ndm-input></form></div><ndm-single-key-bind ng-if="vm.currentStep === \'password\' && vm.password.canProceed()" key="enter" call-func="vm.password.proceed()"></ndm-single-key-bind><ndm-control-footer is-visible="true" is-initial-setup="true" swap-ctrls="true" prefix="password" cancel-label="initial-setup.btn.back" save-label="initial-setup.btn.proceed" save="vm.stepCtrl.proceed()" is-save-disabled="!vm.stepCtrl.canProceed()" cancel="vm.goBack()"></ndm-control-footer></wz-step><wz-step wz-title="conn-type" class="step conn-type"><div class="primary-title" data-translate="">initial-setup.conn-type.header</div> <div class="step-content-wrapper"><div ng-if="vm.connType.ready" class="conn-kinds-wrapper" ng-class="{ \'conn-kinds-wrapper--single-option\': vm.connType.kindOptions.length === 1 }"><ndm-button-list class="conn-kinds-btns {{::vm.isIE ? \'conn-kinds-btns--ie\' : \'\'}}" id="conn-kinds" options="vm.connType.kindOptions" model="vm.connType.selectedKind" btn-class="conn-kind-btn" on-change="vm.connType.setConnectionKind"></ndm-button-list></div> <div ng-if="::vm.connType.specialModesStepLinkIsVisible" class="conn-type__footer" data-translate="{{vm.l10n.specialModesLink}}"></div></div><ndm-single-key-bind ng-if="!vm.deviceIsOffline && vm.currentStep === \'conn-type\' && vm.connType.canProceed()" key="enter" call-func="vm.connType.proceed()"></ndm-single-key-bind><ndm-control-footer is-visible="true" is-initial-setup="true" is-cancel-visible="!vm.internalConfig.authError" swap-ctrls="true" prefix="connectionType" cancel-label="initial-setup.btn.back" save-label="initial-setup.btn.proceed" save="vm.stepCtrl.proceed()" is-save-disabled="!vm.stepCtrl.canProceed()" cancel="vm.goToStep(\'password\')"></ndm-control-footer></wz-step><wz-step wz-title="services" class="step services"><div class="primary-title" data-translate="">initial-setup.services.header</div> <div class="step-content-wrapper"><div class="help-text" data-translate="">initial-setup.services.description</div> <div ng-if="vm.services.ready" class="services-list"><ndm-button-list class="services-options {{::vm.isIE ? \'services-options--ie\' : \'\'}}" btn-class="services-options-btn" options="vm.services.servicesOptions" show-status-icon="true" model="vm.selectedServices" allow-multiple="true"></ndm-button-list></div></div><ndm-single-key-bind ng-if="!vm.deviceIsOffline && vm.currentStep === \'services\'" key="enter" call-func="vm.services.proceed()"></ndm-single-key-bind><ndm-control-footer is-visible="true" is-initial-setup="true" swap-ctrls="true" prefix="chooseServices" cancel-label="initial-setup.btn.back" save-label="initial-setup.btn.proceed" save="vm.services.proceed()" cancel="vm.goBack()"></ndm-control-footer></wz-step><wz-step wz-title="special-modes" class="step special-modes"><div ng-cloak="" ng-if="vm.specialModes.isRebooting" class="alert alert--system-mode step-content-wrapper"><h3 class="ndm-alert__body-title body-text">{{ vm.specialModes.rebooted ? \'system.sysmode.finish-notice-alert.title\' : \'system.sysmode.finish-notice-alert.title-in-process\' | translate }}</h3><ndm-progress-bar class="special-modes__switch-progress" is-visible="true" is-count-hidden="vm.specialModes.rebootIsAbnormal" count="vm.specialModes.rebootProgress"></ndm-progress-bar><div class="alert--system-mode--text"><div data-translate="">{{::vm.specialModes.notice.text}}</div> <div data-translate="">{{::vm.specialModes.notice.subText}}</div></div></div><div ng-if="!vm.specialModes.isRebooting" class="step-content-wrapper"><div class="primary-title" data-translate="">initial-setup.special-modes.header</div> <div class="step-content-wrapper"><div class="help-text" data-translate="">initial-setup.special-modes.description</div> <div class="special-modes-wrapper"><div ng-repeat="btn in vm.specialModes.modeOptions" class="initial-setup-btn special-mode-btn" ng-class="{ \'mode-icon--{{btn.id}}\': vm.specialModes.selected(btn.id), \'selected\': vm.specialModes.selected(btn.id) }" ng-click="vm.specialModes.select(btn.id)"><span data-translate="">{{::btn.title}}</span></div></div></div><ndm-single-key-bind ng-if="!vm.deviceIsOffline && vm.currentStep === \'special-modes\' && vm.specialModes.canProceed()" key="enter" call-func="vm.specialModes.proceed()"></ndm-single-key-bind><ndm-control-footer is-visible="true" is-initial-setup="true" cancel-label="initial-setup.btn.back" swap-ctrls="true" prefix="specialMode" save-label="initial-setup.btn.proceed" save="vm.specialModes.proceed()" is-save-disabled="!vm.specialModes.canProceed()" cancel="vm.goBack()"></ndm-control-footer></div></wz-step><wz-step wz-title="conn-subtype" class="step conn-subtype"><div class="primary-title" data-translate="">initial-setup.conn-subtype.header</div> <div class="step-content-wrapper"><div class="help-text" data-translate="{{vm.l10n.connSubtypeDescription}}"></div> <div class="conn-subtypes-wrapper"><div class="conn-subtypes-btns"><div class="btn-column"><div class="conn-subtype-btn" ng-class="{\'conn-subtype-btn__selected\': vm.connSubtype.selected(\'ipoe\')}" ng-click="vm.connSubtype.select(\'ipoe\')" data-qa-id="{{vm.currentStep}}-ipoe"><span class="conn-subtype-btn__label" data-translate="">initial-setup.conn-subtype.subtype.ipoe</span></div><div class="conn-subtype-btn" ng-class="{\'conn-subtype-btn__selected tall nohover\': vm.connSubtype.selected(\'pptp\')}" ng-click="vm.connSubtype.select(\'pptp\')" data-qa-id="{{vm.currentStep}}-pptp"><span class="conn-subtype-btn__label" data-translate="">initial-setup.conn-subtype.subtype.pptp</span> <div><form ng-if="vm.connSubtype.selected(\'pptp\')" name="vm.connSubtype.formPptp" novalidate=""><ndm-input ndm-autofocus="" title-on-top="" model="vm.connSubtype.serverAddress[\'pptp\']" label="initial-setup.conn-subtype.form.server-address" validation="required,ipOrDomain"></ndm-input></form></div></div><div class="conn-subtype-btn" ng-if="vm.config.internet.kind !== \'dsl\' && vm.config.internet.kind !== \'usbdsl\'" ng-class="{\'conn-subtype-btn__selected\': vm.connSubtype.selected(\'auth802.1x\')}" ng-click="vm.connSubtype.select(\'auth802.1x\')" data-qa-id="{{vm.currentStep}}-auth802.1x"><span class="conn-subtype-btn__label" data-translate="">initial-setup.conn-subtype.subtype.auth802.1x</span></div></div> <div class="btn-column"><div class="conn-subtype-btn" ng-class="{\'conn-subtype-btn__selected\': vm.connSubtype.selected(\'pppoe\')}" ng-click="vm.connSubtype.select(\'pppoe\')" data-qa-id="{{vm.currentStep}}-pppoe"><span class="conn-subtype-btn__label" data-translate="">initial-setup.conn-subtype.subtype.pppoe</span></div><div class="conn-subtype-btn" ng-class="{\'conn-subtype-btn__selected tall nohover\': vm.connSubtype.selected(\'l2tp\')}" ng-click="vm.connSubtype.select(\'l2tp\')" data-qa-id="{{vm.currentStep}}-l2tp"><span class="conn-subtype-btn__label" data-translate="">initial-setup.conn-subtype.subtype.l2tp</span> <div><form ng-if="vm.connSubtype.selected(\'l2tp\')" name="vm.connSubtype.formL2tp" novalidate=""><ndm-input ndm-autofocus="" title-on-top="" model="vm.connSubtype.serverAddress[\'l2tp\']" label="initial-setup.conn-subtype.form.server-address" validation="required,ipOrDomain"></ndm-input></form></div></div></div></div></div></div><ndm-single-key-bind ng-if="!vm.deviceIsOffline && vm.currentStep === \'conn-subtype\' && vm.connSubtype.canProceed()" key="enter" call-func="vm.connSubtype.proceed()"></ndm-single-key-bind><ndm-control-footer prefix="connectionSubtype" is-visible="true" is-initial-setup="true" cancel-label="initial-setup.btn.back" swap-ctrls="true" save-label="initial-setup.btn.proceed" save="vm.connSubtype.proceed()" is-save-disabled="!vm.connSubtype.canProceed()" cancel="vm.goBack()"></ndm-control-footer></wz-step><wz-step wz-title="setup-mac" class="step setup-mac"><div class="setup-mac-title"><span class="primary-title" data-translate="">initial-setup.setup-mac.header</span></div> <div class="step-content-wrapper"><div class="help-text" data-translate="">initial-setup.setup-mac.description</div> <div class="mac-options" ng-if="vm.setupMac.ready"><div class="mac-option" ng-click="vm.setupMac.select(\'default-mac\')" ng-class="{\'mac-option__selected\': vm.setupMac.selected(\'default-mac\')}" data-qa-id="{{vm.currentStep}}-default-mac"><span class="mac-option__label" data-translate="">initial-setup.setup-mac.options.default-mac.label</span><br><span class="mac-option__description help-text"><span data-translate="initial-setup.setup-mac.options.default-mac.description" data-translate-value-address="{{vm.internalConfig.deviceWanMac}}"></span></span></div> <div class="mac-option" ng-class="{\'mac-option__selected tall-option\': vm.setupMac.selected(\'manual-input\')}" ng-click="vm.setupMac.select(\'manual-input\')" data-qa-id="{{vm.currentStep}}-manual-input"><span class="mac-option__label" data-translate="">initial-setup.setup-mac.options.manual-input.label</span><br><span class="mac-option__description help-text" data-translate="">initial-setup.setup-mac.options.manual-input.description</span> <div ng-if="vm.setupMac.manualInput"><div class="mac-manual-input"><form ng-if="vm.setupMac.manualInput" novalidate="" name="vm.setupMac.form"><ndm-input ndm-autofocus="" class="mac-input-field" name="mac-manual" model="vm.setupMac.macAddress" validation="required,mac"></ndm-input></form></div></div></div></div></div><ndm-single-key-bind ng-if="!vm.deviceIsOffline && vm.currentStep === \'setup-mac\' && vm.setupMac.canProceed()" key="enter" call-func="vm.setupMac.proceed()"></ndm-single-key-bind><ndm-control-footer prefix="mac" is-visible="true" is-initial-setup="true" cancel-label="initial-setup.btn.back" swap-ctrls="true" save-label="initial-setup.btn.proceed" save="vm.setupMac.proceed()" is-save-disabled="!vm.setupMac.canProceed()" cancel="vm.goBack()"></ndm-control-footer></wz-step><wz-step wz-title="setup-ip" class="step setup-ip"><div class="primary-title" data-translate="">initial-setup.setup-ip.header</div> <div class="step-content-wrapper"><div class="help-text" data-translate="{{ vm.config.internet.kind.indexOf(\'dsl\') === -1 ? \'initial-setup.setup-ip.description\' : \'initial-setup.setup-ip.description-dsl\' }}"></div> <div class="ip-form-wrapper"><form ng-if="vm.setupIp.ready" novalidate="" name="vm.setupIp.ipForm"><ndm-selectbox tabindex="0" class="ip-type-selectbox" ng-if="vm.setupIp.ready" value="vm.setupIp.ipType" options="vm.setupIp.ipTypeOptions" name="{{vm.currentStep}}-select" label="initial-setup.setup-ip.form.ip-type"></ndm-selectbox><ndm-sub-form ng-if="vm.setupIp.ipType === \'static-ip\'"><ndm-input tabindex="1" ndm-autofocus="" model="vm.setupIp.address" name="{{vm.setupIp.ipType}}-address" label="initial-setup.setup-ip.form.address" validation="required,ip,isHost[{{vm.setupIp.mask}}]"></ndm-input><ndm-selectbox tabindex="1" value="vm.setupIp.mask" ng-class="{\'error\': !vm.setupIp.mask}" options="vm.setupIp.maskOptions" placeholder="initial-setup.setup-ip.select-netmask" name="{{vm.setupIp.ipType}}-select" label="initial-setup.setup-ip.form.mask"></ndm-selectbox><ndm-input model="vm.setupIp.gateway" name="{{vm.setupIp.ipType}}-gateway" label="initial-setup.setup-ip.form.gateway" validation="required,ip,inNet[{{vm.setupIp.address}};{{vm.setupIp.mask}}]"></ndm-input><ndm-input model="vm.setupIp.dns" name="{{vm.setupIp.ipType}}-dns" label="initial-setup.setup-ip.form.dns" validation="required,ip"></ndm-input></ndm-sub-form></form></div></div><ndm-single-key-bind ng-if="!vm.deviceIsOffline && vm.currentStep === \'setup-ip\' && vm.setupIp.canProceed()" key="enter" call-func="vm.setupIp.proceed()"></ndm-single-key-bind><ndm-control-footer prefix="ip" is-save-disabled="!vm.setupIp.canProceed()" is-initial-setup="true" is-visible="true" save-label="initial-setup.btn.proceed" swap-ctrls="true" cancel-label="initial-setup.btn.back" cancel="vm.goBack()" save="vm.setupIp.proceed()"></ndm-control-footer></wz-step><wz-step wz-title="logon" class="step logon"><div class="primary-title" data-translate="">initial-setup.logon.header</div> <div class="step-content-wrapper"><div class="help-text" data-translate="">initial-setup.logon.description</div> <div ng-if="vm.internalConfig.authError" class="help-text help-text--warning auth-error" data-translate="">initial-setup.check-conn.errors.auth</div> <div class="logon-form-wrapper" ng-if="vm.logon.ready"><form novalidate="" ng-if="vm.logon.ready" name="vm.logon.form"><ndm-input model="vm.logon.login" label="initial-setup.logon.login" validation="required,ascii,length[1..64]"></ndm-input><ndm-input model="vm.logon.password" label="initial-setup.logon.password" password="true" validation="required,ascii,length[1..64]"></ndm-input><ndm-selectbox ng-if="vm.logon.ready && vm.logon.showAuthType" label="initial-setup.logon.auth-type" value="vm.logon.authType" options="vm.logon.authTypeOptions"></ndm-selectbox><div ng-if="vm.logon.showPppoeSettings()"><ndm-input label="initial-setup.logon.access-concentrator" model="vm.logon.acname"></ndm-input><ndm-input label="initial-setup.logon.service-name" model="vm.logon.service"></ndm-input></div></form></div></div><ndm-single-key-bind ng-if="!vm.deviceIsOffline && vm.currentStep === \'logon\' && vm.logon.canProceed()" key="enter" call-func="vm.logon.proceed()"></ndm-single-key-bind><ndm-control-footer prefix="logon" is-save-disabled="!vm.logon.canProceed()" is-initial-setup="true" is-visible="true" save-label="initial-setup.btn.proceed" swap-ctrls="true" cancel-label="{{vm.internalConfig.authError ? \'initial-setup.check-conn.clear-settings-link\' : \'initial-setup.btn.back\'}}" cancel="vm.logon.onCancelClick()" save="vm.logon.proceed()"></ndm-control-footer></wz-step><wz-step wz-title="g3-operator" class="step g3-operator"><div class="primary-title" data-translate="">initial-setup.g3-operator.header</div> <div class="step-content-wrapper"><div class="help-text" data-translate="">initial-setup.g3-operator.description</div> <div ng-if="vm.internalConfig.authError" class="help-text help-text--warning auth-error" data-translate="">initial-setup.check-conn.errors.auth</div> <div class="g3-operator-form-wrapper"><form ng-if="vm.g3Operator.ready" novalidate="" name="vm.g3Operator.form"><ndm-selectbox ng-if="vm.g3Operator.ready" label="initial-setup.g3-operator.country" options="vm.g3Operator.countryOptions" value="vm.g3Operator.country" on-change="vm.g3Operator.onCountryChange()"></ndm-selectbox><ndm-selectbox label="initial-setup.g3-operator.operator" ng-if="vm.g3Operator.isOperatorsReady" options="vm.g3Operator.operatorOptions" value="vm.g3Operator.operator" on-change="vm.g3Operator.onOperatorChange()"></ndm-selectbox><div ng-if="vm.g3Operator.operator === vm.g3Operator.otherOperatorOption"><ndm-input label="modems.editor.usbmodem.apn" model="vm.g3Operator.customData.apn" name="modemApn"></ndm-input><ndm-input label="modems.editor.usbmodem.identity" model="vm.g3Operator.customData.identitiy" validation="login" name="modemIdentity"></ndm-input><ndm-input label="modems.editor.usbmodem.password" model="vm.g3Operator.customData.password" validation="password" name="modemPassword"></ndm-input><ndm-input label="modems.editor.usbmodem.phone" model="vm.g3Operator.customData.phone" validation="phone" name="modemPhone"></ndm-input></div></form></div></div><ndm-single-key-bind ng-if="!vm.deviceIsOffline && vm.currentStep === \'g3-operator\' && vm.g3Operator.ready && vm.g3Operator.form.$valid" key="enter" call-func="vm.g3Operator.proceed()"></ndm-single-key-bind><ndm-control-footer is-save-disabled="!vm.g3Operator.ready || vm.g3Operator.form.$invalid" prefix="3g" is-initial-setup="true" is-cancel-visible="!vm.internalConfig.authError" is-visible="true" save-label="initial-setup.btn.proceed" swap-ctrls="true" cancel-label="{{vm.internalConfig.authError ? \'initial-setup.check-conn.clear-settings-link\' : \'initial-setup.btn.back\'}}" cancel="vm.g3Operator.onCancelClick()" save="vm.g3Operator.proceed()"></ndm-control-footer></wz-step><wz-step wz-title="dsl-isp" class="step dsl-isp"><div class="setup-dsl-isp-title"><span class="primary-title" data-translate="">initial-setup.dsl-isp.title</span></div> <div class="help-text" data-translate="">initial-setup.dsl-isp.description</div> <div class="step-content-wrapper"><form novalidate=""><ndm-dsl-isp-select ng-if="vm.currentStep === \'dsl-isp\'" auto-focus="true" isp-data="vm.dslIsp.data"></ndm-dsl-isp-select></form></div><ndm-single-key-bind ng-if="vm.currentStep === \'dsl-isp\' && vm.dslIsp.canProceed()" key="enter" call-func="vm.dslIsp.proceed()"></ndm-single-key-bind><a tabindex="0" class="action-link" ng-click="vm.dslIsp.manual()" data-translate="">initial-setup.dsl-isp.manual-config</a><ndm-control-footer prefix="dslIsp" is-save-disabled="!vm.dslIsp.data.id || (vm.dslIsp.data.hasPppoeTunnel && vm.dslIsp.data.login === \'\')" is-initial-setup="true" is-visible="true" save-label="initial-setup.btn.proceed" swap-ctrls="true" cancel-label="initial-setup.btn.back" cancel="vm.goBack()" save="vm.dslIsp.proceed()"></ndm-control-footer></wz-step><wz-step wz-title="dsl-type" class="step dsl-type"><div class="primary-title" data-translate="">initial-setup.dsl-type.header</div> <div class="step-content-wrapper"><div class="help-text" data-translate="">initial-setup.dsl-type.description</div> <div class="step-content-wrapper"><div ng-if="vm.dslType.ready" class="dsl-type-btns-wrapper {{vm.isIE ? \'dsl-type-btns-wrapper--ie\' : \'\'}}"><div class="dsl-type-btn" ng-class="{\'dsl-type-btn__selected nohover tall\': vm.dslType.selected(\'adsl\')}" ng-click="vm.dslType.select(\'adsl\')"><span class="mac-option__label" data-translate="">initial-setup.dsl-type.type.adsl</span> <div ng-if="vm.dslType.ready && vm.dslType.type === \'adsl\'" class="encap-select-wrapper"><span class="top-label" data-translate="">initial-setup.dsl-type.encapsulation</span><ndm-selectbox value="vm.dslType.encapsulation" options="vm.dslType.encapOptions"></ndm-selectbox></div></div> <div class="dsl-type-btn" ng-class="{\'dsl-type-btn__selected nohover\': vm.dslType.selected(\'vdsl\')}" ng-click="vm.dslType.select(\'vdsl\')"><span class="mac-option__label" data-translate="">initial-setup.dsl-type.type.vdsl</span></div></div></div></div><ndm-single-key-bind ng-if="vm.currentStep === \'dsl-type\' && vm.dslType.canProceed()" key="enter" call-func="vm.dslType.proceed()"></ndm-single-key-bind><ndm-control-footer prefix="dslType" is-save-disabled="!vm.dslType.canProceed()" is-initial-setup="true" is-visible="true" save-label="initial-setup.btn.proceed" swap-ctrls="true" cancel-label="initial-setup.btn.back" cancel="vm.goBack()" save="vm.dslType.proceed()"></ndm-control-footer></wz-step><wz-step wz-title="dsl-type" class="step dsl-type"><div class="primary-title" data-translate="">initial-setup.dsl-type.header</div> <div class="step-content-wrapper"><div class="help-text" data-translate="">initial-setup.dsl-type.description</div> <div class="step-content-wrapper"><div ng-if="vm.dslType.ready" class="dsl-type-btns-wrapper {{vm.isIE ? \'dsl-type-btns-wrapper--ie\' : \'\'}}"><div class="dsl-type-btn" ng-class="{\'dsl-type-btn__selected nohover tall\': vm.dslType.selected(\'adsl\')}" ng-click="vm.dslType.select(\'adsl\')"><span class="mac-option__label" data-translate="">initial-setup.dsl-type.type.adsl</span> <div ng-if="vm.dslType.ready && vm.dslType.type === \'adsl\'" class="encap-select-wrapper"><span class="top-label" data-translate="">initial-setup.dsl-type.encapsulation</span><ndm-selectbox value="vm.dslType.encapsulation" options="vm.dslType.encapOptions"></ndm-selectbox></div></div> <div class="dsl-type-btn" ng-class="{\'dsl-type-btn__selected nohover\': vm.dslType.selected(\'vdsl\')}" ng-click="vm.dslType.select(\'vdsl\')"><span class="mac-option__label" data-translate="">initial-setup.dsl-type.type.vdsl</span></div></div></div></div><ndm-single-key-bind ng-if="vm.currentStep === \'dsl-type\' && vm.dslType.canProceed()" key="enter" call-func="vm.dslType.proceed()"></ndm-single-key-bind><ndm-control-footer prefix="dslType" is-save-disabled="!vm.dslType.canProceed()" is-initial-setup="true" is-visible="true" save-label="initial-setup.btn.proceed" swap-ctrls="true" cancel-label="initial-setup.btn.back" cancel="vm.goBack()" save="vm.dslType.proceed()"></ndm-control-footer></wz-step><wz-step wz-title="dsl-adsl-subtype" class="step dsl-adsl-subtype"><div class="primary-title" data-translate="">initial-setup.dsl-adsl-subtype.header</div> <div class="step-content-wrapper"><div class="help-text" data-translate="">&nbsp;</div> <div ng-if="vm.dslAdslSubtype.ready" class="step-content-wrapper"><ndm-button-list class="dsl-adsl-subtype-btns-wrapper {{::vm.isIE ? \'dsl-adsl-subtype-btns-wrapper--ie\' : \'\'}}" id="dsl-adsl-subtype" options="vm.dslAdslSubtype.subtypeOptions" model="vm.dslAdslSubtype.subtype" btn-class="dsl-adsl-subtype-btn initial-setup-btn"></ndm-button-list></div></div><ndm-single-key-bind ng-if="vm.currentStep === \'dsl-adsl-subtype\' && vm.dslAdslSubtype.canProceed()" key="enter" call-func="vm.dslAdslSubtype.proceed()"></ndm-single-key-bind><ndm-control-footer prefix="dslAdslSubtype" is-save-disabled="!vm.dslAdslSubtype.canProceed()" is-initial-setup="true" is-visible="true" save-label="initial-setup.btn.proceed" swap-ctrls="true" cancel-label="initial-setup.btn.back" cancel="vm.goBack()" save="vm.dslAdslSubtype.proceed()"></ndm-control-footer></wz-step><wz-step wz-title="adsl-vpi-vci" class="step adsl-vpi-vci"><div class="primary-title" data-translate="">initial-setup.adsl-vpi-vci.header</div> <div class="step-content-wrapper"><div class="help-text" data-translate="">initial-setup.adsl-vpi-vci.description</div> <div ng-if="vm.adslVpiVci.ready" class="step-content-wrapper"><div class="flex-container-3columns-wrapper"><div class="flex-container-3columns {{::vm.isIE ? \'flex-container-3columns--ie\' : \'\'}}"><div ng-repeat="tileRow in vm.adslVpiVci.vpiVciOptions" class="tile-row"><div ng-repeat="opt in tileRow" ng-class="{\'initial-setup-btn-selected\': vm.adslVpiVci.selectedSubtype(opt)}" ng-click="vm.adslVpiVci.selectSubtype(opt)" class="vpi-vci-btn">{{opt}}</div></div> <div class="wide-tile-row" ng-class="{\'wider-tile-row\': vm.adslVpiVci.selectedSubtype(\'manual-input\')}"><div class="vpi-vci-btn-tall" ng-class="{\'initial-setup-btn-selected taller nohover\': vm.adslVpiVci.selectedSubtype(\'manual-input\')}" ng-click="vm.adslVpiVci.selectSubtype(\'manual-input\')"><span data-translate="">initial-setup.adsl-vpi-vci.manual-input</span><br><div ng-if="vm.adslVpiVci.manualInput"><form novalidate="" name="vm.adslVpiVci.form"><ndm-input model="vm.adslVpiVci.adslData[\'vpi\']" label="initial-setup.adsl-vpi-vci.vpi" validation="required,intRange[0,255]"></ndm-input><ndm-input model="vm.adslVpiVci.adslData[\'vci\']" label="initial-setup.adsl-vpi-vci.vci" validation="required,intRange[32,65535]"></ndm-input></form></div></div></div></div></div></div></div><ndm-single-key-bind ng-if="!vm.deviceIsOffline && vm.currentStep === \'adsl-vpi-vci\' && vm.adslVpiVci.canProceed()" key="enter" call-func="vm.adslVpiVci.proceed()"></ndm-single-key-bind><ndm-control-footer prefix="adslVpiVci" is-save-disabled="!vm.adslVpiVci.canProceed()" is-initial-setup="true" is-visible="true" save-label="initial-setup.btn.proceed" swap-ctrls="true" cancel-label="initial-setup.btn.back" cancel="vm.goBack()" save="vm.adslVpiVci.proceed()"></ndm-control-footer></wz-step><wz-step wz-title="setup-vlans" class="step setup-vlans"><div class="primary-title"><span data-translate="">{{\'initial-setup.setup-vlans.\' + (vm.config.internet.kind === \'adsl\' ? \'header-vdsl\' : \'header\')}}</span></div> <div class="step-content-wrapper"><div class="help-text" data-translate="">initial-setup.setup-vlans.description</div> <div class="setup-vlans-ctrl-wrapper"><div class="setup-vlans-options"><div class="btn-column"><div ng-repeat="opt in vm.setupVlans.autoOptions" class="setup-vlans-option" ng-class="{\'setup-vlans-option__selected nohover\': vm.setupVlans.selected(opt.id)}" ng-click="vm.setupVlans.select(opt.id)"><span class="setup-vlans-option__label">{{opt.label}}</span> <div class="setup-vlans-option__description help-text">{{opt.description}}</div></div></div> <div class="btn-column"><div class="setup-vlans-option" ng-class="{\'setup-vlans-option__selected tall-option nohover\': vm.setupVlans.manualSetup}" ng-click="vm.setupVlans.select(\'setup-vlan\')"><span class="setup-vlans-option__label" data-translate="">initial-setup.setup-vlans.options.setup-vlan.label</span> <div class="setup-vlans-option__description help-text"><span ng-if="!vm.setupVlans.manualSetup" data-translate="">initial-setup.setup-vlans.options.setup-vlan.description</span> <span ng-if="vm.setupVlans.manualSetup" data-translate="">initial-setup.setup-vlans.options.setup-vlan.form-description</span></div> <div ng-if="vm.setupVlans.manualSetup"><form novalidate="" ng-if="vm.setupVlans" name="vm.setupVlans.form"><ndm-input ndm-autofocus="" name="inetVlan" model="vm.setupVlans.inetVlan" label="initial-setup.setup-vlans.form.inet-vlan" extra-validator="vm.setupVlans.vlanIsNotReserved" error="vm.setupVlans.validation.errors.inetVlan" validation="numeric,range[0..4094]"></ndm-input><ndm-input name="iptvVlan" ng-if="vm.selectedServices.indexOf(\'iptv\') > -1" model="vm.setupVlans.iptvVlan" label="initial-setup.setup-vlans.form.iptv-vlan" extra-validator="vm.setupVlans.vlanIsNotReserved" error="vm.setupVlans.validation.errors.iptvVlan" validation="numeric,range[0..4094]"></ndm-input></form></div></div></div></div></div></div><ndm-single-key-bind ng-if="!vm.deviceIsOffline && vm.currentStep === \'setup-vlans\' && vm.setupVlans.canProceed()" key="enter" call-func="vm.setupVlans.proceed()"></ndm-single-key-bind><ndm-control-footer prefix="iptv" is-save-disabled="!vm.setupVlans.canProceed()" is-initial-setup="true" is-visible="true" save-label="initial-setup.btn.proceed" swap-ctrls="true" cancel-label="initial-setup.btn.back" cancel="vm.goBack()" save="vm.setupVlans.proceed()"></ndm-control-footer></wz-step><wz-step wz-title="setup-iptv-adsl-vpivci" class="step setup-iptv-adsl-vpivci"><div class="primary-title" data-translate="">initial-setup.setup-iptv-adsl-vpivci.header</div> <div class="step-content-wrapper"><div class="help-text" data-translate="">initial-setup.setup-iptv-adsl-vpivci.description</div> <div ng-if="vm.setupIptvAdslVpivci.ready" class="setup-iptv-adsl-vpivci-wrapper"><form novalidate="" name="vm.setupIptvAdslVpivci.form"><ndm-input model="vm.setupIptvAdslVpivci.vpi" label="initial-setup.setup-iptv-adsl-vpivci.form.vpi" error-from-controller="vm.setupIptvAdslVpivci.vpiVciPairUsed" ng-keyup="vm.setupIptvAdslVpivci.checkVpiVciPair()" validation="required,numeric,intRange[0,255]"></ndm-input><ndm-input model="vm.setupIptvAdslVpivci.vci" label="initial-setup.setup-iptv-adsl-vpivci.form.vci" error-from-controller="vm.setupIptvAdslVpivci.vpiVciPairUsed" ng-keyup="vm.setupIptvAdslVpivci.checkVpiVciPair()" validation="required,numeric,intRange[32,65535]"></ndm-input></form></div></div><ndm-single-key-bind ng-if="!vm.deviceIsOffline && vm.currentStep === \'setup-iptv-adsl-vpivci\' && vm.setupIptvAdslVpivci.canProceed()" key="enter" call-func="vm.setupIptvAdslVpivci.proceed()"></ndm-single-key-bind><ndm-control-footer prefix="iptvAdsl" ng-if="vm.stepCtrl.ready" is-initial-setup="true" is-save-disabled="!vm.setupIptvAdslVpivci.canProceed()" is-visible="true" save-label="initial-setup.btn.proceed" swap-ctrls="true" cancel-label="initial-setup.btn.back" cancel="vm.goBack()" save="vm.setupIptvAdslVpivci.proceed()"></ndm-control-footer></wz-step><wz-step wz-title="check-conn" class="step check-conn"><div class="primary-title" data-translate="">initial-setup.check-conn.header</div> <div class="step-content-wrapper" ng-class="{ \'step-content-wrapper--vcentered\': !vm.checkConn.inetCheckFailed && (!vm.checkConn.updatesFinished || vm.checkConn.inetRecheckInProcess) }"><div class="check-conn-finished-stages" ng-class="{ \'check-conn-finished-stages--fixed-width\': vm.isIE || vm.isEdge }"><div ng-repeat="stage in vm.checkConn.passedStages"><div class="inet-status-wrapper" ng-show="vm.checkConn.connectionCheckFinished && !vm.checkConn.inetRecheckInProcess"><i class="icon icon--{{stage.success ? \'check-green\' : \'cancel\'}}"></i> <span data-translate="">{{\'initial-setup.check-conn.stage.\' + stage.name + \'.\' + (stage.success ? \'success\' : \'fail\')}}</span> <div ng-if="stage.additionalInfo" class="stage-additional-info stage-additional-info--{{vm.internalConfig.connType}}"><span class="body-text" ng-bind-html="stage.additionalInfo"></span></div></div></div></div> <div ng-show="!vm.checkConn.updatesFinished || vm.checkConn.inetRecheckInProcess" class="progress-bar-check-conn-wrapper hcentered" ng-class="{ \'progress-bar-check-conn-wrapper--no-progress\': vm.checkConn.inetCheckFailed }"><div class="tretiary-title stage-subtitle" ng-show="!vm.checkConn.updatesFinished"><span ng-if="vm.checkConn.stage.indexOf(\'updates\') === -1 && !vm.checkConn.inetCheckFailed" data-translate="">initial-setup.check-conn.subtitle.inet</span> <span ng-if="vm.checkConn.stage.indexOf(\'updates\') !== -1 && !vm.checkConn.error"><span ng-if="vm.checkConn.progress < 0 && vm.checkConn.checkUpdatesCallCounter < 2" data-translate="">initial-setup.check-conn.subtitle.updates-check</span> <span ng-if="vm.checkConn.progress >= 0 || vm.checkConn.checkUpdatesCallCounter > 1" data-translate="">initial-setup.check-conn.subtitle.updates</span></span></div> <div ng-show="vm.checkConn.inetRecheckInProcess" class="tretiary-title stage-subtitle"><span data-translate="">initial-setup.check-conn.subtitle.inet-recheck</span></div><ndm-progress-bar ng-if="!vm.checkConn.inetCheckFailed" ng-class="{\'ndm-progress-bar__disabled\': vm.checkConn.askForRetry && !vm.checkConn.retrying}" load-status="vm.checkConn.status" count="vm.checkConn.progress" count-is-visible="!vm.checkConn.rebootIsAbnormal" is-visible="true"></ndm-progress-bar><div class="error" ng-if="vm.checkConn.error === \'inet\' && !vm.checkConn.retrying"><div ng-if="!vm.checkConn.inetCheckFailed"><span ndm-html-compile="vm.l10n.inetCheckFailedSoFar"></span></div> <div ng-if="vm.checkConn.inetCheckFailed"><span ndm-html-compile="vm.l10n.inetCheckFailed"></span></div></div></div></div><ndm-single-key-bind ng-if="!vm.deviceIsOffline && vm.currentStep === \'check-conn\' && vm.checkConn.canProceed()" key="enter" call-func="vm.checkConn.proceed()"></ndm-single-key-bind><ndm-control-footer prefix="connectionCheck" is-save-disabled="!vm.checkConn.canProceed()" is-initial-setup="true" is-visible="!vm.transitionInProgress && !vm.checkConn.cancelDisabled" is-cancel-visible="vm.checkConn.connKindIsDsl" save-label="{{vm.checkConn.askForRetry ? \'initial-setup.btn.retry\' : \'initial-setup.btn.proceed\'}}" swap-ctrls="true" cancel-label="initial-setup.check-conn.clear-settings-link" cancel="vm.goToStep(\'conn-type\')" save="vm.checkConn.proceed()"></ndm-control-footer></wz-step><wz-step wz-title="check-iptv" class="step check-iptv"><div class="primary-title" data-translate="">{{vm.checkIptv.getHeader()}}</div> <div class="step-content-wrapper"><div class="help-text"><span ng-if="!vm.checkIptv.success && vm.checkIptv.finished" data-translate="">initial-setup.check-iptv.description-fail</span></div> <div class="iptv-check-steps-wrapper" ng-class="{ \'iptv-check-steps-wrapper--finished\': vm.checkIptv.finished, \'iptv-check-steps-wrapper--check-failed\': vm.checkIptv.finished && !vm.checkIptv.success }"><div ng-if="!vm.checkIptv.finished"><div ng-repeat="step in vm.checkIptv.stepList" class="check-step-text"><div class="step-num"><span data-translate="">initial-setup.check-iptv.step-prefix</span> &nbsp;{{$index + 1}}</div> <div class="step-text">{{step}}</div></div></div> <div ng-if="vm.checkIptv.finished" class="message-text"><span data-translate="">{{vm.checkIptv.finishedMessage}}</span></div></div> <div ng-if="!vm.checkIptv.finished || !vm.checkIptv.success" class="choices" ng-class="{\'choices--finished\': vm.checkIptv.finished}"><div class="message-text"><span data-translate="">{{vm.checkIptv.message}}</span></div> <div ng-if="!vm.checkIptv.success && vm.checkIptv.errorCount < 2" class="btns-wrapper"><div ng-repeat="btn in [\'ok\', \'fail\']" class="btn btn--long" ng-click="vm.checkIptv.onBtnClick(btn)" data-translate="">{{\'initial-setup.check-iptv.btns.\' + btn}}</div></div> <div class="proceed-btn-wrapper" ng-if="vm.checkIptv.finished"><div class="btn btn--primary" ng-click="vm.checkIptv.proceed()" data-translate="">initial-setup.btn.proceed</div></div></div><ndm-single-key-bind ng-if="!vm.deviceIsOffline && vm.currentStep === \'check-iptv\' && vm.checkIptv.finished" key="enter" call-func="vm.checkIptv.proceed()"></ndm-single-key-bind><div class="proceed-btn-wrapper" ng-if="vm.checkIptv.finished && vm.checkIptv.success"><div class="btn btn--primary" ng-click="vm.checkIptv.proceed()" data-translate="">initial-setup.btn.proceed</div></div></div></wz-step><wz-step wz-title="cyber-security" class="step cyber-security"><div class="primary-title" data-translate="">initial-setup.cyber-security.header</div> <div class="step-content-wrapper"><div class="help-text" data-translate="">initial-setup.cyber-security.sub-header</div> <div class="cyber-security-form-wrapper {{vm.isIE ? \'cyber-security-form-wrapper--ie\' : \'\'}}"><ndm-selectbox tabindex="0" ng-if="vm.cyberSecurity.ready" value="vm.cyberSecurity.internetFilter" options="vm.cyberSecurity.internetFilterOptions" label="initial-setup.cyber-security.form.internet-filter"></ndm-selectbox></div> <div class="help-text cyber-security-internet-filter-description" ng-if="vm.cyberSecurity.internetFilter !== \'none\'" data-translate="">{{\'initial-setup.cyber-security.description.\' + vm.cyberSecurity.internetFilter}}</div><ndm-single-key-bind ng-if="!vm.deviceIsOffline && vm.currentStep === \'cyber-security\'" key="enter" call-func="vm.cyberSecurity.proceed()"></ndm-single-key-bind></div><ndm-control-footer is-initial-setup="true" is-visible="true" is-cancel-visible="false" prefix="cyberSecurity" save-label="initial-setup.btn.proceed" swap-ctrls="true" cancel-label="initial-setup.btn.back" cancel="vm.goBack()" save="vm.cyberSecurity.proceed()"></ndm-control-footer></wz-step><wz-step wz-title="wifi-settings" class="step wifi-settings"><div class="primary-title" data-translate="">initial-setup.wifi-settings.header</div> <div class="step-content-wrapper"><div class="left"><div ng-cloak="" class="wifi-settings-form-wrapper" ng-click="(vm.wifiSettings.editMode || vm.wifiSettings.finishing) ? undefined : vm.wifiSettings.startEditing();" ng-class="{__edit: !!vm.wifiSettings.editMode, __noborder: !!vm.wifiSettings.finishing}"><div class="tretiary-title"><span data-translate="">initial-setup.wifi-settings.description</span> <span ng-hide="!!vm.wifiSettings.finishing"><i class="icon icon--pencil"></i></span></div><form ng-if="vm.wifiSettings" name="vm.wifiSettings.form"><ndm-input ndm-autofocus="" label="initial-setup.wifi-settings.form.ssid" model="vm.wifiSettings.ssid" validation="required,length[1..32]"></ndm-input><ndm-input label="initial-setup.wifi-settings.form.psk" validation="required,wpaPsk" model="vm.wifiSettings.psk"></ndm-input><div class="wifi-settings-form-ctrls"><button class="btn btn--primary" ng-click="vm.wifiSettings.saveSettings($event)" data-translate="">save</button> <a tabindex="0" class="action-link" ng-click="vm.wifiSettings.cancelEditing($event)" data-translate="">cancel</a></div></form><div class="wifi-settings--inline"><ndm-list ng-if="!vm.wifiSettings.editMode" info-obj="[ {label: \'initial-setup.wifi-settings.form.ssid\', info: vm.wifiSettings.ssid || \'—\'}, {label: \'initial-setup.wifi-settings.form.psk\', info: vm.wifiSettings.psk || \'—\'}]"></ndm-list></div></div></div><ndm-single-key-bind ng-if="!vm.deviceIsOffline && vm.currentStep === \'wifi-settings\' && !vm.wifiSettings.editMode" key="enter" call-func="vm.wifiSettings.goToDashboard()"></ndm-single-key-bind><div class="wifi-settings-btns"><button ng-show="!vm.wifiSettings.finishing || !vm.wifiSettings.valuesChanged" class="btn btn--primary" ng-class="{\'btn--disabled\': !!vm.wifiSettings.editMode}" ng-click="vm.wifiSettings.editMode || vm.wifiSettings.goToDashboard()" data-translate="">initial-setup.btn.finish</button> <div class="reconnect-msg-wrapper" ng-show="vm.internalConfig.connectedViaWifi && !!vm.wifiSettings.finishing && !!vm.wifiSettings.valuesChanged"><div class="tretiary-title" data-translate="">initial-setup.wifi-settings.reconnect-msg</div> <i class="icon icon--load icon--reconnect"></i></div></div></div></wz-step></wizard><div class="progress-bar-wrapper" ng-if="!vm.hideProgress"><ndm-progress-bar count="vm.progress" is-visible="true" no-transition=""></ndm-progress-bar></div></div></div></div></div>'),e.put("app/page/controlPanel/apps/afp/afp.apps.html",'<div ng-controller="AfpAppsController as AAC"><ndm-popup class="page-apps__afp page-apps__popup" is-visible="AAC.popup.getState()" header-title="apps.afp.card-title" webhelp-id="controlPanel/apps.afp" close="AAC.popup.close" save="AAC.popup.save"><ndm-device-poller ng-if="AAC.popup.opened"></ndm-device-poller><form name="AAC.form" ng-if="AAC.popup.ready()" ng-model-options="{debounce: 50}" ng-cloak="" novalidate=""><ndm-text text="apps.afp.popup-description"></ndm-text><ndm-form-header label="apps.popups.base-settings"></ndm-form-header><ndm-checkbox label="apps.afp.automount" name="afp-automount" model="AAC.model.automount"></ndm-checkbox><ndm-input label="apps.afp.hostname" model="AAC.model.hostname" name="afp-hostname" validation="asciiWithoutSpace,length[..15]"></ndm-input><br><ndm-form-header hr="hr-light-blue" label="apps.shares.title"></ndm-form-header><table ng-if="AAC.model.share.length" class="ndm-table body-text shares-table"><thead><tr><th class="table__header table__col-0" colspan="2"><span data-translate="">apps.shares.folder</span></th><th class="table__header table__col-2"><span data-translate="">apps.shares.name</span></th><th class="table__header table__col-3">Time Machine</th><th class="table__header table__col-4"></th></tr></thead><tbody><tr ng-repeat="share in AAC.model.share"><td class="table__cell table__col-0"><i class="icon-dashboard__item-icon icon icon--device"></i></td><td class="table__cell table__col-1"><div class="td-content-wrapper storage-partition"><ndm-path-overflow width="220" path="{{share.mount}}"></ndm-path-overflow><div class="help-text--warning" ng-if="!share.exists" data-translate="">apps.dlna.directory-error</div></div></td><td class="table__cell table__col-2"><ndm-input class="field label-input" model="share.label" name="afp-share-label__{{$index}}" error-from-controller="share.error" on-validation-end="AAC.isShareLabelUnique" validation="required"></ndm-input></td><td class="table__cell table__col-3"><ndm-checkbox name="afp-share-timemachine-{{$index}}" model="share.timemachine"></ndm-checkbox></td><td class="table__cell table__col-4"><a tabindex="0" class="action-link show-on-tr-hover" ng-click="AAC.actions.dropShare($index)" data-translate="">delete</a></td></tr></tbody></table><br><div ng-if="!AAC.model.share.length" class="empty-list" data-translate="">apps.shares.not-selected</div><ndm-button btn-class="{{ AAC.model.share.length ? \'\' : \'btn--primary\' }}" on-click="AAC.actions.addNewShare" label="apps.shares.add"></ndm-button><br><br><ndm-form-header hr="hr-light-blue" label="apps.popups.users"></ndm-form-header><ndm-checkbox label="apps.afp.allow-anon-access" name="afp-permissive" model="AAC.model.permissive"></ndm-checkbox><table ng-if="!AAC.model.permissive" ng-form="ACC.userAccessForm" class="ndm-table body-text users-table"><thead><tr><th class="table__header table__col-0"><span data-translate="">apps.user</span></th><th class="table__header table__col-1"><span data-translate="">apps.access</span></th></tr></thead><tbody><tr class="ndm-table__row" ng-repeat="(user, data) in AAC.users track by user"><td><div class="td-content-wrapper storage-partition">{{user}}</div></td><td class="table__col-1"><ndm-checkbox name="afp-access-{{$index}}" model="data.access"></ndm-checkbox></td></tr></tbody></table><ndm-user-add-table ng-if="!AAC.model.permissive" save-callback="AAC.actions.addUser(name)" users="AAC.users"></ndm-user-add-table><ndm-control-footer is-popup="true" is-visible="AAC.form.modified" save-disabled-timeout="0" is-save-disabled="AAC.form.$invalid || AAC.form.$error.ndmCommonValidator || AAC.popup.isLocked" save="AAC.popup.save()" cancel="AAC.popup.close()"></ndm-control-footer></form></ndm-popup></div>'),e.put("app/page/controlPanel/apps/cifs/cifs.apps.html",'<div ng-controller="CifsAppsController as CAC"><ndm-popup class="page-apps__cifs page-apps__popup" is-visible="CAC.popup.getState()" webhelp-id="controlPanel/apps.cifs" header-title="apps.cifs.card-title" close="CAC.popup.close" save="CAC.popup.save"><ndm-device-poller ng-if="CIFS.popup.opened"></ndm-device-poller><form name="CAC.form" ng-if="CAC.popup.ready()" ng-model-options="{debounce: 50}" ng-cloak="" novalidate=""><ndm-text text="apps.cifs.popup-description"></ndm-text><ndm-form-header label="apps.popups.base-settings"></ndm-form-header><ndm-checkbox label="apps.cifs.automount" name="cifs-automount" model="CAC.model.automount"></ndm-checkbox><ndm-input label="apps.cifs.hostname" model="CAC.model.hostname" name="cifs-hostname" validation="asciiWithoutSpace,length[..15]"></ndm-input><ndm-input label="apps.cifs.domainname" model="CAC.model.domainname" name="cifs-domainname" validation="asciiWithoutSpace,length[..15]"></ndm-input><br><ndm-form-header hr="hr-light-blue" label="apps.shares.title"></ndm-form-header><table ng-if="CAC.model.share.length" class="ndm-table body-text shares-table"><thead><tr><th class="table__header table__col-0" colspan="2"><span data-translate="">apps.shares.folder</span></th><th class="table__header table__col-2"><span data-translate="">apps.shares.name</span></th><th ng-if="CAC.model.timemachineFlagIsAvailable" class="table__header table__col-3">Time Machine</th><th class="table__header table__col-4"></th></tr></thead><tbody><tr ng-repeat="share in CAC.model.share track by share.mount"><td class="table__cell table__col-0"><i class="icon-dashboard__item-icon icon icon--device"></i></td><td class="table__cell table__col-1"><ndm-path-overflow width="300" path="{{::share.mount}}"></ndm-path-overflow><div ng-if="share.notFound" class="help-text--warning" data-translate="">apps.dlna.directory-error</div></td><td class="table__cell table__col-2"><ndm-input class="field label-input" model="share.label" name="cifs-share-label{{$index}}" error-from-controller="share.error" on-validation-end="CAC.isShareLabelUnique" validation="required"></ndm-input></td><td ng-if="CAC.model.timemachineFlagIsAvailable" class="table__cell table__col-3"><ndm-checkbox name="cifs-share-timemachine-{{$index}}" model="share.timemachine"></ndm-checkbox></td><td class="table__cell table__col-4"><a class="action-link show-on-tr-hover" ng-click="CAC.actions.dropShare($index)" data-translate="">delete</a></td></tr></tbody></table><br><div ng-if="!CAC.model.share.length" class="empty-list" data-translate="">apps.shares.not-selected</div> <button ng-class="{\'btn--primary\': !CAC.model.share.length}" ng-click="CAC.actions.addNewShare()" class="btn" data-translate="">apps.shares.add</button><br><br><ndm-form-header hr="hr-light-blue" label="apps.popups.users"></ndm-form-header><ndm-checkbox label="apps.cifs.allow-anon-access" name="cifs-permissive" model="CAC.model.permissive"></ndm-checkbox><table class="ndm-table body-text users-table" ng-if="!CAC.model.permissive"><thead><tr><th class="table__header table__col-0"><span data-translate="">apps.user</span></th><th class="table__header table__col-1"><span data-translate="">apps.access</span></th><th class="table__header table__col-2"><span data-translate="">apps.cifs.printers</span></th></tr></thead><tbody><tr class="ndm-table__row" ng-repeat="(user, data) in CAC.users"><td><div class="td-content-wrapper storage-partition">{{user}}</div></td><td class="table__col-1"><div class="td-content-wrapper checkbox"><input class="checkbox__input" type="checkbox" id="cifs-access__{{user}}" name="cifs-access__{{user}}" ng-value="data.access" ng-model="data.access" ng-disabled="data.printersAccess"> <label class="checkbox__label" for="cifs-access__{{user}}"></label></div></td><td class="table__col-2"><div class="td-content-wrapper checkbox"><input class="checkbox__input" type="checkbox" id="cifs-printers-access__{{user}}" name="cifs-printers-access__{{user}}" ng-value="data.printersAccess" ng-model="data.printersAccess" ng-change="CAC.actions.onClickPrinterAccess(user)"> <label class="checkbox__label" for="cifs-printers-access__{{user}}"></label></div></td></tr></tbody></table><ndm-user-add-table ng-if="!CAC.model.permissive" save-callback="CAC.actions.addUser(name)" users="CAC.users"></ndm-user-add-table><ndm-control-footer is-popup="true" is-visible="CAC.form.modified" save-disabled-timeout="0" is-save-disabled="CAC.form.$invalid || CAC.popup.isLocked" save="CAC.popup.save()" cancel="CAC.popup.close()"></ndm-control-footer></form></ndm-popup></div>'),e.put("app/page/controlPanel/apps/dlna/dlna.apps.html",'<div ng-controller="DlnaAppsController as DAC"><ndm-popup class="page-apps__dlna" is-visible="DAC.popup.getState()" header-title="apps.dlna.card-title" close="DAC.popup.cancel" webhelp-id="controlPanel/apps.dlna" save="DAC.popup.save"><ndm-device-poller ng-if="DAC.popup.isOpened"></ndm-device-poller><form name="DAC.dlnaForm" ng-if="DAC.popup.ready()" ng-model-options="{debounce: 50}" ng-cloak="" novalidate=""><ndm-text text="apps.dlna.popup-description"></ndm-text><ndm-form-header hr="hr-light-blue" label="apps.popups.base-settings"></ndm-form-header><ndm-input label="apps.dlna.port" model="DAC.model.port" description="{{DAC.l10n.defaultValue[\'port\']}}" description-click="DAC.setDefault(\'port\')" name="port" validation="portNumber"></ndm-input><ndm-input label="apps.dlna.server-name" model="DAC.model.displayName" description="{{DAC.l10n.defaultValue[\'displayName\']}}" description-click="DAC.setDefault(\'displayName\')" name="serverName" validation="length[0..63]"></ndm-input><ndm-checkbox-list label="apps.dlna.enabled-in-segments" model="DAC.model.selectedSegments" name="segments" options="DAC.segmentOptions"></ndm-checkbox-list><ndm-form-header hr="hr-light-blue" label="apps.dlna.mediateka" sub-title="apps.dlna.mediateka-description"></ndm-form-header><table ng-if="DAC.model.directoryList.length" class="ndm-table body-text mediateka-table"><thead><tr><th class="table__header table__col-0" colspan="2"><span data-translate="">apps.dlna.directory</span></th><th class="table__header table__col-2"><span data-translate="">apps.dlna.content</span></th><th class="table__header table__col-3"></th></tr></thead><tbody><tr ng-repeat="dir in DAC.model.directoryList"><td class="table__cell table__col-0"><i class="icon-dashboard__item-icon icon icon--device"></i></td><td class="table__cell table__col-1"><div class="td-content-wrapper storage-partition"><ndm-path-overflow path="{{dir.path}}" width="330"></ndm-path-overflow><span ng-if="dir.doesNotExist"><span class="help-text--warning" data-translate="">apps.dlna.directory-error</span></span></div></td><td class="table__cell table__col-2"><ndm-selectbox name="contentTypes" options="DAC.contentTypes" value="dir.mediaType"></ndm-selectbox></td><td class="table__cell table__col-3"><a class="action-link show-on-tr-hover" ng-click="DAC.actions.dropDir($index)" data-translate="">delete</a></td></tr></tbody></table><br><div ng-if="!DAC.model.directoryList.length" class="empty-list" data-translate="">apps.dlna.dir-not-selected</div><ndm-button btn-class="{{DAC.model.directory.length ? \'\' : \'btn--primary\'}}" on-click="DAC.actions.addNewFolder" label="apps.dlna.add-directory"></ndm-button><div ng-if="DAC.model.dbDirectory.path"><br><ndm-form-header hr="hr-light-blue" label="apps.dlna.mediateka-setup" sub-title="apps.dlna.mediateka-setup-description"></ndm-form-header><table class="ndm-table body-text mediateka-setup-table"><tbody><tr><td class="table__cell table__col-0"><i class="icon-dashboard__item-icon icon icon--device"></i></td><td class="table__cell table__col-1" colspan="2"><div class="td-content-wrapper storage-partition"><input type="hidden" ng-model="DAC.model.dbDirectory.path"><ndm-path-overflow path="{{DAC.model.dbDirectory.path}}" width="500"></ndm-path-overflow><span ng-if="DAC.model.dbDirectory.doesNotExist"><span class="help-text--warning" data-translate="">apps.dlna.directory-error</span></span></div></td><td class="table__cell table__col-3"><a ng-click="DAC.actions.changeDbDirectory()" class="action-link" data-translate="">apps.dlna.select-db-directory</a></td></tr></tbody></table><br><ndm-button ng-if="!DAC.model.dbDirectory.doesNotExist" is-disabled="DAC.rescanInProgress" on-click="DAC.actions.rescanAll" label="apps.dlna.update-db"></ndm-button><ndm-text ng-if="DAC.rescanInProgress">{{DAC.rescanStatus}}</ndm-text></div><ndm-control-footer prefix="dlnaApp" form="DAC.dlnaForm" is-popup="true" is-visible="DAC.dlnaForm.modified" is-save-disabled="DAC.dlnaForm.$invalid || DAC.dlnaForm.$pending" save="DAC.popup.save()" cancel="DAC.popup.cancel()"></ndm-control-footer></form></ndm-popup></div>'),e.put("app/page/controlPanel/apps/kabinet/kabinet.apps.html",'<div ng-controller="KabinetAppsController as KAC"><ndm-popup class="page-apps__kabinet page-apps__popup" is-visible="KAC.popup.getState()" header-title="apps.kabinet.popup-title" webhelp-id="controlPanel/apps.kabinet" close="KAC.popup.close" save="KAC.popup.save"><ndm-device-poller ng-if="KAC.popup.isOpened"></ndm-device-poller><form ng-if="KAC.isReady" name="KAC.form" ng-model-options="{debounce: 50}" ng-cloak="" novalidate=""><ndm-text text="apps.kabinet.popup-description"></ndm-text><ndm-input label="password" model="KAC.data.password" name="password" password="true"></ndm-input><ndm-input label="apps.kabinet.form.server-address" model="KAC.data.serverAddress" name="serverAddress" validation="required,ip"></ndm-input><ndm-checkbox label="apps.kabinet.form.set-access-level" model="KAC.data.setAccessLevel" name="setAccessLevel"></ndm-checkbox><ndm-sub-form ng-if="KAC.data.setAccessLevel"><ndm-selectbox label="apps.kabinet.form.access-level" value="KAC.data.accessLevel" name="accessLevel" options="KAC.options.accessLevel"></ndm-selectbox></ndm-sub-form><ndm-selectbox label="apps.kabinet.form.protocol-version" value="KAC.data.protocolVersion" name="protocolVersion" options="KAC.options.protocolVersion"></ndm-selectbox><ndm-selectbox label="apps.kabinet.form.connect-via" name="connectVia" options="KAC.options.interface" value="KAC.data.interface"></ndm-selectbox><ndm-control-footer prefix="kabinet" form="KAC.form" is-popup="true" is-visible="!KAC.uiIsLocked && KAC.form.modified" is-save-disabled="KAC.form.$invalid || KAC.form.$pending" save="KAC.popup.save()" cancel="KAC.popup.close()"></ndm-control-footer></form></ndm-popup></div>'),e.put("app/page/controlPanel/apps/private-cloud/private-cloud.apps.html",'<div ng-controller="PrivateCloudController as vm"><ndm-popup class="page-apps__private-cloud" is-visible="vm.popup.getState()" header-title="apps.private-cloud.card-title" webhelp-id="controlPanel/apps.private-cloud" close="vm.popup.close" save="vm.popup.save"><form name="vm.form" ng-if="vm.progress >= 100" novalidate=""><ndm-text text="{{vm.description}}"></ndm-text><div ng-if="vm.protocols.webdav"><ndm-form-header label="apps.private-cloud.webdav-settings"></ndm-form-header><div class="webdav-checkbox"><ndm-checkbox label="apps.private-cloud.internet-access" name="isPublicWEBDAV" model="vm.model.internetAccess.webdav"></ndm-checkbox><div ng-if="vm.model.isKeenDnsInstalled"><ndm-copy-to-clipboard ng-if="vm.model.keenDnsAvailable" class="form__cell form__cell--checkbox" text="{{vm.model.keenDnsLink}}"></ndm-copy-to-clipboard><span ng-if="!vm.model.keenDnsAvailable" class="form__cell form__cell--checkbox" data-translate="{{vm.model.keenDnsLink}}"></span></div></div><ndm-input label="apps.private-cloud.webdav-port" model="vm.WEBDAV_PORT" name="webdavPort" disabled="true" error="vm.samePortsError" description="apps.private-cloud.webdav-port-descr-does-not-change"></ndm-input><ndm-fs-select ng-model="vm.model.webdav.anonymousRootDir" removable-only="true" select-folder="true" name="rootDirBtn" placeholder="apps.private-cloud.directory-not-selected" label="apps.private-cloud.user-folder"></ndm-fs-select><ndm-checkbox ng-if="vm.ACL_COMPONENT_INSTALLED" name="ignoreNdmAclWebDav" label="apps.private-cloud.anonymous-access-webdav" on-change="vm.refreshForm()" model="vm.model.webdav.ignoreNdmAcl"></ndm-checkbox></div> <div ng-if="vm.protocols.sftp"><ndm-form-header label="apps.private-cloud.sftp-settings"></ndm-form-header><ndm-checkbox label="apps.private-cloud.internet-access" name="isPublicSFTP" on-value-change="vm.showSftpWarning" description="apps.private-cloud.sftp-internet-access-description" model="vm.model.internetAccess.sftp"></ndm-checkbox><ndm-input label="apps.private-cloud.ssh-port" model="vm.model.sftp.port" name="sshPort" description="{{\'apps.private-cloud.default\'| translate}} 22" description-click="vm.model.sftp.port = 22" error="vm.model.sftp.error" on-change="vm.comparePortValues" validation="portNumber,required"></ndm-input><ndm-fs-select ng-model="vm.model.sftp.anonymousRootDir" removable-only="true" select-folder="true" name="rootDirBtn" placeholder="apps.private-cloud.directory-not-selected" label="apps.private-cloud.user-folder"></ndm-fs-select><ndm-checkbox ng-if="vm.ACL_COMPONENT_INSTALLED" name="anonSFTP" label="apps.private-cloud.anonymous-access-webdav" on-change="vm.refreshForm()" model="vm.model.sftp.ignoreNdmAcl"></ndm-checkbox></div> <div ng-if="vm.protocols.ftp"><ndm-form-header label="apps.private-cloud.ftp-settings"></ndm-form-header><ndm-checkbox label="apps.private-cloud.internet-access" name="isPublicFTP" model="vm.model.internetAccess.ftp"></ndm-checkbox><ndm-input label="apps.private-cloud.ftp-port" model="vm.model.ftp.port" name="ftpPort" description="{{\'apps.private-cloud.default\'| translate}} 21" description-click="vm.model.ftp.port = 21" error="vm.model.ftp.error" on-change="vm.comparePortValues" validation="portNumber,required"></ndm-input><ndm-fs-select ng-model="vm.model.ftp.anonymousRootDir" removable-only="true" select-folder="true" name="rootDirBtn" placeholder="apps.private-cloud.directory-not-selected" label="apps.private-cloud.user-folder"></ndm-fs-select><ndm-checkbox name="anonFTP" label="apps.private-cloud.anonymous-access" on-change="vm.refreshForm()" model="vm.model.ftp.anonymousAccess"></ndm-checkbox></div><ndm-form-header hr="hr-light-blue" label="apps.private-cloud.subtitle-users"></ndm-form-header><div><div ng-include="\'app/page/controlPanel/apps/private-cloud/table.html\'"></div><ndm-user-add-table bs-modifiable="false" save-callback="vm.actions.addUser(name, password)" users="vm.users"></ndm-user-add-table></div><ndm-form-header hr="hr-light-blue"></ndm-form-header></form><ndm-control-footer prefix="privateCloudApp" is-popup="true" is-visible="vm.form.modified || (vm.newUserAdded && vm.isAnyAnonymousProtocol)" is-save-disabled="vm.form.$invalid || FAC.form.$pending" save="vm.popup.save()" cancel="vm.popup.close()"></ndm-control-footer></ndm-popup></div>'),e.put("app/page/controlPanel/apps/private-cloud/table.checkbox.html",'<div class="checkbox access-checkbox"><input ng-disabled="!protocol.isInstalled || vm.model[protocol.name].anonymousAccess" class="checkbox__input" type="checkbox" id="__private-cloud-{{user}}-{{protocol.name}}" ng-model="data[protocol.name].access" ng-value="data[protocol.name].access" ng-change="vm.refreshForm()"> <label class="checkbox__label" for="__private-cloud-{{user}}-{{protocol.name}}"></label></div>'),e.put("app/page/controlPanel/apps/private-cloud/table.folder.html",'<div class="table-folder"><input type="hidden" ng-model="data.rootDirectory"><div class="page-apps__private-cloud__folder-not-selected" ng-if="!data.rootDirectory">{{\'apps.private-cloud.directory-not-selected\' | translate}}</div> <button class="btn page-apps__private-cloud__folder-add-btn" ng-if="!data.rootDirectory" ng-click="vm.actions.changeFolder(user)">{{\'apps.private-cloud.select-directory\' | translate}}</button><div ng-if="data.rootDirectory" class="page-apps__private-cloud__path-container"><ndm-path-overflow data-path="{{data.rootDirectory}}"></ndm-path-overflow></div> <div ng-if="data.rootDirectory" ng-click="vm.actions.resetFolder(user)" class="page-apps__private-cloud__folder-reset-btn__wrapper"><div class="page-apps__private-cloud__folder-reset-btn"></div></div></div>'),e.put("app/page/controlPanel/apps/private-cloud/table.html",'<div class="users-table__container"><table ng-cloak="" class="ndm-table body-text users-table"><thead><tr><th class="table__header table__col-user"><span data-translate="">apps.private-cloud.user</span></th><th ng-repeat="protocol in vm.protocolsList" ng-if="protocol.isInstalled" class="table__header table__col-protocol"><span>{{(\'apps.private-cloud.protocols.\' + protocol.name) | translate}}</span></th><th class="table__header table__col-folder"><span data-translate="">apps.private-cloud.directory</span></th></tr></thead><tbody><tr class="ndm-table__row" ng-repeat="(user, data) in vm.users"><td><div class="td-content-wrapper"><div class="private-cloud__username-wrapper">{{ data.label ? (data.label | translate) : user }} <i ng-if="data.webdav.access && !data.hasPassword" class="private-cloud__webdav-warning icon icon--warning" ng-mouseenter="vm.webdavWarning.show()" ng-mouseleave="vm.webdavWarning.hide()"><ndm-tooltip ng-if="vm.webdavWarning.isVisible"><span class="help-text" data-translate="">apps.private-cloud.webdav.user-without-password</span></ndm-tooltip></i></div></div></td><td class="table__col-protocol" ng-repeat="protocol in vm.protocolsList" ng-if="protocol.isInstalled" ng-include="\'app/page/controlPanel/apps/private-cloud/table.checkbox.html\'"></td><td ng-include="\'app/page/controlPanel/apps/private-cloud/table.folder.html\'"></td></tr></tbody></table></div>'),e.put("app/page/controlPanel/apps/torrent/torrent.apps.html",'<div ng-controller="TorrentAppsController as TAC"><ndm-popup class="page-apps__torrent" is-visible="TAC.popup.getState()" header-title="apps.torrent.card-title" webhelp-id="controlPanel/apps.torrent" close="TAC.popup.close" save="TAC.popup.save"><ndm-device-poller ng-if="TAC.popup.opened"></ndm-device-poller><form ng-if="TAC.popup.ready()" name="TAC.torrentForm" ng-model-options="{debounce: 50}" ng-cloak="" novalidate=""><ndm-text text="apps.torrent.popup-description"></ndm-text><ndm-form-header label="apps.popups.base-settings"></ndm-form-header><ndm-input label="apps.torrent.peer-port" model="TAC.model.peerPort" name="torrent-peer-port" validation="portNumber"></ndm-input><ndm-input label="apps.torrent.rpc-port" model="TAC.model.rpcPort" name="torrent-rpc-port" description="{{TAC.l10n.defaultRpcPort}}" description-click="TAC.setDefault(\'rpcPort\')" validation="portNumber"></ndm-input><ndm-checkbox label="apps.torrent.allow-internet-access" name="torrent-inetAccess" model="TAC.model.rpcIsPublic"></ndm-checkbox><ndm-fs-select ng-model="TAC.model.directory" removable-only="true" select-folder="true" required="true" name="dbDirectoryButton" label="apps.torrent.storage-folder"></ndm-fs-select><ndm-button class="page-apps__torrent__reset-btn" ng-if="TAC.torrentForm.dbDirectoryButton.masterValue" on-click="TAC.actions.restoreSettings" label="apps.torrent.restore-settings"></ndm-button><br><ndm-form-header hr="hr-light-blue" label="apps.popups.users"></ndm-form-header><table class="ndm-table body-text users-table"><thead><tr><th class="table__header table__col-0"><span data-translate="">apps.user</span></th><th class="table__header table__col-1"><span data-translate="">apps.access</span></th></tr></thead><tbody><tr class="ndm-table__row" ng-repeat="(user, data) in TAC.users"><td><div class="td-content-wrapper">{{user}}</div></td><td class="table__col-1"><div class="td-content-wrapper checkbox"><input class="checkbox__input" type="checkbox" id="torrent-access{{$index}}" ng-value="data.access" ng-model="data.access"> <label class="checkbox__label" for="torrent-access{{$index}}"></label></div></td></tr></tbody></table><ndm-user-add-table save-callback="TAC.actions.addUser(name)" users="TAC.users"></ndm-user-add-table><ndm-control-footer prefix="torrentApp" form="TAC.torrentForm" is-popup="true" is-visible="TAC.torrentForm.modified" is-save-disabled="TAC.torrentForm.$invalid || TAC.torrentForm.$pending" save="TAC.popup.save()" cancel="TAC.popup.close()"></ndm-control-footer></form></ndm-popup></div>'),e.put("app/page/controlPanel/apps/udpxy/udpxy.apps.html",'<div ng-controller="UdpxyAppsController as UAC"><ndm-popup class="page-apps__udpxy page-apps__popup" is-visible="UAC.popup.getState()" header-title="apps.udpxy.card-title" webhelp-id="controlPanel/apps.udpxy" close="UAC.popup.close" save="UAC.popup.save"><ndm-device-poller ng-if="UAC.popup.isOpened"></ndm-device-poller><form name="UAC.form" ng-if="UAC.popup.isReady()" ng-model-options="{debounce: 50}" ng-cloak="" novalidate=""><ndm-text text="apps.udpxy.popup-description"></ndm-text><ndm-input label="apps.udpxy.form.port" model="UAC.model.port" name="port" description="{{UAC.l10n.defaultPort}}" description-click="UAC.setDefault(\'port\')" validation="required,portNumber"></ndm-input><ndm-input label="apps.udpxy.form.timeout" model="UAC.model.timeout" unit-text="time.second" name="timeout" validation="required,range[5..60]"></ndm-input><ndm-input label="apps.udpxy.form.renew-interval" model="UAC.model.renewInterval" unit-text="time.second" name="renewInterval" validation="range[0..3600]"></ndm-input><ndm-selectbox label="apps.udpxy.form.connect-via" name="connectVia" options="UAC.interfaceOptions" value="UAC.model.interface"></ndm-selectbox><ndm-control-footer prefix="udpxy" form="UAC.form" is-popup="true" is-visible="UAC.form.modified" is-save-disabled="UAC.form.$invalid || UAC.form.$pending" save="UAC.popup.save()" cancel="UAC.popup.close()"></ndm-control-footer></form></ndm-popup></div>'),e.put("app/page/controlPanel/apps/usbDeviceList/usbDeviceList.html",'<div ng-if="vm.list" ndm-polling="vm.polling" class="usb-device-list" ndm-interval="3000"><ndm-form-header hr1="hr-light-blue" label="usb-device-list.title"></ndm-form-header><ndm-table class="usb-device-list__table" ng-show="vm.list.items.length" data="vm.list.items" click-on-cell="vm.list.clickOnCell" sortable="false" columns="vm.list.columns" click-on-row="vm.list.onRowClick"></ndm-table><div ng-if="!vm.list.items.length" class="empty-list"><i ng-if="!vm.list.loaded" class="icon icon--load"></i> <span ng-if="vm.list.loaded" data-translate="">usb-device-list.no-devices</span></div><div ng-include="vm.COMPONENT_ROOT + \'printerPopup/printerPopup.apps.html\'"></div></div>'),e.put("app/page/controlPanel/apps/virtualIP/virtualIP.apps.html",'<div ng-controller="VirtualIPAppsController as vm"><ndm-popup class="page-apps__virtualIP vpn-virtualIP" is-visible="vm.popup.getState()" header-title="apps.virtualIP.popup-title" webhelp-id="controlPanel/apps.virtual-ip" close="vm.popup.close" save="vm.popup.save"><ndm-device-poller ng-if="vm.popup.opened"></ndm-device-poller><form name="vm.form" ng-if="vm.isReady" ng-model-options="{debounce: 50}" ng-cloak="" novalidate=""><ndm-text text="apps.virtualIP.popup-description"></ndm-text><ndm-form-header label="apps.popups.base-settings"></ndm-form-header><ndm-input label="apps.virtualIP.psk.label" model="vm.model.psk" description="{{vm.psk.description}}" description-click="vm.psk.toggleState" password="true" class="psk-input" readonly="vm.psk.readonly" show-password-label="show-psk" hide-password-label="hide-psk" validation="required,ascii,length[8..]" name="virtualIpPsk"></ndm-input><div ng-if="::vm.vpnserverL2tpInstalled" class="ipsec-common-psk-warning"><div ng-if="vm.psk.defined && !vm.psk.readonly"><i class="icon icon--warning"></i> <span data-translate="">apps.virtualIP.psk.warning</span></div></div><ndm-checkbox label="apps.vpn.multi-login" name="virtualIpMultiLogin" model="vm.model.isMultiLoginEnabled"></ndm-checkbox><ndm-checkbox label="apps.vpn.nat" description="apps.vpn.nat-description" name="virtualIpNat" model="vm.model.isNatEnabled"></ndm-checkbox><ndm-input label="apps.pool-start" model="vm.model.poolStart" validation="ip" name="virtualIpPoolStart"></ndm-input><ndm-input label="apps.pool-size" model="vm.model.poolSize" placeholder="2…256" validation="required,range[2..256]" name="virtualIpPoolSize"></ndm-input><ndm-input label="apps.virtualIP.dns-server" model="vm.model.dnsServer" validation="ip" name="virtualIpDnsServer"></ndm-input><ndm-form-header label="apps.popups.users"></ndm-form-header><div class="vpn-virtualIP__users-access-warning"><span data-translate="">apps.vpn-ikev2.user-access-is-shared</span></div><table class="ndm-table body-text users-table"><thead><tr><th class="table__header table__col-0"><span data-translate="">apps.user</span></th><th class="table__header table__col-1"><span data-translate="">apps.access</span></th><th class="table__header table__col-2"><span ng-if="!vm.model.isMultiLoginEnabled" data-translate="">apps.users-table.permanent-ip</span></th></tr></thead><tbody><tr ng-repeat="(user, data) in vm.users"><td><div class="td-content-wrapper storage-partition">{{user}}</div></td><td class="table__col-1"><div class="td-content-wrapper checkbox"><input class="checkbox__input" type="checkbox" id="virtualIpAccess{{$index}}" name="virtualIpAccess{{$index}}" ng-model="data.hasAccess"> <label class="checkbox__label" for="virtualIpAccess{{$index}}"></label></div></td><td><div class="td-content-wrapper"><div ng-if="!vm.model.isMultiLoginEnabled"><ndm-input class="user-ip-address" model="data.ipAddress" name="static-ip-{{user}}" placeholder="{{vm.l10n.noIpPlaceholder}}" error-from-controller="data.error" on-validation-end="vm.isUserIpUnique" validation="ip"></ndm-input></div></div></td></tr></tbody></table><ndm-user-add-table save-callback="vm.addUser(name)" users="vm.users"></ndm-user-add-table><ndm-control-footer prefix="virtualIp" form="vm.form" is-popup="true" is-visible="vm.form.modified" is-save-disabled="vm.form.$invalid || vm.form.$pending" save="vm.popup.save()" cancel="vm.popup.close()"></ndm-control-footer></form></ndm-popup></div>'),e.put("app/page/controlPanel/apps/virtualIP-stat/virtualIP-stat.apps.html",'<div ng-controller="VirtualIPStatAppsController as VIPS"><ndm-popup class="page-apps__virtualIP-stat" is-visible="VIPS.popup.getState()" header-title="apps.virtualIP-stat.popup-title" close="VIPS.popup.close" save="VIPS.popup.save"><ndm-device-poller ng-if="VIPS.popup.opened"></ndm-device-poller><br><br><table ng-if="VIPS.ready && VIPS.rows.length > 0" class="ndm-table body-text users-table"><thead><tr><th class="table__header table__col-0"><span data-translate="">apps.user</span></th><th class="table__header table__col-1"><span data-translate="">apps.vpn-stat.clientaddress</span></th><th class="table__header table__col-2"><span data-translate="">apps.vpn-stat.uptime</span></th><th class="table__header table__col-3"><span data-translate="">apps.vpn-stat.bytes</span></th></tr></thead><tbody><tr ng-repeat="row in VIPS.rows track by $index"><td class="table__col-{{$index}}">{{row.username}}</td><td class="table__col-{{$index}}">{{row.clientaddress}}</td><td class="table__col-{{$index}}">{{row.uptime}}</td><td class="table__col-{{$index}}">{{row.bytes}}</td></tr></tbody></table><div ng-if="VIPS.ready && VIPS.rows.length === 0" class="empty-list" data-translate="">apps.vpn-no-clients</div></ndm-popup></div>'),e.put("app/page/controlPanel/apps/vpn-ikev2/vpn-ikev2.apps.html",'<div ng-controller="VpnIkeV2AppsController as vm"><ndm-popup class="page-apps__vpn-ikev2 vpn-ikev2" is-visible="vm.popup.getState()" header-title="apps.vpn-ikev2.card-title" webhelp-id="controlPanel/apps.vpn-ikev2" close="vm.popup.close" save="vm.popup.save"><form ng-if="vm.isReady" name="vm.form" ng-model-options="{debounce: 50}" novalidate=""><ndm-text text="apps.vpn-ikev2.popup-description"></ndm-text><ndm-form-header label="apps.popups.base-settings"></ndm-form-header><ndm-checkbox label="apps.vpn-ikev2.form.multiple-sign-in" name="ikeV2MultiLogin" model="vm.model.isMultiLoginEnabled"></ndm-checkbox><ndm-checkbox label="apps.vpn-ikev2.form.nat" description="apps.vpn-ikev2.form.nat-description" name="ikeV2Nat" model="vm.model.isNatEnabled"></ndm-checkbox><ndm-input label="apps.vpn-ikev2.form.start-ip-address" model="vm.model.poolStart" validation="ip" name="ikeV2IpPoolStart"></ndm-input><ndm-input label="apps.vpn-ikev2.form.ip-pool-size" model="vm.model.poolSize" placeholder="2…256" validation="required,range[2..256]" name="ikeV2IpPoolSize"></ndm-input><ndm-input label="apps.vpn-ikev2.form.dns-server" model="vm.model.dnsServer" validation="ip" name="ikeV2DnsServer"></ndm-input><ndm-form-header label="apps.popups.users"></ndm-form-header><div class="vpn-ikev2__users-access-warning"><span data-translate="">apps.vpn-ikev2.user-access-is-shared</span></div><table class="ndm-table body-text users-table"><thead><tr><th class="table__header table__col-0"><span data-translate="">apps.user</span></th><th class="table__header table__col-1"><span data-translate="">apps.access</span></th><th class="table__header table__col-2"><span ng-if="!vm.model.isMultiLoginEnabled" data-translate="">apps.users-table.permanent-ip</span></th></tr></thead><tbody><tr ng-repeat="(user, data) in vm.users"><td><div class="td-content-wrapper">{{user}}</div></td><td class="table__col-1"><div class="td-content-wrapper checkbox"><input class="checkbox__input" type="checkbox" id="vpn-ikev2-access{{$index}}" name="vpn-ikev2-access{{$index}}" ng-change="vm.onUserAccessChange(user)" ng-model="data.hasAccess"> <label class="checkbox__label" for="vpn-ikev2-access{{$index}}"></label></div></td><td><div class="td-content-wrapper"><div ng-if="!vm.model.isMultiLoginEnabled"><ndm-input class="user-ip-address" model="data.ipAddress" name="static-ip-{{user}}" placeholder="{{vm.l10n.noIpPlaceholder}}" error-from-controller="data.error" on-validation-end="vm.isUserIpUnique" validation="ip"></ndm-input></div></div></td></tr></tbody></table><ndm-user-add-table save-callback="vm.addUser(name)" users="vm.usersList"></ndm-user-add-table></form><ndm-control-footer prefix="vpn-ikev2" form="vm.form" is-popup="true" is-visible="vm.form.modified" is-save-disabled="vm.form.$invalid || vm.form.$pending" save="vm.popup.save()" cancel="vm.popup.close()"></ndm-control-footer></ndm-popup></div>'),e.put("app/page/controlPanel/apps/vpn-ikev2-stat/vpn-ikev2-stat.apps.html",'<div ng-controller="VpnIkeV2StatAppsController as vm"><ndm-popup class="page-apps__vpn-ikev2-stat" is-visible="vm.popup.getState()" header-title="apps.vpn-ikev2-stat.popup-title" close="vm.popup.close" save="vm.popup.save"><br><br><table ng-if="vm.ready && vm.rows.length > 0" class="ndm-table body-text users-table"><thead><tr><th class="table__header table__col-0"><span data-translate="">apps.user</span></th><th class="table__header table__col-1"><span data-translate="">apps.vpn-stat.clientaddress</span></th><th class="table__header table__col-2"><span data-translate="">apps.vpn-stat.uptime</span></th><th class="table__header table__col-3"><span data-translate="">apps.vpn-stat.bytes</span></th></tr></thead><tbody><tr ng-repeat="row in vm.rows track by $index"><td class="table__col-{{$index}}">{{row.username}}</td><td class="table__col-{{$index}}">{{row.clientaddress}}</td><td class="table__col-{{$index}}">{{row.uptime}}</td><td class="table__col-{{$index}}">{{row.bytes}}</td></tr></tbody></table><div ng-if="vm.ready && vm.rows.length === 0" class="empty-list" data-translate="">apps.vpn-no-clients</div></ndm-popup></div>'),e.put("app/page/controlPanel/apps/vpn-l2tp/vpn-l2tp.apps.html",'<div ng-controller="VpnL2tpAppsController as VLAC"><ndm-popup class="page-apps__vpn-l2tp" is-visible="VLAC.popup.getState()" header-title="apps.vpn-l2tp.card-title" webhelp-id="controlPanel/apps.l2tp" close="VLAC.popup.close" save="VLAC.popup.save"><ndm-device-poller ng-if="VLAC.popup.opened"></ndm-device-poller><form ng-if="VLAC.ready" name="VLAC.form" ng-model-options="{debounce: 50}" novalidate=""><ndm-text text="apps.vpn-l2tp.popup-description"></ndm-text><ndm-form-header label="apps.popups.base-settings"></ndm-form-header><ndm-input label="apps.vpn-l2tp.form.psk.label" model="VLAC.model.psk" name="ipsecPsk" password="true" class="psk-input" readonly="VLAC.psk.readonly" show-password-label="show-psk" hide-password-label="hide-psk" description="{{VLAC.psk.description}}" description-click="VLAC.psk.toggleState" validation="required,ascii,length[8..]"></ndm-input><div ng-if="::VLAC.virtualIpInstalled" class="ipsec-common-psk-warning"><div ng-if="VLAC.psk.defined && !VLAC.psk.readonly"><i class="icon icon--warning"></i> <span data-translate="">apps.vpn-l2tp.form.psk.warning</span></div></div><ndm-checkbox label="apps.vpn-l2tp.form.multi-login" name="l2tp_multi-login" model="VLAC.model[\'multi-login\']"></ndm-checkbox><ndm-checkbox label="apps.vpn-l2tp.form.nat.label" description="apps.vpn-l2tp.form.nat.description" name="l2tp_nat" model="VLAC.model.nat"></ndm-checkbox><ndm-selectbox label="apps.vpn-l2tp.form.segment" name="l2tp_segment" options="VLAC.segments" value="VLAC.model.interface"></ndm-selectbox><ndm-input label="apps.pool-start" model="VLAC.model[\'pool-start\']" name="l2tp_pool-range-begin" validation="required,ip"></ndm-input><ndm-input label="apps.pool-size" model="VLAC.model[\'pool-size\']" name="l2tp_pool-range-size" placeholder="2…256" validation="required,range[2..256]"></ndm-input><ndm-form-header label="apps.popups.users"></ndm-form-header><table class="ndm-table body-text users-table"><thead><tr><th class="table__header table__col-0"><span data-translate="">apps.user</span></th><th class="table__header table__col-1"><span data-translate="">apps.access</span></th><th class="table__header table__col-2"><span ng-if="!VLAC.model[\'multi-login\']" data-translate="">apps.users-table.permanent-ip</span></th></tr></thead><tbody><tr ng-repeat="(user, data) in VLAC.users"><td><div class="td-content-wrapper storage-partition">{{user}}</div></td><td class="table__col-1"><div class="td-content-wrapper checkbox"><input class="checkbox__input" type="checkbox" id="vpn-l2tp-access{{$index}}" name="vpn-l2tp-access{{$index}}" ng-value="data.access" ng-change="VLAC.revalidateIpAddresses(user)" ng-model="data.access"> <label class="checkbox__label" for="vpn-l2tp-access{{$index}}"></label></div></td><td><div class="td-content-wrapper"><div ng-if="!VLAC.model[\'multi-login\']"><ndm-input class="user-ip-address" model="data.address" name="static-ip-{{user}}" placeholder="{{VLAC.l10n.noIpPlaceholder}}" error-from-controller="data.error" validation="ip,userIpIsUnique[{{user}}]"></ndm-input></div></div></td></tr></tbody></table><ndm-user-add-table save-callback="VLAC.addUser(name)" users="VLAC.users"></ndm-user-add-table><ndm-control-footer prefix="vpn-l2tp" form="VLAC.form" is-popup="true" is-visible="VLAC.form.modified" is-save-disabled="VLAC.form.$invalid || VLAC.form.$pending" save="VLAC.popup.save()" cancel="VLAC.popup.close()"></ndm-control-footer></form></ndm-popup></div>'),e.put("app/page/controlPanel/apps/vpn-l2tp-stat/vpn-l2tp-stat.apps.html",'<div ng-controller="VpnL2tpStatAppsController as VLSAC"><ndm-popup class="page-apps__vpn-l2tp-stat" is-visible="VLSAC.popup.getState()" header-title="apps.vpn-l2tp-stat.popup-title" close="VLSAC.popup.close" save="VLSAC.popup.save"><ndm-device-poller ng-if="VLSAC.popup.opened"></ndm-device-poller><br><br><table ng-if="VLSAC.ready && VLSAC.rows.length > 0" class="ndm-table body-text users-table"><thead><tr><th class="table__header table__col-0"><span data-translate="">apps.vpn-stat.username</span></th><th class="table__header table__col-1"><span data-translate="">apps.vpn-stat.clientaddress</span></th><th class="table__header table__col-2"><span data-translate="">apps.vpn-stat.uptime</span></th><th class="table__header table__col-3"><span data-translate="">apps.vpn-stat.bytes</span></th></tr></thead><tbody><tr ng-repeat="row in VLSAC.rows track by $index"><td class="table__col-{{$index}}">{{row.username}}</td><td class="table__col-{{$index}}">{{row.clientaddress}}</td><td class="table__col-{{$index}}">{{row.uptime}}</td><td class="table__col-{{$index}}">{{row.bytes}}</td></tr></tbody></table><div ng-if="VLSAC.ready && VLSAC.rows.length === 0" class="empty-list" data-translate="">apps.vpn-no-clients</div></ndm-popup></div>'),e.put("app/page/controlPanel/apps/vpn-server/vpn-server.apps.html",'<div ng-controller="VpnAppsController as VAC"><ndm-popup class="page-apps__vpn" is-visible="VAC.popup.getState()" header-title="apps.vpn.card-title" webhelp-id="controlPanel/apps.vpn" close="VAC.popup.close" save="VAC.popup.save"><ndm-device-poller ng-if="VAC.popup.opened"></ndm-device-poller><form name="VAC.form" ng-if="VAC.popup.ready()" ng-model-options="{debounce: 50}" ng-cloak="" novalidate=""><ndm-text text="apps.vpn.popup-description"></ndm-text><ndm-form-header label="apps.popups.base-settings"></ndm-form-header><ndm-checkbox label="apps.vpn.multi-login" name="multi-login" model="VAC.model[\'multi-login\']"></ndm-checkbox><ndm-checkbox label="apps.vpn.mppe-required" name="mppe-required" model="VAC.model.mppeRequired"></ndm-checkbox><ndm-checkbox label="apps.vpn.nat" description="apps.vpn.nat-description" name="isNatEnabled" model="VAC.model.isNatEnabled"></ndm-checkbox><ndm-selectbox label="apps.vpn.segment-access" name="segment" options="VAC.segments" value="VAC.model.interface"></ndm-selectbox><ndm-input label="apps.pool-start" model="VAC.model[\'pool-range\'].begin" validation="required,ip" name="pool-range-begin"></ndm-input><ndm-input label="apps.pool-size" model="VAC.model[\'pool-range\'].size" placeholder="1…200" validation="required,range[1..200]" name="pool-range-size"></ndm-input><ndm-form-header label="apps.popups.users"></ndm-form-header><table class="ndm-table body-text users-table"><thead><tr><th class="table__header table__col-0"><span data-translate="">apps.user</span></th><th class="table__header table__col-1"><span data-translate="">apps.access</span></th><th class="table__header table__col-2"><span ng-if="!VAC.model[\'multi-login\']" data-translate="">apps.vpn.permanent-ip</span></th></tr></thead><tbody><tr ng-repeat="(username, data) in VAC.users"><td><div class="td-content-wrapper storage-partition">{{username}}</div></td><td class="table__col-1"><div class="td-content-wrapper checkbox"><input class="checkbox__input" type="checkbox" id="vpnaccess{{$index}}" name="vpnaccess{{$index}}" ng-value="data.access" ng-model="data.access"> <label class="checkbox__label" for="vpnaccess{{$index}}"></label></div></td><td><div class="td-content-wrapper"><div ng-if="!VAC.model[\'multi-login\']"><ndm-input class="user-ip-address" model="data.address" name="static-ip-{{username}}" placeholder="{{VAC.l10n.dynamicIp}}" error-from-controller="data.error" validation="ip,pptpUserIpIsUnique[{{username}}]"></ndm-input></div></div></td></tr></tbody></table><ndm-user-add-table save-callback="VAC.actions.addUser(name)" users="VAC.users"></ndm-user-add-table><ndm-control-footer prefix="vpnServer" form="VAC.form" is-popup="true" is-visible="VAC.form.modified" is-save-disabled="VAC.form.$invalid || VAC.form.$pending" save="VAC.popup.save()" cancel="VAC.popup.close()"></ndm-control-footer></form></ndm-popup></div>'),e.put("app/page/controlPanel/apps/vpn-server-stat/vpn-server-stat.apps.html",'<div ng-controller="VpnStatAppsController as VSAC"><ndm-popup class="page-apps__vpn-server-stat" is-visible="VSAC.popup.getState()" header-title="apps.vpn-stat.popup-title" close="VSAC.popup.close" save="VSAC.popup.save"><ndm-device-poller ng-if="VSAC.popup.opened"></ndm-device-poller><br><br><table ng-if="VSAC.ready && VSAC.rows.length > 0" class="ndm-table body-text users-table"><thead><tr><th class="table__header table__col-0"><span data-translate="">apps.vpn-stat.clientaddress</span></th><th class="table__header table__col-1"><span data-translate="">apps.vpn-stat.username</span></th><th class="table__header table__col-2"><span data-translate="">apps.vpn-stat.uptime</span></th><th class="table__header table__col-4"><span data-translate="">apps.vpn-stat.bytes</span></th></tr></thead><tbody><tr ng-repeat="row in VSAC.rows track by $index"><td class="table__col-{{$index}}">{{row.clientaddress}}</td><td class="table__col-{{$index}}">{{row.username}}</td><td class="table__col-{{$index}}">{{row.uptime}}</td><td class="table__col-{{$index}}">{{row.bytes}}</td></tr></tbody></table><div ng-if="VSAC.ready && VSAC.rows.length === 0" class="empty-list" data-translate="">apps.vpn-no-clients</div></ndm-popup></div>'),e.put("app/page/controlPanel/apps/vpn-sstp/vpn-sstp.apps.html",'<div ng-controller="VpnSstpAppsController as VpnSstpCtrl"><ndm-popup class="page-apps__vpn-sstp" is-visible="VpnSstpCtrl.popup.getState()" header-title="apps.vpn-sstp.card-title" webhelp-id="controlPanel/apps.sstp" close="VpnSstpCtrl.popup.close" save="VpnSstpCtrl.popup.save"><ndm-device-poller ng-if="VpnSstpCtrl.popup.opened"></ndm-device-poller><form name="VpnSstpCtrl.form" ng-if="VpnSstpCtrl.popup.ready()" ng-model-options="{debounce: 50}" ng-cloak="" novalidate=""><ndm-text text="apps.vpn-sstp.popup-description"></ndm-text><ndm-form-header label="apps.popups.base-settings"></ndm-form-header><ndm-checkbox label="apps.vpn-sstp.multi-login" name="multi-login" model="VpnSstpCtrl.model[\'multi-login\']"></ndm-checkbox><ndm-checkbox label="apps.vpn-sstp.nat" description="apps.vpn-sstp.nat-description" name="isNatEnabled" model="VpnSstpCtrl.model.isNatEnabled"></ndm-checkbox><ndm-selectbox label="apps.vpn-sstp.segment-access" name="segment" options="VpnSstpCtrl.segments" value="VpnSstpCtrl.model.interface"></ndm-selectbox><ndm-input label="apps.pool-start" model="VpnSstpCtrl.model[\'pool-range\'].begin" name="pool-range-begin" validation="required,ip"></ndm-input><ndm-input label="apps.pool-size" model="VpnSstpCtrl.model[\'pool-range\'].size" name="pool-range-size" placeholder="1…200" validation="required,range[1..200]"></ndm-input><br><ndm-form-header hr="hr-light-blue" label="apps.popups.users"></ndm-form-header><table class="ndm-table body-text users-table"><thead><tr><th class="table__header table__col-0"><span data-translate="">apps.user</span></th><th class="table__header table__col-1"><span data-translate="">apps.access</span></th><th class="table__header table__col-2"><span ng-if="!VpnSstpCtrl.model[\'multi-login\']" data-translate="">apps.users-table.permanent-ip</span></th></tr></thead><tbody><tr ng-repeat="(user, data) in VpnSstpCtrl.users"><td><div class="td-content-wrapper storage-partition">{{user}}</div></td><td class="table__col-1"><div class="td-content-wrapper checkbox"><input class="checkbox__input" type="checkbox" id="vpn-sstp-access{{$index}}" name="vpn-sstp-access{{$index}}" ng-value="data.access" ng-change="VpnSstpCtrl.revalidateIpAddresses()" ng-model="data.access"> <label class="checkbox__label" for="vpn-sstp-access{{$index}}"></label></div></td><td><div class="td-content-wrapper"><div ng-if="!VpnSstpCtrl.model[\'multi-login\']"><ndm-input class="user-ip-address" model="data.address" name="static-ip-{{user}}" placeholder="{{VpnSstpCtrl.l10n.noIpPlaceholder}}" error-from-controller="data.error" validation="ip,sstpUserIpIsUnique[{{user}}]"></ndm-input></div></div></td></tr></tbody></table><ndm-user-add-table save-callback="VpnSstpCtrl.addUser(name)" users="VpnSstpCtrl.users"></ndm-user-add-table><ndm-control-footer prefix="vpnSstpServer" form="VpnSstpCtrl.form" is-popup="true" is-visible="VpnSstpCtrl.form.modified" is-save-disabled="VpnSstpCtrl.form.$invalid || VpnSstpCtrl.form.$pending" save="VpnSstpCtrl.popup.save()" cancel="VpnSstpCtrl.popup.close()"></ndm-control-footer></form></ndm-popup></div>'),e.put("app/page/controlPanel/apps/vpn-sstp-stat/vpn-sstp-stat.apps.html",'<div ng-controller="VpnSstpStatAppsController as VSSAC"><ndm-popup class="page-apps__vpn-sstp-stat" is-visible="VSSAC.popup.getState()" header-title="apps.vpn-sstp-stat.popup-title" close="VSSAC.popup.close" save="VSSAC.popup.save"><ndm-device-poller ng-if="VSSAC.popup.opened"></ndm-device-poller><br><br><table ng-if="VSSAC.ready && VSSAC.rows.length > 0" class="ndm-table body-text users-table"><thead><tr><th class="table__header table__col-0"><span data-translate="">apps.vpn-stat.username</span></th><th class="table__header table__col-1"><span data-translate="">apps.vpn-stat.clientaddress</span></th><th class="table__header table__col-2"><span data-translate="">apps.vpn-stat.uptime</span></th><th class="table__header table__col-3"><span data-translate="">apps.vpn-stat.bytes</span></th></tr></thead><tbody><tr ng-repeat="row in VSSAC.rows track by $index"><td class="table__col-{{$index}}">{{row.username}}</td><td class="table__col-{{$index}}">{{row.clientaddress}}</td><td class="table__col-{{$index}}">{{row.uptime}}</td><td class="table__col-{{$index}}">{{row.bytes}}</td></tr></tbody></table><div ng-if="VSSAC.ready && VSSAC.rows.length === 0" class="empty-list" data-translate="">apps.vpn-no-clients</div></ndm-popup></div>'),e.put("app/page/controlPanel/control/administrator/administrator.html",'<ndm-page class="page-administrator" label="administrator.title" description="administrator.description" progress="vm.progress"><ndm-polling ndm-timeout="3000" ndm-polling="vm.polling"></ndm-polling><ndm-form-header label="administrator.list.title"></ndm-form-header><ndm-text text="administrator.list.header-sub-title"></ndm-text><div class="_users_list_table"><ndm-table ng-if="vm.list.table.data.length > 0" data="vm.list.table.data" columns="vm.list.table.columns" sort-name="vm.list.table.order" sortable="false" track-by-prop="login" sort-reverse="vm.list.table.desc" click-on-row="vm.list.rowClick"></ndm-table><div ng-if="vm.list.table.data.length === 0" class="empty-list" data-translate="">administrator.list.no-data</div><ndm-button btn-class="btn--long" on-click="vm.list.addClick" label="administrator.list.add-button"></ndm-button></div><form name="vm.config.form" novalidate="" class="_webaccess" ng-class="{ _loading: vm.config.loading, \'_webaccess--modified\': vm.config.form.modified }"><ndm-form-header label="administrator.webaccess.ports-header"></ndm-form-header><ndm-text text="administrator.webaccess.ports-description"></ndm-text><ndm-selectbox ng-if="vm.config.options.httpPort.length > 0" class="page-administrator__http-port-selectbox" label="administrator.webaccess.http-port" value="vm.config.data[vm.SERVICE.HTTP].port" disabled="NDM.DEVICE_IS_MWS_MEMBER" is-description-disabled="NDM.DEVICE_IS_MWS_MEMBER" ndm-disabled-by-mws-tooltip="" description="{{vm.config.isDefaultHttpPortUsed ? \'\' : vm.l10n.defaultHttpPort}}" on-description-click="vm.setDefaultServicePort(vm.SERVICE.HTTP)" name="http_port" on-value-change="vm.revalidatePorts" error="{{vm.portError[vm.SERVICE.HTTP]}}" options="vm.config.options.httpPort"></ndm-selectbox><ndm-input label="administrator.webaccess.telnet-port" model="vm.config.data[vm.SERVICE.TELNET].port" description="{{\'default\' | translate}}: {{::vm.DEFAULT_PORT[vm.SERVICE.TELNET]}}" description-click="vm.setDefaultServicePort(vm.SERVICE.TELNET)" name="telnet_port" max-length="5" on-validation-end="vm.revalidatePorts" error="vm.portError[vm.SERVICE.TELNET]" validation="required,portNumber"></ndm-input><ndm-input ng-if="::vm.SSH_COMPONENT_INSTALLED" label="administrator.webaccess.ssh-port" model="vm.config.data[vm.SERVICE.SSH].port" description="{{\'default\' | translate}}: {{::vm.DEFAULT_PORT[vm.SERVICE.SSH]}}" description-click="vm.setDefaultServicePort(vm.SERVICE.SSH)" name="ssh_port" max-length="5" on-validation-end="vm.revalidatePorts" error="vm.portError[vm.SERVICE.SSH]" validation="required,portNumber"></ndm-input><div class="form__row page-administrator__web-access-block"><ndm-form-header label="administrator.webaccess.header"></ndm-form-header><ndm-selectbox ndm-disabled-by-mws-tooltip="" disabled="!vm.isAllAdminsHavePassword || NDM.DEVICE_IS_MWS_MEMBER" label="administrator.webaccess.security-level" value="vm.config.data.webAccessLevel" name="webAccessLevel" options="vm.config.options.webAccessLevels"><span ng-if="!vm.isAllAdminsHavePassword && !NDM.DEVICE_IS_MWS_MEMBER" class="help-text" data-translate="">administrator.no-password-no-access</span></ndm-selectbox><div ng-if="!vm.isSpecialMode"><div class="form__cell form__cell--input-label help-text" data-translate="">administrator.webaccess.access-by-internet</div> <div class="form__cell form__cell--checkbox"><div ng-if="vm.isAllAdminsHavePassword && service !== vm.SERVICE.HTTP" ng-repeat="service in vm.webaccessServicesList"><div class="_checkbox_row"><input class="checkbox__input" type="checkbox" ng-attr-id="{{\'vm_config_\' + service + \'_enabled_input\'}}" ng-attr-name="{{service + \'_enabled\'}}" ng-model="vm.config.data[service].enabled"> <label class="checkbox__label" ng-attr-for="{{\'vm_config_\' + service + \'_enabled_input\'}}"></label> <span class="checkbox__label-text" data-translate="">{{\'administrator.webaccess.\' + service + \'-checkbox\'}}</span></div></div> <div class="_checkbox_row" ng-if="!vm.isAllAdminsHavePassword"><input class="checkbox__input" type="checkbox" id="vm_config_no_password_no_access" disabled="disabled"> <label class="checkbox__label" for="vm_config_no_password_no_access"></label> <span class="checkbox__label-text help-text" data-translate="">administrator.no-password-no-access</span></div></div></div></div></form><ndm-control-footer prefix="webaccess" form="vm.config.form" is-visible="vm.config.form.modified" is-save-disabled="vm.config.form.$invalid || vm.config.loading || vm.editor.form.$pending" save="vm.config.submit()"></ndm-control-footer></ndm-page><ndm-popup is-visible="1" ng-if="vm.editor.visible" header-title="{{ vm.editor.id ? (vm.editor.id === vm.DEFAULT_USER ? (\'administrator.editor.title-admin\' | translate) : (vm.editor.id + \'&#x2063;\')) : (\'administrator.editor.title-add\' | translate) }}" close="vm.editor.close"><form name="vm.editor.form" class="administrator_editor_form" ng-class="{\'_pending\': vm.editor.loading}" novalidate=""><ndm-text text="{{ vm.editor.id === vm.DEFAULT_USER ? \'administrator.editor.description-admin\' : \'administrator.editor.description\' }}"></ndm-text><ndm-input ng-if="!vm.editor.id" label="administrator.editor.login" model="vm.editor.data.login" name="username" max-length="32" on-change="vm.editor.resetNdmErrors" focus-when="vm.editor.ndmErrors.login" error-from-controller="vm.editor.ndmErrors.login" validation="required,username,editorLoginUniqValidation" disable-autocomplete="true"></ndm-input><div ng-if="vm.editor.id" class="ndm-list form__row"><span class="form__cell form__cell--input-label" data-translate="">administrator.editor.login</span> <span class="form__cell">{{ vm.editor.id }}</span></div><ndm-input ndm-disabled-by-mws-tooltip="" disabled="vm.editor.id === vm.DEFAULT_USER && NDM.DEVICE_IS_MWS_MEMBER" label="administrator.editor.password" model="vm.editor.data.password" password="true" placeholder="{{vm.editor.passwordIsNotEmpty ? \'administrator.editor.change-password-placeholder\' : \'administrator.editor.set-password\' | translate}}" on-validation-end="vm.revalidatePassword" error="vm.editor.error.password" validation="password,length[..32]" name="password1"></ndm-input><ndm-input ndm-disabled-by-mws-tooltip="" class="page-administrator__password-confirmation" disabled="vm.editor.id === vm.DEFAULT_USER && NDM.DEVICE_IS_MWS_MEMBER" label="administrator.editor.repeat-password" model="vm.editor.data.password2" password="true" on-validation-end="vm.revalidatePassword" error="vm.editor.error.password2" validation="password,length[..32]" name="password2"></ndm-input><ndm-form-header ng-if="vm.editor.id !== vm.DEFAULT_USER" label="administrator.editor.tags-header"></ndm-form-header><div class="user-tags"><div class="user-tags__header user-tags__tag"><div class="tag__name" data-translate="">administrator.editor.tags-table-column.name</div> <div class="tag__description" data-translate="">administrator.editor.tags-table-column.description</div></div> <div ng-repeat="tagData in vm.editor.tags" class="user-tags__tag tag"><div class="tag__name"><ndm-checkbox disabled="vm.editor.id === vm.DEFAULT_USER && (tagData.tag === \'cli\' || tagData.tag === \'readonly\')" name="{{::(tagData.tag + \'__isEnabled\')}}" on-change="vm.editor.onTagStateChange(tagData.tag, !tagData.isEnabled)" model="tagData.isEnabled"></ndm-checkbox><div class="tag-label" title="{{tagData.description | translate}}" data-translate="">{{::tagData.name}}</div></div> <div class="tag__description"><span class="help-text" data-translate="">{{::tagData.description}}</span></div></div></div><div ng-if="vm.editor.id && vm.editor.id !== vm.DEFAULT_USER"><hr class="hr-invisible"><ndm-button btn-class="btn--long _del-btn" on-click="vm.editor.delete" is-disabled="vm.editor.loading" label="administrator.editor.delete-button"></ndm-button></div><ndm-control-footer prefix="userEditor" is-popup="true" is-visible="vm.editor.footerIsVisible && (vm.editor.form.modified || !vm.editor.id)" is-save-disabled="vm.editor.form.$invalid || vm.editor.loading" save="vm.editor.submit()" cancel="vm.editor.close()"></ndm-control-footer></form></ndm-popup>'),e.put("app/page/controlPanel/control/credits/credits.html",'<ndm-page class="page-credits" label="credits.title" description="credits.description" progress="vm.progress"><div class="packages-list"><div ng-repeat="packageData in vm.packages track by $index" class="credits-package"><div class="credits-package__id">{{packageData.id}}</div> <div class="credits-package__title">{{packageData.title}}</div><ndm-link is-disabled="packageData.hasNoLicenses" link-class="credits-package__toggle-license-link" on-click="vm.togglePackageLicense(packageData)" label="{{packageData.licenseIsVisible ? \'credits.hide-license-link\' : \'credits.show-license-link\'}}"></ndm-link><a class="credits-package__homepage-link external-link" ng-class="{ \'credits-package__homepage-link--disabled\': !packageData.homepage }" ng-click="!packageData.homepage && $event.preventDefault();" href="{{packageData.homepage}}" target="_blank" data-translate="">credits.homepage-link</a> <div class="credits-package__license-text" ng-class="{ \'credits-package__license-text--visible\': packageData.licenseIsVisible }"><pre ng-bind-html="packageData.licenseText"></pre></div></div></div></ndm-page>'),e.put("app/page/controlPanel/control/diagnostics/diagnostics.connections.html",'<hr class="hr-light-blue"><ndm-form-header label="diagnostics.connections.title"></ndm-form-header><ndm-text text="diagnostics.connections.description"></ndm-text><div ndm-polling="vm.connections.polling" ndm-interval="6000"></div> <div ng-if="!vm.connections.noData"><table class="ndm-table page-diagnostics__connections__table"><thead><tr class="page-diagnostics__connections__table-header"><th ng-repeat="(key, value) in vm.connections.table.sourceColumns" ng-click="vm.connections.sortBy(key)" class="table__header table__col-{{$index}} sortable" ng-style="{ \'width\': (value.width && value.width + \'px\' || \'auto\') }"><span data-translate="">{{::value.title || value}}</span> <i class="icon sort-asc" ng-class="{\'sort-desc\': vm.connections.sort.reverse, \'hidden\': key !== vm.connections.sort.name}"></i></th></tr></thead><tbody ng-repeat="hostData in vm.connections.hostData | orderBy:[]:false:vm.connections.sortFn" ng-init="data = vm.connections.connRows[hostData.host]"><tr ng-click="data.tableIsVisible = !data.tableIsVisible" ng-class="{\'host-row--expanded\': data.tableIsVisible}" class="ndm-table__row host-row"><td ng-repeat="(key, value) in vm.connections.table.sourceColumns" class="table__col-{{$index}}" ng-style="{ \'width\': (value.width && value.width + \'px\' || \'auto\') }"><div ng-if="$index === 0" class="source__wrapper"><i class="icon icon--arrow-up" ng-class="{\'icon--arrow-down\': data.tableIsVisible}"></i> <div class="source"><span class="source__name">{{hostData.hostname || hostData.ip}}</span><br><span ng-if="hostData.hostname" class="help-text">{{hostData.ip}}</span></div></div><div ng-if="$index > 0" class="td-content-wrapper" ng-bind-html="value.modify ? value.modify(hostData[key]) : hostData[key]"></div></td></tr><tr ng-if="data.tableIsVisible" ng-repeat="(k, row) in data.rows | orderBy:[]:false:vm.connections.sortFn" class="ndm-table__row conn-row"><td ng-repeat="(key, value) in vm.connections.table.connColumns" class="table__col-{{$index}}" ng-style="{ \'width\': (value.width && value.width + \'px\' || \'auto\') }"><div class="td-content-wrapper" ng-bind-html="value.modify ? value.modify(row[key]) : row[key]"></div></td></tr></tbody></table></div> <div ng-if="vm.connections.noData" class="page-diagnostics__connections__no-data-msg">{{::(\'loading\' | translate)}}</div>'),e.put("app/page/controlPanel/control/diagnostics/diagnostics.dsl.html",'<ndm-polling ndm-polling="vm.diagnosticsDsl.poll"></ndm-polling><ndm-form-header label="diagnostics.dsl.header"></ndm-form-header><div ng-if="vm.diagnosticsDsl.data === false"><span class="icon icon--mini icon--load"></span> {{\'loading\' | translate}}</div> <div ng-if="vm.diagnosticsDsl.data"><ndm-list info-obj="vm.diagnosticsDsl.data.iprops"></ndm-list><div ng-if="vm.diagnosticsDsl.data.traffic" class="page-diagnostics-dsl-traffic"><ndm-form-header label="diagnostics.dsl.traffic-header"></ndm-form-header><ndm-list info-obj="vm.diagnosticsDsl.data.traffic"></ndm-list></div></div>'),e.put("app/page/controlPanel/control/diagnostics/diagnostics.html",'<ndm-page class="page-diagnostics" label="diagnostics.header-title" progress="diagnostics.progress" description="diagnostics.header-sub-title"><ndm-tabs ng-if="diagnostics.tabs.array.length > 1" tabs="diagnostics.tabs.array" label-prop="label" active-tab="diagnostics.tabs.current"></ndm-tabs><div ng-show="diagnostics.tabs.current.id === \'main\' || !diagnostics.tabs.current.id" ng-include="\'app/page/controlPanel/control/diagnostics/diagnostics.tab.main.html\'"></div><div ng-show="diagnostics.tabs.current.id === \'dsl\'" ng-include="\'app/page/controlPanel/control/diagnostics/diagnostics.tab.dsl.html\'"></div></ndm-page>'),e.put("app/page/controlPanel/control/diagnostics/diagnostics.tab.dsl.html",'<ng-include ng-if="diagnostics.isDslDevice && diagnostics.tabs.current.id === \'dsl\'" ng-init="vm = diagnostics" src="\'app/page/controlPanel/control/diagnostics/diagnostics.dsl.html\'"></ng-include><div ng-if="::diagnostics.usbdslDumpsoc"><ng-include ng-init="dumpsoc = diagnostics.usbdslDumpsoc;" src="\'app/page/controlPanel/control/diagnostics/diagnostics.usbdslDumpsoc.html\'"></ng-include><ng-include ng-init="usbDslStatistics = diagnostics.usbdslStatistics" src="\'app/page/controlPanel/control/diagnostics/diagnostics.usbDslStatistics.html\'"></ng-include></div>'),e.put("app/page/controlPanel/control/diagnostics/diagnostics.tab.main.html",'<ndm-form-header label="diagnostics.debugger.self-test-title"></ndm-form-header><ndm-text text="diagnostics.debugger.self-test-description"></ndm-text><ndm-button label="diagnostics.debugger.save-self-test" ng-click="diagnostics.downloadSelfTest()"></ndm-button><form class="page-diagnostics__tools-form" name="diagnostics.tools.form" bs-modifiable="false" novalidate=""><ndm-form-header label="diagnostics.tools.header" hr="hr-light-blue"></ndm-form-header><ndm-radio disabled="diagnostics.tools.isBusy" name="tool" label="diagnostics.tools.tool" array="diagnostics.tools.list" model="diagnostics.tools.tool"></ndm-radio><ndm-input disabled="diagnostics.tools.isBusy" label="diagnostics.tools.host" model="diagnostics.tools.data.host" name="toolHost" validation="required,ipOrDomain[{{diagnostics.tools.tool !== \'ping6\' ? 4 : 6}}]"></ndm-input><ndm-details toggle-var="diagnostics.tools.advancedSettings.isVisible" label-visible="diagnostics.tools.show-advanced-settings" label-hidden="diagnostics.tools.hide-advanced-settings"><ndm-fieldset is-disabled="diagnostics.tools.isBusy"><ndm-input ng-if="diagnostics.tools.tool !== \'traceroute\'" name="count" label="diagnostics.tools.count" placeholder="0…100" model="diagnostics.tools.data.count" validation="range[0..100]"></ndm-input><ndm-input name="size" ng-disabled="diagnostics.tools.packetSizeFixed" label="diagnostics.tools.size" model="diagnostics.tools.data.packetsize" placeholder="48…65535" validation="range[48..65535]"></ndm-input><div ng-if="diagnostics.tools.tool === \'traceroute\'"><ndm-input name="max-ttl" label="diagnostics.tools.max-ttl" model="diagnostics.tools.data[\'max-ttl\']" placeholder="1…255" validation="range[1..255]"></ndm-input><ndm-selectbox name="type" disabled="diagnostics.tools.isBusy" label="diagnostics.tools.type" value="diagnostics.tools.data.type" on-value-change="diagnostics.tools.checkPacketSize" options="diagnostics.tools.typeOptions"></ndm-selectbox><ndm-sub-form ng-if="diagnostics.tools.data.type !== \'icmp\'"><ndm-input name="port" label="diagnostics.tools.port" model="diagnostics.tools.data.port" placeholder="1…65535" validation="portNumber"></ndm-input></ndm-sub-form></div></ndm-fieldset></ndm-details><div ng-if="diagnostics.tools.output.length" class="console" scroll-glue=""><div ng-repeat="item in diagnostics.tools.output track by $index">{{item}}</div></div> <div class="form__cell"><ndm-button is-disabled="diagnostics.tools.form.$invalid" on-click="diagnostics.tools.startStopTool" label="{{diagnostics.tools.getButtonText()}}"></ndm-button></div></form><form name="diagnostics.log.diagnosticsForm"><ndm-form-header hr="hr-light-blue" label="diagnostics.log.header-title"></ndm-form-header><ndm-text text="diagnostics.log.system-messages-list"></ndm-text><ndm-checkbox label="diagnostics.log.send-message" name="isSendToServer" model="diagnostics.log.isSendToServer" on-change="diagnostics.log.checkSendToServerModified()"></ndm-checkbox><ndm-sub-form ng-if="diagnostics.log.isSendToServer" ng-form="diagnostics.log.serverAddressSubform"><ndm-input placeholder-text="diagnostics.log.server-address" label="diagnostics.log.server-title" model="diagnostics.log.serverAddress" name="serverAddress" validation="required,ip"></ndm-input></ndm-sub-form><ndm-form-item class="buttons-row"><ndm-button class="buttons-row__button--full-width" is-disabled="!diagnostics.log.isGetData" btn-class="diagnostics-log-btn-show btn--primary" ui-sref="controlPanel.diagnostics.log" label="diagnostics.log.see-log-list-button"></ndm-button><ndm-button class="buttons-row__button--full-width" on-click="diagnostics.log.exportLog" label="diagnostics.log.popup-log.save-local"></ndm-button></ndm-form-item><ndm-control-footer prefix="diagnostics" is-visible="diagnostics.log.diagnosticsForm.modified" is-save-disabled="diagnostics.log.isSaveDisabled || diagnostics.log.diagnosticsForm.modified && diagnostics.log.diagnosticsForm.$invalid" save="diagnostics.log.setAddressSaveServer()" cancel="diagnostics.log.resetAddressLogServer()"></ndm-control-footer></form><ndm-form-header hr="hr-light-blue" label="diagnostics.debugger.header-title"></ndm-form-header><ndm-text text="diagnostics.debugger.header-info"></ndm-text><div class="form__cell"><div class="debug-btn-container"><button class="btn" ng-class="{\'btn--loading\': diagnostics.debugger.status.alarm || (diagnostics.debugger.status.state && diagnostics.debugger.status.pending), \'btn--primary\': diagnostics.debugger.status.state }" ng-click="diagnostics.debugger.toggleBtnClick()" ng-disabled="diagnostics.debugger.status.pending || diagnostics.debugger.status.alarm || diagnostics.debugger.status.loading" data-translate="">{{diagnostics.debugger.status.state ? \'diagnostics.debugger.stop-button\' : \'diagnostics.debugger.start-button\'}}</button></div> <div ng-if="diagnostics.debugger.status.state && !diagnostics.debugger.status.alarm && !diagnostics.debugger.status.pending" class="_debug_hint"><span ng-if="diagnostics.debugger.status.started" data-translate="">diagnostics.debugger.started-at-caption</span> <span ng-if="diagnostics.debugger.status.started" ng-bind-html="diagnostics.debugger.status.started | timestampTranslate"></span> <span ng-if="!diagnostics.debugger.status.started" data-translate="">diagnostics.debugger.started-caption</span></div> <div ng-if="diagnostics.debugger.status.state && (diagnostics.debugger.status.alarm || diagnostics.debugger.status.pending)" class="_debug_hint"><span data-translate="">diagnostics.debugger.preparing-file-caption</span></div></div><div ng-if="::diagnostics.usbdslDumpsoc"><ng-include ng-init="dumpsoc = diagnostics.usbdslDumpsoc;" src="\'app/page/controlPanel/control/diagnostics/diagnostics.usbdslDumpsoc.html\'"></ng-include><ng-include ng-init="usbDslStatistics = diagnostics.usbdslStatistics" src="\'app/page/controlPanel/control/diagnostics/diagnostics.usbDslStatistics.html\'"></ng-include></div><div ng-if="diagnostics.monitorComponentIsInstalled" ng-cloak=""><ndm-form-header hr="hr-light-blue" label="diagnostics.capture.header-title"></ndm-form-header><ndm-text text="diagnostics.capture.header-info"></ndm-text><div class="diagnostics-capture_list"><div ng-repeat="v in diagnostics.capture.list.data" class="_item"><div class="_toppanel" ng-click="diagnostics.capture.editor.edit(v)" ng-class="{ \'_toppanel--started\': v.started }"><div class="__cell1">{{v.title}}</div> <div class="__cell2"><button class="btn" ng-click="$event.stopPropagation(); diagnostics.capture.toggle(v.id);" ng-class="{\'btn--loading\': ((v.started && diagnostics.capture.listPendingIds[v.id]) || v.alarm)}" ng-disabled="diagnostics.capture.listPendingIds[v.id]" data-translate="">{{"diagnostics.capture.list." + (v.started ? \'stop\' : \'start\') + "-btn"}}</button></div> <div class="__cell3"><div class="_editbtn"><i ng-if="!v.started" class="icon icon--pencil icon--table-pencil"></i></div></div></div> <div ng-if="v.started || v.file" class="_details"><span data-translate="">diagnostics.capture.list.lbl-time-duration</span> <span>{{v.duration}}</span> <span data-translate="">diagnostics.capture.list.lbl-frames_captured</span> <span>{{v.framesCaptured}}</span> <span data-translate="">diagnostics.capture.list.lbl-bytes_captured</span> <span>{{v.bytesCaptured | sizeFormat}}</span> <span data-translate="">diagnostics.capture.list.lbl-frames_dropped</span> <span>{{v.framesDropped}}</span> <span data-translate="">diagnostics.capture.list.lbl-bytes_dropped</span> <span>{{v.bytesTotal - v.bytesCaptured | sizeFormat}}</span> <span data-translate="">diagnostics.capture.list.lbl-frames_lost</span> <span>{{v.framesLost}}</span></div> <div class="_botttompanel" ng-show="v.file"><div><button class="btn" ng-click="$event.stopPropagation(); diagnostics.capture.download(v.id);" ng-show="v.file" ng-disabled="v.started" data-translate="">diagnostics.capture.list.download-btn</button> <button class="btn" ng-click="$event.stopPropagation(); diagnostics.capture.reset(v.id);" ng-show="!v.started && v.file" data-translate="">diagnostics.capture.list.reset-btn</button></div></div></div> <div class="_nodata" ng-if="!diagnostics.capture.list.count" data-translate="">diagnostics.capture.list.no_entries-caption</div></div><ndm-button on-click="diagnostics.capture.editor.add" label="diagnostics.capture.add-btn"></ndm-button><a class="action-link" ng-show="diagnostics.capture.list.count" ng-click="diagnostics.capture.flush()" data-translate="">diagnostics.capture.flush-btn</a></div><ng-include ng-if="diagnostics.inRouterMode" ng-init="vm = diagnostics;" src="\'app/page/controlPanel/control/diagnostics/diagnostics.connections.html\'"></ng-include><ndm-popup is-visible="true" ng-if="diagnostics.monitorComponentIsInstalled && diagnostics.capture.editor.visible" header-title="diagnostics.capture.edit.header-title" close="diagnostics.capture.editor.cancel"><form name="diagnostics.capture.editor.form" class="diagnostics_capture_form" ng-if="diagnostics.capture.editor.visible"><ndm-text text="diagnostics.capture.edit.header-info"></ndm-text><ndm-selectbox label="diagnostics.capture.edit.interface_select" options="diagnostics.capture.editor.vars.interfaceSelect" value="diagnostics.capture.editor.data.interfaceId"></ndm-selectbox><ndm-selectbox ng-if="diagnostics.capture.editor.vars.storageSelect" label="diagnostics.capture.edit.storage" options="diagnostics.capture.editor.vars.storageSelect" value="diagnostics.capture.editor.data.storage"></ndm-selectbox><ndm-sub-form ng-if="diagnostics.capture.editor.data.storage === \'usb\'"><ndm-fs-select ng-model="diagnostics.capture.editor.data.outputDirectory" removable-only="true" select-folder="true" required="true" name="outputDirectory" label="diagnostics.capture.edit.output_directory"></ndm-fs-select></ndm-sub-form><ndm-input label="diagnostics.capture.edit.buffer_size" model="diagnostics.capture.editor.data.bufferSize" name="bufferSize" validation="required,range[64..{{diagnostics.capture.editor.vars.memLimit}}]"></ndm-input><ndm-input ng-if="diagnostics.capture.editor.data.storage !== \'usb\'" label="diagnostics.capture.edit.capture_size" model="diagnostics.capture.editor.data.captureSize" name="captureSize" validation="required,range[64..{{diagnostics.capture.editor.vars.memLimit}}]"></ndm-input><ndm-input label="diagnostics.capture.edit.max_frame_size" model="diagnostics.capture.editor.data.maxFrameSize" name="maxFrameSize" validation="required,range[1..16380]"></ndm-input><ndm-selectbox label="diagnostics.capture.edit.direction" name="direction" options="diagnostics.capture.editor.vars.directionSelect" value="diagnostics.capture.editor.data.direction"></ndm-selectbox><ndm-input label="diagnostics.capture.edit.filter" model="diagnostics.capture.editor.data.filter" max-length="1000" name="filter" on-change="diagnostics.capture.editor.resetNdmErrors" error-from-controller="diagnostics.capture.editor.ndmErrors.filter" hint="{{diagnostics.l10n.captureFilterHelpText}}"></ndm-input><ndm-input label="diagnostics.capture.edit.timeout" model="diagnostics.capture.editor.data.timeout" name="timeout" validation="required,range[10..10000]"></ndm-input><ndm-checkbox label="diagnostics.capture.edit.promisc_mode" model="diagnostics.capture.editor.data.promiscMode" name="promiscMode" hint="diagnostics.capture.edit.promisc-help"></ndm-checkbox><hr class="hr-light-blue" ng-show="diagnostics.capture.editor.data.id"><button type="button" class="btn btn--long _del-btn" ng-show="diagnostics.capture.editor.data.id" ng-click="diagnostics.capture.editor.delete()" data-translate="">diagnostics.capture.delete-btn</button><ndm-control-footer prefix="diagnosticsCapture" is-visible="diagnostics.capture.editor.form.modified || !diagnostics.capture.editor.data.id" is-popup="true" is-save-disabled="(!diagnostics.capture.editor.form.modified && diagnostics.capture.editor.data.id) || diagnostics.capture.editor.form.$invalid" save="diagnostics.capture.editor.save()" cancel="diagnostics.capture.editor.cancel()"></ndm-control-footer></form></ndm-popup><ndm-popup class="diagnostics-log-popup" is-visible="true" ng-if="diagnostics.log.logPopupShow" header-title="diagnostics.log.popup-log.title" close="diagnostics.log.closeLogPopup"><form name="DevicesList.addRulePopupForm" class="diagnostics-log-popup__form"><div class="diagnostics-log-popup__panel"><div class="diagnostics-log-popup__panel-toggle"><ndm-toggle label-on="diagnostics.log.popup-log.update" label-off="diagnostics.log.popup-log.update" name="isLiveUpdate" model="diagnostics.log.isLiveUpdate" call-on-change="diagnostics.log.broadcastLogToogle"></ndm-toggle></div> <div class="diagnostics-log-popup__panel-buttons"><button class="btn" ng-click="diagnostics.log.clearLog()" ng-disabled="!diagnostics.log.clearLogButton"><span data-translate="">diagnostics.log.popup-log.clean</span></button></div></div> <div class="table-scroll-wrap" scroll-glue=""><div class="diagnostics-log-popup__list-item" ng-repeat="item in diagnostics.log.logData.list"><div class="diagnostics-log-popup__list-item-datetime">{{::item.timestamp | timestampTranslate | trust}}</div> <div class="diagnostics-log-popup__list-item-ident">{{::item.ident}}</div> <div class="diagnostics-log-popup__list-item-message" ng-class="{ \'diagnostics-log-popup__list-item-message_warning\': item.level === \'Warning\', \'diagnostics-log-popup__list-item-message_error\': item.level === \'Error\' }">{{::item.message}}</div></div></div></form></ndm-popup>'),e.put("app/page/controlPanel/control/diagnostics/diagnostics.usbDslStatistics.html",'<ndm-form-header hr="hr-light-blue" label="diagnostics.usbdsl-statistics.header" sub-title="diagnostics.usbdsl-statistics.description"></ndm-form-header><div class="page-diagnostics__dsl-statistics-controls"><ndm-button name="show-usbdsl-statistics" on-click="usbDslStatistics.showPopup" is-disabled="!diagnostics.usbdslDumpsoc.status.plugged || diagnostics.usbdslDumpsoc.status.running" label="diagnostics.usbdsl-statistics.button-show-popup"></ndm-button><span class="page-diagnostics__dsl-statistics-btn-message"><span ng-if="diagnostics.usbdslDumpsoc.status.running" data-translate="">diagnostics.usbdsl-dumpsoc.status-in-progress</span> <span ng-if="!diagnostics.usbdslDumpsoc.status.plugged" data-translate="">diagnostics.usbdsl-dumpsoc.status-unplugged</span></span></div><ndm-popup is-visible="usbDslStatistics.isPopupShown" header-title="diagnostics.usbdsl-statistics.header" close="usbDslStatistics.hidePopup"><ndm-form-header label="diagnostics.usbdsl-statistics.snr-title"></ndm-form-header><ndm-chart name="snrChart" height="200" width="940" model="usbDslStatistics.snrData" max-y="70" max-x="usbDslStatistics.standard === \'ADSL\' ? 540 : 4100" anchor-left="" anchor-right="" axes-number-y="10" is-loading="!usbDslStatistics.isSnrLoaded" is-axes-labels-visible-x="true" is-axes-labels-visible-y="true"></ndm-chart><ndm-form-header label="diagnostics.usbdsl-statistics.bits-title"></ndm-form-header><ndm-chart name="bitsChart" height="200" width="940" model="usbDslStatistics.bitsData" max-y="20" max-x="usbDslStatistics.standard === \'ADSL\' ? 540 : 4100" anchor-left="0" anchor-right="" is-axes-labels-visible-x="true" is-axes-labels-visible-y="true" is-loading="!usbDslStatistics.isBitsLoaded" axes-number-y="10"></ndm-chart><div class="page-diagnostics-dsl-statistics__info-panel"><ndm-list info-obj="usbDslStatistics.infoObj"></ndm-list></div> <div class="page-diagnostics-dsl-statistics__bottom-panel"><ndm-button name="refresh-usbdsl-statistics" on-click="usbDslStatistics.showPopup" label="diagnostics.usbdsl-statistics.button-refresh" is-disabled="usbDslStatistics.isButtonDisabled"></ndm-button></div></ndm-popup>'),e.put("app/page/controlPanel/control/diagnostics/diagnostics.usbdslDumpsoc.html",'<ndm-polling ndm-timeout="3000" ndm-interval="{{(dumpsoc.status.running || dumpsoc.status.pending) ? 1000 : 3000}}" ndm-polling="dumpsoc.updateStatus"></ndm-polling><ndm-form-header hr="hr-light-blue" label="diagnostics.usbdsl-dumpsoc.header"></ndm-form-header><ndm-text text="diagnostics.usbdsl-dumpsoc.description"></ndm-text><div class="page-diagnostics__usbdsl-dumpsoc__controls"><button class="btn" ng-class="{\'btn--loading\': dumpsoc.status.pending}" ng-click="dumpsoc.toggleDiagnostics()" ng-disabled="!dumpsoc.status.plugged || dumpsoc.status.pending">{{ (dumpsoc.status.running ? \'diagnostics.usbdsl-dumpsoc.button-stop\' : \'diagnostics.usbdsl-dumpsoc.button-start\' ) | translate }}</button> <div class="page-diagnostics__usbdsl-dumpsoc__controls__status"><i ng-if="dumpsoc.status.running && !dumpsoc.status.pending" class="icon icon--load"></i> <span ng-if="dumpsoc.status.running && !dumpsoc.status.pending">{{dumpsoc.status.leftFormatted}}</span><span class="page-diagnostics__usbdsl-dumpsoc__controls__status__done" ng-if="!dumpsoc.status.running && dumpsoc.status.done">{{\'diagnostics.usbdsl-dumpsoc.status-completed\' | translate}}. <a ng-click="dumpsoc.downloadDump()" class="action-link" data-translate="">diagnostics.usbdsl-dumpsoc.download-file</a></span><span ng-if="dumpsoc.status.plugged && dumpsoc.status.error" class="page-diagnostics__usbdsl-dumpsoc__controls__status__error">{{(\'diagnostics.usbdsl-dumpsoc.error.\' + dumpsoc.status.error) | translate}}. {{ dumpsoc.status.error === \'failed\' && +dumpsoc.status.exitCode > -1 ? (\'diagnostics.usbdsl-dumpsoc.error-code\' | translate) + \': \' + dumpsoc.status.exitCode + \'.\' : \'\' }}</span><span ng-if="!dumpsoc.status.plugged" class="page-diagnostics__usbdsl-dumpsoc__controls__status__unplugged" data-translate="">diagnostics.usbdsl-dumpsoc.status-unplugged</span></div></div>'),e.put("app/page/controlPanel/control/opkg/opkg.html",'<ndm-page class="page-opkg" label="opkg.page-header" progress="vm.progress" description="{{vm.l10n.pageDescription}}"><div ng-if="vm.isReady" ndm-polling="vm.pollUsbDevices" ndm-interval="3000"></div><form ng-if="vm.isReady" name="vm.form" ng-cloak="" novalidate=""><ndm-form-header label="opkg.form-header"></ndm-form-header><ndm-fieldset is-disabled="vm.ui.isLocked"><ndm-selectbox disabled="vm.ui.isLocked" label="opkg.form.disk.label" name="disk" value="vm.model.disk" description="{{vm.model.diskIsNotConnected ? \'opkg.form.disk.not-connected\' : \'\'}}" options="vm.model.diskOptions"></ndm-selectbox><ndm-input label="opkg.form.initrc-path" name="initrc-path" model="vm.model.initrc"></ndm-input><ndm-form-header label="opkg.users-table-header"></ndm-form-header><table class="ndm-table body-text users-table"><thead><tr><th class="table__header table__col-0"><span data-translate="">opkg.users-table.user</span></th><th class="table__header table__col-1"><span data-translate="">opkg.users-table.opkg-access</span></th></tr></thead><tbody><tr ng-repeat="(user, data) in vm.users"><td><div class="td-content-wrapper storage-partition">{{user}}</div></td><td class="table__col-1"><div class="td-content-wrapper checkbox"><input class="checkbox__input" type="checkbox" id="opkg-access{{$index}}" name="opkg-access{{$index}}" ng-value="data.access" ng-model="data.access"> <label class="checkbox__label" for="opkg-access{{$index}}"></label></div></td></tr></tbody></table><ndm-user-add-table save-callback="vm.addUser(name)" users="vm.users"></ndm-user-add-table></ndm-fieldset></form><ndm-control-footer prefix="opkg" form="vm.form" is-visible="vm.form.modified" is-save-disabled="vm.ui.isLocked || vm.form.$invalid || vm.form.$pending" save="vm.save()" cancel="vm.cancel()"></ndm-control-footer></ndm-page>'),e.put("app/page/controlPanel/control/system/system.html",'<ndm-page class="page-system" label="system.title" progress="system.progress"><form name="system.form" novalidate=""><ndm-fieldset is-disabled="system.ui.isLocked"><div ng-include="\'app/page/controlPanel/control/system/components/components.html\'"></div><div ng-include="\'app/page/controlPanel/control/system/systemFiles/systemFiles.html\'"></div><div ng-if="::system.cloudcontrolInstalled" ng-include="\'app/page/controlPanel/control/system/cloudcontrol/cloudcontrol.html\'"></div><div ng-include="\'app/page/controlPanel/control/system/systemSettings/systemSettings.html\'"></div><div ng-include="\'app/page/controlPanel/control/system/buttonsAndLeds/buttonsAndLeds.html\'"></div><div ng-include="\'app/page/controlPanel/control/system/switchports/switchports.html\'"></div><div ng-if="::system.usbIsConfigurable" ng-include="\'app/page/controlPanel/control/system/usbPorts/usbPorts.html\'"></div><div ng-include="\'app/page/controlPanel/control/system/reboot/reboot.html\'"></div><div ng-include="\'app/page/controlPanel/control/system/sysmode/sysmode.html\'"></div><div ng-include="\'app/page/controlPanel/control/system/diagnosticReports/diagnostic-reports.html\'"></div><div ng-include="\'app/page/controlPanel/control/system/credits/credits.html\'"></div></ndm-fieldset></form><ndm-control-footer prefix="system" is-visible="system.form.modified && !system.popupIsVisible" is-save-disabled="system.form.$invalid || system.ui.isLocked" save="system.save()" cancel="system.reset()"></ndm-control-footer></ndm-page>'),e.put("app/page/controlPanel/myInternet/dsl/dsl.html",'<ndm-page class="page-dsl" label="dsl.page-title" progress="vm.progress" description="dsl.description"><form name="vm.form" ng-cloak=""><div ng-if="vm.ui.isReady" ndm-polling="vm.userInfo.update"></div><ndm-toggle class="page-dsl__toggle page-dsl__toggle--state-{{vm.toggle.stateColor}}" label="dsl.toggle-on-label" label-on="{{vm.toggle.stateText}}" label-off="connection-status.down" name="up" disabled="vm.ui.isLocked" model="vm.model.general.state" ndm-polling="vm.toggle.polling" call-on-change="vm.toggle.onToggle"></ndm-toggle><div class="page-dsl__general-settings" ng-if="vm.ui.isReady" ng-form="vm.form.general" ng-cloak=""><ndm-link ng-hide="vm.ui.scheduleSelectIsVisible" on-click="vm.ui.showScheduleSelect()" link-class="page-dsl__show-schedule-link" label="dsl.link.set-internet-access-schedule"></ndm-link><ndm-schedule-select ng-show="vm.ui.scheduleSelectIsVisible" is-disabled="vm.ui.isLocked" class="page-dsl__schedule-select" name="schedule" model="vm.model.general.schedule" no-selected-thumb="true"></ndm-schedule-select><ndm-iface-order class="page-dsl__order-selectbox" is-disabled="vm.ui.isLocked" name="order" required="true" ng-model="vm.model.general.order"></ndm-iface-order><ndm-input class="page-dsl__description-input" disabled="vm.ui.isLocked" name="description" label="dsl.form.description.label" description="dsl.form.description.comment" model="vm.model.general.description"></ndm-input><ndm-link on-click="vm.ui.goToInitialSetupWizard()" link-class="page-dsl__wizard-link" label="dsl.link.select-another-isp-link"></ndm-link></div><div class="page-dsl__line-settings" ng-form="vm.form.line"><ndm-selectbox name="dslMode" class="page-dsl__dsl-mode-selectbox" label="dsl.fields.mode" disabled="vm.ui.isLocked" description="{{vm.l10n.dslModeDescription}}" options="vm.options.dslMode" value="vm.model.line.dslMode" on-value-change="vm.onLineModeChange"></ndm-selectbox><ndm-details class="page-dsl__line-additional-settings" toggle-var="vm.ui.lineSettingsAreVisible" label-visible="dsl.section.line.show-additional-settings" label-hidden="dsl.section.line.hide-additional-settings"><fieldset ng-disabled="vm.ui.isLocked"><div class="page-dsl__olr"><ndm-checkbox-list label="dsl.fields.olr" name="olr" nobr="true" options="vm.options.olr" model="vm.model.line.olr"></ndm-checkbox-list><ndm-help class="page-dsl__olr-hint"><span ndm-html-compile="\'dsl.fields.olr-hint\' | translate"></span></ndm-help></div> <div ng-if="vm.model.line.dslMode !== vm.DSL_MODE.VDSL" ng-form="vm.adslSnrMarginForm"><ndm-selectbox disabled="vm.ui.isLocked" label="dsl.form.snr-margin.adsl-label" name="adslSnrMarginOffset" options="vm.snrMarginOffset.adsl.options" value="vm.model.line.snrMarginOffset.adsl"><ndm-help>{{ \'dsl.form.snr-margin.adsl-hint\' | translate }}</ndm-help></ndm-selectbox></div> <div ng-if="vm.model.line.dslMode !== vm.DSL_MODE.ADSL" ng-form="vm.vdslSnrMarginForm"><ndm-selectbox disabled="vm.ui.isLocked" label="dsl.form.snr-margin.vdsl-label" name="vdslSnrMarginOffset" options="vm.snrMarginOffset.vdsl.options" value="vm.model.line.snrMarginOffset.vdsl"><ndm-help>{{ \'dsl.form.snr-margin.vdsl-hint\' | translate }}</ndm-help></ndm-selectbox></div> <div ng-if="vm.model.line.dslMode === vm.DSL_MODE.ADSL" ng-form="vm.adslAdditionalSettingsForm"><ndm-selectbox disabled="vm.ui.isLocked" label="dsl.fields.annex" name="annex" options="vm.options.annex" value="vm.model.line.annex"></ndm-selectbox><ndm-radio label="dsl.fields.operation-mode" name="adslMode" array="vm.options.adslMode" model="vm.model.line.operatingMode" on-change="vm.onAdslModeChange"></ndm-radio></div> <div ng-if="vm.model.line.dslMode === vm.DSL_MODE.VDSL" ng-form="vm.vdslAdditionalSettingsForm"><ndm-checkbox-list name="vdslProfiles" model="vm.model.line.profile" label="dsl.fields.vdsl-profiles" nobr="true" options="vm.options.profile"></ndm-checkbox-list><ndm-selectbox disabled="vm.ui.isLocked" label="dsl.fields.carrier" name="carrier" options="vm.options.carrier" value="vm.model.line.carrier"></ndm-selectbox></div></fieldset></ndm-details></div><ndm-tabs class="page-dsl__tabs" label-prop="label" tabs="vm.tabs.list" ng-class="{ \'page-dsl__tabs--no-tooltip\': vm.ui.isLocked }" on-tab-changed-fn="vm.tabs.onTabChange"></ndm-tabs><div ng-if="vm.ui.isReady"><ng-include ng-show="vm.tabs.currentTab === vm.ROLE.INET" src="\'app/page/controlPanel/myInternet/dsl/dsl.inet.html\'"></ng-include><ng-include ng-show="vm.tabs.currentTab === vm.ROLE.IPTV" src="\'app/page/controlPanel/myInternet/dsl/dsl.iptv.html\'"></ng-include><ng-include ng-show="vm.tabs.currentTab === vm.ROLE.VOIP" src="\'app/page/controlPanel/myInternet/dsl/dsl.voip.html\'"></ng-include></div><ndm-control-footer ng-if="vm.ui.isFooterReady" prefix="dsl" is-visible="vm.form.modified" is-save-disabled="vm.isSaveDisabled()" save="vm.save()" cancel="vm.reset()"></ndm-control-footer></form></ndm-page>'),e.put("app/page/controlPanel/myInternet/dsl/dsl.inet.html",'<div ng-form="vm.form.inet" ndm-extra-form-options="{validateInvisible: true}"><ng-include src="\'app/page/controlPanel/myInternet/dsl/dsl.ipvcArray.html\'" onload="roleName = \'inet\'"></ng-include><ndm-isp-iface ng-if="vm.model" prefix="dsl" ip-data="vm.model.inet.ip" ppp-data="vm.model.inet.ppp" used-subnets="vm.validation.usedSubnetsForDslIsp" subtitle-ip="dsl.subtitle-ip" subtitle-ppp="dsl.subtitle-ppp" show-mac-mode="false" on-ip-change="vm.validation.onInetIpChange" on-ppp-change="vm.validation.onPppIpChange" status="vm.toggle.state" is-disabled="vm.ui.isLocked"></ndm-isp-iface><ndm-pingcheck ng-if="::vm.PINGCHECK_INSTALLED" is-disabled="vm.ui.isLocked" data="vm.model.inet.pingcheck"><div class="pingcheck-status"><div ng-if="vm.model.general.state && vm.model.inet.pingcheck && vm.toggle.state.pingcheck" class="pingcheck-status--{{vm.toggle.state.pingcheck.color}}">{{vm.toggle.state.pingcheck.text}}</div></div></ndm-pingcheck></div>'),e.put("app/page/controlPanel/myInternet/dsl/dsl.iptv.html",'<div ng-form="vm.form.iptv" ndm-extra-form-options="{validateInvisible: true}"><input type="hidden" name="iptvIpvcCount" ng-model="vm.model.iptv.ipvcArray.length"><ng-include src="\'app/page/controlPanel/myInternet/dsl/dsl.ipvcArray.html\'" onload="roleName = \'iptv\'"></ng-include><ndm-iface-ip ng-if="vm.model.iptv.ipvcArray.length > 0" label="dsl.subtitle-ip" is-disabled="vm.ui.isLocked" data="vm.model.iptv.ip" on-change="vm.validation.onIptvIpChange" used-ips="vm.validation.usedIpAddresses.iptv" name-prefix="iptv." no-additional-settings="true" no-dns="true" auto-with-dhcp="true"></ndm-iface-ip><ng-include ng-if="vm.tabs.currentTab === vm.ROLE.IPTV" src="\'app/page/controlPanel/myInternet/dsl/dsl.portmap.html\'" onload="roleName = \'iptv\'"></ng-include></div>'),e.put("app/page/controlPanel/myInternet/dsl/dsl.ipvcArray.html",'<div class="page-dsl__ipvc-list page-dsl__{{roleName}}-ipvc-list"><div class="page-dsl__role-description page-dsl__{{roleName}}-role-description">{{\'dsl.role.\' + roleName + \'.description\' | translate}}</div> <div class="ipvc-array"><div ng-repeat="ipvc in vm.model[roleName].ipvcArray track by $index" ng-init="rowPrefix = roleName + \'_\' + $index" class="ipvc-row"><div class="ipvc" ng-class="{ \'ipvc--first-row\': $index === 0 }" ng-form="vm.form[\'{{rowPrefix}}\']"><hr ng-if="$index !== 0" class="ipvc__separator"><div ng-if="vm.model.line.dslMode !== vm.DSL_MODE.VDSL" class="ipvc__adsl"><ndm-fieldset is-disabled="vm.ui.isLocked"><div class="ipvc__adsl-fields"><ndm-input class-name="ndm-input-xs" max-length="3" label="dsl.form.vpi" model="ipvc.vpi" name="{{::(rowPrefix || \'\')}}-vpi" on-change="vm.validation.onPvcChange" error="ipvc.pvcError" placeholder="0…255" validation="range[0..255]{{vm.validation.isVpiOrVciRequired(ipvc, vm.VPI) ? \',required\' : \'\'}}"></ndm-input><ndm-input class-name="ndm-input-xs" max-length="5" label="dsl.form.vci" model="ipvc.vci" name="{{::(rowPrefix || \'\')}}-vci" error="ipvc.pvcError" on-change="vm.validation.onPvcChange" placeholder="32…65535" validation="range[32..65535]{{vm.validation.isVpiOrVciRequired(ipvc, vm.VCI) ? \',required\' : \'\'}}"></ndm-input><ndm-selectbox disabled="vm.ui.isLocked" label="dsl.form.encapsulation" value="ipvc.encapsulation" name="{{::(rowPrefix || \'\')}}-encapsulation" options="vm.options.encapsulation"></ndm-selectbox><div ng-if="roleName === vm.ROLE.INET" ng-form="vm.form.adslVlanSubform"><ndm-input disabled="vm.model.line.dslMode !== vm.DSL_MODE.ADSL" class-name="ndm-input-xs" max-length="4" label="dsl.form.adsl-vlan" model="ipvc.adslVlan" name="{{::(rowPrefix || \'\')}}-adsl-vlan" placeholder="{{vm.model.line.dslMode === vm.DSL_MODE.AUTO ? \'\' : \'1…4094\'}}" validation="range[1..4094]"></ndm-input></div></div> <div ng-if="roleName === vm.ROLE.INET && vm.model.line.dslMode === vm.DSL_MODE.AUTO" ng-form="vm.form.vlanOverPvcSubform"><ndm-checkbox label="dsl.form.configure-vlan-over-pvc" model="ipvc.vlanOverPvc" name="{{::(rowPrefix || \'\')}}-vlan-over-pvc" on-value-change="vm.ui.onVlanOverPvcToggle"></ndm-checkbox></div></ndm-fieldset></div> <div ng-if="vm.model.line.dslMode !== vm.DSL_MODE.ADSL" class="ipvc__vdsl"><ndm-fieldset is-disabled="vm.ui.isLocked"><div class="ipvc__vdsl-fields"><ndm-input class-name="ndm-input-xs" max-length="4" label="dsl.form.vlan" model="ipvc.vlan" name="{{::(rowPrefix || \'\')}}-vlan" error="ipvc.vlanError" on-change="vm.validation.onVlanChange" placeholder="1…4094" validation="{{ vm.model.line.dslMode === vm.DSL_MODE.AUTO && ipvc.vlanOverPvc ? \'required,\' : \'\'}}range[1..4094]"></ndm-input></div></ndm-fieldset></div></div><ndm-button ng-if="vm.model[roleName].canRemoveIpvc" class="delete-ipvc-btn" icon="trash" ng-click="vm.removeIpvc(roleName, $index)"></ndm-button></div></div><ndm-link ng-if="vm.model[roleName].ipvcArray.length < vm.model[roleName].maxIpvcCount" link-class="add-ipvc-link" ng-click="vm.addNewIpvc(roleName)" label="+ {{\'dsl.add-connection-link\' | translate}}"></ndm-link></div>'),e.put("app/page/controlPanel/myInternet/dsl/dsl.portmap.html",'<div ng-show="vm.model[roleName].ipvcArray.length > 0" class-name="page-dsl__portmap dsl-portmap form__row form__sockets"><div class="dsl-portmap__header"><span data-translate="">dsl.section.switchports.header</span> <div ng-if="roleName === vm.ROLE.IPTV" class="input-description-text" data-translate="">dsl.section.switchports.iptv-description</div></div> <div ng-form="vm.form[\'{{roleName}}Portmap\']" class="dsl-portmap__switchports-wrapper"><ndm-switchport-container><ndm-switchport ng-repeat="(portMapKey, portObj) in vm.model.portmap" ng-init="portData = vm.options.portmap[portMapKey]" label="portData.name" is-combo="portData.isCombo" is-sfp="portData.isSfp" is-reversed="portData.isReversed" is-blue="portData.isBlue"><div class="dsl-portmap__switchport-data"><ndm-checkbox ng-if="!portObj.isBusy && !portObj.isAssigned" disabled="vm.ui.isLocked" name="{{::(vm.PORT_FIELD_PREFIX + portMapKey)}}" model="portObj.isSelected" on-value-change="vm.validation.onPortRoleChanged"></ndm-checkbox><ndm-switchport-role ng-if="portObj.isBusy || portObj.role !== roleName" title="vm.getIforL10n(portObj.forInterface)" role="portObj.role"></ndm-switchport-role></div></ndm-switchport></ndm-switchport-container></div></div>'),e.put("app/page/controlPanel/myInternet/dsl/dsl.voip.html",'<div ng-form="vm.form.voip" ndm-extra-form-options="{validateInvisible: true}"><input type="hidden" name="voipIpvcCount" ng-model="vm.model.voip.ipvcArray.length"><ng-include src="\'app/page/controlPanel/myInternet/dsl/dsl.ipvcArray.html\'" onload="roleName = \'voip\'"></ng-include><ndm-iface-ip ng-if="vm.model.voip.ipvcArray.length > 0" label="dsl.subtitle-ip" is-disabled="vm.ui.isLocked" data="vm.model.voip.ip" on-change="vm.validation.onVoipIpChange" used-ips="vm.validation.usedIpAddresses.voip" name-prefix="voip." no-additional-settings="true" no-dns="true" auto-with-dhcp="true"></ndm-iface-ip><ng-include ng-if="vm.tabs.currentTab === vm.ROLE.VOIP" src="\'app/page/controlPanel/myInternet/dsl/dsl.portmap.html\'" onload="roleName = \'voip\'"></ng-include></div>'),e.put("app/page/controlPanel/myInternet/ip/ip.html",'<ndm-page class="page-ip" label="ip.header" progress="vm.progress" description="ip.description"><ndm-device-poller></ndm-device-poller><form novalidate="" name="vm.form"><ndm-form-header label="ip.title-ip-config"></ndm-form-header><ndm-selectbox label="ip.mode" name="channel" options="vm.ipModes" value="vm.data.mode"></ndm-selectbox><ndm-sub-form ng-if="vm.data.mode === \'static\'"><ndm-input label="ip.address" model="vm.data.ip" name="ipAddress" validation="required,ip"></ndm-input><ndm-selectbox label="ip.mask" value="vm.data.mask" name="ipMask" options="vm.maskOptions"></ndm-selectbox><ndm-input label="ip.gateway" model="vm.data.gateway" name="ipGateway" validation="ip,inNet[{{vm.data.ip}};{{vm.data.mask}}]"></ndm-input></ndm-sub-form><ndm-input ng-repeat="dns in [0,1,2]" label="{{$root.getTranslation(\'ip.dns\') + \' \' + ($index + 1)}}" model="vm.data.dns[dns]" name="dns{{$index}}" validation-data="{allowPort: true}" validation="ip"></ndm-input><ndm-control-footer prefix="ip" form="vm.form" is-visible="vm.form.modified" is-save-disabled="vm.form.$invalid || vm.form.$pending" save="vm.save()"></ndm-control-footer></form></ndm-page>'),e.put("app/page/controlPanel/myInternet/modems/modems.edit.usblte.html",'<ndm-form-header hr="hr-light-blue" label="modems.editor.usblte.subform-title" sub-title="modems.editor.usblte.subform-info"></ndm-form-header><ndm-selectbox label="modems.editor.usblte.acq" name="networkType" options="modem.options.networkType" disabled="vm.ui.isLocked" value="modem.data.networkType"></ndm-selectbox><ndm-input label="modems.editor.usblte.apn" model="modem.data.apn" name="apn"></ndm-input><ndm-selectbox label="modems.editor.usblte.auth-type" options="modem.options.authTypeSelect" name="authType" disabled="vm.ui.isLocked" value="modem.data.authType"></ndm-selectbox><ndm-sub-form ng-if="modem.data.authType && modem.data.authType !== \'none\'"><ndm-input label="modems.editor.usblte.identity" model="modem.data.identity" name="usblteIdentity"></ndm-input><ndm-input label="modems.editor.usblte.password" model="modem.data.password" name="usbltePassword"></ndm-input></ndm-sub-form>'),e.put("app/page/controlPanel/myInternet/modems/modems.edit.usbmodem.html",'<ndm-form-header hr="hr-light-blue" label="modems.editor.usbmodem.subform-title" sub-title="modems.editor.usbmodem.subform-info"></ndm-form-header><ndm-selectbox label="modems.editor.usbmodem.country" options="modem.options.countries" name="country" disabled="vm.ui.isLocked" on-value-change="modem.countrySelected" value="modem.data.country"></ndm-selectbox><ndm-selectbox label="modems.editor.usbmodem.preset" options="modem.options.presetsSelect" name="preset" disabled="vm.ui.isLocked" on-value-change="modem.presetSelected" value="modem.data.preset"></ndm-selectbox><ndm-input label="modems.editor.usbmodem.apn" model="modem.data.apn" name="apn"></ndm-input><ndm-input label="modems.editor.usbmodem.identity" model="modem.data.identity" name="usbmodemIdentity"></ndm-input><ndm-input label="modems.editor.usbmodem.password" model="modem.data.password" name="usbmodemPassword"></ndm-input><ndm-input label="modems.editor.usbmodem.phone" model="modem.data.phone" name="phone"></ndm-input><ndm-checkbox label="modems.editor.usbmodem.at" model="modem.data.at" bs-modifiable="0" ng-click="modem.atCheckboxClick()" name="at"></ndm-checkbox><ndm-details toggle-var="modem.data.at"><ndm-input label="AT1" name="at1" validation="ascii" model="modem.data.at1"></ndm-input><ndm-input label="AT2" name="at2" validation="ascii" model="modem.data.at2"></ndm-input><ndm-input label="AT3" name="at3" validation="ascii" model="modem.data.at3"></ndm-input></ndm-details>'),e.put("app/page/controlPanel/myInternet/modems/modems.html",'<ndm-page class="page-modems" label="modems.header-title" progress="vm.progress" no-leave-watcher="true" description="modems.header-sub-title"><ndm-tabs ng-if="vm.tabs.length > 0" tabs="vm.tabs" is-disabled="vm.ui.isLocked" label-prop="title" compare-prop="id" update-state-on-tab-change="true" can-select-tab="vm.canSwitchTab" on-tab-changed-fn="vm.onTabSelect"></ndm-tabs><div ng-show="vm.isUsbQmiTabActive" ng-include="\'app/page/controlPanel/myInternet/modems/usbqmi/usbqmi.html\'"></div> <div ng-repeat="modem in vm.modems"><div ng-show="!vm.isUsbQmiTabActive"><div ng-if="modem.id === vm.activeId && !modem.active && modem.loading" class="page-modems__loader"><i class="icon icon--load"></i> <div class="page-modems__loader-text" data-translate="">modems.loading</div></div><form ng-if="modem.isInitialized" name="vm.modems[\'{{modem.id}}\'].form" ng-show="modem.active" novalidate=""><ndm-isp-general-properties is-disabled="vm.modems[vm.activeId].form.$pending || vm.ui.isLocked" model="modem.data" status="modem.status" on-toggle="modem.onToggle"></ndm-isp-general-properties><fieldset ng-disabled="vm.ui.isLocked"><div ng-if="modem.tpl" ng-include="\'app/page/controlPanel/myInternet/modems/modems.edit.\' + modem.tpl + \'.html\'"></div></fieldset><ndm-pingcheck ng-if="::vm.pingcheckInstalled" is-disabled="vm.ui.isLocked" data="modem.data.pingcheck"></ndm-pingcheck><div ng-if="modem.iface.plugged === \'no\'"><hr class="hr-light-blue"><ndm-button btn-class="btn--long" on-click="vm.modems[vm.activeId].delete" is-disabled="vm.ui.isLocked" label="delete"></ndm-button></div><ndm-control-footer prefix="modems" form="vm.modems[vm.activeId].form" is-visible="vm.activeId && vm.modems[vm.activeId].form.modified && !vm.modems[vm.activeId].loading" is-save-disabled="!vm.modems[vm.activeId].form.modified || vm.modems[vm.activeId].form.$invalid || vm.modems[vm.activeId].loading || vm.modems[vm.activeId].form.$pending" save="vm.modems[vm.activeId].submit()"></ndm-control-footer></form></div></div><div class="_no-modems" ng-if="!vm.tabs.length"><div class="_no-modems__title" data-translate="">modems.absent-title</div> <span data-translate="">modems.absent-text</span></div><ndm-popup class="modems-operator-scan-popup" is-visible="vm.airScanPopup.isVisible" close="vm.airScanPopup.close" header-title="usbqmi.air-scan.header"><div ng-include="\'app/page/controlPanel/myInternet/modems/usbqmi/airScan/usbqmi.airScan.html\'"></div></ndm-popup></ndm-page>'),e.put("app/page/controlPanel/myInternet/otherConnections/otherConnections.html",'<ndm-page class="page-otherConnections" label="otherConnections.header" progress="vm.progress" description="otherConnections.description"><div ng-if="::vm.WIREGUARD_INSTALLED" ng-include="\'app/page/controlPanel/myInternet/otherConnections/wireguard/wireguard.section.html\'"></div> <div ng-if="::vm.ANY_PPP_INSTALLED" ng-include="\'app/page/controlPanel/myInternet/otherConnections/ppp/ppp.section.html\'"></div> <div ng-if="::vm.IPSEC_INSTALLED" ng-include="\'app/page/controlPanel/myInternet/otherConnections/ipsec/ipsec.section.html\'"></div> <div ng-if="::vm.IPV6_INSTALLED" ng-include="\'app/page/controlPanel/myInternet/otherConnections/ipv6to4/ipv6to4.section.html\'"></div></ndm-page>'),e.put("app/page/controlPanel/myInternet/policies/policies.html",'<ndm-page class="page-policies" label="policies.page-title" description="policies.page-description" progress="vm.progress" ng-dblclick="vm.deselectSelectedConsumers()"><ndm-tabs ng-if="vm.progress === 100" tabs="vm.tabs" is-disabled="vm.ui.isLocked" label-prop="label" compare-prop="id" active-tab="vm.activeModeOnLoad" can-select-tab="vm.canSwitchMode" on-tab-changed-fn="vm.onModeSwitch"></ndm-tabs><ndm-device-poller ng-if="vm.progress === 100"></ndm-device-poller><div ng-if="vm.progress === 100 && vm.mode === vm.PAGE_TAB.POLICY_CONSUMERS" ndm-polling="vm.updateTooltipData"></div> <div class="policies-editor" ng-class="{ \'policies-editor--consumers-mode\': vm.mode === vm.PAGE_TAB.POLICY_CONSUMERS }"><div class="policies-editor__mode-description"><span class="body-text">{{vm.modeDescription}}</span></div> <div class="policies-editor-header"><div ng-if="vm.moveConsumersFormIsVisible" class="move-consumers-form"><form name="vm.moveConsumersForm" class="move-consumers-form__form" novalidate=""><ndm-selectbox class="move-consumers-form__policy-dropdown" label="policies.policy-consumers.move-to-policy" value="vm.toPolicy" options="vm.toPolicyOptions" name="moveToPolicy"></ndm-selectbox><div class="move-consumers-form__toolbar"><ndm-button is-disabled="!vm.toPolicy" class="move-consumers-form__confirm" on-click="vm.moveConsumers" label="confirm"></ndm-button><a tabindex="0" ng-keydown="vm.onKeydown($event, vm.deselectSelectedConsumers)" class="move-consumers-form__cancel" ng-click="vm.deselectSelectedConsumers()" data-translate="">cancel</a></div></form></div><div ng-if="!vm.moveConsumersFormIsVisible" class="policies-editor-header__left" data-translate="">policies.policy</div> <div ng-if="vm.mode === vm.PAGE_TAB.POLICY_CONSUMERS && !vm.moveConsumersFormIsVisible" class="policies-editor-header__right" data-translate="">policies.policy-consumers.header</div></div> <div class="policies-editor-content" ng-class="{ \'policies-editor-content--consumers-mode\': vm.mode === vm.PAGE_TAB.POLICY_CONSUMERS }"><div class="policies-editor-content__left"><div class="policies-list"><div ng-if="vm.mode === vm.PAGE_TAB.POLICY_CONSUMERS || policy.id !== vm.constants.DEFAULT_DENY_POLICY" ng-repeat="policy in vm.policiesList"><div ng-if="!policy.isBeingRenamed" class="policies-list__policy" ng-class="{ \'policies-list__policy--selected\': policy.isSelected && !vm.dragStarted, \'policies-list__policy--droppable\': vm.dragStarted && !policy.isSelected, \'policies-list__policy--deny\': vm.dragStarted && !policy.isSelected && policy.id === vm.constants.DEFAULT_DENY_POLICY }" ng-drop="vm.mode === \'policy-consumers\' && policy.id !== vm.selectedPolicy.id" ng-drop-success="vm.onDropComplete($data, $event, policy, $index)" ng-click="vm.onPolicyClick($index)"><div class="policies-list__policy-name no-select" ng-class="{ \'policies-list__policy-name--renamable\': policy.isSelected && !policy.isDefaultDevicePolicy && !vm.dragStarted }"><span class="policies-list__policy-name-text"><span data-translate="">{{policy.description | escapeHtml}}</span></span> <span ng-if="policy.isModified">*</span> <span class="policies-list__policy-consumers-count" ng-if="vm.mode === vm.PAGE_TAB.POLICY_CONSUMERS">({{policy.consumersCount}})</span></div> <i ng-if="policy.isSelected && !policy.isDefaultDevicePolicy && !vm.dragStarted" class="policies-list__rename-policy-icon icon icon--pencil" title="{{\'policies.hint.rename-policy\' | translate}}" ng-click="vm.showPolicyNameEditor($event)"></i></div><div ng-if="policy.isBeingRenamed" class="policy-name-editor"><form name="vm.policyRenameForm" novalidate=""><ndm-key-press action-on="[\'escape\', \'enter\']" call-func="[vm.cancelPolicyRename, vm.renamePolicy]"></ndm-key-press><ndm-input label="" model="policy.description" name="policyName" set-focus="true" extra-validator="vm.isPolicyNameUnique" on-press-esc="vm.cancelPolicyRename()" validation="required"></ndm-input><div class="policy-editor-controls"><a tabindex="0" ng-keydown="vm.onKeydown($event, vm.renamePolicy)" ng-disabled="!policy.description" ng-click="vm.renamePolicy()" ng-class="{ \'policy-editor-controls__icon-as-btn--disabled action-link--disabled\': vm.policyRenameForm.$invalid }" class="policy-editor-controls__icon-as-btn"><i class="icon icon--check-green"></i> <span class="policy-editor-controls__btn-label" data-translate="">ok</span></a> <a tabindex="0" ng-keydown="vm.onKeydown($event, vm.cancelPolicyRename)" ng-click="vm.cancelPolicyRename()" class="policy-editor-controls__icon-as-btn"><i class="icon icon--cancel"></i> <span class="policy-editor-controls__btn-label" data-translate="">cancel</span></a></div></form></div></div></div></div> <div class="policies-editor-content__right"><div ng-if="vm.mode === vm.PAGE_TAB.INTERFACE_PRIORITIES" class="policy-interfaces-priority"><form name="vm.interfacesOrderForm" novalidate=""><ndm-table class="policy-interfaces-priority__table" ng-class="{ \'policy-interfaces-priority__table--disabled\': vm.policyIsBeingRenamed }" draggable="true" columns="vm.interfacePriorityTable.columns" on-drag-start="vm.interfacePriorityTable.onDragStart" on-drag-end="vm.interfacePriorityTable.onDragEnd" preloader-text="policies.interface-priorities.no-global-interfaces" data="vm.interfacesList"></ndm-table><input type="text" name="interfacesOrder" ng-model="vm.selectedPolicy.interfacesOrderModified" style="display: none;"></form></div> <div ng-if="vm.mode === vm.PAGE_TAB.POLICY_CONSUMERS" class="policy-consumers"><div ng-repeat="policy in vm.policiesToShowConsumersFrom" ng-if="policy.consumersCount !== 0 || vm.policiesToShowConsumersFrom.length === 1" ng-init="policyIdx = $index"><div ng-if="vm.policiesToShowConsumersFrom.length > 1" class="policy-consumers-list__header no-select" data-translate="">{{policy.description}}</div> <div ng-if="policy.consumersCount === 0" class="policy-consumers__policy-is-unused" data-translate="">policies.policy-consumers.policy-is-unused</div> <div ng-repeat="prop in ::vm.consumerProps" ng-init="itemData = vm.itemDataByProp[prop]"><div ng-if="policy[prop].length > 0" class="policy-consumers-list"><div ng-if="vm.policiesToShowConsumersFrom.length === 1" class="policy-consumers-list__header no-select" data-translate="">{{::(\'policies.policy-consumers.\' + prop)}}</div> <div ng-repeat="item in policy[prop]" ng-attr-item-idx="{{$index}}" ng-attr-item-prop="{{prop}}" ng-attr-policy-idx="{{policyIdx}}" ng-drag="!vm.isMobile" ng-drag-data="{item: item, index: $index, prop: prop}" ng-drag-start="vm.drag.onStart($event, $data)" ng-drag-success="vm.drag.onComplete($event, $data)" ng-drag-stop="vm.drag.onFailed($event, $data, item, {index: $index, prop: prop})" ng-click="vm.toggleConsumerSelectedState(item, {index: $index, prop: prop}, $event)" ng-class="{ \'policy-consumers-list__consumer--selected\': item.isSelected, \'policy-consumers-list__consumer--dragged\': item.isBeingDragged, \'policy-consumers-list__consumer--dragged-with-shadow\': item.isBeingDragged && ( (item.isSelected && vm.selectedConsumersCount > 1) || (!item.isSelected && vm.selectedConsumersCount > 0) ), \'policy-consumers-list__consumer--placeholder\': vm.dragStarted && item.isSelected && !item.isBeingDragged }" class="policy-consumers-list__consumer policy-consumers-list__consumer--{{item.type || itemData.type}} no-select"><div ng-if="!vm.isMobile" class="policy-consumers-list__drag-handle"></div> <div ng-if="itemData.isSegment" class="policy-consumers-list__consumer-label">{{vm.interfaceIdToLabelMap[item.id] || item[itemData.label]}}</div> <div ng-if="!itemData.isSegment" class="policy-consumers-list__consumer-label">{{item[itemData.label]}}</div> <i ng-if="item.wirelessAccessRestricted" class="policy-consumers-list__wireless-acl-restriction-icon"><ndm-tooltip-old class="policy-consumers-list__consumer-tooltip consumer-tooltip"><div class="consumer-tooltip__title" data-translate="">policies.consumer-tooltip.host-acl-restrictions.header</div><ul class="consumer-tooltip__list"><li class="consumer-tooltip__list-item" ng-repeat="(segment, aclData) in item.aclTooltipData"><div class="consumer-tooltip__indicator-icon-wrapper"><i class="consumer-tooltip__indicator-icon icon icon--{{aclData.accessAllowed ? \'indicator-online\' : \'indicator-block-online\'}}"></i></div>&mdash;&nbsp;{{aclData.description}}</li></ul></ndm-tooltip-old></i> <i ng-if="itemData.isSegment" class="policy-consumers-list__segment-icon"><ndm-tooltip-old class="policy-consumers-list__consumer-tooltip consumer-tooltip"><div class="consumer-tooltip__title" data-translate="">policies.consumer-tooltip.segment-unregistered-hosts.header</div><ul ng-if="item.unregisteredHosts.length > 0" class="consumer-tooltip__list"><li class="consumer-tooltip__list-item" ng-repeat="host in item.unregisteredHosts | limitTo : vm.MAX_UNREG_HOSTS_IN_TOOLTIP track by $index">&mdash;&nbsp;{{host}}</li><li class="consumer-tooltip__list-item consumer-tooltip__list-item--ref" ng-if="item.unregisteredHosts.length > vm.MAX_UNREG_HOSTS_IN_TOOLTIP" ndm-html-compile="vm.l10n.viewAllUnregisteredHosts"></li></ul><div ng-if="item.unregisteredHosts.length === 0" class="consumer-tooltip__text" data-translate="">policies.consumer-tooltip.segment-unregistered-hosts.no-hosts</div></ndm-tooltip-old></i></div></div></div></div></div></div></div> <div class="policies-editor-footer"><div class="policies-editor-footer__left" data-translate=""><div ng-if="vm.mode === vm.PAGE_TAB.INTERFACE_PRIORITIES" ng-attr-tabindex="{{vm.unsavedNewPolicyIsBeingRenamed ? -1 : 0}}" class="policies-editor__add-new-policy-link" ng-class="{\'action-link--disabled\': vm.unsavedNewPolicyIsBeingRenamed}" ng-keydown="vm.onKeydown($event, vm.addNewPolicy)" ng-disabled="vm.unsavedNewPolicyIsBeingRenamed" ng-click="vm.addNewPolicy()">+ <span data-translate="">policies.link.add-new-policy</span></div> <div ng-if="vm.mode === vm.PAGE_TAB.POLICY_CONSUMERS" ng-attr-tabindex="{{vm.selectedPolicyIndex === -1 ? -1 : 0}}" class="policies-editor__show-all-consumers-link" ng-class="{\'action-link--disabled\': vm.selectedPolicyIndex === -1}" ng-keypress="vm.onKeydown($event, vm.showAllConsumers)" ng-click="vm.selectedPolicyIndex !== -1 && vm.showAllConsumers()" data-translate="">policies.link.show-all-consumers</div></div> <div class="policies-editor-footer__right"><div ng-if="vm.mode === vm.PAGE_TAB.INTERFACE_PRIORITIES" class="policies-editor__is-auto-policy" ng-class="{\'policies-editor__is-auto-policy--left\': vm.interfacesList.length === 1}"><hr class="hr-light-blue"><form name="vm.autoCheckboxForm" novalidate=""><ndm-checkbox label="" name="isAutoPolicy" class="policies-editor__is-auto-checkbox" disabled="vm.selectedPolicy.isDefaultDevicePolicy || vm.selectedPolicy.isBeingRenamed" description="policies.interface-priorities.is-auto-policy" model="vm.selectedPolicy.isAuto"></ndm-checkbox></form></div></div></div></div><ndm-button ng-if="vm.selectedPolicyIndex !== -1" label="policies.btn.delete-policy" is-disabled="vm.selectedPolicy.isDefaultDevicePolicy" ng-click="vm.removeSelectedPolicy()"></ndm-button><ndm-control-footer prefix="policies" is-visible="vm.selectedPolicy.isModified || vm.otherModifiedPoliciesCount > 0" is-save-disabled="vm.ui.isLocked" save="vm.saveAllModifiedPolicies()" cancel="vm.resetAllModifiedPolicies()"></ndm-control-footer></ndm-page>'),e.put("app/page/controlPanel/myInternet/sms/sms.html",'<ndm-page class="page-sms {{vm.isPreviewVisible ? \'page-sms--preview\': \'\'}} {{vm.isModalVisible ? \'page-sms--overlayed\' : \'\'}}" label="sms.page-title" progress="vm.progress"><br><ndm-tabs ng-if="vm.isReady" tabs="vm.tabs" is-disabled="vm.ui.isLocked" label-prop="description" compare-prop="id" update-state-on-tab-change="true" can-select-tab="vm.canSwitchTab" on-tab-changed-fn="vm.onTabSelect"></ndm-tabs><div ng-include="\'app/page/controlPanel/myInternet/sms/previews/sms.previews.html\'"></div> <div ng-include="\'app/page/controlPanel/myInternet/sms/dialog/sms.dialog.html\'"></div> <div ng-include="\'app/page/controlPanel/myInternet/sms/sendingMessageResultModal/sms.sendingMessageResultModal.html\'"></div> <div ng-include="\'app/page/controlPanel/myInternet/sms/deleteModal/sms.deleteModal.html\'"></div> <div ng-include="\'app/page/controlPanel/myInternet/sms/messageEditor/sms.messageEditor.html\'"></div></ndm-page>'),e.put("app/page/controlPanel/myInternet/usbdsl/usbdsl.form.portmap.html",'<ndm-form-header hr="hr-light-blue" label="{{::(\'dsl.vlans-subtitle\' | translate)}}"></ndm-form-header><div class="form__row form__sockets"><ndm-switchport-container><ndm-switchport ng-repeat="port in vm.options.portsMap" label="port.name" is-combo="port.isCombo" is-sfp="port.isSfp" is-reversed="port.isReversed" is-blue="port.isBlue"><div class="page-usbdsl__switchport-data"><ndm-switchport-select ng-if="vm.options.freePorts.indexOf(+port.name) > -1" name="ports__{{port.name}}" options="vm.options.portRoles" on-change="vm.portmap.onChange" value="vm.portmap.data[+port.name]"></ndm-switchport-select><div ng-if="vm.options.freePorts.indexOf(+port.name) === -1" class="page-usbdsl__switchport-role"><i title="{{vm.getIforL10n(vm.options.busyPortRoles[+port.name].ifor)}}" class="icon icon--role-{{vm.options.busyPortRoles[+port.name].role}}"></i> <div class="role-without-icon" ng-if="vm.options.rolesWithoutIcon[vm.options.busyPortRoles[+port.name].role]">{{ vm.options.busyPortRoles[+port.name].role | uppercase}}</div></div> <div ng-if="port.port === vm.dslPort" class="page-usbdsl__portmap__spacer page-usbdsl__portmap__spacer--dsl"><i class="icon icon--role-inet"></i></div></div></ndm-switchport></ndm-switchport-container></div>'),e.put("app/page/controlPanel/myInternet/usbdsl/usbdsl.form.pvc-main.html",'<ndm-form-header hr="hr-light-blue" label="{{::(\'dsl.subtitle-inet-pvc\' | translate)}}"></ndm-form-header><ndm-input label="VPI" model="vm.data.inet.pvc.vpi" name="inet-vpi" error="vm.errors.pvc.inet" validation="required,range[0..255]"></ndm-input><ndm-input label="VCI" model="vm.data.inet.pvc.vci" name="inet-vci" error="vm.errors.pvc.inet" validation="required,range[32..65535]"></ndm-input><ndm-selectbox ng-init="vm.data.pvc.encapsulation = vm.data.pvc.encapsulation || vm.options.encapsulationSelect[0].id" label="{{::(\'dsl.fields.encapsulation\' | translate)}}" value="vm.data.inet.pvc.encapsulation" name="inet-encapsulation" options="vm.options.encapsulationSelect"></ndm-selectbox>'),e.put("app/page/controlPanel/myInternet/usbdsl/usbdsl.form.pvcs.html",'<div class="page-usbdsl__additional-pvcs"><div ng-repeat="(key, role) in {voip: \'voip\', iptv: \'iptv\', iptv2: \'iptv\', iptv3: \'iptv\'}" ng-if="(!key.substring(4, 5) || +key.substring(4, 5) <= vm.showMoreIptvPvcs)" class="page-usbdsl__additional-pvcs-row"><div class="page-usbdsl__additional-pvcs-column"><ndm-input label="dsl.fields.pvc-{{::role}}" icon="svg-{{::role}}" model="vm.data[key].pvc.vpi" name="{{::key}}-vpi" placeholder="VPI" error="vm.errors.pvc[key]" validation="range[0..255]{{vm.data[key].pvc.vci || vm.portmap.usedRoles.indexOf(key) > -1 ? \',required\' : \'\'}}"></ndm-input></div><div class="page-usbdsl__additional-pvcs-column"><ndm-input model="vm.data[key].pvc.vci" name="{{::key}}-vci" placeholder="VCI" error="vm.errors.pvc[key]" validation="range[32..65535]{{vm.data[key].pvc.vpi || vm.portmap.usedRoles.indexOf(key) > -1 ? \',required\' : \'\'}}"></ndm-input></div><div class="page-usbdsl__additional-pvcs-column"><ndm-selectbox value="vm.data[key].pvc.encapsulation" name="{{::key}}-encapsulation" options="vm.options.encapsulationSelect"></ndm-selectbox></div></div> <a tabindex="0" ng-show="vm.showMoreIptvPvcs <= 2" ng-click="vm.showMoreIptvPvcs = vm.showMoreIptvPvcs + 1" class="action-link page-usbdsl__additional-pvcs-more-iptv" data-translate="">dsl.add-more-iptv-pvc-btn</a></div>'),e.put("app/page/controlPanel/myInternet/usbdsl/usbdsl.form.vlans.html",'<ndm-form-header hr="hr-light-blue" label="dsl.subtitle-vlan"></ndm-form-header><div class="page-usbdsl__vlans-list"><div ng-repeat="role in [\'inet\', \'iptv\', \'voip\']"><ndm-input label="dsl.fields.vlan-{{::role}}" model="vm.data[role].vlan" name="{{::role}}-vlan" icon="svg-{{::role}}" placeholder="{{\'dsl.fields.vlan-\' + (role.substr(0,4)) + \'-placeholder\' | translate}}" error="vm.errors.vlan[role]" validation="range[2..4094]{{role !== \'iptv\' && role !== \'inet\' && vm.portmap.usedRoles.indexOf(role) > -1 ? \',required\' : \'\'}}"></ndm-input></div></div>'),e.put("app/page/controlPanel/myInternet/usbdsl/usbdsl.html",'<form ng-if="vm.progress >= 100" name="vm.form" class="page-usbdsl--form" ng-class="{\'page-usbdsl__form--pending\': vm.form.$pending}" novalidate="" ng-cloak=""><div ndm-polling="vm.updateUserInfo"></div><div class="isp-top-row"><ndm-toggle class="isp-top-row__toggle" label-on="dsl.toggle-on-label" label-off="dsl.toggle-off-label" description="vm.state.connection" name="up" model="vm.toggle.state" ndm-polling="vm.toggle.polling" call-on-change="vm.toggle.onToggle"></ndm-toggle><ndm-iface-order ng-if="vm.data.mode.type === vm.vdslClientMode" class="isp-top-row__order-selectbox" name="order" required="vm.isDslDevice" ng-model="vm.data.order"></ndm-iface-order><ndm-schedule-select ng-if="0" class="isp-top-row__schedule-selectbox" name="schedule" model="vm.data.schedule" no-selected-thumb="true"></ndm-schedule-select></div><ndm-form-header hr="hr-light-blue" label="dsl.subtitle-dsltype"></ndm-form-header><ndm-radio label="dsl.fields.mode" name="mode" array="vm.options.modes" model="vm.data.mode.mode" on-change="vm.onModeChange"></ndm-radio><ndm-radio ng-if="vm.options.types.length > 1 && vm.data.mode.mode === \'vdsl\'" label="dsl.fields.type" name="type" array="vm.options.types" model="vm.data.mode.type"></ndm-radio><ndm-radio ng-show="vm.data.mode.mode === \'adsl\' && vm.options.operationModes.length > 1" label="dsl.fields.operation-mode" name="operation-type" array="vm.options.operationModes" model="vm.data.mode.operationMode" on-change="vm.onOperationModeChange"></ndm-radio><ndm-checkbox-list ng-if="!vm.data.isUsbdsl" label="dsl.fields.olr" name="olr" nobr="true" options="vm.options.olrModes" model="vm.data.dsl.olr"></ndm-checkbox-list><ndm-input ng-if="vm.data.mode.type === vm.vdslClientMode" label="dsl.fields.description" name="description" validation="required" model="vm.data.description"></ndm-input><ndm-form-header hr="hr-light-blue" label="{{vm.data.mode.mode === \'vdsl\' ? \'dsl.subtitle-vdsl\' : \'dsl.subtitle-adsl\'}}"></ndm-form-header><ndm-selectbox ng-if="vm.data.mode.mode !== \'vdsl\'" label="dsl.fields.annex" name="annex" options="vm.options.annexes" value="vm.data.dsl.annex"></ndm-selectbox><ndm-checkbox-list ng-if="vm.data.mode.mode === \'vdsl\'" model="vm.data.dsl.profiles" label="dsl.fields.vdsl-profiles" nobr="true" options="vm.options.profiles"></ndm-checkbox-list><ndm-selectbox ng-if="vm.data.mode.mode === \'vdsl\'" label="dsl.fields.carrier" name="carrier" options="vm.options.carriers" value="vm.data.dsl.carrier"></ndm-selectbox><ndm-selectbox ng-if="vm.data.mode.mode === \'vdsl\' && vm.data.mode.type === \'server\'" label="dsl.fields.psd-mask" name="psd" options="vm.options.psds" value="vm.data.dsl.psd"></ndm-selectbox><ndm-selectbox ng-if="vm.data.mode.mode === \'vdsl\' && vm.data.mode.type !== vm.vdslClientMode" label="dsl.fields.segment" name="bridge" options="vm.options.segments" value="vm.data.mode.segment"></ndm-selectbox><ng-include ng-if="vm.data.mode.mode !== \'vdsl\' && vm.data.mode.type === vm.vdslClientMode" src="\'app/page/controlPanel/myInternet/usbdsl/usbdsl.form.pvc-main.html\'"></ng-include><ndm-isp-iface ng-if="vm.data" prefix="dsl" ip-data="vm.data.inet.ip" ppp-data="vm.data.ppp" used-subnets="vm.usedSubnets" subtitle-ip="dsl.subtitle-ip" subtitle-ppp="dsl.subtitle-ppp" show-mac-mode="false" status="vm.state" is-disabled="vm.ui.isLocked"></ndm-isp-iface><ndm-pingcheck ng-if="vm.data.pingcheck !== false && vm.data.mode.type === vm.vdslClientMode" data="vm.data.pingcheck"><div class="pingcheck-status"><div ng-if="vm.toggle.state && vm.data.pingcheck && vm.state.pingcheck" class="pingcheck-status--{{vm.state.pingcheck.color}}">{{vm.state.pingcheck.text}}</div></div></ndm-pingcheck><ng-include ng-if="vm.data.mode.type === vm.vdslClientMode" src="\'app/page/controlPanel/myInternet/usbdsl/usbdsl.form.portmap.html\'"></ng-include><ng-include ng-if="vm.data.mode.type === vm.vdslClientMode && vm.data.mode.mode === \'vdsl\'" src="\'app/page/controlPanel/myInternet/usbdsl/usbdsl.form.vlans.html\'"></ng-include><ng-include ng-if="vm.data.mode.type === vm.vdslClientMode && vm.data.mode.mode !== \'vdsl\'" src="\'app/page/controlPanel/myInternet/usbdsl/usbdsl.form.pvcs.html\'"></ng-include><hr class="hr-light-blue"><ndm-button is-disabled="vm.form.$pending" on-click="vm.resetSettings" btn-class="btn--long" label="dsl.clear-settings-button"></ndm-button><ndm-control-footer prefix="usbdsl" form="vm.form" is-visible="vm.form.modified" is-save-disabled="vm.form.$invalid || vm.form.$pending" save="vm.submit()"></ndm-control-footer></form><div class="page-usbdsl__spacer"></div>'),e.put("app/page/controlPanel/myInternet/usbdsl/usbdsls.html",'<ndm-page class="page-usbdsl" label="dsl.page-title" progress="Dsls.progress" description="dsl.page-description"><div ng-if="Dsls.dsls.length === 1" ng-include="\'app/page/controlPanel/myInternet/usbdsl/usbdsl.html\'" ng-controller="UsbDslController as vm" ng-init="vm.init(Dsls.dsls[0], Dsls);"></div><ndm-tabs ng-if="Dsls.progress === 100 && Dsls.dsls.length > 1" tabs="Dsls.tabs" label-prop="label" active-tab="segments.activeTab" on-tab-changed-fn="Dsls.setActiveTab"></ndm-tabs><div ng-if="Dsls.dsls.length > 1" ng-include="\'app/page/controlPanel/myInternet/usbdsl/usbdsl.html\'" ng-controller="UsbDslController as vm" ng-init="vm.init(Dsls.dsls[0], Dsls);"></div></ndm-page>'),e.put("app/page/controlPanel/myInternet/ussd/ussd.html",'<ndm-page class="page-ussd" label="ussd.title" description="ussd.description" progress="vm.progress"><br><ndm-tabs ng-if="vm.isReady" tabs="vm.tabs" is-disabled="vm.ui.isLocked" label-prop="description" compare-prop="id" update-state-on-tab-change="true" on-tab-changed-fn="vm.onTabSelect"></ndm-tabs><div class="page-ussd__request-input-wrapper"><ndm-input class="page-ussd__request-input" label="ussd.request-input-label" model="vm.requestStrings[vm.selectedInterfaceId]" extra-validator="vm.isValidUssd"><i class="page-ussd__reset-icon icon icon--cancel" ng-click="vm.resetRequestString()"></i></ndm-input></div><ndm-button class="page-ussd__send-btn" label="ussd.send-btn" is-disabled="vm.ui.isLocked || !vm.requestStrings[vm.selectedInterfaceId] || !vm.selectedInterfaceState.modemStateIsOk" on-click="vm.sendUssdRequest"></ndm-button><ndm-textarea class="page-ussd__response" label="" rows="10" model="vm.responseStrings[vm.selectedInterfaceId]"></ndm-textarea></ndm-page>'),e.put("app/page/controlPanel/myInternet/wifiClient/wifiClient.html",'<ndm-page label="{{ ::WCC.isInRouterMode ? \'wifiClient.header\' : (\'wifiClient.\' + WCC.sysmode + \'-header\') }}" progress="WCC.progress" description="{{ ::WCC.isInRouterMode ? \'wifiClient.description\' : \'wifiClient.special-mode-description\' }}" class="wifiClient-page"><div ng-if="::(WCC.isReady && WCC.isInRouterMode)"><div ng-if="!WCC.wpsPopup.isVisible && !WCC.popup.isVisible" ndm-polling="WCC.updateState" ndm-interval="{{::WCC.stateUpdateTimeout}}"></div></div><form ng-if="WCC.masterInterface.hwstate === \'on\'" name="WCC.form" novalidate=""><ndm-tabs ng-if="WCC.tabs.length && WCC.tabs.length > 1" tabs="WCC.tabs" label-prop="name" compare-prop="id" is-disabled="WCC.ui.isLocked" active-tab="WCC.activeTabName" can-select-tab="WCC.canSwitchTab" update-state-on-tab-change="true" on-tab-changed-fn="WCC.setActiveTab"></ndm-tabs><ndm-toggle ng-if="!WCC.isInRouterMode" class="ndm-isp-general-properties__toggle ndm-isp-general-properties__toggle--state-{{WCC.data.state.color}}" label="{{\'ndm-isp-general-properties.toggle-label\'}}" label-on="{{WCC.data.state.text}}" label-off="{{WCC.data.state.text}}" name="{{WCC.data.masterId}}up" disabled="WCC.ui.isLocked" model="WCC.data.isUp" call-on-change="WCC.onToggleClick"></ndm-toggle><ndm-fieldset is-disabled="WCC.ui.isLocked"><ndm-isp-general-properties ng-if="WCC.isInRouterMode" is-disabled="WCC.ui.isLocked" model="WCC.data" name-prefix="{{WCC.data.masterId}}" status="WCC.data.state" on-toggle="WCC.onToggleClick"></ndm-isp-general-properties><ndm-form-header hr="{{::WCC.isInRouterMode ? \'hr-light-blue\' : \'\'}}" class="wifiClient-page__main-settings-header" label="wifiClient.title-client-params"></ndm-form-header><ndm-fieldset class-name="mws-controlled-section" is-disabled="NDM.DEVICE_IS_MWS_MEMBER"><ndm-input ndm-disabled-by-mws-tooltip="" class="ssid-input" label="wifiClient.network-name" model="WCC.data.ssid" name="ssid" description="wifiClient.network-select" description-click="WCC.popup.show" is-description-disabled="WCC.ui.isLocked" validation="required,maxLengthInBytes[32]"></ndm-input><ndm-selectbox ndm-disabled-by-mws-tooltip="" disabled="WCC.ui.isLocked || NDM.DEVICE_IS_MWS_MEMBER" label="wifiClient.network-protection" name="encryptionsList" options="WCC.encryptionsList" value="WCC.data.encryptionMethod"></ndm-selectbox><div ng-if="WCC.isWep(WCC.data.encryptionMethod)" ng-disabled="NDM.DEVICE_IS_MWS_MEMBER"><ndm-input ndm-disabled-by-mws-tooltip="" is-description-disabled="WCC.ui.isLocked" label="{{WCC.l10n.wepKey + \' \' + WCC.data.encryption.key[0].id}}" model="WCC.data.encryption.key[0].hex" name="{{\'passwordKey\' + WCC.data.encryption.key[0].id}}" password="true" validation="required,wepKey,wepValidation"></ndm-input><ndm-input ndm-disabled-by-mws-tooltip="" is-description-disabled="WCC.ui.isLocked" ng-repeat="k in [1,2,3]" label="{{WCC.l10n.wepKey + \' \' + (k + 1)}}" model="WCC.data.encryption.key[k].hex" name="{{\'passwordKey\' + WCC.data.encryption.key[k].id}}" password="true" validation="wepKey,wepValidation"></ndm-input></div><ndm-input ng-if="WCC.isAnyWpaPsk(WCC.data.encryptionMethod)" ndm-disabled-by-mws-tooltip="" password="true" focus-when="WCC.networkIsSelected" is-description-disabled="WCC.ui.isLocked" label="wifiClient.password" model="WCC.data.password" placeholder="{{WCC.l10n.pskPlaceholder}}" name="wifiClientPassword" validation="required,wpaPsk"></ndm-input></ndm-fieldset><ndm-details class="wifiClient-page__additional-settings" label-visible="wifiClient.show-additional-settings" label-hidden="wifiClient.hide-additional-settings" toggle-var="WCC.additionalSettingsBlockIsVisible"><ndm-input label="wifiClient.bssid" model="WCC.data.bssid" placeholder="22:33:44:55:66:77" validation="mac"><ndm-help><span data-translate="">wifiClient.bssid-description</span></ndm-help></ndm-input></ndm-details><ndm-button btn-class="wifiClient-page__start-wps-button" is-disabled="WCC.ui.isLocked" label="wifiClient.ui.wps-button" on-click="WCC.wpsPopup.startWps"></ndm-button><ndm-iface-ip ng-if="WCC.isInClientOrRouterMode" is-disabled="WCC.ui.isLocked || NDM.DEVICE_IS_MWS_MEMBER" details-always-shown="NDM.DEVICE_IS_MWS_MEMBER" label="wifiClient.ip-address" data="WCC.data.ipModel" used-ips="WCC.data.usedIpAddresses" disable-none="true" name-prefix="wifiClient.ip-config" no-additional-settings="true" auto-with-dhcp="true"><div ng-if="WCC.data.isUp && WCC.data.savedSsid && WCC.data.ipModel.mode === \'auto\' && WCC.data.ipStatus" class="ip-status"><span class="help-text" ng-class="{ \'help-text--warning\': WCC.data.ipStatus.color === \'red\', \'help-text--success\': WCC.data.ipStatus.color === \'green\' }"><span data-translate="">{{WCC.data.ipStatus.text}}</span></span></div></ndm-iface-ip><ndm-pingcheck ng-if="::WCC.pingcheckAvailable" is-disabled="WCC.ui.isLocked" data="WCC.data.pingcheck"><div class="pingcheck-status"><div ng-if="WCC.data.isUp && WCC.data.savedSsid && WCC.data.pingcheck && WCC.data.pingcheck.mode !== \'none\'" class="pingcheck-status--{{WCC.data.pingCheckStatus.color}}">{{WCC.data.pingCheckStatus.text}}</div></div></ndm-pingcheck><div ng-if="WCC.data.savedSsid"><hr class="hr-light-blue"><ndm-button class="wifiClient-page__reset-btn" is-disabled="WCC.ui.isLocked" on-click="WCC.resetSettings" btn-class="btn--long" label="wifiClient.ui.clear-settings-button"></ndm-button></div></ndm-fieldset><ndm-control-footer prefix="wifiClient" is-visible="WCC.form.modified || WCC.form.modifiedChildFormsCount > 0" is-save-disabled="WCC.ui.isLocked || WCC.form.$invalid" form="WCC.form" save="WCC.save()" cancel="WCC.cancel()"></ndm-control-footer></form><div ng-if="WCC.masterInterface.hwstate === \'off\'" class="wifi-turned-off-msg"><div class="wifi-turned-off-msg__header" data-translate="">wifiClient.turned-off.title</div> <span class="wifi-turned-off-msg__text" data-translate="">wifiClient.turned-off.text</span></div></ndm-page><ndm-alert class="wifiClient-wps-session-alert" is-visible="WCC.wpsPopup.isVisible" is-close-button-hidden="false" hide="WCC.wpsPopup.stop()" label="wifiClient.wps-popup.title" sub-title="wifiClient.wps-popup.description"><div ng-if="WCC.wpsPopup.isVisible" ndm-polling="WCC.wpsPopup.onUpdate"></div> <div ng-if="WCC.wpsPopup.progressBarIsVisible"><div class="wifiClient-wps-session-alert__session-time">{{WCC.wpsPopup.timeStr}}</div><ndm-progress-bar is-visible="WCC.wpsPopup.progressBarIsVisible" count="WCC.wpsPopup.progress" is-count-hidden="true"></ndm-progress-bar></div><ndm-button class="wifiClient-wps-session-alert__stop-btn" is-disabled="WCC.wpsPopup.isStopping" ng-click="WCC.wpsPopup.stop()" label="wifiClient.wps-popup.stop-session"></ndm-button></ndm-alert><ndm-popup is-visible="WCC.popup.isVisible" class="wifiClient-site-survey-popup" header-title="{{\'wifiClient.site-survey-popup.title-\' + (WCC.data.masterId === NDM.MASTER_5G ? \'5\' : \'2.4\')}}" close="WCC.popup.cancel" save="WCC.addRule"><div ng-if="WCC.popup.isVisible" ndm-polling="WCC.popup.updateData" ndm-interval="{{::WCC.siteSurveryUpdateTimeout}}"></div> <div class="wifiClient-site-survey-popup__content" ng-class="{\'wifiClient-site-survey-popup__content--locked\' : WCC.popup.isProcessingUserChoice}"><ndm-text text="wifiClient.site-survey-popup.description"></ndm-text><ndm-input-filter name="ssidFilter" class-name="wifiClient-site-survey-popup__filter" is-disabled="WCC.popup.table.data.length === 0" value="WCC.popup.ssidFilter" on-change="WCC.popup.filterTableData"></ndm-input-filter><ndm-table ng-if="WCC.popup.table.data.length > 0" data="WCC.popup.table.filteredData" columns="WCC.popup.table.columns" sort-name="WCC.popup.table.sortBy" sort-reverse="WCC.popup.table.sortReverse" click-on-row="WCC.popup.selectNetwork" track-by-prop="address" preloader-text="wifiClient.site-survey-popup.table.no-matching-networks"></ndm-table><div ng-if="WCC.popup.table.data.length === 0" class="empty-list" data-translate="">wifiClient.site-survey-popup.preloader-text</div></div></ndm-popup>'),e.put("app/page/controlPanel/myInternet/wired/wired.html",'<ndm-page class="page-wired" label="wired.header" progress="vm.progress" description="wired.description"><ndm-tabs ng-if="vm.tabs.list.length > 0 || vm.newConnectionCanBeAdded" is-disabled="vm.ui.isLocked" tabs="vm.tabs.list" label-prop="label" new-tab-constructor-fn="vm.tabs.createNewTab" add-tab-btn-is-disabled="vm.tabs.canNotAddTab()" add-tab-btn-label="wired.add-network" can-select-tab="vm.tabs.canSwitchTab" update-state-on-tab-change="true" on-tab-changed-fn="vm.tabs.onSelectTab"></ndm-tabs><form ng-if="vm.model" name="vm.form"><ndm-isp-general-properties ng-if="vm.isReady" is-disabled="vm.ui.isLocked" model="vm.model.general" initial-order-data="vm.rciInterfaceData" status="vm.status.connection" on-toggle="vm.toggleWiredConnectionState"></ndm-isp-general-properties><div ng-include="\'app/page/controlPanel/myInternet/wired/wired.portmap-and-vlans.html\'"></div><ndm-isp-iface ng-if="vm.connectionsList" prefix="wired" ip-data="vm.model.ip" ppp-data="vm.model.ppp" used-subnets="vm.model.usedSubnets" subtitle-ip="wired.title-ip-config" subtitle-ppp="{{vm.l10n.pppTitle}}" show-mac-mode="true" on-ppp-change="vm.onPppChange" status="vm.status" is-disabled="vm.ui.isLocked"></ndm-isp-iface><div ng-if="vm.DOT1X_INSTALLED"><ndm-iface-dot1x is-disabled="vm.ui.isLocked" name-prefix="wired" data="vm.model.dot1x"></ndm-iface-dot1x></div><ndm-pingcheck ng-if="::vm.PINGCHECK_INSTALLED" is-disabled="vm.ui.isLocked" data="vm.model.pingcheck"><div class="pingcheck-status"><div ng-if="vm.model.general.isUp && vm.status.pingcheck" class="pingcheck-status--{{vm.status.pingcheck.color}}">{{vm.status.pingcheck.text}}</div></div></ndm-pingcheck><div ng-if="!vm.model.general.isNew"><ndm-form-header hr="hr-light-blue" label=""></ndm-form-header><ndm-button btn-class="btn--long" is-disabled="vm.ui.isLocked" on-click="vm.deleteConnection" label="wired.delete-connection"></ndm-button></div></form><ndm-control-footer ng-if="vm.tabs.list.length > 0" prefix="wired" is-visible="vm.isReady && (vm.model.isNew || vm.form.modified)" is-save-disabled="vm.ui.isLocked || vm.form.$invalid" save="vm.save" cancel="vm.cancel"></ndm-control-footer></ndm-page>'),e.put("app/page/controlPanel/myInternet/wired/wired.portmap-and-vlans.html",'<div ng-form="vm.form.portmap" class="page-wired__portmap wired-portmap"><ndm-form-header hr="hr-light-blue" label="wired.portmap.title" sub-title="wired.portmap.description"></ndm-form-header><ndm-switchport-container class="page-wired__switchports"><ndm-switchport ng-repeat="portObj in vm.model.portmap track by portObj.portName" class="page-wired__ndm-switchport" label="portObj.portData.name" is-combo="portObj.isCombo" is-sfp="portObj.isSfp" is-reversed="portObj.isReversed" is-blue="portObj.isBlue"><div class="page-wired__switchport-data"><ndm-switchport-select ng-if="!portObj.isBusy && !portObj.isDsl" is-disabled="vm.ui.isLocked" name="{{vm.PORT_ROLE_FIELD_PREFIX + portObj.portName}}" value="portObj.role" options="portObj.roleOptions" on-change="vm.validation.onPortRoleChanged"></ndm-switchport-select><ndm-switchport-role ng-if="portObj.isBusy" role="portObj.hasRoleIcon ? portObj.role : \'\'" role-text="!portObj.hasRoleIcon ? portObj.role : \'\'" title="vm.getIforL10n(portObj.forInterface)"></ndm-switchport-role></div></ndm-switchport></ndm-switchport-container><fieldset ng-disabled="vm.ui.isLocked"><ndm-details class="page-wired__vlans-wrapper" toggle-var="vm.ui.showVlans" label-visible="wired.vlans-accordion-link" label-hidden="wired.vlans-accordion-link"><div class="page-wired__vlans-list"><ndm-input class-name="ndm-input-s" max-length="4" label="internet" model="vm.model.inetVlan" name="inetVlan" icon="svg-inet" placeholder="VLAN ID" error="vm.error.inetVlan" on-change="vm.validation.onVlanChange" validation-text-error="{notInArray: \'errors.vlan-used\'}" validation="range[2..4094],notInArray[{{vm.model.busyVlans}}]"></ndm-input><ndm-input class-name="ndm-input-s" max-length="4" label="wired.telephony" model="vm.model.voipVlan" name="voipVlan" icon="svg-voip" placeholder="VLAN ID" error="vm.error.voipVlan" extra-validator="vm.validation.checkVoipVlan" on-change="vm.validation.onVlanChange" validation-text-error="{notInArray: \'errors.vlan-used\'}" validation="range[2..4094],notInArray[{{vm.model.busyVlans}}]"></ndm-input><ndm-input class-name="ndm-input-s" max-length="4" label="wired.television" model="vm.model.iptvVlan" name="iptvVlan" icon="svg-iptv" placeholder="VLAN ID" error="vm.error.iptvVlan" on-change="vm.validation.onVlanChange" validation-text-error="{notInArray: \'errors.vlan-used\'}" validation="range[2..4094],notInArray[{{vm.model.busyVlans}}]"></ndm-input><ndm-input class-name="ndm-input-s" max-length="4" label="wired.television2" model="vm.model.iptvVlan2" name="iptvVlan2" icon="svg-iptv" placeholder="VLAN ID" error="vm.error.iptvVlan2" on-change="vm.validation.onVlanChange" validation-text-error="{notInArray: \'errors.vlan-used\'}" validation="range[2..4094],notInArray[{{vm.model.busyVlans}}]"></ndm-input></div></ndm-details></fieldset></div>'),e.put("app/page/controlPanel/myNetwork/devicesList/blockedDevice.form.html",'<form ng-cloak="" class="page-devices-list form" name="DevicesList.blockedDevicesForm" ng-show="DevicesList.deviceCard.status === \'blocked\'"><hr class="hr-invisible"><ndm-input label="{{\'devices-list.device-card.device-name\'}}" model="DevicesList.deviceCard.registeredName" name="deviceName" validation="required,validationOnUsedName,maxLengthInBytes[64]"><ndm-button class="page-devices-list__wake-on-lan-btn" label="{{DevicesList.wakeOnLanInProgress ? \'\': \'devices-list.device-card.wake-on-lan\'}}" icon="{{DevicesList.wakeOnLanInProgress ? \'load\' : \'\'}}" ng-click="DevicesList.wakeOnLan(DevicesList.deviceCard.mac)"></ndm-button></ndm-input><ndm-policy-select name="policy" value="DevicesList.deviceCard.policy"><div ng-if="DevicesList.deviceCard.policy !== DevicesList.DEFAULT_DENY_POLICY && (DevicesList.deviceCard.savedSchedule && !DevicesList.schedulesData[DevicesList.deviceCard.savedSchedule])" class="device-card__internet-access-blocked-on-schedule" data-translate="">devices-list.device-card.internet-access-blocked-on-schedule</div></ndm-policy-select><ndm-sub-form ng-show="DevicesList.deviceCard.policy !== DevicesList.DEFAULT_DENY_POLICY"><ndm-schedule-select label="devices-list.device-card.schedule" name="schedule" model="DevicesList.deviceCard.schedule"></ndm-schedule-select></ndm-sub-form><ndm-selectbox ng-if="DevicesList.deviceCard.dnsFilter && DevicesList.dnsFilter.options.length > 0" label="devices-list.device-card.internet-filter" name="dnsFiltration" options="DevicesList.dnsFilter.options" value="DevicesList.deviceCard.dnsFilter.value"></ndm-selectbox><div ng-if="DevicesList.dnsFiltersAvailable && !DevicesList.deviceCard.dnsFilter" class="dns-not-configured"><div class="form__cell form__cell--input-label">{{\'devices-list.device-card.internet-filter\' | translate}}</div> <div class="form__cell help-text" ndm-html-compile="DevicesList.l10n.noDnsConfigured"></div></div><ndm-checkbox label="devices-list.device-card.permanent-ip" name="permanentIp" model="DevicesList.deviceCard.isPermanentIp"></ndm-checkbox><ndm-sub-form ng-if="DevicesList.deviceCard.isPermanentIp"><ndm-input label="devices-list.device-card.IP-address" model="DevicesList.deviceCard.ip" name="ipAddressInput" validation="required,ip,ipValidationInBlockedController" hint="hints.serverAddress"></ndm-input></ndm-sub-form><hr class="hr-light-blue"><ndm-device-wifi-acl ng-if="DevicesList.wifiIsSupported && DevicesList.deviceCard.status === \'blocked\'" name="wifi-acl__blocked" mac="{{DevicesList.deviceCard.mac}}" permissions="DevicesList.deviceCard.macAccess"></ndm-device-wifi-acl><div ng-if="DevicesList.HAS_WIFI_5 && DevicesList.wifiIsSupported && DevicesList.deviceCard.status === \'blocked\'"><hr class="hr-light-blue"><ndm-device-wifi-band name="wifi-band_blocked" mac="{{DevicesList.deviceCard.mac}}" restrictions="DevicesList.deviceCard.wifiBandRestrictions" segments-data="DevicesList.segmentsData"></ndm-device-wifi-band></div> <div ng-if="DevicesList.isDeviceCardVisible && !DevicesList.deviceCard.isConnectedByAdapter" class="wrap" ng-hide="DevicesList.ipStatic.length === 0"><ndm-title class="disabled" label="devices-list.ports.transfering"></ndm-title><ndm-table ng-if="DevicesList.isDeviceCardVisible && DevicesList.ipStatic.length" table-class="table table--popup table_2" data="DevicesList.ipStatic" sortable="false" click-on-row="DevicesList.openPopupRule" track-by-prop="index" columns="DevicesList.portForwardingColumns"></ndm-table><div ng-if="!DevicesList.ipStatic.length" class="empty-list"><span data-translate="">devices-list.ports.no-rules</span></div> <div class="form__cell"><ndm-button ng-click="DevicesList.openPopupRule(); DevicesList.openSecondaryPopup = true" label="devices-list.ports.add-rule"></ndm-button><a class="page-devices-list__delete-all-forwarding-rules-link" ng-hide="!DevicesList.ipStatic.length" ng-click="DevicesList.deleteAllDeviceForwardingRules(DevicesList.deviceCard.mac, DevicesList.deviceCard.ip)"><span data-translate="">devices-list.ports.delete-all-rules</span></a></div></div> <div ng-if="DevicesList.deviceCard.isConnectedByWiFi || DevicesList.deviceCard.isWired" class="wrap"><hr class="hr-invisible"><ndm-title class="cp-main__secondary-title secondary-title disabled" label="devices-list.device-card.additional-info.header"></ndm-title><ndm-list info-obj="DevicesList.deviceCard.additionalInfoObj"></ndm-list></div><hr class="hr-light-blue"><ndm-button class="page-devices-list__unregister-device-btn" btn-class="btn--long" on-click="DevicesList.deleteRegistration()" label="devices-list.device-card.delete-registration"></ndm-button><ndm-control-footer prefix="blockedDevice" is-visible="DevicesList.blockedDevicesForm.modified" is-popup="true" is-save-disabled="DevicesList.blockedDevicesForm.$invalid" save="DevicesList.saveConfiguration(\'blocked\')" cancel="DevicesList.closeDeviceCard()"></ndm-control-footer></form>'),e.put("app/page/controlPanel/myNetwork/devicesList/blockedDevice.popup.html",'<ndm-popup class="page-devices-list__device-popup blocked-device-popup" is-visible="DevicesList.isDeviceCardVisible && DevicesList.deviceCard.status === \'blocked\'" header-title="{{DevicesList.deviceCard.name || DevicesList.deviceCard.hostname | escapeHtml}}" header-status-class="{{DevicesList.deviceCard.getDeviceStatus(DevicesList.deviceCard.status)}}" header-status-text="{{DevicesList.deviceCard.status}}" close="DevicesList.closeDeviceCard" save="DevicesList.saveConfiguration"><div ng-include="\'app/page/controlPanel/myNetwork/devicesList/blockedDevice.form.html\'"></div></ndm-popup>'),e.put("app/page/controlPanel/myNetwork/devicesList/devicesList.html",'<ndm-page class="page-devices-list" label="devices-list.header" progress="DevicesList.progress" description="devices-list.description"><div ndm-interval="10000" ndm-polling="DevicesList.updateMwsData"></div><form name="DevicesList.advancedForm"><ndm-title label="devices-list.not-registered-devices.header"><ndm-help><div class="baloon__body-title body-text" data-translate="">devices-list.not-registered-devices.hintHeader</div> <div ng-if="DevicesList.notRegisteredDevices.length" class="baloon__notification" data-translate="">devices-list.not-registered-devices.hint</div><p class="baloon__notification" ng-if="!DevicesList.notRegisteredDevices.length" data-translate="">devices-list.not-registered-devices.hintEmpty</p></ndm-help></ndm-title><ndm-text text="devices-list.not-registered-devices.description"></ndm-text><div class="table-devices-list" ng-class="{ \'no-devices\': !DevicesList.notRegisteredDevices.length, \'arrow-reverse\': DevicesList.sortBy.unreg.isReverse }" ng-cloak=""><ndm-table-deviceslist table-classes="table_devices-list" list="DevicesList.notRegisteredDevices" row-on-click-params="notRegistered" row-on-click="getDeviceCard" no-data-message=\'{{"devices-list.device-card.statuses." + (DevicesList.isAllDataLoaded ? "noNotRegistered" : "wait-data")}}\' info-obj="DevicesList.tableObj.unreg" sort-obj="DevicesList.sortBy.unreg" sort-function="DevicesList.tableObj.sortFunction"></ndm-table-deviceslist></div> <div class="accordion accordion--different-labels" ng-show="DevicesList.trafficcontrolAvailable || DevicesList.internetFilter"><div><ndm-details toggle-var="DevicesList.speedLimit.isOpen" transclude-class="" label-visible="devices-list.not-registered-devices.show-advanced" label-hidden="devices-list.not-registered-devices.hide-advanced"><div class="form__row"><ndm-text text="devices-list.not-registered-devices.advanced-description"></ndm-text></div><ndm-sub-form><ndm-selectbox ng-if="DevicesList.internetFilter" label="devices-list.device-card.internet-filter" name="dnsFiltration" options="DevicesList.dnsFilter.options" value="DevicesList.dnsFilter.value"></ndm-selectbox><ndm-traffic-shaper ng-if="DevicesList.trafficcontrolAvailable" model="DevicesList.speedLimit.model" name-prefix="unregisteredHost" show-is-enabled-checkbox="false"></ndm-traffic-shaper></ndm-sub-form></ndm-details><ndm-key-press ng-if="DevicesList.speedLimit.isOpen" action-on="[\'enter\']" call-func="[DevicesList.save]"></ndm-key-press></div></div></form><hr class="hr-light-blue"><ndm-title label="devices-list.registered-devices.header"><ndm-help><div class="baloon__body-title body-text" data-translate="">devices-list.registered-devices.header</div> <div ng-if="DevicesList.registeredDevices.length" class="help-text" data-translate="">devices-list.registered-devices.hint</div><p ng-if="!DevicesList.registeredDevices.length" class="help-text" data-translate="">devices-list.registered-devices.hintEmpty</p></ndm-help></ndm-title><div class="table-devices-list" ng-class="{ \'no-devices\': !DevicesList.registeredDevices.length, \'arrow-reverse\': DevicesList.sortBy.reg.isReverse }" ng-cloak=""><ndm-table-deviceslist table-classes="table_devices-list" list="DevicesList.registeredDevices" row-on-click-params="registered" row-on-click="getDeviceCard" no-data-message=\'{{"devices-list.device-card.statuses." + (DevicesList.isAllDataLoaded ? "noRegistered" : "wait-data")}}\' info-obj="DevicesList.tableObj.reg" sort-obj="DevicesList.sortBy.reg" sort-function="DevicesList.tableObj.sortFunction"></ndm-table-deviceslist></div><hr class="hr-invisible"><ndm-title label="devices-list.locked-devices.header"><ndm-help><div class="baloon__body-title body-text" data-translate="">devices-list.locked-devices.header</div> <div ng-if="DevicesList._locked-devices.length" class="help-text" data-translate="">devices-list.locked-devices.hint</div><p ng-if="!DevicesList._locked-devices.length" class="help-text" data-translate="">devices-list.locked-devices.hintEmpty</p></ndm-help></ndm-title><ndm-text text="devices-list.locked-devices.description"></ndm-text><div class="table-devices-list" ng-cloak="" ng-class="{ \'no-devices\': !DevicesList.devicesLocked.length, \'arrow-reverse\': DevicesList.sortBy.block.isReverse }"><ndm-table-deviceslist table-classes="table_devices-list" list="DevicesList.devicesLocked" row-on-click-params="blocked" row-on-click="getDeviceCard" no-data-message=\'{{"devices-list.device-card.statuses." + (DevicesList.isAllDataLoaded ? "noLocked" : "wait-data")}}\' info-obj="DevicesList.tableObj.block" sort-obj="DevicesList.sortBy.block" sort-function="DevicesList.tableObj.sortFunction"></ndm-table-deviceslist></div><hr class="hr-invisible"><ndm-button ng-if="DevicesList.progress === 100" class="page-devices-list__add-device-offline-btn" ui-sref="controlPanel.devicesList.offlineRegistration" btn-name="registerOfflineDevice" label="devices-list.offline-device-registration.register-btn"></ndm-button><ndm-control-footer prefix="allDevices" is-visible="DevicesList.advancedForm.modified" is-save-disabled="DevicesList.advancedForm.$invalid" save="DevicesList.save()" cancel="DevicesList.reset()"></ndm-control-footer></ndm-page><div ng-include="\'app/page/controlPanel/myNetwork/devicesList/offlineDevice.popup.html\'"></div> <div ng-include="\'app/page/controlPanel/myNetwork/devicesList/unregisteredDevice.popup.html\'"></div> <div ng-include="\'app/page/controlPanel/myNetwork/devicesList/registeredDevice.popup.html\'"></div> <div ng-include="\'app/page/controlPanel/myNetwork/devicesList/blockedDevice.popup.html\'"></div> <div ng-include="\'app/page/controlPanel/myNetwork/devicesList/forwardingRule.popup.html\'"></div>'),e.put("app/page/controlPanel/myNetwork/devicesList/forwardingRule.popup.html",'<ndm-popup is-visible="DevicesList.isSecondaryPopupOpened" class="page-devices-list__forwarding-popup" header-title="{{\'devices-list.device-card.secondary-popup-title\' | translate | trust}}" close="DevicesList.closeAddRulePopup" save="DevicesList.addRule"><form name="DevicesList.addRulePopupForm" class="popup-rule" novalidate="" ng-cloak=""><ndm-text text="devices-list.ports.description"></ndm-text><div ng-if="DevicesList.isSecondaryPopupOpened" class="form"><ndm-selectbox label="devices-list.device-card.not-registered.connection" name="interfaces" options="DevicesList.portTransfer.interfaces.array" on-change="DevicesList.interfaceValueChange()" value="DevicesList.portTransfer.interfaces.value"></ndm-selectbox><ndm-selectbox label="devices-list.ports.protocol" name="protocols" label-key="fullName" options="DevicesList.portTransfer.protocols.array" on-change="DevicesList.protocolValueChange()" value="DevicesList.portTransfer.protocols.value"></ndm-selectbox><div ng-if="!DevicesList.portTransfer.hidePortInputs" ng-form="vm.addRulePopupForm.portsSubform"><ndm-sub-form class="form--sub_no-padding-bottom inputs-inline" ng-hide="DevicesList.isProtocolInputsHidden"><ndm-radio name="portsFormat" label="devices-list.ports.type-rule" array="DevicesList.portTransfer.format.array" model="DevicesList.portTransfer.format.value" on-change="DevicesList.portsValidation.portStart.radioClick"></ndm-radio><div><div class="ndm-input form__row form__row--single-range"><div class="form__cell form__cell--input-label help-text"><span class="form__cell--input-label-text" data-translate="">{{ DevicesList.portTransfer.format.value == DevicesList.CONSTANT_PORT_ID.range ? \'devices-list.ports.range\' : \'devices-list.ports.open-port\' }}</span></div> <div class="form__cell form__cell--top form__cell--single-range"><div class="form__cell form__cell--top"><input class="field field--short" type="text" maxlength="5" ng-class="{\'field--error\': DevicesList.portsValidation.portStart.errorMessage || !DevicesList.portTransfer.portStart}" ng-keyup="DevicesList.portsValidation.portStart.keyup()" ng-focus="DevicesList.portsValidation.portStart.focus()" ng-blur="DevicesList.portsValidation.portStart.blur()" ng-keypress="DevicesList.portsValidation.inputValidationOnNumber($event)" ng-model="DevicesList.portTransfer.portStart"></div> <div ng-if="DevicesList.portTransfer.format.value == DevicesList.CONSTANT_PORT_ID.range" ng-form="vm.addRulePopupForm.endPortSubform" class="display-inline"><div class="input"><div class="form__cell form__cell--separator form__cell--top"><svg width="5" height="10" viewbox="0 0 10 10"><line stroke="black" x1="0%" y1="50%" x2="100%" y2="50%" stroke-width="2"></line></svg></div> <div class="form__cell form__cell--top"><input class="field field--short" type="text" maxlength="5" name="inputPortEnd" ng-class="{\'field--error\': (DevicesList.portsValidation.portEnd.errorMessage && !DevicesList.portsValidation.portStart.errorMessage) || !DevicesList.portTransfer.portEnd }" ng-keyup="DevicesList.portsValidation.portEnd.keyup()" ng-focus="DevicesList.portsValidation.portEnd.focus()" ng-blur="DevicesList.portsValidation.portEnd.blur()" ng-keypress="DevicesList.portsValidation.inputValidationOnNumber($event)" ng-model="DevicesList.portTransfer.portEnd"></div></div> <div class="message"><label ng-show="DevicesList.portsValidation.portEnd.isFocused && DevicesList.portsValidation.portEnd.errorMessage" class="status-problem"><span data-translate="">{{DevicesList.portsValidation.portEnd.errorMessage}}</span> <span ng-if="!DevicesList.portTransfer.portStart">{{DevicesList.portTransfer.usedPortName}}</span></label> <label class="status-info _error_label_right" ng-show="DevicesList.portsValidation.portEnd.isFocused && DevicesList.portsValidation.portEnd.errorMessage.length <= 1 && DevicesList.portsValidation.portEnd.allowedRange && !DevicesList.portsValidation.portStart.errorMessage" ng-class="{ \'status-problem\': DevicesList.portsValidation.portEnd.errorMessage && !DevicesList.portsValidation.portStart.errorMessage }">{{ \'devices-list.ports-info-label\' | translate}} {{DevicesList.portsValidation.portEnd.allowedRange}}</label></div></div></div> <div class="__errors"><label ng-show="((DevicesList.portsValidation.portStart.isFocused && DevicesList.portsValidation.portStart.errorMessage !== \' \') && DevicesList.portsValidation.portStart.errorMessage) || (DevicesList.portsValidation.portEnd.isFocused && DevicesList.portsValidation.portStart.errorMessage)" class="status-problem"><span data-translate="">{{DevicesList.portsValidation.portStart.errorMessage}}</span> <span>{{DevicesList.portTransfer.usedPortName}}</span></label></div></div></div></ndm-sub-form><div ng-form="vm.addRulePopupForm.toPortSubform" ng-if="DevicesList.portTransfer.format.value == DevicesList.CONSTANT_PORT_ID.single" class="ndm-input form__row form__row--with-short-input"><div class="form__cell form__cell--input-label help-text" data-translate="">devices-list.ports.redirect-on-port</div> <div class="form__cell form__cell--top"><input class="field field--short" type="text" name="inputToPort" maxlength="5" ng-class="{\'field--error\': DevicesList.portsValidation.toPort.errorMessage }" ng-keyup="DevicesList.portsValidation.toPort.keyup()" ng-keypress="DevicesList.portsValidation.inputValidationOnNumber($event)" ng-blur="DevicesList.portsValidation.toPort.isFocused = false" ng-focus="DevicesList.portsValidation.toPort.isFocused = true" ng-model="DevicesList.portTransfer.toPort"> <label ng-show="DevicesList.portsValidation.toPort.isFocused && DevicesList.portsValidation.toPort.errorMessage" class="field--error-text status-problem"><span data-translate="">{{DevicesList.portsValidation.toPort.errorMessage}}</span></label></div> <div class="form__cell"><div class="form__cell-note form__cell-note--right body-text"></div></div></div></div><ndm-input model="DevicesList.portTransfer.description" label="devices-list.ports.rule-description" name="description"></ndm-input><ndm-schedule-select model="DevicesList.portTransfer.schedule" name="schedule"></ndm-schedule-select><div ng-hide="DevicesList.portTransfer.isRemoveRuleButtonHidden"><hr class="hr-light-blue"><button type="button" class="btn btn--long" ng-click="DevicesList.addRule(true)" data-translate="">devices-list.ports.remove-rule</button></div><ndm-control-footer prefix="devicePorts" is-visible="DevicesList.addRulePopupForm.modified" is-popup="true" is-save-disabled="!DevicesList.portTransfer.hidePortInputs && (!DevicesList.portsValidation.isPortsValid || (!DevicesList.isProtocolInputsHidden && !DevicesList.portTransfer.portStart) || DevicesList.portTransfer.format.value === DevicesList.CONSTANT_PORT_ID.range && !DevicesList.portTransfer.portEnd)" save="DevicesList.addRule()" cancel="DevicesList.closeAddRulePopup()"></ndm-control-footer></div></form></ndm-popup>'),e.put("app/page/controlPanel/myNetwork/devicesList/offlineDevice.popup.html",'<ndm-popup ng-if="DevicesList.segmentsData && DevicesList.offlineRegistrationPopup.isVisible" is-visible="true" class="page-devices-list__offline-registration-popup" header-title="devices-list.offline-device-registration.header" close="DevicesList.offlineRegistrationPopup.close"><hr class="hr-invisible"><form class="form" name="DevicesList.offlineRegistrationForm"><ndm-input label="devices-list.device-card.device-name" name="offlineDeviceName" model="DevicesList.offlineRegistrationPopup.name" extra-validator="DevicesList.isNameUnique" validation="required,maxLengthInBytes[64]"></ndm-input><ndm-input label="devices-list.device-card.blocked.mac" name="offlineDeviceMac" model="DevicesList.offlineRegistrationPopup.mac" extra-validator="DevicesList.isMacUnique" validation="required,mac"></ndm-input><hr class="hr-invisible"><ndm-policy-select name="policy" value="DevicesList.offlineRegistrationPopup.policy"><ndm-help>{{DevicesList.l10n.policySelectDescription}}</ndm-help></ndm-policy-select><ndm-device-wifi-acl ng-if="DevicesList.wifiIsSupported" permissions="DevicesList.offlineRegistrationPopup.permissions" segments-data="DevicesList.segmentsData"></ndm-device-wifi-acl><ndm-control-footer prefix="offlineDevice" is-popup="true" is-visible="true" save-label="register" is-save-disabled="DevicesList.offlineRegistrationForm.$invalid" save="DevicesList.offlineRegistrationPopup.register()" cancel="DevicesList.offlineRegistrationPopup.close()"></ndm-control-footer></form></ndm-popup>'),e.put("app/page/controlPanel/myNetwork/devicesList/registeredDevice.form.html",'<form ng-cloak="" name="DevicesList.registeredDevicesForm" ng-show="DevicesList.deviceCard.status === \'registered\'"><ndm-form-header class="cp-main__secondary-title tretiary-title disabled" hr="hr-invisible" label="devices-list.device-card.default-settings"></ndm-form-header><div class="form page-devices-list" ng-show="DevicesList.isDeviceCardVisible"><ndm-input label="devices-list.device-card.device-name" model="DevicesList.deviceCard.registeredName" name="deviceName" validation="required,validationOnUsedName,maxLengthInBytes[64]"><ndm-button class="page-devices-list__wake-on-lan-btn" label="{{DevicesList.wakeOnLanInProgress ? \'\': \'devices-list.device-card.wake-on-lan\'}}" icon="{{DevicesList.wakeOnLanInProgress ? \'load\' : \'\'}}" ng-click="DevicesList.wakeOnLan(DevicesList.deviceCard.mac)"></ndm-button></ndm-input><ndm-policy-select name="policy" value="DevicesList.deviceCard.policy"><div ng-if="DevicesList.deviceCard.policy !== DevicesList.DEFAULT_DENY_POLICY && (DevicesList.deviceCard.savedSchedule && !DevicesList.schedulesData[DevicesList.deviceCard.savedSchedule])" class="device-card__internet-access-blocked-on-schedule" data-translate="">devices-list.device-card.internet-access-blocked-on-schedule</div></ndm-policy-select><ndm-sub-form ng-show="DevicesList.deviceCard.policy !== DevicesList.DEFAULT_DENY_POLICY"><ndm-schedule-select label="devices-list.device-card.schedule" name="schedule" model="DevicesList.deviceCard.schedule"></ndm-schedule-select></ndm-sub-form><ndm-selectbox ng-if="DevicesList.deviceCard.dnsFilter && DevicesList.dnsFilter.options.length > 0" label="devices-list.device-card.internet-filter" name="dnsFiltration" options="DevicesList.dnsFilter.options" value="DevicesList.deviceCard.dnsFilter.value"></ndm-selectbox><div ng-if="DevicesList.dnsFiltersAvailable && !DevicesList.deviceCard.dnsFilter" class="dns-not-configured"><div class="form__cell form__cell--input-label">{{\'devices-list.device-card.internet-filter\' | translate}}</div> <div class="form__cell help-text" ndm-html-compile="DevicesList.l10n.noDnsConfigured"></div></div> <div ng-if="::DevicesList.trafficcontrolAvailable"><ndm-traffic-shaper model="DevicesList.deviceCard.speedLimitModel" has-schedule="DevicesList.deviceCard.isNotDeviceBlocked" show-is-enabled-checkbox="true" name-prefix="registeredHost"></ndm-traffic-shaper></div><ndm-checkbox label="devices-list.device-card.permanent-ip" name="permanentIp" model="DevicesList.deviceCard.isPermanentIp"></ndm-checkbox><ndm-sub-form ng-if="DevicesList.deviceCard.isPermanentIp"><ndm-input label="devices-list.device-card.IP-address" model="DevicesList.deviceCard.ip" name="ipAddressInput" validation="required,ip,ipValidationInController" hint="hints.serverAddress"></ndm-input></ndm-sub-form><hr class="hr-light-blue"><ndm-device-wifi-acl ng-if="DevicesList.wifiIsSupported && DevicesList.deviceCard.status === \'registered\'" name="wifi-acl_registered" mac="{{DevicesList.deviceCard.mac}}" permissions="DevicesList.deviceCard.macAccess"></ndm-device-wifi-acl><div ng-if="DevicesList.HAS_WIFI_5 && DevicesList.wifiIsSupported && DevicesList.deviceCard.status === \'registered\'"><hr class="hr-light-blue"><ndm-device-wifi-band name="wifi-band_registered" mac="{{DevicesList.deviceCard.mac}}" restrictions="DevicesList.deviceCard.wifiBandRestrictions" segments-data="DevicesList.segmentsData"></ndm-device-wifi-band></div> <div class="wrap" ng-show="DevicesList.miniupnpdAvailable" ng-if="DevicesList.deviceCard.isConnectedByWiFi || DevicesList.deviceCard.isWired"><hr class="hr-light-blue"><h2 class="tretiary-title disabled"><span data-translate="">devices-list.device-card.opened-ports</span></h2><div class="table-devices-list disabled" ng-class="{\'no-devices\': !DevicesList.upnpTable.length }"><ndm-table-deviceslist ng-if="DevicesList.upnpTable.length" table-classes="table table--popup table_2" list="DevicesList.upnpTable" no-data-message="devices-list.ports.no-rules" info-obj="DevicesList.tableObjUpnp"></ndm-table-deviceslist><div ng-if="!DevicesList.upnpTable.length" class="empty-list"><span data-translate="">devices-list.ports.no-rules</span></div></div></div><ndm-form-header class="disabled" hr="hr-{{DevicesList.upnpTable.length ? \'invisible\' : \'light-blue\'}}" label="devices-list.ports.transfering"></ndm-form-header><div ng-class="{\'no-devices\': !DevicesList.ipStatic.length}"><ndm-table ng-if="DevicesList.isDeviceCardVisible && DevicesList.ipStatic.length" table-class="table table--popup table_2" data="DevicesList.ipStatic" sortable="false" click-on-row="DevicesList.openPopupRule" track-by-prop="index" columns="DevicesList.portForwardingColumns"></ndm-table><div ng-if="!DevicesList.ipStatic.length" class="empty-list"><span data-translate="">devices-list.ports.no-rules</span></div> <div class="form__row form__row--button"><div class="form__cell"><ndm-button ng-click="DevicesList.openPopupRule(); DevicesList.openSecondaryPopup = true" label="devices-list.ports.add-rule"></ndm-button><a class="page-devices-list__delete-all-forwarding-rules-link" ng-hide="!DevicesList.ipStatic.length" ng-click="DevicesList.deleteAllDeviceForwardingRules(DevicesList.deviceCard.mac, DevicesList.deviceCard.ip)"><span data-translate="">devices-list.ports.delete-all-rules</span></a></div></div></div> <div class="wrap" ng-if="DevicesList.deviceCard.isConnectedByWiFi || DevicesList.deviceCard.isWired"><ndm-form-header class="cp-main__secondary-title disabled" hr="hr-light-blue" label="devices-list.device-card.additional-info.header"></ndm-form-header><ndm-list info-obj="DevicesList.deviceCard.additionalInfoObj"></ndm-list></div> <div ng-if="DevicesList.deviceCard.isDpiEnabled"><ndm-form-header class="cp-main__secondary-title disabled" hr="hr-light-blue" label="devices-list.device-card.interactive-applications"></ndm-form-header><div class="form__row" ng-repeat="x in DevicesList.deviceCard.apps"><div class="form__cell form__cell--input-label help-text"><span>{{x}}</span></div></div> <div class="no-devices-label form__cell form__cell--input-label help-text" ng-if="!DevicesList.deviceCard.apps.length"><span class="_empty_list__text" data-translate="">devices-list.device-card.no-applications</span></div></div><hr class="hr-light-blue"><ndm-button class="page-devices-list__unregister-device-btn" btn-class="btn--long" on-click="DevicesList.deleteRegistration" label="devices-list.device-card.delete-registration"></ndm-button><ndm-control-footer prefix="registeredDevice" is-popup="true" is-visible="DevicesList.registeredDevicesForm.modified" is-save-disabled="DevicesList.registeredDevicesForm.modified && DevicesList.registeredDevicesForm.$invalid" save="DevicesList.saveConfiguration(\'registered\')" cancel="DevicesList.closeDeviceCard()"></ndm-control-footer></div></form>'),e.put("app/page/controlPanel/myNetwork/devicesList/registeredDevice.popup.html",'<ndm-popup class="page-devices-list__device-popup registered-device-popup" is-visible="DevicesList.isDeviceCardVisible && DevicesList.deviceCard.status === \'registered\'" header-title="{{DevicesList.deviceCard.name || DevicesList.deviceCard.hostname | escapeHtml}}" header-status-class="{{DevicesList.deviceCard.getDeviceStatus(DevicesList.deviceCard.status)}}" header-status-text="{{DevicesList.deviceCard.status}}" close="DevicesList.closeDeviceCard" save="DevicesList.saveConfiguration"><div ng-include="\'app/page/controlPanel/myNetwork/devicesList/registeredDevice.form.html\'"></div></ndm-popup>'),e.put("app/page/controlPanel/myNetwork/devicesList/unregisteredDevice.form.html",'<form ng-cloak="" novalidate="" class="form" name="DevicesList.notRegisteredDevicesForm" ng-show="DevicesList.deviceCard.status === \'notRegistered\'"><p class="help-text cp-main__comment">{{DevicesList.l10n.notRegisteredDescription}}</p><hr class="hr-invisible"><ndm-input label="devices-list.device-card.device-name" model="DevicesList.deviceCard.newName" name="deviceName" validation="required,validationOnUsedName,maxLengthInBytes[64]"><ndm-button class="page-devices-list__wake-on-lan-btn" label="{{DevicesList.wakeOnLanInProgress ? \'\': \'devices-list.device-card.wake-on-lan\'}}" icon="{{DevicesList.wakeOnLanInProgress ? \'load\' : \'\'}}" ng-click="DevicesList.wakeOnLan(DevicesList.deviceCard.mac)"></ndm-button></ndm-input><ndm-list info-obj="DevicesList.deviceCard.additionalInfoObj"></ndm-list><ndm-policy-select name="policy" value="DevicesList.deviceCard.policy"><ndm-help>{{DevicesList.l10n.policySelectDescription}}</ndm-help></ndm-policy-select><ndm-device-wifi-acl ng-if="DevicesList.wifiIsSupported && DevicesList.deviceCard.status === \'notRegistered\'" name="wifi-acl_unregistered" permissions="DevicesList.deviceCard.macAccess"></ndm-device-wifi-acl><div ng-if="DevicesList.HAS_WIFI_5 && DevicesList.wifiIsSupported && DevicesList.deviceCard.status === \'notRegistered\'"><hr class="hr-light-blue"><ndm-device-wifi-band name="wifi-band_unregistered" mac="{{DevicesList.deviceCard.mac}}" restrictions="DevicesList.deviceCard.wifiBandRestrictions" segments-data="DevicesList.segmentsData"></ndm-device-wifi-band></div><ndm-control-footer prefix="unregisteredDevice" is-popup="true" is-visible="true" save-label="register" is-save-disabled="DevicesList.notRegisteredDevicesForm.$invalid" save="DevicesList.registerDevice(DevicesList.deviceCard)" cancel="DevicesList.closeDeviceCard()"></ndm-control-footer></form>'),e.put("app/page/controlPanel/myNetwork/devicesList/unregisteredDevice.popup.html",'<ndm-popup class="page-devices-list__device-popup unregistered-device-popup" is-visible="DevicesList.isDeviceCardVisible && DevicesList.deviceCard.status === \'notRegistered\'" header-title="{{DevicesList.deviceCard.name || DevicesList.deviceCard.hostname | escapeHtml}}" header-status-class="{{DevicesList.deviceCard.getDeviceStatus(DevicesList.deviceCard.status)}}" header-status-text="{{DevicesList.deviceCard.status}}" close="DevicesList.closeDeviceCard" save="DevicesList.saveConfiguration"><div ng-include="\'app/page/controlPanel/myNetwork/devicesList/unregisteredDevice.form.html\'"></div></ndm-popup>'),e.put("app/page/controlPanel/myNetwork/intelliqos/intelliqos.html",'<ndm-page class="page-intelliqos" label="intelliqos.title" progress="vm.progress" description="intelliqos.description"><ndm-device-poller></ndm-device-poller><form name="vm.form" novalidate=""><ndm-toggle label-on="intelliqos.service-toggle-label" label-off="intelliqos.service-toggle-label" call-on-change="vm.toggleServiceState" model="vm.serviceState"></ndm-toggle><ndm-form-header label="intelliqos.connection-speed-section.title" sub-title="intelliqos.connection-speed-section.description" hr="hr-light-blue"></ndm-form-header><ndm-fieldset is-disabled="vm.ui.locked"><div ng-repeat="ifaceData in vm.ifaces track by $index"><ndm-input disabled="vm.ui.speedTestInProgress && vm.speedTestIfaceId !== ifaceData.name" label="{{ifaceData.label | escapeHtml}}" unit-text="{{ifaceData.showUnits ? vm.l10n.kbitps : \'\'}}" name="{{ifaceData.name}}__limit" model="ifaceData.limit" validation="{{ vm.ui.speedTestInProgress && vm.speedTestIfaceId === ifaceData.name ? \'\' : \'numeric\' }}"><ndm-button icon="{{ vm.ui.speedTestInProgress && vm.speedTestIfaceId === ifaceData.name ? \'load\' : \'\' }}" is-disabled="vm.ui.locked || vm.ui.speedTestInProgress" label="{{ vm.ui.speedTestInProgress && vm.speedTestIfaceId === ifaceData.name ? \'\' : \'intelliqos.button.test-connection-speed\' }}" ng-click="vm.runSpeedTest(ifaceData.id)"></ndm-button></ndm-input></div></ndm-fieldset><ndm-control-footer prefix="intelliqos" is-visible="!vm.ui.speedTestInProgress && vm.form.modified" is-save-disabled="vm.ui.locked || vm.form.$invalid" form="vm.form" save="vm.save()" cancel="vm.cancel()"></ndm-control-footer></form></ndm-page>'),e.put("app/page/controlPanel/myNetwork/segments/segments.html",'<ndm-page class="page-segments" label="segments.title" no-leave-watcher="true" description="segments.description" progress="segments.progress"><ndm-tabs ng-if="segments.ready" tabs="segments.tabs" label-prop="description" active-tab="segments.activeTab" compare-prop="id" add-tab-btn-label="segments.btn.add-segment" add-tab-btn-is-disabled="segments.isAddTabDisabled || NDM.DEVICE_IS_MWS_MEMBER" is-disabled="segments.ui.locked" update-state-on-tab-change="true" new-tab-constructor-fn="segments.newSegmentTabCtor" can-select-tab="segments.canSwitchTab" on-tab-changed-fn="segments.setActiveSegment"></ndm-tabs><div ng-if="segments.ready" ndm-polling="segments.pollDeviceInfo"></div><form class="page-segments__form" name="segments.form" novalidate=""><ndm-fieldset is-disabled="segments.ui.locked"><ndm-input tab-index="1" label="segments.form.segment-name" model="segments.activeSegment.description" name="segmentName" max-length="256" extra-validator="segments.validation.uniqueName" validation-data="segments.validationData" validation="{{segments.ready && !segments.ui.locked ? \'required,maxLengthInBytes[256]\' : \'\'}}"></ndm-input><div ng-if="::segments.wifiInstalled" ng-include="\'app/page/controlPanel/myNetwork/segments/segments.wifi-section.html\'" class="wifi-section"></div><ndm-form-header hr="hr-light-blue" label="segments.section.switchports.header"><div class="show-other-switchports-link-wrapper--short"><a ng-if="!segments.activeSegment.noOtherSwitchports" tabindex="0" ng-keydown="segments.ui.onOtherSegmentsLinkKeypress($event)" ng-click="!segments.ui.locked && segments.ui.toggle(\'otherSwitchportsAreVisible\')" ng-class="{ \'accordion-link--disabled\': segments.ui.locked, \'accordion-link--expanded\': segments.ui.otherSwitchportsAreVisible }" class="accordion-link">{{ segments.ui.otherSwitchportsAreVisible ? segments.l10n.hideOtherSwitchportsShort : segments.l10n.showOtherSwitchportsShort }}</a></div></ndm-form-header><div class="page-segments__switchports-section-wrapper switchports-section"><div class="page-segments__wrap"><div class="page-segments__wrapper"><div class="page-segments__cell page-segments__cell--names"><div class="page-segments__row page-segments__row--empty"><ndm-switchport class="page-segments__invisible-switchport"></ndm-switchport></div> <div class="page-segments__row"><div class="page-segments__name">{{ segments.activeSegment.description }}</div> <div class="page-segments__vlan">{{ segments.activeSegment.vlanLabel}}</div></div> <div ng-show="segments.ui.otherSwitchportsAreVisible" ng-repeat="otherSegment in segments.activeSegment.otherSegmentsSwitchports"><div class="page-segments__row"><div class="page-segments__name">{{ otherSegment.description }}</div> <div class="page-segments__vlan">{{ otherSegment.vlanLabel}}</div></div></div></div><ndm-switchport-container class="segments__all-switchports" child-nodes-class="\'segments__switchport\'"><div ng-repeat="port in segments.switchportsList" class="segments__switchport" ng-class="{ \'segments__switchport--invalid\': segments.portsMap[port.portId].error }"><ndm-switchport is-combo="port.isCombo" is-sfp="port.isSfp" is-reversed="port.isReversed" is-blue="port.isBlue" label="port.name"><div class="segments__selects"><div class="segments__select"><ndm-switchport-select ndm-disabled-by-mws-tooltip="@" ng-if="!segments.activeSegment.switchports[port.portId].roles" is-disabled="segments.ui.locked || NDM.DEVICE_IS_MWS_MEMBER" name="segmentPortMode__{{port.portId}}__{{segments.activeSegment.id}}" value="segments.activeSegment.switchports[port.portId].value" options="segments.options.portMode" on-change="segments.cbk.onSwitchportChange"></ndm-switchport-select><ndm-switchport-role ng-if="segments.activeSegment.switchports[port.portId].roles[0].role" role="segments.activeSegment.switchports[port.portId].roles[0].role" title="segments.activeSegment.switchports[port.portId].iforL10n"></ndm-switchport-role></div> <div ng-show="segments.ui.otherSwitchportsAreVisible"><div class="segments__select" ng-repeat="otherSegment in segments.activeSegment.otherSegmentsSwitchports"><ndm-switchport-select ndm-disabled-by-mws-tooltip="@" ng-if="!otherSegment.switchports[port.portId].roles" is-disabled="segments.ui.locked || NDM.DEVICE_IS_MWS_MEMBER" name="segmentPortMode__{{port.portId}}__{{otherSegment.id}}" value="otherSegment.switchports[port.portId].value" options="segments.options.portMode" on-change="segments.cbk.onSwitchportChange"></ndm-switchport-select><ndm-switchport-role ng-if="otherSegment.switchports[port.portId].roles[0].role" role="otherSegment.switchports[port.portId].roles[0].role" title="otherSegment.switchports[port.portId].iforL10n"></ndm-switchport-role></div></div></div></ndm-switchport></div></ndm-switchport-container></div></div></div> <div class="show-other-switchports-link-wrapper"><a ng-if="!segments.activeSegment.noOtherSwitchports" tabindex="0" ng-keydown="segments.ui.onOtherSegmentsLinkKeypress($event)" ng-click="!segments.ui.locked && segments.ui.toggle(\'otherSwitchportsAreVisible\')" ng-class="{ \'accordion-link--disabled\': segments.ui.locked, \'accordion-link--expanded\': segments.ui.otherSwitchportsAreVisible }" class="accordion-link">{{ segments.ui.otherSwitchportsAreVisible ? segments.l10n.hideOtherSwitchports : segments.l10n.showOtherSwitchports }}</a></div><ndm-input ndm-disabled-by-mws-tooltip="" class-name="ndm-input-s" max-length="4" class="page-segments__vlan-input" disabled="segments.activeSegment.isHomeSegment || !segments.activeSegment.hasTrunkPorts || NDM.DEVICE_IS_MWS_MEMBER" label="{{segments.l10n.vlanInput}}" model="segments.activeSegment.vlanId" placeholder="{{segments.activeSegment.hasTrunkPorts ? \'2…4094\' : \'\'}}" description="{{segments.activeSegment.hasTrunkPorts ? \'\' : segments.l10n.vlanUnused}}" name="vlanId" on-validation-end="segments.updateVlanData" extra-validator="segments.validation.uniqueVlanId" validation="required,intRange[1, 4094]"></ndm-input><div ng-if="::!segments.inRouterMode"><ndm-iface-ip ng-if="segments.ready" is-disabled="segments.ui.locked || NDM.DEVICE_IS_MWS_MEMBER" details-always-shown="NDM.DEVICE_IS_MWS_MEMBER" label="segments.section.ip-config.header" description="{{segments.l10n.ipConfig.getDescription()}}" data="segments.activeSegment.ipModel" used-ips="segments.activeSegment.usedIpAddresses" disable-none="true" name-prefix="segment-ip-" no-additional-settings="true" auto-with-dhcp="true"></ndm-iface-ip></div> <div ng-if="::segments.inRouterMode"><ndm-form-header hr="hr-light-blue" label="segments.section.ip-config.header" sub-title="{{segments.l10n.ipConfig.getDescription()}}"></ndm-form-header><ndm-input label="segments.form.ip-address" model="segments.activeSegment.ip.address" validation-data="{nets: segments.activeSegment.usedIpAddresses, mask: segments.activeSegment.ip.mask}" validation="ip,inNet[{{segments.activeSegment.ip.address}};{{segments.activeSegment.ip.mask}}],notInNets[mask,nets]" on-validation-end="segments.cbk.onSegmentIpValidationEnd" name="segmentIpAddress"></ndm-input><ndm-selectbox label="segments.form.mask" disabled="segments.ui.locked" options="segments.options.mask" value="segments.activeSegment.ip.mask" on-value-change="segments.cbk.onMaskValueChange" name="segmentMask"></ndm-selectbox><div ng-if="segments.dhcpInstalled && !segments.isChilliEnabled()" class="dhcp-section"><ndm-radio name="dhcpMode" label="segments.form.dhcp-mode.label" array="segments.options.dhcpMode" model="segments.activeSegment.dhcpMode" on-change="segments.cbk.onDhcpModeChange" hint-title="segments.form.dhcp-mode.label" hint="segments.form.dhcp-mode.description"></ndm-radio><ndm-details ng-if="segments.activeSegment.dhcpMode === \'server\'" label-hidden="segments.details.dhcp.hide-config" label-visible="segments.details.dhcp.show-config" toggle-var="segments.ui.dhcpConfigIsVisible"><ndm-input label="segments.form.dhcp.pool-start-address" model="segments.activeSegment.dhcp.range.begin" validation="required,ip,inNet[{{segments.activeSegment.ip.address}};{{segments.activeSegment.ip.mask}}]" on-change="segments.cbk.onDhcpRangeBeginChange" name="dhcpPoolStart"></ndm-input><ndm-input label="segments.form.dhcp.pool-size" model="segments.activeSegment.dhcp.range.size" validation="required,intRange[1,{{segments.activeSegment.dhcp.range.maxSize}}]" name="dhcpPoolSize"></ndm-input><ndm-input label="segments.form.dhcp.lease-time" model="segments.activeSegment.dhcp.lease" unit-text="time.second" validation="intRange[1, 259200]" name="dhcpLeaseTime"></ndm-input><ndm-input label="segments.form.dhcp.gateway-address" model="segments.activeSegment.dhcp.gateway" name="dhcpGatewayAddress" validation="ip"></ndm-input><ndm-input label="{{segments.l10n.dhcpConfig.dnsServer + \' 1\'}}" model="segments.activeSegment.dhcp.dnsServer1" name="dhcpDnsServer1" validation="ip"></ndm-input><ndm-input label="{{segments.l10n.dhcpConfig.dnsServer + \' 2\'}}" model="segments.activeSegment.dhcp.dnsServer2" name="dhcpDnsServer2" validation="ip"></ndm-input></ndm-details><ndm-sub-form ng-if="segments.activeSegment.dhcpMode === \'relay\'" ng-form="segments.dhcpRelayForm" class="dhcp-relay-section"><ndm-selectbox name="dhcpRelayWan" disabled="segments.ui.locked" label="segments.form.dhcp-relay.wan" options="segments.dhcpRelay.wanOptions" value="segments.dhcpRelay.wanIface"></ndm-selectbox><ndm-input name="dhcpRelayAddress" label="segments.form.dhcp-relay.address" model="segments.dhcpRelay.address" validation="required,ip"></ndm-input><div ng-if="!segments.ui.locked && segments.dhcpRelayForm.modified && segments.dhcpRelay.usedByOtherSegments" class="dhcp-relay-section__settings-change-warning"><br><i class="icon icon--warning"></i> <span data-translate="">segments.form.dhcp-relay.settings-changed-warning</span></div></ndm-sub-form></div><ndm-checkbox ng-if="!segments.isChilliEnabled()" label="segments.form.enable-nat.label" description="segments.form.enable-nat.description" name="enableNat" model="segments.activeSegment.natEnabled"></ndm-checkbox></div><div ng-if="!segments.activeSegment.isHomeSegment"><ndm-form-header ng-if="segments.inRouterMode || segments.activeSegment.apCount > 0" hr="hr-light-blue" label="segments.section.restrictions.header"></ndm-form-header><div ng-if="::(segments.trafficcontrolInstalled && segments.inRouterMode)"><ndm-traffic-shaper ng-if="segments.ready" show-is-enabled-checkbox="false" model="segments.activeSegment.speedLimit" is-disabled="segments.ui.locked" name-prefix="segment"></ndm-traffic-shaper></div><br><ndm-checkbox ng-if="segments.activeSegment.apCount > 0" disabled="NDM.DEVICE_IS_MWS_MEMBER" label="segments.form.restrictions.peer-isolation.label" description="segments.form.restrictions.peer-isolation.hint" name="peerIsolation" model="segments.activeSegment.peerIsolation"></ndm-checkbox><ndm-checkbox ng-if="::segments.inRouterMode" label="segments.form.restrictions.system-access" name="systemAccess" model="segments.activeSegment.systemAccess"></ndm-checkbox></div><div ng-if="::segments.inRouterMode"><ndm-form-header hr="hr-light-blue" label="segments.section.policy.header" sub-title="segments.section.policy.description"></ndm-form-header><ndm-policy-select name="policy" is-disabled="segments.ui.locked" initial-data="segments.policyData" value="segments.activeSegment.policy"></ndm-policy-select></div><div ng-if="::(segments.chilliInstalled && segments.inRouterMode)" ng-include="\'app/page/controlPanel/myNetwork/segments/chilli/chilli.section.html\'"></div><div ng-if="::(segments.igmpInstalled && segments.inRouterMode)"><ndm-form-header hr="hr-light-blue" label="segments.section.igmp-proxy.header" sub-title="segments.section.igmp-proxy.description"></ndm-form-header><ndm-checkbox label="segments.form.igmp-proxy.enable" name="enableIgmp" model="segments.activeSegment.igmpEnabled"></ndm-checkbox><div ng-if="segments.ready"><ndm-details toggle-var="segments.activeSegment.igmpEnabled"><ndm-selectbox name="igmpUpstreamIface" disabled="segments.igmp.upstreamNotConfigurable || segments.ui.locked" label="segments.form.igmp-proxy.iface" options="segments.igmp.iface.options" value="segments.igmp.iface.value"></ndm-selectbox><ndm-selectbox name="igmpProtocol" disabled="segments.ui.locked" label="segments.form.igmp-proxy.protocol" options="segments.igmp.protocol.options" value="segments.igmp.protocol.value"></ndm-selectbox></ndm-details></div></div><div ng-if="::(segments.pppoeInstalled && segments.inRouterMode)"><ndm-form-header hr="hr-light-blue" label="segments.section.pppoe-pass-through.header" sub-title="segments.section.pppoe-pass-through.description"></ndm-form-header><ndm-checkbox label="segments.form.pppoe-pass-through.enable" name="enablePppoePassThrough" model="segments.activeSegment.pppoePassThroughEnabled"></ndm-checkbox><div ng-if="!segments.ui.locked && segments.pppoePassThrough.lanPrev && segments.pppoePassThrough.lanPrev != segments.pppoePassThrough.lan && segments.activeSegment.pppoePassThroughEnabled" class=""><i class="icon icon--warning"></i> <span data-translate="">{{segments.l10n.pppoePassThrough.getWarning()}}</span></div> <div ng-if="segments.ready"><ndm-details toggle-var="segments.activeSegment.pppoePassThroughEnabled"><ndm-selectbox name="pppoePassThroughWan" disabled="segments.pppoePassThrough.wanNotConfigurable || segments.ui.locked" label="segments.form.pppoe-pass-through.wan" options="segments.pppoePassThrough.wan.options" value="segments.pppoePassThrough.wan.value"></ndm-selectbox></ndm-details></div></div><div ng-if="!(segments.activeSegment.isHomeSegment || segments.activeSegment.isNew)"><hr class="hr-light-blue"><ndm-button btn-class="btn--long" label="segments.btn.delete-segment" ng-click="segments.removeSegment()"></ndm-button></div></ndm-fieldset></form><div ng-if="segments.ready"><ndm-control-footer prefix="segments" ng-if="!segments.ui.locked" is-visible="!segments.ui.locked && (segments.form.modified || segments.activeSegment.isNew || segments.subctrlModified) && !$root.isPopupOpen" is-save-disabled="segments.portCfgIsInvalid || segments.form.$invalid || segments.form.$pending" save="segments.saveSegment()" cancel="segments.resetSegment()"></ndm-control-footer></div></ndm-page><div ng-if="::segments.wifiInstalled" ng-controller="WifiSettingsController as WSC" ng-init="segments.subCtrl.register(WSC, \'WSC\')"><ndm-popup class="segment-advanced-wifi-settings-popup" is-visible="1" ng-if="WSC.isVisible" header-title="{{WSC.l10n.popupHeader}}" close="WSC.cancel" allow-form-changes="!WSC.ready" save="WSC.save"><div ng-include="\'app/page/controlPanel/myNetwork/wifi/wifi-settings.html\'"></div></ndm-popup></div>'),e.put("app/page/controlPanel/myNetwork/segments/segments.wifi-section.html",'<div class="segment-wifi-settings" ng-controller="WifiSectionController as WC" ng-init="segments.subCtrl.register(WC, \'WC\');"><div ng-if="WC.ready" ndm-polling="WC.updateWifiStatus"></div> <div ng-if="WC.ready" ng-repeat="($wifiType, $apData) in WC.apSettings track by $wifiType" class="segment-wifi-settings__ap{{$wifiType}}"><hr class="hr-light-blue"><div class="segment-wifi-settings__title-block"><ndm-form-header label="{{WC.l10n.header[$wifiType]}}"></ndm-form-header><ndm-button ng-if="!WC.segmentSettings.isHomeSegment && ($apData.isAssigned || $apData.wasEnabled) && !NDM.DEVICE_IS_MWS_MEMBER" btn-class="unbind-ap-btn" label="{{WC.l10n.unbindAp}}" ng-click="WC.removeAp($wifiType)"></ndm-button></div><ndm-toggle ng-if="$apData.isAssigned || $apData.wasEnabled || WC.freeAccessPoints[$wifiType].length > 0" ndm-disabled-by-mws-tooltip="" disabled="segments.ui.locked || NDM.DEVICE_IS_MWS_MEMBER" name="wifi__{{$wifiType}}__enabled" label-on="{{$apData.toggleOnText}}" label-off="{{WC.l10n.state.off}}" model="$apData.isEnabled" call-on-change="WC.toggleApState"></ndm-toggle><div ng-if="!$apData.wasEnabled && !$apData.isSaved && !$apData.isSaved && WC.freeAccessPoints[$wifiType].length === 0"><span data-translate="">wifi-settings.text.no-free-access-points</span></div> <div ng-if="!$apData.isVisible && $wifiType === \'5\' && WC.apSameSettings"><span class="body-text" data-translate="">wifi-settings.text.access-points-settings-are-equal</span><hr class="hr-invisible"></div> <div ng-form="segments.form.apSettings[{{$wifiType}}]" ng-if="$apData.isVisible && ($apData.wasEnabled || $apData.isSaved)"><ndm-fieldset class-name="mws-controlled-section" is-disabled="NDM.DEVICE_IS_MWS_MEMBER"><ndm-input ndm-disabled-by-mws-tooltip="" label="wifi-settings.form.ssid" name="wifi__{{$wifiType}}__ssid" model="$apData.ssid" extra-validator="WC.validation.ssid" on-change="WC.onSsidChange" validation="required"></ndm-input><ndm-selectbox ndm-disabled-by-mws-tooltip="" disabled="segments.ui.locked || NDM.DEVICE_IS_MWS_MEMBER || WC.apSyncLock[$wifiType]" label="wifi-settings.form.security-protocol.label" description="{{WC.apSyncLock[$wifiType] ? WC.L10N_ID_AP_SYNC_LOCK : \'\'}}" name="wifi__{{$wifiType}}__security" on-value-change="WC.onSecurityTypeChange" options="WC.options.security" value="$apData.security"></ndm-selectbox><ndm-input ng-if="WC.isAnyWpaPsk($apData.security)" disabled="WC.apSyncLock[$wifiType]" ndm-disabled-by-mws-tooltip="" label="wifi-settings.form.psk.label" name="wifi__{{$wifiType}}__passkey" password="true" show-password-label="wifi-settings.form.psk.show-psk" hide-password-label="wifi-settings.form.psk.hide-psk" validation="required,wpaPsk" model="$apData.psk"></ndm-input><div ng-if="WC.isAnyWpaEap($apData.security)"><ndm-input ndm-disabled-by-mws-tooltip="" class="segment-wifi-settings__radius-server" label="wifi-settings.form.radius-server.label" placeholder="{{\'wifi-settings.form.radius-server.placeholder\' | translate}}" description="{{WC.radiusServerDescription}}" name="wifi__radiusServer" validation-data="{allowPort: true}" validation="required,ip" model="WC.wpaEap.radiusServer"></ndm-input><ndm-input ndm-disabled-by-mws-tooltip="" label="wifi-settings.form.radius-secret" name="wifi__radiusSecret" password="true" max-length="64" validation="required,ascii,length[..64]" model="WC.wpaEap.radiusSecret"></ndm-input></div><div ng-if="WC.isWep($apData.security)" ndm-disabled-by-mws-tooltip=""><ndm-input disabled="WC.apSyncLock[$wifiType]" label="wifi-settings.form.psk.label" model="$apData.wepKeys[\'1\']" name="wifi__{{$wifiType}}__wepKey1" validation="required,wepKey"></ndm-input><ndm-input ng-repeat="k in [1,2,3]" disabled="WC.apSyncLock[$wifiType]" label="{{(\'wifi-settings.form.psk.label\' | translate) + (k + 1)}}" model="$apData.wepKeys[k + 1 + \'\']" name="wifi__{{$wifiType}}__wepKey{{k + 1}}" validation="wepKey"></ndm-input></div><div class="ap-schedule-select"><ndm-schedule-select ndm-disabled-by-mws-tooltip=".form__cell--top" is-disabled="segments.ui.locked || NDM.DEVICE_IS_MWS_MEMBER" label="{{WC.l10n.schedule}}" name="wifi__{{$wifiType}}__schedule" model="$apData.schedule" no-selected-thumb="true"></ndm-schedule-select></div></ndm-fieldset></div><div ng-if="$apData.isAssigned || ($apData.isEnabled && !segments.activeSegment.isNew) || $ap.wasEnabled" class="form__row edit-ap-settings-link-wrapper"><a tabindex="0" ng-keydown="WC.onLinkKeydown($event, segments.ui.locked, $apData.id, $wifiType)" ng-click="!segments.ui.locked && WC.goToApSettingsState($wifiType)" class="ref-link" ng-class="{ \'ref-link--disabled\': segments.ui.locked || WC.advancedSettingsPopupIsOpened[$wifiType] || WC.shouldAdvancedSettingsBeLocked($wifiType) }" data-translate="">wifi-settings.link.advanced-settings-popup</a> <span ng-if="WC.shouldAdvancedSettingsBeLocked($wifiType)" class="wifi__advanced-settings-locked" data-translate="">wifi-settings.ap-sync-save-settings-to-unlock-advanced-settings</span></div></div> <div class="wifi__roaming-section roaming-section"><div ng-if="::WC.HAS_FT"><ndm-form-header class="roaming-section__title" hr="hr-light-blue" label="wifi-settings.roaming-section.header" sub-title="wifi-settings.roaming-section.description"><ndm-help><span data-translate="">wifi-settings.roaming-section.hint</span></ndm-help></ndm-form-header><ndm-fieldset is-disabled="segments.ui.locked || WC.apCount === 0 || NDM.DEVICE_IS_MWS_MEMBER" class-name="form mws-controlled-section"><ndm-selectbox ndm-disabled-by-mws-tooltip="" label="wifi-settings.form.ft-mode.label" disabled="segments.ui.locked || WC.apCount === 0 || WC.unsuitableForRoamingBandsCount === WC.apCount || NDM.DEVICE_IS_MWS_MEMBER" name="wifi__ftMode" value="WC.roaming.ftMode" class-name="ndm-selectbox-l" options="WC.ftOptions"><ndm-help><span data-translate="">wifi-settings.form.ft-mode.hint</span></ndm-help></ndm-selectbox><ndm-fieldset ng-if="WC.roaming.ftMode !== \'disabled\'" ndm-disabled-by-mws-tooltip="" is-disabled="WC.unsuitableForRoamingBandsCount === WC.apCount" ng-form="segments.form.roamingSubform" class-name="form--sub"><ndm-input class-name="ndm-input-s" label="wifi-settings.form.mobility-domain-id.label" name="wifi__ftMdid" model="WC.roaming.ftMdid" max-length="2" validation="required,length[2..],asciiWithoutSpace"></ndm-input><ndm-input password="true" label="wifi-settings.form.mobility-domain-key.label" name="wifi__iappKey" model="WC.roaming.iappKey" show-password-label="wifi-settings.form.mobility-domain-key.show-key" hide-password-label="wifi-settings.form.mobility-domain-key.hide-key" validation="required"></ndm-input></ndm-fieldset><ndm-checkbox ndm-disabled-by-mws-tooltip="" label="wifi-settings.form.rrm" name="wifi__rrmEnabled" model="WC.roaming.rrm"></ndm-checkbox></ndm-fieldset></div><div ng-if="WC.HAS_WIFI_5 && WC.hasBandSteering && WC.segmentSettings.isHomeSegment" class="wifi__band-steering-settings"><ndm-selectbox disabled="!WC.apSameSettings || WC.apCount !== 2 || segments.ui.locked" label="wifi-settings.form.band-steering.label" name="wifi__bandSteering" options="WC.bandSteeringOptions" value="WC.bandSteeringVal" bottom-description="{{ (!WC.apSameSettings || WC.apCount !== 2) ? WC.l10n.bandSteeringBottomDescription : \'\' }}"><ndm-help class="wifi__band-steering-settings__tooltip"><div data-translate="">wifi-settings.form.band-steering.tooltip</div></ndm-help></ndm-selectbox></div></div></div>'),e.put("app/page/controlPanel/myNetwork/trafficMonitor/trafficMonitor.html",'<ndm-page class="page-traffic-monitor" label="traffic-monitor.page-title" progress="vm.ui.progress" webhelp-text="{{vm.l10n.hintDescription}}" description="{{vm.l10n.pageDescription}}"><div><div ng-include="\'app/page/controlPanel/myNetwork/trafficMonitor/tabs/trafficMonitor.tabs.html\'"></div> <div class="page-traffic-monitor__top-toolbar"><ndm-radio-buttons ng-if="vm.hosts.length" model="vm.chartLegend.scales" on-changed-fn="vm.chartLegend.setScale" is-disabled="vm.ui.isLocked() || vm.isActiveTabNew" class="page-traffic-monitor__chart-scale" ng-class="{ \'page-traffic-monitor__chart-scale--invisible\': vm.isActiveTabNew }"></ndm-radio-buttons><div ng-include="\'app/page/controlPanel/myNetwork/trafficMonitor/timezone/trafficMonitor.timezone.html\'"></div></div> <div ng-class="{\'page-traffic-monitor-layout-device-select\': vm.isDeviceListVisible}" class="page-traffic-monitor-layout"><div class="page-traffic-monitor__chart" ng-class="{\'page-traffic-monitor__chart--loading\': !vm.hosts.length}"><div id="page-traffic-monitor__chart-hint" class="page-traffic-monitor__chart-hint" ng-show="!(vm.ui.isLocked() || vm.isActiveTabNew)" ng-include="\'app/page/controlPanel/myNetwork/trafficMonitor/chartHint/trafficMonitor.chartHint.html\'"></div><ndm-bar-chart labels="vm.barChart.params.labels" columns="vm.barChart.params.columns" min-velocity="vm.barChart.params.minVelocity" data="vm.barChart.params.data" is-locked="vm.ui.isLocked() || vm.isActiveTabNew" is-loading="vm.ui.isLoading()" selected-idx="vm.barChart.params.selectedIdx" on-bar-click="vm.barChart.onBarClick" on-bar-double-click="vm.barChart.onBarDoubleClick" on-mouse-over-column="vm.barChart.onMouseOverColumn" styles="vm.barChart.params.styles" on-resize="vm.barChart.onResize" on-init="vm.barChart.onInit"></ndm-bar-chart></div> <div ng-show="!vm.isDeviceListVisible" class="page-traffic-monitor-layout__legend" ng-include="\'app/page/controlPanel/myNetwork/trafficMonitor/chartLegend/trafficMonitor.chartLegend.html\'"></div> <div ng-show="vm.isDeviceListVisible" class="page-traffic-monitor-layout__legend" ng-include="\'app/page/controlPanel/myNetwork/trafficMonitor/devicesList/trafficMonitor.devicesList.html\'"></div></div></div></ndm-page>'),e.put("app/page/controlPanel/myNetwork/wifi/wifi-settings.html",'<div class="wifi-settings"><div ng-if="$root.NDM.DEVICE_IS_MWS_MEMBER" ndm-polling="WSC.updateMwsBackhaulStatus"></div><form name="WSC.form" class="form-padding-bottom wifi-settings__form" ng-cloak="" novalidate=""><div ng-if="WSC.ready" class="wifi-settings wifi-settings__{{WSC.wifiBand}}"><ndm-form-header ng-if="WSC.ui.apHeaderIsVisible" hr="hr-light-blue" label="{{WSC.l10n.header[WSC.wifiBand]}}"></ndm-form-header><ndm-toggle ng-if="WSC.ui.toggleIsVisible" label-on="{{WSC.ap.downOnSchedule ? \'interface-state.down-on-schedule\' : \'wifi-settings.ap-enabled\'}}" label-off="wifi-settings.ap-disabled" name="isEnabled" model="WSC.ap.isEnabled" disabled="WSC.ui.isLocked" call-on-change="WSC.toggleIfaceState"></ndm-toggle><div class="wifi-ap-settings wifi-{{WSC.wifiBand}}-ap-settings"><ndm-fieldset class-name="mws-controlled-section" is-disabled="NDM.DEVICE_IS_MWS_MEMBER || WSC.ui.isLocked"><ndm-input ndm-disabled-by-mws-tooltip="" label="wifi-settings.form.ssid" name="ssid__{{WSC.wifiBand}}" model="WSC.ap[\'ssid\']" extra-validator="WSC.validation.isSsidUnique" on-change="WSC.onSsidChange" validation-data="WSC.validationData" validation="required,maxLengthInBytes[32]"></ndm-input><ndm-checkbox ndm-disabled-by-mws-tooltip="" label="wifi-settings.form.hide-ssid.label" name="hideSsid__{{WSC.wifiBand}}" model="WSC.ap[\'hideSsid\']" hint="wifi-settings.form.hide-ssid.description"></ndm-checkbox><ndm-schedule-select label="{{WSC.l10n.schedule}}" name="schedule__{{WSC.wifiBand}}" ndm-disabled-by-mws-tooltip="@" is-disabled="NDM.DEVICE_IS_MWS_MEMBER || WSC.ui.isLocked" model="WSC.ap[\'schedule\']"></ndm-schedule-select><ndm-selectbox ndm-disabled-by-mws-tooltip="" class="wifi-settings__encryption-type" disabled="NDM.DEVICE_IS_MWS_MEMBER || WSC.apSyncLock || WSC.ui.isLocked" label="wifi-settings.form.security-protocol.label" description="{{WSC.securitySelectboxDescription}}" name="securityProtocol__{{WSC.wifiBand}}" on-value-change="WSC.onSecurityTypeChange" options="WSC.options[\'security\']" value="WSC.ap[\'security\']"></ndm-selectbox><ndm-sub-form><div ng-if="WSC.isWep(WSC.ap[\'security\'])"><ndm-input label="{{::WSC.l10n.key}}" disabled="WSC.apSyncLock" ndm-disabled-by-mws-tooltip="" model="WSC.ap[\'wepKeys\'][\'1\']" name="passwordKey__{{WSC.wifiBand}}" validation="required,wepKey"></ndm-input><ndm-input ng-repeat="k in [1,2,3]" ndm-disabled-by-mws-tooltip="" disabled="WSC.apSyncLock" label="{{::(WSC.l10n.key + \' \' + (k + 1))}}" model="WSC.ap[\'wepKeys\'][k + 1 + \'\']" name="{{::(\'passwordKey\' + k + \'__\' + WSC.wifiBand)}}" validation="wepKey"></ndm-input></div><ndm-input ndm-disabled-by-mws-tooltip="" ng-if="WSC.isAnyWpaPsk(WSC.ap[\'security\'])" disabled="WSC.apSyncLock" label="wifi-settings.form.psk.label" model="WSC.ap[\'psk\']" placeholder="{{WSC.l10n.placeholder.psk}}" name="psk__{{WSC.wifiBand}}" validation="required,wpaPsk"></ndm-input></ndm-sub-form></ndm-fieldset><div ng-if="WSC.isAnyWpaEap(WSC.ap[\'security\'])"><ndm-input ndm-disabled-by-mws-tooltip="" class="wifi-settings__radius-server" label="wifi-settings.form.radius-server.label" placeholder="{{\'wifi-settings.form.radius-server.placeholder\' | translate}}" description="{{WSC.radiusServerDescription}}" name="radiusServer" validation-data="{allowPort: true}" validation="required,ip" model="WSC.wpaEap.radiusServer"></ndm-input><ndm-input ndm-disabled-by-mws-tooltip="" label="wifi-settings.form.radius-secret" name="radiusSecret" password="true" max-length="64" validation="required,ascii,length[..64]" model="WSC.wpaEap.radiusSecret"></ndm-input></div><ndm-checkbox label="wifi-settings.form.wps" name="wps__{{WSC.wifiBand}}" disabled="WSC.ui.isLocked" model="WSC.ap[\'wps\']"></ndm-checkbox><ndm-checkbox ng-show="WSC.ap[\'wps\']" label="wifi-settings.form.wps-pin" disabled="WSC.ui.isLocked" name="pinPassword__{{WSC.wifiBand}}" model="WSC.ap.wpsPinEnabled"></ndm-checkbox><ndm-form-title ng-if="WSC.ap[\'wps\'] && WSC.ap.wpsPinEnabled" title="" text="WSC.ap.wpsPin"></ndm-form-title></div><div ng-if="::WSC.ui.roamingSectionIsVisible" class="roaming-section"><ndm-form-header class="roaming-section__title" hr="hr-light-blue" label="wifi-settings.roaming-section.header" sub-title="wifi-settings.roaming-section.description"><ndm-help><span data-translate="">wifi-settings.roaming-section.hint</span></ndm-help></ndm-form-header><ndm-fieldset is-disabled="WSC.unsuitableSecurityForRoaming || NDM.DEVICE_IS_MWS_MEMBER" class-name="form"><ndm-checkbox ndm-disabled-by-mws-tooltip="" label="wifi-settings.form.ft-mode.label" disabled="WSC.unsuitableSecurityForRoaming || WSC.ui.isLocked" name="wifi__ftEnabled" model="WSC.ap[\'ftEnabled\']"><ndm-help><span data-translate="">wifi-settings.form.ft-mode.hint</span></ndm-help></ndm-checkbox><ndm-fieldset ng-if="WSC.ap.ftEnabled" ng-form="WSC.ap.dot11r" is-disabled="WSC.unsuitableSecurityForRoaming || WSC.ui.isLocked" ndm-disabled-by-mws-tooltip="" class-name="form--sub"><ndm-input class-name="ndm-input-s" label="wifi-settings.form.mobility-domain-id.label" name="wifi__ftMdid" model="WSC.ap[\'ftMdid\']" max-length="2" validation="required,length[2..],asciiWithoutSpace"></ndm-input><ndm-input password="true" label="wifi-settings.form.mobility-domain-key.label" name="wifi__iappKey" model="WSC.iappKey" show-password-label="wifi-settings.form.mobility-domain-key.show-key" hide-password-label="wifi-settings.form.mobility-domain-key.hide-key" validation="required"></ndm-input></ndm-fieldset><ndm-checkbox ndm-disabled-by-mws-tooltip="" label="wifi-settings.form.rrm" name="wifi__rrmEnabled" disabled="WSC.ui.isLocked" model="WSC.ap[\'rrm\']"></ndm-checkbox></ndm-fieldset></div><hr ng-if="!WSC.ui.masterHeaderIsVisible" class="hr-light-blue"><ndm-form-header ng-if="WSC.ui.masterHeaderIsVisible" label="{{WSC.l10n.masterLabel[WSC.wifiBand]}}"></ndm-form-header><fieldset ng-if="WSC.ready" ng-disabled="WSC.ui.isLocked" class="wifi-master-settings wifi-{{WSC.wifiBand}}-master-settings"><ndm-selectbox label="wifi-settings.form.country-code" name="countryCode__{{WSC.wifiBand}}" disabled="WSC.ui.isLocked" options="WSC.options.countryCode" value="WSC.master[\'countryCode\']" on-value-change="WSC.onCountryCodeChange"></ndm-selectbox><ndm-selectbox label="wifi-settings.form.standard" name="standart__{{WSC.wifiBand}}" disabled="WSC.ui.isLocked" options="WSC.options.standard" value="WSC.master[\'standard\']" on-value-change="WSC.onStandardChange"></ndm-selectbox><div ng-if="!WSC.master[\'canSelectChannel\']" class="channel-selectbox"><div class="form__cell form__cell--input-label help-text"><span data-translate="">wifi-settings.form.channel</span></div> <div class="form__cell help-text"><span data-translate="">{{::(\'wifi-settings.text.master-channel-fixed-by-\'+ (WSC.hasBackhaul ? \'mesh\' : \'wisp\') + \'-\' + WSC.wifiBand)}}</span></div></div><ndm-selectbox-with-details ng-if="WSC.master[\'canSelectChannel\']" is-disabled="WSC.ui.isLocked" label="wifi-settings.form.channel" description="{{ WSC.shouldCurrentChannelBeVisible() ? WSC.l10n.currentChannel + WSC.dfsStatus : \'\'}}" name="channel__{{WSC.wifiBand}}" class="channel-selectbox" options="WSC.options.channel" on-change="WSC.onChannelSelect" value="WSC.master[\'channel\']"></ndm-selectbox-with-details><ndm-selectbox ng-if="WSC.master[\'channel\'] === \'0\' && WSC.master[\'canSelectChannel\']" label="wifi-settings.form.auto-rescan.label" name="autoRescan__{{WSC.wifiBand}}" options="WSC.options.autoRescan" disabled="WSC.ui.isLocked" value="WSC.master[\'autoRescan\']"></ndm-selectbox><ndm-radio name="channelWidth__{{WSC.wifiBand}}" label="channel-width" disabled="WSC.ui.isLocked" array="WSC.options.channelWidth" model="WSC.master[\'channelWidth\']"></ndm-radio><ndm-selectbox label="wifi-settings.form.signal-power" name="powerLevel__{{WSC.wifiBand}}" disabled="WSC.ui.isLocked" options="WSC.options.transmitPower" value="WSC.master[\'transmitPower\']"></ndm-selectbox><ndm-checkbox label="wifi-settings.form.enable-tx-burst.label" name="txBurst__{{WSC.wifiBand}}" model="WSC.master[\'txBurst\']" disabled="WSC.ui.isLocked" hint="wifi-settings.form.enable-tx-burst.tooltip"></ndm-checkbox><ndm-checkbox ng-if="WSC.ui.qam256IsVisible" label="wifi-settings.form.256-qam.label" name="qam256__{{WSC.wifiBand}}" model="WSC.master[\'qam256\']" disabled="WSC.ui.isLocked" hint="wifi-settings.form.256-qam.tooltip"></ndm-checkbox><div ng-if="WSC.ui.beamformingIsVisible"><ndm-checkbox label="wifi-settings.form.beamforming.label" name="beamforming__{{WSC.wifiBand}}" model="WSC.master[\'beamforming\']" disabled="WSC.ui.isLocked" hint="wifi-settings.form.beamforming.tooltip"></ndm-checkbox><ndm-sub-form ng-if="WSC.master[\'beamforming\']"><ndm-checkbox ng-if="WSC.ui.isDlMuMimoVisible || WSC.isAxStandardSelected" label="wifi-settings.form.downlink-mu-mimo.label" name="downlinkMuMimo__{{WSC.wifiBand}}" model="WSC.master[\'downlinkMuMimo\']" disabled="WSC.ui.isLocked" hint="wifi-settings.form.downlink-mu-mimo.tooltip"></ndm-checkbox><ndm-checkbox ng-if="WSC.isAxStandardSelected" label="wifi-settings.form.downlink-ofdma.label" name="downlinkOfdma__{{WSC.wifiBand}}" model="WSC.master[\'downlinkOfdma\']" disabled="WSC.ui.isLocked" hint="wifi-settings.form.downlink-ofdma.tooltip"></ndm-checkbox></ndm-sub-form></div><div ng-if="WSC.isAxStandardSelected"><ndm-checkbox label="wifi-settings.form.uplink-mu-mimo.label" name="uplinkMuMimo__{{WSC.wifiBand}}" model="WSC.master[\'uplinkMuMimo\']" disabled="WSC.ui.isLocked" hint="wifi-settings.form.mu-mimo.tooltip"></ndm-checkbox><ndm-checkbox label="wifi-settings.form.uplink-ofdma.label" name="uplinkOfdma__{{WSC.wifiBand}}" model="WSC.master[\'uplinkOfdma\']" disabled="WSC.ui.isLocked" hint="wifi-settings.form.uplink-ofdma.tooltip"></ndm-checkbox></div> <div ng-if="WSC.ui.airtimeFairnessIsVisible"><ndm-checkbox label="wifi-settings.form.atf.label" name="atf__{{WSC.wifiBand}}" model="WSC.master[\'atfEnable\']" disabled="WSC.ui.isLocked" hint="wifi-settings.form.atf.tooltip"></ndm-checkbox><ndm-sub-form ng-if="WSC.master[\'atfEnable\']"><ndm-checkbox label="wifi-settings.form.atfInbound.label" name="atfInbound__{{WSC.wifiBand}}" model="WSC.master[\'atfInbound\']" disabled="WSC.ui.isLocked" hint="wifi-settings.form.atfInbound.tooltip"></ndm-checkbox></ndm-sub-form></div><ndm-selectbox ng-if="WSC.ui.bandSteeringSelectboxIsVisible" disabled="!WSC.apSettingsEqual || WSC.ui.isLocked" label="wifi-settings.form.band-steering.label" name="wifi__bandSteering" options="WSC.options.bandSteering" value="WSC.master.bandSteering" bottom-description="{{WSC.apSettingsEqual ? \'\' : WC.l10n.bandSteeringBottomDescription}}"><ndm-help><div data-translate="">wifi-settings.form.band-steering.tooltip</div></ndm-help></ndm-selectbox></fieldset></div></form><ndm-control-footer prefix="wifiSettings" is-popup="WSC.ui.isPopup" is-visible="WSC.ui.footerIsVisible || WSC.form.modified || WSC.form.pending" is-save-disabled="WSC.form.$invalid || WSC.ui.isLocked" form="WSC.form" cancel="WSC.cancel()" save="WSC.save()"></ndm-control-footer></div>'),e.put("app/page/controlPanel/myNetwork/wifi/wifi.html",'<ndm-page label="{{\'wifi.header\' + WSC.wifiBand}}" progress="WSC.progress" description="wifi.description"><div class="wifi-page"><div ng-if="WSC.ready" ndm-polling="WSC.updateInfo"></div> <div ng-include="\'app/page/controlPanel/myNetwork/wifi/wifi-settings.html\'"></div></div></ndm-page>'),e.put("app/page/controlPanel/myNetwork/wifiClients/wifiClients.html",'<ndm-page class="page-wifiClients" label="wifiClients.title" description="{{vm.l10n.description}}" progress="vm.progress"><hr class="hr-invisible"><div ng-if="vm.progress === 100" ndm-polling="vm.updateData"></div><ndm-table ng-if="vm.table.data.length > 0" table-class="page-wifiClients__wifi-clients-table" columns="vm.table.columns" data="vm.table.data" track-by-prop="mac" compare-with="vm.table.comparatorFn" click-on-cell="vm.onTrashIconClick" sort-name="mac"></ndm-table><div ng-if="vm.table.data.length === 0" class="empty-list" data-translate="">wifiClients.no-data</div><hr class="hr-invisible"><ndm-button ng-if="vm.progress === 100" ndm-disabled-by-mws-tooltip="@" class="buttons-row__button--full-width" is-disabled="NDM.DEVICE_IS_MWS_MEMBER" on-click="vm.offlineRegistrationPopup.show" btn-name="registerOfflineDevice" label="wifiClients.add-host-by-mac-btn"></ndm-button></ndm-page><ndm-popup ng-if="vm.offlineRegistrationPopup.isVisible" is-visible="true" class="page-wifiClients__offline-registration-popup" header-title="devices-list.offline-device-registration.header" close="vm.offlineRegistrationPopup.close"><hr class="hr-invisible"><form class="form" name="vm.offlineRegistrationForm"><ndm-input label="devices-list.device-card.device-name" name="offlineDeviceName" model="vm.offlineRegistrationPopup.name" extra-validator="vm.isNameUnique" validation="required,maxLengthInBytes[64]"></ndm-input><ndm-input label="devices-list.device-card.blocked.mac" name="offlineDeviceMac" model="vm.offlineRegistrationPopup.mac" extra-validator="vm.isMacUnique" validation="required,mac"></ndm-input><hr class="hr-invisible"><ndm-button on-click="vm.offlineRegistrationPopup.register" btn-class="btn--primary btn--long" is-disabled="vm.offlineRegistrationForm.$invalid" label="devices-list.device-card.not-registered.registration"></ndm-button></form></ndm-popup>'),e.put("app/page/controlPanel/myNetwork/wifiSystem/page.view.html",'<ndm-page class="page-wifi-system page-wifi-system--{{vm.currentTab}}" label="wifi-system.page-title" progress="vm.progress"><div class="page-wifi-system__description"><span data-translate="">{{ vm.isMobile ? \'\' : \'wifi-system.page-description\' }}</span> <a ng-click="vm.showMwsModal()" class="external-link" href="" data-translate="">wifi-system.controller.desc.link</a></div><ndm-tabs tabs="vm.tabs" compare-prop="id" on-tab-changed-fn="vm.onTabSwitch" is-disabled="vm.progress !== 100" label-prop="label"></ndm-tabs><div ng-show="vm.currentTab === vm.TAB.DEVICES" class="page-wifi-system__tab page-wifi-system__tab--{{vm.TAB.DEVICES}}"><ng-include src="\'app/page/controlPanel/myNetwork/wifiSystem/controller/ws.controller.view.html\'"></ng-include><ng-include src="\'app/page/controlPanel/myNetwork/wifiSystem/extenders/ws.extendersTable.view.html\'"></ng-include></div> <div ng-show="vm.currentTab === vm.TAB.LOG" class="page-wifi-system__tab page-wifi-system__tab--{{vm.TAB.LOG}}"><ng-include src="\'app/page/controlPanel/myNetwork/wifiSystem/log/ws.log.view.html\'"></ng-include></div> <div ng-show="vm.currentTab === vm.TAB.SETTINGS" class="page-wifi-system__tab page-wifi-system__tab--{{vm.TAB.SETTINGS}}"><ng-include src="\'app/page/controlPanel/myNetwork/wifiSystem/settings/ws.settings.view.html\'"></ng-include></div><ng-include src="\'app/page/controlPanel/myNetwork/wifiSystem/renameDevice/ws.renameDevice.popup.html\'"></ng-include></ndm-page>'),e.put("app/page/controlPanel/networkRules/firewall/firewall.html",'<ndm-page class="page-firewall" label="firewall.headers.page" progress="FW.progress" description="firewall.description"><ndm-device-poller></ndm-device-poller><ndm-tabs ng-if="FW.interfacesLoaded" is-disabled="FW.rulesTable.isLocked" tabs="FW.interfaceTabs" compare-prop="id" label-prop="name" update-state-on-tab-change="true" on-tab-changed-fn="FW.onTabSelect"></ndm-tabs><div class="page-firewall__iface-acl-settings"><div ng-if="FW.rulesTable.rulesLoaded" class="firewall-rules-list"><ndm-table ng-if="FW.rulesTable.data.length > 0" class="firewall_table" data="FW.rulesTable.data" columns="FW.rulesTable.columns" sort-name="index" sort-reverse="false" draggable="true" drag-disabled="FW.rulesTable.isLocked" click-on-row="FW.ruleEditor.editRule" click-on-cell="FW.rulesTable.onCellClick" on-drag-end="FW.rulesTable.onDragEnd" on-drag-start="FW.rulesTable.onDragStart"></ndm-table><div ng-if="FW.rulesTable.data.length === 0" class="empty-list"><span data-translate="">firewall.rule-table.no-data</span></div></div> <div ng-if="FW.rulesTable.selectedRulesCount > 0" class="page-firewall__table-tools buttons-row"><ndm-selectbox class="buttons-row__item" label="firewall.actions.move-selected-rules" name="moveToInterface" value="FW.moveDestination" on-value-change="FW.rulesTable.moveSelectedRules" options="FW.rulesTable.toIfaceOptions"></ndm-selectbox><ndm-selectbox class="buttons-row__item" label="firewall.actions.copy-selected-rules" name="copyToInterface" value="FW.copyDestination" on-value-change="FW.rulesTable.copySelectedRules" options="FW.rulesTable.toIfaceOptions"></ndm-selectbox><ndm-button ng-if="FW.rulesTable.data.length === FW.rulesTable.selectedRulesCount" btn-class="btn--warning" class="buttons-row__item" on-click="FW.rulesTable.flushRules" label="firewall.buttons.flush-rules-btn"></ndm-button><ndm-button ng-if="FW.rulesTable.data.length > FW.rulesTable.selectedRulesCount" btn-class="btn--warning" class="buttons-row__item" on-click="FW.rulesTable.deleteSelectedRules" label="firewall.buttons.drop-rules-btn"></ndm-button></div> <div class="page-firewall__footer-toolbar"><ndm-button class="buttons-row__item" ng-click="FW.ruleEditor.addNewRule()" label="firewall.buttons.add-rule-btn"></ndm-button></div></div></ndm-page><ndm-popup is-visible="FW.ruleEditor.isOpened" header-title="firewall.rule-editor-popup.title" close="FW.ruleEditor.close"><form ng-if="FW.ruleEditor.isOpened" novalidate="" name="FW.ruleEditor.formCtrl" ng-cloak=""><ndm-text text="firewall.rule-editor-popup.description"></ndm-text><ndm-checkbox label="firewall.rule-properties.enabled" name="isEnabled" model="FW.ruleEditor.ruleData.isEnabled"></ndm-checkbox><ndm-input label="firewall.rule-properties.description" model="FW.ruleEditor.ruleData.description" name="description"></ndm-input><ndm-selectbox label="firewall.rule-properties.action" value="FW.ruleEditor.ruleData.action" name="action" options="FW.ruleEditor.options.action"></ndm-selectbox><ndm-selectbox label="firewall.rule-properties.source-address" value="FW.ruleEditor.ruleData.sourceAddressType" options="FW.ruleEditor.options.addressType" name="sourceAddressType" on-value-change="FW.ruleEditor.sourceAddressTypeChanged"></ndm-selectbox><ndm-sub-form ng-if="FW.ruleEditor.ruleData.sourceAddressType !== \'any\'"><ndm-input label="firewall.rule-properties.source-address-ip" model="FW.ruleEditor.ruleData.source" validation="required,ip {{ ( FW.ruleEditor.ruleData.sourceAddressType === \'subnet\' ? \',isNet[\' + FW.ruleEditor.ruleData.sourceMask + \']\' : \'\' ) }}" name="sourceAddressIp"></ndm-input><ndm-selectbox ng-if="FW.ruleEditor.ruleData.sourceAddressType === \'subnet\'" label="firewall.rule-properties.source-address-mask" value="FW.ruleEditor.ruleData.sourceMask" options="FW.ruleEditor.options.netmask" name="sourceAddressMask"></ndm-selectbox></ndm-sub-form><ndm-selectbox label="firewall.rule-properties.destination-address" value="FW.ruleEditor.ruleData.destinationAddressType" options="FW.ruleEditor.options.addressType" name="destinationAddressType" on-value-change="FW.ruleEditor.destinationAddressTypeChanged"></ndm-selectbox><ndm-sub-form ng-if="FW.ruleEditor.ruleData.destinationAddressType !== \'any\'"><ndm-input label="firewall.rule-properties.destination-address-ip" model="FW.ruleEditor.ruleData.destination" validation="required,ip {{ ( FW.ruleEditor.ruleData.destinationAddressType === \'subnet\' ? \',isNet[\' + FW.ruleEditor.ruleData.destinationMask + \']\' : \'\' ) }}" name="destinationAddressIp"></ndm-input><ndm-selectbox ng-if="FW.ruleEditor.ruleData.destinationAddressType === \'subnet\'" label="firewall.rule-properties.destination-address-mask" value="FW.ruleEditor.ruleData.destinationMask" options="FW.ruleEditor.options.netmask" name="destinationAddressMask"></ndm-selectbox></ndm-sub-form><div ng-if="FW.ruleEditor.sourcePortRequired"><ndm-selectbox label="firewall.rule-properties.source-port-operator" value="FW.ruleEditor.ruleData.srcPortOperator" name="srcPortOperator" options="FW.ruleEditor.options.portOperator"></ndm-selectbox><ndm-sub-form ng-if="FW.ruleEditor.ruleData.srcPortOperator !== \'any\'"><ndm-ports-range name-from="sourcePort" name-to="sourceEndPort" model-from="FW.ruleEditor.ruleData.sourcePort" model-to="FW.ruleEditor.ruleData.sourceEndPort" mode="FW.ruleEditor.ruleData.srcPortOperator === \'range\'" single-title="firewall.rule-properties.source-port" range-title="firewall.rule-properties.source-port" extra-validator="vm.editor.portRangeValidator"></ndm-ports-range></ndm-sub-form></div><ndm-selectbox label="firewall.rule-properties.protocol" value="FW.ruleEditor.ruleData.protocol" name="protocol" options="FW.ruleEditor.options.protocol" on-value-change="FW.ruleEditor.checkIfPortsAreRequired"></ndm-selectbox><div ng-if="FW.ruleEditor.destinationPortRequired"><ndm-selectbox label="firewall.rule-properties.destination-port-operator" value="FW.ruleEditor.ruleData.dstPortOperator" name="dstPortOperator" options="FW.ruleEditor.options.portOperator"></ndm-selectbox><ndm-sub-form ng-if="FW.ruleEditor.ruleData.dstPortOperator !== \'any\'"><ndm-ports-range name-from="destinationPort" name-to="destinationEndPort" model-from="FW.ruleEditor.ruleData.destinationPort" model-to="FW.ruleEditor.ruleData.destinationEndPort" mode="FW.ruleEditor.ruleData.dstPortOperator === \'range\'" single-title="firewall.rule-properties.destination-port" range-title="firewall.rule-properties.destination-port"></ndm-ports-range></ndm-sub-form></div><ndm-selectbox label="firewall.rule-editor-popup.service-fields.position" value="FW.ruleEditor.ruleData.index" name="rulePositions" options="FW.ruleEditor.rulePositions"></ndm-selectbox><ndm-schedule-select name="schedule" model="FW.ruleEditor.ruleData.schedule"></ndm-schedule-select></form><div ng-if="!FW.ruleEditor.ruleData.isNew"><hr class="hr-light-blue"><ndm-button btn-class="btn--long" on-click="FW.ruleEditor.drop" label="firewall.buttons.drop-rule-btn"></ndm-button></div><ndm-control-footer prefix="firewall" is-visible="FW.ruleEditor.formCtrl.modified || FW.ruleEditor.ruleData.isNew" is-popup="true" is-save-disabled="FW.ruleEditor.formCtrl.$invalid" save="FW.ruleEditor.save()" cancel="FW.ruleEditor.close()"></ndm-control-footer></ndm-popup>'),e.put("app/page/controlPanel/networkRules/netFilter/netFilter.html",'<ndm-page class="page-netFilter" label="netFilter.title" description="netFilter.description" progress="NFC.progress"><ndm-device-poller></ndm-device-poller><form name="NFC.form" novalidate=""><div ng-include="\'app/page/controlPanel/networkRules/netFilter/internetSafety/internetSafety.section.html\'"></div> <div ng-include="\'app/page/controlPanel/networkRules/netFilter/staticDns/staticDns.section.html\'"></div> <div ng-include="\'app/page/controlPanel/networkRules/netFilter/dnsOverX/dnsOverX.section.html\'"></div><ndm-control-footer prefix="netFilter" is-visible="NFC.form.modified" is-save-disabled="NFC.form.$invalid || NFC.lockUiCtrls" save="NFC.save()" cancel="NFC.reset()"></ndm-control-footer></form></ndm-page>'),e.put("app/page/controlPanel/networkRules/portForwarding/portForwarding.html",'<ndm-page class="page-portforwarding" label="portforwarding.page-title" description="portforwarding.page-description" progress="vm.progress"><ndm-form-header class="rules-table-header" label="portforwarding.rules-table-header"></ndm-form-header><ndm-table ng-show="vm.list.items.length" class="portforwarding_table" data="vm.list.items" columns="vm.list.columns" draggable="true" on-drag-end="vm.list.dragEnd" on-drag-start="vm.list.dragStart" click-on-row="vm.editor.edit"></ndm-table><div ng-if="!vm.list.items.length" class="empty-list"><span data-translate="">portforwarding.list-no-data</span></div><ndm-button ng-click="vm.editor.edit(true)" label="portforwarding.list-add-button"></ndm-button><a ng-if="vm.list.items.length" class="action-link" tabindex="0" ng-click="vm.list.flush()" data-translate="">portforwarding.list-flush-button</a> <div ng-if="::vm.upnpAvailable"><ndm-form-header label="portforwarding.upnp-rules-title" hr="hr-light-blue"></ndm-form-header><ndm-table ng-if="vm.upnpTable.items.length" data="vm.upnpTable.items" sort-name="vm.upnpTable.sortColumn" sort-reverse="vm.upnpTable.sortReverse" columns="vm.upnpTable.columns" draggable="false"></ndm-table><div ng-if="!vm.upnpTable.items.length" class="empty-list"><span data-translate="">portforwarding.no-upnp-ports</span></div></div></ndm-page><ndm-popup class="page-portforwarding-editor-popup" is-visible="true" ng-if="vm.editor.visible" header-title="portforwarding.editor.header-edit" close="vm.editor.close"><ndm-text text="portforwarding.editor.description-text"></ndm-text><form novalidate="" name="vm.editor.form" ng-class="{__pending: vm.editor.data.pending}"><ndm-checkbox label="portforwarding.editor.fields.enabled" model="vm.editor.data.enabled" name="enabled"></ndm-checkbox><ndm-input label="portforwarding.editor.fields.comment" model="vm.editor.data.comment" name="comment"></ndm-input><ndm-selectbox label="portforwarding.editor.fields.interface" name="interface" options="vm.editor.options.interfaces" on-value-change="vm.editor.onInputChange" value="vm.editor.data.interface"></ndm-selectbox><ndm-sub-form ng-if="vm.editor.data.inputIsCustomNet"><ndm-input label="iface-ip.address" name="customIp" model="vm.editor.data.address" validation="required,ip,isNet[{{vm.editor.data.mask}}]"></ndm-input><ndm-selectbox label="iface-ip.mask" value="vm.editor.data.mask" name="customMask" options="vm.editor.options.masks"></ndm-selectbox></ndm-sub-form><ndm-selectbox-filter label="portforwarding.editor.fields.to-host" name="toHost" options="vm.editor.options.hosts" on-change="vm.editor.onHostPresetsChange" group-labels="vm.editor.options.groupLabels" is-required="true" group-options-by="vm.editor.getDeviceGroup" value="vm.editor.data.toHost"></ndm-selectbox-filter><ndm-sub-form ng-if="vm.editor.data.toHostIsUnregistered"><ndm-text text="portforwarding.editor.to-host-name-description"></ndm-text><ndm-input label="portforwarding.editor.fields.to-host-name" name="toHostName" set-focus="true" model="vm.editor.data.toHostName" validation="required,isHostNameUnique"></ndm-input></ndm-sub-form><ndm-sub-form ng-if="vm.editor.data.toHostIsToIp"><ndm-input label="portforwarding.editor.fields.to-ip" name="toHostIp" set-focus="true" model="vm.editor.data.toIp" validation="required,ip"></ndm-input></ndm-sub-form><ndm-selectbox label="portforwarding.editor.fields.protocol-preset" name="protocolPreset" options="vm.editor.options.protocolPresets" error="{{vm.editor.errors.protocol}}" value="vm.editor.data.protocolPreset"></ndm-selectbox><ndm-sub-form ng-if="vm.editor.data.protocolPreset === vm.TCP_PROTOCOL || vm.editor.data.protocolPreset === vm.UDP_PROTOCOL || vm.editor.data.protocolPreset === vm.TCP_UDP_OPTION_ID"><ndm-radio name="portMode" label="portforwarding.editor.fields.port-mode" array="vm.editor.options.portModes" model="vm.editor.data.portMode"></ndm-radio><ndm-ports-range name-from="port" name-to="endPort" model-from="vm.editor.data.port" model-to="vm.editor.data.endPort" mode="vm.editor.data.portMode" single-title="portforwarding.editor.fields.port" range-title="portforwarding.editor.fields.ports"></ndm-ports-range></ndm-sub-form><ndm-input ng-if="!+vm.editor.data.portMode && vm.editor.showToPortInput(vm.editor.data.protocolPreset)" label="portforwarding.editor.fields.to-port" model="vm.editor.data.toPort" name="toPort" validation="range[1..65534]"></ndm-input><ndm-schedule-select model="vm.editor.data.schedule" name="schedule"></ndm-schedule-select></form><div ng-if="!vm.editor.isNew" class="_delete-panel"><button class="btn btn--long" ng-click="vm.editor.delete()" data-translate="">portforwarding.editor.delete-button</button></div><ndm-control-footer prefix="portFw" is-visible="vm.editor.form.modified || vm.editor.isNew" is-popup="true" is-save-disabled="vm.editor.form.$invalid || (!vm.editor.form.modified && !vm.editor.isNew) || vm.editor.form.pending" save="vm.editor.save()" cancel="vm.editor.close()"></ndm-control-footer></ndm-popup>'),e.put("app/page/controlPanel/networkRules/remoteAccess/remoteAccess.html",'<ndm-page class="page-remoteAccess" label="remoteAccess.title" progress="RA.progress"><br><ndm-tabs ng-if="RA.tabs.length" tabs="RA.tabs" label-prop="name" can-select-tab="RA.canChangeTab" on-tab-changed-fn="RA.onSelectTab" update-state-on-tab-change="true"></ndm-tabs><div ng-show="RA.activeTab === \'keendns\'"><div ng-if="RA.keendns" ng-include="\'app/page/controlPanel/networkRules/remoteAccess/keendns/keendns.html\'"></div></div> <div ng-show="RA.activeTab === \'ddns\'"><div ng-if="RA.ddns" ng-include="\'app/page/controlPanel/networkRules/remoteAccess/ddns/ddns.html\'"></div></div></ndm-page>'),e.put("app/page/controlPanel/networkRules/staticRoutes/staticRoutes.html",'<ndm-page class="page-static-routes" label="staticRoutes.headers.page" progress="SRC.progress" description="staticRoutes.description"><div class="static-routes-list"><div ng-if="!SRC.routesTable.routesLoaded"><ndm-text text="staticRoutes.messages.loading"></ndm-text></div><div ng-if="SRC.routesTable.routesLoaded"><ndm-form-header label="staticRoutes.headers.table"></ndm-form-header><div ng-if="SRC.routesTable.data.length === 0" class="empty-list"><span data-translate="">staticRoutes.messages.no-static-routes</span></div> <div ng-if="SRC.routesTable.data.length > 0"><ndm-table data="SRC.routesTable.data" columns="SRC.routesTable.columns" table-class="_static-routes" click-on-row="SRC.editor.editRoute" sort-name="SRC.routesTable.sortBy" sort-reverse="SRC.routesTable.sortReverse"></ndm-table></div></div></div><div class="buttons-row"><ndm-button class="buttons-row__item buttons-row__button--full-width" on-click="SRC.editor.editNewRoute" label="staticRoutes.buttons.add-route-btn"></ndm-button><ndm-button class="buttons-row__item buttons-row__button--full-width" on-click="SRC.uploader.toggle" label="staticRoutes.headers.uploader"></ndm-button><ndm-button ng-if="SRC.routesTable.data.length > 0" btn-class="btn--warning" class="buttons-row__item buttons-row__button--full-width" on-click="SRC.routesTable.flushRoutes" label="staticRoutes.buttons.flush-btn"></ndm-button></div><ndm-form-header hr="hr-light-blue" label="staticRoutes.routes-table.header-ipv4"></ndm-form-header><ndm-table columns="SRC.currentRoutesTable.columns" data="SRC.currentRoutesTable.data" sort-name="destination" sort-reverse="false" track-by-prop="index"></ndm-table><div ng-if="SRC.currentRoutesTable.data.length === 0" class="empty-list"><span data-translate="">staticRoutes.routes-table.empty</span></div><div ng-if="::SRC.ipv6Installed"><ndm-form-header label="staticRoutes.routes-table.header-ipv6"></ndm-form-header><ndm-table ng-if="SRC.currentRoutesTable.dataIpv6.length > 0" columns="SRC.currentRoutesTable.columns" data="SRC.currentRoutesTable.dataIpv6" sort-name="destination" sort-reverse="false"></ndm-table><div ng-if="SRC.currentRoutesTable.dataIpv6.length === 0" class="empty-list"><span data-translate="">staticRoutes.routes-table.empty</span></div></div></ndm-page><ndm-popup is-visible="1" ng-if="SRC.uploader.visible" header-title="staticRoutes.headers.uploader" close="SRC.uploader.toggle"><div class="static-routes-uploader-subform"><ndm-form-header hr="hr-light-blue" label="" sub-title=""></ndm-form-header><ndm-text text="staticRoutes.uploader-subform.description"></ndm-text><form bs-modifiable="false" name="SRC.uploader.uploaderForm" class="static-routes-uploader-form"><ndm-selectbox ng-if="SRC.uploader.interfacesLoaded" label="staticRoutes.route-properties.interface" name="interface" value="SRC.uploader.interface" options="SRC.uploader.interfaceOptions"></ndm-selectbox><ndm-input-file class="btn--file-upload" upload-file="SRC.uploader.routesFile" label="staticRoutes.uploader-subform.title" on-upload-file="SRC.uploader.uploadRoutes" confirm-upload="true" btn-title="{{::SRC.l10n.uploadBtnTitle}}" btn-title-if-file-selected="{{::SRC.l10n.uploadBtnTitleFileSelected}}"></ndm-input-file></form></div></ndm-popup><ndm-popup is-visible="SRC.editor.opened" header-title="staticRoutes.editor-popup.title" close="SRC.editor.cancelEditRoute"><form name="SRC.editor.editStaticRouteForm" class="page-static-routes__editor-form" ng-if="SRC.editor.ready()" ng-cloak=""><ndm-text text="staticRoutes.editor-popup.description"></ndm-text><ndm-selectbox label="staticRoutes.route-properties.type" name="type" options="SRC.editor.routeTypeOptions" value="SRC.editor.routeData.type" on-value-change="SRC.checkGateway"></ndm-selectbox><ndm-input label="staticRoutes.route-properties.description" model="SRC.editor.routeData.comment" name="description"></ndm-input><div ng-if="SRC.editor.routeData.type === SRC.ROUTE_TYPE.TO_HOST"><ndm-input label="staticRoutes.route-properties.destination-values.host" model="SRC.editor.routeData.host" name="host" validation="required,ipOrZero"></ndm-input></div> <div ng-if="SRC.editor.routeData.type === SRC.ROUTE_TYPE.TO_NETWORK"><ndm-input label="staticRoutes.route-properties.destination-values.network" model="SRC.editor.routeData.network" name="network" validation="required,ip,isNet[{{SRC.editor.routeData.mask}}]"></ndm-input><ndm-selectbox label="staticRoutes.route-properties.mask" name="mask" options="SRC.editor.netmaskOptions" value="SRC.editor.routeData.mask"></ndm-selectbox></div><ndm-input label="staticRoutes.route-properties.gateway" model="SRC.editor.routeData.gateway" name="gateway" validation="gatewayOrInterfaceAndAutoRequired,{{SRC.editor.routeData.interface ? \'ipOrZero\': \'ip\'}},inNets[{{SRC.editor.interfaceNets}}]"></ndm-input><ndm-selectbox label="staticRoutes.route-properties.interface" name="route-interface" value="SRC.editor.routeData.interface" options="SRC.editor.interfaceOptions" ng-model-options="{}" on-change="SRC.checkGateway()"></ndm-selectbox><div ng-if="SRC.editor.routeData.type !== SRC.ROUTE_TYPE.DEFAULT_ROUTE"><ndm-checkbox label="staticRoutes.route-properties.auto" name="auto" model="SRC.editor.routeData.auto" hint="staticRoutes.editor-popup.hints.auto" on-change="SRC.checkGateway()"></ndm-checkbox></div><hr class="hr-light-blue" ng-show="!SRC.editor.isNewRoute"><button class="btn btn--long _del-btn" ng-show="!SRC.editor.isNewRoute" ng-click="SRC.editor.deleteRoute()" data-translate="">staticRoutes.editor-popup.delete-route-btn</button><ndm-control-footer prefix="staticRoute" is-visible="SRC.editor.editStaticRouteForm.modified || SRC.editor.isNewRoute" is-popup="true" is-save-disabled="!SRC.editor.doneValidation || SRC.editor.editStaticRouteForm.$invalid" save="SRC.editor.saveRoute()" cancel="SRC.editor.cancelEditRoute()"></ndm-control-footer></form></ndm-popup>'),e.put("app/page/controlPanel/networkRules/wirelessAcl/wirelessAcl.html",'<ndm-page class="page-wireless-acl" label="wireless-acl.page-title" progress="vm.progress" description="{{vm.l10n.description}}"><ndm-device-poller ng-if="vm.isReady"></ndm-device-poller><ndm-tabs ng-if="vm.isReady" tabs="vm.tabs" label-prop="description" compare-prop="id" active-tab="vm.activeTab" is-disabled="vm.ui.isLocked" update-state-on-tab-change="true" can-select-tab="vm.canSwitchTab" on-tab-changed-fn="vm.setActiveTab"></ndm-tabs><div ng-if="!vm.activeSegment.includesAccessPoints" ndm-html-compile="vm.l10n.getNoWifiSegmentDescription(vm.activeSegment.description)"></div><form ng-if="vm.activeSegment.includesAccessPoints" name="vm.form"><ndm-fieldset is-disabled="vm.ui.isLocked || NDM.DEVICE_IS_MWS_MEMBER" class-name="mws-controlled-section"><ndm-selectbox ndm-disabled-by-mws-tooltip="" disabled="vm.ui.isLocked || NDM.DEVICE_IS_MWS_MEMBER" label="wireless-acl.segment-acl-mode" name="{{vm.activeSegment.id}}__acl-mode" value="vm.activeSegment.acl.type" on-value-change="vm.onAclTypeChange" options="vm.aclTypeOptions"></ndm-selectbox><ndm-checkbox ng-if="0" name="{{vm.activeSegment.id}}__notify-on-new-hosts" model="vm.activeSegment.notifyOnNewHosts" label="wireless-acl.notify-on-new-hosts"></ndm-checkbox><hr class="hr-invisible"><div class="page-wireless-acl__table-toolbar buttons-row"><ndm-button ndm-disabled-by-mws-tooltip="@" is-disabled="vm.ui.isLocked || NDM.DEVICE_IS_MWS_MEMBER" on-click="vm.hostsTable.includeAllHosts" label="wireless-acl.hosts-table.btn-include-all"></ndm-button><ndm-button ndm-disabled-by-mws-tooltip="@" is-disabled="vm.ui.isLocked || NDM.DEVICE_IS_MWS_MEMBER" on-click="vm.hostsTable.excludeAllHosts" label="wireless-acl.hosts-table.btn-exclude-all"></ndm-button></div><ndm-table class="page-wireless-acl__hosts-table-wrapper" table-class="page-wireless-acl__hosts-table" sortable="true" track-by-prop="mac" columns="vm.hostsTable.columns" data="vm.hostsTable.data"></ndm-table><div class="page-wireless-acl__acl-limit-notice"><span ng-if="vm.aclLimitNoticeIsVisible" class="help-text--warning" data-translate="">wireless-acl.segment-acl-max-size-notice</span></div><hr class="hr-invisible"><ndm-button ndm-disabled-by-mws-tooltip="@" ng-if="vm.isReady" class="buttons-row__button--full-width" is-disabled="vm.ui.isLocked" on-click="vm.offlineRegistrationPopup.show" btn-name="registerOfflineDevice" label="devices-list.offline-device-registration.register-btn"></ndm-button></ndm-fieldset></form><ndm-control-footer is-visible="!vm.ui.isLocked && vm.form.modified" is-save-disabled="vm.form.$invalid || vm.ui.isLocked" prefix="wirelessAcl" save="vm.saveSegmentAcl" cancel="vm.resetSegmentAcl"></ndm-control-footer><p ng-if="vm.activeSegment.includesAccessPoints && !NDM.DEVICE_IS_MWS_MEMBER" ndm-html-compile="vm.l10n.getDeviceButtonDescription"></p></ndm-page><ndm-popup ng-if="vm.offlineRegistrationPopup.isVisible" is-visible="true" class="page-wireless-acl__offline-registration-popup" header-title="devices-list.offline-device-registration.header" close="vm.offlineRegistrationPopup.close"><hr class="hr-invisible"><form class="form" name="vm.offlineRegistrationForm"><ndm-input label="devices-list.device-card.device-name" name="deviceName" model="vm.offlineRegistrationPopup.name" extra-validator="vm.offlineRegistrationPopup.isDeviceNameUnique" validation="required,maxLengthInBytes[64]"></ndm-input><ndm-input label="devices-list.device-card.blocked.mac" name="deviceMac" model="vm.offlineRegistrationPopup.mac" extra-validator="vm.offlineRegistrationPopup.isDeviceMacUnique" validation="required,mac"></ndm-input><hr class="hr-invisible"><ndm-button on-click="vm.offlineRegistrationPopup.register" btn-class="btn--primary btn--long" is-disabled="vm.offlineRegistrationForm.$invalid" label="devices-list.device-card.not-registered.registration"></ndm-button></form></ndm-popup>'),e.put("app/page/controlPanel/telephony/base/base.html",'<ndm-page class="page-dectBase" label="dect.base.title" description="dect.base.description" progress="vm.progress"><ndm-dect-checker ng-if="vm.ready" no-dect-status="true" on-data-update="vm.onDectCheck"></ndm-dect-checker><form name="vm.form"><ndm-toggle label-on="dect.base.form.enable" label-off="dect.base.form.enable" description="vm.baseState" model="vm.baseData.enable" call-on-change="vm.onToggle" name="enable"></ndm-toggle><ndm-input max-length="4" class-name="ndm-input-s" label="dect.base.form.pin" model="vm.baseData.pin" validation="required" extra-validator="vm.isValidPin" name="pin"></ndm-input><ndm-input max-length="2" label="dect.base.form.offHookTimer" model="vm.baseData.offHookTimer" unit-text="time.second" placeholder="0…10" validation="required,range[1..10]" name="offHookTimer"></ndm-input><ndm-input max-length="2" label="dect.base.form.dialDigitTimer" model="vm.baseData.dialDigitTimer" validation="required,range[1..10]" placeholder="0…10" unit-text="time.second" name="dialDigitTimer"></ndm-input><ndm-form-header label="dect.handsets.title" sub-title="dect.handsets.description" hr="hr-light-blue"></ndm-form-header><div class="page-dectBase-handsetsTable"><ndm-table ng-if="vm.table.dataLoaded && vm.table.data.length > 0" data="vm.table.data" columns="vm.table.columns" sort-name="id" sort-reverse="false" sortable="false" click-on-row="vm.HSEditor.show" click-on-cell="vm.table.onCellClick"></ndm-table><div ng-if="vm.table.data.length === 0" class="empty-list"><span ng-if="!vm.table.dataLoaded" data-translate="">loading</span> <span ng-if="vm.table.dataLoaded && vm.table.data.length === 0" data-translate="">dect.handsets.no-handsets</span></div></div> <div class="buttons-row"><ndm-button button-name="registerHS" class="buttons-row__item" ng-if="!vm.isInRegistration" ng-click="vm.isBasePlugged && vm.baseData.enable && vm.preRegisterHS()" is-disabled="!vm.isBasePlugged || !vm.baseData.enable" label="dect.handsets.add-handset"></ndm-button><ndm-button button-name="stopRegisterHS" class="buttons-row__item" ng-if="vm.isInRegistration" ng-click="vm.stopRegistration()" label="dect.handsets.stop-registration"></ndm-button><ndm-button button-name="startPaging" class="buttons-row__item" ng-if="!vm.isPaging" ng-click="vm.isBasePlugged && vm.baseData.enable && vm.table.data.length && vm.startPaging()" is-disabled="!vm.isBasePlugged || !vm.table.data.length" label="dect.handsets.start-paging"></ndm-button><ndm-button button-name="stopPaging" class="buttons-row__item" ng-if="vm.isPaging" ng-click="vm.stopPaging()" label="dect.handsets.stop-paging"></ndm-button></div><ndm-form-header hr="hr-light-blue" label="dect.base.form.log.title"></ndm-form-header><ndm-checkbox label="dect.base.form.log.store" name="storeLog" model="vm.baseData.isStoreLog"></ndm-checkbox><ndm-details toggle-var="vm.baseData.isStoreLog"><div ng-form="vm.form.logDir" ng-if="vm.baseData.isStoreLog"><ndm-fs-select class="page-dectBase__log-dir-input" ng-model="vm.baseData.callHistoryDirectory" btn-label="dect.base.form.log.callHistoryDirectoryBtn" removable-only="true" select-folder="true" name="callHistoryDirectory" required="true" label="dect.base.form.log.callHistoryDirectory"></ndm-fs-select></div></ndm-details><ndm-checkbox label="dect.base.form.log.handsetEdit" model="vm.baseData.handsetCallHistoryEdit" class="call-history-edit" name="handsetCallHistoryEdit"></ndm-checkbox><ndm-checkbox label="dect.base.form.phonebook.handsetEdit" model="vm.baseData.handsetPhoneBookEdit" class="phone-book-edit" name="handsetPhoneBookEdit"></ndm-checkbox><ndm-input class-name="ndm-input-s" label="dect.base.form.log.length" model="vm.baseData.callHistoryLength" placeholder="2…8000" validation="required,numeric,range[2..8000]" name="callHistoryLength"></ndm-input><ndm-selectbox label="dect.base.form.phonebook.lastNameFirst" value="vm.baseData.phoneBookLastNameFirst" options="[ {id: \'false\', label: \'dect.base.form.phonebook.firstNameFirstOption\'}, {id: \'true\', label: \'dect.base.form.phonebook.lastNameFirstOption\'} ]" name="phoneBookLastNameFirst"></ndm-selectbox><ndm-form-header hr="hr-light-blue" label="dect.base.form.parallel.title"></ndm-form-header><ndm-checkbox label="dect.base.form.parallel.enable" name="enableParallel" model="vm.baseData.parallelEnable"></ndm-checkbox><ndm-details toggle-var="vm.baseData.parallelEnable" class="page-dectBase__parallel-calls-settings"><ndm-input class-name="page-dectBase__merged-parallel-calls-input" max-length="3" label="{{vm.l10n.parallelReplaceLabel}}" model="vm.baseData.parallelReplace" validation="length[0..3]" extra-validator="vm.isValidSequence" name="parallelToggle"><ndm-help><span ng-bind-html="vm.l10n.parallelReplaceBaloon"></span></ndm-help></ndm-input><ndm-input class-name="ndm-input-s" label="dect.base.form.parallel.reject" model="vm.baseData.parallelReject" validation="length[0..3]" extra-validator="vm.isValidSequence" name="parallelReject" hint="dect.base.form.parallel.rejectHelp"></ndm-input><ndm-input class-name="ndm-input-s" label="dect.base.form.parallel.releasePassive" model="vm.baseData.parallelReleasePassive" validation="length[0..3]" extra-validator="vm.isValidSequence" name="parallelReleasePassive" hint="dect.base.form.parallel.releasePassiveHelp"></ndm-input><ndm-input class-name="ndm-input-s" max-length="3" label="dect.base.form.parallel.releaseActive" model="vm.baseData.parallelReleaseActive" validation="length[0..3]" extra-validator="vm.isValidSequence" name="parallelReleaseActive" hint="dect.base.form.parallel.releaseActiveHelp"></ndm-input><ndm-input class-name="ndm-input-s" max-length="3" label="dect.base.form.parallel.transfer" model="vm.baseData.parallelTransfer" validation="length[0..3]" extra-validator="vm.isValidSequence" name="parallelTransfer" hint="dect.base.form.parallel.transferHelp"></ndm-input><ndm-input class-name="ndm-input-s" max-length="3" label="dect.base.form.parallel.intercept" model="vm.baseData.parallelIntercept" validation="length[0..3]" extra-validator="vm.isValidSequence" name="parallelIntercept" hint="dect.base.form.parallel.interceptHelp"></ndm-input><ndm-input class-name="ndm-input-s" max-length="3" label="dect.base.form.parallel.callInternal" model="vm.baseData.parallelCallInternal" validation="length[0..3]" extra-validator="vm.isValidSequence" name="parallelCallInternal" hint="dect.base.form.parallel.callInternalHelp"></ndm-input></ndm-details></form><ndm-control-footer prefix="dectBase" form="vm.form" is-visible="vm.form.modified" is-save-disabled="vm.form.$invalid || !vm.ready" save="vm.saveBaseSettings()"></ndm-control-footer></ndm-page><ndm-alert class="page-dectBase-handsetPreRegistrationPopup" is-visible="vm.preRegistrationPopup.isVisible" hide="vm.preRegistrationPopup.close()" label="dect.handsets.registration-popup.title" sub-title="{{vm.preRegistrationPopup.getDescription()}}"><ndm-button btn-class="btn--primary" button-name="popupStartRegister" ng-click="vm.registerHS(true)" label="dect.handsets.modal-before-registration.confirm"></ndm-button><ndm-button button-name="popupStopPreRegister" ng-click="vm.preRegistrationPopup.close()" label="dect.handsets.modal-before-registration.cancel"></ndm-button></ndm-alert><ndm-alert class="page-dectBase-handsetRegistrationPopup" is-visible="vm.registrationPopup.isVisible" hide="vm.stopRegistration()" label="dect.handsets.registration-popup.title" sub-title="{{vm.registrationPopup.getDescription()}}"><ndm-progress-bar is-visible="vm.registrationPopup.isVisible" count="vm.registrationPopup.progress" loadstatus="{{vm.registrationPopup.getDescription()}}" is-count-hidden="true"></ndm-progress-bar><ndm-button button-name="popupStopRegister" ng-click="vm.stopRegistration()" label="dect.handsets.stop-registration"></ndm-button></ndm-alert><div ng-include="\'app/page/controlPanel/telephony/base/handset.popup.html\'"></div>'),e.put("app/page/controlPanel/telephony/base/handset.popup.html",'<ndm-popup is-visible="vm.HSEditor.isVisible" header-title="dect.handsets.popup.title" close="vm.HSEditor.close" class="page-dectBase-handsetEditorPopup"><form name="vm.HSEditor.form" novalidate=""><ndm-form-header label="dect.handsets.popup.description"></ndm-form-header><div class="relative-container"><ndm-list info-obj="vm.HSEditor.textFieldsList"></ndm-list><button name="startPagingHS" type="button" class="btn" ng-click="vm.isBasePlugged && vm.startPaging(vm.HSEditor.data.ipui)" ng-disabled="!vm.isBasePlugged" ng-if="!vm.isPaging"><span data-translate="">dect.handsets.popup.form.start-paging</span></button> <button name="stopPagingHS" type="button" class="btn" ng-if="vm.isPaging" ng-disabled="!vm.isBasePlugged" ng-click="vm.stopPaging()"><span data-translate="">dect.handsets.popup.form.stop-paging</span></button></div><ndm-input label="dect.handsets.popup.form.name" model="vm.HSEditor.data.name" name="name" validation="required"></ndm-input><ndm-checkbox label="dect.handsets.popup.form.continuous" model="vm.HSEditor.data.continuous" name="continuous"></ndm-checkbox><ndm-form-header hr="hr-light-blue" label="dect.handsets.popup.table.title" sub-title="dect.handsets.popup.table.description"></ndm-form-header><div class="page-dectBase-handsetsTable handset-lines-table"><ndm-table ng-if="!!vm.HSEditor.table.data.length" data="vm.HSEditor.table.data" columns="vm.HSEditor.table.columns" sort-name="id" sort-reverse="false" sortable="false"></ndm-table><div class="empty" ng-if="!vm.HSEditor.table.data.length"><span data-translate="">dect.lines.table.no-lines</span></div></div> <div class="_delete-panel"><hr class="hr-light-blue"><button name="deleteHS" type="button" class="btn btn--long" ng-click="vm.HSEditor.delete()"><span data-translate="">dect.handsets.popup.form.delete-handset</span></button></div><ndm-control-footer prefix="handset" is-visible="vm.HSEditor.form.modified" is-popup="true" is-save-disabled="vm.HSEditor.form.$invalid || vm.HSEditor.form.pending" save="vm.HSEditor.save()" cancel="vm.HSEditor.close()"></ndm-control-footer></form></ndm-popup>'),e.put("app/page/controlPanel/telephony/callHistory/callHistory.html",'<ndm-page class="page-callHistory" label="dect.call-history.title" description="dect.call-history.description" progress="vm.progress"><ndm-dect-checker on-data-update="vm.onDectCheck"></ndm-dect-checker><div class="page-callHistory-table"><ndm-table sortable="false" ng-if="vm.table.data.length > 0" data="vm.table.data" columns="vm.table.columns" sort-name="time" sort-reverse="false"></ndm-table><div ng-if="vm.table.data.length === 0" class="page-callHistory-table__empty"><span ng-if="!vm.table.dataLoaded" data-translate="">loading</span> <span ng-if="vm.table.dataLoaded && vm.table.data.length === 0" data-translate="">dect.call-history.table.no-items</span></div></div><ndm-button on-click="vm.clearAll" label="dect.call-history.buttons.clear-all" is-disabled="!vm.isBasePlugged"></ndm-button><ndm-button on-click="vm.download" is-disabled="!vm.isBasePlugged" label="dect.call-history.buttons.download"></ndm-button></ndm-page>'),e.put("app/page/controlPanel/telephony/lines/line.call-test.html",'<div ng-controller="DectLineCallTestController as vm" ng-init="$parent.DLC.callTestCtrl = vm"><ndm-popup class="dect-line-call-test-popup" is-visible="vm.isVisible" header-title="dect.lines.call-test-popup.title" close="vm.close"><ndm-text text="dect.lines.call-test-popup.description"></ndm-text><form name="vm.form" bs-modifiable="false" novalidate=""><ndm-input label="dect.lines.call-test-popup.phone-number" model="vm.phoneNumber" extra-validator="vm.validators.phoneNumber" validation="required,length[1..100]"><ndm-button is-disabled="vm.ui.isLocked || !vm.phoneNumber || vm.form.$invalid" label="dect.lines.call-test-popup.button.test-number" on-click="vm.testNumber"></ndm-button></ndm-input></form><ndm-table ng-if="vm.table.dataLoaded" data="vm.table.data" columns="vm.table.columns" sortable="false" sort-name="handset" sort-reverse="false"></ndm-table></ndm-popup></div>'),e.put("app/page/controlPanel/telephony/lines/line.editor.html",'<div ng-controller="DectLineEditorController as vm" ng-init="$parent.DLC.editor = vm"><ndm-popup class="dect-line-editor-popup" is-visible="vm.isVisible" header-title="dect.lines.editor-popup.title" close="vm.closePopup" save="vm.save"><form name="vm.form" novalidate=""><ndm-text text="dect.lines.editor-popup.description"></ndm-text><ndm-fieldset is-disabled="vm.ui.isLocked"><ndm-form-header label="dect.lines.editor-popup.section.sip-account"></ndm-form-header><ndm-checkbox label="dect.lines.editor-popup.form.enable-sip-registration" model="vm.model.sipRegistrationIsEnabled" name="enableSipRegistration"></ndm-checkbox><ndm-selectbox disabled="vm.ui.isLocked" label="dect.lines.editor-popup.form.operator-preset" value="vm.model.operatorPreset" options="vm.options.operatorPreset" on-value-change="vm.cbk.applyOperatorPreset" name="operatorPreset"></ndm-selectbox><ndm-input class="line-name-input" label="dect.lines.editor-popup.form.line-name" model="vm.model.name" name="lineName" extra-validator="vm.validators.isLineNameUnique" validation="required,length[0..100]"></ndm-input><ndm-details label-hidden="dect.lines.editor-popup.details.hide-voip-settings" label-visible="dect.lines.editor-popup.details.show-voip-settings" toggle-var="vm.ui.sipSettingsIsVisible" on-toggle="vm.ui.onSipSettingsToggle"><div ng-form="vm.form.sipSettingsSubform"><ndm-input ng-show="vm.model.sipRegistrationIsEnabled" label="dect.lines.editor-popup.form.sip-reg-uri" model="vm.model.regUri" name="sipRegUri" validation="sipUri,length[0..95]"></ndm-input><ndm-input ng-show="vm.model.sipRegistrationIsEnabled" label="dect.lines.editor-popup.form.registration-timeout" model="vm.model.regTimeout" name="regTimeout" validation="required,range[10..3600]"></ndm-input><ndm-input label="dect.lines.editor-popup.form.sip-proxy" model="vm.model.proxy" name="serverProxy" validation="required,domainAndPort,length[0..100]"></ndm-input><ndm-input label="dect.lines.editor-popup.form.sip-domain" model="vm.model.domain" name="sipDomain" validation="required,domainAndPort,length[0..95]"></ndm-input><ndm-selectbox disabled="vm.ui.isLocked" label="dect.lines.editor-popup.form.sip-transport" value="vm.model.transport" options="vm.options.transport" on-value-change="vm.cbk.onSipTransportChange" name="sipTransport"></ndm-selectbox><ndm-selectbox ng-if="vm.model.transport === \'tls\'" disabled="vm.ui.isLocked" label="dect.lines.editor-popup.form.sip-tls-security" value="vm.model.tlsSecurityMode" options="vm.options.tlsSecurityMode" name="sipTlsSecurity"></ndm-selectbox><ndm-selectbox ng-if="vm.model.transport === \'tls\'" disabled="vm.ui.isLocked" label="dect.lines.editor-popup.form.sip-audio-protocol" value="vm.model.audioProtocol" options="vm.options.audioProtocol" name="sipAudioProtocol"></ndm-selectbox><ndm-selectbox disabled="vm.ui.isLocked" label="dect.lines.editor-popup.form.dtmf-mode" value="vm.model.dtmfMode" options="vm.options.dtmfMode" name="dtmfMode"></ndm-selectbox><ndm-checkbox class="lock-single-codec" label="dect.lines.editor-popup.form.lock-single-codec" model="vm.model.lockSingleCodec" name="lockSingleCodec"></ndm-checkbox></div></ndm-details><ndm-input label="dect.lines.editor-popup.form.display-name" model="vm.model.displayName" name="displayName" validation="length[0..20]"></ndm-input><ndm-input label="dect.lines.editor-popup.form.sip-id" model="vm.model.sipId" name="sipId" validation="{{ vm.model.sipRegistrationIsEnabled ? \'sipId,length[0..100]\' : \'required,sipId,length[1..64]\' }}"></ndm-input><ndm-input ng-if="vm.model.sipRegistrationIsEnabled" label="dect.lines.editor-popup.form.login" model="vm.model.login" name="login" validation="required,length[1..64],password"></ndm-input><ndm-input ng-if="vm.model.sipRegistrationIsEnabled" label="password" model="vm.model.password" name="password" password="true" validation="required,password"></ndm-input><ndm-form-header label="dect.lines.editor-popup.section.nat-traversal" hr="hr-light-blue"></ndm-form-header><ndm-checkbox label="dect.lines.editor-popup.form.use-stun" model="vm.model.enableStun" on-change="vm.cbk.onToggleEnableStun()" name="useStun"></ndm-checkbox><ndm-checkbox disabled="vm.model.enableStun" label="dect.lines.editor-popup.form.sdp-nat-rewrite" model="vm.model.sdpNatRewrite" name="sdpNatRewrite"></ndm-checkbox><ndm-input label="dect.lines.editor-popup.form.keepalive" model="vm.model.keepalive" name="keepalive" validation="numeric"></ndm-input><ndm-form-header label="dect.lines.editor-popup.section.codecs-list" sub-title="dect.lines.editor-popup.section.codecs-list-description" hr="hr-light-blue"></ndm-form-header><div class="codec-table-wrapper"><ndm-table columns="vm.codecsTable.columns" draggable="true" sort-name="id" click-on-cell="vm.codecsTable.onCellClick" on-drag-end="vm.codecsTable.onDragEnd" data="vm.model.codecsList"></ndm-table></div><ndm-form-header label="{{ vm.multipleLinesExist ? \'dect.lines.editor-popup.section.priority-and-dial-rules\' : \'dect.lines.editor-popup.section.dial-rules\' }}"></ndm-form-header><ndm-selectbox ng-if="vm.multipleLinesExist" disabled="vm.ui.isLocked" label="dect.lines.editor-popup.form.line-priority" value="vm.model.priority" options="vm.options.priority" name="linePriority"></ndm-selectbox><ndm-selectbox disabled="vm.ui.isLocked" label="dect.lines.editor-popup.form.line-selection-id" value="vm.model.selectionId" options="vm.options.selectionId" name="selectionId"></ndm-selectbox><ndm-input class-name="ndm-input-l" label="dect.lines.editor-popup.form.digitmap" model="vm.model.digitmap" name="digitmap" on-change="vm.postValidator.digitmap.resetError" error-from-controller="vm.postValidator.digitmap.error" extra-validator="vm.validators.digitmap" validation="length[0..250]" max-length="250"></ndm-input><ndm-input class-name="ndm-input-l" label="dect.lines.editor-popup.form.prefix-substitution-rule" model="vm.model.substitute" name="substitute" on-change="vm.postValidator.substitute.resetError" error-from-controller="vm.postValidator.substitute.error" extra-validator="vm.validators.substitute" validation="length[0..100]"></ndm-input><ndm-form-header label="dect.lines.editor-popup.section.call-forwarding" hr="hr-light-blue"></ndm-form-header><ndm-checkbox label="dect.lines.editor-popup.form.forward-calls-always" name="forwardAlways" on-change="vm.cbk.onToggleForwardAlways()" model="vm.model.forwardAlways"></ndm-checkbox><ndm-sub-form ng-if="vm.model.forwardAlways"><ndm-input label="dect.lines.editor-popup.form.to-number" model="vm.model.forwardAlwaysNumber" name="forwardAlwaysNumber" validation="required,sipId"></ndm-input></ndm-sub-form><ndm-checkbox disabled="vm.model.forwardAlways" label="dect.lines.editor-popup.form.forward-calls-if-busy" name="forwardIfBusy" model="vm.model.forwardIfBusy"></ndm-checkbox><ndm-sub-form ng-if="vm.model.forwardIfBusy"><ndm-input disabled="vm.model.forwardAlways" label="dect.lines.editor-popup.form.to-number" model="vm.model.forwardIfBusyNumber" name="forwardIfBusyNumber" validation="required,sipId"></ndm-input></ndm-sub-form><ndm-checkbox disabled="vm.model.forwardAlways" label="dect.lines.editor-popup.form.forward-calls-by-timeout" name="forwardByTimeout" model="vm.model.forwardByTimeout"></ndm-checkbox><ndm-sub-form ng-if="vm.model.forwardByTimeout"><ndm-input disabled="vm.model.forwardAlways" label="dect.lines.editor-popup.form.to-number" model="vm.model.forwardByTimeoutNumber" name="forwardByTimeoutNumber" validation="required,sipId"></ndm-input><ndm-input disabled="vm.model.forwardAlways" label="dect.lines.editor-popup.form.after-x-seconds" model="vm.model.forwardByTimeoutTimeout" name="forwardByTimeoutTimeout" unit-text="time.second" placeholder="1…60" validation="required,range[1..60]"></ndm-input></ndm-sub-form><ndm-checkbox label="dect.lines.editor-popup.form.do-not-disturb" name="dnd" model="vm.model.doNotDisturb"></ndm-checkbox><hr class="hr-light-blue"><ndm-button ng-if="!vm.model.isNew" is-disabled="vm.ui.isLocked" btn-class="btn--long" ng-click="vm.deleteLine()" label="dect.lines.button.delete-line"></ndm-button><br><br></ndm-fieldset></form><ndm-control-footer prefix="dectLine" is-visible="vm.ui.isReady && (vm.model.isNew || vm.form.modified || vm.codecsOrderChanged)" is-popup="true" is-save-disabled="vm.form.$invalid || vm.ui.isLocked" save="vm.save()" cancel="vm.cancel()"></ndm-control-footer></ndm-popup></div>'),e.put("app/page/controlPanel/telephony/lines/lines.html",'<ndm-page class="page-dectLines" label="dect.lines.title" description="dect.lines.description" progress="DLC.progress"><ndm-dect-checker on-data-update="DLC.onDectCheck" no-dect-status="DLC.dectIsRestarting" interval="2000"></ndm-dect-checker><br><div class="dect-lines-list"><ndm-table ng-if="DLC.table.dataLoaded && DLC.table.data.length > 0" data="DLC.table.data" columns="DLC.table.columns" draggable="true" track-by-prop="name" on-drag-end="DLC.table.onDragEnd" click-on-cell="DLC.table.onToggleCellClick" click-on-row="DLC.table.onRowClick"></ndm-table><div ng-if="!DLC.table.dataLoaded || DLC.table.data.length === 0" class="empty"><span ng-if="!DLC.table.dataLoaded" data-translate="">loading</span> <span ng-if="DLC.table.dataLoaded && DLC.table.data.length === 0" data-translate="">dect.lines.table.no-lines</span></div></div> <div ng-include="\'app/page/controlPanel/telephony/lines/line.editor.html\'"></div> <div ng-include="\'app/page/controlPanel/telephony/lines/line.call-test.html\'"></div><ndm-button is-disabled="DLC.ui.locked" on-click="DLC.addNewLine" label="dect.lines.button.add-line"></ndm-button><ndm-button is-disabled="DLC.ui.locked || DLC.ui.callTestIsDisabled || DLC.dectIsRestarting" on-click="DLC.testCall" label="dect.lines.button.call-test"></ndm-button><form name="DLC.form"><ndm-form-header hr="hr-light-blue" label="dect.lines.form.sip.title"></ndm-form-header><ndm-input label="dect.lines.form.sip.agent" model="DLC.sip.agent" validation="required,ascii,length[0..100]" name="agent"></ndm-input><ndm-input label="dect.lines.form.sip.localUdpPort" model="DLC.sip.localUdpPort" validation="required,numeric,portNumber" name="localUdpPort"></ndm-input><ndm-input label="dect.lines.form.sip.localTcpPort" model="DLC.sip.localTcpPort" validation="required,numeric,portNumber" name="localTcpPort"></ndm-input><ndm-input label="dect.lines.form.sip.localTlsPort" model="DLC.sip.localTlsPort" validation="required,numeric,portNumber" name="localTlsPort"></ndm-input><ndm-ports-range name-from="rtpFromPort" name-to="rtpToPort" model-from="DLC.sip.rtpFromPort" model-to="DLC.sip.rtpToPort" mode="1" range-title="dect.lines.form.sip.rtpPortsRange"></ndm-ports-range><ndm-input label="dect.lines.form.sip.stunServer" model="DLC.sip.stunServer" validation="required,domainAndPort,length[1..100]" name="stunServer"></ndm-input><ndm-checkbox label="dect.lines.form.sip.unescapeHash" model="DLC.sip.unescapeHash" name="unescapeHash"></ndm-checkbox></form><ndm-control-footer prefix="dectLines" form="DLC.form" is-visible="DLC.form.modified && !DLC.ui.locked" is-save-disabled="DLC.form.$invalid || DLC.ui.locked" save="DLC.saveSipSettings()"></ndm-control-footer></ndm-page>'),e.put("app/page/controlPanel/apps/usbDeviceList/printerPopup/printerPopup.apps.html",'<div ng-controller="PrinterPopupAppsController as PPAC" ng-init="vm.printerPopupController = PPAC"><ndm-popup class="page-apps__printer-popup" is-visible="PPAC.isVisible" header-title="apps.printer-settings-popup.title" close="PPAC.close" save="PPAC.save"><form name="PPAC.form" novalidate=""><ndm-form-header label="apps.popups.base-settings"></ndm-form-header><ndm-input label="apps.printer-settings-popup.name" model="PPAC.model.name" name="name" validation="required"></ndm-input><ndm-radio model="PPAC.model.connectionType" array="PPAC.connectionTypes" name="connectionType" label="apps.printer-settings-popup.connection-type.label"></ndm-radio><ndm-sub-form ng-if="PPAC.model.connectionType === \'direct\'"><ndm-input name="port" model="PPAC.model.port" validation="required,range[1024..65535]" label="apps.printer-settings-popup.port"></ndm-input></ndm-sub-form><ndm-checkbox name="bidirectional" model="PPAC.model.bidirectional" label="apps.printer-settings-popup.bidirectional"></ndm-checkbox><ndm-checkbox name="disableStatusPolling" model="PPAC.model.disableStatusPolling" label="apps.printer-settings-popup.disable-status-polling"></ndm-checkbox><hr class="hr-invisible"><ndm-details label-visible="apps.printer-settings-popup.firmware.accordion-link" label-hidden="apps.printer-settings-popup.firmware.accordion-link" toggle-var="PPAC.model.showFirmwareSection"><ndm-text text="apps.printer-settings-popup.firmware.description"></ndm-text><ndm-fs-select ng-model="PPAC.model.firmware" file-select="true" name="firmwareValue" label="apps.printer-settings-popup.firmware.label" header="apps.printer-settings-popup.firmware.label"></ndm-fs-select></ndm-details><ndm-control-footer ng-if="PPAC.isVisible" prefix="printerPopup" is-popup="true" is-visible="PPAC.form.modified" is-save-disabled="PPAC.form.$invalid || PPAC.form.$pending" save="PPAC.save()" cancel="PPAC.form.reset && PPAC.close"></ndm-control-footer></form></ndm-popup></div>'),e.put("app/page/controlPanel/control/system/buttonsAndLeds/buttonsAndLeds.html",'<div ng-controller="ButtonsAndLedsController as vm" ng-init="system.subcontroller.register(vm, \'BUTTONS_AND_LEDS\')" class="system__buttons-and-leds-section"><div ng-if="vm.isReady" ng-form="vm.buttonsForm"><ndm-form-header hr="hr-light-blue" label="{{ ::(vm.ledCtrlAvailable ? \'system.buttons-and-leds.title-leds\' : \'system.buttons-and-leds.title\' ) }}"></ndm-form-header><ndm-text text="system.buttons-and-leds.sub-title"><br><a tabindex="0" class="body-text" ng-keydown="vm.onKeydown($event)" ng-class="{ \'action-link\': !vm.configurationIsDefault, \'action-link--disabled\': system.ui.isLocked }" ng-click="vm.resetToDefaults()">{{ ( vm.configurationIsDefault ? \'system.buttons-and-leds.ui.default-values-selected\' : ( vm.ledCtrlAvailable ? \'system.buttons-and-leds.ui.reset-btns-and-leds-link\' : \'system.buttons-and-leds.ui.reset-btns-link\' ) ) | translate }}</a></ndm-text><div class="list__buttons-bindings body-text"><div ng-repeat="group in vm.buttonGroups" class="list__group group"><ndm-form-title class="group__header" label="{{\'system.buttons-and-leds.buttons.button-name.\' + group[0].button}}"></ndm-form-title><div ng-repeat="item in group" class="group__body"><ndm-selectbox ng-if="item.buttonHandlers" class="binding-selectbox binding-selectbox--{{item.button}}" disabled="item.button === \'RESET\' || system.ui.isLocked" name="{{item.button}}__{{item.action}}__{{item.value}}" label="{{vm.l10n.actions[item.action]}}" on-value-change="vm.onBtnHandlerSelect" value="item.value" options="item.buttonHandlers"></ndm-selectbox></div></div></div></div><div ng-if="::vm.ledCtrlAvailable" ng-form="vm.ledsForm"><div ng-if="vm.isReady" class="list list__buttons-bindings body-text"><div class="list__group group" ng-repeat="led in vm.leds"><ndm-form-title class="group__header" label="{{\'system.buttons-and-leds.leds.led\' | translate}} {{led.label}}"></ndm-form-title><div class="group__body"><ndm-selectbox class="binding-selectbox" name="leds__{{led.id}}" disabled="system.ui.isLocked" label="system.buttons-and-leds.leds.selectbox-label" value="led.value" on-change="vm.onLedControlSelect(led.id)" options="led.options"></ndm-selectbox></div></div></div></div></div>'),e.put("app/page/controlPanel/control/system/cloudcontrol/cloudcontrol.html",'<div ng-controller="CloudcontrolController as vm" ng-init="system.subcontroller.register(vm, \'CLOUDCONTROL\')" class="system__cloudcontrol-section"><div ng-if="vm.isReady"><ndm-form-header label="system.cloudcontrol.title"></ndm-form-header><ndm-text text="{{vm.l10n.description}}"></ndm-text><div class="cloudcontrol__toggle"><ndm-toggle class="help-text" label-on="system.cloudcontrol.on" label-off="system.cloudcontrol.off" call-on-change="vm.onToggleCloudcontrol" name="cloudcontrolService" model="vm.cloudcontrolIsEnabled"></ndm-toggle></div><ndm-input class="cloudcontrol__cid-input" disabled="true" name="cid" title-on-top="true" label="system.cloudcontrol.cid-label" model="vm.cid"><a tabindex="0" class="action-link cloudcontrol__cid-link" ng-class="{\'cloudcontrol__cid-link--copied\': vm.cidLinkIsCopied}" ng-click="vm.copyCidToClipboard()" data-translate="">{{\'system.cloudcontrol.\' + (vm.cidLinkIsCopied ? \'cid-link-copied\' : \'copy-cid-link\')}}</a></ndm-input></div></div>'),e.put("app/page/controlPanel/control/system/components/components.html",'<div ng-controller="ComponentsController as vm" ng-init="system.subcontroller.register(vm, \'FW_AND_COMPONENTS\')" class="system__components-section components-section"><div ng-if="vm.isReady"><ndm-form-header label="system.components.fw-updates-header"></ndm-form-header><div class="components-section__current-version"><span>{{ \'system.components.current-fw-version\' | translate }}</span> <a class="components-section__current-version-title" ng-class="{ \'external-link\': vm.currentVersionReleaseNotes }" target="_blank" ng-href="{{vm.currentVersionReleaseNotes}}">{{vm.currentFirmwareVersionTitle}}</a></div><br><div class="bold-label" data-translate="">system.components.auto-update.channel</div><ndm-selectbox-with-details bs-modifiable="0" name="sandbox" label="" value="vm.currentAutoUpdateChannel" options="vm.autoUpdateChannels" is-disabled="vm.ui.isLocked" on-change="vm.onAutoUpdateChannelChange"><div ng-if="vm.availableNdmsVersion && !vm.componentsListInProcess" class="firmware-update"><ndm-button is-disabled="system.ui.isLocked" label="system.components.ui.update-firmware-btn" on-click="vm.updateFirmware"></ndm-button><div class="firmware-update-info"><div ng-if="!vm.availableNdmsVersionDate">{{ \'system.components.fw-without-date-update-text\' | translate : {version: vm.availableNdmsVersionTitle} }}</div> <div ng-if="vm.availableNdmsVersionDate">{{ \'system.components.fw-update-text\' | translate : {version: vm.availableNdmsVersionTitle, releaseDate: vm.availableNdmsVersionDate} }}</div><ndm-webhelp-release-notes ng-hide="!vm.availableNdmsVersionHasReleaseData" ndm-version="vm.availableNdmsVersion"></ndm-webhelp-release-notes></div></div> <div ng-if="vm.componentsListInProcess" class="firmware-update-check"><i class="icon icon--load"></i> <span data-translate="">system.components.checking-fw-updates</span></div> <div ng-if="!vm.availableNdmsVersion && !vm.componentsListInProcess" class="no-firmware-updates"><span ng-if="!vm.noNdssConnection" data-translate="">system.components.status.no-updates-available</span> <span ng-if="vm.noNdssConnection" data-translate="">system.components.status.connecting</span></div></ndm-selectbox-with-details><div class="components-section__auto-update-settings"><div class="bold-label" data-translate="">system.components.auto-update.toggle-label</div> <div class="components-section__auto-update-toggle-container"><ndm-toggle class="help-text" ng-if="::vm.canAutoUpdateFirmware" label-on="system.components.auto-update.on" label-off="system.components.auto-update.off" model="vm.autoUpdate.state" call-on-change="vm.autoUpdate.toggleState"></ndm-toggle></div> <div class="components-section__auto-update-schedule" ng-if="vm.autoUpdate.state" ng-form="vm.autoUpdateScheduleForm"><ndm-schedule-select name="autoUpdateSchedule" model="vm.autoUpdate.schedule" no-selected-thumb="true" label="system.components.auto-update.schedule.dropdown-label" no-schedule-label="system.components.auto-update.schedule.no-schedule-option"></ndm-schedule-select></div></div> <div class="bold-label" data-translate="">system.components.components-header</div> <div class="body-text" data-translate="">system.components.components-description</div><ndm-button class="components-section__components-popup-btn" btn-class="buttons-row__button buttons-row__button--full-width" is-disabled="system.ui.isLocked" label="{{\'system.components.ui.\' + (vm.noNdssConnection ? \'show-components-btn\' : \'change-components-btn\')}}" ng-disabled="system.ui.isLocked" ui-sref="controlPanel.system.components"></ndm-button></div> <div ng-include="\'app/page/controlPanel/control/system/components/components.popup.html\'"></div><ndm-alert is-visible="vm.alert.isVisible" class="alert system__update-components-alert" label="system.components.alert.title" sub-title="system.components.alert.sub-title" is-close-button-hidden="true"><ndm-progress-bar is-visible="true" count="vm.alert.progress" load-status="vm.alert.status"></ndm-progress-bar></ndm-alert></div>'),e.put("app/page/controlPanel/control/system/components/components.popup.html",'<ndm-popup class="system__components-popup" is-visible="vm.popup.isVisible" header-title="system.components.popup.header" close="vm.popup.close" header-hint="{{ \'system.components.popup.list-hint\' | translate }}"><div ng-if="vm.popup.isVisible" ng-form="vm.form"><ndm-text text="{{\'system.components.popup.components-form.\' + (vm.noNdssConnection ? \'no-connect-description\' : \'description\')}}"></ndm-text><div class="system__components-popup__components-set-buttons"><button ng-disabled="vm.noNdssConnection" class="btn ndm-button btn--long system__components-popup__change-components-set-btn" ng-click="vm.ui.isLocked || vm.componentsSetIsRecommendedSet ? vm.resetComponents() : vm.selectOnlyRecommendedComponents()" type="button" ng-class="{ \'btn--primary\': vm.componentsSetIsRecommendedSet, \'btn--disabled\': vm.ui.isLocked }" data-translate="">system.components.popup.components-form.ui.select-recommended-set</button> &nbsp; <button ng-disabled="vm.noNdssConnection" class="btn ndm-button btn--long system__components-popup__change-components-set-btn" ng-click="vm.ui.isLocked || vm.componentsSetIsMinimalSet ? vm.resetComponents() : vm.selectOnlyMinimalComponents()" type="button" ng-class="{ \'btn--primary\': vm.componentsSetIsMinimalSet, \'btn--disabled\': vm.ui.isLocked }" data-translate="">system.components.popup.components-form.ui.select-minimal-set</button></div><ndm-text text="system.components.popup.components-filter-description"></ndm-text><ndm-input-filter name="ssidFilter" is-disabled="vm.ui.isLocked" value="vm.componentNameFilter" on-change="vm.filterComponents"></ndm-input-filter><div ng-if="!vm.noNdssConnection && vm.currentFirmwareVersion !== vm.versionToInstall" class="system__components-popup__version-change-warning" data-translate="">system.components.popup.components-form.version-change-on-commit-warning</div><ndm-fieldset class-name="components-list" is-disabled="vm.ui.isLocked"><ndm-text ng-if="vm.noMatchingComponents" text="system.components.popup.no-matching-components"></ndm-text><div ng-repeat="group in vm.componentGroups" ng-show="group.hasMatches" class="components-group"><div class="components-group__header"><div class="components-group__header-wrapper"><span class="components-group__header-title">{{group.description[vm.selectedLanguage] || group.description.EN}}</span> <span ng-if="group.details" class="components-group__header-details">{{group.details[vm.selectedLanguage] || group.details.EN}}</span></div></div> <div class="components-group__items" ng-form="vm.form[\'{{group.name}}\']"><div ng-if="!vm.noNdssConnection || component.installedVersion || component.isUnremovable" ng-hide="component.isInvisible || component.isNotMatchingFilter" ng-repeat="component in vm.components[group.name]" class="component" ng-class="{ \'component--expanded\': component.bodyIsVisible, \'component--no-details\': component.hasNoDetails }" ng-click="component.bodyIsVisible = !component.bodyIsVisible;"><div class="component__header"><div class="component__header-expand-icon"><i ng-if="!component.hasNoDetails" class="component__selected-icon icon icon--dropdown-arrow"></i></div> <div class="component__header-controls"><span class="component__title" ndm-html-compile="vm.componentNameFilter ? component.matchedTitle : (component.description[vm.selectedLanguage] || component.description.EN)"></span> <div ng-if="!vm.noNdssConnection" class="component__checkbox-container"><span class="component__state component__state--{{component.state.color}}" data-translate="">{{\'system.components.popup.components-form.component-status.\' + component.state.name}}</span> <div class="checkbox"><input type="checkbox" ng-attr-id="{{\'component__\' + component.name}}" class="checkbox__input" name="{{component.name}}" ng-click="vm.onCheckboxClick(component, group)" ng-disabled="component.isRequired || component.isUnremovable || vm.componentsListIsLoading || (!component.isIncluded && group.limitReached)" ng-model="component.isIncluded" ng-value="component.isIncluded"> <label ng-attr-for="{{\'component__\' + component.name}}" class="checkbox__label"></label></div></div></div></div> <div ng-if="component.bodyIsVisible && !component.hasNoDetails" class="component__body"><div class="component-details"><p class="component-details__text help-text" ng-bind-html="component.details[vm.selectedLanguage] || component.details.EN"></p><ndm-button btn-class="component-details__btn" ng-if="!vm.noNdssConnection && !component.isUnremovable" label="{{\'system.components.popup.components-form.ui.\' + (component.isIncluded ? \'uninstall-component-btn\' : \'install-component-btn\')}}" is-disabled="component.isRequired" ng-click="vm.onDetailsBtnClick($event, component, group)"></ndm-button></div> <div ng-if="component.isDependencyOf.length > 0 || component.conflictsWith.length > 0" class="components-details-flex"><ndm-details ng-if="component.isDependencyOf.length > 0" ng-click="$event.stopPropagation();" label-hidden="system.components.popup.components-form.ui.hide-dependent-components" label-visible="system.components.popup.components-form.ui.show-dependent-components" link-class="component__connections-toggle-link" transclude-class="component__connections"><div class="component-connections-list"><ul><li ng-repeat="dep in component.isDependencyOf" class="component-connections-list__item help-text">- {{vm.allComponents[dep].description[vm.selectedLanguage]}}</li></ul></div></ndm-details><ndm-details ng-if="component.conflictsWith.length > 0" ng-click="$event.stopPropagation();" label-hidden="system.components.popup.components-form.ui.hide-conflicting-components" label-visible="system.components.popup.components-form.ui.show-conflicting-components" link-class="component__connections-toggle-link" transclude-class="component__connections"><div class="component-connections-list"><ul><li ng-repeat="conf in component.conflictsWith" class="component-connections-list__item help-text">{{vm.allComponents[conf].description[vm.selectedLanguage]}}</li></ul></div></ndm-details></div></div></div></div></div></ndm-fieldset></div><hr class="hr-invisible"><ndm-control-footer class="system__components-popup__footer" prefix="components" is-visible="vm.form.modified || vm.sandbox !== vm.localSandbox || vm.checkComponentsChanged()" save-label="{{ (vm.sandbox !== vm.localSandbox || vm.checkComponentsChanged()) ? \'system.components.ui.update-firmware-btn\' : \'save\' }}" is-popup="true" is-save-disabled="vm.ui.isLocked" cancel-label="{{vm.form.modified ? \'cancel\' : \'close\'}}" save="vm.updateComponents()" cancel="vm.popup.close()"></ndm-control-footer><div class="popup-end"></div></ndm-popup>'),e.put("app/page/controlPanel/control/system/credits/credits.html",'<div ng-controller="CreditsSectionController as vm" ng-init="system.subcontroller.register(vm, \'CREDITS\')" class="system__credits-section"><ndm-form-header hr="hr-light-blue" label="system.credits.header"></ndm-form-header><span ndm-html-compile="vm.eulaModalLink"></span><br><div ng-if="vm.isDpnAvailable"><span ndm-html-compile="vm.dpnModalLink"></span><br></div> <span ndm-html-compile="vm.creditsPageLink"></span></div>'),e.put("app/page/controlPanel/control/system/diagnosticReports/diagnostic-reports.html",'<div ng-controller="DiagnosticReportsController as vm" ng-init="system.subcontroller.register(vm, \'DIAGNOSTIC_REPORTS\')" class="diagnostic-reports"><div ng-if="vm.isReady"><ndm-form-header hr="hr-light-blue" label="system.diagnostic-reports.header"></ndm-form-header><span class="body-text" data-translate="">system.diagnostic-reports.description</span> <div class="diagnostic-reports__toggle"><ndm-toggle class="help-text" name="trafficService" label-on="system.diagnostic-reports.enabled" label-off="system.diagnostic-reports.disabled" call-on-change="vm.toggleReportsState" model="vm.areReportsEnabled"></ndm-toggle></div></div></div>'),e.put("app/page/controlPanel/control/system/reboot/reboot.html",'<div ng-controller="RebootController as vm" ng-init="system.subcontroller.register(vm, \'REBOOT\')" class="system__reboot-section"><ndm-form-header hr="hr-light-blue" label="system.reboot.header" sub-title="system.reboot.description"></ndm-form-header><ndm-button class="buttons-row__button--full-width" is-disabled="system.ui.isLocked" ng-click="!system.ui.isLocked && vm.alert.open(\'system.reboot.alert\', vm.rebootDevice)" label="system.reboot.button"></ndm-button><ndm-text text="system.reset-to-default.description"></ndm-text><ndm-button class="buttons-row__button--full-width" is-disabled="system.ui.isLocked" ng-click="!system.ui.isLocked && vm.alert.open(\'system.reset-to-default.alert\', vm.resetDeviceToFactorySettings, vm.confirmationText)" label="system.reset-to-default.button"></ndm-button><ndm-alert ng-cloak="" is-visible="vm.alert.isVisible" class="alert system__reboot-section-alert" is-close-button-hidden="vm.alert.isProgressBarVisible" label="{{vm.alert.title}}" sub-title="{{vm.alert.subTitle}}" hide="vm.alert.close()"><ndm-key-press ng-if="vm.alert.isVisible && !vm.alert.isProgressBarVisible" action-on="[\'escape\', \'enter\']" call-func="[vm.alert.close, vm.alert.onSubmit]"></ndm-key-press><ndm-progress-bar is-visible="vm.alert.isProgressBarVisible" count="vm.alert.progress"></ndm-progress-bar><form name="vm.confirmationForm" class="confirmation-alert__form"><ndm-input ng-if="vm.alert.confirmationRequired && !vm.alert.isProgressBarVisible" bs-modifiable="false" model="vm.alert.currentConfirmationText" label="system.reset-to-default.alert.confirmation-input-label" placeholder="{{vm.alert.confirmationPlaceholder}}" extra-validator="vm.alert.checkConfirmationText" validation="required"></ndm-input></form><div ng-if="!vm.alert.isProgressBarVisible" class="alert__controls"><ndm-button class="alert__submit-btn" is-disabled="vm.alert.confirmationRequired && !vm.alert.confirmationIsValid" btn-class="{{vm.alert.btnClass}}" on-click="vm.alert.onSubmit" label="{{vm.alert.confirmBtnLabel}}"></ndm-button><a tabindex="0" class="action-link" ng-click="vm.alert.close()" data-translate="">cancel</a></div></ndm-alert></div>'),e.put("app/page/controlPanel/control/system/switchports/switchports.html",'<div ng-controller="SwitchportsController as vm" ng-init="system.subcontroller.register(vm, \'SWITCHPORTS\')" class="system__switchports-section"><div ng-if="vm.isReady"><ndm-form-header hr="hr-light-blue" label="system.switchports.title"></ndm-form-header><div ng-form="vm.form" class="device-switchports"><div class="device-switchports__wrapper"><ndm-switchport-container><ndm-switchport ng-repeat="port in vm.ports" is-combo="port.isCombo" is-sfp="port.isSfp" is-reversed="port.isReversed" is-blue="port.isBlue" label="port.name" role="port.icon"><div class="switchport-configuration" ng-class="{ \'switchport-configuration--combo\': port.isCombo }"><ndm-switchport-select ng-if="!port.isNotConfigurable" is-disabled="system.ui.isLocked" name="switchports__{{port.name}}" value="port.configValue" options="vm.portModeOptions"></ndm-switchport-select></div></ndm-switchport></ndm-switchport-container></div></div></div></div>'),e.put("app/page/controlPanel/control/system/sysmode/sysmode.html",'<div ng-controller="SysmodeController as vm" ng-init="system.subcontroller.register(vm, \'SYSMODE\')" class="system__sysmode-section"><div ng-if="vm.isReady"><ndm-form-header hr="hr-light-blue" label="system.sysmode.header"></ndm-form-header><div class="form__cell" ndm-html-compile="vm.currentModeStr"></div><ndm-button ng-if="!vm.isHardwareSwitchDevice" ndm-disabled-by-mws-tooltip="@" is-disabled="system.ui.isLocked || NDM.DEVICE_IS_MWS_MEMBER" on-click="vm.openSysModePopup" label="system.sysmode.switch-mode-button"></ndm-button><ndm-text ng-if="vm.isHardwareSwitchDevice" text="system.sysmode.use-hardware-switch-to-switch-mode"></ndm-text></div><ndm-popup class="system__sysmode-section-popup" is-visible="vm.popup.isVisible" header-title="system.sysmode.header" close="vm.popup.close"><ndm-text text="{{ vm.isTwoModeDevice ? \'system.sysmode.two-mode-device.description\' : \'system.sysmode.description\' }}"></ndm-text><div ng-form="vm.form"><div class="sysmode-list"><div class="sysmode-list__item" ng-repeat="mode in vm.supportedModes"><div class="form__row"><div class="form__cell form__cell--checkbox"><div class="radiobutton"><input type="radio" name="sysmode" id="sysmode_{{mode}}" class="radiobutton__input" value="{{mode}}" ng-model="vm.newMode"> <label for="sysmode_{{mode}}" class="radiobutton__label"><b>{{vm.l10n.titles[mode]}}</b> <span ng-if="vm.l10n.subtitles[mode].length">({{vm.l10n.subtitles[mode]}})</span></label></div></div></div> <div class="sysmode-list__item-icon"><div class="sysmode-icon sysmode-icon--{{mode}}"></div></div> <div class="sysmode-list__item-description">{{vm.l10n.descriptions[mode]}}</div></div></div></div><ndm-control-footer prefix="systemMode" is-visible="vm.form.modified" is-popup="true" save="vm.popup.showConfirmModeSwitchAlert()" cancel="vm.popup.close()"></ndm-control-footer><hr class="popup-end"></ndm-popup><ndm-alert is-visible="vm.alert.isVisible" is-close-button-hidden="false" label="system.sysmode.alert.title" sub-title="{{vm.alert.subTitle}}" class="alert system__confirm-sysmode-switch-alert" hide="vm.alert.close()"><div class="alert-controls"><ndm-button btn-class="btn--primary" ng-click="vm.switchMode()" label="system.sysmode.alert.yes"></ndm-button><a class="alert-controls__cancel action-link" ng-click="vm.alert.close()" data-translate="">system.sysmode.alert.no</a></div></ndm-alert><ndm-alert is-visible="vm.modeSwitchAlert.isVisible" is-full-screen="vm.modeSwitchAlert.isVisible" is-close-button-hidden="true" class="alert system__sysmode-switch-alert" label="{{ (vm.modeSwitchAlert.isSwitchFinished ? \'system.sysmode.finish-notice-alert.title\' : \'system.sysmode.finish-notice-alert.title-in-process\') | translate }}"><ndm-progress-bar is-visible="vm.modeSwitchAlert.progressBarIsVisible" count="vm.modeSwitchAlert.progress" load-status="vm.modeSwitchAlert.alert.loadStatus"></ndm-progress-bar><div data-translate="">{{vm.modeSwitchAlert.text}}</div> <span data-translate="">{{vm.modeSwitchAlert.subText}}</span></ndm-alert></div>'),e.put("app/page/controlPanel/control/system/systemFiles/systemFiles.html",'<div ng-controller="SystemFilesController as vm" ng-init="system.subcontroller.register(vm, \'SYSTEM_FILES\')" class="system__system-files-section"><div ng-if="vm.isReady" class="system-files"><ndm-form-header class="system-files__header" hr="hr-light-blue" label="system.system-files.header"></ndm-form-header><div class="system-files__files-group files-group files-group--{{group}}" ng-repeat="group in ::[\'main\', \'secondary\']"><p class="files-group__header body-text" data-translate="">{{::\'system.system-files.description-\' + group}}</p><div class="files-group__list"><div ng-repeat="file in ::vm.files[group]" class="files-group__item system-file" ng-class="{\'system-file--selected\': vm.selectedFile === file.name}" ng-click="vm.toggleFile(file.name)"><div class="system-file__header"><div class="system-file__name"><i class="system-file__toggle-icon icon icon--arrow-{{vm.selectedFile === file.name ? \'down\' : \'up\'}}"></i> <i class="system-file__icon icon icon--{{file.icon}}"></i> <span class="system-file__title title">{{file.name}}</span></div> <div class="system-file__description help-text" data-translate="">{{\'system.system-files.files-list.\' + file.l10nId}}</div></div> <div ng-if="vm.selectedFile === file.name" class="system-file__body" ng-class="{ \'system-file__body--firmware\': file.name === \'firmware\' }"><div ng-if="file.name === vm.FIRMWARE_FILENAME"><ndm-form-title label="system.system-files.device-name" text="vm.deviceName"></ndm-form-title><ndm-form-title label="os-version" text="vm.currentFirmwareVersion"></ndm-form-title></div> <div ng-if="file.name === vm.LTE_FIRMWARE_FILENAME"><ndm-form-title label="usbqmi.connection-info.modem-model" text="vm.internalModemData.modemName"></ndm-form-title><ndm-form-title label="usbqmi.connection-info.modem-firmware-version" text="vm.internalModemData.firmwareVersion"></ndm-form-title></div><p class="help-text" data-translate="">{{\'system.system-files.\' + (group === \'main\' ? \'uploadable-item-description\': \'item-description\')}}</p><div class="system-file__toolbar"><ndm-button btn-class="system-file__download-file-btn" is-disabled="system.ui.isLocked || file.downloadIsDisabled" label="system.system-files.ui.save-file-btn" ng-click="!system.ui.isLocked && vm.downloadFile($event, file)"></ndm-button><ndm-input-file ng-if="group === \'main\'" class="btn--file-upload" ng-class="{\'btn--disabled\': system.ui.isLocked}" on-upload-file="vm.uploadFile(file)" upload-url="file.uploadUrl" upload-file="file" btn-title="{{\'system.system-files.ui.replace-file-btn\' | translate}}"></ndm-input-file></div></div></div></div></div></div><ndm-alert is-visible="vm.uploadAlert.isVisible" is-close-button-hidden="true" label="system.system-files.upload-alert.title" class="alert system-files__alert"><ndm-progress-bar is-visible="true" count="vm.uploadAlert.progress" load-status="vm.uploadAlert.status"></ndm-progress-bar></ndm-alert></div>'),e.put("app/page/controlPanel/control/system/systemSettings/systemSettings.html",'<div ng-controller="SystemSettingsController as vm" ng-init="system.subcontroller.register(vm, \'SYSTEM_SETTINGS\')" class="system__system-settings-section"><ndm-form-header hr="hr-light-blue" label="system.system-settings.header"></ndm-form-header><div ng-if="vm.isReady" ng-form="vm.form"><ndm-input name="hostname" label="system.system-settings.system-name" validation="length[1..15],asciiWithoutSpace" model="vm.data.hostname"></ndm-input><ndm-input name="domainname" label="system.system-settings.domain-name" validation="length[1..15],asciiWithoutSpace" model="vm.data.domainname"></ndm-input><ndm-checkbox name="enableNtp" label="system.system-settings.set-time-automatically" model="vm.data.isSystemTimeAutosynced"></ndm-checkbox><div ng-if="!vm.data.isSystemTimeAutosynced" ng-form="vm.timeForm"><ndm-input name="date" validation="date[2016]" hint="system.system-settings.date-hint" ndm-input-time-holder="dd-MM-yyyy" label="system.system-settings.date" model="vm.data.date"></ndm-input><ndm-input name="time" validation="time" hint="system.system-settings.time-hint" ndm-input-time-holder="HH:mm:ss" ndm-input-time-holder-update="" label="system.system-settings.time" model="vm.data.time"></ndm-input></div><ndm-selectbox-filter is-disabled="system.ui.isLocked" name="timezoneSelect" label="system.system-settings.time-zone" value="vm.data.timezone" options="vm.timezoneOptions"></ndm-selectbox-filter><ndm-details label-hidden="system.system-settings.ntp-show" label-visible="system.system-settings.ntp-hide"><table class="system__system-settings-section__ntp-table" ng-show="vm.data.ntpServers.length > 0"><thead><tr><th class="table__header table__col-0"><span data-translate=""></span></th><th class="table__header table__col-1"><span data-translate=""></span></th></tr></thead><tbody bs-modifiable="false"><tr ng-repeat="server in vm.data.ntpServers track by $index" ng-class=""><td class="table__col-0"><div class="td-content-wrapper"><ndm-input label="{{\'system.system-settings.ntp\' | translate}} {{$index + 1}}:" name="ntp{{$index}}" model="vm.data.ntpServers[$index].name" on-change="vm.onNtpChange" validation="domain,required" error="server.error"></ndm-input></div></td><td class="table__col-1"><span class="system__system-settings-section__ntp-table__remove_row" title="{{\'system.system-settings.ntp-remove\' | translate}}" ng-click="vm.removeNTP($index)"></span></td></tr></tbody></table><input name="ntpChanged" ng-model="vm.ntpConfigChanged" type="hidden"><ndm-button label="system.system-settings.ntp-add" ng-click="vm.addNTP()"></ndm-button></ndm-details></div></div>'),e.put("app/page/controlPanel/control/system/usbPorts/usbPorts.html",'<div ng-controller="UsbPortsController as vm" ng-init="system.subcontroller.register(vm, \'USBPORTS\')" class="system__usb-ports-section"><div ng-if="vm.isReady" ng-form="vm.form"><ndm-form-header hr="hr-light-blue" label="system.usb-ports.title" sub-title="system.usb-ports.description"></ndm-form-header><ndm-selectbox ng-repeat="selectbox in vm.selectboxes" is-disabled="selectbox.isDisabled || system.ui.isLocked" name="usbPorts{{$index + 1}}" label="{{$index ? \'system.usb-ports.second-port-label\' : \'system.usb-ports.first-port-label\'}}" value="selectbox.model" options="selectbox.options" bottom-description="{{ !selectbox.isDisabled && vm.flashDriveIsConnected && vm.form.modified ? \'system.usb-ports.usb-storage-warning\' : \'\' }}" <="" ndm-selectbox=""></ndm-selectbox></div></div>'),e.put("app/page/controlPanel/myInternet/modems/usbqmi/usbqmi.additional-settings.html",'<div class="page-usbqmi__additional-settings"><ndm-form-header hr="hr-light-blue" label="usbqmi.additional-settings.title"></ndm-form-header><ndm-selectbox label="usbqmi.additional-settings.preferred-cellular-standard" name="lteAuthenticationType" options="vm.options.cellularStandard" disabled="vm.ui.isLocked || vm.ui.isParentLocked" value="vm.model.cellularStandard"></ndm-selectbox><ndm-details class="page-usbqmi__frequency-bands" label-visible="usbqmi.additional-settings.show-frequency-bands" label-hidden="usbqmi.additional-settings.hide-frequency-bands" toggle-var="vm.ui.isBandsDataVisible" disabled="!vm.isPlugged" on-toggle="vm.onBandsSelectorToggle" transclude-class=""><div ng-form="vm.form.bandsSubform"><div ng-if="vm.ui.isBandsDataLoadInProgress" class="page-usbqmi__frequency-bands-load-msg"><i class="icon icon--load"></i> <span data-translate="">usbqmi.additional-settings.frequency-bands.data-reload-message</span></div><ndm-checkbox-list ng-show="vm.model.cellularStandard !== vm.CELLULAR_STANDARD.LTE && vm.options.umtsFddBands.length > 0" bs-modifiable="{{vm.model.cellularStandard !== vm.CELLULAR_STANDARD.LTE}}" is-disabled="vm.ui.isBandsDataLoadInProgress" label="usbqmi.additional-settings.frequency-bands.umts-fdd" name="umtsFdd" nobr="true" options="vm.options.umtsFddBands" model="vm.model.umtsFddBands"></ndm-checkbox-list><ndm-checkbox-list ng-show="vm.model.cellularStandard !== vm.CELLULAR_STANDARD.UMTS && vm.options.lteFddBands.length > 0" bs-modifiable="{{vm.model.cellularStandard !== vm.CELLULAR_STANDARD.UMTS}}" is-disabled="vm.ui.isBandsDataLoadInProgress" label="usbqmi.additional-settings.frequency-bands.lte-fdd" name="lteFdd" nobr="true" options="vm.options.lteFddBands" model="vm.model.lteFddBands"></ndm-checkbox-list><ndm-checkbox-list ng-show="vm.model.cellularStandard !== vm.CELLULAR_STANDARD.UMTS && vm.options.lteTddBands.length > 0" bs-modifiable="{{vm.model.cellularStandard !== vm.CELLULAR_STANDARD.UMTS}}" is-disabled="vm.ui.isBandsDataLoadInProgress" label="usbqmi.additional-settings.frequency-bands.lte-tdd" name="lteTdd" nobr="true" options="vm.options.lteTddBands" model="vm.model.lteTddBands"></ndm-checkbox-list></div></ndm-details><ndm-input class="page-usbqmi__apn-input" label="usbqmi.additional-settings.apn" model="vm.model.apn" placeholder="{{ vm.getApnPlaceholder() }}" name="lteApn"><ndm-help title="usbqmi.additional-settings.apn"><span data-translate="">usbqmi.additional-settings.apn-hint</span></ndm-help></ndm-input><ndm-selectbox label="usbqmi.additional-settings.authentication-type" name="lteAuthenticationType" options="vm.options.authenticationType" disabled="vm.ui.isLocked || vm.ui.isParentLocked" value="vm.model.authentication.type"></ndm-selectbox><ndm-checkbox label="usbqmi.plmn.preset-network" model="vm.model.isPlmnSet" name="isPlmnSet"></ndm-checkbox><ndm-sub-form ng-if="vm.model.isPlmnSet" ng-form="vm.form.plmnSubform"><ndm-input class="page-usbqmi__plmn-input" label="usbqmi.plmn.plmn-code" model="vm.model.plmn" placeholder="{{\'usbqmi.plmn.placeholder\' | translate}}" name="plmn" validation="required,numeric,length[3..5]"><ndm-help><span data-translate="">usbqmi.plmn.hint</span></ndm-help></ndm-input></ndm-sub-form><div ng-if="vm.model.authentication.type !== vm.PPP_AUTH_ALGORITHM.AUTO" ng-form="vm.authSubform"><ndm-input label="usbqmi.additional-settings.identity" model="vm.model.authentication.identity" name="lteIdentity" validation="required,ascii,length[..64]"></ndm-input><ndm-input label="usbqmi.additional-settings.password" model="vm.model.authentication.password" name="ltePassword" password="true" validation="required,ascii,length[..64]"></ndm-input></div><ndm-checkbox label="usbqmi.additional-settings.enable-roaming" model="vm.model.roamingIsEnabled" name="lteRoamingIsEnabled"></ndm-checkbox><ndm-checkbox ng-if="::vm.IPV6_INSTALLED" label="usbqmi.additional-settings.enable-ipv6" model="vm.model.ipv6IsEnabled" name="lteEnableIPv6"></ndm-checkbox></div>'),e.put("app/page/controlPanel/myInternet/modems/usbqmi/usbqmi.connection-info.html",'<div class="page-usbqmi__connection-info"><ndm-form-header label="usbqmi.connection-info.header"><a tabindex="0" ng-click="!vm.ui.locked && vm.startScan()" class="ref-link page-usbqmi__scan-link" ng-class="{ \'ref-link--disabled\': !vm.model.general.isUp || vm.status.name === vm.NDM_CONNECTION_STATE.SCANNING }" data-translate="">usbqmi.connection-info.scan-air</a></ndm-form-header><div ng-if="vm.connectionInfo.length === 0 || vm.connectionInfoInterfaceId !== vm.interfaceId" class="page-usbqmi__connection-info-loading"><i class="icon icon--load"></i> <span data-translate="">loading</span></div><ul ng-if="vm.connectionInfoInterfaceId === vm.interfaceId" class="form-list"><li ng-repeat="property in vm.connectionInfo.propsTop track by property.l10n" class="form-list__row"><div class="form-list__label" data-translate="{{ (\'usbqmi.connection-info.\' + property.l10n) | translate }}"></div> <div class="form-list__value"><div ng-if="property.isArray" ng-repeat="item in property.value track by $index">{{item}}</div> <div ng-if="!property.isArray" ndm-html-compile="property.value"></div></div></li><li class="form-list__row page-usbqmi__antennas-list" ng-if="vm.connectionInfo.antennasList.length > 0"><ndm-details label-visible="usbqmi.connection-info.antennas.show-information" label-hidden="usbqmi.connection-info.antennas.hide-information" toggle-var="vm.toggleVar" transclude-class=""><div ng-repeat="antenna in vm.connectionInfo.antennasList"><div class="form-list__subtitle" data-translate="{{\'usbqmi.connection-info.antennas.title\' | translate:{num: $index} }}"></div> <div class="form-list__row" ng-repeat="(key, value) in antenna"><div class="form-list__label form-list__label--pl" data-translate="{{ (\'usbqmi.connection-info.antennas.\' + key) | translate}}"></div> <div class="form-list__value">{{value}}</div></div></div></ndm-details></li><li ng-repeat="property in vm.connectionInfo.propsBottom track by property.l10n" class="form-list__row"><div class="form-list__label" data-translate="{{ (\'usbqmi.connection-info.\' + property.l10n) | translate }}"></div> <div class="form-list__value"><div ng-if="property.isArray" ng-repeat="item in property.value track by $index">{{item}}</div> <div ng-if="!property.isArray" ndm-html-compile="property.value"></div></div></li></ul></div>'),e.put("app/page/controlPanel/myInternet/modems/usbqmi/usbqmi.html",'<div ng-controller="UsbQmiController as vm" class="page-usbqmi"><form ng-show="vm.isReady" name="vm.form"><fieldset ng-disabled="vm.ui.isLocked || vm.ui.isParentLocked"><ndm-isp-general-properties is-disabled="vm.ui.isLocked || vm.ui.isParentLocked" model="vm.model.general" status="vm.status" on-toggle="vm.toggleUsbQmiState" l10n-override="vm.l10nOverride"></ndm-isp-general-properties><div ng-include="\'app/page/controlPanel/myInternet/modems/usbqmi/simManagement/usbqmi.simManagement.html\'"></div> <div ng-include="\'app/page/controlPanel/myInternet/modems/usbqmi/usbqmi.additional-settings.html\'"></div><ndm-pingcheck ng-if="::vm.PINGCHECK_INSTALLED" is-disabled="vm.ui.isLocked || vm.ui.isParentLocked" data="vm.model.pingcheck"></ndm-pingcheck><hr class="hr-light-blue"></fieldset><div ng-include="\'app/page/controlPanel/myInternet/modems/usbqmi/usbqmi.connection-info.html\'"></div><br><ndm-button ng-if="vm.isRemovable" is-disabled="vm.ui.isLocked || vm.ui.isParentLocked" on-click="vm.removeConnection" label="delete"></ndm-button></form><ndm-control-footer prefix="usbQmi" is-visible="vm.isReady && vm.form.modified" is-save-disabled="vm.ui.isLocked || vm.form.$invalid" save="vm.save" cancel="vm.cancel"></ndm-control-footer></div>'),e.put("app/page/controlPanel/myInternet/otherConnections/ipsec/ipsec.popup.html",'<ndm-popup ng-if="Ipsec.ipsecEditor.isVisible" is-visible="true" class="otherConnections-ipsec-popup" header-title="otherConnections.ipsec.editor.header" close="Ipsec.ipsecEditor.close"><form ng-hide="Ipsec.ipsecEditor.loading" name="Ipsec.ipsecEditor.form" novalidate=""><ndm-checkbox label="otherConnections.ipsec.editor.wait-connection" name="wait-connection" ng-click="Ipsec.ipsecEditor.updateRemoteIdentityTypes()" model="Ipsec.ipsecEditor.data[\'wait-connections\']"></ndm-checkbox><ndm-checkbox ng-if="!Ipsec.ipsecEditor.data[\'wait-connections\']" label="otherConnections.ipsec.editor.autoconnect" name="autoconnect" model="Ipsec.ipsecEditor.data.autoconnect"></ndm-checkbox><ndm-input label="otherConnections.ipsec.editor.name" model="Ipsec.ipsecEditor.data.name" disabled="!Ipsec.ipsecEditor.isNew" name="name" extra-validator="Ipsec.ipsecEditor.nameValidator" validation-text-error="{notInArray: \'otherConnections.ipsec.error.name-used\'}" validation="required,notInArray[{{Ipsec.ipsecEditor.data[\'used-names\']}}]"></ndm-input><ndm-checkbox label="otherConnections.ipsec.editor.nailed-up" name="nailed-up" model="Ipsec.ipsecEditor.data[\'nail-up\']"></ndm-checkbox><ndm-input ng-if="!Ipsec.ipsecEditor.data[\'wait-connections\']" label="otherConnections.ipsec.editor.remote-gateway" model="Ipsec.ipsecEditor.data[\'remote-gateway\']" name="remote-gateway" validation-text-error="{notInArray: \'otherConnections.ipsec.error.remote-gateway-used\'}" validation="required,ipOrDomain,notInArray[{{Ipsec.ipsecEditor.data[\'used-routes\']}}]"></ndm-input><ndm-checkbox label="otherConnections.ipsec.editor.dead-peer" name="dead-peer" model="Ipsec.ipsecEditor.data[\'dead-peer\']"></ndm-checkbox><ndm-input ng-if="Ipsec.ipsecEditor.data[\'dead-peer\']" label="otherConnections.ipsec.editor.dead-peer-interval" model="Ipsec.ipsecEditor.data[\'dead-peer-interval\']" unit-text="time.second" name="dead-peer-interval" placeholder="1…3600" validation="range[1..3600]"></ndm-input><ndm-form-header label="otherConnections.ipsec.editor.phase1" hr="hr-light-blue"></ndm-form-header><ndm-input-drop drop-array="Ipsec.lists.ipsec.localIdentityTypeList" drop-value="Ipsec.ipsecEditor.data[\'local-identity-type\']" label="otherConnections.ipsec.editor.local-identity-type" model-val="Ipsec.ipsecEditor.data[\'local-identity\']" input-name="local-identity-type" input-validation="{{Ipsec.ipsecEditor.getIdentityValidators(\'local\')}}"></ndm-input-drop><ndm-input-drop drop-array="Ipsec.lists.ipsec.remoteIdentityTypeList" drop-value="Ipsec.ipsecEditor.data[\'remote-identity-type\']" label="otherConnections.ipsec.editor.remote-identity-type" model-val="Ipsec.ipsecEditor.data[\'remote-identity\']" input-hidden="Ipsec.ipsecEditor.data[\'remote-identity-type\'] === \'any\' || Ipsec.ipsecEditor.data[\'remote-identity-type\'] === \'gateway\'" input-name="remote-identity-type" input-validation="{{Ipsec.ipsecEditor.getIdentityValidators(\'remote\')}}"></ndm-input-drop><ndm-input label="otherConnections.ipsec.editor.ike-psk" model="Ipsec.ipsecEditor.data.psk" name="ike-psk" password="true" show-password-label="show-psk" hide-password-label="hide-psk" max-length="128" validation="required,length[6..64],ipsecPsk"></ndm-input><ndm-selectbox label="otherConnections.ipsec.editor.ike-version" name="ike-version" options="Ipsec.lists.ipsec.ikeVersionList" value="Ipsec.ipsecEditor.data[\'ike-version\']" on-change="Ipsec.ipsecEditor.updateRemoteIdentityTypes()"></ndm-selectbox><ndm-input label="otherConnections.ipsec.editor.ike-lifetime" model="Ipsec.ipsecEditor.data[\'ike-lifetime\']" name="ike-lifetime" unit-text="time.second" placeholder="60…2147483647" validation="range[60..2147483647]"></ndm-input><ndm-checkbox label="otherConnections.ipsec.editor.ike-aead" name="ike-aead" model="Ipsec.ipsecEditor.data[\'ike-aead\']" hint="otherConnections.ipsec.editor.hints.aead" disabled="Ipsec.ipsecEditor.data[\'ike-aead-from-config\']"></ndm-checkbox><div ng-if="!Ipsec.ipsecEditor.data[\'ike-aead\']"><ndm-checkbox-list label="otherConnections.ipsec.editor.ike-encryption" options="Ipsec.lists.ipsec.ikeEncryption" nobr="1" name="ike-encryption" model="Ipsec.ipsecEditor.data[\'ike-encryption\']"></ndm-checkbox-list><ndm-checkbox-list label="otherConnections.ipsec.editor.ike-integrity" options="Ipsec.lists.ipsec.ikeIntegrity" nobr="1" name="ike-integrity" model="Ipsec.ipsecEditor.data[\'ike-integrity\']"></ndm-checkbox-list></div> <div ng-if="Ipsec.ipsecEditor.data[\'ike-aead\']"><ndm-checkbox-list label="otherConnections.ipsec.editor.ike-encryption-aead" options="Ipsec.lists.ipsec.ikeEncryptionAead" nobr="1" name="ike-encryption-aead" model="Ipsec.ipsecEditor.data[\'ike-encryption-aead\']"></ndm-checkbox-list><ndm-checkbox-list label="otherConnections.ipsec.editor.ike-prf" options="Ipsec.lists.ipsec.ikePrf" nobr="1" name="ike-prf" model="Ipsec.ipsecEditor.data[\'ike-prf\']"></ndm-checkbox-list></div><ndm-checkbox-list label="otherConnections.ipsec.editor.ike-dh-group" options="Ipsec.lists.ipsec.ikeDhGroup" nobr="1" name="ike-dh-group" model="Ipsec.ipsecEditor.data[\'ike-dh-group\']"></ndm-checkbox-list><div ng-if="Ipsec.ipsecEditor.data[\'ike-version\'] === \'ikev1\'"><ndm-selectbox label="otherConnections.ipsec.editor.x-auth-mode" name="x-auth-mode" options="Ipsec.lists.ipsec.xAuthModeList" value="Ipsec.ipsecEditor.data[\'x-auth-mode\']" on-change=""></ndm-selectbox><ndm-input ng-if="Ipsec.ipsecEditor.data[\'x-auth-mode\'] === \'client\'" label="otherConnections.ipsec.editor.x-auth-identity" model="Ipsec.ipsecEditor.data[\'x-auth-identity\']" name="x-auth-identity" validation="login"></ndm-input><ndm-input ng-if="Ipsec.ipsecEditor.data[\'x-auth-mode\'] === \'client\'" label="otherConnections.ipsec.editor.x-auth-password" model="Ipsec.ipsecEditor.data[\'x-auth-password\']" name="x-auth-password" password="1" validation="password"></ndm-input><ndm-selectbox label="otherConnections.ipsec.editor.negotiation-mode" name="negotiation-mode" options="Ipsec.lists.ipsec.negotiationModeList" value="Ipsec.ipsecEditor.data[\'negotiation-mode\']" on-change=""></ndm-selectbox></div><ndm-form-header label="otherConnections.ipsec.editor.phase2" hr="hr-light-blue"></ndm-form-header><ndm-selectbox label="otherConnections.ipsec.editor.mode" name="ipsec-mode" options="Ipsec.lists.ipsec.ipsecModeList" value="Ipsec.ipsecEditor.data[\'mode\']" on-change=""></ndm-selectbox><ndm-input label="otherConnections.ipsec.editor.sa-lifetime" model="Ipsec.ipsecEditor.data[\'sa-lifetime\']" unit-text="time.second" name="sa-lifetime" placeholder="60…2147483647" validation="range[60..2147483647]"></ndm-input><ndm-checkbox label="otherConnections.ipsec.editor.sa-aead" name="sa-aead" model="Ipsec.ipsecEditor.data[\'sa-aead\']" hint="otherConnections.ipsec.editor.hints.aead" disabled="Ipsec.ipsecEditor.data[\'ike-aead-from-config\']"></ndm-checkbox><div ng-if="!Ipsec.ipsecEditor.data[\'sa-aead\']"><ndm-checkbox-list label="otherConnections.ipsec.editor.sa-encryption" options="Ipsec.lists.ipsec.saEncryption" nobr="1" name="sa-encryption" on-change="Ipsec.ipsecEditor.onSaEncriptionChange()" model="Ipsec.ipsecEditor.data[\'sa-encryption\']"></ndm-checkbox-list><ndm-checkbox-list label="otherConnections.ipsec.editor.sa-integrity" options="Ipsec.lists.ipsec.saIntegrity" nobr="1" name="sa-integrity" model="Ipsec.ipsecEditor.data[\'sa-integrity\']"></ndm-checkbox-list></div> <div ng-if="Ipsec.ipsecEditor.data[\'sa-aead\']"><ndm-checkbox-list label="otherConnections.ipsec.editor.sa-encryption-aead" options="Ipsec.lists.ipsec.saEncryptionAead" nobr="1" name="sa-encryption-aead" on-change="Ipsec.ipsecEditor.onSaEncriptionChange()" model="Ipsec.ipsecEditor.data[\'sa-encryption-aead\']"></ndm-checkbox-list></div><ndm-checkbox-list label="otherConnections.ipsec.editor.ike-dh-group" options="Ipsec.lists.ipsec.ikeDhGroup" nobr="1" name="sa-dh-group" model="Ipsec.ipsecEditor.data[\'dh-group-phase2\']"></ndm-checkbox-list><ndm-input-drop drop-array="Ipsec.lists.mask" drop-value="Ipsec.ipsecEditor.data[\'local-network-mask\']" label="otherConnections.ipsec.editor.local-network-ip" model-val="Ipsec.ipsecEditor.data[\'local-network-ip\']" input-name="local-network-ip" input-validation="required,ip,isNet"></ndm-input-drop><ndm-input-drop drop-array="Ipsec.lists.mask" drop-value="Ipsec.ipsecEditor.data[\'remote-network-mask\']" label="otherConnections.ipsec.editor.remote-network-ip" model-val="Ipsec.ipsecEditor.data[\'remote-network-ip\']" input-name="remote-network-ip" validation-data="{nets: Ipsec.ipsecEditor.data[\'used-ips\']}" input-validation="required,ip,isNet,notInNets"></ndm-input-drop><div class="_delete-panel" ng-if="!Ipsec.ipsecEditor.isNew"><ndm-form-header hr="hr-light-blue" label=""></ndm-form-header><button type="button" class="btn btn--long" ng-click="Ipsec.ipsecEditor.delete()"><span data-translate="">otherConnections.delete-connection</span></button></div><ndm-control-footer prefix="ipsec" is-visible="Ipsec.ipsecEditor.form.modified || Ipsec.ipsecEditor.isNew" is-popup="true" is-save-disabled="Ipsec.ipsecEditor.form.$invalid || (!Ipsec.ipsecEditor.form.modified && !Ipsec.ipsecEditor.isNew) || Ipsec.ipsecEditor.form.pending" save="Ipsec.ipsecEditor.save()" cancel="Ipsec.ipsecEditor.close()"></ndm-control-footer></form></ndm-popup>'),e.put("app/page/controlPanel/myInternet/otherConnections/ipsec/ipsec.section.html",'<div class="otherConnections-section ipsec-section" ng-controller="IpsecController as Ipsec"><ndm-form-header hr="{{::(Ipsec.HR_IS_VISIBLE) ? \'hr-light-blue\' : \'\'}}" label="otherConnections.ipsec.header" sub-title="otherConnections.ipsec.notice"></ndm-form-header><table ng-if="Ipsec.ipsecTable.connections" class="ipsec-table body-text"><thead><tr><th ng-repeat="col in Ipsec.ipsecTable.columns" class="table__header" data-translate="">{{col.title ? col.title : col}}</th></tr></thead><tbody><tr ng-repeat="row in Ipsec.ipsecTable.data track by $index" ng-click="Ipsec.ipsecEditor.edit($event, row.name)"><td class="toggle-container"><ndm-toggle label-on="{{row.name | escapeHtml}}" label-off="{{row.name | escapeHtml}}" model="row.enabled" name="{{row.name}}" call-on-change="Ipsec.ipsecEditor.toggle" description="row.status"></ndm-toggle></td><td><span>{{row.route}}</span></td><td><span>{{row.mode}}</span></td><td><span>{{row.localNetwork}}</span></td><td><span>{{row.remoteNetwork}}</span></td><td><span>{{row.reauth}}<br>{{row.rekey}}</span></td></tr></tbody></table><div ng-if="!Ipsec.ipsecTable.connections" class="empty-list"><span ng-if="!Ipsec.ipsecTable.dataLoaded" data-translate="">loading</span> <span ng-if="Ipsec.ipsecTable.dataLoaded" data-translate="">otherConnections.no-connections</span></div> <div class="ipsec-section__add-connection-btn"><ndm-button ng-click="Ipsec.ipsecEditor.addConnection()" label="otherConnections.ppp.add-button"></ndm-button></div> <div ng-include="\'app/page/controlPanel/myInternet/otherConnections/ipsec/ipsec.popup.html\'"></div></div>'),e.put("app/page/controlPanel/myInternet/otherConnections/ipv6to4/ipv6to4.popup.html",'<ndm-popup ng-if="ipv6to4.editor.isVisible" is-visible="true" class="otherConnections-ipv6to4-popup" header-title="otherConnections.ipv6to4.editor.header" close="ipv6to4.editor.cancel" save="ipv6to4.editor.save"><form ng-if="ipv6to4.editor.isVisible" name="ipv6to4.editorForm" novalidate=""><ndm-checkbox name="isGlobal" model="ipv6to4.editor.model.isGlobal" label="otherConnections.ipv6to4.tunnel.is-global"></ndm-checkbox><ndm-input name="description" model="ipv6to4.editor.model.description" label="otherConnections.ipv6to4.tunnel.description" validation="required"></ndm-input><ndm-input name="ipV4" model="ipv6to4.editor.model.ipV4" label="otherConnections.ipv6to4.tunnel.ipv4-address" validation="ip,required"></ndm-input><ndm-input name="ipV6" class-name="ndm-input-l" model="ipv6to4.editor.model.ipV6" label="otherConnections.ipv6to4.tunnel.ipv6-address" validation="ipV6"></ndm-input><ndm-input name="ipV6Prefix" class-name="ndm-input-l" model="ipv6to4.editor.model.ipV6Prefix" label="otherConnections.ipv6to4.tunnel.ipv6-prefix" validation="ipV6Prefix"></ndm-input><div ng-if="!ipv6to4.editor.model.isNew" class="_delete-panel"><hr class="hr-light-blue"><button type="button" class="btn btn--long" ng-click="ipv6to4.deleteTunnel(ipv6to4.editor.model.id)"><span data-translate="">otherConnections.ipv6to4.btn.delete-tunnel</span></button></div><ndm-control-footer prefix="ipv6to4" is-visible="ipv6to4.editorForm.modified || ipv6to4.editor.model.isNew" is-popup="true" is-save-disabled="ipv6to4.editorForm.$invalid || (!ipv6to4.editorForm.modified && !ipv6to4.editor.model.isNew)" save="ipv6to4.editor.save()" cancel="ipv6to4.editor.cancel()"></ndm-control-footer></form></ndm-popup>'),e.put("app/page/controlPanel/myInternet/otherConnections/ipv6to4/ipv6to4.section.html",'<div class="otherConnections-section ipv6to4-section" ng-controller="Ipv6To4Controller as ipv6to4"><ndm-form-header hr="{{::(ipv6to4.HR_IS_VISIBLE) ? \'hr-light-blue\' : \'\'}}" label="otherConnections.ipv6to4.header" sub-title="otherConnections.ipv6to4.description"></ndm-form-header><ndm-table ng-if="ipv6to4.table.dataLoaded && ipv6to4.table.data.length > 0" class="ipv6to4_table" data="ipv6to4.table.data" columns="ipv6to4.table.columns" track-by-prop="id" sort-name="id" sort-reverse="false" sortable="false" click-on-row="ipv6to4.editTunnel"></ndm-table><div ng-if="!ipv6to4.table.dataLoaded || ipv6to4.table.data.length === 0" class="empty-list"><span ng-if="!ipv6to4.table.dataLoaded" data-translate="">loading</span> <span ng-if="ipv6to4.table.dataLoaded && ipv6to4.table.data.length === 0" data-translate="">otherConnections.no-connections</span></div> <div class="ipv6to4-section__add-connection-btn"><ndm-button btn-class="add-tunnel-btn" ng-click="ipv6to4.addTunnel()" label="otherConnections.ipv6to4.btn.add-tunnel"></ndm-button></div> <div ng-include="\'app/page/controlPanel/myInternet/otherConnections/ipv6to4/ipv6to4.popup.html\'"></div></div>'),e.put("app/page/controlPanel/myInternet/otherConnections/ppp/ppp.popup.html",'<ndm-popup is-visible="true" ng-if="Ppp.pppEditor.isVisible" class="otherConnections-ppp-popup" header-title="otherConnections.ppp.editor.header" close="Ppp.pppEditor.close"><form name="Ppp.pppEditor.form" novalidate=""><ndm-fieldset is-disabled="Ppp.pppEditor.isLocked"><ndm-text text="otherConnections.ppp.editor.description"></ndm-text><ndm-checkbox label="otherConnections.ppp.global" name="global" model="Ppp.pppEditor.data.global"></ndm-checkbox><ndm-input label="otherConnections.ppp.editor.connection-name" model="Ppp.pppEditor.data.description" name="description" validation="required"></ndm-input><ndm-selectbox disabled="Ppp.pppEditor.isLocked || Ppp.pppEditor.isPppTypeLocked" label="otherConnections.ppp.ppp-type" name="pppType" options="Ppp.pppEditor.typeOptions" value="Ppp.pppEditor.data.type" class="otherConnections-ppp-popup__ppp-type"><ndm-input-file ng-if="Ppp.pppEditor.data.type === Ppp.PPP_TYPE.IKEV2" label="" upload-file="Ppp.pppEditor.data.ikev2Configuration" confirm-upload="true" on-file-select="Ppp.ikev2.configurationInput.onFileSelect" on-init="Ppp.ikev2.configurationInput.onInit" btn-title="otherConnections.ppp.ike-v2.import-configuration.button-label"></ndm-input-file></ndm-selectbox><div ng-if="Ppp.pppEditor.data.type === Ppp.PPP_TYPE.OPENVPN"><ndm-checkbox name="acceptRoutes" label="otherConnections.ppp.editor.openvpn.accept-routes" model="Ppp.pppEditor.data.openvpn[\'accept-routes\']"></ndm-checkbox><ndm-textarea name="opnVpnConfig" label="otherConnections.ppp.editor.openvpn.config" is-required="true" min-length="32" max-length="32768" model="Ppp.pppEditor.data.openvpn.config.config"></ndm-textarea></div><ndm-input ng-if="Ppp.pppRequiresServerAddress(Ppp.pppEditor.data.type)" label="otherConnections.ppp.server-address" model="Ppp.pppEditor.data.peer" name="pppServerAddress" validation-data="{allowPort: Ppp.pppEditor.data.type === Ppp.PPP_TYPE.SSTP}" validation="required,ipOrDomain"></ndm-input><div ng-if="Ppp.pppEditor.data.type === Ppp.PPP_TYPE.IKEV2" class="otherConnections-ppp-popup__ikev2-certificate-import"><ndm-input-file upload-file="Ppp.pppEditor.data.certificate" label="otherConnections.ppp.ike-v2.server-certificate.label" confirm-upload="true" disable-on-file-select="true" on-init="Ppp.ikev2.certificateInput.onInit" on-file-select="Ppp.ikev2.certificateInput.onFileSelect" on-reset="Ppp.ikev2.certificateInput.onReset" btn-title="otherConnections.ppp.ike-v2.server-certificate.button-label"></ndm-input-file><ndm-help ng-if="!Ppp.pppEditor.data.certificateSelected"><span data-translate="">otherConnections.ppp.ike-v2.server-certificate.hint</span></ndm-help></div><ul ng-if="Ppp.pppEditor.data.type === Ppp.PPP_TYPE.IKEV2" class="form-list otherConnections-ppp-popup__ikev2-certificate-state"><li class="form-list__row"><span class="form-list__label"></span> <span class="form-list__text help-text">{{ Ppp.pppEditor.data.certificateState }}</span></li></ul><input type="hidden" name="certificateFile" ng-model="Ppp.pppEditor.data.certificateSelected"> <div ng-if="Ppp.pppEditor.data.type !== Ppp.PPP_TYPE.OPENVPN"><ndm-input label="identity" model="Ppp.pppEditor.data.authentication.identity" placeholder="{{\'identity\' | translate}}" name="additionalPppIdentity" validation="required,ascii,length[1..64]"></ndm-input><ndm-input label="password" password="true" is-description-disabled="Ppp.pppEditor.isLocked" model="Ppp.pppEditor.data.authentication.password" placeholder="{{\'password\' | translate}}" name="additionalPppPassword" validation="{{ Ppp.pppEditor.data.type === Ppp.PPP_TYPE.IKEV2 || Ppp.pppEditor.data.type === Ppp.PPP_TYPE.IKEV1 ? \'required,\' : \'\' }}ascii,length[..64]"></ndm-input><ndm-selectbox ng-if="Ppp.pppEditor.data.type !== Ppp.PPP_TYPE.IKEV2 && Ppp.pppEditor.data.type !== Ppp.PPP_TYPE.IKEV1" disabled="Ppp.pppEditor.isLocked" label="otherConnections.ppp.editor.algorithm" name="pppAlgorithm" options="Ppp.options.authAlgorithm" value="Ppp.pppEditor.data.algorithm"></ndm-selectbox></div><ndm-selectbox ng-if="Ppp.pppEditor.data.type === Ppp.PPP_TYPE.PPPOE" disabled="Ppp.pppEditor.isLocked" ng-class="{\'error\': Ppp.pppEditor.data.via === Ppp.PPPOE_VIA_NOT_SET_OPTION}" label="otherConnections.ppp.via" name="pppVia" options="Ppp.pppEditor.pppoeOptions" extra-validator="Ppp.pppEditor.pppoeViaValidator" value="Ppp.pppEditor.data.via"></ndm-selectbox><ndm-input ng-if="Ppp.pppEditor.data.type === Ppp.PPP_TYPE.L2TP_OVER_IPSEC || Ppp.pppEditor.data.type === Ppp.PPP_TYPE.IKEV1" label="otherConnections.ppp.editor.psk" model="Ppp.pppEditor.data.psk" password="true" show-password-label="show-psk" hide-password-label="hide-psk" name="psk" max-length="64" validation="required,l2tpIpsecPsk"></ndm-input><div ng-if="Ppp.pppEditor.data.type === Ppp.PPP_TYPE.PPTP"><ndm-checkbox model="Ppp.pppEditor.data.encryption.mppe" on-change="Ppp.pppEditor.onMppeToggle()" name="mppe" label="otherConnections.ppp.editor.enable-encryption"></ndm-checkbox><ndm-checkbox model="Ppp.pppEditor.data.ccp" disabled="Ppp.pppEditor.data.encryption.mppe" name="ccp" label="otherConnections.ppp.editor.ccp"></ndm-checkbox></div><ndm-details label-fn="Ppp.pppEditor.advancedSettings.getLabel" toggle-var="Ppp.pppEditor.advancedSettings.isVisible"><ndm-schedule-select is-disabled="Ppp.pppEditor.isLocked" model="Ppp.pppEditor.data.schedule" name="pppSchedule" initial-data="Ppp.schedulesData"></ndm-schedule-select><ndm-input ng-if="Ppp.pppEditor.data.type === Ppp.PPP_TYPE.PPPOE" label="otherConnections.ppp.editor.pppoe-service" model="Ppp.pppEditor.data.service" name="pppService"></ndm-input><ndm-input ng-if="Ppp.pppEditor.data.type === Ppp.PPP_TYPE.PPPOE" label="otherConnections.ppp.editor.concentrator-name" model="Ppp.pppEditor.data.pppoePeer" name="pppPeer"></ndm-input><ndm-selectbox ng-if="Ppp.pppEditor.data.type !== Ppp.PPP_TYPE.PPPOE && Ppp.pppEditor.data.type !== Ppp.PPP_TYPE.IKEV2 && Ppp.pppEditor.data.type !== Ppp.PPP_TYPE.IKEV1" disabled="Ppp.pppEditor.isLocked" label="otherConnections.ppp.via" name="pppVia" options="Ppp.pppEditor.vpnOptions" value="Ppp.pppEditor.data.via"></ndm-selectbox><div ng-if="Ppp.pppEditor.data.type !== Ppp.PPP_TYPE.OPENVPN && Ppp.pppEditor.data.type !== Ppp.PPP_TYPE.IKEV2 && Ppp.pppEditor.data.type !== Ppp.PPP_TYPE.IKEV1"><ndm-selectbox disabled="Ppp.pppEditor.isLocked" label="otherConnections.ppp.ip-config" name="pppChannel" options="Ppp.options.ipConfiguration" value="Ppp.pppEditor.data.ipConfig"></ndm-selectbox><ndm-sub-form ng-if="Ppp.pppEditor.data.ipConfig === Ppp.IP_CONFIG_MODE.STATIC"><ndm-input label="otherConnections.ppp.ip-address" model="Ppp.pppEditor.data.ip.address.address" name="pppIpAddress" validation-data="{nets: Ppp.pppEditor.restrictedNets, mask: Ppp.SINGLE_IP_MASK}" validation="required,ip,notInNets[mask,nets]"></ndm-input><ndm-input label="otherConnections.ppp.ip-remote" model="Ppp.pppEditor.data.ip.remote.address" name="pppIpRemote" validation="ip"></ndm-input></ndm-sub-form><ndm-input ng-repeat="i in [0,1,2]" label="{{(\'dns\' | translate | trust) + \' \' + (i + 1)}}" model="Ppp.pppEditor.data.dns[i]" name="pppDns{{i}}" validation-data="{allowPort: true}" validation="ip"></ndm-input><ndm-input ndm-disabled-by-mws-tooltip="" label="otherConnections.ppp.editor.mtu" model="Ppp.pppEditor.data.mtu" name="pppMtu" validation="range[64..1500]"></ndm-input><ndm-checkbox ng-if="Ppp.IPV6_INSTALLED" model="Ppp.pppEditor.data.ipv6cp" name="ipv6cp" label="otherConnections.ppp.editor.ipv6cp"></ndm-checkbox></div><ndm-checkbox model="Ppp.pppEditor.data.ip.tcp[\'adjust-mss\'].pmtu" name="pmtu" label="otherConnections.ppp.editor.tcp-mss"></ndm-checkbox><ndm-input ng-if="Ppp.pppEditor.data.type === Ppp.PPP_TYPE.OPENVPN" label="otherConnections.ppp.editor.mtu" model="Ppp.pppEditor.data.mtu" name="pppMtu" validation="range[64..1500]"></ndm-input></ndm-details><div ng-if="!Ppp.pppEditor.isNew" class="_delete-panel"><hr class="hr-light-blue"><ndm-button is-disabled="Ppp.pppEditor.isLocked" btn-class="btn--long" ng-click="!Ppp.pppEditor.isLocked && Ppp.pppEditor.delete()" label="otherConnections.delete-connection"></ndm-button></div></ndm-fieldset><ndm-control-footer prefix="ppp" is-visible="Ppp.pppEditor.form.modified || Ppp.pppEditor.isNew" is-popup="true" is-save-disabled="Ppp.pppEditor.form.$invalid || (!Ppp.pppEditor.form.modified && !Ppp.pppEditor.isNew) || Ppp.pppEditor.isLocked" save="Ppp.pppEditor.save()" cancel="Ppp.pppEditor.close()"></ndm-control-footer></form></ndm-popup>'),e.put("app/page/controlPanel/myInternet/otherConnections/ppp/ppp.section.html",'<div class="otherConnections-section ppp-section" ng-controller="PppController as Ppp"><ndm-form-header hr="{{::(Ppp.HR_IS_VISIBLE) ? \'hr-light-blue\' : \'\'}}" label="otherConnections.ppp.header" sub-title="otherConnections.ppp.description"></ndm-form-header><ndm-table ng-if="Ppp.pppTable.data.length > 0" class="ppp-section__connections-table" track-by-prop="id" data="Ppp.pppTable.data" columns="Ppp.pppTable.columns" sortable="true" sort-name="id" sort-reverse="false" click-on-row="Ppp.pppEditor.edit"></ndm-table><div ng-if="Ppp.pppTable.data.length === 0" class="empty-list"><span ng-if="!Ppp.pppTable.dataLoaded" data-translate="">loading</span> <span ng-if="Ppp.pppTable.dataLoaded && Ppp.pppTable.data.length === 0" data-translate="">otherConnections.no-connections</span></div> <div class="ppp-section__add-connection-btn"><ndm-button is-disabled="Ppp.PPPOE_ONLY || !Ppp.pppTable.dataLoaded" ng-click="!Ppp.pppoeOnly && Ppp.pppEditor.edit(true)" label="otherConnections.ppp.add-button"></ndm-button></div> <div ng-include="\'app/page/controlPanel/myInternet/otherConnections/ppp/ppp.popup.html\'"></div></div>'),e.put("app/page/controlPanel/myInternet/otherConnections/wireguard/wireguard.editor.dnsServers.html",'<div class="wireguard-editor__dns-servers"><ndm-input bs-modifiable="false" class="wireguard-editor__dns-server-input" ng-repeat="dnsServer in WireguardEditor.model.dnsServers track by $index" label="{{ (\'dns\' | translate) + \' \' + ($index + 1) }}" model="WireguardEditor.model.dnsServers[$index]" name="wireguard__dnsServer{{$index}}" on-change="WireguardEditor.dns.compareDnsConfiguration" validation-data="{allowPort: true}" validation="ip"><ndm-link ng-if="$index === 0" link-class="action-link" on-click="WireguardEditor.dns.addServer()" label="otherConnections.wireguard.editor.link.add-dns-server"></ndm-link><ndm-link ng-if="$index !== 0" link-class="action-link" on-click="WireguardEditor.dns.removeServer($index)" label="otherConnections.wireguard.editor.link.delete-dns-server"></ndm-link></ndm-input></div>'),e.put("app/page/controlPanel/myInternet/otherConnections/wireguard/wireguard.editor.html",'<div ng-controller="WireguardEditorController as WireguardEditor" ng-init="$parent.Wireguard.editor = WireguardEditor"><ndm-popup class="wireguard-editor" is-visible="WireguardEditor.isVisible" header-title="otherConnections.wireguard.editor.title" close="WireguardEditor.cancel" save="WireguardEditor.save" changes-checker-function="WireguardEditor.changesCheckerFunction"><div class="help-text" data-translate="">otherConnections.wireguard.editor.description</div><br><form class="wireguard-editor__form" name="WireguardEditor.form" novalidate=""><fieldset ng-disabled="WireguardEditor.ui.isLocked"><ndm-input label="otherConnections.wireguard.tunnel.description" model="WireguardEditor.model.description" name="wireguard__description" validation="required"></ndm-input><ndm-checkbox label="otherConnections.wireguard.tunnel.global" name="wireguard__isGlobal" model="WireguardEditor.model.isGlobal"></ndm-checkbox><div class="wireguard-editor__spacer"></div><ndm-input class="wireguard-editor__private-key" label="otherConnections.wireguard.tunnel.private-key.label" model="WireguardEditor.model.privateKey" name="{{WireguardEditor.PRIVATE_KEY_FIELD}}" max-length="44" placeholder="{{ WireguardEditor.model.privateKeyIsSet ? (\'otherConnections.wireguard.tunnel.private-key.key-exists-placeholder\' | translate) : \'\' }}" extra-validator="WireguardEditor.privateKey.validator" validation="base64,length[44..]"><ndm-button is-disabled="WireguardEditor.ui.isLocked" label="otherConnections.wireguard.editor.btn.generate-keypair" on-click="WireguardEditor.privateKey.generateNewKeypair"></ndm-button><ndm-button ng-if="WireguardEditor.model.privateKey && WireguardEditor.isValid(WireguardEditor.PRIVATE_KEY_FIELD)" is-disabled="WireguardEditor.ui.isLocked" label="otherConnections.wireguard.editor.btn.set-private-key" on-click="WireguardEditor.privateKey.save"></ndm-button></ndm-input><div class="wireguard-editor__public-key"><div class="wireguard-editor__public-key-label">{{ \'otherConnections.wireguard.tunnel.public-key\' | translate }}</div> <div><div ng-if="WireguardEditor.model.isNew && !WireguardEditor.model.privateKeyIsSet && !WireguardEditor.model.privateKey">{{ \'otherConnections.wireguard.editor.msg.click-generate-or-fill-the-field\' | translate }}</div> <div ng-if="WireguardEditor.isPristine(WireguardEditor.PRIVATE_KEY_FIELD) || !WireguardEditor.model.privateKey" class="wireguard-editor__public-key-value">{{ WireguardEditor.model.publicKey }}</div> <div ng-if="!WireguardEditor.isPristine(WireguardEditor.PRIVATE_KEY_FIELD) && WireguardEditor.model.privateKey" class="wireguard-editor__public-key-value" data-translate="">otherConnections.wireguard.editor.msg.save-private-key-to-update-public-key</div></div></div> <div ng-if="WireguardEditor.model.privateKeyIsSet" class="wireguard-editor__button-wrapper"><ndm-button is-disabled="!WireguardEditor.isPristine(WireguardEditor.PRIVATE_KEY_FIELD) && WireguardEditor.model.privateKey" class="wireguard-editor__copy-public-key" icon="copy" label="otherConnections.wireguard.editor.btn.copy-public-key" on-click="WireguardEditor.publicKey.copyToClipboard"></ndm-button><span ng-if="WireguardEditor.publicKey.isCopied" class="wireguard-editor__public-key-copied" data-translate="">otherConnections.wireguard.editor.msg.public-key-copied</span></div> <div class="wireguard-editor__spacer"></div><ndm-input label="otherConnections.wireguard.tunnel.address.label" placeholder="{{ \'otherConnections.wireguard.tunnel.address.placeholder\' | translate }}" model="WireguardEditor.model.address" name="wireguard__address" validation-data="{subnets: WireguardEditor.usedSubnets}" validation="required,ipAndCidr,notInNetsInline"></ndm-input><ndm-input label="otherConnections.wireguard.tunnel.listen-port.label" model="WireguardEditor.model.listenPort" name="wireguard__listenPort" placeholder="{{ \'otherConnections.wireguard.tunnel.listen-port.placeholder\' | translate }}" validation="intRange[1,65535]" extra-validator="WireguardEditor.isListenPortUnique"></ndm-input><div ng-include="\'app/page/controlPanel/myInternet/otherConnections/wireguard/wireguard.editor.dnsServers.html\'"></div><ndm-details label-visible="otherConnections.wireguard.tunnel.show-additional-settings" label-hidden="otherConnections.wireguard.tunnel.hide-additional-settings"><ndm-input label="otherConnections.wireguard.tunnel.mtu.label" model="WireguardEditor.model.mtu" name="wireguard__mtu" placeholder="64…65535" validation="intRange[64,65535]"></ndm-input><ndm-checkbox model="WireguardEditor.model.adjustTcpMss" name="wireguard__adjustTcpMss" label="otherConnections.wireguard.tunnel.adjust-tcp-mss"></ndm-checkbox></ndm-details></fieldset></form><form name="WireguardEditor.peersForm" class="wireguard-editor__form" novalidate=""><fieldset ng-disabled="WireguardEditor.ui.isLocked"><div ng-include="\'app/page/controlPanel/myInternet/otherConnections/wireguard/wireguard.editor.peerArray.html\'"></div></fieldset></form><br><div class="wireguard-editor__button-wrapper"><ndm-button is-disabled="WireguardEditor.ui.isLocked" on-click="WireguardEditor.peer.addNew" label="otherConnections.wireguard.editor.btn.add-peer"></ndm-button></div><hr class="hr-light-blue"><ndm-button ng-if="!WireguardEditor.model.isNew" class="wireguard-editor__delete-connection-btn" btn-class="btn--warning" on-click="WireguardEditor.deleteConnection" label="otherConnections.wireguard.editor.btn.delete-connection"></ndm-button><div class="wireguard-editor__bottom-spacer"></div><ndm-control-footer ng-if="WireguardEditor.isVisible" prefix="wireguard" is-visible="WireguardEditor.isConfigurationModified() || WireguardEditor.model.isNew" is-popup="true" is-save-disabled="WireguardEditor.form.$invalid || WireguardEditor.peersForm.$invalid || WireguardEditor.ui.isLocked" save="WireguardEditor.save()" cancel="WireguardEditor.cancel()"></ndm-control-footer></ndm-popup></div>'),e.put("app/page/controlPanel/myInternet/otherConnections/wireguard/wireguard.editor.peerAllowedSubnets.html",'<div class="wireguard-peer-allowed-ips" ng-init="peerIndex = $index" bs-modifiable="false"><ndm-input ng-repeat="subnet in peer.allowedSubnets track by $index" class="wireguard-peer-allowed-ips__input" label="{{ $index > 0 ? \'&nbsp;\' : \'otherConnections.wireguard.peer.allowed-subnets.label\' }}" model="peer.allowedSubnets[$index]" name="peer__{{peerIndex}}__allowedSubnet__{{$index}}" on-change="WireguardEditor.peer.comparePeerConfiguration" validation="isNetInline"><ndm-link ng-if="$index === 0" class="action-link" on-click="WireguardEditor.peer.addAllowedSubnet(peerIndex)" label="otherConnections.wireguard.editor.link.add-peer-subnet"></ndm-link><ndm-link ng-if="$index !== 0" class="action-link" on-click="WireguardEditor.peer.removeAllowedSubnet(peerIndex, $index)" label="otherConnections.wireguard.editor.link.remove-peer-subnet"></ndm-link></ndm-input></div>'),e.put("app/page/controlPanel/myInternet/otherConnections/wireguard/wireguard.editor.peerArray.html",'<div class="wireguard-peer-array"><div ng-repeat="peer in WireguardEditor.model.peers track by $index" ng-form="WireguardEditor.form.peerForm{{$index}}" class="wireguard-peer"><hr class="hr-light-blue"><div class="wireguard-peer__header-row"><h2 class="wireguard-peer__header" data-translate="">otherConnections.wireguard.peer.block-header</h2><div class="wireguard-peer__delete-peer-link" ng-click="WireguardEditor.peer.remove($index)"><i class="icon icon--trash"></i> <span data-translate="">otherConnections.wireguard.editor.btn.delete-peer</span></div></div><ndm-input label="otherConnections.wireguard.peer.description" model="peer.description" name="peer__{{$index}}__description"></ndm-input><ndm-input label="otherConnections.wireguard.peer.public-key" model="peer.publicKey" max-length="44" name="peer__{{$index}}__publicKey" extra-validator="WireguardEditor.peer.isPublicKeyUnique" error="peer.publicKeyError" validation="required,base64,length[44..]"></ndm-input><ndm-input label="otherConnections.wireguard.peer.preshared-key.label" placeholder="{{ \'otherConnections.wireguard.peer.preshared-key.placeholder\' | translate }}" model="peer.presharedKey" max-length="44" name="peer__{{$index}}__presharedKey" validation="base64,length[44..]"></ndm-input><ndm-input label="otherConnections.wireguard.peer.endpoint.label" placeholder="{{ \'otherConnections.wireguard.peer.endpoint.placeholder\' | translate }}" model="peer.endpoint" name="peer__{{$index}}__endpoint" validation-data="{allowPort: true}" validation="ipOrDomain"></ndm-input><div ng-include="\'app/page/controlPanel/myInternet/otherConnections/wireguard/wireguard.editor.peerAllowedSubnets.html\'"></div><ndm-input label="otherConnections.wireguard.peer.keepalive.label" placeholder="3…3600" model="peer.keepaliveInterval" name="peer__{{$index}}__keepaliveInterval" unit-text="time.second" validation="intRange[3,3600]"></ndm-input></div></div>'),e.put("app/page/controlPanel/myInternet/otherConnections/wireguard/wireguard.section.html",'<div class="otherConnections-section wireguard-section" ng-controller="WireguardController as Wireguard"><ndm-form-header hr="{{::(Wireguard.HR_IS_VISIBLE) ? \'hr-light-blue\' : \'\'}}" label="otherConnections.wireguard.header" sub-title="otherConnections.wireguard.description"></ndm-form-header><div ng-if="!Wireguard.table.dataLoaded || Wireguard.table.data.length === 0" class="empty-list"><span ng-if="!Wireguard.table.dataLoaded" data-translate="">loading</span> <span ng-if="Wireguard.table.dataLoaded && Wireguard.table.data.length === 0" data-translate="">otherConnections.no-connections</span></div><table ng-if="Wireguard.table.data.length > 0" class="wireguard-section__connections-table wireguard-table"><thead class="wireguard-table__header"><tr class="wireguard-table__header-row"><th ng-repeat="column in Wireguard.table.columns track by $index" class="wireguard-table__cell wireguard-table__header-cell wireguard-table__cell--{{column.property}}" data-translate="">{{column.title}}</th></tr></thead><tbody ng-repeat="connection in Wireguard.table.data track by connection.id" class="wireguard-table__connection" ng-click="Wireguard.editConnection(connection, $index)"><tr class="wireguard-table__row" ng-repeat="peer in connection.tableRows track by $index" ng-class="{ \'wireguard-table__description-row\': $index === 0, \'wireguard-table__peer\': $index !== 0, \'wireguard-table__description-row--last\': connection.peers.length < 2 }"><td class="wireguard-table__cell wireguard-table__cell--isEnabled"><div ng-if="$index === 0" class="wireguard-table__connection-description-cell"><ndm-toggle label-on="" label-off="" model="connection.isEnabled" name="{{connection.id}}" call-on-change="connection.onToggleClick"></ndm-toggle><div class="wireguard-table__connection-description" ng-attr-title="{{connection.description | escapeHtml}}">{{ connection.description | escapeHtml}}</div></div></td><td class="wireguard-table__cell wireguard-table__cell--address"><div ng-if="$index === 0" class="wireguard-table__connection-address">{{connection.address}}<span ng-if="connection.currentListenPort">:{{connection.currentListenPort}}</span></div></td><td class="wireguard-table__cell wireguard-table__cell--peer"><div ng-if="!peer.dummy" class="wireguard-table__peer-description"><i ng-if="peer.status" class="icon icon--{{peer.status.icon}} wireguard-table__peer-icon" title="{{peer.status.text | translate}}"></i> <div class="wireguard-table__peer-name"><span ng-if="peer.description" ng-attr-title="{{peer.description | escapeHtml}}">{{ peer.description | escapeHtml}}</span> <em ng-if="!peer.description" class="wireguard-table__peer-without-name" data-translate="">{{ \'otherConnections.wireguard.table.peer-without-name\' }}</em></div></div></td><td class="wireguard-table__cell wireguard-table__cell--sent"><span class="nowrap" ng-bind-html="(peer.txrx.txbytes | sizeFormat) || Wireguard.EMPTY_VAL_HTML"></span></td><td class="wireguard-table__cell wireguard-table__cell--received"><span class="nowrap" ng-bind-html="(peer.txrx.rxbytes | sizeFormat) || Wireguard.EMPTY_VAL_HTML"></span></td><td class="wireguard-table__cell wireguard-table__cell--endpoint" ng-bind-html="peer.endpoint || Wireguard.EMPTY_VAL_HTML"></td><td class="wireguard-table__cell wireguard-table__cell--lastHandshake" ng-bind-html="peer.lastHandshake === \'\' ? Wireguard.EMPTY_VAL_HTML : peer.lastHandshake"></td></tr></tbody></table><div class="wireguard-section__toolbar"><ndm-button is-disabled="Wireguard.isAddNewTunnelBtnLocked" label="otherConnections.wireguard.add-connection" on-click="Wireguard.addNewTunnel"></ndm-button><div class="wireguard-section__config-importer" ng-class="{ \'wireguard-section__config-importer--locked\': Wireguard.configImporter.isLocked }"><label class="wireguard-section__config-importer-label btn" for="{{Wireguard.configImporter.inputId}}"><span data-translate="">{{ \'otherConnections.wireguard.import-from-config-file\' }}</span> <input ng-if="!Wireguard.configImporter.isLocked" class="wireguard-section__config-importer-input" type="file" value="Wireguard.configImporter.file" id="{{Wireguard.configImporter.inputId}}"></label></div></div> <div ng-include="\'app/page/controlPanel/myInternet/otherConnections/wireguard/wireguard.editor.html\'"></div></div>'),e.put("app/page/controlPanel/myInternet/sms/deleteModal/sms.deleteModal.html",'<div ng-controller="SmsDeleteModalController as vm"><ndm-popup-small is-visible="vm.isVisible" show-close-btn="false"><div class="ndm-popup-small__content ndm-popup-small__content--remove"><div class="ndm-popup-small__title" data-translate="">{{ vm.l10n.title }}</div> <div class="ndm-popup-small__desc" data-translate="">{{ vm.l10n.text }}</div> <div class="ndm-popup-small__buttons"><ndm-button-new btn-class="ndm-button-new--red" btn-text="{{ vm.l10n.deleteBtn }}" is-disabled="vm.isLocked" on-click="vm.deleteMessage"></ndm-button-new><ndm-button-new btn-class="ndm-button-new--grey" btn-text="{{ vm.l10n.cancelBtn }}" on-click="vm.cancel"></ndm-button-new></div></div></ndm-popup-small></div>'),e.put("app/page/controlPanel/myInternet/sms/dialog/sms.dialog.html",'<div class="sms-pool" ng-controller="SmsDialogController as vm" ng-show="vm.isVisible"><div class="sms-pool__header"><div class="sms-pool__header-container sms-pool__header-container--dialog"><div class="sms-pool__header-wrapper"><button class="sms-pool__prev-button" type="button" ng-click="vm.showAllDialogs()"><ndm-svg-icon width="18" height="12" svg-id="sms-arrow-blue"></ndm-svg-icon></button> <div class="sms-pool__message-title">{{ vm.currentDialog.from }}</div></div> <button class="sms-pool__remove-all" ng-click="vm.deleteAllMessages()" data-translate="">sms.dialog.delete-all-messages</button></div></div> <div class="sms-pool__body sms-pool__body--dialog"><div class="sms-pool__scroll sms-pool__scroll--dialog" init-scroll=""><div class="sms-dialog"><div class="sms-dialog__message" ng-repeat="message in vm.messages | orderBy:\'timestamp\' track by message.id" ng-class="{ \'sms-dialog__message--separator\': message.isSeparator, \'sms-dialog__message--visible\': message.isVisible }" id="{{ message.id }}"><div ng-if="message.isSeparator">{{ message.text }}</div> <div ng-if="!message.isSeparator"><button type="button" class="sms-dialog__remove" ng-click="vm.deleteMessage(message)"><ndm-svg-icon width="20" height="14" svg-id="sms-remove"></ndm-svg-icon></button><div class="sms-dialog__text">{{ message.text }}</div> <div class="sms-dialog__inner"><button class="sms-dialog__forward" type="button" ng-disabled="vm.simStateIsInvalid" ng-click="vm.forwardMessage(message)"><ndm-svg-icon class="sms-dialog__forward-icon" width="18" height="12" svg-id="sms-forward"></ndm-svg-icon><span data-translate="">sms.dialog.forward-message</span></button> <div class="sms-dialog__meta"><div class="sms-dialog__storage-type" title="{{\'sms.dialog.\' + message.storageType | translate}}"><ndm-svg-icon width="14" height="14" svg-id="{{message.storageType}}"></ndm-svg-icon></div> <div class="sms-dialog__time">{{ message.timestamp | date:\'HH:mm\' }}</div></div></div></div></div></div></div></div> <div class="sms-pool__footer"><div ng-show="vm.currentDialog.userCanReply" class="sms-dialog__textarea"><div class="sms-dialog__textarea-wrap" ng-class="{ \'sms-dialog__textarea-wrap--active\': vm.messageInput.isInFocus }"><textarea class="sms-dialog__textarea-input" ng-model="vm.messageInput.text" ng-focus="vm.messageInput.isInFocus = true" ng-blur="vm.messageInput.isInFocus = false" ng-change="vm.messageInput.onChange(vm.messageInput.text)" rows="1" maxlength="9999" placeholder="{{ \'sms.dialog.new-sms-placeholder\' | translate }}"></textarea><button class="sms-dialog__send" ng-class="{ \'sms-dialog__send--disabled\': !vm.messageInput.text || vm.isSendLocked, \'sms-dialog__send--count\': vm.messageInput.charsLeft < 0 }" ng-click="vm.sendMessage()" ng-disabled="vm.isSendLocked"><span>{{ vm.messageInput.charsLeft }}</span></button></div> <div class="sms-dialog__sms-count"><span ng-show="vm.messageInput.text" data-translate="sms.message-text.consists-of-x-parts" data-translate-values="{num: vm.messageInput.chunksNum}"></span></div></div></div></div>'),e.put("app/page/controlPanel/myInternet/sms/messageEditor/sms.messageEditor.html",'<div ng-controller="SmsMessageEditorController as vm" class="sms-message-editor"><ndm-popup-small is-visible="vm.isVisible" show-close-btn="true" on-close="vm.closePopup" popup-class="ndm-popup-small__container--wide sms-message-editor"><div class="ndm-popup-small__content" ng-cloak=""><form action="" autocomplete="off" novalidate=""><h2 class="ndm-popup-small__message-title" data-translate="">sms.message-editor.title</h2><div class="ndm-popup-small__form-group phone-input"><div class="phone-input__label" data-translate="">sms.message-editor.send-message-to</div><ndm-input name="phoneNumber" focus-when="vm.isVisible" class-name="phone-input__input" placeholder="{{ \'sms.message-editor.phone-placeholder\' | translate }}" model="vm.phoneNumber.value" extra-validator="vm.phoneNumber.validator" on-validation-end="vm.ui.updateFooterStatus" validation="required"></ndm-input></div> <div class="ndm-popup-small__form-group sms-textarea"><label class="sms-textarea__label" data-translate="">sms.message-editor.message-text</label> <div class="sms-textarea__textarea-wrapper"><textarea class="sms-textarea__textarea" ng-model="vm.messageText" ng-change="vm.onMessageTextChange(vm.messageText)"></textarea></div> <div class="sms-textarea__counts"><div ng-show="vm.messageText" class="sms-textarea__sms-count" data-translate="sms.message-text.consists-of-x-parts" data-translate-values="{num: vm.chunksNum}"></div> <div ng-show="vm.messageText" class="sms-textarea__sms-count" ng-class="{ \'sms-textarea__sms-count--warning\': vm.charsLeft < 0 }" data-translate="sms.message-text.symbols-left" data-translate-values="{num: vm.charsLeft}"></div></div></div> <div class="ndm-popup-small__buttons ndm-popup-small__footer-desktop"><ndm-button-new is-disabled="vm.ui.isSendButtonDisabled()" btn-class="ndm-button-new--blue ndm-button-new--wide" btn-text="sms.message-editor.send-message-button" ng-click="vm.sendMessage()"></ndm-button-new><ndm-button-new btn-class="ndm-button-new--grey ndm-button-new--wide" btn-text="sms.message-editor.cancel-message-button" ng-click="vm.closePopup()"></ndm-button-new></div> <div class="ndm-popup-small__footer-mobile"><ndm-button-new is-disabled="vm.ui.isSendButtonDisabled()" class="ndm-popup-small__desk-hidden" btn-class="ndm-button-new--blue ndm-button-new--stretch" btn-text="sms.message-editor.send-message-button" ng-click="vm.sendMessage()"></ndm-button-new></div></form></div></ndm-popup-small></div>'),e.put("app/page/controlPanel/myInternet/sms/previews/sms.previews.html",'<div class="sms-pool sms-previews" ng-controller="SmsPreviewsController as vm" ng-show="vm.isVisible"><div class="sms-pool__header"><div class="sms-pool__header-container"><div class="sms-pool__header-wrapper"><div class="sms-pool__header-icon" ng-class="{ \'sms-pool__header-icon--warning\': vm.showFreeSlotsWarning && !vm.isLoading }"><ndm-svg-icon width="22" height="18" svg-id="sms-mail"></ndm-svg-icon></div> <div ng-if="!vm.isLoading" class="sms-pool__header-title"><span ng-show="vm.slotsUsed > 0 && !vm.showFreeSlotsWarning" data-translate="sms.previews.sms-messages-count" data-translate-values="{num: vm.slotsUsed, freeMemory: vm.freeDeviceSlotsPercentage}"></span> <div ng-show="vm.showFreeSlotsWarning"><span data-translate="sms.previews.few-free-sms-slots-warning" data-translate-values="{num: vm.freeSlotsLeft}"></span> <button class="sms-pool__header-remove" ng-click="vm.deleteAllMessages()" data-translate="">sms.previews.delete-all</button></div></div> <div ng-if="vm.isLoading" class="sms-pool__header-title"><i class="icon icon--load"></i></div> <button ng-disabled="!vm.modemStateIsOk || vm.isLoading" class="sms-pool__button sms-pool__new-message-button" ng-click="vm.sendNewMessage()" data-translate="">sms.previews.new-message</button></div></div></div> <div class="sms-pool__body sms-pool__body--previews" ng-class="{ \'sms-pool__body--no-data\': vm.dialogs.length === 0 }"><div class="sms-pool__scroll" init-scroll=""><div class="sms-previews"><div ng-if="vm.dialogs.length === 0" class="sms-previews__no-data-text"><span ng-if="!vm.isLoading" data-translate="">{{ vm.modemIsOff ? \'sms.previews.modem-is-off\' : \'sms.previews.no-messages\' }}</span> <span ng-if="vm.isLoading" class="sms-previews__loader" data-translate="">sms.previews.loading-dialogs</span></div> <div class="sms-preview" ng-repeat="dialog in vm.dialogs track by $index" ng-click="vm.openDialog(dialog, $index)"><div class="sms-preview__wrapper-message" ng-class="{ \'sms-preview__wrapper-message--unread\': dialog.hasUnread }"><div class="sms-preview__title"><div ng-if="dialog.hasUnread" class="sms-preview__unread-count"><div>{{ dialog.unreadCount }}</div></div> <div class="sms-preview__from">{{ dialog.from }}</div> <div class="sms-preview__time">{{ dialog.latest.timestamp | smsDate }}</div></div> <div class="sms-preview__message">{{ dialog.latest.text }}</div></div></div></div></div></div> <div class="sms-pool__footer"></div></div>'),e.put("app/page/controlPanel/myInternet/sms/sendingMessageResultModal/sms.sendingMessageResultModal.html",'<div ng-controller="SmsSendingMessageResultModalController as vm"><ndm-popup-small is-visible="vm.isVisible"><div class="ndm-popup-small__content ndm-popup-small__content--remove"><div class="ndm-popup-small__icon-center"><ndm-svg-icon width="40" height="40" svg-id="{{ vm.isResultSuccessful ? \'sms-success-icon\' : \'sms-warning\' }}"></ndm-svg-icon></div> <div class="ndm-popup-small__title" data-translate="">{{ vm.l10n.title }}</div> <div class="ndm-popup-small__desc" data-translate="">{{ vm.l10n.description }}</div> <div ng-if="vm.isResultSuccessful" class="ndm-popup-small__button"><ndm-button-new btn-class="ndm-button-new--grey" btn-text="sms.sending-message-result-modal.success-button" on-click="vm.close"></ndm-button-new></div> <div ng-if="!vm.isResultSuccessful" class="ndm-popup-small__button"><ndm-button-new btn-class="ndm-button-new--blue" btn-text="sms.sending-message-result-modal.failure-retry-button" on-click="vm.retry"></ndm-button-new><ndm-button-new btn-class="ndm-button-new--grey" btn-text="sms.sending-message-result-modal.failure-cancel-button" on-click="vm.close"></ndm-button-new></div></div></ndm-popup-small></div>'),e.put("app/page/controlPanel/myNetwork/devicesList/ndm-title/ndm-title.html",'<h2 class="ndm-title tretiary-title"><span data-translate="">{{title}}</span> <span ng-transclude=""></span></h2>'),e.put("app/page/controlPanel/myNetwork/segments/chilli/chilli.fields.html",'<ndm-input ng-show="vm.isFieldVisible(\'uamserver\', inPopup)" disabled="vm.isFieldDisabled(\'uamserver\', inPopup)" label="segments.chilli.uamserver" name="chilli.uamserver" model="vm.data.uamserver"></ndm-input><ndm-input ng-show="vm.isFieldVisible(\'uamsecret\', inPopup)" disabled="vm.isFieldDisabled(\'uamsecret\', inPopup)" label="segments.chilli.uamsecret" name="chilli.uamsecret" validation="password" model="vm.data.uamsecret"></ndm-input><ndm-input ng-show="vm.isFieldVisible(\'radiusserver1\', inPopup)" disabled="vm.isFieldDisabled(\'radiusserver1\', inPopup)" label="segments.chilli.radiusserver1" name="chilli.radiusserver1" validation="ipOrDomain" model="vm.data.radiusserver1"></ndm-input><ndm-input ng-show="vm.isFieldVisible(\'radiusserver2\', inPopup)" disabled="vm.isFieldDisabled(\'radiusserver2\', inPopup)" label="segments.chilli.radiusserver2" name="chilli.radiusserver2" validation="ipOrDomain" model="vm.data.radiusserver2"></ndm-input><ndm-input ng-show="vm.isFieldVisible(\'radiussecret\', inPopup)" disabled="vm.isFieldDisabled(\'radiusnasid\', inPopup)" label="segments.chilli.radiussecret" name="chilli.radiusSecret" validation="password" model="vm.data.radiussecret"></ndm-input><ndm-input ng-show="vm.isFieldVisible(\'radiusnasid\', inPopup)" disabled="vm.isFieldDisabled(\'radiusnasid\', inPopup)" label="segments.chilli.radiusnasid" name="chilli.radiusNasId" model="vm.data.radiusnasid"></ndm-input><ndm-input ng-show="vm.isFieldVisible(\'radiuslocationname\', inPopup)" disabled="vm.isFieldDisabled(\'radiuslocationname\', inPopup)" label="segments.chilli.radiuslocationname" name="chilli.radiuslocationname" model="vm.data.radiuslocationname"></ndm-input><ndm-input ng-show="vm.isFieldVisible(\'radiuslocationid\', inPopup)" disabled="vm.isFieldDisabled(\'radiuslocationid\', inPopup)" label="segments.chilli.radiuslocationid" name="chilli.radiusLocationId" model="vm.data.radiuslocationid"></ndm-input><ndm-input ng-show="vm.isFieldVisible(\'dns1\', inPopup)" disabled="vm.isFieldDisabled(\'dns1\', inPopup)" label="DNS 1" name="chilli.dns1" validation="ip" model="vm.data.dns1"></ndm-input><ndm-input ng-show="vm.isFieldVisible(\'dns2\', inPopup)" disabled="vm.isFieldDisabled(\'dns2\', inPopup)" label="DNS 2" name="chilli.dns2" validation="ip" model="vm.data.dns2"></ndm-input><ndm-form-header ng-show="vm.isFieldVisible(\'uamallowed\', inPopup)" label="segments.chilli.uamallowed"></ndm-form-header><ndm-text ng-show="vm.isFieldVisible(\'uamallowed\', inPopup)" text="segments.chilli.uamallowed-description"></ndm-text><ndm-multi-input-table ng-show="vm.isFieldVisible(\'uamallowed\', inPopup)" disabled="vm.isFieldDisabled(\'uamallowed\', inPopup)" ng-model="vm.data.uamallowed" label="segments.chilli.uamallowed" description="segments.chilli.uamallowed-description" header="segments.chilli.uamallowed-table-header" add-caption="segments.chilli.uamallowed-add" extra-validator="vm.uamAllowedValidator" max="64"></ndm-multi-input-table><ndm-form-header ng-show="vm.isFieldVisible(\'uamdomain\', inPopup)" label="segments.chilli.uamdomain"></ndm-form-header><ndm-text ng-show="vm.isFieldVisible(\'uamdomain\', inPopup)" text="segments.chilli.uamdomain-description"></ndm-text><ndm-multi-input-table ng-show="vm.isFieldVisible(\'uamdomain\', inPopup)" disabled="vm.isFieldDisabled(\'uamdomain\', inPopup)" ng-model="vm.data.uamdomain" header="segments.chilli.uamdomain-table-header" add-caption="segments.chilli.uamdomain-add" validation="ipOrDomain" max="64"></ndm-multi-input-table>'),e.put("app/page/controlPanel/myNetwork/segments/chilli/chilli.section.html",'<div class="segment-chilli" ng-controller="ChilliSectionController as vm" ng-init="segments.subCtrl.register(CHILLI = vm, \'CHILLI\');"><div ng-if="!segments.activeSegment.isHomeSegment"><ndm-form-header hr="hr-light-blue" label="segments.chilli.title" sub-title="segments.chilli.description"></ndm-form-header><div ng-if="vm.chilliSegment && vm.chilliSegment !== vm.options.currentSegment"><span data-translate="">segments.chilli.used-in-other-segment</span> <a ng-click="vm.chilliSegment = vm.options.currentSegment" class="action-link" data-translate="">segments.chilli.switch-to-this-segment</a></div><input type="hidden" name="chilli.segment" ng-model="vm.chilliSegment"> <div ng-if="!vm.chilliSegment || vm.chilliSegment === vm.options.currentSegment"><ndm-checkbox model="vm.enabled" label="segments.chilli.enabled" name="chilli.enabled"></ndm-checkbox><ndm-sub-form ng-if="vm.enabled"><ndm-selectbox disabled="segments.ui.locked" label="segments.chilli.profile" options="vm.options.profileSelectOptions" value="vm.data.profile" description="{{(vm.options.profilesLoading && vm.data.profile) || +vm.data.profile === -1 ? \'\' : \'segments.chilli.show-advanced-settings\'}}" on-description-click="vm.advancedSettings.show()" is-updating="vm.options.profilesLoading" on-open="vm.onSelectOpen();" name="chilli.profile"></ndm-selectbox><div ng-if="vm.data.profile !== -1" ng-init="inPopup = false;" ng-include="\'app/page/controlPanel/myNetwork/segments/chilli/chilli.fields.html\'"></div></ndm-sub-form><ndm-popup ng-if="vm.options.isPopupVisible && vm.enabled" is-visible="1" header-title="segments.chilli.advanced-settings-popup-title" close="vm.advancedSettings.cancel" save="vm.advancedSettings.accept"><ng-form name="vm.form"><button ng-if="vm.data.profile" class="btn page-segments-chilli__btn-customize" ng-click="vm.advancedSettings.customize()" data-translate="">segments.chilli.customize-profile</button><ndm-form-header label="segments.chilli.advanced-settings-popup-main-subtitle"></ndm-form-header><div ng-init="inPopup = true;" ng-include="\'app/page/controlPanel/myNetwork/segments/chilli/chilli.fields.html\'"></div><ndm-control-footer prefix="segmentChilli" ng-if="!vm.data.profile" is-visible="1" is-popup="true" is-save-disabled="(vm.form.$invalid || !vm.form.modified) && !vm.advancedSettings.customizeMode" save="vm.advancedSettings.accept()" cancel="vm.advancedSettings.cancel()"></ndm-control-footer><div class="page-segments-chilli__spacer"></div></ng-form></ndm-popup></div></div></div>'),e.put("app/page/controlPanel/myNetwork/trafficMonitor/chartHint/trafficMonitor.chartHint.html",'<div ng-controller="TrafficMonitorChartHintController as vm"><div class="page-traffic-monitor__chart-hint-time">{{vm.time}}</div> <div class="page-traffic-monitor__chart-hint-host" ng-repeat="host in vm.hosts | orderBy:\'-sum\' track by host.mac" ng-class="{ \'page-traffic-monitor__chart-hint-host--not-selected\': vm.activeTabHost && vm.activeTabHost.mac !== host.mac }"><span class="page-traffic-monitor__chart-hint-color-rect page-traffic-monitor__chart-hint-color-rect--{{host.style.extraClass}}" ng-style="{ \'background-color\': host.style.color }"></span> <b class="page-traffic-monitor__chart-hint-host-name">{{host.name}}</b> <i class="page-traffic-monitor__chart-hint-rx-icon"></i> <span>{{host.download}}</span> <i class="page-traffic-monitor__chart-hint-tx-icon"></i> <span>{{host.upload}}</span></div></div>'),e.put("app/page/controlPanel/myNetwork/trafficMonitor/chartLegend/trafficMonitor.chartLegend.html",'<div class="page-traffic-monitor__table"><div class="page-traffic-monitor__table__legend"><ul ng-if="vm.hosts.length || !vm.noRegisteredHosts" class="page-traffic-monitor__table__legend__host-list"><li class="page-traffic-monitor__table__legend__host-list__total" ng-click="vm.chartLegend.resetSelectedHost()" ng-class="{ \'page-traffic-monitor__table__legend__host-list__item--selected\': !vm.chartLegend.host || vm.activeTabHost }"><h3 class="page-traffic-monitor__table__legend__host-list__total__title">{{vm.activeTabHost ? \'traffic-monitor.legend.to-one-host-header\' : \'traffic-monitor.legend.top-5-header\' | translate}}</h3><p class="page-traffic-monitor__table__legend__host-list__total__download"><i class="page-traffic-monitor__rx-icon"></i> {{vm.sum.rxbytes | sizeFormat: vm.l10n.lang}} <span class="page-traffic-monitor__table__legend__host-list__total__upload">/ {{vm.sum.txbytes | sizeFormat: vm.l10n.lang}} <i class="page-traffic-monitor__tx-icon"></i></span></p></li><li class="page-traffic-monitor__table__legend__host-list__item" ng-repeat="host in vm.hosts | orderBy:\'-sum\' track by host.mac" ng-click="vm.chartLegend.selectHost(host.mac)" ng-dblclick="vm.chartLegend.displayHostInSeparateTab(host.mac)" ng-class="{ \'page-traffic-monitor__table__legend__host-list__item--alone\': vm.activeTabHost, \'page-traffic-monitor__table__legend__host-list__item--selected\': vm.chartLegend.host === host.mac && !vm.activeTabHost }"><div class="page-traffic-monitor__table__legend__host-list__item__rect" ng-style="{\'background-color\': host.style.color}" ng-class="{[\'page-traffic-monitor__table__legend__host-list__item__rect--extra--\' + host.style.extraClass]: !!host.style.extraClass}"></div> <div class="page-traffic-monitor__table__legend__host-list__item__col"><span class="page-traffic-monitor__table__legend__host-list__item__title">{{host.name}}</span> <div class="page-traffic-monitor__table__legend__host-list__item__meter"><div class="page-traffic-monitor__table__legend__host-list__item__meter__inner" ng-style="{ \'width\': (host.sum / vm.sum.total * 100 | number: 0) + \'%\', \'background-color\': host.style.color }"></div></div> <div class="page-traffic-monitor__table__legend__host-list__item__description"><i class="page-traffic-monitor__rx-icon--small"></i> {{host.rxbytes | sizeFormat: vm.l10n.lang}} / {{host.txbytes | sizeFormat: vm.l10n.lang}} <i class="page-traffic-monitor__tx-icon--small"></i> ({{host.sum / vm.sum.total * 100 | number: 0}}%)</div></div></li></ul><div ng-if="!vm.hosts.length" class="page-traffic-monitor__empty-hosts"><div ng-if="vm.noRegisteredHosts" class="page-traffic-monitor__empty-hosts-header"></div> <div ng-if="vm.noRegisteredHosts" class="page-traffic-monitor__empty-hosts-sub-header"></div> <div ng-if="!vm.noRegisteredHosts">{{\'traffic-monitor.no-devices-appeared-online-yet\' | translate}}</div><ul ng-if="!vm.noRegisteredHosts" class="page-traffic-monitor__empty-hosts-list"><li ng-repeat="host in [1, 2, 3, 4, 5]" class="page-traffic-monitor__empty-hosts-list-item"><div class="page-traffic-monitor__empty-hosts-rect"></div> <div class="page-traffic-monitor__empty-hosts-device-name"></div> <div class="page-traffic-monitor__empty-hosts-device-statistic"></div></li></ul></div></div></div>'),e.put("app/page/controlPanel/myNetwork/trafficMonitor/devicesList/trafficMonitor.devicesList.html",'<div class="page-traffic-monitor__table" ng-controller="TrafficMonitorDevicesListController as vm"><h3 class="page-traffic-monitor__device-list-header" data-translate="">traffic-monitor.device-list.header</h3><input type="text" class="page-traffic-monitor__filter" placeholder="{{vm.l10n.deviceListFilterPlaceholder}}" ng-change="vm.filterRegisteredDevices(vm.filterString)" ng-model="vm.filterString"> <div class="page-traffic-monitor__registered-devices" init-scroll=""><ul class="white-list white-list--stretch"><li class="white-list__item" ng-repeat="host in vm.devicesFiltered track by host.mac" ng-click="vm.select(host)" ng-dblclick="vm.displayHostInSeparateTab(host)" ng-class="{ \'white-list__item--unselectable\': vm.isHostTracked(host), \'white-list__item--selected\': vm.getSelected().mac === host.mac }">{{host.name}} <span ng-if="vm.isHostTracked(host)" class="white-list__already-exists" data-translate="">traffic-monitor.device-list.is-already-showed</span></li></ul></div><ndm-button class="page-traffic-monitor__track-device-button-wrapper" btn-class="page-traffic-monitor__track-device-button btn--primary" is-disabled="!vm.isSelected()" on-click="vm.confirmSelected" label="traffic-monitor.device-list.show-device-button"></ndm-button><p ng-if="vm.getNotRegisteredCount() > 0" class="page-traffic-monitor__device-list-description">{{\'traffic-monitor.device-list.description\' | translate}}<br><br>{{vm.l10n.deviceListPrompt}} <a data-ui-sref="controlPanel.devicesList()" class="ref-link" data-translate="">register</a>.</p></div>'),e.put("app/page/controlPanel/myNetwork/trafficMonitor/ndm-bar-chart/ndm-bar-chart.html",'<svg class="ndm-bar-chart" version="1.1" xml:space="preserve" ng-class="{ \'ndm-bar-chart--locked\': vm.options.locked, \'ndm-bar-chart--dummy\': vm.options.dummy, \'ndm-bar-chart--loading\': vm.options.loading }" xmlns="http://www.w3.org/2000/svg"><defs><pattern id="ndm-bar-chart__extra-unregistered--pattern" patternunits="userSpaceOnUse" width="4" height="4"><path d="M-1,1 l2,-2 M0,4 l4,-4 M3,5 l2,-2" style="stroke:gray; stroke-width:0.5"></path></pattern><filter id="ndm-bar-chart__inner-glow"><feflood flood-color="black"><fecomposite in2="SourceAlpha" operator="out"><fegaussianblur stddeviation="1" result="blur"><fecomposite operator="atop" in2="SourceGraphic"></fecomposite></fegaussianblur></fecomposite></feflood></filter></defs></svg>'),e.put("app/page/controlPanel/myNetwork/trafficMonitor/tabs/trafficMonitor.tabs.html",'<div ng-controller="TrafficMonitorTabsController as vm"><ndm-tabs ng-if="vm.isReady" tabs="vm.array" add-tab-btn-label="traffic-monitor.tabs.add-new-device-tab-btn" new-tab-constructor-fn="vm.addTab" add-tab-btn-is-disabled="vm.parentController.ui.isLocked() || vm.isActiveTabNew()" on-tab-changed-fn="vm.setActiveTab" on-tab-remove-fn="vm.removeTab" update-state-on-tab-change="true"></ndm-tabs></div>'),e.put("app/page/controlPanel/myNetwork/trafficMonitor/timezone/trafficMonitor.timezone.html",'<div ng-controller="TrafficMonitorTimezoneController as vm"><div class="page-traffic-monitor__timezone" ndm-polling="vm.poll()"><ndm-checkbox ng-show="vm.timeShiftIsBigEnough && !vm.timeShiftIsTooBig" name="timezone" class="page-traffic-monitor__timezone-toggle" on-value-change="vm.toggle" model="vm.isKeeneticTimezoneUsed" label="traffic-monitor.use-keenetic-timezone"></ndm-checkbox></div></div>'),e.put("app/page/controlPanel/myNetwork/wifiSystem/controller/ws.controller.view.html",'<div class="page-wifi-system__controller" ng-controller="MWSControllerController as vm"><div class="controller__container"><div class="controller__panel" ng-class="{ \'controller__panel--loading\': !vm.isReady, \'controller__panel--no-wizard\': !vm.isWizardAvailable }"><div class="controller__panel__desc"><p class="desc__text desc__title">{{ vm.view.title }}</p><p class="desc__text" ndm-html-compile="vm.view.description"></p></div> <div class="controller__panel__model"><div class="model__view"><i class="icon icon--mws-controller"></i> <span class="model-icon-front model-icon-front--{{vm.params.modelName | lowercase}}"></span></div> <div class="model__name">{{ vm.params.name }}</div> <div class="model__rename" ng-click="vm.changeControllerName()">{{ vm.view.buttonRename }}</div></div> <div class="controller__panel__params"><div class="params__item"><div class="params__item__title">{{ vm.view.model }}</div> <div class="params__item__text">{{ vm.params.model }}</div></div> <div class="params__item"><div class="params__item__title">{{ vm.view.os }}</div> <div class="params__item__text">{{ vm.params.os }}</div></div> <div class="params__item"><ndm-mws-clients-tooltip clients-list="vm.params.clients" clients-count-title="{{ vm.view.clients }}" tooltip-title="{{ vm.view.hintTitle }}" show-more-clients-text="wifi-system.clients-tooltip.show-more-clients" hide-more-clients-text="wifi-system.clients-tooltip.hide-more-clients"></ndm-mws-clients-tooltip></div> <div class="params__item"><div class="params__item__title">{{ vm.view.uptime }}</div> <div class="params__item__text">{{ vm.params.uptime }}</div></div></div></div> <div ng-if="vm.isWizardAvailable" class="controller__control"><div class="control__title">{{ vm.view.addText }}</div> <div class="control__button" ng-click="vm.openWizard()">{{ vm.view.buttonAdd }}</div></div></div></div>'),e.put("app/page/controlPanel/myNetwork/wifiSystem/extenders/ws.deviceRow.view.html",'<td class="table__col-0"><div class="device-info"><i ng-if="device.indicator" class="icon icon--{{device.indicator.icon}}" title="{{device.indicator.text}}"></i> <div class="device-info__name-container"><div class="device-info__name"><a ng-attr-href="http://{{device.ip}}" target="_blank" ng-click="WSExtenders.stopEventPropagation($event)" title="{{\'wifi-system.devices-table.hint.node-web-interface\' | translate}}" class="device-info__link">{{device.name}}</a> <span ng-show="device.hasIp">{{ device.ip }}</span> <span ndm-html-compile="device.connectedVia"></span></div> <i title="{{WSExtenders.rowHint}}" class="device-info__rename-icon"></i></div></div></td><td class="table__col-1"><div ng-if="device.errors.length > 0" class="device-info__errors"><ndm-help icon="warning"><ul><li ng-repeat="err in device.errors">{{err | translate}}</li></ul></ndm-help></div> {{device.model}}</td><td class="table__col-2">{{device.fw}}</td><td class="table__col-3"><span ng-if="!device.isOffline" class="mws-device-table__node-clients-count" ng-mouseenter="WSExtenders.removeRowHint()" ng-mouseleave="WSExtenders.setRowHint()" ng-class="{ \'mws-device-table__node-clients-count--with-tooltip\': device.clients.length > 0 }"><ndm-mws-clients-tooltip clients-list="device.clients" tooltip-title="wifi-system.clients-tooltip.header" show-more-clients-text="wifi-system.clients-tooltip.show-more-clients" hide-more-clients-text="wifi-system.clients-tooltip.hide-more-clients"></ndm-mws-clients-tooltip></span> <span ng-if="device.isOffline">&mdash;</span></td><td class="table__col-4" ng-bind-html="device.uptimeHtml"></td><td ng-bind-html="device.connectionInfoHtml" class="table__col-4b"></td><td class="table__col-5 table__col--action" ng-mouseenter="device.actionFn && !(device.isUiLocked || device.isProcessedByMws) && WSExtenders.changeRowHint(device.actionLabel)" ng-mouseleave="WSExtenders.setRowHint()" ng-click="WSExtenders.stopEventPropagation($event)"><div class="mws-device-table__action-column"><ndm-button ng-if="device.actionFn && !(device.isUiLocked || device.isProcessedByMws)" class="mws-device-table__action-btn" label="{{device.actionLabel}}" is-disabled="device.isMwsCandidate && device.passwordIsSet" on-click="device.actionFn"></ndm-button><div ng-if="device.isProcessedByMws && device.isMwsCandidate" class="mws-device-table__candidate-state"><i class="icon icon--load"></i> {{WSExtenders.l10n.candidateState[device.state]}}</div> <div ng-if="device.isUiLocked && !device.isProcessedByMws" class="mws-device-table__lock-icon-wrapper"><i class="icon icon--load"></i></div></div></td>'),e.put("app/page/controlPanel/myNetwork/wifiSystem/extenders/ws.extendersTable.view.html",'<div ng-controller="MWSExtendersController as WSExtenders"><div ng-if="WSExtenders.tableIsVisible" class="page-wifi-system__devices-table-wrapper" ng-class="{ \'page-wifi-system__devices-table-wrapper--empty\': WSExtenders.isEmpty }"><table class="page-wifi-system__devices-table mws-device-table" ng-form="WSExtenders.form" ng-show="WSExtenders.isReady"><thead><tr><th ng-repeat="colName in WSExtenders.columnNames track by $index" class="table__col-{{$index}}" title="{{(colName ? (\'wifi-system.devices-table.columns.\' + colName) : \'\') | translate}}" data-translate="">{{colName ? (\'wifi-system.devices-table.columns.\' + colName) : \'\'}}</th></tr></thead><tbody ng-if="WSExtenders.membersData.length !== 0"><tr class="mws-device-table__device-group-header"><td colspan="{{::WSExtenders.columnNames.length}}" data-translate="">wifi-system.devices-table.header.members</td></tr></tbody><tbody><tr ng-repeat="device in WSExtenders.membersData track by device.mac" class="mws-device-table__device-row {{device.className}}" ng-class="{ \'mws-device-table__device-row--pending-removal\': device.isPendingRemoval, \'mws-device-table__device-row--removed\': device.isRemoved || device.isDeleted, \'mws-device-table__device-row--new\': device.isNew }" ng-click="WSExtenders.openRenamePopup(device, \'membersData\')" title="{{WSExtenders.rowHint}}" ng-include="\'app/page/controlPanel/myNetwork/wifiSystem/extenders/ws.deviceRow.view.html\'"></tr></tbody><tbody ng-if="WSExtenders.candidatesData.length !== 0"><tr class="mws-device-table__device-group-header"><td colspan="{{::WSExtenders.columnNames.length}}" data-translate="">wifi-system.devices-table.header.candidates</td></tr></tbody><tbody><tr ng-repeat="device in WSExtenders.candidatesData track by device.mac" class="mws-device-table__device-row {{device.className}}" ng-class="{ \'mws-device-table__device-row--removed\': device.isRemoved, \'mws-device-table__device-row--new\': device.isNew }" title="{{WSExtenders.rowHint}}" ng-click="WSExtenders.openRenamePopup(device, \'candidatesData\')" ng-include="\'app/page/controlPanel/myNetwork/wifiSystem/extenders/ws.deviceRow.view.html\'"></tr></tbody></table></div></div>'),e.put("app/page/controlPanel/myNetwork/wifiSystem/log/ws.log.view.html",'<div ng-controller="MWSLogController as WSLog" class="page-wifi-system__log-tab"><div ng-if="WSLog.isActive" class="page-wifi-system__description-text" ndm-polling="WSLog.updateLogData" data-translate="">wifi-system.log-table.description</div> <div class="page-wifi-system__log" ng-class="{ \'page-wifi-system__log--inactive\': !WSLog.isActive }"><div class="page-wifi-system__log-top-panel" ng-class="{ \'page-wifi-system__log-top-panel--handheld\': WSLog.isHandheld, \'page-wifi-system__log-top-panel--with-filters\': WSLog.showFilters }"><div ng-if="!WSLog.isMobile" class="buttons-row page-wifi-system__log-table-panel"><ndm-button class="buttons-row__item buttons-row__button--full-width" on-click="WSLog.setMinTime" label="wifi-system.log-table.time-filter.btn-show-only-newer"></ndm-button><ndm-button class="buttons-row__item buttons-row__button--full-width" on-click="WSLog.resetMinTime" label="wifi-system.log-table.time-filter.btn-show-all-events"></ndm-button></div> <div ng-if="!WSLog.isMobile" class="page-wifi-system__log-table-row-count">{{WSLog.l10n.logTableStats}}<br><span ng-if="WSLog.filterValue.minTime" class="help-text">{{WSLog.minTimeFilterL10n}}</span></div><ndm-button ng-if="!WSLog.isMobile" class="mws-log-table__download-as-csv-btn" is-disabled="WSLog.logTable.data.length === 0" on-click="WSLog.downloadAdCsv" label="wifi-system.log-table.download-as-csv"></ndm-button><div ng-if="WSLog.isMobile" class="mws-log-table__filters--mobile"><ndm-details toggle-var="WSLog.showFilters" on-toggle="WSLog.triggerWindowResize" label-hidden="wifi-system.log-table.hide-filters" label-visible="wifi-system.log-table.show-filters"></ndm-details><div ng-if="WSLog.showFilters" class="buttons-row"><ndm-button class="buttons-row__item buttons-row__button--full-width" on-click="WSLog.setMinTime" label="wifi-system.log-table.time-filter.btn-show-only-newer"></ndm-button><ndm-button class="buttons-row__item buttons-row__button--full-width" on-click="WSLog.resetMinTime" label="wifi-system.log-table.time-filter.btn-show-all-events"></ndm-button></div> <div class="page-wifi-system__log-table-row-count--mobile">{{WSLog.l10n.logTableStats}}<br><span ng-if="WSLog.filterValue.minTime" class="help-text">{{WSLog.minTimeFilterL10n}}</span></div></div></div> <div class="mws-log-table__header-wrapper" ng-class="{ \'mws-log-table__header-wrapper--mobile\': WSLog.isMobile, \'mws-log-table__header-wrapper--ff\': WSLog.isFF }"><div class="mws-log-table__header" ng-class="{ \'mws-log-table__header--handheld\': WSLog.isHandheld }" ng-show="WSLog.showFilters"><div class="mws-log-header mws-log-record"><div ng-repeat="(name, colData) in WSLog.logTable.columns" class="mws-log-record__prop mws-log-record__prop--{{name}} mws-log-header__column" ng-click="!WSLog.isHandheld && colData.sortable && WSLog.logTable.sort.onClick(name)" ng-class="{ \'mws-log-header__column--sortable\': colData.sortable && !vm.isMobile, \'mws-log-header__column--sort-by\': name === WSLog.logTable.sort.column, \'mws-log-header__column--sort-reverse\': name === WSLog.logTable.sort.column && WSLog.logTable.sort.reverse }" data-translate="">{{colData.title}}</div></div> <div class="mws-log-filters mws-log-record"><div class="mws-log-record__prop mws-log-record__prop--filter mws-log-record__prop--timestamp"></div> <div class="mws-log-record__prop mws-log-record__prop--filter mws-log-record__prop--client"><ndm-input-autocomplete name="logFilter_client" options="WSLog.filterOptions.client" value="WSLog.filterValue.client" placeholder-text="wifi-system.log-table.filter-placeholder" on-match-change="WSLog.onMatchFilterChange"></ndm-input-autocomplete></div> <div class="mws-log-record__prop mws-log-record__prop--filter mws-log-record__prop--from"><ndm-input-autocomplete name="logFilter_from" options="WSLog.filterOptions.from" value="WSLog.filterValue.from" placeholder-text="wifi-system.log-table.filter-placeholder" on-match-change="WSLog.onMatchFilterChange"></ndm-input-autocomplete></div> <div class="mws-log-record__prop mws-log-record__prop--filter mws-log-record__prop--eventTypeIcon"></div> <div class="mws-log-record__prop mws-log-record__prop--filter mws-log-record__prop--to"><ndm-input-autocomplete name="logFilter_to" options="WSLog.filterOptions.to" value="WSLog.filterValue.to" placeholder-text="wifi-system.log-table.filter-placeholder" on-match-change="WSLog.onMatchFilterChange"></ndm-input-autocomplete></div> <div class="mws-log-record__prop mws-log-record__prop--filter mws-log-record__prop--filter mws-log-record__prop--eventType"><ndm-input-autocomplete name="logFilter_eventType" options="WSLog.filterOptions.eventType" value="WSLog.filterValue.eventType" placeholder-text="wifi-system.log-table.filter-placeholder" on-match-change="WSLog.onMatchFilterChange"></ndm-input-autocomplete></div> <div class="mws-log-record__prop mws-log-record__prop--filter mws-log-record__prop--resetBtn"><ndm-button ng-attr-title="{{\'wifi-system.log-table.reset-all-filters\' | translate}}" is-disabled="WSLog.logTable.noFilters" class="page-wifi-system__reset-log-filters-btn" on-click="WSLog.resetAllFilters" icon="cancel"></ndm-button></div></div><ndm-button ng-if="WSLog.isMobile" ng-attr-title="{{\'wifi-system.log-table.reset-all-filters\' | translate}}" is-disabled="WSLog.logTable.noFilters" class="page-wifi-system__reset-log-filters-btn page-wifi-system__reset-log-filters-btn--mobile" on-click="WSLog.resetAllFilters" icon="cancel"></ndm-button></div> <div class="mws-log-table__header-right-margin"></div></div> <div ng-if="WSLog.isMobile"><div class="mws-log-header--mobile mws-log-record" ng-class="{ \'mws-log-header--handheld\': WSLog.isHandheld }"><div ng-repeat="name in WSLog.logTable.sortableColumns" class="mws-log-record__prop mws-log-record__prop--{{name}} mws-log-header__column" ng-click="WSLog.logTable.sort.onClick(name)" ng-class="{ \'mws-log-header__column--sortable\': true, \'mws-log-header__column--sort-by\': name === WSLog.logTable.sort.column, \'mws-log-header__column--sort-reverse\': WSLog.logTable.sort.reverse }" data-translate="">{{WSLog.logTable.columns[name].title}}</div></div></div> <div ng-if="WSLog.logTable.data.length > 0" class="page-wifi-system__log-table-data" ng-class="{ \'page-wifi-system__log-table-data--ff\': WSLog.isFF }"><md-virtual-repeat-container><div class="mws-log-record log-record--{{ $index }}" md-virtual-repeat="row in WSLog.logTable.data" md-item-size="WSLog.recordHeight"><div ng-repeat="(name, colData) in WSLog.logTable.columns" class="mws-log-record__prop mws-log-record__prop--{{name}}"><span ndm-html-compile="colData.modify ? colData.modify(row[name], row) : row[name]"></span></div></div></md-virtual-repeat-container></div> <div ng-if="WSLog.logTable.data.length === 0" class="mws-log__no-data-text" data-translate="">{{WSLog.logTable.noDataText}}</div></div></div>'),e.put("app/page/controlPanel/myNetwork/wifiSystem/ndm-mws-clients-tooltip/ndm-mws-clients-tooltip.html",'<div class="ndm-mws-clients-tooltip" ng-mouseenter="vm.showTooltip()" ng-mouseleave="vm.hideTooltip()"><div class="ndm-mws-clients-tooltip__placeholder" ng-class="{ \'ndm-mws-clients-tooltip__placeholder--with-clients\': vm.clientsCount > 0 }"><div class="ndm-mws-clients-tooltip__count-title">{{ vm.clientsCountTitle }}</div> <div class="ndm-mws-clients-tooltip__count">{{ vm.clientsCount }}</div></div> <div ng-if="vm.clientsCount > 0" class="ndm-mws-clients-tooltip__tooltip"><ndm-tooltip ng-if="vm.tooltipIsVisible"><div class="ndm-mws-clients-tooltip__tooltip-content-wrapper" ng-click="vm.onClick($event)"><div class="ndm-mws-clients-tooltip__tooltip-header"><strong data-translate="">{{ vm.tooltipTitle }}</strong></div> <div class="tooltip-data-item" ng-repeat="client in vm.clientsList | limitTo:vm.clientsListLimit track by $index"><strong class="tooltip-data-item__text">{{client.name || client.hostname || client.mac}}</strong> <div class="tooltip-data-item__text" ng-if="client.name !== client.mac">{{client.mac}}</div></div> <div ng-if="vm.clientsCount > vm.MAX_CLIENTS_IN_TOOLTIP || vm.allClientsAreVisible" ng-click="vm.toogleClientsListLimit()" class="tooltip-data-item--last"><i>{{ vm.allClientsAreVisible ? vm.hideMoreClientsTextL10n : vm.showMoreClientsTextL10n }}</i></div></div></ndm-tooltip></div></div>'),e.put("app/page/controlPanel/myNetwork/wifiSystem/ndm-mws-modal/ndm-mws-modal.html",'<a class="popup-close-button ndm-mws-modal__close-button" tabindex="0" ng-click="vm.close()">×</a> <div class="ndm-mws-modal check-mobile" init-scroll=""><div class="ndm-mws-modal__overlay"></div> <div class="ndm-mws-modal__container"><div class="ndm-mws-modal__content"><div class="ndm-mws-modal-block ndm-mws-modal-block1"><div class="ndm-mws-modal-block1__top-row"><h1 class="ndm-mws-modal-block1__title" data-translate="">ndm-mws-modal.block1.title</h1></div> <div class="ndm-mws-modal-block1__description-wrapper"><div class="ndm-mws-modal-block1__description" data-translate="">ndm-mws-modal.block1.description</div></div> <div class="ndm-mws-modal-block1__house-image-wrapper"><ndm-mws-animation class="ndm-mws-modal-block1__house-image"></ndm-mws-animation></div> <div class="ndm-mws-modal-block1__bottom-row"><h3 class="ndm-mws-modal-block1__bottom-slogan" data-translate="">ndm-mws-modal.block1.bottom-slogan</h3></div></div> <div class="ndm-mws-modal-block ndm-mws-modal-block2"><div class="ndm-mws-modal-block2__transition"><i class="ndm-mws-modal-block2__transition-icon icon icon--wifi-black-bold"></i></div><h1 class="ndm-mws-modal-block2__title" data-translate="">ndm-mws-modal.block2.title</h1><div class="ndm-mws-modal-block2__description" data-translate="">ndm-mws-modal.block2.description</div> <div class="ndm-mws-modal-block2__images check-scroll"><div class="ndm-mws-modal-block2__image ndm-mws-modal-block2__image--left-image"><div><ndm-svg-icon class="ndm-mws-modal-block2__svg-uncovered" svg-id="mws-modal-uncovered-zones"></ndm-svg-icon><p class="ndm-mws-modal-block2__image-text" data-translate="">ndm-mws-modal.block2.left-image</p></div></div> <div class="ndm-mws-modal-block2__image-spacer"></div> <div class="ndm-mws-modal-block2__image"><div><ndm-svg-icon class="ndm-mws-modal-block2__svg-full-coverage" svg-id="mws-modal-full-coverage"></ndm-svg-icon><p class="ndm-mws-modal-block2__image-text" data-translate="">ndm-mws-modal.block2.right-image</p></div></div></div></div> <div class="ndm-mws-modal-block ndm-mws-modal-block3"><h1 class="ndm-mws-modal-block3__title" data-translate="">ndm-mws-modal.block3.title</h1><div class="ndm-mws-modal-block3__features"><div ng-repeat="feature in vm.features" class="ndm-mws-modal-block3-feature feature"><i ng-if="feature.icon" class="feature__icon icon icon--{{feature.icon}}"></i> <span class="feature__text" data-translate="">{{feature.text}}</span></div></div></div> <div class="ndm-mws-modal-block ndm-mws-modal-block4"><div class="ndm-mws-modal-block4__title-wrapper"><h1 class="ndm-mws-modal-block4__title" data-translate="">ndm-mws-modal.block4.title</h1></div> <div class="ndm-mws-modal-block4__grey-part"><div class="ndm-mws-modal-block4__middle-row"><div class="ndm-mws-modal-block4__description"><span class="ndm-mws-modal-block4__description-text" data-translate="">ndm-mws-modal.block4.description</span></div> <div class="ndm-mws-modal-block4__flex-wrapper"><div class="ndm-mws-modal-block4__time-to-set-up time"><div class="time__amount">4</div> <div class="time__unit" data-translate="">ndm-mws-modal.block4.time-to-setup</div></div> <div class="ndm-mws-modal-block4__routers-scheme-wrapper"><div class="ndm-mws-modal-block4__routers-scheme check-scroll"><img class="ndm-mws-modal-block4__router-image check-scroll" src="/assets/img/model-giga-detailed-fly.svg" alt=""> <img class="ndm-mws-modal-block4__routers-scheme-item" src="/assets/img/model-giga-detailed.svg" alt=""> <img class="ndm-mws-modal-block4__routers-scheme-item" src="/assets/img/model-giga-detailed.svg" alt=""> <img class="ndm-mws-modal-block4__routers-scheme-item" src="/assets/img/model-giga-detailed.svg" alt=""> <div class="ndm-mws-modal-block4__routers-scheme-outline"><div class="ndm-mws-modal-block4__routers-scheme-connector"></div> <div class="ndm-mws-modal-block4__routers-scheme-connector"></div> <span class="ndm-mws-modal-block4__routers-scheme-plus">+</span> <span class="ndm-mws-modal-block4__routers-scheme-plus">+</span> <span class="ndm-mws-modal-block4__routers-scheme-plus">+</span></div></div></div></div></div> <div class="ndm-mws-modal-block4__bottom-text" data-translate="">ndm-mws-modal.block4.bottom-text</div></div></div> <div class="ndm-mws-modal-block ndm-mws-modal-block5"><div class="ndm-mws-modal-block5__title" data-translate="">ndm-mws-modal.block5.title</div> <div class="ndm-mws-modal-block5__advantages"><div ng-repeat="advantage in vm.advantages" class="ndm-mws-modal-block5__advantage advantage"><div ng-if="advantage.mark" class="advantage__mark"><span class="advantage__mark-text" data-translate="">{{advantage.mark}}</span></div> <div class="advantage__icon-wrapper"><i ng-if="advantage.icon" class="advantage__icon icon icon--{{advantage.icon}}"></i></div> <div class="advantage__text-wrapper"><h3 class="advantage__title" data-translate="">{{advantage.title}}</h3><span class="advantage__text" data-translate="">{{advantage.text}}</span></div></div></div></div> <div class="ndm-mws-modal-block ndm-mws-modal-block6"><div class="ndm-mws-modal-block6__title" data-translate="">ndm-mws-modal.block6.title</div> <div class="ndm-mws-modal-block6__actions"><ndm-button btn-class="btn--rounded btn--blue" on-click="vm.goToKeeneticSite" label="ndm-mws-modal.block6.find-right-keenetic-btn"></ndm-button></div></div></div></div><ndm-key-press action-on="[\'escape\']" call-func="[vm.close]"></ndm-key-press></div>'),e.put("app/page/controlPanel/myNetwork/wifiSystem/renameDevice/ws.renameDevice.popup.html",'<div ng-controller="MWSRenameDeviceController as RenameDevice"><ndm-alert ng-if="RenameDevice.isVisible" class="mws-device-table__rename-popup rename-mws-device-popup" is-visible="::true" hide="RenameDevice.close()" label="{{\'wifi-system.rename-mws-device-popup.header\' + (RenameDevice._device.isMwsController ? \'-controller\' : \'-node\')}}" close-on-esc="true" close-on-click-outside="true"><form autocomplete="off" name="RenameDevice.renameForm" novalidate=""><ndm-input name="mwsDeviceName" error="RenameDevice.error" on-change="RenameDevice.validate" on-press-enter="RenameDevice.rename()" on-press-esc="RenameDevice.close()" model-options="{debounce: 30}" validation="required" model="RenameDevice._device.nameModel"></ndm-input></form><ndm-button btn-class="btn--primary" button-name="ok" is-disabled="RenameDevice.error || !RenameDevice._device.nameModel || RenameDevice.renameInProgress" on-click="RenameDevice.rename" label="wifi-system.rename-mws-device-popup.rename-btn"></ndm-button><ndm-button is-disabled="RenameDevice.renameInProgress" button-name="cancel" on-click="RenameDevice.close" label="cancel"></ndm-button></ndm-alert></div>'),e.put("app/page/controlPanel/myNetwork/wifiSystem/settings/ws.settings.view.html",'<div ng-controller="MWSSettingsController as WSSettings" class="page-wifi-system__settings-tab"><div ng-show="WSSettings.isReady"><ndm-form-header label="wifi-system.settings.backhaul.label"></ndm-form-header><span class="body-text" data-translate="">wifi-system.settings.backhaul.description</span><ndm-toggle name="mwsBackhaul" label-on="wifi-system.settings.backhaul.enabled" label-off="wifi-system.settings.backhaul.disabled" call-on-change="WSSettings.backhaul.toggle" model="WSSettings.backhaul.isEnabled"></ndm-toggle></div></div>'),e.put("app/page/controlPanel/networkRules/netFilter/dnsOverX/dnsOverHttps.table.html",'<table class="page-netFilter__dns-over-https-table" ng-show="vm.dnsOverHttps.data.length > 0"><thead><tr><th class="table__header table__col-0"><span data-translate="">netFilter.dns-over-https.url</span></th><th class="table__header table__col-1"><span data-translate="">netFilter.dns-over-https.domain</span></th><th class="table__header table__col-2"><span data-translate="">netFilter.dns-over-https.spki-fingerprint</span></th><th class="table__header table__col-3"><span data-translate="">netFilter.dns-over-https.interface</span></th><th class="table__header table__col-4"><span data-translate=""></span></th></tr></thead><tbody><tr ng-repeat="dnsServer in vm.dnsOverHttps.data track by $index" ng-form="vm.dnsOverHttps__{{$index}}"><td class="table__col-0"><div class="td-content-wrapper"><ndm-input name="dnsOverHttps_url_{{$index}}" placeholder="{{\'netFilter.dns-over-https.url-placeholder\' | translate}}" model="dnsServer.url" validation="{{vm[\'dnsOverHttps__\' + $index][\'dnsOverHttps_url_\' + $index].$pristine ? \'\' : \'required\'}}"></ndm-input></div></td><td class="table__col-1"><div class="td-content-wrapper"><ndm-selectbox placeholder="netFilter.static-dns.interface-placeholder" value="dnsServer.format" name="dnsOverHttps_format_{{$index}}" disabled="false" options="vm.dnsOverHttps.formatOptions"></ndm-selectbox></div></td><td class="table__col-2"><div class="td-content-wrapper"><ndm-input name="dnsOverHttps_fingerprint_{{$index}}" max-length="44" validation="base64" model="dnsServer.hash"></ndm-input></div></td><td class="table__col-3"><ndm-selectbox placeholder="netFilter.static-dns.interface-placeholder" value="dnsServer.interface" name="dnsOverHttps_interface_{{$index}}" disabled="false" options="vm.interfaceOptions"></ndm-selectbox></td><td class="table__col-4"><span class="page-netFilter__dns-table__remove_row" title="{{\'netFilter.dns-over-https.remove-server-icon-title\' | translate}}" ng-click="vm.dnsOverHttps.deleteRow($index)"></span></td></tr></tbody></table>'),e.put("app/page/controlPanel/networkRules/netFilter/dnsOverX/dnsOverTls.table.html",'<table class="page-netFilter__dns-over-tls-table" ng-show="vm.dnsOverTls.data.length > 0"><thead><tr><th class="table__header table__col-0"><span data-translate="">netFilter.dns-over-tls.address-and-port</span></th><th class="table__header table__col-1"><span data-translate="">netFilter.dns-over-tls.domain</span></th><th class="table__header table__col-2"><span data-translate="">netFilter.dns-over-tls.spki-fingerprint</span></th><th class="table__header table__col-3"><span data-translate="">netFilter.dns-over-tls.interface</span></th><th class="table__header table__col-4"><span data-translate=""></span></th></tr></thead><tbody><tr ng-repeat="dnsServer in vm.dnsOverTls.data track by $index" ng-form="vm.dnsOverTlsForm__{{$index}}"><td class="table__col-0"><div class="td-content-wrapper"><ndm-input name="dnsOverTls_address_{{$index}}" placeholder="{{\'netFilter.dns-over-tls.address-and-port-placeholder\' | translate}}" model="dnsServer.address" on-change="vm.dnsOverTls.onChange" validation-data="{allowPort: true}" validation="{{vm[\'dnsOverTlsForm__\' + $index][\'dnsOverTls_address_\' + $index].$pristine ? \'ipOrDomain\' : \'required,ipOrDomain\'}}"></ndm-input></div></td><td class="table__col-1"><div class="td-content-wrapper"><ndm-input name="dnsOverTls_domain_{{$index}}" placeholder="{{\'netFilter.dns-over-tls.domain-placeholder\' | translate}}" on-change="vm.dnsOverTls.onChange" model="dnsServer.fqdn"></ndm-input></div></td><td class="table__col-2"><div class="td-content-wrapper"><ndm-input name="dnsOverTls_fingerprint_{{$index}}" max-length="44" validation="base64" model="dnsServer.hash" on-change="vm.dnsOverTls.onChange"></ndm-input></div></td><td class="table__col-3"><ndm-selectbox placeholder="netFilter.static-dns.interface-placeholder" value="dnsServer.interface" name="dnsOverTls_interface_{{$index}}" disabled="false" options="vm.interfaceOptions" on-change="vm.dnsOverTls.onChange"></ndm-selectbox></td><td class="table__col-4"><span class="page-netFilter__dns-table__remove_row" title="{{\'netFilter.dns-over-tls.remove-server-icon-title\' | translate}}" ng-click="vm.dnsOverTls.deleteRow($index)"></span></td></tr></tbody></table>'),e.put("app/page/controlPanel/networkRules/netFilter/dnsOverX/dnsOverX.section.html",'<div ng-controller="DnsOverXController as vm" ng-init="NFC.subcontroller.register(vm, \'DNS_OVER_X\')"><div ng-if="::vm.DNS_OVER_TLS_INSTALLED" class="page-netFilter__dns-over-tls"><ndm-form-header label="netFilter.dns-over-tls.header"></ndm-form-header><ndm-text text="netFilter.dns-over-tls.description"></ndm-text><div ng-form="NFC.dnsOverTlsForm"><input type="hidden" ng-model="vm.dnsOverTls.isChanged"> <div ng-include="\'app/page/controlPanel/networkRules/netFilter/dnsOverX/dnsOverTls.table.html\'"></div></div> <div ng-if="vm.dnsOverTls.data.length === 0" class="empty-list" data-translate="">netFilter.dns-over-tls.empty-list-msg</div><hr class="hr-invisible"><ndm-button label="netFilter.dns-over-tls.add-server-btn" ng-click="vm.dnsOverTls.addRow()"></ndm-button></div><div ng-if="::vm.DNS_OVER_HTTPS_INSTALLED" class="page-netFilter__dns-over-https"><ndm-form-header label="netFilter.dns-over-https.header"></ndm-form-header><ndm-text text="netFilter.dns-over-https.description"></ndm-text><div ng-form="NFC.dnsOverHttpsForm"><input type="hidden" ng-model="vm.dnsOverHttps.isChanged"> <div ng-include="\'app/page/controlPanel/networkRules/netFilter/dnsOverX/dnsOverHttps.table.html\'"></div></div> <div ng-if="vm.dnsOverHttps.data.length === 0" class="empty-list" data-translate="">netFilter.dns-over-https.empty-list-msg</div><hr class="hr-invisible"><ndm-button label="netFilter.dns-over-https.add-server-btn" ng-click="vm.dnsOverHttps.addRow()"></ndm-button></div></div>'),e.put("app/page/controlPanel/networkRules/netFilter/internetSafety/internetSafety.section.html",'<div ng-controller="InternetSafetyController as vm" ng-form="NFC.internetSafetyForm" ng-init="NFC.subcontroller.register(vm, \'INTERNET_SAFETY\')"><div ndm-polling="vm.filter && vm.connError && vm.pollAvailability" ndm-interval="10000"></div> <div ng-form="vm.serviceForm"><ndm-selectbox class="page-netFilter__filter-selectbox" name="filter" label="netFilter.filter" options="vm.filters" value="vm.filter" disabled="NFC.lockUiCtrls" ng-if="vm.filters.length > 1" on-value-change="vm.switchFilter"><ndm-help><span ndm-html-compile="vm.l10n.hint"></span></ndm-help></ndm-selectbox></div><div ng-if="vm.filter && ((vm.connError && vm.connErrorDescription) || vm.availLoading)" class="page-netFilter__unavailable-warning" ng-class="{ \'page-netFilter__unavailable-warning--loading\': vm.availLoading, \'page-netFilter__unavailable-warning--with-description\': !!vm.connErrorDescription }" ng-bind-html="!vm.availLoading ? vm.connErrorDescription : (\'netFilter.checking-availability\' | translate)"></div><div ng-if="vm.authIsRequired" class="skydns-account-data"><ndm-form-header hr="hr-light-blue" label="netFilter.{{vm.filter}}.account-header"></ndm-form-header><div ng-if="vm.ndmSettings.state.login && !vm.authError" class="skydns-login-plan"><ndm-form-title label="netFilter.login" text="vm.skydns.info.login"><a tabindex="0" class="skydns-login-plan__change-link" ng-keydown="vm.onSkydnsChangeLinkKeydown($event)" ng-click="vm.skydns.popup.open()" data-translate="">netFilter.button.change</a></ndm-form-title><ndm-form-title label="netFilter.tariff" text="vm.skydns.info.tariff"></ndm-form-title></div> <div ng-if="!(vm.ndmSettings.state.login && !vm.authError)" class="text-section"><div class="text-line"><span class="body-text" data-translate="">netFilter.skydns.no-account</span></div><ndm-button is-disabled="NFC.lockUiCtrls || vm.connError" label="netFilter.button.create" btn-class="skydns-account-data__btn" on-click="vm.skydns.goToWebsite"></ndm-button><div class="text-line"><span class="body-text" data-translate="">{{\'netFilter.\' + vm.filter + \'.has-account\'}}</span></div> <div class="page-netFilter__login-btn-wrapper"><ndm-button is-disabled="NFC.lockUiCtrls || vm.connError" label="netFilter.button.login" btn-class="skydns-account-data__btn btn--primary" on-click="vm.skydns.popup.open"></ndm-button><span ng-if="vm.ndmSettings.state.login && vm.authError" class="page-netFilter__login-error-msg" data-translate="">{{\'netFilter.\' + vm.filter + \'.auth-error\'}}</span></div></div></div><div ng-if="vm.canShowProfiles()" class="filter-profiles"><ndm-form-header hr="hr-light-blue" label="netFilter.profiles-header"></ndm-form-header><ndm-selectbox name="defaultProfile" disabled="NFC.lockUiCtrls" class="profile-selectbox" value="vm.defaultProfile" is-updating="NFC.lockUiCtrls" label="netFilter.default-profile" description="netFilter.default-profile-description" on-change="vm.changeDefaultProfile()" options="vm.filterProfiles"></ndm-selectbox><table ng-if="vm.table.rows.length > 0" class="ndm-table body-text profiles-table"><thead><tr><th ng-repeat="column in vm.table.columns" ng-click="vm.table.sortBy(column.title)" ng-style="{ \'width\': column.width ? (column.width + \'px\') : \'auto\' }" class="table__header table__col-{{$index}}"><span data-translate="">{{\'netFilter.table.\' + column.title}}</span> <i class="icon icon--indicator-sortIcon" ng-class="{\'vm.table.sort.reverse\': reverse}" ng-show="vm.table.sort.column === column.title"></i></th></tr></thead><tbody><tr ng-repeat="row in vm.table.rows | orderBy: vm.table.sort.column : vm.table.sort.reverse"><td><div class="td-content-wrapper">{{row.device}}</div></td><td class="profiles-table__profile-cell"><ndm-selectbox class="profile-selectbox" value="row.profile.id" is-updating="NFC.lockUiCtrls" name="{{\'profile\' + $index}}" disabled="NFC.lockUiCtrls || !vm.noErrors" on-change="vm.changeDeviceProfile(row.device)()" options="vm.filterProfiles"></ndm-selectbox></td></tr></tbody></table></div><div ng-if="vm.canShowProfiles() && vm.table.rows.length === 0" class="no-device-profiles-msg"><span ndm-html-compile="vm.l10n.noRegisteredDevices"></span></div><ndm-popup class="skydns-account-popup" is-visible="vm.skydns.popup.opened" header-title="{{\'netFilter.\' + vm.filter + \'.popup-title\'}}" close="vm.skydns.popup.close" save="vm.skydns.popup.save"><div ng-form="vm.formSkyAuth" ng-if="vm.skydns.popup.ready()" ng-model-options="{debounce: 50}" ng-cloak=""><ndm-text text="{{vm.l10n.accountPopupDescription[vm.filter]}}"></ndm-text><ndm-input label="netFilter.login" model="vm.ndmSettings.state.login" name="skyDnsLogin" error-from-controller="vm.skydns.popup.authError" validation="required,login"></ndm-input><ndm-input label="netFilter.password" model="vm.ndmSettings.state.password" name="skyDnsPassword" password="true" error-from-controller="vm.skydns.popup.authError" validation="required,password"></ndm-input><ndm-control-footer prefix="skydns" form="vm.formSkyAuth" is-popup="true" is-visible="vm.formSkyAuth.modified || vm.skydns.popup.authError" is-save-disabled="vm.formSkyAuth.$invalid || vm.formSkyAuth.$pending" save="vm.skydns.popup.save()" cancel="vm.skydns.popup.close()"></ndm-control-footer></div></ndm-popup></div>'),e.put("app/page/controlPanel/networkRules/netFilter/staticDns/staticDns.section.html",'<div ng-controller="StaticDnsController as vm" ng-init="NFC.subcontroller.register(vm, \'STATIC_DNS\')"><div ng-if="::vm.STATIC_DNS_INSTALLED" class="page-netFilter__static-dns"><ndm-form-header label="netFilter.static-dns.header"></ndm-form-header><ndm-text text="netFilter.static-dns.description"></ndm-text><div ng-form="NFC.staticDnsForm"><input type="hidden" ng-model="vm.staticDns.isChanged"> <div ng-include="\'app/page/controlPanel/networkRules/netFilter/staticDns/staticDns.table.html\'"></div></div> <div ng-if="vm.staticDns.data.length === 0" class="empty-list" data-translate="">netFilter.static-dns.empty-list-msg</div><hr class="hr-invisible"><ndm-button label="netFilter.static-dns.add-server-btn" ng-click="vm.staticDns.addRow()"></ndm-button></div></div>'),e.put("app/page/controlPanel/networkRules/netFilter/staticDns/staticDns.table.html",'<table class="page-netFilter__dns-table" ng-show="vm.staticDns.data.length > 0"><thead><tr><th class="table__header table__col-0"><span data-translate="">netFilter.static-dns.address</span></th><th class="table__header table__col-1"><span data-translate="">netFilter.static-dns.domain</span></th><th class="table__header table__col-2"><span data-translate="">netFilter.static-dns.interface</span></th><th class="table__header table__col-3"><span data-translate=""></span></th></tr></thead><tbody><tr ng-repeat="dnsServer in vm.staticDns.data track by $index" ng-form="vm.staticDnsForm__{{$index}}"><td class="table__col-0"><div class="td-content-wrapper"><ndm-input name="staticDns_address_{{$index}}" placeholder="{{\'netFilter.static-dns.address-placeholder\' | translate}}" model="dnsServer.address" validation-data="{allowPort: true}" extra-validator="vm.staticDns.restrictSegmentAddresses" on-change="vm.staticDns.onChange" validation="{{vm[\'staticDnsForm__\' + $index][\'staticDns_address_\' + $index].$pristine ? \'ip\' : \'required,ip\'}}"></ndm-input></div></td><td class="table__col-1"><div class="td-content-wrapper"><ndm-input name="staticDns_domain_{{$index}}" placeholder="{{\'netFilter.static-dns.domain-placeholder\' | translate}}" on-change="vm.staticDns.onChange" model="dnsServer.domain"></ndm-input></div></td><td class="table__col-2"><ndm-selectbox placeholder="netFilter.static-dns.interface-placeholder" value="dnsServer.interface" name="staticDns_interface_{{$index}}" disabled="false" on-change="vm.staticDns.onChange" options="vm.interfaceOptions"></ndm-selectbox></td><td class="table__col-3"><span class="page-netFilter__dns-table__remove_row" title="{{\'netFilter.static-dns.remove-server-icon-title\' | translate}}" ng-click="vm.staticDns.deleteRow($index)"></span></td></tr></tbody></table>'),e.put("app/page/controlPanel/networkRules/remoteAccess/ddns/ddns.html",'<div ng-controller="DDNSController as RDNS" ng-init="RDNS.parentCtrl = RA" class="page-ddns"><ndm-device-poller ng-if="$parent.RA.activeTab === \'ddns\'"></ndm-device-poller><form ng-if="RDNS.progress === 100 && $parent.RA.activeTab === \'ddns\'" class="page-ddns__form" ng-class="{ \'page-ddns__form--loading\': RDNS.isLoading }" name="RDNS.form" ng-cloak="" novalidate=""><ndm-fieldset is-disabled="RDNS.isLoading"><ndm-text text="remoteAccess.ddns.description"></ndm-text><ndm-selectbox label="remoteAccess.ddns.type" value="RDNS.model.type" name="type" disabled="RDNS.isLoading" options="RDNS.ddnsTypes"></ndm-selectbox><ndm-input ng-if="RDNS.model.type === RDNS.customDdns" label="remoteAccess.ddns.url" model="RDNS.model.url" name="url" max-length="256" validation="required,dyndnsUrl"></ndm-input><ndm-input label="remoteAccess.ddns.domain" model="RDNS.model.domain" name="domain" validation="domain{{RDNS.model.type === RDNS.customDdns ? \'\' : \',required\'}}"></ndm-input><ndm-input label="remoteAccess.ddns.username" model="RDNS.model.username" name="ddnsUsername" validation="login{{RDNS.model.type === RDNS.customDdns ? \'\' : \',required\'}}"></ndm-input><ndm-input label="remoteAccess.ddns.password" model="RDNS.model.password" name="ddnsPassword" password="true" validation="password{{RDNS.model.type === RDNS.customDdns ? \'\' : \',required\'}}"></ndm-input><ndm-checkbox label="remoteAccess.ddns.autoip" model="RDNS.model.autodetectIp" name="autodetectIp"></ndm-checkbox><div ng-if="!RDNS.model.singleSuitableIface" ng-form="RDNS.form.interfaces"><ndm-checkbox-list label="remoteAccess.ddns.enable-for" options="RDNS.model.interfaceOptions" name="interfaces" model="RDNS.model.selectedInterfaces"></ndm-checkbox-list></div> <div ng-if="RDNS.isConfugured" class="cp-popup__controls"><hr class="hr-light-blue"><ndm-button btn-class="btn--long" on-click="RDNS.remove" label="remoteAccess.ddns.remove-button"></ndm-button></div></ndm-fieldset></form><ndm-control-footer prefix="ddns" form="RDNS.form" is-visible="RDNS.form.modified" is-save-disabled="RDNS.form.$invalid || RDNS.form.$pending || RDNS.isLoading" save="RDNS.save()"></ndm-control-footer></div>'),e.put("app/page/controlPanel/networkRules/remoteAccess/keendns/keendns.book-name.popup.html",'<div ng-controller="KeendnsBookNameController as vm"><ndm-popup class="keendns__register-popup" is-visible="vm.isVisible" header-title="remoteAccess.keendns.register-popup.title" close="vm.close" save="vm.save"><form name="vm.bookForm" ng-if="vm.isReady" ng-cloak="" novalidate=""><ndm-text text="remoteAccess.keendns.register-popup.description"></ndm-text><div ng-if="vm.availableNames.length"><ndm-form-header label="remoteAccess.keendns.register-popup.free-names"></ndm-form-header><ndm-radio class="vertically" name="availableNames" array="vm.availableNames" model="vm.newNameIndex"></ndm-radio></div><br><div ng-if="vm.occupiedNames.length"><ndm-form-header label="remoteAccess.keendns.register-popup.occupied-names" sub-title="remoteAccess.keendns.register-popup.occupied-description"></ndm-form-header><ndm-radio class="vertically" name="occupiedNames" array="vm.occupiedNames" model="vm.newNameIndex"></ndm-radio></div><ndm-sub-form ng-if="vm.isOccupiedNameSelected()"><ndm-input label="remoteAccess.keendns.transfer.code" model="vm.transferCode" name="transferCode" validation="required,keendnsTransferCode"></ndm-input></ndm-sub-form><ndm-control-footer prefix="bookNameForm" is-popup="true" is-visible="1" is-save-disabled="vm.uiLocked || vm.bookForm.$invalid" save="vm.save()" cancel="vm.close()"></ndm-control-footer></form></ndm-popup></div>'),e.put("app/page/controlPanel/networkRules/remoteAccess/keendns/keendns.html",'<div ng-controller="KeenDNSController as KC" ng-init="KC.parentCtrl = RA" class="page-keendns"><ndm-text text="remoteAccess.keendns.description"></ndm-text><form ng-show="!KC.noNdssAccess && KC.isReady && $parent.RA.activeTab === \'keendns\'" name="KC.form" novalidate=""><br><ndm-fieldset is-disabled="KC.uiLocked"><div ng-if="KC.model.booked"><ndm-form-header label="remoteAccess.keendns.internet-center-name" sub-title="remoteAccess.keendns.name-registered"></ndm-form-header><div class="page-keendns__keendns-name ndm-input"><div class="form__cell form__cell--input-label help-text"><span class="ng-binding" data-translate="">remoteAccess.keendns.domain-name</span></div> <div class="form__cell form__cell--top page-keendns__cell"><b>{{KC.model.name + \'.\' + KC.model.domain}}</b> <span ng-if="KC.model.ssl !== KC.SSL_CERTIFICATE_STATE.NON_SSL_DOMAIN" class="page-keendns__ssl-status"><i class="icon" ng-class="{ \'icon--https\': KC.model.ssl === KC.SSL_CERTIFICATE_STATE.CERTIFICATE_RECEIVED, \'icon--wait4https\': KC.model.ssl === KC.SSL_CERTIFICATE_STATE.CERTIFICATE_NOT_RECEIVED }"></i> <span ng-if="KC.model.ssl === KC.SSL_CERTIFICATE_STATE.CERTIFICATE_RECEIVED" class="help-text--success" data-translate="">remoteAccess.keendns.register-popup.domain-with-ssl</span> <span ng-if="KC.model.ssl === KC.SSL_CERTIFICATE_STATE.CERTIFICATE_NOT_RECEIVED" class="help-text" data-translate="">remoteAccess.keendns.waiting-for-ssl</span></span></div></div><ndm-sub-form><ndm-radio label="remoteAccess.keendns.ipv4-mode" name="accessMode" array="KC.modes" model="KC.model.access" on-change="KC.mode.onChange" hint="{{KC.modesHint}}"></ndm-radio><div ng-if="KC.model.booked && (KC.isPrivateIP && KC.model.access === \'direct\')" class="keendns-mode-warning"><span class="help-text" data-translate="">{{KC.mode.warningText}}</span></div><ndm-checkbox-list label="remoteAccess.keendns.ipv6-mode" name="ipv6Access" options="KC.ipv6ModeOptions" model="KC.model.access6"></ndm-checkbox-list><ndm-checkbox class="page-keendns__internet-access-checkbox" ndm-disabled-by-mws-tooltip="" disabled="KC.adminPasswordIsNotSet || NDM.DEVICE_IS_MWS_MEMBER" label="administrator.webaccess.access-by-internet" name="httpAccess" description="{{KC.getHttpAccessDescription()}}" on-change="KC.mode.setWarnings()" model="KC.model.httpAccess"></ndm-checkbox><div class="page-keendns__transfer-code"><div ng-if="!KC.transferCode.visible" class="page-keendns__transfer-code-stub"><div class="form__cell form__cell--input-label help-text" data-translate="">remoteAccess.keendns.register-popup.code</div> <div class="form__cell form__cell--top"><ndm-link is-disabled="KC.uiLocked" link-class="action-link" on-click="KC.transferCode.open()" label="remoteAccess.keendns.transfer.get-code"></ndm-link><ndm-help class="page-keendns__transfer-code--hint"><span data-translate="">remoteAccess.keendns.transfer.hint</span></ndm-help></div></div><ndm-input ng-if="KC.transferCode.visible" label="remoteAccess.keendns.register-popup.code" model="KC.transferCode.code" name="name" disabled="true" class="page-keendns__transfer-code-input" validation="required,keendnsTransferCode"><ndm-link tabindex="0" class="page-keendns__copy-transfercode-link" ng-class="{ \'page-keendns__copy-transfercode-link--disabled\': KC.uiLocked, \'page-keendns__copy-transfercode-link--copied\': KC.transferCode.isCopied }" on-click="KC.transferCode.copy()" label="{{ KC.transferCode.isCopied ? \'remoteAccess.keendns.notifications.clipboard-copied\' : \'remoteAccess.keendns.transfer.copy\'}}"></ndm-link></ndm-input></div></ndm-sub-form><div class="page-keendns__toolbar"><div ng-if="KC.transferCode.visible"><div class="form__cell form__cell--top page-keendns__cell"><ndm-text text="remoteAccess.keendns.transfer.description"></ndm-text></div><ndm-button ng-disabled="KC.uiLocked" on-click="KC.transferCode.cancel" label="remoteAccess.keendns.transfer.cancel"></ndm-button></div> <div ng-if="!KC.transferCode.visible"><ndm-button class="page-keendns__release-name-btn" ng-disabled="KC.uiLocked" on-click="KC.keendnsName.releaseName" label="remoteAccess.keendns.delete"></ndm-button></div></div></div><ndm-form-header ng-if="!KC.model.booked" label="remoteAccess.keendns.internet-center-name"></ndm-form-header><div ng-if="!KC.model.booked" class="page-keendns__keendns-name ndm-input"><div class="form__cell form__cell--input-label help-text"><span class="ng-binding" data-translate="">remoteAccess.keendns.domain-name</span></div> <div class="form__cell form__cell--top page-keendns__cell"><b>{{KC.defaultDomain}}</b> <span class="page-keendns__ssl-status"><i class="icon icon--https"></i> <span class="help-text--success" data-translate="">remoteAccess.keendns.register-popup.domain-with-ssl</span></span></div></div><ndm-sub-form ng-if="!KC.model.booked"><ndm-checkbox class="page-keendns__internet-access-checkbox" ndm-disabled-by-mws-tooltip="" disabled="KC.adminPasswordIsNotSet || NDM.DEVICE_IS_MWS_MEMBER" label="administrator.webaccess.access-by-internet" name="httpAccess" description="{{KC.getHttpAccessDescriptionForDefaultDomain()}}" on-change="KC.mode.setWarnings()" model="KC.model.httpAccess"></ndm-checkbox></ndm-sub-form><p ng-if="!KC.model.booked" class="body-text">{{\'remoteAccess.keendns.name-register\' | translate}}</p><div ng-if="!KC.model.booked" ng-form="KC.bookNameForm" class="page-keendns__book-name-form"><ndm-input label="remoteAccess.keendns.create-name" model="KC.model.name" name="name" on-validation-end="KC.keendnsName.revalidate" validation="keendnsDomain,length[5..32]" bs-modifiable="false"></ndm-input></div> <div ng-if="!KC.model.booked" class="form__row ng-scope"><ndm-button btn-class="btn--long" on-click="KC.keendnsName.openBookNamePopup" is-disabled="!KC.keendnsName.isValid || KC.uiLocked || !KC.model.name" label="remoteAccess.keendns.register"></ndm-button><ndm-single-key-bind key="enter" call-func="KC.keendnsName.openBookNamePopup()"></ndm-single-key-bind></div></ndm-fieldset><ndm-control-footer is-visible="KC.form.modified" is-save-disabled="KC.form.$invalid || KC.form.$pending || KC.uiLocked" save="KC.save()" cancel="KC.cancel()"></ndm-control-footer></form><div ng-if="KC.noNdssAccess" class="no-internet-connection"><br><ndm-form-header label="remoteAccess.keendns.internet-center-name"></ndm-form-header><div ng-hide="KC.isLoading"><span class="help-text--warning" data-translate="">remoteAccess.keendns.no-internet-connection-warn</span></div> <div ng-show="KC.isLoading"><i class="icon icon--load"></i> <span data-translate="">remoteAccess.keendns.no-internet-connection-reconnection</span></div></div><div ng-show="KC.isReady && !KC.noNdssAccess && !KC.isSpecialMode" class="page-keendns__proxy-section"><ndm-form-header hr="hr-light-blue" label="remoteAccess.keendns.proxy.title" sub-title="{{KC.l10n.proxyTableDescription}}"><div ng-if="!KC.model.booked" class="page-keendns__default-name-warning"><i class="icon icon--warning"></i> <span data-translate="">remoteAccess.keendns.notifications.web-applications-do-not-work-with-default-name</span></div></ndm-form-header><ndm-table ng-if="KC.proxyRules.data.length" class="page-keendns__proxy-table" data="KC.proxyRules.data" columns="KC.proxyRules.columns" click-on-row="KC.proxyRules.open" sort-name="domain" sort-reverse="false"></ndm-table><ndm-button is-disabled="KC.uiLocked || !KC.model.booked" on-click="KC.proxyRules.open" label="remoteAccess.keendns.add"></ndm-button></div> <div ng-include="\'app/page/controlPanel/networkRules/remoteAccess/keendns/keendns.book-name.popup.html\'"></div> <div ng-include="\'app/page/controlPanel/networkRules/remoteAccess/keendns/keendns.proxy-editor.popup.html\'"></div></div>'),e.put("app/page/controlPanel/networkRules/remoteAccess/keendns/keendns.proxy-editor.popup.html",'<div ng-controller="KeendnsProxyEditorController as vm"><ndm-popup class="keendns__proxy-popup" is-visible="vm.isOpened" header-title="remoteAccess.keendns.proxy.popup.title" close="vm.close" save="vm.save"><form name="KC.popupForm" ng-if="vm.isReady" ng-cloak="" novalidate=""><ndm-fieldset is-disabled="vm.uiLocked"><ndm-text text="{{vm.l10n.description}}"></ndm-text><ndm-selectbox label="remoteAccess.keendns.proxy.popup.device" name="popupUpstream" disabled="vm.uiLocked" options="vm.upstreamOptions" value="vm.model.upstream"></ndm-selectbox><ndm-input label="remoteAccess.keendns.proxy.popup.domain" model="vm.model.domain" name="popupDomain" description="{{\'.\' + KC.model.name + \'.\' + KC.model.domain}}" validation-text-error="{notInArray: \'errors.name-exists\'}" validation="required,keendnsDomain,length[2..32],notInArray[{{vm.occupiedDomains}}]"></ndm-input><ndm-checkbox label="remoteAccess.keendns.proxy.popup.allow" name="popupAllow" model="vm.model.allowAccess"></ndm-checkbox><ndm-radio label="remoteAccess.keendns.proxy.popup.protocol" name="popupProtocol" array="vm.protocolOptions" model="vm.model.protocol"></ndm-radio><ndm-input label="remoteAccess.keendns.proxy.popup.port" model="vm.model.port" name="popupPort" validation="portNumber"></ndm-input><br><ndm-button ng-if="vm.isExistingRule" on-click="vm.removeProxy" label="remoteAccess.keendns.delete"></ndm-button></ndm-fieldset><ndm-control-footer prefix="proxy" form="KC.popupForm" is-popup="true" is-visible="KC.popupForm.modified" is-save-disabled="KC.popupForm.$invalid || KC.popupForm.$pending" save="vm.save()" cancel="vm.close()"></ndm-control-footer></form></ndm-popup></div>'),e.put("app/page/controlPanel/myInternet/modems/usbqmi/airScan/usbqmi.airScan.html",'<div ng-controller="UsbQmiAirScanController as vm" class="popup-usbqmi"><div class="popup-usbqmi__scan-button__container"><div class="popup-usbqmi__timer__container"><div ng-if="vm.resultsRecievedTime && vm.list.items.length && vm.scanStatus === vm.SCAN_STATUS.COMPLETE" class="popup-usbqmi__timer" data-translate="usbqmi.air-scan.table.results-timer" data-translate-values="{time: vm.resultsRecievedTime}"></div></div><ndm-button class="popup-usbqmi__scan-button" label="{{vm.isScanAvailable ? \'usbqmi.air-scan.start-scan\' : \'usbqmi.air-scan.stop-scan\' }}" is-disabled="vm.isScanButtonDisabled" on-click="vm.isScanAvailable ? vm.startScan : vm.stopScan"></ndm-button></div> <div class="popup-usbqmi-operators__table__container" scroll-glue=""><ndm-table class="popup-usbqmi-operators__table" ng-show="vm.list.items.length && vm.scanStatus === vm.SCAN_STATUS.COMPLETE" data="vm.list.items" sortable="false" columns="vm.list.columns"></ndm-table><div ng-if="vm.scanStatus !== vm.SCAN_STATUS.COMPLETE" class="empty-list popup-usbqmi__scan-status" ng-class="{ \'popup-usbqmi__scan-status--error\': vm.scanStatus === vm.SCAN_STATUS.FAILED }" data-translate="">{{vm.scanStatusString}}</div> <div ng-if="vm.list.items.length === 0 && vm.scanStatus === vm.SCAN_STATUS.COMPLETE" class="empty-list" data-translate="">usbqmi.air-scan.no-results</div></div></div>'),e.put("app/page/controlPanel/myInternet/modems/usbqmi/simManagement/usbqmi.simManagement.html",'<div class="page-usbqmi__sim-management sim-management" ng-controller="UsbQmiSimManagementController as vm"><div ng-show="vm.isReady"><ndm-form-header class="sim-management__header" hr="hr-light-blue" label="usbqmi.sim-management.title"><div ng-if="!vm.isPinRequired() && vm.simState" class="sim-management__sim-state-message" data-translate="">{{ \'usbqmi.sim-state.\' + vm.simState }}</div> <div ng-if="vm.isPinRequired()" class="sim-management__sim-state-message" data-translate="">usbqmi.sim-state.PIN_CODE_REQUIRED</div></ndm-form-header><div ng-if="vm.isPinRequired()" ng-form="vm.pinForm" class="sim-management__pin-code-form" bs-modifiable="0"><ndm-input max-length="4" class="sim-management__pin-input" class-name="ndm-input-s" label="usbqmi.sim-management.pin-input" model="vm.pin" validation="required" extra-validator="vm.pinValidator" name="ltePin" description="{{ \'usbqmi.sim-management.pin-attempts-left\' | translate:{num: vm.pinAttemptsLeft} }}"></ndm-input><ndm-button btn-class="btn--long" label="usbqmi.sim-management.set-pin-code" is-disabled="vm.isSetPinBtnLocked || vm.pinForm.$invalid" on-click="vm.setPinCode"></ndm-button></div></div></div>')}]);