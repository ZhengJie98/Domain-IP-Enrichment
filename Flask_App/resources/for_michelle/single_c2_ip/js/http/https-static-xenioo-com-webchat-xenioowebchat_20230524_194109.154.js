﻿var xenioowebchat=function(){var SCHEME,IPV4,HOSTNAME,TLD,HOST_OR_IP,PATH,QUERY_FRAG,URI1,URI2,MAILTO,EMAIL,URI_RE,SCHEME_RE,quotes,default_options,STREAK_START=1,STREAK_END=2,STREAK_NONE=0,config=null,rootcontainer=null,chatcontainer=null,chatarea=null,chattext=null,chatinputarea=null,options=null,buttoncounter=0,cookiename="",itemid=1,lastitemid="",counter=null,button=null,unread=0,unreadcache=[],sendbutton=null,powered=null,root="https://static.xenioo.com",api="https://app.xenioo.com",content="webchat",buttoncont=null,created=!1,audio=null,logging=!1,timewritten=!1,widget=null,reading_chat=!1,reading_scheduled=!1,read_interval=1e4,max_read_interval=1e4,chatmenuisopened=!1,userclicked=!1,calloutbubble=null,calloutbubblehint=null,isTouchDevice=!1,isMobileDevice=!1,attachmentbutton=null,clipsvg="",scrollDownChatIsAnimating=!1,pwfield=null,formopened=!1,MODE_BLOCK_PANEL=0,MODE_RIGHT_BAR=1,fileattachinput=null,buttonscontainer=null,HISTORYPOS_TOP=0,HISTORYPOS_BOTTOM=1,variables=null,lastoptext="",maxposindex=0,shared=!1,readableText="",speechutterance=null,recengine=null,voiceinitialized=!1,redrawinghistory=!1,lastparts=null,readytointeract=!1,destroyed=!1,lastid="",lastpartwasupload=!1,flowbackenabled=!0,flowchatarea=null,audiochuncks=[],audiorecorder=null,VIEW_MODE_TAKE_OVER=2,VIEW_MODE_VIEW=1,VIEW_MODE_NO_OTHER=0;let today=new Date;function restartChat(){if(options.chatareaid){var e=document.getElementById(options.chatareaid);if(!e)return}else{var e=document.getElementById("xenioo-conversation-body");if(!e)return}options.userid=null,e.innerHTML="",getWelcome()}function xeniooRestart(e,t){var n=document.getElementById("xenioo-container");n&&n.remove();var a=document.getElementById("xenioo-chat-widget");return a&&a.remove(),created=!1,xenioo(e,t)}function xenioo(e,t){if(!created){if(lastid=e,created=!0,getScriptRoot(),isTouchDevice=window.navigator.maxTouchPoints>0||window.navigator.msMaxTouchPoints>0||"ontouchstart"in document.documentElement||window.DocumentTouch&&document instanceof DocumentTouch,isMobileDevice=!1,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|ipad|iris|kindle|Android|Silk|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(navigator.userAgent)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(navigator.userAgent.substr(0,4)))&&(isMobileDevice=!0),t&&t.root&&(root=t.root),t&&t.chid&&(shared=!0),-1!=e.indexOf("PREVIEW"))return init(e,t),options.preview=!0,this;enableCrossMessages(),e=getId(e);var n=new XMLHttpRequest,a=this;return n.onreadystatechange=function(){if(4==n.readyState){if(!n.response||"null"==n.response)return console.log("%cThis Xenioo chatbot is not correctly configured. The chatbot is not published or the current domain is not whitelisted. Please review your settings or contact Xenioo support.","font-size:18px;color:red;background:yellow"),t&&t.loadError&&t.loadError(),this;a.config=JSON.parse(n.response),t&&t.loadConfigCompleted&&t.loadConfigCompleted(a.config);var e=JSON.parse(n.response);e.avatarontop=!0,e.createbutton=!0,e.createarea=!0,e.enablesounds=!0,e.forceXeniooBrand=!1,e.nocounter=!1,e.buttonanimation=function(){buttonAnimationInternal(chatcontainer,button)},e.replyFn=null,e.speakerenabled=!1,e.onChatClose=function(){},e.onChatShow=function(){},e.onChatHide=function(){},e.onDataConnection=function(){},e.onItemRender=function(){},e.onElementRender=function(){},e.onButtonClick=function(){},e.onInit=function(){},e.onReady=function(){},e.onUserSays=function(){},e.onWidgetClick=function(){},e.onChatInteractionStarted=function(){},e.onChatInteractionCompleted=function(){},e.onFloatingAreaRender=function(){},e.onFloatingAreaOpened=function(){},e.onFloatingAreaClosed=function(){},e.onVoiceConfigured=function(){},e.onDestroy=function(){},e.onCalloutDisplay=function(){},e.historymode=0,e.viewmode=0,t&&mergeOptions(e,t),e.displaymode||(e.displaymode=MODE_BLOCK_PANEL),e.historystartpos||(e.historystartpos=HISTORYPOS_TOP),e.readinterval&&(max_read_interval=read_interval=e.readinterval),init(e.Id,{id:e.Id,shid:e.shid,viewmode:e.viewmode,userid:e.userid,chid:e.chid,prid:e.prid,displaymode:e.displaymode,historystartpos:e.historystartpos,name:e.Name,createbutton:e.createbutton,createarea:e.createarea,preview:e.Preview,style:e.Style,additionalstyle:e.AdditionalStyle,appeardelay:e.AppearDelay,behaviour:e.behaviour,avatarinline:e.avatarinline,avatarinlinepos:e.avatarinlinepos,forceXeniooBrand:e.forceXeniooBrand,nocounter:e.nocounter,avatarontop:e.avatarontop,avatar:e.Avatar,frame:e.Frame,placeholder:e.TextPlaceholder,buttontext:e.SendText,level:e.Level,buttonanimation:e.buttonanimation,enablesounds:e.EnableSounds,rewindchat:e.RewindChat,startopen:e.startopen,chatwidgetanchorid:e.chatwidgetanchorid,chatareaid:e.chatareaid,chattextid:e.chattextid,sendbuttonid:e.sendbuttonid,backcolor:e.BackgroundColor,forecolor:e.ForegroundColor,floatcolor:e.FloatingButtonsColor,Buttons:e.Buttons,subtitle:e.Subtitle,replyFn:e.replyFn,contexttype:e.ContextType,autoopencontext:e.AutoOpenContext,autoclosecontext:e.AutoCloseContext,contextitle:e.ContextTitle,contextheader:e.ContextHeaderText,autoopenchatdelay:e.ChatDelay,autoopenchatmobiledisabled:e.AutoDisplayMobileDisabled,variables:e.variables,tags:e.tags,historymode:e.historymode,waitforwidgetclick:e.WaitForWidgetClick,showbubble:e.CalloutBubble,calloutmode:e.CalloutBubbleMode,hidetimepart:e.hidetimepart,landingpage:e.landingpage,appendchattoid:e.appendchattoid,displayuseravatar:e.displayuseravatar,messagedatetemplate:e.messagedatetemplate,enabletextreader:e.enabletextreader,enablevoicerecording:e.enablevoicerecording,closeifhistory:e.closeifhistory,closeifknown:e.closeifknown,readerperson:e.readerperson,readerlanguage:e.readerlanguage,speakerenabled:e.speakerenabled,disabledchathidessend:e.disabledchathidessend,onChatShow:e.onChatShow,onChatHide:e.onChatHide,onChatClose:e.onChatClose,onDataConnection:e.onDataConnection,onItemRender:e.onItemRender,onElementRender:e.onElementRender,onButtonClick:e.onButtonClick,onInit:e.onInit,onReady:e.onReady,onUserSays:e.onUserSays,onWidgetClick:e.onWidgetClick,onChatInteractionStarted:e.onChatInteractionStarted,onChatInteractionCompleted:e.onChatInteractionCompleted,onVoiceConfigured:e.onVoiceConfigured,onDestroy:e.onDestroy,onCalloutDisplay:e.onCalloutDisplay,onFloatingAreaRender:e.onFloatingAreaRender,onFloatingAreaOpened:e.onFloatingAreaOpened,onFloatingAreaClosed:e.onFloatingAreaClosed,loadCompleted:e.loadCompleted,loadConfigCompleted:e.loadConfigCompleted,loadError:e.loadError,cookieDomain:e.cookieDomain})}},n.open("GET",api+"/webapi/endpoint/chat/"+e,!0),setHeaders(n),n.send(),this}}function xeniooAutoStart(){var e=document.getElementById("xenioowebchatscript");if(e){for(var t,n=e.src.replace(/^[^\?]+\??/,"").split("&"),a={},o=0;o<n.length;o++){var i=n[o].split("=");a[i[0]]=decodeURI(unescape(i[1])).replace(/\+/g," ")}var r=a.bid;r&&xenioo(r)}}function xeniooLanding(e,t,n){n.createbutton=!1,n.appendchattoid=t,n.landingpage=!0,n.hidetimepart=!0,n.avatarinline=!0,n.enablesounds=!0,xenioo(e,n)}function embedChatLanding(e){if(!e.container){console.error("Missing container parameter!");return}if(!e.landingUrl){console.error("Missing landingUrl parameter!");return}if(e.variables&&e.variables.length>0){var t="?";e.landingUrl.indexOf("?")>0&&(t="&");for(var n=0;n<e.variables.length;n++)t+=e.variables[n].Name+"="+e.variables[n].Value,n<e.variables.length-1&&(t+="&");e.landingUrl+=t}var a=document.createElement("iframe");a.setAttribute("src",e.landingUrl),a.setAttribute("frameborder","0"),a.style.width="100%",a.style.height="100%",document.getElementById(e.container).appendChild(a)}function embedChatFullPage(e){if(!e.landingUrl){console.error("Missing landingUrl parameter!");return}var t=document.createElement("iframe");t.setAttribute("src",e.landingUrl),t.setAttribute("frameborder","0"),t.style.width="100%",t.style.height="100%";var n=document.createElement("div");n.style.position="fixed",n.style.top=0,n.style.left=0,n.style.right=0,n.style.bottom=0,n.style.zIndex=1e3,n.appendChild(t),window.document.body.appendChild(n)}function getId(e){return -1!=e.indexOf("|")?e.split("|")[0]:e}function mergeOptions(e,t){e.loadCompleted=t.loadCompleted,e.loadError=t.loadError,e.loadConfigCompleted=t.loadConfigCompleted,e.variables=t.variables,e.tags=t.tags,e.shid=t.shid,isDefined(t.showbubble)&&(e.CalloutBubble=t.showbubble),isDefined(t.cookiedomain)&&(e.cookieDomain=t.cookiedomain),isDefined(t.disabledchathidessend)&&(e.disabledchathidessend=t.disabledchathidessend),isDefined(t.enabletextreader)&&(e.enabletextreader=t.enabletextreader),isDefined(t.enablevoicerecording)&&(e.enablevoicerecording=t.enablevoicerecording),isDefined(t.closeifhistory)&&(e.closeifhistory=t.closeifhistory),isDefined(t.closeifknown)&&(e.closeifknown=t.closeifknown),isDefined(t.readerperson)&&(e.readerperson=t.readerperson),isDefined(t.readerlanguage)&&(e.readerlanguage=t.readerlanguage),isDefined(t.speakerenabled)&&(e.speakerenabled=t.speakerenabled),t.displayuseravatar&&(e.displayuseravatar=t.displayuseravatar),t.messagedatetemplate&&(e.messagedatetemplate=t.messagedatetemplate),t.chatdelay&&(e.ChatDelay=t.chatdelay),t.autodisplaymobiledisabled&&(e.AutoDisplayMobileDisabled=t.autodisplaymobiledisabled),isDefined(t.waitforwidgetclick)&&(e.WaitForWidgetClick=t.waitforwidgetclick),t.historymode&&(e.historymode=t.historymode),t.floatingcontext&&(e.ContextType=t.floatingcontext?1:0),t.autoopencontext&&(e.AutoOpenContext=t.autoopencontext),t.autoclosecontext&&(e.AutoCloseContext=t.autoclosecontext),t.startopen&&(e.startopen=t.startopen),t.chatwidgetanchorid&&(e.chatwidgetanchorid=t.chatwidgetanchorid),t.chatareaid&&(e.chatareaid=t.chatareaid),isDefined(t.appeardelay)&&(e.AppearDelay=t.appeardelay),t.chattextid&&(e.chattextid=t.chattextid),t.sendbuttonid&&(e.sendbuttonid=t.sendbuttonid),t.style&&(e.Style=t.style),t.additionalstyle&&(e.AdditionalStyle=t.additionalstyle),isDefined(t.avatarinline)&&(e.avatarinline=t.avatarinline),isDefined(t.avatarinlinepos)&&(e.avatarinlinepos=t.avatarinlinepos),t.forceXeniooBrand&&(e.forceXeniooBrand=t.forceXeniooBrand),t.nocounter&&(e.nocounter=t.nocounter),isDefined(t.rewindchat)&&(e.RewindChat=t.rewindchat),isDefined(t.avatarontop)&&(e.avatarontop=t.avatarontop),isDefined(t.enablesounds)&&(e.EnableSounds=t.enablesounds),isDefined(t.createbutton)&&(e.createbutton=t.createbutton),isDefined(t.createarea)&&(e.createarea=t.createarea),isDefined(t.Frame)&&(e.Frame=t.Frame),t.buttonanimation&&(e.buttonanimation=t.buttonanimation),t.foregroundColor&&(e.ForegroundColor=t.foregroundColor),t.backgroundColor&&(e.BackgroundColor=t.backgroundColor),t.subtitle&&(e.Subtitle=t.subtitle),t.replyFn&&(e.replyFn=t.replyFn),t.onChatShow&&(e.onChatShow=t.onChatShow),t.onChatHide&&(e.onChatHide=t.onChatHide),t.onChatClose&&(e.onChatClose=t.onChatClose),t.onDestroy&&(e.onDestroy=t.onDestroy),t.onCalloutDisplay&&(e.onCalloutDisplay=t.onCalloutDisplay),t.onDataConnection&&(e.onDataConnection=t.onDataConnection),t.onItemRender&&(e.onItemRender=t.onItemRender),t.onElementRender&&(e.onElementRender=t.onElementRender),t.onButtonClick&&(e.onButtonClick=t.onButtonClick),t.onVoiceConfigured&&(e.onVoiceConfigured=parse.onVoiceConfigured),t.onInit&&(e.onInit=t.onInit),t.onReady&&(e.onReady=t.onReady),t.onUserSays&&(e.onUserSays=t.onUserSays),t.onWidgetClick&&(e.onWidgetClick=t.onWidgetClick),t.onChatInteractionStarted&&(e.onChatInteractionStarted=t.onChatInteractionStarted),t.onChatInteractionCompleted&&(e.onChatInteractionCompleted=t.onChatInteractionCompleted),t.onFloatingAreaRender&&(e.onFloatingAreaRender=t.onFloatingAreaRender),t.onFloatingAreaOpened&&(e.onFloatingAreaOpened=t.onFloatingAreaOpened),t.onFloatingAreaClosed&&(e.onFloatingAreaClosed=t.onFloatingAreaClosed),t.behaviour&&(e.behaviour=t.behaviour),isDefined(t.hidetimepart)&&(e.hidetimepart=t.hidetimepart),isDefined(t.landingpage)&&(e.landingpage=t.landingpage),isDefined(t.appendchattoid)&&(e.appendchattoid=t.appendchattoid),isDefined(t.displaymode)&&(e.displaymode=t.displaymode),isDefined(t.historystartpos)&&(e.historystartpos=t.historystartpos),isDefined(t.placeholder)&&(e.TextPlaceholder=t.placeholder),isDefined(t.displayuseravatar)&&(e.displayuseravatar=t.displayuseravatar),t.avatarurl&&(e.Avatar=t.avatarurl),t.sid&&(e.userid=t.sid),t.chid&&(e.chid=t.chid),t.prid&&(e.prid=t.prid),t.readinterval&&(e.readinterval=t.readinterval),t.viewmode&&(e.viewmode=t.viewmode)}function isDefined(e){return void 0!==e}function getScriptRoot(){var e=document.querySelector('script[data-id="xenioo"]');if(null!=e&&e||null!=(e=document.querySelector('script[data-id="chatbotsrc"]'))&&e){var t=e.getAttribute("data-node");if(null!=t&&t){if("localhost"==t){var n=e.getAttribute("data-port");null!=n&&n||(n=window.location.port),api=window.location.protocol+"//"+window.location.hostname+":"+n,n==window.location.port&&(root=window.location.protocol+"//"+window.location.hostname+":"+n,content="webchatsrc");return}if("loopback"==t){api=window.location.protocol+"//"+window.location.hostname+":"+window.location.port,root=window.location.protocol+"//"+window.location.hostname+":"+window.location.port,("localhost"==window.location.hostname||-1!=window.location.hostname.indexOf("ngrok"))&&(content="webchatsrc");return}if(t.indexOf("chat")>=0){api="https://"+t+".mbdt01.com",root="https://"+t+".mbdt01.com",content="webchatsrc";return}api="https://"+t+".xenioo.com"}}}function init(e,t){(options=t).onInit&&options.onInit(options),null!=options.variables&&options.variables||(options.variables=[]);var n=options.variables.find(e=>"user_id"==e.Name);null!=n&&hasValue(n.Value)&&(options.userid=n.Value),null!=options.tags&&options.tags||(options.tags=[]),parseOptions(e),loadResources(function(){if(createPageWidget(),cookiename="xenioo-"+options.id,options.userid||(options.userid=readCookie(cookiename)),setLastContact(),setFirstContact(),widget&&options.chatwidgetanchorid){var e=window.document.getElementById(options.chatwidgetanchorid);widget.style.position="absolute",e.appendChild(widget)}null==chatarea&&options.chatareaid&&((chatarea=window.document.getElementById(options.chatareaid)).setAttribute("class","xenioo-conversation-custom"),options.avatarinline&&chatarea.classList.add("x-avatarinline"),chatarea.innerHTML=""),null==chattext&&options.chattextid&&(chattext=window.document.getElementById(options.chattextid)),null==sendbutton&&options.sendbuttonid&&(sendbutton=window.document.getElementById(options.sendbuttonid)),null!=options.replyFn&&(doReply=options.replyFn,writePart=function(){},writeTime=function(){},write=function(){},endWait=function(){},scollDownChat=function(){}),options.onReady&&options.onReady(),setTimeout(function(){getWelcome()},1e3*options.appeardelay)})}function loadResources(e){isNullOrEmpty(options.additionalstyle)?-1!=options.style.indexOf("://")?loadCSS(options.style,function(){loadCSS("//fonts.googleapis.com/css?family=Roboto:300,400,500,300italic",e)}):loadCSS(root+"/"+content+"/"+options.style+".css",function(){loadCSS("//fonts.googleapis.com/css?family=Roboto:300,400,500,300italic",e)}):loadCSS(root+"/"+content+"/"+options.style+".css",function(){loadCSS(options.additionalstyle,function(){loadCSS("//fonts.googleapis.com/css?family=Roboto:300,400,500,300italic",e)})})}function createPageWidget(){if(options.createbutton)createChatWidget(),createChatArea(),window.document.body.appendChild(button);else{createChatArea(),createAttachmentButton(document.body);return}}function createChatWidget(){(widget=document.createElement("div")).setAttribute("id","xenioo-chat-widget"),widget.setAttribute("class","xenioo-chat-widget"),widget.style.opacity=0;var e=document.createElement("div");if(e.setAttribute("id","xenioo-chat-widget-button"),e.setAttribute("class","xenioo-chat-widget-button"),e.setAttribute("alt","Chatbot "+options.name+" button"),e.style.backgroundColor=options.backcolor,e.style.color=options.forecolor,e.style.backgroundImage="url('"+getAvatarImage(),e.style.backgroundSize="cover",widget.appendChild(e),!options.nocounter){var t=document.createElement("div");t.setAttribute("id","xenioo-chat-widget-counter"),t.setAttribute("class","xenioo-chat-widget-counter"),t.setAttribute("alt","Chatbot messages counter"),widget.appendChild(t),counter=t}button=widget,e.onclick=function(){onWidgetClicked(!1)},setCounter(0)}function onWidgetClicked(e){if(userclicked=!0,null!=calloutbubble&&hideCallout(),options.onWidgetClick&&options.onWidgetClick(e),options.waitforwidgetclick)toggleChat(),getWelcome();else{if(!readytointeract)return;toggleChat()}}function createChatArea(){if(options.createarea){(rootcontainer=document.createElement("div")).setAttribute("id","xenioo-container"),rootcontainer.classList.add("xenioo-container"),rootcontainer.classList.add("xenioo-chat-reset"),options.landingpage&&rootcontainer.classList.add("xenioo-landing"),options.landingpage&&rootcontainer.classList.add("xenioo-composer-detached"),(chatcontainer=document.createElement("div")).setAttribute("id","xenioo-conversation"),chatcontainer.setAttribute("class","xenioo-conversation"),chatcontainer.classList.add("xenioo-conversation-right"),options.displaymode==MODE_RIGHT_BAR&&chatcontainer.classList.add("xenioo-conversation-panel"),options.frame&&"xenioo-frame.jpg"!=options.frame&&(chatcontainer.style.backgroundImage="url('"+getImage(options.frame));var e,t=createChatConversationHeader(),n=createChatConversationBody(),a=chatinputarea=createChatConversationComposer();(options.landingpage||chatcontainer.appendChild(t),chatcontainer.appendChild(n),options.landingpage?(a.style.opacity=0,n.appendChild(a)):chatcontainer.appendChild(a),rootcontainer.appendChild(chatcontainer),options.landingpage&&options.appendchattoid)?window.document.getElementById(options.appendchattoid).appendChild(rootcontainer):window.document.body.appendChild(rootcontainer),setTextReader(options.speakerenabled)}}function createChatConversationHeader(){var e=document.createElement("div");e.setAttribute("id","xenioo-conversation-header"),e.setAttribute("class","xenioo-conversation-header"),options.avatarinline&&e.classList.add("x-avatarinline"),e.style.backgroundColor=options.backcolor,e.style.color=options.forecolor;var t=document.createElement("div");if(t.setAttribute("id","xenioo-conversation-header-title-container"),t.setAttribute("class","xenioo-conversation-header-title-container"),e.appendChild(t),!options.avatarinline&&options.avatarontop){var n=document.createElement("div");n.setAttribute("id","xenioo-conversation-header-avatar-container"),n.setAttribute("class","xenioo-conversation-header-avatar-container"),e.appendChild(n)}var a=document.createElement("div");a.setAttribute("id","xenioo-conversation-close-button"),a.setAttribute("class","xenioo-conversation-close-button"),a.onclick=function(){options.onChatClose&&options.onChatClose(),toggleChat()},e.appendChild(a);var o=document.createElement("div");o.setAttribute("id","xenioo-conversation-header-title"),o.setAttribute("class","xenioo-conversation-header-title"),o.style.color=options.forecolor,o.innerHTML=options.name;var i=document.createElement("div");if(i.setAttribute("id","xenioo-conversation-header-subtitle"),i.setAttribute("class","xenioo-conversation-header-subtitle"),i.style.color=options.forecolor,i.innerHTML=options.subtitle,t.appendChild(o),t.appendChild(i),!options.avatarinline&&options.avatarontop){var r=document.createElement("img");r.setAttribute("id","xenioo-conversation-header-avatar-image"),r.setAttribute("class","xenioo-conversation-header-avatar-image"),r.src=getAvatarImage(),n.appendChild(r)}var l=document.createElement("div");return l.className="xenioo-close-button-image",l.style.backgroundColor=options.forecolor,a.appendChild(l),e}function createChatConversationComposer(){var e=document.createElement("div");if(e.setAttribute("id","xenioo-conversation-composer"),e.setAttribute("class","xenioo-conversation-composer"),e.style.backgroundColor=options.backcolor,e.style.color=options.forecolor,"1"==options.level||options.forceXeniooBrand){var t=document.createElement("div");t.setAttribute("id","xenioo-conversation-poweredby"),t.setAttribute("class","xenioo-conversation-poweredby"),e.appendChild(t)}var n=document.createElement("div");n.setAttribute("class","xenioo-conversation-composer-container"),e.appendChild(n),createContextMenu(n),options.preview||createFloatingExtraContentContainer(),(buttonscontainer=document.createElement("div")).setAttribute("id","xenioo-conversation-composer-buttonscontainer"),buttonscontainer.setAttribute("class","xenioo-conversation-composer-buttonscontainer"),n.appendChild(buttonscontainer);var a=document.createElement("div");a.setAttribute("id","xenioo-conversation-composer-textarea"),a.setAttribute("class","xenioo-conversation-composer-textarea"),n.appendChild(a);var o=document.createElement("div");if(o.setAttribute("id","xenioo-conversation-composer-sendbutton"),o.setAttribute("class","xenioo-conversation-composer-sendbutton"),n.appendChild(o),"1"==options.level||options.forceXeniooBrand){var i=document.createElement("div");i.setAttribute("id","xenioo-conversation-poweredby-text"),i.setAttribute("class","xenioo-conversation-poweredby-text"),i.innerHTML="We're<i><svg width='7' height='13' viewBox='0 0 7 13'><g fill='none' fill-rule='evenodd'><path d='M4.127.496C4.51-.12 5.37.356 5.16 1.07L3.89 5.14H6.22c.483 0 .757.616.464 1.044l-4.338 6.34c-.407.595-1.244.082-1.01-.618L2.72 7.656H.778c-.47 0-.748-.59-.48-1.02L4.13.495z' fill='#F6A623'></path><path fill='#FEF79E' d='M4.606.867L.778 7.007h2.807l-1.7 5.126 4.337-6.34H3.16'></path></g></svg></i>by&nbsp;<a href='https://www.xenioo.com' target='_blank'>Xenioo</a>",t.appendChild(i)}var r=document.createElement("div");r.setAttribute("id","xenioo-conversation-textarea"),r.setAttribute("class","xenioo-conversation-textarea");var l=document.createElement("textarea");l.placeholder=options.placeholder,l.setAttribute("id","xenioo-user-chat-textarea-control"),l.onkeydown=function(e){if(13==e.keyCode)return say(e.currentTarget.value.trim()),e.currentTarget.value="",e.preventDefault(),!1},a.appendChild(r),r.appendChild(l);var s=document.createElement("button");return s.className="xenioo-send-button-image",s.style.backgroundColor=options.forecolor,s.onclick=function(){var e="",t=document.getElementById("xenioo-hidtext");return null==t?e=l.value:(say("<<__password__>>"+t.value.trim()),event.currentTarget.value="",event.preventDefault()),e&&e.trim().length>0&&(say(e.trim()),l.value=""),!1},o.appendChild(s),createAttachmentButton(buttonscontainer),initMicrophone(buttonscontainer),chattext=l,e}function createAttachmentButton(e){if(createAttachmentInput(e),attachmentbutton=document.getElementById("xenioo-attachment")){attachmentbutton.style.display="none";return}(attachmentbutton=document.createElement("button")).id="xenioo-attachment",attachmentbutton.className="xenioo-attached-file-image",attachmentbutton.style.display="none",attachmentbutton.style.backgroundColor=options.forecolor,attachmentbutton.onclick=function(){attachFile()},e.appendChild(attachmentbutton)}function createAttachmentInput(e){(fileattachinput=document.createElement("input")).type="file",fileattachinput.style.display="none",fileattachinput.onchange=function(e){sendAttachment(e.target.files[0])},e.appendChild(fileattachinput)}function attachFile(){fileattachinput.click()}function createContextMenu(e){if(options.Buttons&&options.Buttons.length>0){var t=document.createElement("div");t.setAttribute("id","xenioo-conversation-composer-menubutton"),t.setAttribute("class","xenioo-conversation-composer-menubutton xenioo-conversation-composer-menubutton-image"),t.style.backgroundColor=options.forecolor,e.appendChild(t),t.onclick=function(){toggleChatMenu()},1==options.contexttype?createFloatingChatConversationComposerMenuView():e.appendChild(createChatConversationComposerMenuView())}}function createFloatingExtraContentContainer(){if(rootcontainer){var e=document.createElement("div");e.setAttribute("id","xenioo-floating-extra-content"),e.classList.add("xenioo-floating-context"),e.classList.add("xenioo-floating-extra-content-right"),options.displaymode==MODE_RIGHT_BAR&&e.classList.add("xenioo-floating-extra-content-panel");var t=document.createElement("div");t.setAttribute("id","xenioo-floating-context-header"),t.setAttribute("class","xenioo-floating-context-header"),t.style.backgroundColor=options.backcolor,t.style.color=options.forecolor;var n=document.createElement("div");n.setAttribute("id","xenioo-floating-extra-content-header-title-container"),n.setAttribute("class","xenioo-floating-context-header-title-container"),t.appendChild(n);var a=document.createElement("div");a.setAttribute("id","xenioo-floating-context-close-button"),a.setAttribute("class","xenioo-floating-context-close-button"),a.onclick=function(){toggleFloatContent()},t.appendChild(a);var o=document.createElement("div");o.setAttribute("id","xenioo-floating-extra-content-header-title"),o.setAttribute("class","xenioo-floating-context-header-title"),o.style.color=options.forecolor,o.innerHTML=options.contextitle,n.appendChild(o);var i=document.createElement("div");i.className="xenioo-close-button-image",i.style.backgroundColor=options.forecolor,a.appendChild(i),t.appendChild(a),e.appendChild(t);var r=document.createElement("div");r.setAttribute("id","xenioo-floating-extra-content-body"),r.setAttribute("class","xenioo-floating-extra-content-body"),e.appendChild(r),rootcontainer.appendChild(e)}}function createFloatingChatConversationComposerMenuView(){if(rootcontainer){var e=document.createElement("div");e.setAttribute("id","xenioo-floating-context"),e.classList.add("xenioo-floating-context"),e.classList.add("xenioo-floating-context-right");var t=document.createElement("div");t.setAttribute("id","xenioo-floating-context-header"),t.setAttribute("class","xenioo-floating-context-header"),t.style.backgroundColor=options.backcolor,t.style.color=options.forecolor;var n=document.createElement("div");n.setAttribute("id","xenioo-floating-context-header-title-container"),n.setAttribute("class","xenioo-floating-context-header-title-container"),t.appendChild(n);var a=document.createElement("div");a.setAttribute("id","xenioo-floating-context-close-button"),a.setAttribute("class","xenioo-floating-context-close-button"),a.onclick=function(){toggleChatMenu()},t.appendChild(a);var o=document.createElement("div");o.setAttribute("id","xenioo-floating-context-header-title"),o.setAttribute("class","xenioo-floating-context-header-title"),o.style.color=options.forecolor,o.innerHTML=options.contextitle,n.appendChild(o);var i=document.createElement("div");i.className="xenioo-close-button-image",i.style.backgroundColor=options.forecolor,a.appendChild(i),t.appendChild(a),e.appendChild(t);var r=document.createElement("div");r.setAttribute("id","xenioo-floating-context-body"),r.setAttribute("class","xenioo-floating-context-body"),e.appendChild(r);var l=document.createElement("div");l.setAttribute("id","xenioo-floating-context-body-header"),l.setAttribute("class","xenioo-floating-context-body-header"),l.innerHTML=options.contextheader,r.appendChild(l);for(var s=0;s<options.Buttons.length;s++){var c=document.createElement("div");c.setAttribute("id","xenioo-floating-context-body-context-button"),c.setAttribute("class","xenioo-floating-context-body-context-button"),c.innerHTML=renderButton(options.Buttons[s]),r.appendChild(c)}rootcontainer.appendChild(e)}}function createChatConversationComposerMenuView(){var e=document.createElement("div");e.setAttribute("id","xenioo-conversation-composer-menuview"),e.setAttribute("class","xenioo-conversation-composer-menuview");var t=document.createElement("div");t.setAttribute("id","xenioo-conversation-composer-menuview-header"),t.setAttribute("class","xenioo-conversation-composer-menuview-header"),t.style.backgroundColor=options.backcolor,t.style.color=options.forecolor;var n="<svg class='xenioo-conversation-composer-menuview-close-button-icon' viewBox='0 0 32 32' version='1.1'><g><path d='M 8.71875 7.28125 L 7.28125 8.71875 L 14.5625 16 L 7.28125 23.28125 L 8.71875 24.71875 L 16 17.4375 L 23.28125 24.71875 L 24.71875 23.28125 L 17.4375 16 L 24.71875 8.71875 L 23.28125 7.28125 L 16 14.5625 Z'></path></g></svg>",a=document.createElement("span");a.innerHTML=n,t.onclick=function(){toggleChatMenu()},t.appendChild(a),e.appendChild(t);for(var o=0;o<options.Buttons.length;o++){var i=document.createElement("div");i.innerHTML=renderButton(options.Buttons[o]),e.appendChild(i)}return e}function createChatConversationBody(){var e=document.createElement("div");return e.setAttribute("id","xenioo-conversation-body"),e.classList.add("xenioo-conversation-body"),options.avatarinline&&e.classList.add("x-avatarinline"),("1"==options.level||options.forceXeniooBrand)&&e.classList.add("x-poweredby"),chatarea=e,e}function toggleChat(){setReadCache(),options.buttonanimation&&options.buttonanimation(chatcontainer,widget)}function closeFloatContent(){var e="xenioo-floating-extra-content",t=document.getElementById(e);null!=t&&t.classList.contains("opened")&&toggleFloatContent()}function openFloatContent(){var e="xenioo-floating-extra-content",t=document.getElementById(e);null==t||t.classList.contains("opened")||toggleFloatContent()}function floatContentIsOpenend(){var e="xenioo-floating-extra-content",t=document.getElementById(e);return!!t&&t.classList.contains("opened")}function toggleFloatContent(){var e="xenioo-floating-extra-content",t=document.getElementById(e);t&&(t.classList.contains("opened")?(t.classList.remove("opened"),t.setAttribute("style",""),options.displaymode==MODE_RIGHT_BAR&&chatcontainer.classList.add("xenioo-conversation-active"),options.onFloatingAreaClosed&&options.onFloatingAreaClosed()):(t.classList.add("opened"),options.displaymode==MODE_RIGHT_BAR&&chatcontainer.classList.remove("xenioo-conversation-active"),options.onFloatingAreaOpened&&options.onFloatingAreaOpened()))}function closeMenuIfOpened(){var e="xenioo-conversation-composer-menuview";1==options.contexttype&&(e="xenioo-floating-context");var t=document.getElementById(e);t&&t.classList.contains("opened")&&toggleChatMenu()}function toggleChatMenu(){var e="xenioo-conversation-composer-menuview";1==options.contexttype&&(e="xenioo-floating-context");var t=document.getElementById(e);t&&(t.classList.contains("opened")?(chatmenuisopened=!1,t.classList.remove("opened")):(chatmenuisopened=!0,t.classList.add("opened")))}function closeChatMenuIfOpened(){if(chatmenuisopened){var e="xenioo-conversation-composer-menuview";1==options.contexttype&&(e="xenioo-floating-context");var t=document.getElementById(e);t&&(chatmenuisopened=!1,t.classList.remove("opened"))}}function destroy(){destroyed=!0;var e=document.getElementById("xenioo-container");e&&e.parentNode.removeChild(e);var t=document.getElementById("xenioo-chat-widget");t&&t.parentNode.removeChild(t),created=!1,t=!1,options.onDestroy&&options.onDestroy()}function buttonAnimationInternal(e,t){e&&(e.classList.contains("xenioo-conversation-active")?(e.classList.remove("xenioo-conversation-active"),rootcontainer.classList.remove("xenioo-conversation-active"),closeMenuIfOpened(),options.displaymode==MODE_RIGHT_BAR&&moveinChatWidget(),options.onChatHide&&options.onChatHide()):(e.classList.add("xenioo-conversation-active"),rootcontainer.classList.add("xenioo-conversation-active"),setCounter(0),options.autoopencontext&&toggleChatMenu(),options.displaymode==MODE_RIGHT_BAR&&moveoutChatWidget(),options.onChatShow&&options.onChatShow()))}function closeChat(){isChatOpened()&&toggleChat()}function openChat(){isChatOpened()||toggleChat()}function isChatOpened(){return!chatcontainer||chatcontainer.classList.contains("xenioo-conversation-active")}function hideChatWidget(){widget&&(widget.style.display="none")}function showChatWidget(){widget&&(widget.style.display="block")}function moveoutChatWidget(){widget&&(widget.style.right="-100px",widget.style.opacity="0")}function moveinChatWidget(){widget&&(widget.style.right="20px",widget.style.opacity="1")}function getAvatarImage(){return -1!=options.avatar.indexOf("://")?options.avatar:root+"/"+content+"/"+options.avatar}function getImage(e){return -1!=e.indexOf("://")?e:api+"/"+content+"/"+e}function setCounter(e){null!=button&&chatcontainer&&(0==button.style.opacity&&(button.style.opacity=1),0==e||chatcontainer.classList.contains("xenioo-conversation-active")?(counter&&(counter.style.opacity=0),unread=0):counter&&null!=e&&e>0?(counter.innerHTML=e,counter.style.opacity=1):counter.style.opacity=0)}function parseOptions(e){if(e&&!(0>e.indexOf("|"))){var t=e.split("|");return e=t[0],options.behaviour=t[1],options.preview="True"==t[2],options.id=e,e}}function say(e,t,n){!(isNullOrEmpty(e)&&isNullOrEmpty(e=chattext.value))&&(chattext&&chattext.disabled||doCommand(e,t,n))}function doCommand(e,t,n){getViewMode()==VIEW_MODE_VIEW&&hasValue(t)||(getViewMode()<VIEW_MODE_TAKE_OVER&&writeUser(e),send(e,t,n))}function handOver(e){(isInsideIframe()||(isNullOrEmpty(e)&&(e="Hand over the conversation to Xenioo?\r\nThis will transform this share into a standard view share."),confirm(e)))&&send(null,"HAND_OVER",null)}function isInsideIframe(){try{return window.self!==window.top}catch(e){return!0}}function goTo(e,t,n){send(null,"GOTO:1|"+e+"|"+t,n)}function writeUser(e,t){0==e.indexOf("<<__password__>>")&&(e="******"),isNullOrEmpty(e)&&(e="&lt;command&gt;"),e=sanitizeTags(e);var n="",a="",o="";if(options.displayuseravatar){var i=getVariable("profile_pic");null!=i&&i||(i="https://static.xenioo.com/webchat/user_avatar.png"),n="<div class='xenioo-avatar-message-bubble'>",a="<div class='xenioo-user-avatar-image-container' style=\"border: solid 2px "+options.backcolor+";background:Url('"+i+"');background-size:cover;\"></div>",o="u-bubble-with-avatar"}if(getViewMode()>VIEW_MODE_NO_OTHER&&("&lt;command&gt;"==e||""==e)&&t){var r=getPossibleContent(t.Command);if("image"==r)e="<img style='max-width: 100%;' src='"+t.Command+"'>";else if("location"==r){if(r.indexOf("|")>0){var l=t.Command.substring(9);l=l.substring(0,l.indexOf("|")),e="<a target='_blank' style='color:"+options.forecolor+";' href='"+l+"'>Show Location On Map</a>"}else{var l=t.Command.substring(9),s=l.split(";"),c=s[2];""==c&&(c="Location"),e="<a target='_blank' style='color:"+options.forecolor+";' href='https://www.google.com/maps/dir/"+s[0]+","+s[1]+"'>"+c+"</a>"}}else""!=r&&(e="<a target='_blank' style='color:"+options.forecolor+";' href='"+t.Command+"'>"+t.Command+"</a>")}write(n+"<div class='u-message-bubble fix-sizing'><div class='u-bubble-hint fix-sizing'></div><div class='u-bubble-text fix-sizing "+o+"' style='color:"+options.forecolor+";background-color:"+options.backcolor+";'>"+e+"</div></div>"+a),getViewMode()==VIEW_MODE_NO_OTHER&&write("<div id='x-tempwait' class='x-message-bubble fix-sizing'><img class='x-wait-img' width='48' src='https://static.xenioo.com/webchat/loader.gif'></div>")}function getPossibleContent(e){if(!e||null==e||0>e.indexOf("."))return"";if(0==e.indexOf("location|")||0==e.indexOf("position:"))return"location";var t=e.substr(e.lastIndexOf(".")+1);switch(t){case"jpg":case"jpeg":case"bmp":case"tiff":case"png":case"gif":return"image";case"mp4":case"mpeg":return"video";case"mp3":case"ogg":case"oga":return"audio";case"html":return"html"}}function setUserIdInfo(e){isDefined(e.UserId)&&null==options.userid&&(options.userid=e.UserId,writeCookie(cookiename,options.userid,3650))}function doReply(e,t){if(e){if(flowbackenabled&&(flowchatarea=chatarea,chatarea=document.createElement("div")),setUserIdInfo(e),this.variables=e.Variables,this.lastparts=e.Parts,e.close){window.location.reload();return}e.I>maxposindex&&(maxposindex=e.I);var n=e.Parts;if(n){if(void 0===t&&(t=0),postReplyMsg(e),options.landingpage&&0==t&&chatinputarea&&(chatinputarea.style.opacity=0),0==t&&(sendbutton&&(sendbutton.disabled=0==e.ControlType),chattext&&(chattext.disabled=0==e.ControlType),options.onChatInteractionStarted&&options.onChatInteractionStarted()),options.historystartpos==HISTORYPOS_BOTTOM&&!options.chatstarted){var a=document.getElementById("xenioo-conversation-body");a&&null!=a&&(options.chatstarted=!0,write("<div style='flex: 1 1 auto;'></div>"),a.style.display="flex",a.style.flexDirection="column")}if(0==n.length&&options.preview){writeWarning("<b>Ouch!??</b><br>Looks like this bot did not send any meaningful message during preview mode.<br>???Please check that all the interactions items are correctly configured."),writeWarning("<b>Do not despair!</b><br>If you have troubles building your bot, please try checking out our tutorials!??<br>https://www.xenioo.com/tutorials/"),writeWarning("<b>...Or not?</b><br>If the last block was just ment to be an execution or data processing, this is fine :)");return}(e.L>0||e.FL>0)&&0==t&&getViewMode()>VIEW_MODE_NO_OTHER&&flowbackenabled&&writeTop("<div id='load_history' onclick='xenioowebchat.loadHistory("+(e.L?e.L:e.FL)+")' class='more-messages'>Click here to load previous messages</div>");for(var o=t;o<n.length;o++){var i=n[o];if((-1!=i.TypeDelay||-1!=options.historymode)&&(!options.onItemRender||(options.onItemRender(i),null!=i))){if(unread+=isContentUnread(i),!(i.TypeDelay>0)||logging||flowbackenabled)writePart(i,o,n),o==n.length-1&&(setCounter(unread),EndTransmissions(e,i));else{(25==i.Type&&i.Data.ShowTypingIndicator||25!=i.Type)&&writeWait(),setTimeout(function(){writePart(i,o,n),doReply(e,o+1),o==n.length-1&&(setCounter(unread),EndTransmissions(e,i))},i.TypeDelay);break}}}flowbackenabled&&(flowchatarea.insertBefore(chatarea,flowchatarea.firstChild),chatarea=flowchatarea),flowbackenabled||scollDownChat(chatarea,1e3)}}}function localStorageIsEnabled(){try{return window.localStorage}catch(e){return!1}}function isContentUnread(e){if(!localStorageIsEnabled())return 1;var t=crc32(""+e.Creation+"."+e.Text+"."+e.Command),n=window.localStorage.getItem(t);return n&&null!=n?0:(unreadcache.push(t),1)}function setReadCache(){if(localStorageIsEnabled()){for(var e=0;e<unreadcache.length;e++)window.localStorage.setItem(unreadcache[e],"1");unreadcache=[]}}function writeWait(){getViewMode()==VIEW_MODE_NO_OTHER&&write("<div id='x-tempwait' class='x-message-bubble fix-sizing'><img class='x-wait-img' width='48' src='https://static.xenioo.com/webchat/loader.gif'></div>")}function EndTransmissions(e,t){null!=e.Parts&&0!=e.Parts.length&&(null!=buttoncont&&(buttoncont=null),getViewMode()==VIEW_MODE_NO_OTHER&&playSound(),!options.preview&&t&&t.Parts.length>0&&t.Parts[0].Data&&t.Parts[0].Data.RedirectToFloating||floatContentIsOpenend()||19==t.Type||writeTime(e),1==e.ControlType?(sendbutton&&(sendbutton.disabled=!1),chattext.disabled=!1,attachmentbutton&&getViewMode()==VIEW_MODE_NO_OTHER&&(attachmentbutton.style.display="")):(sendbutton&&(sendbutton.disabled=!e.EnableUserChat),chattext&&(chattext.disabled=!e.EnableUserChat)),options.landingpage&&chatinputarea&&(chatinputarea.style.opacity=1),chattext&&!isMobileDevice&&chattext.focus(),logging=!1,timewritten=!1,options.startopen&&(options.startopen=!1,toggleChat()),options.disabledchathidessend&&chatinputarea&&(e.EnableUserChat?(chatinputarea.style.display="",chatarea.style.bottom="58px"):(chatinputarea.style.display="none",chatarea.style.bottom="0px")),options.onChatInteractionCompleted&&options.onChatInteractionCompleted(),isChatOpened()&&setReadCache())}function playSound(){if(!readText()&&options.enablesounds){null==audio&&((audio=new Audio(root+"/"+content+"/bling.mp3")).volume=.5);var e=audio.play();void 0!==e&&e.then(e=>{}).catch(e=>{})}}function writeTime(e,t){if(timewritten=!0,!options.hidetimepart){var n=new Date,a="";(a=e.Parts&&e.Parts.length>0?""+e.Parts[e.Parts.length-1].Creation:""+e.Creation).indexOf(".")>0&&(a=a.substring(0,a.indexOf("."))),n=new Date(a);var o=getVariable("timezone_shift");""!=o&&null!=o&&o||(o="0");var i=36e5*Number(o);n=new Date(n.getTime()+i);var r=document.createElement("div");r.setAttribute("id","x-message-time"),t?r.setAttribute("class","u-message-time"):r.setAttribute("class","x-message-time"),r.innerHTML=getDateFromTemplate(n),chatarea&&chatarea.innerHTML.length>0&&(options.landingpage?chatarea.insertBefore(r,chatinputarea):chatarea.appendChild(r))}}function getDateFromTemplate(e){options.messagedatetemplate||(options.messagedatetemplate="Sent hh:mm AMPM"),getViewMode()>VIEW_MODE_NO_OTHER&&0>options.messagedatetemplate.indexOf("{date}")&&(options.messagedatetemplate=replace(options.messagedatetemplate,"hh:"," {date} hh:"),options.messagedatetemplate=replace(options.messagedatetemplate,"HH:"," {date} HH:"));var t=e.getHours(),n=e.getMinutes(),a=e.getSeconds(),o="am",i=t;i>12&&(i-=12,o="pm"),n=n<10?"0"+n:n,a=a<10?"0"+a:a;var r=options.messagedatetemplate;return r=(r=(r=(r=(r=r.replace("HH",t)).replace("hh",i)).replace("mm",n)).replace("ss",a)).replace("AMPM",o),r=e.getDate()==today.getDate()&&e.getMonth()==today.getMonth()&&e.getFullYear()==today.getFullYear()?r.replace("{date} ",""):r.replace("{date} ",(9>e.getDate()?"0"+e.getDate():e.getDate())+"/"+(e.getMonth()+1<9?"0"+(e.getMonth()+1):e.getMonth()+1)+"/"+e.getFullYear()+"&nbsp;")}function getInline(){return options.avatarinline?"":"-inline"}function getAvatarInline(e){return options.avatarinline?0!=options.avatarinlinepos?(removeAll("xenioo-inline-avatar-image"),"<div id='xenioo-inline-avatar-image' class='x-avatar-img' style='background-image:url(\""+getAvatarImage()+"\"); background-size: contain;top:unset!important;bottom:0px;'></div>"):0==e||e>0&&timewritten?"<div class='x-avatar-img' style='background-image:url(\""+getAvatarImage()+"\"); background-size: contain;'></div>":"":""}function getMessageBubbleClass(){return"x-bubble-text"}function endWait(){removeAll("x-tempwait"),removeAll("x-form-wait-img")}function removeAll(e){for(var t=document.getElementById(e);null!=t;)t.parentElement.removeChild(t),t=document.getElementById(e)}function writePart(part,index,parts){endWait();var tx=fix(part.Text);switch(1!=part.Type&&null!=buttoncont&&(buttoncont=null),"pw"==part.SubType?createPasswordField():removePasswordField(),isFileUpload(part.SubType)?(lastpartwasupload=!0,null!=attachmentbutton&&(attachmentbutton.style.display="")):(lastpartwasupload=!1,null!=attachmentbutton&&(attachmentbutton.style.display="none")),0==index&&(readableText=""),part.Type){case 0:case 6:if(isNullOrEmpty(tx)){unread>0&&unread--;break}var displaytext=linkify(tx),customstyle=part.Data&&part.Data.CssClass?replaceQuote(part.Data.CssClass):"";write("<div class='x-message-bubble "+customstyle+"'>"+getAvatarInline(index)+"<div class='x-message-bubble-content'><div class='x-bubble-hint'></div><div class='"+getMessageBubbleClass()+"'>"+displaytext+"</div></div></div>",null,part),options.calloutmode>0&&(2==options.calloutmode&&0==index||1==options.calloutmode&&index==parts.length-1)&&showCallout(displaytext),addReadableText(part.Text);break;case 1:unread>0&&unread--,displayButton(tx,index,part),buttoncounter++;break;case 3:var content="<img class='x-image-element' src='"+tx+"'>";part.Command&&(content="<a href='"+part.Command+"' target='_blank'>"+content+"</a>"),write("<div class='x-message-bubble'>"+getAvatarInline(index)+"<div class='x-message-bubble-content'><div class='x-image'>"+content+"</div></div></div>",null,part);break;case 9:write("<div class='x-message-bubble'>"+getAvatarInline(index)+"<div class='x-message-bubble-content'><div class='x-video'><video class='x-video-control' controls><source src='"+part.Text+"'></video></div></div></div>",null,part);break;case 10:write("<div class='x-message-bubble'>"+getAvatarInline(index)+"<div class='x-message-bubble-content'><div class='x-audio'><audio class='x-audio-control' controls><source src='"+part.Text+"'></audio></div></div></div>",null,part);break;case 11:var tx="Download File";isNullOrEmpty(part.Command)||(tx=part.Command),write("<div class='x-message-bubble'>"+getAvatarInline(index)+"<div class='x-message-bubble-content'><div class='x-bubble-hint'></div><div class='"+getMessageBubbleClass()+"'><a href='"+part.Text+"' download>"+tx+"</a></div></div></div>",null,part);break;case 13:write("<div class='x-message-bubble'>"+getAvatarInline(index)+"<div class='x-message-bubble-content'>"+renderCard(part,!1)+"</div></div></div>",null,part);break;case 33:write("<div class='x-message-bubble'>"+getAvatarInline(index)+"<div class='x-message-bubble-content'>"+renderCarousel(part)+"</div></div></div>",null,part);break;case 5:part.Parts[0].Data.RedirectToFloating&&!options.preview&&canDisplayFloat()?showFloatCard(part.Parts[0]):(write("<div class='x-message-bubble'>"+getAvatarInline(index)+"<div class='x-message-bubble-content'>"+renderCarousel(part)+"</div></div></div>",null,part),isTouchDevice&&detectswipe("carousel_"+(itemid-1),itemid-1,function(e,t,n){"r"==n?xenioowebchat.ScrollCarousel(-4,1,-1):(n="l",xenioowebchat.ScrollCarousel(4,1,1))}));break;case 12:write("<div class='x-message-bubble'>"+getAvatarInline(index)+"<div class='x-message-bubble-content'>"+renderList(part)+"</div></div></div>",null,part);break;case 17:part.Data&&part.Data.RedirectToFloating&&!options.preview&&getViewMode()==VIEW_MODE_NO_OTHER?showFloatingUrl(part):part.Data&&part.Data.Description?write("<div class='x-message-bubble'>"+getAvatarInline(index)+"<div class='x-message-bubble-content'><div class='x-list-container fix-sizing' id='"+getChatItemId()+"'>"+renderListItem(part,!1)+"</div></div></div></div>",null,part):part.Data.OpenInSameWindow&&!options.preview?write("<div class='x-message-bubble'>"+getAvatarInline(index)+"<div class='x-message-bubble-content'><div class='x-bubble-hint'></div><div class='"+getMessageBubbleClass()+"'><a target='_self' href='"+part.Command+"'>"+part.Text+"</a></div></div></div>",null,part):write("<div class='x-message-bubble'>"+getAvatarInline(index)+"<div class='x-message-bubble-content'><div class='x-bubble-hint'></div><div class='"+getMessageBubbleClass()+"'><a target='_blank' href='"+part.Command+"'>"+part.Text+"</a></div></div></div>",null,part);break;case 19:unread>0&&unread--,readableText="",parts&&index>0&&19!=parts[index-1].Type&&writeTime(parts[index-1],!1);var cont,tx=part.Text;getViewMode()>VIEW_MODE_NO_OTHER&&((null!=part.Command&&0==part.Command.indexOf("https")&&(tx=part.Command),"image"==part.SubType)?tx="<img style='max-width: 100%;' src='"+tx+"'>":"video"==part.SubType?tx="<video style='max-width: 100%;' controls><source src='"+tx+"'></video>":"audio"==getPossibleContent(tx)&&(tx="<audio style='width: 219px;padding-right: 95px;' class='x-audio-control' controls><source src='"+tx+"'></audio>")),writeUser(tx,part),writeTime(part,!0);break;case 25:break;case 27:try{eval(part.Text)}catch(e){console.log("Xenioo -- JSEval:"+e.message)}break;case 30:if(redrawinghistory&&index<parts.length-1){write("<div class='x-message-bubble "+customstyle+"'>"+getAvatarInline(index)+"<div class='x-message-bubble-content'><div class='x-bubble-hint'></div><div class='"+getMessageBubbleClass()+"'>"+part.Text+"</div></div></div>",null,part);break}displayButton(part.Text,index,{Text:part.Text,SubType:"url",Command:part.Data.Url,Data:part.Data});break;case 31:if(getViewMode()==VIEW_MODE_NO_OTHER)break;var pars="";if(null!=part.Data.StructuredParameters)for(var i=0;i<part.Data.StructuredParameters.length;i++)pars+="<div class='x-template-param'><div title='"+fixDesc(part.Data.StructuredParameters[i].Value)+"' class='x-template-param-value'>"+fixDesc(part.Data.StructuredParameters[i].Value)+"</div><div class='x-template-param-pos'>("+part.Data.StructuredParameters[i].Section+")</div></div>";if(null!=part.Data.Parameters)for(var i=0;i<part.Data.Parameters.length;i++)pars+="<div class='x-template-param'><div title='"+fixDesc(part.Data.Parameters[i])+"' class='x-template-param-value'>"+fixDesc(part.Data.Parameters[i])+"</div><div class='x-template-param-pos'>(body)</div></div>";write("<div class='x-message-bubble'>"+getAvatarInline(index)+"<div class='x-message-bubble-content'><div class='x-bubble-hint'></div><div class='"+getMessageBubbleClass()+"'><div class='x-template-title'>"+part.Text+"</div><div class='x-template-img'></div>"+pars+"</div></div></div>",null,part);break;case 34:if(hasValue(part.Command)){var content="<img alt='"+part.Data.Name+"' class='x-image-element' src='"+part.Command+"'>";content="<a href='"+part.Data.MapUrl+"' target='_blank'>"+content+"</a>",write("<div class='x-message-bubble'>"+getAvatarInline(index)+"<div class='x-message-bubble-content'><div class='x-image'>"+content+"</div></div></div>",null,part)}else write("<div class='x-message-bubble'>"+getAvatarInline(index)+"<div class='x-message-bubble-content'><div class='x-bubble-hint'></div><div class='"+getMessageBubbleClass()+"'><a target='_blank' href='"+part.Data.MapUrl+"'>"+part.Data.Name+", "+part.Data.Address+"</a></div></div></div>",null,part);break;default:unread>0&&unread--,console.log("Unknow tag type:"+part.Type)}}function createPasswordField(){if(null==pwfield){(pwfield=document.createElement("input")).type="text";var e=window.getComputedStyle(pwfield);e.webkitTextSecurity||""==e.webkitTextSecurity?pwfield.style.webkitTextSecurity="disc":pwfield.type="password",pwfield.id="xenioo-hidtext",pwfield.className="message-text",pwfield.style.webkitTextSecurity="disc",pwfield.onkeydown=function(e){if(13==e.keyCode)return say("<<__password__>>"+e.currentTarget.value.trim()),e.currentTarget.value="",e.preventDefault(),!1};var t,n=document.getElementById("xenioo-conversation-textarea");n&&null!=n||(n=document.getElementById("xenioo-conversation-composer-buttonscontainer")),document.getElementById(options.chattextid?options.chattextid:"xenioo-user-chat-textarea-control").style.display="none",n.insertBefore(pwfield,n.childNodes[0]),pwfield.focus()}}function removePasswordField(){if(null!=pwfield){var e=document.getElementById("xenioo-conversation-textarea");e&&null!=e||(e=document.getElementById("xenioo-conversation-composer-buttonscontainer"));var t=document.getElementById(options.chattextid?options.chattextid:"xenioo-user-chat-textarea-control");t.style.display="",e.removeChild(pwfield),pwfield=null,t.focus()}}function displayButton(e,t,n){if(null==buttoncont&&("url"!=n.SubType||"url"==n.SubType&&!n.Data.AutoOpen)){var a=document.createElement("div");a.className="x-message-bubble x-parttype-1",a.innerHTML=getAvatarInline(t);var o=document.createElement("div");o.className="x-message-bubble-content",(buttoncont=document.createElement("div")).className="x-qbuttons-container",o.appendChild(buttoncont),a.appendChild(o),options.landingpage?chatarea.insertBefore(a,chatinputarea):chatarea.appendChild(a)}var i=n.Data&&n.Data.CssClass?replaceQuote(n.Data.CssClass):"",r="";n.Data&&n.Data.ImageUrl&&(r="<div class='x-button-icon' style=\"background-image:Url('"+n.Data.ImageUrl+"')\"></div>"),"link"==n.SubType?write("<div class='x-button-link "+replaceQuote(i)+"' id='x-button"+buttoncounter+"' onclick=\"xenioowebchat.Command('"+dropSinglePoint(e)+"','"+dropSinglePoint(n.Command)+"')\" >"+r+n.Text+"</div>",buttoncont,n):"url"==n.SubType?n.Data.AutoOpen?openForm(null,dropSinglePoint(n.Command),n.Data.RedirectToFloating,n.Data.InlineDisplay,n.Data.Caption,n.Data.Confirm,n.Data.Cancel,n.Data.HideConfirmButton,n.Data.HideCancelButton,n.Data.SwapButtonsOrder):write("<div class='x-button-link "+replaceQuote(i)+"' id='x-button"+buttoncounter+"' onclick=\"xenioowebchat.openForm( this, '"+dropSinglePoint(n.Command)+"', "+n.Data.RedirectToFloating+","+n.Data.InlineDisplay+", '"+n.Data.Caption+"', '"+n.Data.Confirm+"', '"+n.Data.Cancel+"', "+n.Data.HideConfirmButton+", "+n.Data.HideCancelButton+", "+n.Data.SwapButtonsOrder+' )" >'+r+n.Text+"</div>",buttoncont,n):write("<div class='x-button "+replaceQuote(i)+"' id='x-button"+buttoncounter+"' onclick=\"xenioowebchat.Command('"+dropSinglePoint(e)+"','"+dropSinglePoint(n.Command)+"')\" >"+r+n.Text+"</div>",buttoncont,n)}function openForm(e,t,n,a,o,i,r,l,s,c){if(formopened=!0,(read_interval/=2)<5e3&&(read_interval=5e3),null!=e?(e.onclick=null,e.className="x-button",e.style.cursor="default",e.innerHTML="<img id='x-form-wait-img' width='24' src='https://static.xenioo.com/webchat/loader.gif'>"+e.innerHTML):(moveinChatWidget(),openChat()),l&&(i=""),s&&(r=""),(n||a)&&!options.preview){var d={Text:o,Command:t,Parts:[],Data:{HideConfirmButton:l,HideCancelButton:s,InlineDisplay:a,SwapButtonsOrder:c}};c?(d.Parts.push({Text:r,Command:"document.getElementById('xenioo-floating-iframe').contentWindow.postMessage( 'xenioo_cancelForm', '*' )"}),d.Parts.push({Text:i,Command:"document.getElementById('xenioo-floating-iframe').contentWindow.postMessage( 'xenioo_confirmForm', '*' )"})):(d.Parts.push({Text:i,Command:"document.getElementById('xenioo-floating-iframe').contentWindow.postMessage( 'xenioo_confirmForm', '*' )"}),d.Parts.push({Text:r,Command:"document.getElementById('xenioo-floating-iframe').contentWindow.postMessage( 'xenioo_cancelForm', '*' )"})),showFloatingUrlWithButtons(d)}else window.open(t)}function showFloatingUrlWithButtons(e){var t=document.getElementById("xenioo-floating-context-header");document.getElementById("xenioo-floating-extra-content-header-title").innerHTML=e.Text;var n=document.getElementById("xenioo-floating-extra-content-body");if(0==e.Text.length?(t.style.display="none",n.setAttribute("style","margin-top:0px !important")):(t.style.display="",n.setAttribute("style","")),options.displaymode==MODE_RIGHT_BAR)n.innerHTML="<iframe id='xenioo-floating-iframe' class='xenioo-float-extra-content-iframe-with-buttons-panel' src='"+e.Command+"'></iframe>";else{var a="",o=0;isMobileDevice?(0!=e.Text.length&&(o+=64),e.Data.HideConfirmButton||e.Data.HideCancelButton||(o+=56),a="calc( 100% - "+o+"px )"):(o=480,0==e.Text.length&&(o+=64),e.Data.HideConfirmButton&&e.Data.HideCancelButton&&(o+=56),a=o+"px"),n.innerHTML="<iframe id='xenioo-floating-iframe' class='xenioo-float-extra-content-iframe-with-buttons' style='height:"+a+"' src='"+e.Command+"'></iframe>"}for(var i="",r=e.Parts.length-1;r>=0;r--)e.Parts[r].Text&&e.Parts[r].Text.length>0&&(i+="<div class='xenioo-float-card-button' style='background:"+options.floatcolor+"' id='float-button-"+r+"' onclick=\""+e.Parts[r].Command+'">'+e.Parts[r].Text+"</div>");i.length>0&&(n.innerHTML+="<div style='background:"+options.backcolor+"' class='xenioo-float-card-buttons-container'>"+i+"</div>"),e.Data.InlineDisplay&&options.displaymode!=MODE_RIGHT_BAR&&(document.getElementById("xenioo-floating-extra-content").setAttribute("style","right:20px !important;z-index:2147483055;"),chatcontainer.setAttribute("style","opacity:0")),options.displaymode==MODE_RIGHT_BAR&&moveoutChatWidget(),hideFloatCloseButton(),openFloatContent()}function disableFloatButtons(){for(var e=0,t=document.getElementById("float-button-"+e);null!=t;)t.className="xenioo-float-card-button-disabled",t.onclick=null,e++,t=document.getElementById("float-button-"+e)}function showFloatingUrl(e){document.getElementById("xenioo-floating-extra-content-header-title").innerHTML=e.Text;var t="";e.Data&&e.Data.CloseFloatingOnUrl&&(t=e.Data.CloseFloatingOnUrl),document.getElementById("xenioo-floating-extra-content-body").innerHTML="<iframe id='xenioo-floating-iframe' class='xenioo-float-extra-content-iframe' src='"+e.Command+"'></iframe>",showFloatCloseButton(),openFloatContent()}function hideBubble(){hideCallout()}function showBubble(e){showCallout(e,!0)}function showCallout(e,t){widget&&(options.showbubble||t)&&!isChatOpened()&&(null==calloutbubble?(options.onCalloutDisplay&&options.onCalloutDisplay(e),(calloutbubble=document.createElement("div")).setAttribute("id","xenioo-calloutbubble"),calloutbubble.setAttribute("class","xenioo-conversation-calloutbubble"),calloutbubble.innerHTML=e,calloutbubble.style.opacity=0,calloutbubble.onclick=function(){onWidgetClicked(!0)},widget.appendChild(calloutbubble),(calloutbubblehint=document.createElement("div")).setAttribute("class","xenioo-conversation-calloutbubble-hint"),calloutbubblehint.style.opacity=0,widget.appendChild(calloutbubblehint)):(calloutbubble.style.opacity=0,calloutbubblehint.style.opacity=0,calloutbubble.innerHTML=e),calloutbubble.style.opacity=1,calloutbubblehint.style.opacity=1)}function hideCallout(){null!=calloutbubble&&(widget.removeChild(calloutbubble),widget.removeChild(calloutbubblehint),calloutbubble=null,calloutbubblehint=null)}function showFloatCard(e){var t=document.getElementById("xenioo-floating-extra-content-header-title");if(null!=t){t.innerHTML=e.Text;var n=document.getElementById("xenioo-floating-extra-content-body"),a=!1;options.onFloatingAreaRender&&(a=options.onFloatingAreaRender(n,e)),!a&&(hasValue(e.Data.ImageUrl)?n.innerHTML="<img class='xenioo-float-card-image' onclick=\"window.open('"+e.Data.Url+"')\" src='"+e.Data.ImageUrl+"'><div class='xenioo-float-card-text'>"+e.Data.Subtitle+"</div>":hasValue(e.Data.Url)?n.innerHTML="<iframe id='xenioo-floating-iframe' class='xenioo-float-extra-content-iframe' src='"+e.Data.Url+"'></iframe>":hasValue(e.Data.Subtitle)&&(n.innerHTML="<div class='xenioo-float-card-text'>"+e.Data.Subtitle+"</div>"));for(var o="",i=e.Parts.length-1;i>=0;i--)switch(e.Parts[i].SubType){case"postback":o+="<div class='xenioo-float-card-button' onclick='xenioowebchat.callFloatAction(\""+e.Parts[i].Text+'", "'+e.Parts[i].Command+"\")'>"+e.Parts[i].Text+"</div>";break;case"web_url":var r=e.Parts[i].Command,l=e.Parts[i].Data;l&&(r=l.RedirectToFloating?"xenioowebchat.replaceFloatingBody('"+r+"')":l.OpenInSameWindow?"window.location.href = '"+r+"'":"window.open('"+r+"')"),o+="<div class='xenioo-float-card-button' onclick=\""+r+'">'+e.Parts[i].Text+"</div>"}n.innerHTML+="<div class='xenioo-float-card-buttons-container'>"+o+"</div>",showFloatCloseButton(),openFloatContent()}}function replaceFloatingBody(e){document.getElementById("xenioo-floating-extra-content-body").innerHTML="<iframe id='xenioo-floating-iframe' class='xenioo-float-extra-content-iframe' src='"+e+"'></iframe>"}function showFloatCloseButton(){document.getElementById("xenioo-floating-context-close-button").style.display=""}function hideFloatCloseButton(){document.getElementById("xenioo-floating-context-close-button").style.display="none"}function replaceQuote(e){var t=RegExp("'","g");return e=e.replace(t,"'")}function replace(e,t,n){var a=RegExp(t,"g");return e=e.replace(a,n)}function hasValue(e){return!isNullOrEmpty(e)}function isNullOrEmpty(e){return!e||null==e||void 0===e||0==e.length}function callFloatAction(e,t){closeFloatContent(),say(e,t)}function writeWarning(e){write("<div class='x-message-bubble'>"+getAvatarInline(0)+"<div class='x-message-bubble-content'><div class='x-bubble-hint'></div><div class='"+getMessageBubbleClass()+"-warn'>"+linkify(e)+"</div></div></div>")}function renderList(e){for(var t="<div class='x-list-container fix-sizing' id='"+getChatItemId()+"'>",n=0;n<e.Parts.length;n++)t+=renderListItem(e.Parts[n],0==n&&"large"==e.SubType);return t+="</div>",itemid++,t}function renderListItem(e,t){var n="";n=17==e.Type?!e.Data.OpenInSameWindow||options.preview?"<div class='x-list-item fix-sizing' style='cursor:pointer' onclick='window.open(\""+e.Command+"\")'>":"<div class='x-list-item fix-sizing' style='cursor:pointer' onclick='window.location.href = \""+e.Command+"\"'>":t?"<div class='x-list-item-large fix-sizing' style='background:url(\""+e.Data.ImageUrl+"\");background-repeat: no-repeat;background-size: cover;'>":"<div class='x-list-item fix-sizing'>",n+="<div class='x-list-text-container fix-sizing'><div class='x-list-title'>"+fix(e.Text)+"</div>",e.Data.Description?n+="<div class='x-list-subtitle fix-sizing' style='max-width: 150px;' title='"+fixDesc(e.Data.Description)+"'>"+fix(e.Data.Description)+"</div>":n+="<div class='x-list-subtitle fix-sizing' title='"+fixDesc(e.Data.Subtitle)+"'>"+fix(e.Data.Subtitle)+"</div>";for(var a=0;a<e.Parts.length;a++)n+=renderButton(e.Parts[a]);return n+="</div>",t||(isNullOrEmpty(e.Data.ImageUrl)?n+="<div class='x-list-image-container fix-sizing'></div>":isNullOrEmpty(e.Data.Url)?n+="<div class='x-list-image-container fix-sizing'><img class='x-list-image' src='"+e.Data.ImageUrl+"'></div>":isUrl(e.Data.Url)?n+="<div class='x-list-image-container fix-sizing'><a href='"+e.Data.Url+"'><img class='x-list-image' src='"+e.Data.ImageUrl+"'></a></div>":n+="<div class='x-list-image-container fix-sizing'><img onclick=\""+e.Data.Url+"\" style='cursor:pointer' class='x-list-image' src='"+e.Data.ImageUrl+"'></div>"),n+="</div>"}function isUrl(e){return 0==e.toLowerCase().indexOf("http")||0==e.toLowerCase().indexOf("www")}function renderCarousel(e){var t=options.landingpage&&!isMobileDevice?3:1,n=200+(options.landingpage&&!isMobileDevice?10:0),a="",o=n*(e.Parts.length<t?e.Parts.length:t);o>n&&(a="width:"+o+"px");var i="";1==e.Parts.length&&(i="x-carousel-single-card");for(var r="<div class='x-carousel-container-whole "+i+"' style='"+a+"'><div class='x-card-carousel-container fix-sizing' data-index='0' data-max='"+e.Parts.length+"' id='carousel_"+itemid+"'>",l=0;l<e.Parts.length;l++)r+=renderCard(e.Parts[l],!0);return r+="</div>",e.Parts.length>1&&e.Parts.length>t&&(r+="<div id='carousel_"+itemid+"_left_arrow' onclick='xenioowebchat.ScrollCarousel(-4, "+itemid+", -1)' class='x-card-carousel-container-left-arrow xenioo-arrow-hidden'></div>"),e.Parts.length>1&&e.Parts.length>t&&(r+="<div id='carousel_"+itemid+"_right_arrow' onclick='xenioowebchat.ScrollCarousel(4, "+itemid+", 1)' class='x-card-carousel-container-right-arrow'></div>"),r+="</div>",itemid++,r}function renderCard(e,t){var n="<div class='x-card "+(t?"carousel":"")+" fix-sizing'>";if(e.Data&&e.Data.ImageUrl){if(e.Data.MediaType)switch(e.Data.MediaType){case"IMAGE":n+="<div class='x-card-image-container fix-sizing'><img class='x-card-image' src='"+e.Data.ImageUrl+"'></div>";break;case"VIDEO":n+="<video class='x-video-control' controls><source src='"+e.Data.ImageUrl+"'></video>";break;case"DOC":n+="<div class='x-card-image-container fix-sizing'><a download href='"+e.Data.ImageUrl+"'><img class='x-card-image doc-attachment-image'></a></div>"}else hasValue(e.Data.Url)?isUrl(e.Data.Url)?n+="<div class='x-card-image-container fix-sizing'><a target='_blank' href='"+e.Data.Url+"'><img class='x-card-image' src='"+e.Data.ImageUrl+"'></a></div>":n+="<div class='x-card-image-container fix-sizing'><img onclick=\""+e.Data.Url+"\" style='cursor:pointer' class='x-card-image' src='"+e.Data.ImageUrl+"'></div>":n+="<div class='x-card-image-container fix-sizing'><img class='x-card-image' src='"+e.Data.ImageUrl+"'></div>"}e.Data&&e.Data.Subtitle?(n+="<div class='x-card-subtitle-container'>",e.Data.Url?n+="<div class='x-card-title fix-sizing' style='cursor:pointer;' onclick=\"window.open('"+e.Data.Url+"','_blank')\">"+fix(e.Text)+"</div>":n+="<div class='x-card-title fix-sizing'>"+fix(e.Text)+"</div>",n+="<div class='x-card-subtitle fix-sizing'>"+fix(e.Data.Subtitle)+"</div>",n+="</div>"):n+="<div class='x-card-subtitle fix-sizing'>"+fix(e.Text)+"</div>",e.Data&&e.Data.Footer&&(n+="<div class='x-card-footer'>"+fix(e.Data.Footer)+"</div>"),n+="<div class='x-card-buttons-container fix-sizing'>";for(var a=0;a<e.Parts.length;a++)n+=renderButton(e.Parts[a]);return n+"</div></div>"}function renderButton(e){if(null!=e&&e){var t="xenioowebchat.CloseChatMenuIfOpened();",n="";switch(1==options.contexttype&&(options.autoclosecontext||(t=""),n="style='color:"+options.backcolor+"' "),e.SubType){case"element_share":return"";case"phone_number":return"<a class='x-card-button fix-sizing' "+n+' href="tel:'+e.Command+'" onclick="'+t+'return true;" >'+e.Text+"</a>";case"web_url":if(e.Data.RedirectToFloating&&canDisplayFloat())return"<div class='x-card-button fix-sizing' "+n+" onclick=\"xenioowebchat.showFloatingUrl({Text:'"+e.Text+"',Command:'"+e.Command+"',Data:{CloseFloatingOnUrl:'"+e.Data.CloseFloatingOnUrl+"'}})\">"+e.Text+"</a>";if(options.preview||!e.Data.OpenInSameWindow)return"<a class='x-card-button fix-sizing' "+n+' href="'+e.Command+'" target="_blank" onclick="'+t+'return true;" >'+e.Text+"</a>";return"<a class='x-card-button fix-sizing' "+n+' href="'+e.Command+'" onclick="'+t+'return true;" >'+e.Text+"</a>";default:return"<div class='x-card-button fix-sizing' "+n+" onclick=\"xenioowebchat.Command('"+dropSinglePoint(fix(e.Text))+"','"+dropSinglePoint(e.Command)+"', this);"+t+'" >'+e.Text+"</div>"}}}function dropSinglePoint(e){return e&&null!=e?e=(e=e.replace(/"/g,"''")).replace(/'/g,"\\'"):""}function fixDesc(e){if(isNullOrEmpty(e))return"";for(;e.indexOf("\n")>=0;)e=e.replace("\n"," ");for(;e.indexOf("'")>=0;)e=e.replace("'"," ");for(;e.indexOf('"')>=0;)e=e.replace('"'," ");return e}function fix(e){if(isNullOrEmpty(e))return"";try{e=applyMarkdown(e,"**","<b>","</b>"),e=applyMarkdown(e,"*","<b>","</b>"),e=applyMarkdown(e,"~~","<s>","</s>"),e=applyMarkdown(e,"~","<s>","</s>"),e=applyMarkdown(e,"__","<i>","</i>"),e=applyMarkdown(e,"_","<i>","</i>")}catch(t){}for(;e.indexOf("\n")>=0;)e=e.replace("\n","<br style='display: block;'/>");return e}function applyMarkdown(e,t,n,a){for(var o=e.indexOf(t);o>=0;){var i=e.indexOf(t,o+1);if(i<o||(i-o>1&&canBeMarkdown(e,o-1)&&canBeMarkdown(e,i+t.length)&&(e=e.substr(0,o)+n+e.substr(o+t.length,i-o-t.length)+a+e.substr(i+t.length)),(o=e.indexOf(t,i+1))<0))break}return e}function canBeMarkdown(e,t){return t<0||t>=e.length||"\r"===e[t]||"	"===e[t]||"\n"===e[t]||" "===e[t]||"."===e[t]}function writeTop(e){if(chatarea){var t=document.createElement("div");t.innerHTML=e,chatarea.firstChild?chatarea.insertBefore(t.firstChild,chatarea.firstChild):chatarea.appendChild(t.firstChild)}}function write(e,t,n,a){if(t){var o=document.createElement("div");o.innerHTML=e,options.onElementRender&&n&&options.onElementRender(o.firstChild,n),t.appendChild(o.firstChild)}else{var o=document.createElement("div");o.innerHTML=e,options.onElementRender&&n&&options.onElementRender(o.firstChild,n),chatarea&&(options.landingpage||a?chatarea.insertBefore(o.firstChild,chatinputarea):chatarea.appendChild(o.firstChild))}}function getWelcome(e){if(!userclicked&&options.waitforwidgetclick){setCounter(null);return}resetState(),flowbackenabled=getViewMode()>0;var t=new XMLHttpRequest;t.onreadystatechange=function(){if(4==t.readyState){var n=JSON.parse(t.response),a=!0;if(options.userid||(a=!1),e||null==n||null==n.Parts||1!=n.ControlType||0!=n.Parts.length||getWelcome(!0),readytointeract=!0,setUserIdInfo(n),redrawinghistory=!0,doReply(n),redrawinghistory=!1,options.loadCompleted&&options.loadCompleted(options),options.waitforwidgetclick||endWait(),getViewMode()!=VIEW_MODE_NO_OTHER&&getViewMode()==VIEW_MODE_TAKE_OVER&&chattext&&(chattext.disabled=!1),reschedulePendingRead(),options.waitforwidgetclick)options.waitforwidgetclick=!1;else if(0!=options.autoopenchatdelay){if(null!=n&&null!=n.Parts&&null!=n.Parts.find(e=>19==e.Type)&&options.closeifhistory||options.closeifknown&&a){autoOpenChat(!1);return}setTimeout(function(){autoOpenChat(!0)},1e3*options.autoopenchatdelay)}else autoOpenChat(!1)}},options.variables.push({Name:"web_channel_url",Value:window.location.href}),options.variables.push({Name:"web_channel_referral",Value:getReferral()}),options.variables.push({Name:"web_channel_agent",Value:getAgentString()}),null!=options.variables.find(e=>"locale"==e.Name)&&options.variables.push({Name:"locale",Value:getLang()}),t.open("GET",api+"/webapi/endpoint/chat",!0),setWelcomeHeaders(t),setVariables(t),setTags(t),options.rewindchat&&(t.setRequestHeader("rw","1"),logging=!0),e&&t.setRequestHeader("rwn","1"),options.onDataConnection&&!destroyed&&options.onDataConnection(),t.send()}function getLang(){return void 0!=navigator.languages?navigator.languages[0]:navigator.language}function getReferral(){return document.referrer&&""!=document.referrer?document.referrer:""}function getAgentString(){try{return window.navigator.userAgent}catch(e){return""}}function setVariables(e){for(var t="",n=0;n<options.variables.length;n++)t+=options.variables[n].Name+"|"+encode64(options.variables[n].Value)+"|";var a=(window.location.search.split("?")[1]||"").split("&");for(var o in a)a.hasOwnProperty(o)&&(t+=(paramParts=a[o].split("="))[0]+"|"+encode64(decodeURIComponent(unescape(paramParts[1])||""))+"|");0!=t.length&&e.setRequestHeader("bot-vars",t.substring(0,t.length-1))}function encode64(e){return btoa(encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,function e(t,n){return String.fromCharCode("0x"+n)}))}function setParamVariables(e,t){if(void 0!==t&&null!=t){for(var n="",a=Object.keys(t),o=0;o<a.length;o++){var i=null;try{i=encode64(t[a[o]])}catch(r){console.log("%cXenioo:[Warning] - Param "+a[o]+" failed to parse to btoa. Ignored.","color:darkorange")}n+=a[o]+"|"+i+"|"}e.setRequestHeader("bot-vars",n.substring(0,n.length-1))}}function setTags(e){for(var t="",n=0;n<options.tags.length;n++)t+=options.tags[n]+"|";0!=t.length&&e.setRequestHeader("bot-tags",t)}function autoOpenChat(e){e?options.autoopenchatmobiledisabled&&isMobileDevice||(button&&(button.style.opacity=1),openChat()):options.autoopencontext&&e&&(1==options.contexttype?(button.style.opacity=1,toggleChat()):toggleChatMenu())}function readPending(){if(reading_chat){reschedulePendingRead();return}if(!reading_scheduled){var e=new XMLHttpRequest;e.onreadystatechange=function(){if(reading_scheduled=!1,400==e.status&&getViewMode()>VIEW_MODE_NO_OTHER){window.location.href=window.location.href;return}if(4==e.readyState){var t=JSON.parse(e.response);if(t.I&&t.I>0&&t.I>maxposindex&&(maxposindex=t.I),t.Parts.length>0){if(IsDifferentFromLastPart(t.Parts)){if(getViewMode()>VIEW_MODE_NO_OTHER){for(var n=0;n<t.Parts.length;n++)if(19==t.Parts[n].Type){notifyUpdate();break}}read_interval=max_read_interval/2,formopened=!1,endWait(),doReply(t)}}else!formopened&&(read_interval+=1e3)>max_read_interval&&(read_interval=max_read_interval),postReplyMsg(t);1==t.ControlType?(sendbutton&&(sendbutton.disabled=!1),chattext&&(chattext.disabled=!1),attachmentbutton&&getViewMode()==VIEW_MODE_NO_OTHER&&(attachmentbutton.style.display="")):!lastpartwasupload&&attachmentbutton&&(attachmentbutton.style.display="none"),reschedulePendingRead()}},e.open("GET",api+"/webapi/endpoint/chat",!0),setHeaders(e),e.setRequestHeader("pen","1"),getViewMode()>VIEW_MODE_NO_OTHER&&(e.setRequestHeader("sto","1"),e.setRequestHeader("mai",maxposindex)),options.onDataConnection&&!destroyed&&options.onDataConnection(),e.send(),reading_scheduled=!0}}function notifyUpdate(){!(getViewMode()==VIEW_MODE_NO_OTHER||document.hasFocus())&&"Notification"in window&&("granted"===Notification.permission?new Notification("Xenioo - "+botname,{body:"User "+username+" has sent you a message.",icon:avatar}).onclick=function(e){window.focus()}:"denied"==Notification.permission?playSound():Notification.requestPermission().then(function(e){"granted"===e&&(new Notification("Xenioo - "+botname,{body:"User "+username+" has sent you a message.",icon:avatar}).onclick=function(e){window.focus()})}))}function IsDifferentFromLastPart(e){if(null==this.lastparts||0==this.lastparts.length||getViewMode()==VIEW_MODE_NO_OTHER)return!0;for(var t=e.length-1,n=this.lastparts.length-1;t>=0;){if(this.lastparts[n].Text!=e[t].Text||this.lastparts[n].Command!=e[t].Command||this.lastparts[n].Type!=e[t].Type)return!0;if(t--,--n<0)break}return!1}function getViewMode(){return void 0===options.viewmode?0:options.viewmode}function postReplyMsg(e){e&&window.parent&&window.parent.postMessage({x_ms:e.M,x_as:e.A,x_ss:e.S},"*")}function reschedulePendingRead(){destroyed||setTimeout(function(){readPending()},read_interval)}function send(e,t,n){if(null!=e||null!=t){hasValue(e)&&e.length>4096&&(e=e.substring(0,4906)),options.speakerenabled&&speechSynthesis.cancel(),reading_chat=!0,removeOrDisableButtons(),resetState(),options.landingpage&&chatinputarea&&(chatinputarea.style.opacity=0);var a=new XMLHttpRequest;a.onreadystatechange=function(){if(4==a.readyState){var n=document.getElementById("load_history");if(null!=n&&n.parentElement.removeChild(n),reading_chat=!1,endWait(),a.response&&""!=a.response){var o=JSON.parse(a.response);if(flowbackenabled=o.F,getViewMode()==VIEW_MODE_TAKE_OVER&&!isFileUpload(t)&&!flowbackenabled){lastoptext=e,o.Parsed&&(lastoptext=o.Parsed);var i={Type:0,Text:lastoptext,Creation:o.Creation};writePart(i,0),writeTime(i,!1),scollDownChat(chatarea,1e3)}doReply(o)}}};var o={Text:e,Command:t};getViewMode()==VIEW_MODE_TAKE_OVER&&(t&&null!=t||(t=""),"HAND_OVER"!=t&&0>t.indexOf("HISTORY_")&&(o.Command="VIEW_2"),o.ChannelProviderId=options.prid,o.ChannelId=options.chid,o.UserId=options.userid);var i="";isFileUpload(t)&&(getViewMode()==VIEW_MODE_TAKE_OVER?o.CommandType="attachment;"+n.fileName+";"+n.file:(o.Command=n.file,o.CommandType="attachment;"+n.fileName),i=n.fileName,n.file=null,n.fileName=null,n.fileSize=null,n.fileType=null),null==t?options.onUserSays&&options.onUserSays(e):options.onButtonClick&&options.onButtonClick(e,t),a.open("POST",api+"/webapi/endpoint/chat",!0),setHeaders(a),getViewMode()>VIEW_MODE_NO_OTHER&&a.setRequestHeader("mai",maxposindex),setParamVariables(a,n),a.setRequestHeader("Content-type","application/json"),options.onDataConnection&&!destroyed&&options.onDataConnection(),getViewMode()==VIEW_MODE_NO_OTHER?a.onprogress=function(){3==a.readyState&&0!=i.length&&(writeUser("<div style='background-color:"+options.forecolor+"' class='xenioo-attached-file-image xenioo-left-float'></div>&nbsp;"+i),i="")}:getViewMode()==VIEW_MODE_TAKE_OVER&&(a.onprogress=function(e){if(3==a.readyState&&0!=i.length){var t={Type:0,Text:i,Creation:new Date};writePart(t,0),writeTime(t,!1),scollDownChat(chatarea,1e3),i=""}}),a.send(JSON.stringify(o))}}function sendAttachment(e){var t=event.target.files[0].name,n=event.target.files[0].size,a=event.target.files[0].type;if(!(n/1024/1024>10)){var o=new FileReader;o.readAsDataURL(e),o.onload=function(){send(null,"attachment",{file:o.result,fileName:t,fileSize:n,fileType:a,mode:getViewMode()})},o.onerror=function(e){}}}function resetState(){chattext&&(chattext.value=""),firstbutton=!0,buttoncounter=0}function removeOrDisableButtons(){for(var e=0;e<buttoncounter;e++){var t=document.getElementById("x-button"+e);if(null!=t){var n=t.closest(".x-message-bubble");null!=n&&n.parentElement.removeChild(n)}}}function setWelcomeHeaders(e){setHeaders(e),options.behaviour&&e.setRequestHeader("in-be",options.behaviour)}function setHeaders(e){e&&(shared&&e.setRequestHeader("sh",shared?"T":"F"),options&&(e.setRequestHeader("bot-channel-id",options.id),e.setRequestHeader("user-id",options.userid),e.setRequestHeader("fc",options.firstContact),e.setRequestHeader("lc",options.lastContact),e.setRequestHeader("shid",options.shid)))}function setVariableHeaders(e){if(options){if(options.variables)for(var t=0;t<options.variables.length;t++)e.setRequestHeader("variable-"+options.variables[t].name,options.variables[t].value);if(options.tags)for(var t=0;t<options.tags.length;t++)e.setRequestHeader("tag-"+options.tags[t],options.tags[t])}}function setLastContact(){var e=new Date;options.lastContact=e.getDate()+"/"+(e.getMonth()+1)+"/"+e.getFullYear(),writeCookie("lc",options.lastContact,1024)}function setFirstContact(){if(options.firstContact=readCookie("fc"),null==options.firstContact){var e=new Date;options.firstContact=e.getDate()+"/"+(e.getMonth()+1)+"/"+e.getFullYear(),writeCookie("fc",options.firstContact,1024)}}function loadCSS(e,t){var n=document.createElement("link");n.setAttribute("rel","stylesheet"),n.setAttribute("type","text/css"),n.setAttribute("href",e),null!=t&&(n.onload=function(){t()},n.onerror=function(){t()}),document.getElementsByTagName("head")[0].appendChild(n)}function loadJS(e){var t=document.createElement("script");t.setAttribute("src",e),document.getElementsByTagName("head")[0].appendChild(t)}function setChatState(e){chattext.disabled=!e}function writeCookie(e,t,n){var a="";if(n){var o=new Date;o.setTime(o.getTime()+864e5*n),a="; expires="+o.toUTCString()}var i=e+"="+t+a+"; path=/";options.cookieDomain&&null!=options.cookieDomain&&(i+=";domain="+options.cookieDomain),i+="; path=/",document.cookie=i}function readCookie(e){for(var t=e+"=",n=document.cookie.split(";"),a=0;a<n.length;a++){for(var o=n[a];" "==o.charAt(0);)o=o.substring(1,o.length);if(0==o.indexOf(t))return o.substring(t.length,o.length)}return null}function eraseCookie(e){writeCookie(e,"",-1)}function getChatItemId(){return lastitemid="chat_item_"+ ++itemid}function scrollCarousel(e,t,n){var a=document.getElementById("carousel_"+t),o=parseInt(a.getAttribute("data-index")),i=parseInt(a.getAttribute("data-max"));o+=n;var r=document.getElementById("carousel_"+t+"_left_arrow"),l=document.getElementById("carousel_"+t+"_right_arrow");o<=0?r.classList.add("xenioo-arrow-hidden"):r.classList.remove("xenioo-arrow-hidden"),o>=i-1?l.classList.add("xenioo-arrow-hidden"):l.classList.remove("xenioo-arrow-hidden"),a.setAttribute("data-index",o);var s=a.firstElementChild.getBoundingClientRect().width;scrollTo(a,s,e,5)}function scrollTo(e,t,n,a){setTimeout(function(){e.scrollLeft=e.scrollLeft+n,(t-=Math.abs(n))<=0||scrollTo(e,t,n,a*=1.01)},a)}function scollDownChat(e,t){options.landingpage?scrollDownChatSmooth(e,t):scrollDownChatDefault(e,t)}function scrollDownChatDefault(e,t,n){e&&(e.clientHeight>=e.scrollHeight||(!n&&(n=25,e.scrollHeight-e.clientHeight>1e3&&(n=250)),setTimeout(function(){if(e.scrollTop=e.scrollTop+n,--n<3){n=3;return}e.scrollTop!=e.scrollHeight-e.clientHeight&&scrollDownChatDefault(e,t,n)},10)))}function scrollDownChatSmooth(e,t){if(e&&!(e.scrollTop>=e.scrollHeight)&&!scrollDownChatIsAnimating){var n=e.scrollTop,a=e.scrollHeight-n,o=0,i=20,r=function(){var l=Math.easeInOutQuad(o+=i,n,a,t);e.scrollTop=l,o<t?setTimeout(r,i):scrollDownChatIsAnimating=!1};scrollDownChatIsAnimating=!0,r()}}function sanitizeTags(e){if(e=replace(e,"<script","&lt;script"),0==(e=replace(e,"</script>","&lt;/script&gt;")).indexOf("<img")||0==e.indexOf("<video")||0==e.indexOf("<audio")||e.indexOf("xenioo-attached-file-image")>=0)return e;for(;e.indexOf("<")>=0;)e=e.replace("<","&lt;");for(;e.indexOf(">")>=0;)e=e.replace(">","&gt;");return e}function getParameterByName(e,t){t||(t=window.location.href);var n=RegExp("[?&]"+(e=e.replace(/[\[\]]/g,"\\$&"))+"(=([^&#]*)|&|#|$)").exec(t);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null}function getVariable(e){if(null==e||!e||0==e.length||null==this.variables||!this.variables||0==this.variables.length)return null;var t=this.variables.filter(t=>t.Name.toLowerCase()==e.toLowerCase());return 0==t.length?null:t[0].Value}function enableCrossMessages(){addEvent(window,"message",function(e){switch(event.data){case"xenioo_toggleFloatContent":chatcontainer.setAttribute("style",""),toggleFloatContent();break;case"xenioo_disableFloatButtons":disableFloatButtons()}})}function addEvent(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent&&e.attachEvent("on"+t,n)}function detectswipe(e,t,n){(swipe_det={}).sX=0,swipe_det.sY=0,swipe_det.eX=0,swipe_det.eY=0;var a=30,o=30,i=50,r=60,l="";(ele=document.getElementById(e)).addEventListener("touchstart",function(e){var t=e.touches[0];swipe_det.sX=t.screenX,swipe_det.sY=t.screenY},!1),ele.addEventListener("touchmove",function(e){e.preventDefault();var t=e.touches[0];swipe_det.eX=t.screenX,swipe_det.eY=t.screenY},!1),ele.addEventListener("touchend",function(s){(swipe_det.eX-a>swipe_det.sX||swipe_det.eX+a<swipe_det.sX)&&swipe_det.eY<swipe_det.sY+r&&swipe_det.sY>swipe_det.eY-r&&swipe_det.eX>0?l=swipe_det.eX>swipe_det.sX?"r":"l":(swipe_det.eY-i>swipe_det.sY||swipe_det.eY+i<swipe_det.sY)&&swipe_det.eX<swipe_det.sX+o&&swipe_det.sX>swipe_det.eX-o&&swipe_det.eY>0&&(l=swipe_det.eY>swipe_det.sY?"d":"u"),""!=l&&"function"==typeof n&&n(e,t,l),l="",swipe_det.sX=0,swipe_det.sY=0,swipe_det.eX=0,swipe_det.eY=0},!1)}function canDisplayFloat(){return null!=rootcontainer&&null!=options&&!options.landingpage}function addReadableText(e){readableText+=e+" "}function readText(){if(!(null==speechutterance||isNullOrEmpty(readableText))&&options.speakerenabled){var e=purgeForSpeak(readableText);speechutterance.text=e,speechSynthesis.speak(speechutterance)}}function purgeForSpeak(e){return e=(e=e.split(":)").join(".")).split(";)").join(".")}function loadHistory(e){document.getElementById("load_history").innerText="Please wait...",send(null,"HISTORY_"+e,null)}function setTextReader(e){if(options.enabletextreader){if(!initSpeech()){options.enabletextreader=!1;return}var t=document.getElementById("xenioo-text-reader-button");if(null==t){var n=document.getElementById("xenioo-conversation-header");if(null==n)return;(t=document.createElement("div")).setAttribute("id","xenioo-text-reader-button"),t.setAttribute("class","xenioo-conversation-speaker-button"),t.onclick=function(){options.speakerenabled=!options.speakerenabled,setTextReader(options.speakerenabled)},n.appendChild(t)}var a=document.getElementById("xenioo-text-reader-button-icon");null!=a&&t.removeChild(a);var o="";o=e?"xenioo-text-reader-button-image-enabled":"xenioo-text-reader-button-image-disabled";var i=document.createElement("div");i.setAttribute("class",o+" xenioo-text-reader-button"),i.setAttribute("id","xenioo-text-reader-button-icon"),i.style.backgroundColor=options.forecolor,t.appendChild(i),readText()}}function initSpeech(){return"speechSynthesis"in window&&(!!voiceinitialized||(((speechutterance=new SpeechSynthesisUtterance).volume=1,speechutterance.lang=options.readerlanguage,window.speechSynthesis.getVoices().length>0)?(getPersonVoice(),!0):(window.speechSynthesis.onvoiceschanged=()=>{getPersonVoice()},!0)))}function getPersonVoice(){for(var e=options.readerperson.split("\n"),t=window.speechSynthesis.getVoices(),n=null,a=0;a<e.length&&(0==e[a].length||null==(n=t.find(t=>t.name.toLowerCase().indexOf(e[a].toLowerCase())>=0)));a++);null!=n&&(speechutterance.voice=n),voiceinitialized=!0,options.onVoiceConfigured(speechutterance)}function setVoiceLanguage(e,t){null!=speechutterance&&(speechutterance.lang=e,speechutterance.voice=t)}function initMicrophone(e){if(!("webkitSpeechRecognition"in window)&&!("SpeechRecognition"in window))return!1;if(options.enablevoicerecording){var t=document.createElement("div");t.setAttribute("class","xenioo-phone-button xenioo-phone-button-image"),t.setAttribute("id","xenioo-conversation-composer-talkbutton"),t.style.backgroundColor=options.forecolor,e.appendChild(t),t.onclick=function(){enableTalk()};var n=n||webkitSpeechRecognition;(recengine=new n).continuous=!1,recengine.interimResults=!1,recengine.lang=options.readerlanguage,recengine.onstart=function(){document.getElementById("xenioo-phone-button").classList.add("xenioo-microphone-recording")},recengine.onend=function(){document.getElementById("xenioo-phone-button").classList.remove("xenioo-microphone-recording")},recengine.onerror=function(e){console.log(e)},recengine.onresult=function(e){for(var t="",n=e.resultIndex;n<e.results.length;++n)t+=e.results[n][0].transcript;say(t)}}}function enableTalk(){null!=recengine&&recengine.start()}function getOptions(){return options}function setOptions(e){options=e}function isFileUpload(e){return"attachment"==e||"voice"==e}function startAudioRecording(){audiochuncks=[],null!=audiorecorder?audiorecorder.start():navigator.mediaDevices.getUserMedia({audio:!0}).then(e=>{stream=e,(audiorecorder=new MediaRecorder(stream)).ondataavailable=e=>{if(audiochuncks.push(e.data),"inactive"==audiorecorder.state){var t=new Blob(audiochuncks,{type:"audio/ogg"}),n=new FileReader;n.readAsDataURL(t),n.onloadend=function(){var e=new Date;send(null,"voice",{file:n.result,fileName:"audio-"+e.getDate()+"-"+(e.getMonth()+1)+"-"+e.getFullYear()+"-"+e.getHours()+"-"+e.getMinutes()+".ogg"})}}},audiorecorder.start()})}function stopAudioRecording(){null!=audiorecorder&&audiorecorder.stop()}function toggleAudioRecording(){return null==audiorecorder||"inactive"==audiorecorder.state?(startAudioRecording(),!0):(stopAudioRecording(),!1)}linkify=(SCHEME="[a-z\\d.-]+://",MAILTO="mailto:",URI_RE=RegExp("(?:\\b"+SCHEME+"[^<>\\s]+|"+(URI2="\\b"+(HOST_OR_IP="(?:(?:(?:[^\\s!@#$%^&*()_=+[\\]{}\\\\|;:'\",.<>/?]+)\\.)+(?:ac|ad|aero|ae|af|ag|ai|al|am|an|ao|aq|arpa|ar|asia|as|at|au|aw|ax|az|ba|bb|bd|be|bf|bg|bh|biz|bi|bj|bm|bn|bo|br|bs|bt|bv|bw|by|bz|cat|ca|cc|cd|cf|cg|ch|ci|ck|cl|cm|cn|coop|com|co|cr|cu|cv|cx|cy|cz|de|dj|dk|dm|do|dz|ec|edu|ee|eg|er|es|et|eu|fi|fj|fk|fm|fo|fr|ga|gb|gd|ge|gf|gg|gh|gi|gl|gm|gn|gov|gp|gq|gr|gs|gt|gu|gw|gy|hk|hm|hn|hr|ht|hu|id|ie|il|im|info|int|in|io|iq|ir|is|it|je|jm|jobs|jo|jp|ke|kg|kh|ki|km|kn|kp|kr|kw|ky|kz|la|lb|lc|li|lk|lr|ls|lt|lu|lv|ly|ma|mc|md|me|mg|mh|mil|mk|ml|mm|mn|mobi|mo|mp|mq|mr|ms|mt|museum|mu|mv|mw|mx|my|mz|name|na|nc|net|ne|nf|ng|ni|nl|no|np|nr|nu|nz|om|org|pa|pe|pf|pg|ph|pk|pl|pm|pn|pro|pr|ps|pt|pw|py|qa|re|ro|rs|ru|rw|sa|sb|sc|sd|se|sg|sh|si|sj|sk|sl|sm|sn|so|sr|st|su|sv|sy|sz|tc|td|tel|tf|tg|th|tj|tk|tl|tm|tn|to|tp|travel|tr|tt|tv|tw|tz|ua|ug|uk|um|us|uy|uz|va|vc|ve|vg|vi|vn|vu|wf|ws|xn--0zwm56d|xn--11b5bs3a9aj6g|xn--80akhbyknj4f|xn--9t4b11yi5a|xn--deba0ad|xn--g6w251d|xn--hgbk6aj7f53bba|xn--hlcj6aya9esc7a|xn--jxalpdlp|xn--kgbechtv|xn--zckzah|ye|yt|yu|za|zm|zw)|(?:(?:[0-9]|[1-9]\\d|1\\d{2}|2[0-4]\\d|25[0-5])\\.){3}(?:[0-9]|[1-9]\\d|1\\d{2}|2[0-4]\\d|25[0-5]))")+"(?:[;/][^#?<>\\s]*)?"+(QUERY_FRAG="(?:\\?[^#<>\\s]*)?(?:#[^<>\\s]*)?")+"(?!\\w)")+"|"+("(?:"+MAILTO+")?[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@"+HOST_OR_IP+QUERY_FRAG)+"(?!\\w))","ig"),SCHEME_RE=RegExp("^"+SCHEME,"i"),quotes={"'":"`",">":"<",")":"(","]":"[","}":"{","\xbb":"\xab","›":"‹"},default_options={callback:function(e,t){return(t&&e.indexOf("|")>0&&(e=e.substring(e.indexOf("|")+1),t=t.substring(0,t.indexOf("|"))),t&&t)?'<a href="'+t+'" title="'+t+"\" target='_blank' >"+e+"</a>":e},punct_regexp:/(?:[!?.,:;'"]|(?:&|&amp;)(?:lt|gt|quot|apos|raquo|laquo|rsaquo|lsaquo);)$/},function(e,t){t=t||{};var n,a,o,i,r,l,s,c,d,u,m,g,p="",v=[];for(a in default_options)void 0===t[a]&&(t[a]=default_options[a]);for(;n=URI_RE.exec(e);)if(o=n[0],s=(l=URI_RE.lastIndex)-o.length,!/[\/:]/.test(e.charAt(s-1))){do c=o,(m=quotes[g=o.substr(-1)])&&(d=o.match(RegExp("\\"+m+"(?!$)","g")),u=o.match(RegExp("\\"+g,"g")),(d?d.length:0)<(u?u.length:0)&&(o=o.substr(0,o.length-1),l--)),t.punct_regexp&&(o=o.replace(t.punct_regexp,function(e){return l-=e.length,""}));while(o.length&&o!==c);i=o,SCHEME_RE.test(i)||(i=(-1!==i.indexOf("@")?i.indexOf(MAILTO)?MAILTO:"":i.indexOf("irc.")?i.indexOf("ftp.")?"http://":"ftp://":"irc://")+i),r!=s&&(v.push([e.slice(r,s)]),r=l),v.push([o,i])}for(v.push([e.substr(r)]),a=0;a<v.length;a++)p+=t.callback.apply(window,v[a]);return p||e}),Math.easeInOutQuad=function(e,t,n,a){return(e/=a/2)<1?n/2*e*e+t:-n/2*(--e*(e-2)-1)+t};var crc32=function(e){for(var t,n=[],a=0;a<256;a++){t=a;for(var o=0;o<8;o++)t=1&t?3988292384^t>>>1:t>>>1;n[a]=t}for(var i=-1,r=0;r<e.length;r++)i=i>>>8^n[255&(i^e.charCodeAt(r))];return(-1^i)>>>0};return{Start:xenioo,Restart:xeniooRestart,StartAsLanding:xeniooLanding,TryAutoStart:xeniooAutoStart,EmbedChatLanding:embedChatLanding,EmbedChatFullPage:embedChatFullPage,Command:doCommand,openForm:openForm,OpenForm:openForm,say:say,Say:say,Send:send,send:send,scrollCarousel:scrollCarousel,ScrollCarousel:scrollCarousel,closeChatMenuIfOpened:closeChatMenuIfOpened,CloseChatMenuIfOpened:closeChatMenuIfOpened,toggleChat:toggleChat,ToggleChat:toggleChat,openChat:openChat,closeChat:closeChat,isChatOpened:isChatOpened,callFloatAction:callFloatAction,closeFloatContent:closeFloatContent,openFloatContent:openFloatContent,toggleFloatContent:toggleFloatContent,showFloatingUrl:showFloatingUrl,attachFile:attachFile,goTo:goTo,disableFloatButtons:disableFloatButtons,getVariable:getVariable,handOver:handOver,setVoiceLanguage:setVoiceLanguage,destroy:destroy,showBubble:showBubble,hideBubble:hideBubble,getOptions:getOptions,setOptions:setOptions,restartChat:restartChat,replaceFloatingBody:replaceFloatingBody,startAudioRecording:startAudioRecording,stopAudioRecording:stopAudioRecording,toggleAudioRecording:toggleAudioRecording,loadHistory:loadHistory,Utils:{dropSinglePoint:dropSinglePoint,DropSinglePoint:dropSinglePoint,fixText:fix,FixText:fix,IsNullOrEmpty:isNullOrEmpty,isNullOrEmpty:isNullOrEmpty}}}();function Xenioo(e,t){return xenioowebchat.Start(e,t),xenioowebchat}xenioowebchat.TryAutoStart();